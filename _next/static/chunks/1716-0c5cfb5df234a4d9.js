"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1716],{85611:function(e,t,s){s.d(t,{y:function(){return r}});class r{observers=new Map;onceObservers=[];constructor(){}subscribe(e,t){if("function"==typeof e&&void 0===t)this.observers.set(e,e);else if(void 0!==t)this.observers.set(e,t);else throw Error("Invalid arguments for subscribe method")}subscribeOnce(e){this.onceObservers.push(e)}unsubscribe(e){this.observers.delete(e)}notify(e){for(this.observers.forEach(t=>t(e));this.onceObservers.length;)this.onceObservers.shift()(e)}async notifyAsync(e){for(this.observers.forEach(t=>t(e));this.onceObservers.length;){let t=this.onceObservers.shift();await t(e)}}clear(){this.onceObservers=[],this.observers.clear()}}},55682:function(e,t,s){s.d(t,{_:function(){return o}});var r=s(31779),i=s(62150),a=s(95035),n=s(35606);let h=`uniform float brightness;uniform float persistence;uniform float timeScale;varying vec2 vUV;vec2 hash22(vec2 p)
{p=p*mat2(127.1,311.7,269.5,183.3);p=-1.0+2.0*fract(sin(p)*43758.5453123);return sin(p*6.283+timeScale);}
float interpolationNoise(vec2 p)
{vec2 pi=floor(p);vec2 pf=p-pi;vec2 w=pf*pf*(3.-2.*pf);float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));float xm1=mix(f00,f10,w.x);float xm2=mix(f01,f11,w.x);float ym=mix(xm1,xm2,w.y); 
return ym;}
float perlinNoise2D(float x,float y)
{float sum=0.0;float frequency=0.0;float amplitude=0.0;for(int i=0; i<OCTAVES; i++)
{frequency=pow(2.0,float(i));amplitude=pow(persistence,float(i));sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;}
return sum;}
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{float x=abs(vUV.x);float y=abs(vUV.y);float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);gl_FragColor=vec4(noise,noise,noise,1.0);}
`;n.v.ShadersStore.noisePixelShader=h;class o extends i.g{constructor(e,t=256,s=r.l.LastCreatedScene,i,a){super(e,t,"noise",s,i,a),this.time=0,this.brightness=.2,this.octaves=3,this.persistence=.8,this.animationSpeedFactor=1,this.autoClear=!1,this._updateShaderUniforms()}_updateShaderUniforms(){let e=this.getScene();e&&(this.time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this.time))}_getDefines(){return"#define OCTAVES "+(0|this.octaves)}render(e){this._updateShaderUniforms(),super.render(e)}serialize(){let e={};return e.customType="BABYLON.NoiseProceduralTexture",e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e.time=this.time,e}clone(){let e=this.getSize(),t=new o(this.name,e.width,this.getScene(),this._fallbackTexture?this._fallbackTexture:void 0,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t.brightness=this.brightness,t.octaves=this.octaves,t.persistence=this.persistence,t.animationSpeedFactor=this.animationSpeedFactor,t.time=this.time,t}static Parse(e,t){let s=new o(e.name,e.size,t,void 0,e.generateMipMaps);return s.brightness=e.brightness,s.octaves=e.octaves,s.persistence=e.persistence,s.animationSpeedFactor=e.animationSpeedFactor,s.time=e.time??0,s}}(0,a.H7)("BABYLON.NoiseProceduralTexture",o)},62150:function(e,t,s){s.d(t,{g:function(){return d}});var r=s(75176),i=s(10523),a=s(60584),n=s(54025),h=s(72324),o=s(48075),f=s(48887),l=s(24437),c=s(90911),u=s(95035),p=s(31779),_=s(98421);class d extends f.x{get shaderLanguage(){return this._shaderLanguage}constructor(e,t,s,r,i=null,o=!0,l=!1,u=0){super(null,r,!o),this.isEnabled=!0,this.autoClear=!0,this.onGeneratedObservable=new a.y$,this.onBeforeGenerationObservable=new a.y$,this.nodeMaterialSource=null,this.defines="",this._textures={},this._currentRefreshId=-1,this._frameId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=[],this._samplers=[],this._floats={},this._ints={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._fallbackTextureUsed=!1,this._cachedDefines=null,this._contentUpdateId=-1,this._rtWrapper=null,null===i||i instanceof f.x?(this._options={},this._fallbackTexture=i):(this._options=i,this._fallbackTexture=i.fallbackTexture??null),this._shaderLanguage=this._options.shaderLanguage??0;let d=(r=this.getScene()||p.l.LastCreatedScene)._getComponent(h.l.NAME_PROCEDURALTEXTURE);d||(d=new c.O(r),r._addComponent(d)),r.proceduralTextures.push(this),this._fullEngine=r.getEngine(),this.name=e,this.isRenderTarget=!0,this._size=t,this._textureType=u,this._generateMipMaps=o,this._drawWrapper=new _.q(this._fullEngine),this.setFragment(s);let g=this._createRtWrapper(l,t,o,u);this._texture=g.texture;let m=[];m.push(1,1),m.push(-1,1),m.push(-1,-1),m.push(1,-1),this._vertexBuffers[n.o.PositionKind]=new n.o(this._fullEngine,m,n.o.PositionKind,!1,!1,2),this._createIndexBuffer()}_createRtWrapper(e,t,s,r){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1,type:r,...this._options}),this.setFloat("face",0)):(this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1,type:r,...this._options}),this._rtWrapper.is3D&&(this.setFloat("layer",0),this.setInt("layerNum",0))),this._rtWrapper}getEffect(){return this._drawWrapper.effect}_setEffect(e){this._drawWrapper.effect=e}getContent(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData?this._contentData.then(e=>{this._contentData=this.readPixels(0,0,e),this._contentUpdateId=this._frameId}):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId)),this._contentData}_createIndexBuffer(){let e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)}_rebuild(){let e=this._vertexBuffers[n.o.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===l._.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=l._.REFRESHRATE_RENDER_ONCE)}reset(){this._drawWrapper.effect?.dispose(),this._drawWrapper.effect=null,this._cachedDefines=null}_getDefines(){return this.defines}executeWhenReady(e){if(this.isReady()){e(this);return}let t=this.getEffect();t&&t.executeWhenCompiled(()=>{e(this)})}isReady(){let e=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;let t=this._getDefines();if(this._drawWrapper.effect&&t===this._cachedDefines&&this._drawWrapper.effect.isReady())return!0;let r={vertex:"procedural",fragmentElement:this._fragment.fragmentElement,fragmentSource:this._fragment.fragmentSource,fragment:"string"==typeof this._fragment?this._fragment:void 0};return this._cachedDefines!==t&&(this._cachedDefines=t,this._drawWrapper.effect=e.createEffect(r,[n.o.PositionKind],this._uniforms,this._samplers,t,void 0,void 0,()=>{this._rtWrapper?.dispose(),this._rtWrapper=this._texture=null,this._fallbackTexture&&(this._texture=this._fallbackTexture._texture,this._texture&&this._texture.incrementReferences()),this._fallbackTextureUsed=!0},void 0,this._shaderLanguage,async()=>{this._options.extraInitializationsAsync?1===this.shaderLanguage?await Promise.all([s.e(4628).then(s.bind(s,24628)),this._options.extraInitializationsAsync()]):await Promise.all([s.e(1986).then(s.bind(s,81986)),this._options.extraInitializationsAsync()]):1===this.shaderLanguage?await s.e(4628).then(s.bind(s,24628)):await s.e(1986).then(s.bind(s,81986))})),this._drawWrapper.effect.isReady()}resetRefreshCounter(){this._currentRefreshId=-1}setFragment(e){this._fragment=e}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}_shouldRender(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)}getRenderSize(){return this._size}resize(e,t){if(this._fallbackTextureUsed||!this._rtWrapper||!this._texture)return;let s=this._texture.isCube;this._rtWrapper.dispose();let r=this._createRtWrapper(s,e,t,this._textureType);this._texture=r.texture,this._size=e,this._generateMipMaps=t}_checkUniform(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)}setTexture(e,t){return -1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this}setFloat(e,t){return this._checkUniform(e),this._floats[e]=t,this}setInt(e,t){return this._checkUniform(e),this._ints[e]=t,this}setFloats(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this}setColor3(e,t){return this._checkUniform(e),this._colors3[e]=t,this}setColor4(e,t){return this._checkUniform(e),this._colors4[e]=t,this}setVector2(e,t){return this._checkUniform(e),this._vectors2[e]=t,this}setVector3(e,t){return this._checkUniform(e),this._vectors3[e]=t,this}setVector4(e,t){return this._checkUniform(e),this._vectors4[e]=t,this}setMatrix(e,t){return this._checkUniform(e),this._matrices[e]=t,this}render(e){let t=this.getScene();if(!t)return;let s=this._fullEngine;if(s.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),s.setState(!1),!this.nodeMaterialSource){for(let e in this._textures)this._drawWrapper.effect.setTexture(e,this._textures[e]);for(let e in this._ints)this._drawWrapper.effect.setInt(e,this._ints[e]);for(let e in this._floats)this._drawWrapper.effect.setFloat(e,this._floats[e]);for(let e in this._floatsArrays)this._drawWrapper.effect.setArray(e,this._floatsArrays[e]);for(let e in this._colors3)this._drawWrapper.effect.setColor3(e,this._colors3[e]);for(let e in this._colors4){let t=this._colors4[e];this._drawWrapper.effect.setFloat4(e,t.r,t.g,t.b,t.a)}for(let e in this._vectors2)this._drawWrapper.effect.setVector2(e,this._vectors2[e]);for(let e in this._vectors3)this._drawWrapper.effect.setVector3(e,this._vectors3[e]);for(let e in this._vectors4)this._drawWrapper.effect.setVector4(e,this._vectors4[e]);for(let e in this._matrices)this._drawWrapper.effect.setMatrix(e,this._matrices[e])}if(!this._texture||!this._rtWrapper)return;s._debugPushGroup?.(`procedural texture generation for ${this.name}`,1);let r=s.currentViewport;if(this.isCube)for(let e=0;e<6;e++)s.bindFramebuffer(this._rtWrapper,e,void 0,void 0,!0),s.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",e),this.autoClear&&s.clear(t.clearColor,!0,!1,!1),s.drawElementsType(o.F.TriangleFillMode,0,6),s.unBindFramebuffer(this._rtWrapper,!0);else{let e=1;this._rtWrapper.is3D?e=this._rtWrapper.depth:this._rtWrapper.is2DArray&&(e=this._rtWrapper.layers);for(let r=0;r<e;r++){if(s.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0,0,r),s.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._rtWrapper.is3D||this._rtWrapper.is2DArray)for(let t in this._drawWrapper.effect?.setFloat("layer",1!==e?r/(e-1):0),this._drawWrapper.effect?.setInt("layerNum",r),this._textures)this._drawWrapper.effect.setTexture(t,this._textures[t]);this.autoClear&&s.clear(t.clearColor,!0,!1,!1),s.drawElementsType(o.F.TriangleFillMode,0,6),s.unBindFramebuffer(this._rtWrapper,!this._generateMipMaps)}}r&&s.setViewport(r),this.isCube&&s.generateMipMapsForCubemap(this._texture,!0),s._debugPopGroup?.(1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}clone(){let e=this.getSize(),t=new d(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t}dispose(){let e=this.getScene();if(!e)return;let t=e.proceduralTextures.indexOf(this);t>=0&&e.proceduralTextures.splice(t,1);let s=this._vertexBuffers[n.o.PositionKind];s&&(s.dispose(),this._vertexBuffers[n.o.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),super.dispose()}}(0,r.gn)([(0,i.qC)()],d.prototype,"isEnabled",void 0),(0,r.gn)([(0,i.qC)()],d.prototype,"autoClear",void 0),(0,r.gn)([(0,i.qC)()],d.prototype,"_generateMipMaps",void 0),(0,r.gn)([(0,i.qC)()],d.prototype,"_size",void 0),(0,r.gn)([(0,i.qC)()],d.prototype,"refreshRate",null),(0,u.H7)("BABYLON.ProceduralTexture",d)},90911:function(e,t,s){s.d(t,{O:function(){return a}});var r=s(98727),i=s(72324);class a{constructor(e){this.name=i.l.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=[]}register(){this.scene._beforeClearStage.registerStep(i.l.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)}rebuild(){}dispose(){}_beforeClear(){if(this.scene.proceduralTexturesEnabled){r.w1.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(let e=0;e<this.scene.proceduralTextures.length;e++){let t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}r.w1.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}}}}}]);