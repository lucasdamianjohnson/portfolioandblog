"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8924],{10035:function(e,t,i){i.d(t,{O:function(){return r}});class r{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(let e in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,e))return!0;return!1}static get HasPickTriggers(){for(let e in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,e)){let t=parseInt(e);if(t>=1&&t<=7)return!0}return!1}static HasSpecificTrigger(e){for(let t in r.Triggers)if(Object.prototype.hasOwnProperty.call(r.Triggers,t)&&parseInt(t)===e)return!0;return!1}}r.Triggers={}},68361:function(e,t,i){i.d(t,{V:function(){return r}});class r{constructor(e,t,i,r,s,n){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=s,this.additionalData=n}static CreateNew(e,t,i){let s=e.getScene();return new r(e,s.pointerX,s.pointerY,s.meshUnderPointer||e,t,i)}static CreateNewFromSprite(e,t,i,s){return new r(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,s)}static CreateNewFromScene(e,t){return new r(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)}static CreateNewFromPrimitive(e,t,i,s){return new r(e,t.x,t.y,null,i,s)}}},70701:function(e,t,i){var r=i(82877),s=i(9719),n=i(3176),a=i(28143);n.a.AudioEngineFactory=(e,t,i)=>new o(e,t,i);class o{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(e=null,t=null,i=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new r.y$,this.onAudioLockedObservable=new r.y$,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,a.CG)())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);let s=document.createElement("audio");this._hostElement=e,this._audioContext=t,this._audioDestination=i;try{s&&s.canPlayType&&(s.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||s.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(e){}try{s&&s.canPlayType&&s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}lock(){this._triggerSuspendedState()}unlock(){if(this._audioContext?.state==="running"){this._hideMuteButton(),this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this));return}this._tryToRun?this._audioContext?.suspend().then(()=>{this._tryToRun=!1,this._triggerRunningState()}):this._triggerRunningState()}_resumeAudioContextOnStateChange(){this._audioContext?.addEventListener("statechange",()=>{this.unlocked&&this._audioContext?.state!=="running"&&this._resumeAudioContext()},{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){return this._audioContext?.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,s.Y.Error("Web Audio: "+e.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}).catch(()=>{this._tryToRun=!1,this.unlocked=!1}))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";let e=window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png",t=document.createElement("style");t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+e+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",()=>{this._triggerRunningState()},!0),this._muteButton.addEventListener("click",()=>{this.unlock()},!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},93954:function(e,t,i){i.d(t,{l:function(){return n},o:function(){return a}});var r=i(17909),s=i(9719);class n{get isDisposed(){return this._isDisposed}constructor(e,t,i,s=0,n=!1,a=!1,o=!1,h,l){this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=a,this._divisor=h||1,this._label=l,t instanceof r.h?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=o?s:s*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(e,t,i,r,s,n=!1,o){let h=n?t:t*Float32Array.BYTES_PER_ELEMENT,l=r?n?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,e,this._updatable,!0,l,void 0===s?this._instanced:s,h,i,void 0,void 0,!0,this._divisor||o)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(e=null){(e||!this._buffer)&&(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}s.Y.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(e){this.create(e)}updateDirectly(e,t,i,r=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),0===t&&void 0===i?this._data=e:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){let t=0!=e;this._instanceDivisor=e,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){let e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,t,i,r,s,o,h,l,u,c,_=!1,d=!1,p=1,f=!1){this._isDisposed=!1;let g=!1;if(this.engine=e,"object"==typeof r&&null!==r?(g=r.updatable??!1,s=r.postponeInternalCreation,o=r.stride,h=r.instanced,l=r.offset,u=r.size,c=r.type,_=r.normalized??!1,d=r.useBytes??!1,p=r.divisor??1,f=r.takeBufferOwnership??!1,this._label=r.label):g=!!r,t instanceof n?(this._buffer=t,this._ownsBuffer=f):(this._buffer=new n(e,t,g,o,s,h,d,p,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=i,void 0===c){let e=this.getData();this.type=e?a.GetDataType(e):a.FLOAT}else this.type=c;let m=a.GetTypeByteLength(this.type);d?(this._size=u||(o?o/m:a.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*m,this.byteOffset=l||0):(this._size=u||o||a.DeduceStride(i),this.byteStride=o?o*m:this._buffer.byteStride||this._size*m,this.byteOffset=(l||0)*m),this.normalized=_,this._instanced=void 0!==h&&h,this._instanceDivisor=h?p:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,t){let i=this.getData();return i?a.GetFloatData(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/a.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/a.GetTypeByteLength(this.type)}getSize(e=!1){return e?this._size*a.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,t,i=!1){this._buffer.updateDirectly(e,t,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,t){a.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)}_alignBuffer(){}static DeduceStride(e){switch(e){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?a.BYTE:e instanceof Uint8Array?a.UNSIGNED_BYTE:e instanceof Int16Array?a.SHORT:e instanceof Uint16Array?a.UNSIGNED_SHORT:e instanceof Int32Array?a.INT:e instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(e){switch(e){case a.BYTE:case a.UNSIGNED_BYTE:return 1;case a.SHORT:case a.UNSIGNED_SHORT:return 2;case a.INT:case a.UNSIGNED_INT:case a.FLOAT:return 4;default:throw Error(`Invalid type '${e}'`)}}static ForEach(e,t,i,r,s,n,o,h){if(e instanceof Array){let s=t/4,a=i/4;for(let t=0;t<n;t+=r){for(let i=0;i<r;i++)h(e[s+i],t+i);s+=a}}else{let l=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),u=a.GetTypeByteLength(s);for(let e=0;e<n;e+=r){let n=t;for(let t=0;t<r;t++)h(a._GetFloatValue(l,s,n,o),e+t),n+=u;t+=i}}}static _GetFloatValue(e,t,i,r){switch(t){case a.BYTE:{let t=e.getInt8(i);return r&&(t=Math.max(t/127,-1)),t}case a.UNSIGNED_BYTE:{let t=e.getUint8(i);return r&&(t/=255),t}case a.SHORT:{let t=e.getInt16(i,!0);return r&&(t=Math.max(t/32767,-1)),t}case a.UNSIGNED_SHORT:{let t=e.getUint16(i,!0);return r&&(t/=65535),t}case a.INT:return e.getInt32(i,!0);case a.UNSIGNED_INT:return e.getUint32(i,!0);case a.FLOAT:return e.getFloat32(i,!0);default:throw Error(`Invalid component type ${t}`)}}static GetFloatData(e,t,i,r,n,o,h,l){let u=t*a.GetTypeByteLength(i),c=h*t;if(i!==a.FLOAT||n!==u){let s=new Float32Array(c);return a.ForEach(e,r,n,t,i,c,o,(e,t)=>s[t]=e),s}if(!(e instanceof Array||e instanceof Float32Array)||0!==r||e.length!==c){if(e instanceof Array){let t=r/4;return e.slice(t,t+c)}if(e instanceof ArrayBuffer)return new Float32Array(e,r,c);{let t=e.byteOffset+r;if((3&t)!=0&&(s.Y.Warn("Float array must be aligned to 4-bytes border"),l=!0),!l)return new Float32Array(e.buffer,t,c);{let i=new Uint8Array(c*Float32Array.BYTES_PER_ELEMENT),r=new Uint8Array(e.buffer,t,i.length);return i.set(r),new Float32Array(i.buffer)}}}return l?e.slice():e}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},17909:function(e,t,i){i.d(t,{h:function(){return r}});class r{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=r._Counter++}}r._Counter=0},98038:function(e,t,i){i.d(t,{Y:function(){return l}});var r=i(46456),s=i(22287),n=i(82877),a=i(74909),o=i(66508),h=i(4224);class l{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new n.y$,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(e){e=h.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==a.kD.POINTERWHEEL)return;let i=t.event,r=i.deltaMode===o.G.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*r*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*r*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*r*i.deltaZ/this._normalize,i.preventDefault&&!e&&i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,a.kD.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,r.gn)([(0,s.qC)()],l.prototype,"wheelPrecisionX",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"wheelPrecisionY",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"wheelPrecisionZ",void 0)},32067:function(e,t,i){i.d(t,{Y:function(){return l}});var r=i(46456),s=i(22287),n=i(94656),a=i(22710),o=i(39884),h=i(4224);class l{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=[]}attachControl(e){e=h.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(()=>{this._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(t=>{let i=t.event;if(!i.metaKey){if(t.type===a.OG.KEYDOWN)-1===this.keysUp.indexOf(i.keyCode)&&-1===this.keysDown.indexOf(i.keyCode)&&-1===this.keysLeft.indexOf(i.keyCode)&&-1===this.keysRight.indexOf(i.keyCode)&&-1===this.keysUpward.indexOf(i.keyCode)&&-1===this.keysDownward.indexOf(i.keyCode)&&-1===this.keysRotateLeft.indexOf(i.keyCode)&&-1===this.keysRotateRight.indexOf(i.keyCode)&&-1===this.keysRotateUp.indexOf(i.keyCode)&&-1===this.keysRotateDown.indexOf(i.keyCode)||(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),e||i.preventDefault());else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){let t=this._keys.indexOf(i.keyCode);t>=0&&this._keys.splice(t,1),e||i.preventDefault()}}}))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){let e=this.camera;for(let t=0;t<this._keys.length;t++){let i=this._keys[t],r=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?e._localDirection.copyFromFloats(-r,0,0):-1!==this.keysUp.indexOf(i)?e._localDirection.copyFromFloats(0,0,r):-1!==this.keysRight.indexOf(i)?e._localDirection.copyFromFloats(r,0,0):-1!==this.keysDown.indexOf(i)?e._localDirection.copyFromFloats(0,0,-r):-1!==this.keysUpward.indexOf(i)?e._localDirection.copyFromFloats(0,r,0):-1!==this.keysDownward.indexOf(i)?e._localDirection.copyFromFloats(0,-r,0):-1!==this.keysRotateLeft.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(e._localDirection.copyFromFloats(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),o.P.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){let e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}}(0,r.gn)([(0,s.qC)()],l.prototype,"keysUp",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysUpward",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysDown",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysDownward",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysLeft",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysRight",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"rotationSpeed",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysRotateLeft",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysRotateRight",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysRotateUp",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"keysRotateDown",void 0),n.u.FreeCameraKeyboardMoveInput=l},42523:function(e,t,i){i.d(t,{A:function(){return l}});var r=i(46456),s=i(82877),n=i(22287),a=i(94656),o=i(74909),h=i(4224);class l{constructor(e=!0){this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new s.y$,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(e){e=h.w1.BackCompatCameraNoPreventDefault(arguments);let t=this.camera.getEngine(),i=t.getInputElement();this._pointerInput||(this._pointerInput=r=>{let s=r.event,n="touch"===s.pointerType;if(!this.touchEnabled&&n||r.type!==o.kD.POINTERMOVE&&-1===this.buttons.indexOf(s.button))return;let a=s.target;if(r.type===o.kD.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=s.pointerId;try{a?.setPointerCapture(s.pointerId)}catch(e){}-1===this._currentActiveButton&&(this._currentActiveButton=s.button),this._previousPosition={x:s.clientX,y:s.clientY},!e&&(s.preventDefault(),i&&i.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(r.event)}else if(r.type===o.kD.POINTERUP){if(n&&this._activePointerId!==s.pointerId||!n&&this._currentActiveButton!==s.button)return;try{a?.releasePointerCapture(s.pointerId)}catch(e){}this._currentActiveButton=-1,this._previousPosition=null,e||s.preventDefault(),this._activePointerId=-1}else if(r.type===o.kD.POINTERMOVE&&(this._activePointerId===s.pointerId||!n)){if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(r.event);else if(this._previousPosition){let t=this.camera._calculateHandednessMultiplier(),i=(s.clientX-this._previousPosition.x)*t,r=s.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=r/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:r}),this._previousPosition={x:s.clientX,y:s.clientY},e||s.preventDefault()}}}),this._onMouseMove=i=>{if(!t.isPointerLock)return;let r=this.camera._calculateHandednessMultiplier(),s=i.movementX*r;this.camera.cameraRotation.y+=s/this.angularSensibility;let n=i.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,e||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,o.kD.POINTERDOWN|o.kD.POINTERUP|o.kD.POINTERMOVE),i&&(this._contextMenuBind=e=>this.onContextMenu(e),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){let e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,r.gn)([(0,n.qC)()],l.prototype,"buttons",void 0),(0,r.gn)([(0,n.qC)()],l.prototype,"angularSensibility",void 0),a.u.FreeCameraMouseInput=l},46611:function(e,t,i){i.d(t,{A:function(){return u}});var r,s,n=i(46456),a=i(22287),o=i(94656),h=i(98038),l=i(39884);(r=s||(s={}))[r.MoveRelative=0]="MoveRelative",r[r.RotateRelative=1]="RotateRelative",r[r.MoveScene=2]="MoveScene";class u extends h.Y{constructor(){super(...arguments),this._moveRelative=l.P.Zero(),this._rotateRelative=l.P.Zero(),this._moveScene=l.P.Zero(),this._wheelXAction=s.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=s.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(e){(null!==e||this._wheelXAction===s.MoveRelative)&&(this._wheelXAction=s.MoveRelative,this._wheelXActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==s.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(e){(null!==e||this._wheelYAction===s.MoveRelative)&&(this._wheelYAction=s.MoveRelative,this._wheelYActionCoordinate=e)}get wheelYMoveRelative(){return this._wheelYAction!==s.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(e){(null!==e||this._wheelZAction===s.MoveRelative)&&(this._wheelZAction=s.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==s.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(e){(null!==e||this._wheelXAction===s.RotateRelative)&&(this._wheelXAction=s.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==s.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(e){(null!==e||this._wheelYAction===s.RotateRelative)&&(this._wheelYAction=s.RotateRelative,this._wheelYActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==s.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){(null!==e||this._wheelZAction===s.RotateRelative)&&(this._wheelZAction=s.RotateRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==s.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(e){(null!==e||this._wheelXAction===s.MoveScene)&&(this._wheelXAction=s.MoveScene,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==s.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){(null!==e||this._wheelYAction===s.MoveScene)&&(this._wheelYAction=s.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==s.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(e){(null!==e||this._wheelZAction===s.MoveScene)&&(this._wheelZAction=s.MoveScene,this._wheelZActionCoordinate=e)}get wheelZMoveScene(){return this._wheelZAction!==s.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);let e=l.y3.Zero();this.camera.getViewMatrix().invertToRef(e);let t=l.P.Zero();l.P.TransformNormalToRef(this._moveRelative,e,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,t,i){if(0===e||null===t||null===i)return;let r=null;switch(t){case s.MoveRelative:r=this._moveRelative;break;case s.RotateRelative:r=this._rotateRelative;break;case s.MoveScene:r=this._moveScene}switch(i){case 0:r.set(e,0,0);break;case 1:r.set(0,e,0);break;case 2:r.set(0,0,e)}}}(0,n.gn)([(0,a.qC)()],u.prototype,"wheelXMoveRelative",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelYMoveRelative",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelZMoveRelative",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelXRotateRelative",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelYRotateRelative",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelZRotateRelative",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelXMoveScene",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelYMoveScene",null),(0,n.gn)([(0,a.qC)()],u.prototype,"wheelZMoveScene",null),o.u.FreeCameraMouseWheelInput=u},84374:function(e,t,i){i.d(t,{y:function(){return l}});var r=i(46456),s=i(22287),n=i(94656),a=i(74909),o=i(39884),h=i(4224);class l{constructor(e=!1){this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=[],this._isSafari=h.w1.IsSafari()}attachControl(e){e=h.w1.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{let r=i.event,s="mouse"===r.pointerType||this._isSafari&&void 0===r.pointerType;if(this.allowMouse||!s){if(i.type===a.kD.POINTERDOWN){if(e||r.preventDefault(),this._pointerPressed.push(r.pointerId),1!==this._pointerPressed.length)return;t={x:r.clientX,y:r.clientY}}else if(i.type===a.kD.POINTERUP){e||r.preventDefault();let i=this._pointerPressed.indexOf(r.pointerId);if(-1===i||(this._pointerPressed.splice(i,1),0!=i))return;t=null,this._offsetX=null,this._offsetY=null}else if(i.type===a.kD.POINTERMOVE){if(e||r.preventDefault(),!t||0!=this._pointerPressed.indexOf(r.pointerId))return;this._offsetX=r.clientX-t.x,this._offsetY=-(r.clientY-t.y)}}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,a.kD.POINTERDOWN|a.kD.POINTERUP|a.kD.POINTERMOVE),this._onLostFocus){let e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){let e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY||0===this._offsetX&&0===this._offsetY)return;let e=this.camera,t=e._calculateHandednessMultiplier();if(e.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{let t=e._computeLocalCameraSpeed(),i=new o.P(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);o.y3.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(o.P.TransformCoordinates(i,e._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,r.gn)([(0,s.qC)()],l.prototype,"touchAngularSensibility",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"touchMoveSensibility",void 0),n.u.FreeCameraTouchInput=l},35910:function(e,t,i){i.d(t,{V:function(){return g}});var r=i(46456),s=i(22287),n=i(93287),a=i(4224),o=i(82877),h=i(39884),l=i(67020),u=i(9719),c=i(7724),_=i(10633),d=i(52721),p=i(75300),f=i(90212);class g extends l.N{get position(){return this._position}set position(e){this._position=e}set upVector(e){this._upVector=e}get upVector(){return this._upVector}get screenArea(){let e=0,t=0;if(this.mode===g.PERSPECTIVE_CAMERA)this.fovMode===g.FOVMODE_VERTICAL_FIXED?(t=2*this.minZ*Math.tan(this.fov/2),e=this.getEngine().getAspectRatio(this)*t):t=(e=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{let i=this.getEngine().getRenderWidth()/2,r=this.getEngine().getRenderHeight()/2;e=(this.orthoRight??i)-(this.orthoLeft??-i),t=(this.orthoTop??r)-(this.orthoBottom??-r)}return e*t}set orthoLeft(e){for(let t of(this._orthoLeft=e,this._rigCameras))t.orthoLeft=e}get orthoLeft(){return this._orthoLeft}set orthoRight(e){for(let t of(this._orthoRight=e,this._rigCameras))t.orthoRight=e}get orthoRight(){return this._orthoRight}set orthoBottom(e){for(let t of(this._orthoBottom=e,this._rigCameras))t.orthoBottom=e}get orthoBottom(){return this._orthoBottom}set orthoTop(e){for(let t of(this._orthoTop=e,this._rigCameras))t.orthoTop=e}get orthoTop(){return this._orthoTop}set mode(e){for(let t of(this._mode=e,this._rigCameras))t.mode=e}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(e,t,i,r=!0){super(e,i,!1),this._position=h.P.Zero(),this._upVector=h.P.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=g.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new d.l(0,0,1,1),this.layerMask=268435455,this.fovMode=g.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=g.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new o.y$,this.onProjectionMatrixChangedObservable=new o.y$,this.onAfterCheckInputsObservable=new o.y$,this.onRestoreStateObservable=new o.y$,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=[],this._skipRendering=!1,this._projectionMatrix=new h.y3,this._postProcesses=[],this._activeMeshes=new n.t(256),this._globalPosition=h.P.Zero(),this._computedViewMatrix=h.y3.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=h.y3.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=h._f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),r&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=t,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${e}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}toString(e){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}applyVerticalCorrection(){let e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(e){return -1!==this._activeMeshes.indexOf(e)}isReady(e=!1){if(e){for(let e of this._postProcesses)if(e&&!e.isReady())return!1}return super.isReady(e)}_initCache(){super._initCache(),this._cache.position=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(e){e||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()}_isSynchronizedProjectionMatrix(){let e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;let t=this.getEngine();return this.mode===g.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),this.oblique&&(e=e&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),e}attachControl(e,t){}detachControl(e){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==g.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null}_cascadePostProcessesToRigCams(){let e=this._getFirstPostProcess();e&&e.markTextureDirty();for(let e=0,t=this._rigCameras.length;e<t;e++){let t=this._rigCameras[e],i=t._rigPostProcess;i?("pass"===i.getEffectName()&&(t.isIntermediate=0===this._postProcesses.length),t._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()):t._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(e,t=null){return!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(u.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))}detachPostProcess(e){let t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return h.y3.Identity()}getViewMatrix(e){return!e&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;let t=this.getEngine(),i=this.getScene(),r=t.useReverseDepthBuffer;if(this.mode===g.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),(i.useRightHandedSystem?h.y3.PerspectiveFovRHToRef:h.y3.PerspectiveFovLHToRef)(this.fov,t.getAspectRatio(this),r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===g.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,r);else{let e=t.getRenderWidth()/2,s=t.getRenderHeight()/2;i.useRightHandedSystem?this.oblique?h.y3.ObliqueOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):h.y3.OrthoOffCenterRHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange):this.oblique?h.y3.ObliqueOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):h.y3.OrthoOffCenterLHToRef(this.orthoLeft??-e,this.orthoRight??e,this.orthoBottom??-s,this.orthoTop??s,r?this.maxZ:this.minZ,r?this.minZ:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=this.oblique?.angle,this._cache.obliqueLength=this.oblique?.length,this._cache.obliqueOffset=this.oblique?.offset,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(e){return(this.radius||(this.target?h.P.Distance(this.position,this.target):this.position.length()))+e}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?p.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=p.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(e,t=!1){if(this._updateFrustumPlanes(),!t||!(this.rigCameras.length>0))return e.isInFrustum(this._frustumPlanes);{let t=!1;return this.rigCameras.forEach(i=>{i._updateFrustumPlanes(),t=t||e.isInFrustum(i._frustumPlanes)}),t}}isCompletelyInFrustum(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(e=100,t,i){throw(0,_.S)("Ray")}getForwardRayToRef(e,t=100,i,r){throw(0,_.S)("Ray")}dispose(e,t=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){let e=this._rigCameras.pop();e&&e.dispose()}if(this._parentContainer){let e=this._parentContainer.cameras.indexOf(this);e>-1&&this._parentContainer.cameras.splice(e,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==g.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let e=this._postProcesses.length;for(;--e>=0;){let t=this._postProcesses[e];t&&t.dispose(this)}}let i=this.customRenderTargets.length;for(;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(e,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(e,t){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){let e=this._rigCameras.pop();e&&e.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==g.RIG_MODE_NONE){let e=this.createRigCamera(this.name+"_L",0);e&&(e._isLeftCamera=!0);let t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),e&&t&&(this._rigCameras.push(e),this._rigCameras.push(t))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(e){}_getVRProjectionMatrix(){return h.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=a.w1.ToRadians(t/.0637))}createRigCamera(e,t){return null}_updateRigCameras(){for(let e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===g.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){let e=f.p.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),f.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}clone(e,t=null){let i=f.p.Clone(g.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=t,this.onClonedObservable.notifyObservers(i),i}getDirection(e){let t=h.P.Zero();return this.getDirectionToRef(e,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(e,t){h.P.TransformNormalToRef(e,this.getWorldMatrix(),t)}static GetConstructorFromName(e,t,i,r=0,s=!0){return l.N.Construct(e,t,i,{interaxial_distance:r,isStereoscopicSideBySide:s})||(()=>g._CreateDefaultParsedCamera(t,i))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(e,t){let i=e.type,r=g.GetConstructorFromName(i,e.name,t,e.interaxial_distance,e.isStereoscopicSideBySide),s=f.p.Parse(r,e,t);if(void 0!==e.parentId&&(s._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),s.inputs&&(s.inputs.parse(e),s._setupInputs()),e.upVector&&(s.upVector=h.P.FromArray(e.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(h.P.FromArray(e.position))),e.target&&s.setTarget&&s.setTarget(h.P.FromArray(e.target)),e.cameraRigMode){let t=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};s.setCameraRigMode(e.cameraRigMode,t)}if(e.animations){for(let t=0;t<e.animations.length;t++){let i=e.animations[t],r=(0,c.qw)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}l.N.ParseAnimationRanges(s,e,t)}return e.autoAnimate&&t.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&s.setEnabled(e.isEnabled),s}_calculateHandednessMultiplier(){let e=this.getScene().useRightHandedSystem?-1:1;return this.parent&&0>this.parent._getWorldMatrixDeterminant()&&(e*=-1),e}}g._CreateDefaultParsedCamera=(e,t)=>{throw(0,_.S)("UniversalCamera")},g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_CUSTOM=22,g.ForceAttachControlToAlwaysPreventDefault=!1,(0,r.gn)([(0,s.hd)("position")],g.prototype,"_position",void 0),(0,r.gn)([(0,s.hd)("upVector")],g.prototype,"_upVector",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"orthoLeft",null),(0,r.gn)([(0,s.qC)()],g.prototype,"orthoRight",null),(0,r.gn)([(0,s.qC)()],g.prototype,"orthoBottom",null),(0,r.gn)([(0,s.qC)()],g.prototype,"orthoTop",null),(0,r.gn)([(0,s.qC)()],g.prototype,"fov",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"projectionPlaneTilt",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"minZ",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"maxZ",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"inertia",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"mode",null),(0,r.gn)([(0,s.qC)()],g.prototype,"layerMask",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"fovMode",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"cameraRigMode",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"interaxialDistance",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"isStereoscopicSideBySide",void 0)},94656:function(e,t,i){i.d(t,{p:function(){return o},u:function(){return a}});var r=i(9719),s=i(90212),n=i(35910),a={};class o{constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){let t=e.getSimpleName();if(this.attached[t]){r.Y.Warn("camera input of type "+t+" already exists on camera");return}this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault)}remove(e){for(let t in this.attached){let i=this.attached[t];if(i===e){i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck();return}}}removeByType(e){for(let t in this.attached){let i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}}_addCheckInputs(e){let t=this.checkInputs;return()=>{t(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}attachElement(e=!1){if(!this.attachedToElement)for(let t in e=!n.V.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e,this.attached)this.attached[t].attachControl(e)}detachElement(e=!1){for(let t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){for(let e in this.checkInputs=()=>{},this.attached){let t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){let t={};for(let e in this.attached){let i=this.attached[e],r=s.p.Serialize(i);t[i.getClassName()]=r}e.inputsmgr=t}parse(e){let t=e.inputsmgr;if(t)for(let e in this.clear(),t){let i=a[e];if(i){let r=t[e],n=s.p.Parse(()=>new i,r,null);this.add(n)}}else for(let t in this.attached){let i=a[this.attached[t].getClassName()];if(i){let r=s.p.Parse(()=>new i,e,null);this.remove(this.attached[t]),this.add(r)}}}}},16606:function(e,t,i){i.d(t,{c:function(){return c}});var r=i(46456),s=i(22287),n=i(39884),a=i(91420),o=i(7603),h=i(4224),l=i(7724),u=i(3176);class c extends a.C{get angularSensibility(){let e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set angularSensibility(e){let t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)}get keysUp(){let e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){let t=this.inputs.attached.keyboard;t&&(t.keysUp=e)}get keysUpward(){let e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUpward(e){let t=this.inputs.attached.keyboard;t&&(t.keysUpward=e)}get keysDown(){let e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){let t=this.inputs.attached.keyboard;t&&(t.keysDown=e)}get keysDownward(){let e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set keysDownward(e){let t=this.inputs.attached.keyboard;t&&(t.keysDownward=e)}get keysLeft(){let e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){let t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)}get keysRight(){let e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){let t=this.inputs.attached.keyboard;t&&(t.keysRight=e)}get keysRotateLeft(){let e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}set keysRotateLeft(e){let t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=e)}get keysRotateRight(){let e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysRotateRight(e){let t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=e)}get keysRotateUp(){let e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}set keysRotateUp(e){let t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=e)}get keysRotateDown(){let e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}set keysRotateDown(e){let t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=e)}constructor(e,t,i,r=!0){super(e,t,i,r),this.ellipsoid=new n.P(.5,1,.5),this.ellipsoidOffset=new n.P(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.P.Zero(),this._diffPosition=n.P.Zero(),this._newPosition=n.P.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(e,t,i=null)=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>u.a.CollisionsEpsilon&&(this.position.addToRef(this._diffPosition,this._deferredPositionUpdate),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate),this.onCollide&&i&&this.onCollide(i))},this.inputs=new o.a(this),this.inputs.addKeyboard().addMouse()}attachControl(e,t){t=h.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new n.P(0,0,0),this.cameraRotation=new n.FM(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}_collideWithWorld(e){(this.parent?n.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);let t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let i=e;this.applyGravity&&(i=e.add(this.getScene().gravity)),t.getNewPosition(this._oldPosition,i,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.P.Zero(),this._transformedDirection=n.P.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(e){this._needMoveForGravity=e}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,r.gn)([(0,s.hd)()],c.prototype,"ellipsoid",void 0),(0,r.gn)([(0,s.hd)()],c.prototype,"ellipsoidOffset",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"checkCollisions",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"applyGravity",void 0),(0,l.H7)("BABYLON.FreeCamera",c)},7603:function(e,t,i){i.d(t,{a:function(){return h}});var r=i(94656),s=i(32067),n=i(42523),a=i(46611),o=i(84374);class h extends r.p{constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new s.Y),this}addMouse(e=!0){return this._mouseInput||(this._mouseInput=new n.A(e),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new a.A,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new o.y),this}clear(){super.clear(),this._mouseInput=null}}},91420:function(e,t,i){i.d(t,{C:function(){return l}});var r=i(46456),s=i(22287),n=i(35910),a=i(39884),o=i(31644),h=i(50154);i(67020).N.AddNodeConstructor("TargetCamera",(e,t)=>()=>new l(e,a.P.Zero(),t));class l extends n.V{constructor(e,t,i,r=!0){super(e,t,i,r),this._tmpUpVector=a.P.Zero(),this._tmpTargetVector=a.P.Zero(),this.cameraDirection=new a.P(0,0,0),this.cameraRotation=new a.FM(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new a._f,this.rotation=new a.P(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=a.P.Zero(),this._initialFocalDistance=1,this._viewMatrix=a.y3.Zero(),this._camMatrix=a.y3.Zero(),this._cameraTransformMatrix=a.y3.Zero(),this._cameraRotationMatrix=a.y3.Zero(),this._referencePoint=new a.P(0,0,1),this._transformedReferencePoint=a.P.Zero(),this._deferredPositionUpdate=new a.P,this._deferredRotationQuaternionUpdate=new a._f,this._deferredRotationUpdate=new a.P,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=a.P.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(e){this.getWorldMatrix();let t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){let e=this.lockedTarget;e.computeWorldMatrix().getTranslationToRef(e.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new a.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new a.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new a._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(e){e||super._updateCache();let t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;let e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){let e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))}setTarget(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=o.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),a.y3.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);let t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&a._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent){this.parent.getWorldMatrix().invertToRef(a.jp.Matrix[0]),a.P.TransformNormalToRef(this.cameraDirection,a.jp.Matrix[0],a.jp.Vector3[0]),this._deferredPositionUpdate.addInPlace(a.jp.Vector3[0]),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate);return}this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_checkInputs(){let e=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),i=this.cameraRotation.x||this.cameraRotation.y;this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),t&&this._updatePosition(),i&&(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*e,this._deferredRotationUpdate.y+=this.cameraRotation.y*e,!this.noRotationConstraint&&(this._deferredRotationUpdate.x>1.570796&&(this._deferredRotationUpdate.x=1.570796),this._deferredRotationUpdate.x<-1.570796&&(this._deferredRotationUpdate.x=-1.570796)),this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion&&this._deferredRotationUpdate.lengthSquared()&&(a._f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))),t&&(Math.abs(this.cameraDirection.x)<this.speed*o.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*o.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*o.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*o.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*o.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):a.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return a.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),a.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(a._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),h.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(e,t,i){if(this.ignoreParentScaling){if(this.parent){let r=this.parent.getWorldMatrix();a.P.TransformCoordinatesToRef(e,r,this._globalPosition),a.P.TransformCoordinatesToRef(t,r,this._tmpTargetVector),a.P.TransformNormalToRef(i,r,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(t),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?a.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):a.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);return}if(this.getScene().useRightHandedSystem?a.y3.LookAtRHToRef(e,t,i,this._viewMatrix):a.y3.LookAtLHToRef(e,t,i,this._viewMatrix),this.parent){let e=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(e,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)}createRigCamera(e,t){if(this.cameraRigMode!==n.V.RIG_MODE_NONE){let t=new l(e,this.position.clone(),this.getScene());return t.isRigCamera=!0,t.rigParent=this,this.cameraRigMode===n.V.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new a._f),t._cameraRigParams={},t.rotationQuaternion=new a._f),t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoTop=this.orthoTop,t.orthoBottom=this.orthoBottom,t}return null}_updateRigCameras(){let e=this._rigCameras[0],t=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case n.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case n.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.V.RIG_MODE_STEREOSCOPIC_INTERLACED:{let i=this.cameraRigMode===n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t);break}case n.V.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),t.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),t.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),t.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(e,t){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);let i=l._TargetFocalPoint.addInPlace(this.position);a.y3.TranslationToRef(-i.x,-i.y,-i.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(a.y3.RotationAxis(t.upVector,e),l._RigCamTransformMatrix),a.y3.TranslationToRef(i.x,i.y,i.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),a.P.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,t.position),t.setTarget(i)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new a.y3,l._TargetTransformMatrix=new a.y3,l._TargetFocalPoint=new a.P,(0,r.gn)([(0,s.hd)()],l.prototype,"rotation",void 0),(0,r.gn)([(0,s.qC)()],l.prototype,"speed",void 0),(0,r.gn)([(0,s.RR)("lockedTargetId")],l.prototype,"lockedTarget",void 0)},13306:function(e,t,i){i.d(t,{c:function(){return r}});class r{constructor(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}}},88251:function(e,t,i){i.d(t,{p:function(){return n}});var r=i(39884),s=i(93954);class n{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(e=!1,t=!0){let i;if(!this.pickedMesh||t&&!this.pickedMesh.isVerticesDataPresent(s.o.NormalKind))return null;let n=this.pickedMesh.getIndices();n?.length===0&&(n=null);let a=r.jp.Vector3[0],o=r.jp.Vector3[1],h=r.jp.Vector3[2];if(t){let e=this.pickedMesh.getVerticesData(s.o.NormalKind),t=n?r.P.FromArrayToRef(e,3*n[3*this.faceId],a):a.copyFromFloats(e[9*this.faceId],e[9*this.faceId+1],e[9*this.faceId+2]),l=n?r.P.FromArrayToRef(e,3*n[3*this.faceId+1],o):o.copyFromFloats(e[(3*this.faceId+1)*3],e[(3*this.faceId+1)*3+1],e[(3*this.faceId+1)*3+2]),u=n?r.P.FromArrayToRef(e,3*n[3*this.faceId+2],h):h.copyFromFloats(e[(3*this.faceId+2)*3],e[(3*this.faceId+2)*3+1],e[(3*this.faceId+2)*3+2]);t=t.scale(this.bu),l=l.scale(this.bv),u=u.scale(1-this.bu-this.bv),i=new r.P(t.x+l.x+u.x,t.y+l.y+u.y,t.z+l.z+u.z)}else{let e=this.pickedMesh.getVerticesData(s.o.PositionKind),t=n?r.P.FromArrayToRef(e,3*n[3*this.faceId],a):a.copyFromFloats(e[9*this.faceId],e[9*this.faceId+1],e[9*this.faceId+2]),l=n?r.P.FromArrayToRef(e,3*n[3*this.faceId+1],o):o.copyFromFloats(e[(3*this.faceId+1)*3],e[(3*this.faceId+1)*3+1],e[(3*this.faceId+1)*3+2]),u=n?r.P.FromArrayToRef(e,3*n[3*this.faceId+2],h):h.copyFromFloats(e[(3*this.faceId+2)*3],e[(3*this.faceId+2)*3+1],e[(3*this.faceId+2)*3+2]),c=t.subtract(l),_=u.subtract(l);i=r.P.Cross(c,_)}let l=(e,t)=>{let i=e.getWorldMatrix();e.nonUniformScaling&&(r.jp.Matrix[0].copyFrom(i),(i=r.jp.Matrix[0]).setTranslationFromFloats(0,0,0),i.invert(),i.transposeToRef(r.jp.Matrix[1]),i=r.jp.Matrix[1]),r.P.TransformNormalToRef(t,i,t)};if(e&&l(this.pickedMesh,i),this.ray){let t=r.jp.Vector3[0].copyFrom(i);e||l(this.pickedMesh,t),r.P.Dot(t,this.ray.direction)>0&&i.negateInPlace()}return i.normalize(),i}getTextureCoordinates(e=s.o.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e))return null;let t=this.pickedMesh.getIndices();if(!t)return null;let i=this.pickedMesh.getVerticesData(e);if(!i)return null;let n=r.FM.FromArray(i,2*t[3*this.faceId]),a=r.FM.FromArray(i,2*t[3*this.faceId+1]),o=r.FM.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(this.bu),a=a.scale(this.bv),o=o.scale(1-this.bu-this.bv),new r.FM(n.x+a.x+o.x,n.y+a.y+o.y)}}},77210:function(e,t,i){i.d(t,{VJ:function(){return r}});let r=!1},58044:function(e,t,i){i.d(t,{k:function(){return a}});var r=i(178),s=i(39884),n=i(31644);class a{constructor(e,t,i){this.vectors=(0,r.$G)(8,s.P.Zero),this.center=s.P.Zero(),this.centerWorld=s.P.Zero(),this.extendSize=s.P.Zero(),this.extendSizeWorld=s.P.Zero(),this.directions=(0,r.$G)(3,s.P.Zero),this.vectorsWorld=(0,r.$G)(8,s.P.Zero),this.minimumWorld=s.P.Zero(),this.maximumWorld=s.P.Zero(),this.minimum=s.P.Zero(),this.maximum=s.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,i)}reConstruct(e,t,i){let r=e.x,n=e.y,a=e.z,o=t.x,h=t.y,l=t.z,u=this.vectors;this.minimum.copyFromFloats(r,n,a),this.maximum.copyFromFloats(o,h,l),u[0].copyFromFloats(r,n,a),u[1].copyFromFloats(o,h,l),u[2].copyFromFloats(o,n,a),u[3].copyFromFloats(r,h,a),u[4].copyFromFloats(r,n,l),u[5].copyFromFloats(o,h,a),u[6].copyFromFloats(r,h,l),u[7].copyFromFloats(o,n,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||s.y3.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){let t=a._TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),r=i.length();i.normalizeFromLength(r);let s=r*e,n=i.scaleInPlace(.5*s),o=this.center.subtractToRef(n,t[1]),h=this.center.addToRef(n,t[2]);return this.reConstruct(o,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){let t=this.minimumWorld,i=this.maximumWorld,r=this.directions,n=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let e=0;e<8;++e)n[e].copyFrom(a[e]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let r=0;r<8;++r){let o=n[r];s.P.TransformCoordinatesToRef(a[r],e,o),t.minimizeInPlace(o),i.maximizeInPlace(o)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}s.P.FromArrayToRef(e.m,0,r[0]),s.P.FromArrayToRef(e.m,4,r[1]),s.P.FromArrayToRef(e.m,8,r[2]),this._worldMatrix=e}isInFrustum(e){return a.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return a.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){let t=this.minimumWorld,i=this.maximumWorld,r=t.x,s=t.y,a=t.z,o=i.x,h=i.y,l=i.z,u=e.x,c=e.y,_=e.z,d=-n.kn;return!(o-u<d)&&!(d>u-r)&&!(h-c<d)&&!(d>c-s)&&!(l-_<d)&&!(d>_-a)}intersectsSphere(e){return a.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,t){let i=this.minimumWorld,r=this.maximumWorld,s=i.x,n=i.y,a=i.z,o=r.x,h=r.y,l=r.z,u=e.x,c=e.y,_=e.z,d=t.x,p=t.y,f=t.z;return!(o<u)&&!(s>d)&&!(h<c)&&!(n>p)&&!(l<_)&&!(a>f)}dispose(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}static Intersects(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(e,t,i,r){let n=a._TmpVector3[0];return s.P.ClampToRef(i,e,t,n),s.P.DistanceSquared(i,n)<=r*r}static IsCompletelyInFrustum(e,t){for(let i=0;i<6;++i){let r=t[i];for(let t=0;t<8;++t)if(0>r.dotCoordinate(e[t]))return!1}return!0}static IsInFrustum(e,t){for(let i=0;i<6;++i){let r=!0,s=t[i];for(let t=0;t<8;++t)if(s.dotCoordinate(e[t])>=0){r=!1;break}if(r)return!1}return!0}}a._TmpVector3=(0,r.$G)(3,s.P.Zero)},29892:function(e,t,i){i.d(t,{j:function(){return c}});var r=i(178),s=i(39884),n=i(58044),a=i(9939);let o={min:0,max:0},h={min:0,max:0},l=(e,t,i)=>{let r=s.P.Dot(t.centerWorld,e),n=Math.abs(s.P.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(s.P.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(s.P.Dot(t.directions[2],e))*t.extendSize.z;i.min=r-n,i.max=r+n},u=(e,t,i)=>(l(e,t,o),l(e,i,h),!(o.min>h.max||h.min>o.max));class c{constructor(e,t,i){this._isLocked=!1,this.boundingBox=new n.k(e,t,i),this.boundingSphere=new a.K(e,t,i)}reConstruct(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,t){let i=c._TmpVector3[0].copyFrom(e).subtractInPlace(t),r=c._TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this}encapsulate(e){let t=s.P.Minimize(this.minimum,e),i=s.P.Maximize(this.maximum,e);return this.reConstruct(t,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){let t=s.jp.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);let i=s.jp.Vector3[0];return s.P.TransformCoordinatesToRef(e.boundingBox.minimumWorld,t,i),this.encapsulate(i),s.P.TransformCoordinatesToRef(e.boundingBox.maximumWorld,t,i),this.encapsulate(i),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e,t=0){return!!((2===t||3===t)&&this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(1===t||3===t||this.boundingBox.isInFrustum(e))}get diagonalLength(){let e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,c._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!!(this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e))}intersects(e,t){if(!a.K.Intersects(this.boundingSphere,e.boundingSphere)||!n.k.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;let i=this.boundingBox,r=e.boundingBox;return!!(u(i.directions[0],i,r)&&u(i.directions[1],i,r)&&u(i.directions[2],i,r)&&u(r.directions[0],i,r)&&u(r.directions[1],i,r)&&u(r.directions[2],i,r)&&u(s.P.Cross(i.directions[0],r.directions[0]),i,r)&&u(s.P.Cross(i.directions[0],r.directions[1]),i,r)&&u(s.P.Cross(i.directions[0],r.directions[2]),i,r)&&u(s.P.Cross(i.directions[1],r.directions[0]),i,r)&&u(s.P.Cross(i.directions[1],r.directions[1]),i,r)&&u(s.P.Cross(i.directions[1],r.directions[2]),i,r)&&u(s.P.Cross(i.directions[2],r.directions[0]),i,r)&&u(s.P.Cross(i.directions[2],r.directions[1]),i,r)&&u(s.P.Cross(i.directions[2],r.directions[2]),i,r))}}c._TmpVector3=(0,r.$G)(2,s.P.Zero)},9939:function(e,t,i){i.d(t,{K:function(){return n}});var r=i(178),s=i(39884);class n{constructor(e,t,i){this.center=s.P.Zero(),this.centerWorld=s.P.Zero(),this.minimum=s.P.Zero(),this.maximum=s.P.Zero(),this.reConstruct(e,t,i)}reConstruct(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);let r=s.P.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*r,this._update(i||s.y3.IdentityReadOnly)}scale(e){let t=this.radius*e,i=n._TmpVector3,r=i[0].setAll(t),s=this.center.subtractToRef(r,i[1]),a=this.center.addToRef(r,i[2]);return this.reConstruct(s,a,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{s.P.TransformCoordinatesToRef(this.center,e,this.centerWorld);let t=n._TmpVector3[0];s.P.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(e){let t=this.centerWorld,i=this.radiusWorld;for(let r=0;r<6;r++)if(e[r].dotCoordinate(t)<=-i)return!1;return!0}isCenterInFrustum(e){let t=this.centerWorld;for(let i=0;i<6;i++)if(0>e[i].dotCoordinate(t))return!1;return!0}intersectsPoint(e){let t=s.P.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(e,t){let i=s.P.DistanceSquared(e.centerWorld,t.centerWorld),r=e.radiusWorld+t.radiusWorld;return!(r*r<i)}static CreateFromCenterAndRadius(e,t,i){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,t),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);let r=new n(this._TmpVector3[0],this._TmpVector3[2]);return i?r._worldMatrix=i:r._worldMatrix=s.y3.Identity(),r}}n._TmpVector3=(0,r.$G)(3,s.P.Zero)},78383:function(e,t,i){var r,s,n,a,o,h,l,u,c,_,d,p,f,g;i.d(t,{Fz:function(){return s},Yi:function(){return r}}),(u=r||(r={}))[u.Generic=0]="Generic",u[u.Keyboard=1]="Keyboard",u[u.Mouse=2]="Mouse",u[u.Touch=3]="Touch",u[u.DualShock=4]="DualShock",u[u.Xbox=5]="Xbox",u[u.Switch=6]="Switch",u[u.DualSense=7]="DualSense",(c=s||(s={}))[c.Horizontal=0]="Horizontal",c[c.Vertical=1]="Vertical",c[c.LeftClick=2]="LeftClick",c[c.MiddleClick=3]="MiddleClick",c[c.RightClick=4]="RightClick",c[c.BrowserBack=5]="BrowserBack",c[c.BrowserForward=6]="BrowserForward",c[c.MouseWheelX=7]="MouseWheelX",c[c.MouseWheelY=8]="MouseWheelY",c[c.MouseWheelZ=9]="MouseWheelZ",c[c.Move=12]="Move",(_=n||(n={}))[_.Horizontal=0]="Horizontal",_[_.Vertical=1]="Vertical",_[_.LeftClick=2]="LeftClick",_[_.MiddleClick=3]="MiddleClick",_[_.RightClick=4]="RightClick",_[_.BrowserBack=5]="BrowserBack",_[_.BrowserForward=6]="BrowserForward",_[_.MouseWheelX=7]="MouseWheelX",_[_.MouseWheelY=8]="MouseWheelY",_[_.MouseWheelZ=9]="MouseWheelZ",_[_.DeltaHorizontal=10]="DeltaHorizontal",_[_.DeltaVertical=11]="DeltaVertical",(d=a||(a={}))[d.Cross=0]="Cross",d[d.Circle=1]="Circle",d[d.Square=2]="Square",d[d.Triangle=3]="Triangle",d[d.L1=4]="L1",d[d.R1=5]="R1",d[d.L2=6]="L2",d[d.R2=7]="R2",d[d.Share=8]="Share",d[d.Options=9]="Options",d[d.L3=10]="L3",d[d.R3=11]="R3",d[d.DPadUp=12]="DPadUp",d[d.DPadDown=13]="DPadDown",d[d.DPadLeft=14]="DPadLeft",d[d.DPadRight=15]="DPadRight",d[d.Home=16]="Home",d[d.TouchPad=17]="TouchPad",d[d.LStickXAxis=18]="LStickXAxis",d[d.LStickYAxis=19]="LStickYAxis",d[d.RStickXAxis=20]="RStickXAxis",d[d.RStickYAxis=21]="RStickYAxis",(p=o||(o={}))[p.Cross=0]="Cross",p[p.Circle=1]="Circle",p[p.Square=2]="Square",p[p.Triangle=3]="Triangle",p[p.L1=4]="L1",p[p.R1=5]="R1",p[p.L2=6]="L2",p[p.R2=7]="R2",p[p.Create=8]="Create",p[p.Options=9]="Options",p[p.L3=10]="L3",p[p.R3=11]="R3",p[p.DPadUp=12]="DPadUp",p[p.DPadDown=13]="DPadDown",p[p.DPadLeft=14]="DPadLeft",p[p.DPadRight=15]="DPadRight",p[p.Home=16]="Home",p[p.TouchPad=17]="TouchPad",p[p.LStickXAxis=18]="LStickXAxis",p[p.LStickYAxis=19]="LStickYAxis",p[p.RStickXAxis=20]="RStickXAxis",p[p.RStickYAxis=21]="RStickYAxis",(f=h||(h={}))[f.A=0]="A",f[f.B=1]="B",f[f.X=2]="X",f[f.Y=3]="Y",f[f.LB=4]="LB",f[f.RB=5]="RB",f[f.LT=6]="LT",f[f.RT=7]="RT",f[f.Back=8]="Back",f[f.Start=9]="Start",f[f.LS=10]="LS",f[f.RS=11]="RS",f[f.DPadUp=12]="DPadUp",f[f.DPadDown=13]="DPadDown",f[f.DPadLeft=14]="DPadLeft",f[f.DPadRight=15]="DPadRight",f[f.Home=16]="Home",f[f.LStickXAxis=17]="LStickXAxis",f[f.LStickYAxis=18]="LStickYAxis",f[f.RStickXAxis=19]="RStickXAxis",f[f.RStickYAxis=20]="RStickYAxis",(g=l||(l={}))[g.B=0]="B",g[g.A=1]="A",g[g.Y=2]="Y",g[g.X=3]="X",g[g.L=4]="L",g[g.R=5]="R",g[g.ZL=6]="ZL",g[g.ZR=7]="ZR",g[g.Minus=8]="Minus",g[g.Plus=9]="Plus",g[g.LS=10]="LS",g[g.RS=11]="RS",g[g.DPadUp=12]="DPadUp",g[g.DPadDown=13]="DPadDown",g[g.DPadLeft=14]="DPadLeft",g[g.DPadRight=15]="DPadRight",g[g.Home=16]="Home",g[g.Capture=17]="Capture",g[g.LStickXAxis=18]="LStickXAxis",g[g.LStickYAxis=19]="LStickYAxis",g[g.RStickXAxis=20]="RStickXAxis",g[g.RStickYAxis=21]="RStickYAxis"},1244:function(e,t,i){i.d(t,{p:function(){return s}});var r=i(82877);class s{constructor(e,t,i=0){this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new r.y$,this._deviceInputSystem=e}getInput(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)}}},14286:function(e,t,i){i.d(t,{U:function(){return p}});var r=i(78383),s=i(82877),n=i(66508);class a{static CreateDeviceEvent(e,t,i,s,n,a,o){switch(e){case r.Yi.Keyboard:return this._CreateKeyboardEvent(i,s,n,a);case r.Yi.Mouse:if(i===r.Fz.MouseWheelX||i===r.Fz.MouseWheelY||i===r.Fz.MouseWheelZ)return this._CreateWheelEvent(e,t,i,s,n,a);case r.Yi.Touch:return this._CreatePointerEvent(e,t,i,s,n,a,o);default:throw`Unable to generate event for device ${r.Yi[e]}`}}static _CreatePointerEvent(e,t,i,s,n,a,o){let h;let l=this._CreateMouseEvent(e,t,i,s,n,a);return e===r.Yi.Mouse?(l.deviceType=r.Yi.Mouse,l.pointerId=1,l.pointerType="mouse"):(l.deviceType=r.Yi.Touch,l.pointerId=o??t,l.pointerType="touch"),h=0+n.pollInput(e,t,r.Fz.LeftClick)+2*n.pollInput(e,t,r.Fz.RightClick)+4*n.pollInput(e,t,r.Fz.MiddleClick),l.buttons=h,i===r.Fz.Move?l.type="pointermove":i>=r.Fz.LeftClick&&i<=r.Fz.RightClick&&(l.type=1===s?"pointerdown":"pointerup",l.button=i-2),l}static _CreateWheelEvent(e,t,i,s,a,o){let h=this._CreateMouseEvent(e,t,i,s,a,o);switch(h.pointerId=1,h.type="wheel",h.deltaMode=n.G.DOM_DELTA_PIXEL,h.deltaX=0,h.deltaY=0,h.deltaZ=0,i){case r.Fz.MouseWheelX:h.deltaX=s;break;case r.Fz.MouseWheelY:h.deltaY=s;break;case r.Fz.MouseWheelZ:h.deltaZ=s}return h}static _CreateMouseEvent(e,t,i,s,n,a){let o=this._CreateEvent(a),h=n.pollInput(e,t,r.Fz.Horizontal),l=n.pollInput(e,t,r.Fz.Vertical);return a?(o.movementX=0,o.movementY=0,o.offsetX=o.movementX-a.getBoundingClientRect().x,o.offsetY=o.movementY-a.getBoundingClientRect().y):(o.movementX=n.pollInput(e,t,10),o.movementY=n.pollInput(e,t,11),o.offsetX=0,o.offsetY=0),this._CheckNonCharacterKeys(o,n),o.clientX=h,o.clientY=l,o.x=h,o.y=l,o.deviceType=e,o.deviceSlot=t,o.inputIndex=i,o}static _CreateKeyboardEvent(e,t,i,s){let n=this._CreateEvent(s);return this._CheckNonCharacterKeys(n,i),n.deviceType=r.Yi.Keyboard,n.deviceSlot=0,n.inputIndex=e,n.type=1===t?"keydown":"keyup",n.key=String.fromCharCode(e),n.keyCode=e,n}static _CheckNonCharacterKeys(e,t){let i=t.isDeviceAvailable(r.Yi.Keyboard),s=i&&1===t.pollInput(r.Yi.Keyboard,0,18),n=i&&1===t.pollInput(r.Yi.Keyboard,0,17),a=i&&(1===t.pollInput(r.Yi.Keyboard,0,91)||1===t.pollInput(r.Yi.Keyboard,0,92)||1===t.pollInput(r.Yi.Keyboard,0,93)),o=i&&1===t.pollInput(r.Yi.Keyboard,0,16);e.altKey=s,e.ctrlKey=n,e.metaKey=a,e.shiftKey=o}static _CreateEvent(e){let t={};return t.preventDefault=()=>{},t.target=e,t}}class o{constructor(e,t,i){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,(e,t,r,s)=>{let n=a.CreateDeviceEvent(e,t,r,s,this);i(e,t,n)}):this._createDummyNativeInput()}pollInput(e,t,i){return this._nativeInput.pollInput(e,t,i)}isDeviceAvailable(e){return e===r.Yi.Mouse||e===r.Yi.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}var h=i(28143),l=i(4224);let u=Object.keys(r.Fz).length/2;class c{constructor(e,t,i,r){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=l.w1.IsSafari(),this._usingMacOS=(0,h.up)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=e=>{},this._keyboardUpEvent=e=>{},this._keyboardBlurEvent=e=>{},this._pointerMoveEvent=e=>{},this._pointerDownEvent=e=>{},this._pointerUpEvent=e=>{},this._pointerCancelEvent=e=>{},this._pointerWheelEvent=e=>{},this._pointerBlurEvent=e=>{},this._pointerMacOSChromeOutEvent=e=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,h.up)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,h.up)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=e=>{},this._gamepadDisconnectedEvent=e=>{},this._eventPrefix=l.w1.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=r,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(e,t,i){let s=this._inputs[e][t];if(!s)throw`Unable to find device ${r.Yi[e]}`;e>=r.Yi.DualShock&&e<=r.Yi.DualSense&&this._updateDevice(e,t,i);let n=s[i];if(void 0===n)throw`Unable to find input ${i} for device ${r.Yi[e]} in slot ${t}`;return i===r.Fz.Move&&l.w1.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),n}isDeviceAvailable(e){return void 0!==this._inputs[e]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){let e=this?._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs){for(let e of this._inputs)if(e)for(let t in e){let i=e[+t];if(i)for(let e=0;e<i.length;e++)i[e]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads)for(let e of navigator.getGamepads())e&&this._addGamePad(e);"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(r.Yi.Mouse,0,0,0)}_addGamePad(e){let t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t}_addPointerDevice(e,t,i,r){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,u);let s=this._inputs[e][t];s[0]=i,s[1]=r}_registerDevice(e,t,i){if(void 0===t)throw`Unable to register device ${r.Yi[e]} to undefined slot.`;if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){let r=Array(i);r.fill(0),this._inputs[e][t]=r,this._onDeviceConnected(e,t)}}_unregisterDevice(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))}_handleKeyActions(){this._keyboardDownEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(r.Yi.Keyboard,0,255));let t=this._inputs[r.Yi.Keyboard][0];t&&(t[e.keyCode]=1,e.inputIndex=e.keyCode,this._usingMacOS&&e.metaKey&&"Meta"!==e.key&&!this._metaKeys.includes(e.keyCode)&&this._metaKeys.push(e.keyCode),this._onInputChanged(r.Yi.Keyboard,0,e))},this._keyboardUpEvent=e=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(r.Yi.Keyboard,0,255));let t=this._inputs[r.Yi.Keyboard][0];if(t){if(t[e.keyCode]=0,e.inputIndex=e.keyCode,this._usingMacOS&&"Meta"===e.key&&this._metaKeys.length>0){for(let e of this._metaKeys){let i=a.CreateDeviceEvent(r.Yi.Keyboard,0,e,0,this,this._elementToAttachTo);t[e]=0,this._onInputChanged(r.Yi.Keyboard,0,i)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(r.Yi.Keyboard,0,e)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){let e=this._inputs[r.Yi.Keyboard][0];for(let t=0;t<e.length;t++)if(0!==e[t]){e[t]=0;let i=a.CreateDeviceEvent(r.Yi.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(r.Yi.Keyboard,0,i)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,h.up)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=Array(this._maxTouchPoints));for(let e=0;e<this._maxTouchPoints;e++)this._activeTouchIds[e]=-1;this._pointerMoveEvent=e=>{let t=this._getPointerType(e),i=t===r.Yi.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===r.Yi.Touch&&-1===i){let r=this._activeTouchIds.indexOf(-1);if(r>=0)i=r,this._activeTouchIds[r]=e.pointerId,this._onDeviceConnected(t,i);else{l.w1.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);return}}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]||this._addPointerDevice(t,i,e.clientX,e.clientY);let s=this._inputs[t][i];s&&(e.inputIndex=r.Fz.Move,s[r.Fz.Horizontal]=e.clientX,s[r.Fz.Vertical]=e.clientY,t===r.Yi.Touch&&0===s[r.Fz.LeftClick]&&(s[r.Fz.LeftClick]=1),void 0===e.pointerId&&(e.pointerId=this._mouseId),this._onInputChanged(t,i,e),this._usingSafari||-1===e.button||(e.inputIndex=e.button+2,s[e.button+2]=s[e.button+2]?0:1,this._onInputChanged(t,i,e)))},this._pointerDownEvent=e=>{let t=this._getPointerType(e),i=t===r.Yi.Mouse?0:e.pointerId;if(t===r.Yi.Touch){let t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t&&(t=this._activeTouchIds.indexOf(-1)),t>=0)i=t,this._activeTouchIds[t]=e.pointerId;else{l.w1.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);return}}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][i]?t===r.Yi.Touch&&this._onDeviceConnected(t,i):this._addPointerDevice(t,i,e.clientX,e.clientY);let s=this._inputs[t][i];if(s){let n=s[r.Fz.Horizontal],a=s[r.Fz.Vertical];if(t===r.Yi.Mouse){if(void 0===e.pointerId&&(e.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(e){}}else if(e.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(e.pointerId)}catch(e){}s[r.Fz.Horizontal]=e.clientX,s[r.Fz.Vertical]=e.clientY,s[e.button+2]=1,e.inputIndex=e.button+2,this._onInputChanged(t,i,e),(n!==e.clientX||a!==e.clientY)&&(e.inputIndex=r.Fz.Move,this._onInputChanged(t,i,e))}},this._pointerUpEvent=e=>{let t=this._getPointerType(e),i=t===r.Yi.Mouse?0:this._activeTouchIds.indexOf(e.pointerId);if(t===r.Yi.Touch){if(-1===i)return;this._activeTouchIds[i]=-1}let s=this._inputs[t]?.[i];if(s&&0!==s[e.button+2]){let n=s[r.Fz.Horizontal],a=s[r.Fz.Vertical];s[r.Fz.Horizontal]=e.clientX,s[r.Fz.Vertical]=e.clientY,s[e.button+2]=0,void 0===e.pointerId&&(e.pointerId=this._mouseId),(n!==e.clientX||a!==e.clientY)&&(e.inputIndex=r.Fz.Move,this._onInputChanged(t,i,e)),e.inputIndex=e.button+2,t===r.Yi.Mouse&&this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):e.pointerId&&this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._onInputChanged(t,i,e),t===r.Yi.Touch&&this._onDeviceDisconnected(t,i)}},this._pointerCancelEvent=e=>{if("mouse"===e.pointerType){let e=this._inputs[r.Yi.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=r.Fz.LeftClick;t<=r.Fz.BrowserForward;t++)if(1===e[t]){e[t]=0;let i=a.CreateDeviceEvent(r.Yi.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(r.Yi.Mouse,0,i)}}else{let t=this._activeTouchIds.indexOf(e.pointerId);if(-1===t)return;this._elementToAttachTo.hasPointerCapture?.(e.pointerId)&&this._elementToAttachTo.releasePointerCapture(e.pointerId),this._inputs[r.Yi.Touch][t][r.Fz.LeftClick]=0;let i=a.CreateDeviceEvent(r.Yi.Touch,t,r.Fz.LeftClick,0,this,this._elementToAttachTo,e.pointerId);this._onInputChanged(r.Yi.Touch,t,i),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(r.Yi.Touch,t)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let e=!1,t=function(){};try{let i=Object.defineProperty({},"passive",{get:function(){e=!0}});this._elementToAttachTo.addEventListener("test",t,i),this._elementToAttachTo.removeEventListener("test",t,i)}catch(e){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(r.Yi.Mouse)){let e=this._inputs[r.Yi.Mouse][0];this._mouseId>=0&&this._elementToAttachTo.hasPointerCapture?.(this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=r.Fz.LeftClick;t<=r.Fz.BrowserForward;t++)if(1===e[t]){e[t]=0;let i=a.CreateDeviceEvent(r.Yi.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(r.Yi.Mouse,0,i)}}if(this.isDeviceAvailable(r.Yi.Touch)){let e=this._inputs[r.Yi.Touch];for(let t=0;t<this._activeTouchIds.length;t++){let i=this._activeTouchIds[t];if(this._elementToAttachTo.hasPointerCapture?.(i)&&this._elementToAttachTo.releasePointerCapture(i),-1!==i&&e[t]?.[r.Fz.LeftClick]===1){e[t][r.Fz.LeftClick]=0;let s=a.CreateDeviceEvent(r.Yi.Touch,t,r.Fz.LeftClick,0,this,this._elementToAttachTo,i);this._onInputChanged(r.Yi.Touch,t,s),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(r.Yi.Touch,t)}}}},this._pointerWheelEvent=e=>{let t=r.Yi.Mouse;this._inputs[t]||(this._inputs[t]=[]),this._inputs[t][0]||(this._pointerActive=!0,this._registerDevice(t,0,u));let i=this._inputs[t][0];i&&(i[r.Fz.MouseWheelX]=e.deltaX||0,i[r.Fz.MouseWheelY]=e.deltaY||e.wheelDelta||0,i[r.Fz.MouseWheelZ]=e.deltaZ||0,void 0===e.pointerId&&(e.pointerId=this._mouseId),0!==i[r.Fz.MouseWheelX]&&(e.inputIndex=r.Fz.MouseWheelX,this._onInputChanged(t,0,e)),0!==i[r.Fz.MouseWheelY]&&(e.inputIndex=r.Fz.MouseWheelY,this._onInputChanged(t,0,e)),0!==i[r.Fz.MouseWheelZ]&&(e.inputIndex=r.Fz.MouseWheelZ,this._onInputChanged(t,0,e)))},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=e=>{e.buttons>1&&this._pointerCancelEvent(e)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!e&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(()=>{if(this.isDeviceAvailable(r.Yi.Mouse)){let e=this._inputs[r.Yi.Mouse][0];e[r.Fz.MouseWheelX]=0,e[r.Fz.MouseWheelY]=0,e[r.Fz.MouseWheelZ]=0}})}_handleGamepadActions(){this._gamepadConnectedEvent=e=>{this._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=e=>{if(this._gamepads){let t=this._getGamepadDeviceType(e.gamepad.id),i=e.gamepad.index;this._unregisterDevice(t,i),delete this._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(e,t,i){let r=navigator.getGamepads()[t];if(r&&e===this._gamepads[t]){let s=this._inputs[e][t];i>=r.buttons.length?s[i]=r.axes[i-r.buttons.length].valueOf():s[i]=r.buttons[i].value}}_getGamepadDeviceType(e){return -1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?r.Yi.DualSense:r.Yi.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?r.Yi.Xbox:-1!==e.indexOf("057e")?r.Yi.Switch:r.Yi.Generic}_getPointerType(e){let t=r.Yi.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=r.Yi.Touch),t}}var _=i(1244);class d{constructor(e){this._registeredManagers=[],this._refCount=0,this.registerManager=e=>{for(let t=0;t<this._devices.length;t++){let i=this._devices[t];for(let r in i){let i=+r;e._addDevice(new _.p(this._deviceInputSystem,t,i))}}this._registeredManagers.push(e)},this.unregisterManager=e=>{let t=this._registeredManagers.indexOf(e);t>-1&&this._registeredManagers.splice(t,1)};let t=Object.keys(r.Yi).length/2;this._devices=Array(t);let i=(e,t)=>{for(let i of(this._devices[e]||(this._devices[e]=[]),this._devices[e][t]||(this._devices[e][t]=t),this._registeredManagers)){let r=new _.p(this._deviceInputSystem,e,t);i._addDevice(r)}},s=(e,t)=>{for(let i of(this._devices[e]?.[t]&&delete this._devices[e][t],this._registeredManagers))i._removeDevice(e,t)},n=(e,t,i)=>{if(i)for(let r of this._registeredManagers)r._onInputChanged(e,t,i)};"undefined"!=typeof _native?this._deviceInputSystem=new o(i,s,n):this._deviceInputSystem=new c(e,i,s,n)}dispose(){this._deviceInputSystem.dispose()}}class p{getDeviceSource(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null}getDeviceSources(e){return this._devices[e]?this._devices[e].filter(e=>!!e):[]}constructor(e){let t=Object.keys(r.Yi).length/2;this._devices=Array(t),this._firstDevice=Array(t),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new d(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new s.y$(e=>{for(let t of this._devices)if(t)for(let i of t)i&&this.onDeviceConnectedObservable.notifyObserver(e,i)}),this.onDeviceDisconnectedObservable=new s.y$,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add(()=>{this.dispose()})}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_addDevice(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=[]),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)}_removeDevice(e,t){let i=this._devices[e]?.[t];this.onDeviceDisconnectedObservable.notifyObservers(i),this._devices[e]?.[t]&&delete this._devices[e][t],this._updateFirstDevices(e)}_onInputChanged(e,t,i){this._devices[e]?.[t]?.onInputChangedObservable.notifyObservers(i)}_updateFirstDevices(e){switch(e){case r.Yi.Keyboard:case r.Yi.Mouse:this._firstDevice[e]=0;break;case r.Yi.Touch:case r.Yi.DualSense:case r.Yi.DualShock:case r.Yi.Xbox:case r.Yi.Switch:case r.Yi.Generic:{delete this._firstDevice[e];let t=this._devices[e];if(t){for(let i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}}}}}}},82045:function(e,t,i){i(3176).a.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}}},34995:function(e,t,i){var r=i(9520),s=i(9719),n=i(14684),a=i(25675),o=i(3176),h=i(93733);o.a.prototype._partialLoadFile=function(e,t,i,r,s=null){this._loadFile(e,e=>{i[t]=e,i._internalCount++,6===i._internalCount&&r(i)},void 0,void 0,!0,(e,t)=>{s&&e&&s(e.status+" "+e.statusText,t)})},o.a.prototype._cascadeLoadFiles=function(e,t,i,r=null){let s=[];s._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(i[e],e,s,t,r)},o.a.prototype._cascadeLoadImgs=function(e,t,i,r,s=null,n){let a=[];a._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(r[o],o,a,e,t,i,s,n)},o.a.prototype._partialLoadImg=function(e,t,i,r,s,o,h=null,l){let u=(0,a.f)();(0,n.r6)(e,e=>{i[t]=e,i._internalCount++,r&&r.removePendingData(u),6===i._internalCount&&o&&o(s,i)},(e,t)=>{r&&r.removePendingData(u),h&&h(e,t)},r?r.offlineProvider:null,l),r&&r.addPendingData(u)},o.a.prototype.createCubeTextureBase=function(e,t,i,n,a=null,o=null,l,u=null,c=!1,_=0,d=0,p=null,f=null,g=null,m=!1,T=null){let E=p||new r.l(this,7);E.isCube=!0,E.url=e,E.generateMipMaps=!n,E._lodGenerationScale=_,E._lodGenerationOffset=d,E._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),E!==p&&(E.label=e.substring(0,60)),this._doNotHandleContextLost||(E._extension=u,E._files=i,E._buffer=T);let b=e;this._transformTextureUrl&&!p&&(e=this._transformTextureUrl(e));let R=e.split("?")[0],C=R.lastIndexOf("."),P=u||(C>-1?R.substring(C).toLowerCase():""),x=(0,h.qr)(P),A=(r,h)=>{e===b?o&&r&&o(r.status+" "+r.statusText,h):(s.Y.Warn(`Failed to load ${e}, falling back to the ${b}`),this.createCubeTextureBase(b,t,i,!!n,a,o,l,u,c,_,d,E,f,g,m,T))};if(x)x.then(r=>{let n=e=>{f&&f(E,e),r.loadCubeData(e,E,c,a,o)};T?n(T):i&&6===i.length?r.supportCascades?this._cascadeLoadFiles(t,e=>n(e.map(e=>new Uint8Array(e))),i,o):o?o("Textures type does not support cascades."):s.Y.Warn("Texture loader does not support cascades."):this._loadFile(e,e=>n(new Uint8Array(e)),void 0,void 0,!0,A)});else{if(!i||0===i.length)throw Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,E,(e,t)=>{g&&g(e,t)},i,o)}return this._internalTexturesCache.push(E),E}},97531:function(e,t,i){var r=i(3176);r.a.prototype.getInputElement=function(){return this._renderingCanvas},r.a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},r.a.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},r.a.prototype.getAspectRatio=function(e,t=!1){let i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},r.a.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},r.a.prototype._verifyPointerLock=function(){this._onPointerLockChange?.()}},94140:function(e,t,i){var r=i(28143),s=i(3176);s.a.prototype.displayLoadingUI=function(){if(!(0,r.CG)())return;let e=this.loadingScreen;e&&e.displayLoadingUI()},s.a.prototype.hideLoadingUI=function(){if(!(0,r.CG)())return;let e=this._loadingScreen;e&&e.hideLoadingUI()},Object.defineProperty(s.a.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=s.a.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.a.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.a.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0})},80123:function(e,t,i){var r=i(3176);r.a.prototype.getRenderPassNames=function(){return this._renderPassNames},r.a.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},r.a.prototype.createRenderPassId=function(e){let t=++r.a._RenderPassIdCounter;return this._renderPassNames[t]=e??"NONAME",t},r.a.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(let t=0;t<this.scenes.length;++t){let i=this.scenes[t];for(let t=0;t<i.meshes.length;++t){let r=i.meshes[t];if(r.subMeshes)for(let t=0;t<r.subMeshes.length;++t)r.subMeshes[t]._removeDrawWrapper(e)}}}},8821:function(e,t,i){var r=i(3176);i(82045),r.a.prototype.getInputElement=function(){return this._renderingCanvas},r.a.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},r.a.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},r.a.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},r.a.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},r.a.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},r.a.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},r.a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},r.a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},r.a.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},r.a.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},r.a.prototype.getStencilMask=function(){return this._stencilState.stencilMask},r.a.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},r.a.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},r.a.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},r.a.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},r.a.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},r.a.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},r.a.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},r.a.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},r.a.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},r.a.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},r.a.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},r.a.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},r.a.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},r.a.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},r.a.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},r.a.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},r.a.prototype.getAlphaMode=function(){return this._alphaMode},r.a.prototype.getAlphaEquation=function(){return this._alphaEquation}},89399:function(e,t,i){i(3176).a.prototype.createDepthStencilTexture=function(e,t,i){if(!t.isCube)return this._createDepthStencilTexture(e,t,i);{let i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}}},95330:function(e,t,i){i(46263).ThinEngine.prototype.setAlphaMode=function(e,t=!1){if(this._alphaMode===e){if(!t){let t=0===e;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}return}switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},38679:function(e,t,i){var r=i(46263),s=i(9520),n=i(9719),a=i(61146);r.ThinEngine.prototype._createDepthStencilCubeTexture=function(e,t){let i=new s.l(this,12);if(i.isCube=!0,1===this.webGLVersion)return n.Y.Error("Depth cube texture is not supported by WebGL 1."),i;let r={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},a=this._gl;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,e,r.bilinearFiltering,r.comparisonFunction);for(let t=0;t<6;t++)r.generateStencil?a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.DEPTH24_STENCIL8,e,e,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.DEPTH_COMPONENT24,e,e,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null);return this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(i),i},r.ThinEngine.prototype._setCubeMapTextureParams=function(e,t,i){let r=this._gl;r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==i&&i>0&&(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAX_LEVEL,i),e._maxLodLevel=i),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)},r.ThinEngine.prototype.createCubeTexture=function(e,t,i,r,s=null,o=null,h,l=null,u=!1,c=0,_=0,d=null,p,f=!1,g=null){let m=this._gl;return this.createCubeTextureBase(e,t,i,!!r,s,o,h,l,u,c,_,d,e=>this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,e,!0),(e,t)=>{let i=this.needPOTTextures?(0,a.p7)(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,o=[m.TEXTURE_CUBE_MAP_POSITIVE_X,m.TEXTURE_CUBE_MAP_POSITIVE_Y,m.TEXTURE_CUBE_MAP_POSITIVE_Z,m.TEXTURE_CUBE_MAP_NEGATIVE_X,m.TEXTURE_CUBE_MAP_NEGATIVE_Y,m.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);let l=h?this._getInternalFormat(h,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:m.RGBA,u=h?this._getInternalFormat(h):m.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(u=l);for(let e=0;e<o.length;e++)if(t[e].width!==i||t[e].height!==i){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext){n.Y.Warn("Cannot create canvas to resize texture.");return}this._workingCanvas.width=i,this._workingCanvas.height=i,this._workingContext.drawImage(t[e],0,0,t[e].width,t[e].height,0,0,i,i),m.texImage2D(o[e],0,l,u,m.UNSIGNED_BYTE,this._workingCanvas)}else m.texImage2D(o[e],0,l,u,m.UNSIGNED_BYTE,t[e]);r||m.generateMipmap(m.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!r),e.width=i,e.height=i,e.isReady=!0,h&&(e.format=h),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),s&&s()},!!f,g)},r.ThinEngine.prototype.generateMipMapsForCubemap=function(e,t=!0){if(e.generateMipMaps){let i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)}}},63296:function(e,t,i){var r=i(46263);r.ThinEngine.prototype.updateDynamicIndexBuffer=function(e,t,i=0){let r;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),r=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},r.ThinEngine.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0);let s=t.byteLength||t.length;void 0===r||r>=s&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,r):new Uint8Array(t.buffer,t.byteOffset+i,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()}},27344:function(e,t,i){var r=i(46263),s=i(9520),n=i(9719),a=i(8937),o=i(76019),h=i(90580);r.ThinEngine.prototype.createPrefilteredCubeTexture=function(e,t,i,r,l=null,u=null,c,_=null,d=!0){return this.createCubeTexture(e,t,null,!1,e=>{if(!e){l&&l(null);return}let u=e.texture;if(d?e.info.sphericalPolynomial&&(u._sphericalPolynomial=e.info.sphericalPolynomial):u._sphericalPolynomial=new a.i,u._source=9,this.getCaps().textureLOD){l&&l(u);return}let c=this._gl,_=e.width;if(!_)return;let p=[];for(let a=0;a<3;a++){let l=Math.log2(_)*i+r,d=Math.round(Math.min(Math.max(r+(l-r)*(1-a/2),0),l)),f=new s.l(this,2);if(f.type=u.type,f.format=u.format,f.width=Math.pow(2,Math.max(Math.log2(_)-d,0)),f.height=f.width,f.isCube=!0,f._cachedWrapU=0,f._cachedWrapV=0,this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,f,!0),f.samplingMode=2,c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e.isDDS){let t=e.info,i=e.data;this._unpackFlipY(t.isCompressed),h.N.UploadDDSLevels(this,f,i,t,!0,6,d)}else n.Y.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null);let g=new o.V(t);g._isCube=!0,g._texture=f,f.isReady=!0,p.push(g)}u._lodTextureHigh=p[2],u._lodTextureMid=p[1],u._lodTextureLow=p[0],l&&l(u)},u,c,_,d,i,r)}},40067:function(e,t,i){var r=i(9520),s=i(9719),n=i(46263),a=i(61146);function o(e,t,i,r){let s;let n=1;1===r?s=new Float32Array(t*i*4):2===r?(s=new Uint16Array(t*i*4),n=15360):s=7===r?new Uint32Array(t*i*4):new Uint8Array(t*i*4);for(let r=0;r<t;r++)for(let a=0;a<i;a++){let i=(a*t+r)*3,o=(a*t+r)*4;s[o+0]=e[i+0],s[o+1]=e[i+1],s[o+2]=e[i+2],s[o+3]=n}return s}function h(e){return function(t,i,s,n,a,o,h,l,u=null,c=0){let _=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,d=new r.l(this,e?10:11);d.baseWidth=i,d.baseHeight=s,d.baseDepth=n,d.width=i,d.height=s,d.depth=n,d.format=a,d.type=c,d.generateMipMaps=o,d.samplingMode=l,e?d.is3D=!0:d.is2DArray=!0,this._doNotHandleContextLost||(d._bufferView=t),e?this.updateRawTexture3D(d,t,a,h,u,c):this.updateRawTexture2DArray(d,t,a,h,u,c),this._bindTextureDirectly(_,d,!0);let p=this._getSamplingParameters(l,o);return this._gl.texParameteri(_,this._gl.TEXTURE_MAG_FILTER,p.mag),this._gl.texParameteri(_,this._gl.TEXTURE_MIN_FILTER,p.min),o&&this._gl.generateMipmap(_),this._bindTextureDirectly(_,null),this._internalTexturesCache.push(d),d}}function l(e){return function(t,i,r,s,n=null,a=0){let o=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,h=this._getWebGLTextureType(a),l=this._getInternalFormat(r),u=this._getRGBABufferInternalSizedFormat(a,r);this._bindTextureDirectly(o,t,!0),this._unpackFlipY(void 0===s||!!s),this._doNotHandleContextLost||(t._bufferView=i,t.format=r,t.invertY=s,t._compression=n),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&i?this._gl.compressedTexImage3D(o,0,this.getCaps().s3tc[n],t.width,t.height,t.depth,0,i):this._gl.texImage3D(o,0,u,t.width,t.height,t.depth,0,l,h,i),t.generateMipMaps&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),t.isReady=!0}}n.ThinEngine.prototype.updateRawTexture=function(e,t,i,r,s=null,n=0,a=!1){if(!e)return;let o=this._getRGBABufferInternalSizedFormat(n,i,a),h=this._getInternalFormat(i),l=this._getWebGLTextureType(n);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=n,e.invertY=r,e._compression=s),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[s],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,e.width,e.height,0,h,l,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0},n.ThinEngine.prototype.createRawTexture=function(e,t,i,s,n,a,o,h=null,l=0,u=0,c=!1){let _=new r.l(this,3);_.baseWidth=t,_.baseHeight=i,_.width=t,_.height=i,_.format=s,_.generateMipMaps=n,_.samplingMode=o,_.invertY=a,_._compression=h,_.type=l,_._useSRGBBuffer=this._getUseSRGBBuffer(c,!n),this._doNotHandleContextLost||(_._bufferView=e),this.updateRawTexture(_,e,s,a,h,l,_._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,_,!0);let d=this._getSamplingParameters(o,n);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,d.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,d.min),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(_),_},n.ThinEngine.prototype.createRawCubeTexture=function(e,t,i,n,o,h,l,u=null){let c=this._gl,_=new r.l(this,8);_.isCube=!0,_.format=i,_.type=n,this._doNotHandleContextLost||(_._bufferViewArray=e);let d=this._getWebGLTextureType(n),p=this._getInternalFormat(i);if(p===c.RGB&&(p=c.RGBA),d!==c.FLOAT||this._caps.textureFloatLinearFiltering?d!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?d!==c.FLOAT||this._caps.textureFloatRender?d!==c.HALF_FLOAT||this._caps.colorBufferFloat||(o=!1,s.Y.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(o=!1,s.Y.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(o=!1,l=1,s.Y.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(o=!1,l=1,s.Y.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")),_.width=t,_.height=t,_.invertY=h,_._compression=u,!this.needPOTTextures||(0,a.lP)(_.width)&&(0,a.lP)(_.height)||(o=!1),e)this.updateRawCubeTexture(_,e,i,n,h,u);else{let e=this._getRGBABufferInternalSizedFormat(n);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,_,!0);for(let t=0;t<6;t++)u?c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.getCaps().s3tc[u],_.width,_.height,0,void 0):c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e,_.width,_.height,0,p,d,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,_,!0),e&&o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);let f=this._getSamplingParameters(l,o);return c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,f.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,f.min),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),_.generateMipMaps=o,_.samplingMode=l,_.isReady=!0,_},n.ThinEngine.prototype.updateRawCubeTexture=function(e,t,i,r,s,n=null,h=0){e._bufferViewArray=t,e.format=i,e.type=r,e.invertY=s,e._compression=n;let l=this._gl,u=this._getWebGLTextureType(r),c=this._getInternalFormat(i),_=this._getRGBABufferInternalSizedFormat(r),d=!1;c===l.RGB&&(c=l.RGBA,d=!0),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===s||!!s),e.width%4!=0&&l.pixelStorei(l.UNPACK_ALIGNMENT,1);for(let i=0;i<6;i++){let s=t[i];n?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,h,this.getCaps().s3tc[n],e.width,e.height,0,s):(d&&(s=o(s,e.width,e.height,r)),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+i,h,_,e.width,e.height,0,c,u,s))}(!this.needPOTTextures||(0,a.lP)(e.width)&&(0,a.lP)(e.height))&&e.generateMipMaps&&0===h&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},n.ThinEngine.prototype.createRawCubeTextureFromUrl=function(e,t,i,r,s,n,a,h,l=null,u=null,c=3,_=!1){let d=this._gl,p=this.createRawCubeTexture(null,i,r,s,!n,_,c,null);t?.addPendingData(p),p.url=e,p.isReady=!1,this._internalTexturesCache.push(p);let f=e=>{let i=p.width,n=a(e);if(n){if(h){let e=this._getWebGLTextureType(s),t=this._getInternalFormat(r),a=this._getRGBABufferInternalSizedFormat(s),l=!1;t===d.RGB&&(t=d.RGBA,l=!0),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,p,!0),this._unpackFlipY(!1);let u=h(n);for(let r=0;r<u.length;r++){let n=i>>r;for(let i=0;i<6;i++){let h=u[r][i];l&&(h=o(h,n,n,s)),d.texImage2D(i,r,a,n,n,0,t,e,h)}}this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(p,n,r,s,_);p.isReady=!0,t?.removePendingData(p),p.onLoadedObservable.notifyObservers(p),p.onLoadedObservable.clear(),l&&l()}};return this._loadFile(e,e=>{f(e)},void 0,t?.offlineProvider,!0,(e,i)=>{t?.removePendingData(p),u&&e&&u(e.status+" "+e.statusText,i)}),p},n.ThinEngine.prototype.createRawTexture2DArray=h(!1),n.ThinEngine.prototype.createRawTexture3D=h(!0),n.ThinEngine.prototype.updateRawTexture2DArray=l(!1),n.ThinEngine.prototype.updateRawTexture3D=l(!0)},77102:function(e,t,i){var r=i(46263),s=i(56172);r.ThinEngine.prototype._readTexturePixelsSync=function(e,t,i,r=-1,n=0,a=null,o=!0,h=!1,l=0,u=0){let c=this._gl;if(!c)throw Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){let e=c.createFramebuffer();if(!e)throw Error("Unable to create dummy framebuffer");this._dummyFramebuffer=e}c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),r>-1?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._hardwareTexture?.underlyingResource,n):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e._hardwareTexture?.underlyingResource,n);let _=void 0!==e.type?this._getWebGLTextureType(e.type):c.UNSIGNED_BYTE;return h?a||(a=(0,s.A8)(e.type,4*t*i)):_===c.UNSIGNED_BYTE?(a||(a=new Uint8Array(4*t*i)),_=c.UNSIGNED_BYTE):(a||(a=new Float32Array(4*t*i)),_=c.FLOAT),o&&this.flushFramebuffer(),c.readPixels(l,u,t,i,c.RGBA,_,a),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),a},r.ThinEngine.prototype._readTexturePixels=function(e,t,i,r=-1,s=0,n=null,a=!0,o=!1,h=0,l=0){return Promise.resolve(this._readTexturePixelsSync(e,t,i,r,s,n,a,o,h,l))}},39936:function(e,t,i){var r=i(9520),s=i(9719),n=i(46263),a=i(22265);class o extends a.r{constructor(e,t,i,r,s){super(e,t,i,r),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=s}_cloneRenderTargetWrapper(){let e=null;return this._colorTextureArray&&this._depthStencilTextureArray?(e=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:e=super._cloneRenderTargetWrapper(),e}_swapRenderTargetWrapper(e){super._swapRenderTargetWrapper(e),e._framebuffer=this._framebuffer,e._depthStencilBuffer=this._depthStencilBuffer,e._MSAAFramebuffer=this._MSAAFramebuffer,e._colorTextureArray=this._colorTextureArray,e._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,s=14,n){if(this._depthStencilBuffer){let e=this._engine,t=e._currentFramebuffer,i=this._context;e._bindUnboundFramebuffer(this._framebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,null),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,null),e._bindUnboundFramebuffer(t),i.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(e,t,i,r,s,n)}shareDepth(e){super.shareDepth(e);let t=this._context,i=this._depthStencilBuffer,r=e._MSAAFramebuffer||e._framebuffer,s=this._engine;e._depthStencilBuffer&&e._depthStencilBuffer!==i&&t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=i;let n=e._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;s._bindUnboundFramebuffer(r),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,i),s._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(e,t=0,i,r=0){if(!e._hardwareTexture)return;let s=this._framebuffer,n=this._engine,a=n._currentFramebuffer;if(n._bindUnboundFramebuffer(s),n.webGLVersion>1){let s=this._context,n=s["COLOR_ATTACHMENT"+t];e.is2DArray||e.is3D?(i=i??this.layerIndices?.[t]??0,s.framebufferTextureLayer(s.FRAMEBUFFER,n,e._hardwareTexture.underlyingResource,r,i)):e.isCube?(i=i??this.faceIndices?.[t]??0,s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._hardwareTexture.underlyingResource,r)):s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_2D,e._hardwareTexture.underlyingResource,r)}else{let s=this._context,n=s["COLOR_ATTACHMENT"+t+"_WEBGL"],a=void 0!==i?s.TEXTURE_CUBE_MAP_POSITIVE_X+i:s.TEXTURE_2D;s.framebufferTexture2D(s.FRAMEBUFFER,n,a,e._hardwareTexture.underlyingResource,r)}n._bindUnboundFramebuffer(a)}setTexture(e,t=0,i=!0){super.setTexture(e,t,i),this._bindTextureRenderTarget(e,t)}setLayerAndFaceIndices(e,t){if(super.setLayerAndFaceIndices(e,t),!this.textures||!this.layerIndices||!this.faceIndices)return;let i=this._attachments?.length??this.textures.length;for(let e=0;e<i;e++){let t=this.textures[e];t&&(t.is2DArray||t.is3D?this._bindTextureRenderTarget(t,e,this.layerIndices[e]):t.isCube?this._bindTextureRenderTarget(t,e,this.faceIndices[e]):this._bindTextureRenderTarget(t,e))}}setLayerAndFaceIndex(e=0,t,i){if(super.setLayerAndFaceIndex(e,t,i),!this.textures||!this.layerIndices||!this.faceIndices)return;let r=this.textures[e];r.is2DArray||r.is3D?this._bindTextureRenderTarget(this.textures[e],e,this.layerIndices[e]):r.isCube&&this._bindTextureRenderTarget(this.textures[e],e,this.faceIndices[e])}dispose(e=this._disposeOnlyFramebuffers){let t=this._context;!e&&(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(e)}}i(89399),n.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(e,t,i){let r=new o(e,t,i,this,this._gl);return this._renderTargetWrapperCache.push(r),r},n.ThinEngine.prototype.createRenderTargetTexture=function(e,t){let i,r;let s=this._createHardwareRenderTargetWrapper(!1,!1,e),n=!0,a=!1,o=!1,h=1;void 0!==t&&"object"==typeof t&&(n=t.generateDepthBuffer??!0,a=!!t.generateStencilBuffer,o=!!t.noColorAttachment,i=t.colorAttachment,h=t.samples??1,r=t.label);let l=i||(o?null:this._createInternalTexture(e,t,!0,5)),u=e.width||e,c=e.height||e,_=this._currentFramebuffer,d=this._gl,p=d.createFramebuffer();return this._bindUnboundFramebuffer(p),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(a,n,u,c),!l||l.is2DArray||l.is3D||d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(_),s.label=r??"RenderTargetWrapper",s._framebuffer=p,s._generateDepthBuffer=n,s._generateStencilBuffer=a,s.setTextures(l),this.updateRenderTargetTextureSampleCount(s,h),s},n.ThinEngine.prototype._createDepthStencilTexture=function(e,t,i){let n=this._gl,a=e.layers||0,o=e.depth||0,h=n.TEXTURE_2D;0!==a?h=n.TEXTURE_2D_ARRAY:0!==o&&(h=n.TEXTURE_3D);let l=new r.l(this,12);if(l.label=t.label,!this._caps.depthTextureExtension)return s.Y.Error("Depth texture is not supported by your browser or hardware."),l;let u={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(h,l,!0),this._setupDepthStencilTexture(l,e,0!==u.comparisonFunction&&u.bilinearFiltering,u.comparisonFunction,u.samples),void 0!==u.depthTextureFormat){if(15!==u.depthTextureFormat&&16!==u.depthTextureFormat&&17!==u.depthTextureFormat&&13!==u.depthTextureFormat&&14!==u.depthTextureFormat&&18!==u.depthTextureFormat)return s.Y.Error(`Depth texture ${u.depthTextureFormat} format is not supported.`),l;l.format=u.depthTextureFormat}else l.format=u.generateStencil?13:16;let c=17===l.format||13===l.format||18===l.format,_=n.UNSIGNED_INT;15===l.format?_=n.UNSIGNED_SHORT:17===l.format||13===l.format?_=n.UNSIGNED_INT_24_8:14===l.format?_=n.FLOAT:18===l.format&&(_=n.FLOAT_32_UNSIGNED_INT_24_8_REV);let d=c?n.DEPTH_STENCIL:n.DEPTH_COMPONENT,p=this._getInternalFormatFromDepthTextureFormat(l.format,!0,c);return l.is2DArray?n.texImage3D(h,0,p,l.width,l.height,a,0,d,_,null):l.is3D?n.texImage3D(h,0,p,l.width,l.height,o,0,d,_,null):n.texImage2D(h,0,p,l.width,l.height,0,d,_,null),this._bindTextureDirectly(h,null),this._internalTexturesCache.push(l),i._depthStencilBuffer&&(n.deleteRenderbuffer(i._depthStencilBuffer),i._depthStencilBuffer=null),this._bindUnboundFramebuffer(i._MSAAFramebuffer??i._framebuffer),i._generateStencilBuffer=c,i._depthStencilTextureWithStencil=c,i._depthStencilBuffer=this._setupFramebufferDepthAttachments(i._generateStencilBuffer,i._generateDepthBuffer,i.width,i.height,i.samples,l.format),this._bindUnboundFramebuffer(null),l},n.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;let i=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);let r=e.texture?._hardwareTexture;r?.releaseMSAARenderBuffers();let s=i.createFramebuffer();if(!s)throw Error("Unable to create multi sampled framebuffer");if(e._MSAAFramebuffer=s,e.texture&&t>1&&"function"==typeof i.renderbufferStorageMultisample){this._bindUnboundFramebuffer(e._MSAAFramebuffer);let s=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(e.texture.type,e.texture.format,e.texture._useSRGBBuffer),i.COLOR_ATTACHMENT0,!1);if(!s)throw Error("Unable to create multi sampled framebuffer");r?.addMSAARenderBuffer(s)}this._bindUnboundFramebuffer(e._MSAAFramebuffer??e._framebuffer),e.texture&&(e.texture.samples=t),e._samples=t;let n=e._depthStencilTexture?e._depthStencilTexture.format:void 0;return e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t,n),this._bindUnboundFramebuffer(null),t},n.ThinEngine.prototype._setupDepthStencilTexture=function(e,t,i,r,s=1){let n=t.width||t,a=t.height||t,o=t.layers||0,h=t.depth||0;e.baseWidth=n,e.baseHeight=a,e.width=n,e.height=a,e.is2DArray=o>0,e.depth=o||h,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=r;let l=this._gl,u=this._getTextureTarget(e),c=this._getSamplingParameters(e.samplingMode,!1);l.texParameteri(u,l.TEXTURE_MAG_FILTER,c.mag),l.texParameteri(u,l.TEXTURE_MIN_FILTER,c.min),l.texParameteri(u,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(u,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===r?(l.texParameteri(u,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(u,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(u,l.TEXTURE_COMPARE_FUNC,r),l.texParameteri(u,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE)))}},57694:function(e,t,i){var r=i(9520),s=i(9719);i(46263).ThinEngine.prototype.createRenderTargetCubeTexture=function(e,t){let i=this._createHardwareRenderTargetWrapper(!1,!0,e),n={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(1!==n.type||this._caps.textureFloatLinearFiltering)&&(2!==n.type||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=1);let a=this._gl,o=new r.l(this,5);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,o,!0);let h=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);1!==n.type||this._caps.textureFloat||(n.type=0,s.Y.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,h.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,h.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(let t=0;t<6;t++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),e,e,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);let l=a.createFramebuffer();return this._bindUnboundFramebuffer(l),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,e,e),n.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),i._framebuffer=l,i._generateDepthBuffer=n.generateDepthBuffer,i._generateStencilBuffer=n.generateStencilBuffer,o.width=e,o.height=e,o.isReady=!0,o.isCube=!0,o.samples=1,o.generateMipMaps=n.generateMipMaps,o.samplingMode=n.samplingMode,o.type=n.type,o.format=n.format,this._internalTexturesCache.push(o),i.setTextures(o),i}},69662:function(e,t,i){i(46263).ThinEngine.prototype.setDepthStencilTexture=function(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,r):this._setTexture(e,null,void 0,void 0,r))}},15732:function(e,t,i){var r=i(46263),s=i(72563);r.ThinEngine.prototype.createUniformBuffer=function(e,t){let i=this._gl.createBuffer();if(!i)throw Error("Unable to create uniform buffer");let r=new s.M(i);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},r.ThinEngine.prototype.createDynamicUniformBuffer=function(e,t){let i=this._gl.createBuffer();if(!i)throw Error("Unable to create dynamic uniform buffer");let r=new s.M(i);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},r.ThinEngine.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},r.ThinEngine.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},r.ThinEngine.prototype.bindUniformBlock=function(e,t,i){let r=e.program,s=this._gl.getUniformBlockIndex(r,t);4294967295!==s&&this._gl.uniformBlockBinding(r,s,i)}},96305:function(e,t,i){i.d(t,{Ku:function(){return A},wz:function(){return C},aK:function(){return x},An:function(){return P},xd:function(){return F},PM:function(){return O}});class r{constructor(){this.children=[]}isValid(e){return!0}process(e,t){let i="";if(this.line){let r=this.line,s=t.processor;if(s){s.lineProcessor&&(r=s.lineProcessor(r,t.isFragment,t.processingContext));let i=t.processor?.attributeKeywordName??"attribute",n=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:"varying";!t.isFragment&&s.attributeProcessor&&this.line.startsWith(i)?r=s.attributeProcessor(this.line,e,t.processingContext):s.varyingProcessor&&(s.varyingCheck?.(this.line,t.isFragment)||!s.varyingCheck&&this.line.startsWith(n))?r=s.varyingProcessor(this.line,t.isFragment,e,t.processingContext):s.uniformProcessor&&s.uniformRegexp&&s.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(r=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):s.uniformBufferProcessor&&s.uniformBufferRegexp&&s.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(r=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):s.textureProcessor&&s.textureRegexp&&s.textureRegexp.test(this.line)?r=s.textureProcessor(this.line,t.isFragment,e,t.processingContext):(s.uniformProcessor||s.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?s.uniformProcessor&&(r=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):s.uniformBufferProcessor&&(r=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,s.endOfUniformBufferProcessor&&(r=s.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}i+=r+"\n"}return this.children.forEach(r=>{i+=r.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}}class s{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){for(let t of(this._lines.length=0,e)){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}let e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}let i=e.indexOf(";");if(-1===i)this._lines.push(e);else if(i===e.length-1)e.length>1&&this._lines.push(e);else{let e=t.split(";");for(let t=0;t<e.length;t++){let i=e[t];i&&(i=i.trim())&&this._lines.push(i+(t!==e.length-1?";":""))}}}}}class n extends r{process(e,t){for(let i=0;i<this.children.length;i++){let r=this.children[i];if(r.isValid(e))return r.process(e,t)}return""}}class a extends r{isValid(e){return this.testExpression.isTrue(e)}}class o{isTrue(e){return!0}static postfixToInfix(e){let t=[];for(let i of e)if(void 0===o._OperatorPriority[i])t.push(i);else{let e=t[t.length-1],r=t[t.length-2];t.length-=2,t.push(`(${r}${i}${e})`)}return t[t.length-1]}static infixToPostfix(e){let t=o._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];let i=[],r=-1,s=()=>{""!==(u=u.trim())&&(i.push(u),u="")},n=e=>{r<o._Stack.length-1&&(o._Stack[++r]=e)},a=()=>o._Stack[r],h=()=>-1===r?"!!INVALID EXPRESSION!!":o._Stack[r--],l=0,u="";for(;l<e.length;){let t=e.charAt(l),c=l<e.length-1?e.substring(l,2+l):"";if("("===t)u="",n(t);else if(")"===t){for(s();-1!==r&&"("!==a();)i.push(h());h()}else if(o._OperatorPriority[c]>1){for(s();-1!==r&&o._OperatorPriority[a()]>=o._OperatorPriority[c];)i.push(h());n(c),l++}else u+=t;l++}for(s();-1!==r;)"("===a()?h():i.push(h());return o._InfixToPostfixCache.size>=o.InfixToPostfixCacheLimitSize&&o.ClearCache(),o._InfixToPostfixCache.set(e,{result:i,accessTime:Date.now()}),i}static ClearCache(){let e=Array.from(o._InfixToPostfixCache.entries()).sort((e,t)=>e[1].accessTime-t[1].accessTime);for(let t=0;t<o.InfixToPostfixCacheCleanupSize;t++)o._InfixToPostfixCache.delete(e[t][0])}}o.InfixToPostfixCacheLimitSize=5e4,o.InfixToPostfixCacheCleanupSize=25e3,o._InfixToPostfixCache=new Map,o._OperatorPriority={")":0,"(":1,"||":2,"&&":3},o._Stack=["","","","","","","","","","","","","","","","","","","",""];class h extends o{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}}class l extends o{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class u extends o{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class c extends o{constructor(e,t,i){super(),this.define=e,this.operand=t,this.testValue=i}isTrue(e){let t=e[this.define];void 0===t&&(t=this.define);let i=!1,r=parseInt(t),s=parseInt(this.testValue);switch(this.operand){case">":i=r>s;break;case"<":i=r<s;break;case"<=":i=r<=s;break;case">=":i=r>=s;break;case"==":i=r===s;break;case"!=":i=r!==s}return i}}var _=i(10633),d=i(56172);let p=/defined\s*?\((.+?)\)/g,f=/defined\s*?\[(.+?)\]/g,g=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,m=/__decl__/,T=/light\{X\}.(\w*)/g,E=/\{X\}/g,b=[],R=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function C(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function P(e,t,i,r){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),F(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines)),i(function(e,t,i){let r=function(e,t){if(t.processor?.noPrecision)return e;let i=t.shouldUseHighPrecisionShader;return -1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e}(e,t);if(!t.processor||0===t.processor.shaderLanguage&&-1!==r.indexOf("#version 3")&&(r=r.replace("#version 300 es",""),!t.processor.parseGLES3))return r;let s=t.defines,n=D(t,i);return t.processor.preProcessor&&(r=t.processor.preProcessor(r,s,n,t.isFragment,t.processingContext)),r=I(r,n,t),t.processor.postProcessor&&(r=t.processor.postProcessor(r,s,t.isFragment,t.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{})),i?._features.needShaderCodeInlining&&(r=i.inlineShaderCode(r)),r}(e,t,r),e)})}function x(e,t,i,r){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),F(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines)),i(function(e,t,i){let r=e,s=t.defines,n=D(t,i);return t.processor?.preProcessor&&(r=t.processor.preProcessor(r,s,n,t.isFragment,t.processingContext)),r=I(r,n,t),t.processor?.postProcessor&&(r=t.processor.postProcessor(r,s,t.isFragment,t.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{})),i._features.needShaderCodeInlining&&(r=i.inlineShaderCode(r)),r}(e,t,r),e)})}function A(e,t,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(e,t,i.processingContext):{vertexCode:e,fragmentCode:t}}function y(e){let t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new h(t[1].trim(),"!"===e[0]);let i="",r=0;for(i of["==","!=",">=","<=","<",">"])if((r=e.indexOf(i))>-1)break;if(-1===r)return new h(e);let s=e.substring(0,r).trim(),n=e.substring(r+i.length).trim();return new c(s,i,n)}function v(e,t){let i=new a,r=e.substring(0,t),s=e.substring(t);return s=s.substring(0,(s.indexOf("//")+1||s.length+1)-1).trim(),"#ifdef"===r?i.testExpression=new h(s):"#ifndef"===r?i.testExpression=new h(s,!0):i.testExpression=function(e){e=e.replace(p,"defined[$1]");let t=o.infixToPostfix(e),i=[];for(let e of t)if("||"!==e&&"&&"!==e)i.push(e);else if(i.length>=2){let t=i[i.length-1],r=i[i.length-2];i.length-=2;let s="&&"==e?new u:new l;"string"==typeof t&&(t=t.replace(f,"defined($1)")),"string"==typeof r&&(r=r.replace(f,"defined($1)")),s.leftOperand="string"==typeof r?y(r):r,s.rightOperand="string"==typeof t?y(t):t,i.push(s)}let r=i[i.length-1];return"string"==typeof r&&(r=r.replace(f,"defined($1)")),"string"==typeof r?y(r):r}(s),i}function S(e,t,i){let s=e.currentLine;for(;M(e,i);){let n=(s=e.currentLine).substring(0,5).toLowerCase();if("#else"===n){let i=new r;t.children.push(i),M(e,i);return}if("#elif"===n){let e=v(s,5);t.children.push(e),i=e}}}function M(e,t){for(;e.canRead;){e.lineIndex++;let i=e.currentLine;if(i.indexOf("#")>=0){let r=R.exec(i);if(r&&r.length){switch(r[0]){case"#ifdef":{let r=new n;t.children.push(r);let s=v(i,6);r.children.push(s),S(e,r,s);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{let r=new n;t.children.push(r);let s=v(i,7);r.children.push(s),S(e,r,s);break}case"#if":{let r=new n,s=v(i,3);t.children.push(r),r.children.push(s),S(e,r,s)}}continue}}let s=new r;if(s.line=i,t.children.push(s),"#"===i[0]&&"d"===i[1]){let e=i.replace(";","").split(" ");s.additionalDefineKey=e[1],3===e.length&&(s.additionalDefineValue=e[2])}}return!1}function I(e,t,i){let n=new r,a=new s;return a.lineIndex=-1,a.lines=e.split("\n"),M(a,n),n.process(t,i)}function D(e,t){let i=e.defines,r={};for(let e of i){let t=e.replace("#define","").replace(";","").trim().split(" ");r[t[0]]=t.length>1?t[1]:""}return e.processor?.shaderLanguage===0&&(r.GL_ES="true"),r.__VERSION__=e.version,r[e.platformName]="true",(0,d.sk)(r,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),r}function F(e,t,i){let r;for(b.length=0;null!==(r=g.exec(e));)b.push(r);let s=String(e),n=[e],a=!1;for(let e of b){let r=e[1];if(-1!==r.indexOf("__decl__")&&(r=r.replace(m,""),t.supportsUniformBuffers&&(r=r.replace("Vertex","Ubo").replace("Fragment","Ubo")),r+="Declaration"),t.includesShadersStore[r]){let i=t.includesShadersStore[r];if(e[2]){let t=e[3].split(",");for(let e=0;e<t.length;e+=2){let r=RegExp(t[e],"g"),s=t[e+1];i=i.replace(r,s)}}if(e[4]){let r=e[5];if(-1!==r.indexOf("..")){let e=r.split(".."),s=parseInt(e[0]),n=parseInt(e[1]),a=i.slice(0);i="",isNaN(n)&&(n=t.indexParameters[e[1]]);for(let e=s;e<n;e++)t.supportsUniformBuffers||(a=a.replace(T,(e,t)=>t+"{X}")),i+=a.replace(E,e.toString())+"\n"}else t.supportsUniformBuffers||(i=i.replace(T,(e,t)=>t+"{X}")),i=i.replace(E,r)}let s=[];for(let t of n){let r=t.split(e[0]);for(let e=0;e<r.length-1;e++)s.push(r[e]),s.push(i);s.push(r[r.length-1])}n=s,a=a||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}else{let e=t.shadersRepository+"ShadersInclude/"+r+".fx";O.loadFile(e,e=>{t.includesShadersStore[r]=e,F(n.join(""),t,i)});return}}b.length=0,s=n.join(""),a?F(s.toString(),t,i):i(s)}let O={loadFile:(e,t,i,r,s,n)=>{throw(0,_.S)("FileTools")}}},99091:function(e,t,i){i.d(t,{C:function(){return s}});let r=/(flat\s)?\s*varying\s*.*/;class s{constructor(){this.shaderLanguage=0}attributeProcessor(e){return e.replace("attribute","in")}varyingCheck(e,t){return r.test(e)}varyingProcessor(e,t){return e.replace("varying",t?"in":"out")}postProcessor(e,t,i){let r=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i){let t=-1!==e.search(/layout *\(location *= *0\) *out/g);e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r||t?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e}}},74387:function(e,t,i){i.d(t,{B:function(){return r}});class r{get underlyingResource(){return this._webGLTexture}constructor(e=null,t){if(this._MSAARenderBuffers=null,this._context=t,!e&&!(e=t.createTexture()))throw Error("Unable to create webGL texture");this.set(e)}setUsage(){}set(e){this._webGLTexture=e}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(e){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(e)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(let e of this._MSAARenderBuffers)this._context.deleteRenderbuffer(e);this._MSAARenderBuffers=null}}getMSAARenderBuffer(e=0){return this._MSAARenderBuffers?.[e]??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},17949:function(e,t,i){i.d(t,{y:function(){return r}});class r{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(e){e&&this.program&&e(this.program)}setEngine(e){this.engine=e}_fillEffectInformation(e,t,i,r,s,n,a,o){let h;let l=this.engine;if(l.supportsUniformBuffers)for(let i in t)e.bindUniformBlock(i,t[i]);for(this.engine.getUniforms(this,i).forEach((e,t)=>{r[i[t]]=e}),this._uniforms=r,h=0;h<s.length;h++)null==e.getUniform(s[h])&&(s.splice(h,1),h--);for(let e of(s.forEach((e,t)=>{n[e]=t}),l.getAttributes(this,a)))o.push(e)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(e,t){let i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)}_cacheFloat2(e,t,i){let r=this._valueCache[e];if(!r||2!==r.length)return r=[t,i],this._valueCache[e]=r,!0;let s=!1;return r[0]!==t&&(r[0]=t,s=!0),r[1]!==i&&(r[1]=i,s=!0),s}_cacheFloat3(e,t,i,r){let s=this._valueCache[e];if(!s||3!==s.length)return s=[t,i,r],this._valueCache[e]=s,!0;let n=!1;return s[0]!==t&&(s[0]=t,n=!0),s[1]!==i&&(s[1]=i,n=!0),s[2]!==r&&(s[2]=r,n=!0),n}_cacheFloat4(e,t,i,r,s){let n=this._valueCache[e];if(!n||4!==n.length)return n=[t,i,r,s],this._valueCache[e]=n,!0;let a=!1;return n[0]!==t&&(n[0]=t,a=!0),n[1]!==i&&(n[1]=i,a=!0),n[2]!==r&&(n[2]=r,a=!0),n[3]!==s&&(n[3]=s,a=!0),a}setInt(e,t){let i=this._valueCache[e];(void 0===i||i!==t)&&this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setInt2(e,t,i){this._cacheFloat2(e,t,i)&&!this.engine.setInt2(this._uniforms[e],t,i)&&(this._valueCache[e]=null)}setInt3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&!this.engine.setInt3(this._uniforms[e],t,i,r)&&(this._valueCache[e]=null)}setInt4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&!this.engine.setInt4(this._uniforms[e],t,i,r,s)&&(this._valueCache[e]=null)}setIntArray(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)}setIntArray2(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)}setIntArray3(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)}setIntArray4(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)}setUInt(e,t){let i=this._valueCache[e];(void 0===i||i!==t)&&this.engine.setUInt(this._uniforms[e],t)&&(this._valueCache[e]=t)}setUInt2(e,t,i){this._cacheFloat2(e,t,i)&&!this.engine.setUInt2(this._uniforms[e],t,i)&&(this._valueCache[e]=null)}setUInt3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&!this.engine.setUInt3(this._uniforms[e],t,i,r)&&(this._valueCache[e]=null)}setUInt4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&!this.engine.setUInt4(this._uniforms[e],t,i,r,s)&&(this._valueCache[e]=null)}setUIntArray(e,t){this._valueCache[e]=null,this.engine.setUIntArray(this._uniforms[e],t)}setUIntArray2(e,t){this._valueCache[e]=null,this.engine.setUIntArray2(this._uniforms[e],t)}setUIntArray3(e,t){this._valueCache[e]=null,this.engine.setUIntArray3(this._uniforms[e],t)}setUIntArray4(e,t){this._valueCache[e]=null,this.engine.setUIntArray4(this._uniforms[e],t)}setArray(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)}setArray2(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)}setArray3(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)}setArray4(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)}setMatrices(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))}setMatrix(e,t){this._cacheMatrix(e,t)&&!this.engine.setMatrices(this._uniforms[e],t.asArray())&&(this._valueCache[e]=null)}setMatrix3x3(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)}setMatrix2x2(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)}setFloat(e,t){let i=this._valueCache[e];(void 0===i||i!==t)&&this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)}setVector2(e,t){this._cacheFloat2(e,t.x,t.y)&&!this.engine.setFloat2(this._uniforms[e],t.x,t.y)&&(this._valueCache[e]=null)}setFloat2(e,t,i){this._cacheFloat2(e,t,i)&&!this.engine.setFloat2(this._uniforms[e],t,i)&&(this._valueCache[e]=null)}setVector3(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&!this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)&&(this._valueCache[e]=null)}setFloat3(e,t,i,r){this._cacheFloat3(e,t,i,r)&&!this.engine.setFloat3(this._uniforms[e],t,i,r)&&(this._valueCache[e]=null)}setVector4(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&!this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)&&(this._valueCache[e]=null)}setQuaternion(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&!this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)&&(this._valueCache[e]=null)}setFloat4(e,t,i,r,s){this._cacheFloat4(e,t,i,r,s)&&!this.engine.setFloat4(this._uniforms[e],t,i,r,s)&&(this._valueCache[e]=null)}setColor3(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&!this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)&&(this._valueCache[e]=null)}setColor4(e,t,i){this._cacheFloat4(e,t.r,t.g,t.b,i)&&!this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)&&(this._valueCache[e]=null)}setDirectColor4(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&!this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)&&(this._valueCache[e]=null)}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}},56172:function(e,t,i){i.d(t,{A8:function(){return h},Gb:function(){return n},an:function(){return s},sk:function(){return o},wv:function(){return a}});var r=i(10633);i(28143);let s={};function n(e,t,i=""){return i+(t?t+"\n":"")+e}function a(e,t,i,n,a,o,h){let l=h||s.loadFile;if(l)return l(e,t,i,n,a,o);throw(0,r.S)("FileTools")}function o(e,t,i,r){if(e){t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,i?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,r?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),i&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),r&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function h(e,t,i=!1,r){switch(e){case 3:{let e=new Int8Array(t);return r&&e.set(new Int8Array(r)),e}case 0:{let e=new Uint8Array(t);return r&&e.set(new Uint8Array(r)),e}case 4:{let e=new Int16Array(t instanceof ArrayBuffer?t:i?t/2:t);return r&&e.set(new Int16Array(r)),e}case 5:case 8:case 9:case 10:case 2:{let e=new Uint16Array(t instanceof ArrayBuffer?t:i?t/2:t);return r&&e.set(new Uint16Array(r)),e}case 6:{let e=new Int32Array(t instanceof ArrayBuffer?t:i?t/4:t);return r&&e.set(new Int32Array(r)),e}case 7:case 11:case 12:case 13:case 14:case 15:{let e=new Uint32Array(t instanceof ArrayBuffer?t:i?t/4:t);return r&&e.set(new Uint32Array(r)),e}case 1:{let e=new Float32Array(t instanceof ArrayBuffer?t:i?t/4:t);return r&&e.set(new Float32Array(r)),e}}let s=new Uint8Array(t);return r&&s.set(new Uint8Array(r)),s}},3176:function(e,t,i){i.d(t,{a:function(){return E}});var r=i(51092),s=i(9719),n=i(97937),a=i(29281),o=i(94551),h=i(91887),l=i(89681),u=i(83762),c=i(28858),_=i(10633),d=i(9520),p=i(28143),f=i(82877),g=i(56172),m=i(93733);function T(e,t){if((0,p.CG)()){let{requestAnimationFrame:i}=t||window;if("function"==typeof i)return i(e)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}class E{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(e){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,e?this._depthCullingState.depthFunc=518:this._depthCullingState.depthFunc=515)}setColorWrite(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(e){if(e){this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}{let e="";return this.isNDCHalfZRange&&(e+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}_rebuildInternalTextures(){for(let e of this._internalTexturesCache.slice())e._rebuild()}_rebuildRenderTargetWrappers(){for(let e of this._renderTargetWrapperCache.slice())e._rebuild()}_rebuildEffects(){for(let e in this._compiledEffects){let t=this._compiledEffects[e];t._pipelineContext=null,t._prepareEffect()}n.Q.ResetCache()}_rebuildGraphicsResources(){this.wipeCaches(!0),this._rebuildEffects(),this._rebuildComputeEffects?.(),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){s.Y.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(e){setTimeout(async()=>{this._clearEmptyResources();let t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,s=this._stencilState.stencilTest;await e(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=s,this._flagContextRestored()},0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(e){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(e){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){let e=new Uint8Array(4);this._emptyCubeTexture=this.createRawCubeTexture([e,e,e,e,e,e],1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(e){if(!e){this._activeRenderLoops.length=0,this._cancelFrame();return}let t=this._activeRenderLoops.indexOf(e);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){let e=this._frameHandler;if(this._frameHandler=0,(0,p.CG)()){let{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"==typeof t)return t(e)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(e);return clearTimeout(e)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()}_renderViews(){return!1}_queueNewFrame(e,t){return T(e,t)}runRenderLoop(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(e){this._depthCullingState.depthTest=e}setZOffset(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}getZOffset(){let e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}setZOffsetUnits(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}getZOffsetUnits(){let e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}getHostWindow(){return(0,p.CG)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(e){this._compatibilityMode=!0}_rebuildTextures(){for(let e of this.scenes)e._rebuildTextures();for(let e of this._virtualScenes)e._rebuildTextures()}_releaseRenderTargetWrapper(e){let t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(e,t,i){let r=t||this.getRenderWidth(),s=i||this.getRenderHeight(),n=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(n*r,a*s,r*e.width,s*e.height)}createCanvasImage(){return document.createElement("img")}get description(){let e=this.name+this.version;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}_createTextureBase(e,t,i,n,a=3,o=null,h=null,l,u,c=null,_=null,p=null,f=null,g,T,b){let R="data:"===(e=e||"").substr(0,5),C="blob:"===e.substr(0,5),P=R&&-1!==e.indexOf(";base64,"),x=_||new d.l(this,1);x!==_&&(x.label=e.substring(0,60));let A=e;!this._transformTextureUrl||P||_||c||(e=this._transformTextureUrl(e)),A!==e&&(x._originalUrl=A);let y=e.lastIndexOf("."),v=f||(y>-1?e.substring(y).toLowerCase():"");v.indexOf("?")>-1&&(v=v.split("?")[0]);let S=(0,m.qr)(v,g);n&&n.addPendingData(x),x.url=e,x.generateMipMaps=!t,x.samplingMode=a,x.invertY=i,x._useSRGBBuffer=this._getUseSRGBBuffer(!!b,t),this._doNotHandleContextLost||(x._buffer=c);let M=null;o&&!_&&(M=x.onLoadedObservable.add(o)),_||this._internalTexturesCache.push(x);let I=(i,_)=>{n&&n.removePendingData(x),e===A?(M&&x.onLoadedObservable.remove(M),r.l.UseFallbackTexture&&e!==r.l.FallbackTexture&&this._createTextureBase(r.l.FallbackTexture,t,x.invertY,n,a,null,h,l,u,c,x),i=(i||"Unknown error")+(r.l.UseFallbackTexture?" - Fallback texture was used":""),x.onErrorObservable.notifyObservers({message:i,exception:_}),h&&h(i,_)):(s.Y.Warn(`Failed to load ${e}, falling back to ${A}`),this._createTextureBase(A,t,x.invertY,n,a,o,h,l,u,c,x,p,f,g,T,b))};if(S){let t=async e=>{(await S).loadData(e,x,(e,t,i,r,s,o)=>{o?I("TextureLoader failed to load data"):l(x,v,n,{width:e,height:t},x.invertY,!i,r,()=>(s(),!1),a)},T)};c?c instanceof ArrayBuffer?t(new Uint8Array(c)):ArrayBuffer.isView(c)?t(c):h&&h("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,e=>t(new Uint8Array(e)),void 0,n?n.offlineProvider:void 0,!0,(e,t)=>{I("Unable to load "+(e&&e.responseURL,t))})}else{let i=e=>{C&&!this._doNotHandleContextLost&&(x._buffer=e),l(x,v,n,e,x.invertY,t,!1,u,a)};!R||P?c&&("string"==typeof c.decoding||c.close)?i(c):E._FileToolsLoadImage(e||"",i,I,n?n.offlineProvider:null,g,x.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof c||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob?E._FileToolsLoadImage(c,i,I,n?n.offlineProvider:null,g,x.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):c&&i(c)}return x}_rebuildBuffers(){for(let e of this._uniformBuffers)e._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,p.n5)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(let e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(e){this._name=e}static get NpmPackage(){return"babylonjs@7.28.0"}static get Version(){return"7.28.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(e){this._hardwareScalingLevel=e,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(e){this._doNotHandleContextLost=e}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(e,t,i){this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new h.k,this._stencilStateComposer=new l.C,this._stencilState=new u.s,this._alphaState=new c.Q,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=[],this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new f.y$,this.onCanvasFocusObservable=new f.y$,this.onNewSceneAddedObservable=new f.y$,this.onResizeObservable=new f.y$,this.onCanvasPointerOutObservable=new f.y$,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=[],this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=[],this.onBeforeTextureInitObservable=new f.y$,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=[],this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new f.y$,this.onAfterShaderCompilationObservable=new f.y$,this.onBeginFrameObservable=new f.y$,this.onEndFrameObservable=new f.y$,this._transformTextureUrl=null,this._uniformBuffers=[],this._storageBuffers=[],this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new f.y$,this.onContextRestoredObservable=new f.y$,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new f.y$,r.l.Instances.push(this),this.startTime=o.F.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,a.Z.SetMatrixPrecision(!!t.useHighPrecisionMatrix),(0,p.up)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=i??!1,t.antialias=e??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=t.audioEngineOptions?.audioContext??null,this._audioDestination=t.audioEngineOptions?.audioDestination??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;let s=(0,p.CG)()&&window.devicePixelRatio||1,n=t.limitDeviceRatio||s;i=i||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=i?1/Math.min(n,s):1,this._lastDevicePixelRatio=s,this._creationOptions=t}resize(e=!1){let t,i;if(this.adaptToDeviceRatio){let e=(0,p.CG)()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/e;this._lastDevicePixelRatio=e,this._hardwareScalingLevel*=t}if((0,p.CG)()&&(0,p.n5)()){if(this._renderingCanvas){let e=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};t=this._renderingCanvas.clientWidth||e.width||this._renderingCanvas.width||100,i=this._renderingCanvas.clientHeight||e.height||this._renderingCanvas.height||100}else t=window.innerWidth,i=window.innerHeight}else t=this._renderingCanvas?this._renderingCanvas.width:100,i=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(t/this._hardwareScalingLevel,i/this._hardwareScalingLevel,e)}setSize(e,t,i=!1){if(!this._renderingCanvas||(e|=0,t|=0,!i&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t))return!1;if(this._renderingCanvas.width=e,this._renderingCanvas.height=t,this.scenes){for(let e=0;e<this.scenes.length;e++){let t=this.scenes[e];for(let e=0;e<t.cameras.length;e++)t.cameras[e]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(e,t,i,r,s,n,a,o,h,l,u){throw(0,_.S)("engine.rawTexture")}createRawCubeTexture(e,t,i,r,s,n,a,o){throw(0,_.S)("engine.rawTexture")}createRawTexture3D(e,t,i,r,s,n,a,o,h,l,u){throw(0,_.S)("engine.rawTexture")}createRawTexture2DArray(e,t,i,r,s,n,a,o,h,l,u){throw(0,_.S)("engine.rawTexture")}_sharedInit(e){this._renderingCanvas=e}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{let e=navigator.userAgent;this.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&(0,p.n5)()&&"ontouchend"in document},this._checkForMobile(),(0,p.CG)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(e){return document.createElement("video")}_reportDrawCall(e=1){this._drawCalls?.addCount(e,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(e,t){throw Error("createImageBitmapFromSource is not implemented")}createImageBitmap(e,t){return createImageBitmap(e,t)}resizeImageBitmap(e,t,i){throw Error("resizeImageBitmap is not implemented")}getFontOffset(e){throw Error("getFontOffset is not implemented")}static _CreateCanvas(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);let i=document.createElement("canvas");return i.width=e,i.height=t,i}createCanvas(e,t){return E._CreateCanvas(e,t)}static _FileToolsLoadImage(e,t,i,r,s,n){throw(0,_.S)("FileTools")}_loadFile(e,t,i,r,s,n){let a=(0,g.wv)(e,t,i,r,s,n);return this._activeRequests.push(a),a.onCompleteObservable.add(()=>{let e=this._activeRequests.indexOf(a);-1!==e&&this._activeRequests.splice(e,1)}),a}static _FileToolsLoadFile(e,t,i,r,s,n){if(g.an.loadFile)return g.an.loadFile(e,t,i,r,s,n);throw(0,_.S)("FileTools")}dispose(){for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();for(let e of(this.releaseComputeEffects?.(),n.Q.ResetCache(),this._activeRequests))e.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,p.CG)()&&window.removeEventListener("resize",this._checkForMobile);let e=r.l.Instances.indexOf(this);e>=0&&r.l.Instances.splice(e,1),r.l.Instances.length||(r.l.OnEnginesDisposedObservable.notifyObservers(this),r.l.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(e){throw(0,_.S)("LoadingScreen")}static MarkAllMaterialsAsDirty(e,t){for(let i=0;i<r.l.Instances.length;i++){let s=r.l.Instances[i];for(let i=0;i<s.scenes.length;i++)s.scenes[i].markAllMaterialsAsDirty(e,t)}}}E._RenderPassIdCounter=0,E._RescalePostProcessFactory=null,E.CollisionsEpsilon=.001,E.QueueNewFrame=T},74800:function(e,t,i){i.d(t,{$5:function(){return a},$Y:function(){return d},AY:function(){return u},F9:function(){return _},RB:function(){return h},RD:function(){return c},ih:function(){return o},pp:function(){return l},uu:function(){return p}});var r=i(28143),s=i(3176),n=i(51092);function a(e,t,i){e._onCanvasFocus=()=>{e.onCanvasFocusObservable.notifyObservers(e)},e._onCanvasBlur=()=>{e.onCanvasBlurObservable.notifyObservers(e)},e._onCanvasContextMenu=t=>{e.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",e._onCanvasFocus),t.addEventListener("blur",e._onCanvasBlur),t.addEventListener("contextmenu",e._onCanvasContextMenu),e._onBlur=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.disable(),e._windowIsBackground=!0},e._onFocus=()=>{e.disablePerformanceMonitorInBackground&&e.performanceMonitor.enable(),e._windowIsBackground=!1},e._onCanvasPointerOut=i=>{document.elementFromPoint(i.clientX,i.clientY)!==t&&e.onCanvasPointerOutObservable.notifyObservers(i)};let n=e.getHostWindow();n&&"function"==typeof n.addEventListener&&(n.addEventListener("blur",e._onBlur),n.addEventListener("focus",e._onFocus)),t.addEventListener("pointerout",e._onCanvasPointerOut),!i.doNotHandleTouchAction&&t&&t.setAttribute&&(t.setAttribute("touch-action","none"),t.style.touchAction="none",t.style.webkitTapHighlightColor="transparent"),!s.a.audioEngine&&i.audioEngine&&s.a.AudioEngineFactory&&(s.a.audioEngine=s.a.AudioEngineFactory(e.getRenderingCanvas(),e.getAudioContext(),e.getAudioDestination())),(0,r.n5)()&&(e._onFullscreenChange=()=>{e.isFullscreen=!!document.fullscreenElement,e.isFullscreen&&e._pointerLockRequested&&t&&d(t)},document.addEventListener("fullscreenchange",e._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",e._onFullscreenChange,!1),e._onPointerLockChange=()=>{e.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",e._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",e._onPointerLockChange,!1)),e.enableOfflineSupport=void 0!==s.a.OfflineProviderFactory,e._deterministicLockstep=!!i.deterministicLockstep,e._lockstepMaxSteps=i.lockstepMaxSteps||0,e._timeStep=i.timeStep||1/60}function o(e,t){1===n.l.Instances.length&&s.a.audioEngine&&(s.a.audioEngine.dispose(),s.a.audioEngine=null);let i=e.getHostWindow();i&&"function"==typeof i.removeEventListener&&(i.removeEventListener("blur",e._onBlur),i.removeEventListener("focus",e._onFocus)),t&&(t.removeEventListener("focus",e._onCanvasFocus),t.removeEventListener("blur",e._onCanvasBlur),t.removeEventListener("pointerout",e._onCanvasPointerOut),t.removeEventListener("contextmenu",e._onCanvasContextMenu)),(0,r.n5)()&&(document.removeEventListener("fullscreenchange",e._onFullscreenChange),document.removeEventListener("mozfullscreenchange",e._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",e._onFullscreenChange),document.removeEventListener("msfullscreenchange",e._onFullscreenChange),document.removeEventListener("pointerlockchange",e._onPointerLockChange),document.removeEventListener("mspointerlockchange",e._onPointerLockChange),document.removeEventListener("mozpointerlockchange",e._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",e._onPointerLockChange))}function h(e){let t=document.createElement("span");t.textContent="Hg",t.style.font=e;let i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";let r=document.createElement("div");r.style.whiteSpace="nowrap",r.appendChild(t),r.appendChild(i),document.body.appendChild(r);let s=0,n=0;try{n=i.getBoundingClientRect().top-t.getBoundingClientRect().top,i.style.verticalAlign="baseline",s=i.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(r)}return{ascent:s,height:n,descent:n-s}}function l(e,t,i){return new Promise((r,s)=>{let n=new Image;n.onload=()=>{n.decode().then(()=>{e.createImageBitmap(n,i).then(e=>{r(e)})})},n.onerror=()=>{s(`Error loading image ${n.src}`)},n.src=t})}function u(e,t,i,r){let s=e.createCanvas(i,r).getContext("2d");if(!s)throw Error("Unable to get 2d context for resizeImageBitmap");return s.drawImage(t,0,0),s.getImageData(0,0,i,r).data}function c(e){let t=e.requestFullscreen||e.webkitRequestFullscreen;t&&t.call(e)}function _(){let e=document;document.exitFullscreen?document.exitFullscreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}function d(e){if(e.requestPointerLock){let t=e.requestPointerLock();t instanceof Promise?t.then(()=>{e.focus()}).catch(()=>{}):e.focus()}}function p(){document.exitPointerLock&&document.exitPointerLock()}},89936:function(e,t,i){i.d(t,{D:function(){return d}});var r=i(9520),s=i(51092),n=i(46263),a=i(99558),o=i(72563),h=i(9719),l=i(74387);i(95330),i(40067),i(77102),i(63296),i(38679),i(39936),i(69662),i(57694),i(27344),i(15732),i(94140),i(97531),i(8821),i(80123),i(89399);var u=i(3176),c=i(74800),_=i(51366);i(70701);class d extends n.ThinEngine{static get NpmPackage(){return u.a.NpmPackage}static get Version(){return u.a.Version}static get Instances(){return s.l.Instances}static get LastCreatedEngine(){return s.l.LastCreatedEngine}static get LastCreatedScene(){return s.l.LastCreatedScene}static DefaultLoadingScreenFactory(e){return u.a.DefaultLoadingScreenFactory(e)}get _supportsHardwareTextureRescaling(){return!!d._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(e,t,i,r=!1){if(super(e,t,i,r),this.customAnimationFrameRequester=null,this._performanceMonitor=new a.A,this._drawCalls=new _.z,!e)return;this._features.supportRenderPasses=!0,i=this._creationOptions,e.getContext&&this._sharedInit(e)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(e){super._sharedInit(e),(0,c.$5)(this,e,this._creationOptions)}resizeImageBitmap(e,t,i){return(0,c.AY)(this,e,t,i)}_createImageBitmapFromSource(e,t){return(0,c.pp)(this,e,t)}switchFullscreen(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)}enterFullscreen(e){!this.isFullscreen&&(this._pointerLockRequested=e,this._renderingCanvas&&(0,c.RD)(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&(0,c.F9)()}setDitheringState(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(e,t,i,r){let s=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),s}scissorClear(e,t,i,r,s){this.enableScissor(e,t,i,r),this.clear(s,!0,!0,!0),this.disableScissor()}enableScissor(e,t,i,r){let s=this._gl;s.enable(s.SCISSOR_TEST),s.scissor(e,t,i,r)}disableScissor(){let e=this._gl;e.disable(e.SCISSOR_TEST)}_loadFileAsync(e,t,i){return new Promise((r,s)=>{this._loadFile(e,e=>{r(e)},void 0,t,i,(e,t)=>{s(t)})})}getVertexShaderSource(e){let t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null}getFragmentShaderSource(e){let t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(let e of this.scenes)e.resetCachedMaterial(),e._rebuildGeometries();for(let e of this._virtualScenes)e.resetCachedMaterial(),e._rebuildGeometries();super._rebuildBuffers()}getFontOffset(e){return(0,c.RB)(e)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;let{cancelAnimationFrame:e}=this.customAnimationFrameRequester;e&&e(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let e=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&(0,c.$Y)(this._renderingCanvas)}exitPointerlock(){(0,c.uu)()}beginFrame(){this._measureFps(),super.beginFrame()}_deletePipelineContext(e){e&&e.program&&e.transformFeedback&&(this.deleteTransformFeedback(e.transformFeedback),e.transformFeedback=null),super._deletePipelineContext(e)}createShaderProgram(e,t,i,r,s,n=null){s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);let a=super.createShaderProgram(e,t,i,r,s,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),a}_createShaderProgram(e,t,i,r,s=null){let n=r.createProgram();if(e.program=n,!n)throw Error("Unable to create program");if(r.attachShader(n,t),r.attachShader(n,i),this.webGLVersion>1&&s){let t=this.createTransformFeedback();this.bindTransformFeedback(t),this.setTranformFeedbackVaryings(n,s),e.transformFeedback=t}return r.linkProgram(n),this.webGLVersion>1&&s&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),n}_releaseTexture(e){super._releaseTexture(e)}_releaseRenderTargetWrapper(e){super._releaseRenderTargetWrapper(e),this.scenes.forEach(t=>{t.postProcesses.forEach(t=>{t._outputTexture===e&&(t._outputTexture=null)}),t.cameras.forEach(t=>{t._postProcesses.forEach(t=>{t&&t._outputTexture===e&&(t._outputTexture=null)})})})}_rescaleTexture(e,t,i,r,s){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);let n=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&d._RescalePostProcessFactory&&(this._rescalePostProcess=d._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;let a=()=>{this._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};let a=i;a||(a=this.scenes[this.scenes.length-1]),a.postProcessManager.directRender([this._rescalePostProcess],n,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,r,0,0,t.width,t.height,0),this.unBindFramebuffer(n),n.dispose(),s&&s()},o=this._rescalePostProcess.getEffect();o?o.executeWhenCompiled(a):this._rescalePostProcess.onEffectCreatedObservable.addOnce(e=>{e.executeWhenCompiled(a)})}}wrapWebGLTexture(e,t=!1,i=3,s=0,n=0){let a=new l.B(e,this._gl),o=new r.l(this,0,!0);return o._hardwareTexture=a,o.baseWidth=s,o.baseHeight=n,o.width=s,o.height=n,o.isReady=!0,o.useMipMaps=t,this.updateTextureSamplingMode(i,o),o}_uploadImageToTexture(e,t,i=0,r=0){let s=this._gl,n=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),o=this._getRGBABufferInternalSizedFormat(e.type,a),h=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(h,e,!0),this._unpackFlipY(e.invertY);let l=s.TEXTURE_2D;e.isCube&&(l=s.TEXTURE_CUBE_MAP_POSITIVE_X+i),s.texImage2D(l,r,o,a,n,t),this._bindTextureDirectly(h,null,!0)}updateTextureComparisonFunction(e,t){if(1===this.webGLVersion){h.Y.Error("WebGL 1 does not support texture comparison.");return}let i=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}createInstancesBuffer(e){let t=this._gl.createBuffer();if(!t)throw Error("Unable to create instance buffer");let i=new o.M(t);return i.capacity=e,this.bindArrayBuffer(i),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),i.references=1,i}deleteInstancesBuffer(e){this._gl.deleteBuffer(e)}_clientWaitAsync(e,t=0,i=10){let r=this._gl;return new Promise((s,n)=>{let a=()=>{let o=r.clientWaitSync(e,t,0);if(o==r.WAIT_FAILED){n();return}if(o==r.TIMEOUT_EXPIRED){setTimeout(a,i);return}s()};a()})}_readPixelsAsync(e,t,i,r,s,n,a){if(this._webGLVersion<2)throw Error("_readPixelsAsync only work on WebGL2+");let o=this._gl,h=o.createBuffer();o.bindBuffer(o.PIXEL_PACK_BUFFER,h),o.bufferData(o.PIXEL_PACK_BUFFER,a.byteLength,o.STREAM_READ),o.readPixels(e,t,i,r,s,n,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);let l=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);return l?(o.flush(),this._clientWaitAsync(l,0,10).then(()=>(o.deleteSync(l),o.bindBuffer(o.PIXEL_PACK_BUFFER,h),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteBuffer(h),a))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),(0,c.ih)(this,this._renderingCanvas),super.dispose()}}d.ALPHA_DISABLE=0,d.ALPHA_ADD=1,d.ALPHA_COMBINE=2,d.ALPHA_SUBTRACT=3,d.ALPHA_MULTIPLY=4,d.ALPHA_MAXIMIZED=5,d.ALPHA_ONEONE=6,d.ALPHA_PREMULTIPLIED=7,d.ALPHA_PREMULTIPLIED_PORTERDUFF=8,d.ALPHA_INTERPOLATE=9,d.ALPHA_SCREENMODE=10,d.DELAYLOADSTATE_NONE=0,d.DELAYLOADSTATE_LOADED=1,d.DELAYLOADSTATE_LOADING=2,d.DELAYLOADSTATE_NOTLOADED=4,d.NEVER=512,d.ALWAYS=519,d.LESS=513,d.EQUAL=514,d.LEQUAL=515,d.GREATER=516,d.GEQUAL=518,d.NOTEQUAL=517,d.KEEP=7680,d.REPLACE=7681,d.INCR=7682,d.DECR=7683,d.INVERT=5386,d.INCR_WRAP=34055,d.DECR_WRAP=34056,d.TEXTURE_CLAMP_ADDRESSMODE=0,d.TEXTURE_WRAP_ADDRESSMODE=1,d.TEXTURE_MIRROR_ADDRESSMODE=2,d.TEXTUREFORMAT_ALPHA=0,d.TEXTUREFORMAT_LUMINANCE=1,d.TEXTUREFORMAT_LUMINANCE_ALPHA=2,d.TEXTUREFORMAT_RGB=4,d.TEXTUREFORMAT_RGBA=5,d.TEXTUREFORMAT_RED=6,d.TEXTUREFORMAT_R=6,d.TEXTUREFORMAT_RG=7,d.TEXTUREFORMAT_RED_INTEGER=8,d.TEXTUREFORMAT_R_INTEGER=8,d.TEXTUREFORMAT_RG_INTEGER=9,d.TEXTUREFORMAT_RGB_INTEGER=10,d.TEXTUREFORMAT_RGBA_INTEGER=11,d.TEXTURETYPE_UNSIGNED_BYTE=0,d.TEXTURETYPE_UNSIGNED_INT=0,d.TEXTURETYPE_FLOAT=1,d.TEXTURETYPE_HALF_FLOAT=2,d.TEXTURETYPE_BYTE=3,d.TEXTURETYPE_SHORT=4,d.TEXTURETYPE_UNSIGNED_SHORT=5,d.TEXTURETYPE_INT=6,d.TEXTURETYPE_UNSIGNED_INTEGER=7,d.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,d.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,d.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,d.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,d.TEXTURETYPE_UNSIGNED_INT_24_8=12,d.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,d.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,d.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,d.TEXTURE_NEAREST_SAMPLINGMODE=1,d.TEXTURE_BILINEAR_SAMPLINGMODE=2,d.TEXTURE_TRILINEAR_SAMPLINGMODE=3,d.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,d.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,d.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,d.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,d.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,d.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,d.TEXTURE_NEAREST_LINEAR=7,d.TEXTURE_NEAREST_NEAREST=1,d.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,d.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,d.TEXTURE_LINEAR_LINEAR=2,d.TEXTURE_LINEAR_NEAREST=12,d.TEXTURE_EXPLICIT_MODE=0,d.TEXTURE_SPHERICAL_MODE=1,d.TEXTURE_PLANAR_MODE=2,d.TEXTURE_CUBIC_MODE=3,d.TEXTURE_PROJECTION_MODE=4,d.TEXTURE_SKYBOX_MODE=5,d.TEXTURE_INVCUBIC_MODE=6,d.TEXTURE_EQUIRECTANGULAR_MODE=7,d.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,d.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,d.SCALEMODE_FLOOR=1,d.SCALEMODE_NEAREST=2,d.SCALEMODE_CEILING=3},51092:function(e,t,i){i.d(t,{l:function(){return s}});var r=i(82877);class s{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}s.Instances=[],s.OnEnginesDisposedObservable=new r.y$,s._LastCreatedScene=null,s.UseFallbackTexture=!0,s.FallbackTexture=""},29281:function(e,t,i){i.d(t,{Z:function(){return r}});class r{static SetMatrixPrecision(e){if(r.MatrixTrackPrecisionChange=!1,e&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(let e=0;e<r.MatrixTrackedMatrices.length;++e){let t=r.MatrixTrackedMatrices[e],i=t._m;t._m=Array(16);for(let e=0;e<16;++e)t._m[e]=i[e]}r.MatrixUse64Bits=e,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null}}r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[]},22265:function(e,t,i){i.d(t,{r:function(){return r}});class r{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){return this._textures?.[0]??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}get samples(){return this._samples}setSamples(e,t=!0,i=!1){if(this.samples===e&&!i)return e;let r=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e);return this._samples=e,r}constructor(e,t,i,r,s){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=i,this._engine=r,this._depthStencilTexture=null,this.label=s}setTextures(e){Array.isArray(e)?this._textures=e:e?this._textures=[e]:this._textures=null}setTexture(e,t=0,i=!0){this._textures||(this._textures=[]),this._textures[t]!==e&&(this._textures[t]&&i&&this._textures[t].dispose(),this._textures[t]=e)}setLayerAndFaceIndices(e,t){this._layerIndices=e,this._faceIndices=t}setLayerAndFaceIndex(e=0,t,i){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==t&&t>=0&&(this._layerIndices[e]=t),void 0!==i&&i>=0&&(this._faceIndices[e]=i)}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,s=14,n){return this._depthStencilTexture?.dispose(),this._depthStencilTextureWithStencil=i,this._depthStencilTextureLabel=n,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this._isCube,samples:r,depthTextureFormat:s,label:n},this),this._depthStencilTexture}_shareDepth(e){this.shareDepth(e)}shareDepth(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,e._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let e=null;if(this._isMulti){let t=this.textures;if(t&&t.length>0){let i=!1,r=t.length,s=-1,n=t[t.length-1]._source;(14===n||12===n)&&(i=!0,s=t[t.length-1].format,r--);let a=[],o=[],h=[],l=[],u=[],c=[],_=[],d={};for(let e=0;e<r;++e){let i=t[e];a.push(i.samplingMode),o.push(i.type),h.push(i.format),void 0!==d[i.uniqueId]?(l.push(-1),_.push(0)):(d[i.uniqueId]=e,i.is2DArray?(l.push(35866),_.push(i.depth)):i.isCube?(l.push(34067),_.push(0)):i.is3D?(l.push(32879),_.push(i.depth)):(l.push(3553),_.push(0))),this._faceIndices&&u.push(this._faceIndices[e]??0),this._layerIndices&&c.push(this._layerIndices[e]??0)}let p={samplingModes:a,generateMipMaps:t[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:i,depthTextureFormat:s,types:o,formats:h,textureCount:r,targetTypes:l,faceIndex:u,layerIndex:c,layerCounts:_,label:this.label},f={width:this.width,height:this.height,depth:this.depth};e=this._engine.createMultipleRenderTarget(f,p);for(let i=0;i<r;++i){if(-1!==l[i])continue;let r=d[t[i].uniqueId];e.setTexture(e.textures[r],i)}}}else{let t={};if(t.generateDepthBuffer=this._generateDepthBuffer,t.generateMipMaps=this.texture?.generateMipMaps??!1,t.generateStencilBuffer=this._generateStencilBuffer,t.samplingMode=this.texture?.samplingMode,t.type=this.texture?.type,t.format=this.texture?.format,t.noColorAttachment=!this._textures,t.label=this.label,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,t);else{let i={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?this.texture?.depth:void 0};e=this._engine.createRenderTargetTexture(i,t)}e.texture&&(e.texture.isReady=!0)}return e}_swapRenderTargetWrapper(e){if(this._textures&&e._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){let e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){let t=this._depthStencilTexture.samplingMode,i=this._depthStencilTexture.format;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,2===t||3===t||11===t,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,i,this._depthStencilTextureLabel)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}}releaseTextures(){if(this._textures)for(let e=0;e<this._textures?.length;++e)this._textures[e].dispose();this._textures=null}dispose(e=!1){e||(this._depthStencilTexture?.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}},29427:function(e,t,i){i.d(t,{v:function(){return r}});class r{static GetShadersRepository(e=0){return 0===e?r.ShadersRepository:r.ShadersRepositoryWGSL}static GetShadersStore(e=0){return 0===e?r.ShadersStore:r.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return 0===e?r.IncludesShadersStore:r.IncludesShadersStoreWGSL}}r.ShadersRepository="src/Shaders/",r.ShadersStore={},r.IncludesShadersStore={},r.ShadersRepositoryWGSL="src/ShadersWGSL/",r.ShadersStoreWGSL={},r.IncludesShadersStoreWGSL={}},37112:function(e,t,i){i.d(t,{AM:function(){return l},H6:function(){return c},HN:function(){return d},KG:function(){return p},PR:function(){return T},Q:function(){return m},iU:function(){return o},s5:function(){return _},tQ:function(){return u},tY:function(){return h}});var r=i(17949),s=i(56172);let n=new WeakMap,a={_webGLVersion:2,cachedPipelines:{}};function o(e){let t=n.get(e);if(!t){if(!e)return a;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,cachedPipelines:{}},n.set(e,t)}return t}function h(e){n.delete(e)}function l(e,t,i,r,s,n){let a=o(r);return n||(n=a._createShaderProgramInjection??_),n(e,g(t,"vertex",r,a._contextWasLost),g(i,"fragment",r,a._contextWasLost),r,s,a.validateShaderPrograms)}function u(e,t,i,r,s,n=null,a){let h=o(s);a||(a=h._createShaderProgramInjection??_);let l=h._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return a(e,f(t,"vertex",r,l,s,h._contextWasLost),f(i,"fragment",r,l,s,h._contextWasLost),s,n,h.validateShaderPrograms)}function c(e,t){let i=new r.y,s=o(e);return s.parallelShaderCompile&&(i.isParallelCompiled=!0),i.context=s._context,i}function _(e,t,i,r,s=null,n){let a=r.createProgram();if(e.program=a,!a)throw Error("Unable to create program");return r.attachShader(a,t),r.attachShader(a,i),r.linkProgram(a),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||d(e,r,n),a}function d(e,t,i){let r=e.context,s=e.vertexShader,n=e.fragmentShader,a=e.program;if(!r.getProgramParameter(a,r.LINK_STATUS)){if(!t.getShaderParameter(s,t.COMPILE_STATUS)){let i=t.getShaderInfoLog(s);if(i)throw e.vertexCompilationError=i,Error("VERTEX SHADER "+i)}if(!t.getShaderParameter(n,t.COMPILE_STATUS)){let i=t.getShaderInfoLog(n);if(i)throw e.fragmentCompilationError=i,Error("FRAGMENT SHADER "+i)}let i=r.getProgramInfoLog(a);if(i)throw e.programLinkError=i,Error(i)}if(i&&(r.validateProgram(a),!r.getProgramParameter(a,r.VALIDATE_STATUS))){let t=r.getProgramInfoLog(a);if(t)throw e.programValidationError=t,Error(t)}r.deleteShader(s),r.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function p(e,t,i,r,s,n,a,h,c,_="",d,p,f){let g=o(e.context);p||(p=g.createRawShaderProgramInjection??l),f||(f=g.createShaderProgramInjection??u),r?e.program=p(e,t,i,e.context,c):e.program=f(e,t,i,h,e.context,c),e.program.__SPECTOR_rebuildProgram=a,d()}function f(e,t,i,r,n,a){return g((0,s.Gb)(e,i,r),t,n,a)}function g(e,t,i,r){let s=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!s){let e=i.NO_ERROR,s=i.NO_ERROR;for(;(s=i.getError())!==i.NO_ERROR;)e=s;throw Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${r}`)}return i.shaderSource(s,e),i.compileShader(s),s}function m(e,t){t.useProgram(e)}function T(e,t){if(!e.isParallelCompiled){t(e);return}let i=e.onCompiled;e.onCompiled=()=>{i?.(),t(e)}}},46263:function(e,t,i){i.r(t),i.d(t,{ThinEngine:function(){return T}});var r=i(37112),s=i(44673),n=i(9719),a=i(28143);class o{constructor(){this.shaderLanguage=0}postProcessor(e,t,i,r,s){return s.drawBuffersExtensionDisabled&&(e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),e}}var h=i(99091),l=i(72563),u=i(61146),c=i(3176),_=i(74387),d=i(9520),p=i(97937),f=i(56172),g=i(97827);class m{}class T extends c.a{get name(){return this._name}set name(e){this._name=e}get version(){return this._webGLVersion}static get ShadersRepository(){return p.Q.ShadersRepository}static set ShadersRepository(e){p.Q.ShadersRepository=e}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(e){this._framebufferDimensionsObject=e}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(e,t,i,s){if(i=i||{},super(t??i.antialias,i,s),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=[],this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=[],this._currentInstanceLocations=[],this._currentInstanceBuffers=[],this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=[],this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!e)return;let a=null;if(e.getContext){if(a=e,this._renderingCanvas=a,void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.xrCompatible&&(i.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();let e=navigator.userAgent;for(let t of T.ExceptionList){let r=t.key,s=t.targets;if(new RegExp(r).test(e)){if(t.capture&&t.captureConstraint){let i=t.capture,r=t.captureConstraint,s=new RegExp(i).exec(e);if(s&&s.length>0&&parseInt(s[s.length-1])>=r)continue}for(let e of s)switch(e){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=e=>{e.preventDefault(),this._contextWasLost=!0,n.Y.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost(()=>this._initGLContext())},a.addEventListener("webglcontextlost",this._onContextLost,!1),a.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference=i.powerPreference||"high-performance"),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=a.getContext("webgl2",i)||a.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!a)throw Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",i)||a.getContext("experimental-webgl",i)}catch(e){throw Error("WebGL not supported")}}if(!this._gl)throw Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";let t=this._gl.getContextAttributes();t&&(i.stencil=t.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let e=0;e<this._caps.maxVertexAttribs;e++)this._currentBufferPointers[e]=new m;this._shaderProcessor=this.webGLVersion>1?new h.C:new o;let l=`Babylon.js v${T.Version}`;n.Y.Log(l+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",l);let u=(0,r.iU)(this._gl);u.validateShaderPrograms=this.validateShaderPrograms,u.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(e){return null}areAllEffectsReady(){for(let e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);let e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{let e=this._gl.getExtension("WEBGL_draw_buffers");if(null!==e){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=e.drawBuffersWEBGL.bind(e),this._caps.maxDrawBuffers=this._gl.getParameter(e.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let t=0;t<16;t++)this._gl["COLOR_ATTACHMENT"+t+"_WEBGL"]=e["COLOR_ATTACHMENT"+t+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{let e=this._gl.getExtension("WEBGL_depth_texture");null!=e&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{let e=this._gl.getExtension("OES_vertex_array_object");null!=e&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=e.createVertexArrayOES.bind(e),this._gl.bindVertexArray=e.bindVertexArrayOES.bind(e),this._gl.deleteVertexArray=e.deleteVertexArrayOES.bind(e))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{let e=this._gl.getExtension("ANGLE_instanced_arrays");null!=e?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),this._gl.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),this._gl.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){let e=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);e&&t&&(this._caps.highPrecisionShaderSupported=0!==e.precision&&0!==t.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{let e=this._gl.getExtension("EXT_blend_minmax");null!=e&&(this._caps.blendMinMax=!0,this._gl.MAX=e.MAX_EXT,this._gl.MIN=e.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{let e=this._gl.getExtension("EXT_sRGB");null!=e&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:e.SRGB_EXT,SRGB8:e.SRGB_ALPHA_EXT,SRGB8_ALPHA8:e.SRGB_ALPHA_EXT})}if(this._creationOptions){let e=this._creationOptions.forceSRGBBufferSupportState;void 0!==e&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&e)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let e=0;e<this._maxSimultaneousTextures;e++)this._nextFreeTextureSlots.push(e);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"==typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);let e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){let e=this.getGlInfo();return e&&e.renderer?e.renderer:""}getRenderWidth(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(e=!1){return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(e,t,i,r=!1){let s=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=s;let n=0;if(t&&e){let t=!0;if(this._currentRenderTarget){let i=this._currentRenderTarget.texture?.format;if(8===i||9===i||10===i||11===i){let i=this._currentRenderTarget.texture?.type;7===i||5===i?(T._TempClearColorUint32[0]=255*e.r,T._TempClearColorUint32[1]=255*e.g,T._TempClearColorUint32[2]=255*e.b,T._TempClearColorUint32[3]=255*e.a,this._gl.clearBufferuiv(this._gl.COLOR,0,T._TempClearColorUint32)):(T._TempClearColorInt32[0]=255*e.r,T._TempClearColorInt32[1]=255*e.g,T._TempClearColorInt32[2]=255*e.b,T._TempClearColorInt32[3]=255*e.a,this._gl.clearBufferiv(this._gl.COLOR,0,T._TempClearColorInt32)),t=!1}}t&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT)}i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)}_viewport(e,t,i,r){(e!==this._viewportCached.x||t!==this._viewportCached.y||i!==this._viewportCached.z||r!==this._viewportCached.w)&&(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw Error("Not Supported by ThinEngine")}bindFramebuffer(e,t=0,i,r,s,a=0,o=0){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._framebuffer);let h=this._gl;e.isMulti||(e.is2DArray||e.is3D?(h.framebufferTextureLayer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,e.texture._hardwareTexture?.underlyingResource,a,o),e._currentLOD=a):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.texture._hardwareTexture?.underlyingResource,a):e._currentLOD===a||(h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,e.texture._hardwareTexture?.underlyingResource,a),e._currentLOD=a));let l=e._depthStencilTexture;if(l){e.is3D&&(e.texture.width!==l.width||e.texture.height!==l.height||e.texture.depth!==l.depth)&&n.Y.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment");let i=e._depthStencilTextureWithStencil?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT;e.is2DArray||e.is3D?h.framebufferTextureLayer(h.FRAMEBUFFER,i,l._hardwareTexture?.underlyingResource,a,o):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,i,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,l._hardwareTexture?.underlyingResource,a):h.framebufferTexture2D(h.FRAMEBUFFER,i,h.TEXTURE_2D,l._hardwareTexture?.underlyingResource,a)}e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._MSAAFramebuffer),this._cachedViewport&&!s?this.setViewport(this._cachedViewport,i,r):(!i&&(i=e.width,a&&(i/=Math.pow(2,a))),!r&&(r=e.height,a&&(r/=Math.pow(2,a))),this._viewport(0,0,i,r)),this.wipeCaches()}setState(e,t=0,i,r=!1,s,n,a=0){(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);let o=this.cullBackFaces??s??!0?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==o||i)&&(this._depthCullingState.cullFace=o),this.setZOffset(t),this.setZOffsetUnits(a);let h=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==h||i)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=n}_bindUnboundFramebuffer(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(e){let t=this._getTextureTarget(e);this._bindTextureDirectly(t,e,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}unBindFramebuffer(e,t=!1,i){this._currentRenderTarget=null;let r=this._gl;if(e._MSAAFramebuffer){if(e.isMulti){this.unBindMultiColorAttachmentFramebuffer(e,t,i);return}r.bindFramebuffer(r.READ_FRAMEBUFFER,e._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST)}!e.texture?.generateMipMaps||t||e.isCube||this.generateMipmaps(e.texture),i&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),i()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(e,t,i){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}_createVertexBuffer(e,t){let i=this._gl.createBuffer();if(!i)throw Error("Unable to create vertex buffer");let r=new l.M(i);return this.bindArrayBuffer(r),"number"!=typeof e?e instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t),r.capacity=4*e.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),r.capacity=e.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(e),t),r.capacity=e),this._resetVertexBufferBinding(),r.references=1,r}createDynamicVertexBuffer(e,t){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(e,t,i){let r=this._gl.createBuffer(),s=new l.M(r);if(!r)throw Error("Unable to create index buffer");this.bindIndexBuffer(s);let n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),s.references=1,s.is32Bits=4===n.BYTES_PER_ELEMENT,s}_normalizeIndexData(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(let t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e)}return new Uint16Array(e)}bindArrayBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}bindUniformBlock(e,t,i){let r=e.program,s=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,s,i)}bindIndexBuffer(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}updateArrayBuffer(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}_vertexAttribPointer(e,t,i,r,s,n,a){let o=this._currentBufferPointers[t];if(!o)return;let h=!1;o.active?(o.buffer!==e&&(o.buffer=e,h=!0),o.size!==i&&(o.size=i,h=!0),o.type!==r&&(o.type=r,h=!0),o.normalized!==s&&(o.normalized=s,h=!0),o.stride!==n&&(o.stride=n,h=!0),o.offset!==a&&(o.offset=a,h=!0)):(h=!0,o.active=!0,o.index=t,o.size=i,o.type=r,o.normalized=s,o.stride=n,o.offset=a,o.buffer=e),(h||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),r===this._gl.UNSIGNED_INT||r===this._gl.INT?this._gl.vertexAttribIPointer(t,i,r,n,a):this._gl.vertexAttribPointer(t,i,r,s,n,a))}_bindIndexBufferWithCache(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}_bindVertexBuffersAttributes(e,t,i){let r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let s=0;s<r.length;s++){let n=t.getAttributeLocation(s);if(n>=0){let t=r[s],a=null;if(i&&(a=i[t]),a||(a=e[t]),!a)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);let o=a.getBuffer();o&&(this._vertexAttribPointer(o,n,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(o))))}}}recordVertexArrayObject(e,t,i,r){let s=this._gl.createVertexArray();if(!s)throw Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(s),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),s}bindVertexArrayObject(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(e,t,i,r,s){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==s){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=s;let t=s.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let n=0;for(let a=0;a<t;a++)if(a<i.length){let t=s.getAttributeLocation(a);t>=0&&(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0,this._vertexAttribPointer(e,t,i[a],this._gl.FLOAT,!1,r,n)),n+=4*i[a]}}this._bindIndexBufferWithCache(t)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(e,t,i,r){(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i)&&(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,r)),this._bindIndexBufferWithCache(t)}unbindInstanceAttributes(){let e;for(let t=0,i=this._currentInstanceLocations.length;t<i;t++){let i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));let r=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(e){this._gl.deleteVertexArray(e)}_releaseBuffer(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)}_deleteBuffer(e){this._gl.deleteBuffer(e.underlyingResource)}updateAndBindInstancesBuffer(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(let t=0;t<4;t++){let r=i[t];this._vertexAttribArraysEnabled[r]||(this._gl.enableVertexAttribArray(r),this._vertexAttribArraysEnabled[r]=!0),this._vertexAttribPointer(e,r,4,this._gl.FLOAT,!1,64,16*t),this._gl.vertexAttribDivisor(r,1),this._currentInstanceLocations.push(r),this._currentInstanceBuffers.push(e)}}bindInstancesBuffer(e,t,i=!0){this.bindArrayBuffer(e);let r=0;if(i)for(let e=0;e<t.length;e++)r+=4*t[e].attributeSize;for(let i=0;i<t.length;i++){let s=t[i];void 0===s.index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,r,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))}}disableInstanceAttributeByName(e){if(!this._currentEffect)return;let t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}disableInstanceAttribute(e){let t,i=!1;for(;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,t=this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}disableAttributeByIndex(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}draw(e,t,i,r){this.drawElementsType(e?0:1,t,i,r)}drawPointClouds(e,t,i){this.drawArraysType(2,e,t,i)}drawUnIndexed(e,t,i,r){this.drawArraysType(e?0:1,t,i,r)}drawElementsType(e,t,i,r){this.applyStates(),this._reportDrawCall();let s=this._drawMode(e),n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(s,i,n,t*a,r):this._gl.drawElements(s,i,n,t*a)}drawArraysType(e,t,i,r){this.applyStates(),this._reportDrawCall();let s=this._drawMode(e);r?this._gl.drawArraysInstanced(s,t,i,r):this._gl.drawArrays(s,t,i)}_drawMode(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];let t=e.getPipelineContext();t&&this._deletePipelineContext(t)}_deletePipelineContext(e){e&&e.program&&(e.program.__SPECTOR_rebuildProgram=null,(0,g.ZI)(e),this._gl.deleteProgram(e.program))}_getGlobalDefines(e){return(0,f.sk)(e,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(e,t,i,s,n,a,o,h,l,u=0,c){let _="string"==typeof e?e:e.vertexToken||e.vertexSource||e.vertexElement||e.vertex,d="string"==typeof e?e:e.fragmentToken||e.fragmentSource||e.fragmentElement||e.fragment,f=this._getGlobalDefines(),g=n??t.defines??"";f&&(g+=f);let m=_+"+"+d+"@"+g;if(this._compiledEffects[m]){let e=this._compiledEffects[m];return o&&e.isReady()&&o(e),e._refCount++,e}this._gl&&(0,r.iU)(this._gl);let T=new p.Q(e,t,i,s,this,n,a,o,h,l,m,t.shaderLanguage??u,t.extraInitializationsAsync??c);return this._compiledEffects[m]=T,T}_getShaderSource(e){return this._gl.getShaderSource(e)}createRawShaderProgram(e,t,i,s,n=null){let a=(0,r.iU)(this._gl);return a._contextWasLost=this._contextWasLost,a.validateShaderPrograms=this.validateShaderPrograms,(0,r.AM)(e,t,i,s||this._gl,n)}createShaderProgram(e,t,i,s,n,a=null){let o=(0,r.iU)(this._gl);return o._contextWasLost=this._contextWasLost,o.validateShaderPrograms=this.validateShaderPrograms,(0,r.tQ)(e,t,i,s,n||this._gl,a)}inlineShaderCode(e){return e}createPipelineContext(e){this._gl&&((0,r.iU)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile);let t=(0,r.H6)(this._gl,e);return t.engine=this,t}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(e){return(0,r.HN)(e,this._gl,this.validateShaderPrograms)}_preparePipelineContext(e,t,i,s,n,a,o,h,l,u,c){let _=(0,r.iU)(this._gl);return _._contextWasLost=this._contextWasLost,_.validateShaderPrograms=this.validateShaderPrograms,_._createShaderProgramInjection=this._createShaderProgram.bind(this),_.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),_.createShaderProgramInjection=this.createShaderProgram.bind(this),_.loadFileInjection=this._loadFile.bind(this),(0,r.KG)(e,t,i,s,n,a,o,h,l,u,c)}_createShaderProgram(e,t,i,s,n=null){return(0,r.s5)(e,t,i,s,n)}_isRenderingStateCompiled(e){return!this._isDisposed&&!e._isDisposed&&!!this._gl.getProgramParameter(e.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(e),!0)}_executeWhenRenderingStateIsCompiled(e,t){(0,r.PR)(e,t)}getUniforms(e,t){let i=[];for(let r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e.program,t[r]));return i}getAttributes(e,t){let i=[];for(let r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e.program,t[r]))}catch(e){i.push(-1)}return i}enableEffect(e){(e=null!==e&&(0,s.A)(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}setInt(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)}setInt2(e,t,i){return!!e&&(this._gl.uniform2i(e,t,i),!0)}setInt3(e,t,i,r){return!!e&&(this._gl.uniform3i(e,t,i,r),!0)}setInt4(e,t,i,r,s){return!!e&&(this._gl.uniform4i(e,t,i,r,s),!0)}setIntArray(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)}setIntArray2(e,t){return!!e&&t.length%2==0&&(this._gl.uniform2iv(e,t),!0)}setIntArray3(e,t){return!!e&&t.length%3==0&&(this._gl.uniform3iv(e,t),!0)}setIntArray4(e,t){return!!e&&t.length%4==0&&(this._gl.uniform4iv(e,t),!0)}setUInt(e,t){return!!e&&(this._gl.uniform1ui(e,t),!0)}setUInt2(e,t,i){return!!e&&(this._gl.uniform2ui(e,t,i),!0)}setUInt3(e,t,i,r){return!!e&&(this._gl.uniform3ui(e,t,i,r),!0)}setUInt4(e,t,i,r,s){return!!e&&(this._gl.uniform4ui(e,t,i,r,s),!0)}setUIntArray(e,t){return!!e&&(this._gl.uniform1uiv(e,t),!0)}setUIntArray2(e,t){return!!e&&t.length%2==0&&(this._gl.uniform2uiv(e,t),!0)}setUIntArray3(e,t){return!!e&&t.length%3==0&&(this._gl.uniform3uiv(e,t),!0)}setUIntArray4(e,t){return!!e&&t.length%4==0&&(this._gl.uniform4uiv(e,t),!0)}setArray(e,t){return!!e&&!(t.length<1)&&(this._gl.uniform1fv(e,t),!0)}setArray2(e,t){return!!e&&t.length%2==0&&(this._gl.uniform2fv(e,t),!0)}setArray3(e,t){return!!e&&t.length%3==0&&(this._gl.uniform3fv(e,t),!0)}setArray4(e,t){return!!e&&t.length%4==0&&(this._gl.uniform4fv(e,t),!0)}setMatrices(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)}setMatrix3x3(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)}setMatrix2x2(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)}setFloat(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)}setFloat2(e,t,i){return!!e&&(this._gl.uniform2f(e,t,i),!0)}setFloat3(e,t,i,r){return!!e&&(this._gl.uniform3f(e,t,i,r),!0)}setFloat4(e,t,i,r,s){return!!e&&(this._gl.uniform4f(e,t,i,r,s),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;let e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}wipeCaches(e){(!this.preventCacheWipeBetweenFrames||e)&&(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(e,t){let i=this._gl,r=i.NEAREST,s=i.NEAREST;switch(e){case 11:r=i.LINEAR,s=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:r=i.LINEAR,s=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:r=i.NEAREST,s=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:r=i.NEAREST,s=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:r=i.NEAREST,s=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:r=i.NEAREST,s=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:r=i.NEAREST,s=i.LINEAR;break;case 1:r=i.NEAREST,s=i.NEAREST;break;case 9:r=i.LINEAR,s=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:r=i.LINEAR,s=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:r=i.LINEAR,s=i.LINEAR;break;case 12:r=i.LINEAR,s=i.NEAREST}return{min:s,mag:r}}_createTexture(){let e=this._gl.createTexture();if(!e)throw Error("Unable to create texture");return e}_createHardwareTexture(){return new _.B(this._createTexture(),this._gl)}_createInternalTexture(e,t,i=!0,r=0){let s,a=!1,o=0,h=3,l=5,u=!1,c=1;void 0!==t&&"object"==typeof t?(a=!!t.generateMipMaps,o=void 0===t.type?0:t.type,h=void 0===t.samplingMode?3:t.samplingMode,l=void 0===t.format?5:t.format,u=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,c=t.samples??1,s=t.label):a=!!t,u&&(u=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==o||this._caps.textureFloatLinearFiltering)&&(2!==o||this._caps.textureHalfFloatLinearFiltering)||(h=1),1!==o||this._caps.textureFloat||(o=0,n.Y.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));let _=this._gl,p=new d.l(this,r),f=e.width||e,g=e.height||e,m=e.depth||0,T=e.layers||0,E=this._getSamplingParameters(h,a),b=0!==T?_.TEXTURE_2D_ARRAY:0!==m?_.TEXTURE_3D:_.TEXTURE_2D,R=this._getRGBABufferInternalSizedFormat(o,l,u),C=this._getInternalFormat(l),P=this._getWebGLTextureType(o);return this._bindTextureDirectly(b,p),0!==T?(p.is2DArray=!0,_.texImage3D(b,0,R,f,g,T,0,C,P,null)):0!==m?(p.is3D=!0,_.texImage3D(b,0,R,f,g,m,0,C,P,null)):_.texImage2D(b,0,R,f,g,0,C,P,null),_.texParameteri(b,_.TEXTURE_MAG_FILTER,E.mag),_.texParameteri(b,_.TEXTURE_MIN_FILTER,E.min),_.texParameteri(b,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(b,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),a&&this._gl.generateMipmap(b),this._bindTextureDirectly(b,null),p._useSRGBBuffer=u,p.baseWidth=f,p.baseHeight=g,p.width=f,p.height=g,p.depth=T,p.isReady=!0,p.samples=c,p.generateMipMaps=a,p.samplingMode=h,p.type=o,p.format=l,p.label=s,this._internalTexturesCache.push(p),p}_getUseSRGBBuffer(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}createTexture(e,t,i,r,s=3,n=null,a=null,o=null,h=null,l=null,u=null,c,_,p,f){return this._createTextureBase(e,t,i,r,s,n,a,(...e)=>this._prepareWebGLTexture(...e,l),(e,t,i,s,n,a)=>{let o=this._gl,h=i.width===e&&i.height===t;n._creationFlags=p??0;let l=this._getTexImageParametersForCreateTexture(n.format,n._useSRGBBuffer);if(h)return o.texImage2D(o.TEXTURE_2D,0,l.internalFormat,l.format,l.type,i),!1;let u=this._caps.maxTextureSize;if(i.width>u||i.height>u||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!!this._workingCanvas&&!!this._workingContext&&(this._workingCanvas.width=e,this._workingCanvas.height=t,this._workingContext.drawImage(i,0,0,i.width,i.height,0,0,e,t),o.texImage2D(o.TEXTURE_2D,0,l.internalFormat,l.format,l.type,this._workingCanvas),n.width=e,n.height=t,!1);{let e=new d.l(this,2);this._bindTextureDirectly(o.TEXTURE_2D,e,!0),o.texImage2D(o.TEXTURE_2D,0,l.internalFormat,l.format,l.type,i),this._rescaleTexture(e,n,r,l.format,()=>{this._releaseTexture(e),this._bindTextureDirectly(o.TEXTURE_2D,n,!0),a()})}return!0},o,h,l,u,c,_,f)}_getTexImageParametersForCreateTexture(e,t){let i,r;return 1===this.webGLVersion?r=i=this._getInternalFormat(e,t):(i=this._getInternalFormat(e,!1),r=this._getRGBABufferInternalSizedFormat(0,e,t)),{internalFormat:r,format:i,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(e,t,i,r,s){}_unpackFlipY(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(e,t,i=!1){let r=this._getTextureTarget(t),s=this._getSamplingParameters(e,t.useMipMaps||i);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,s.mag,t),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,s.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),t.samplingMode=e}updateTextureDimensions(e,t,i,r=1){}updateTextureWrappingMode(e,t,i=null,r=null){let s=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==r&&(this._setTextureParameterInteger(s,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),e),e._cachedWrapR=r),this._bindTextureDirectly(s,null)}_uploadCompressedDataToTextureDirectly(e,t,i,r,s,n=0,a=0){let o=this._gl,h=o.TEXTURE_2D;if(e.isCube&&(h=o.TEXTURE_CUBE_MAP_POSITIVE_X+n),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=o.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(h,a,t,i,r,0,s)}_uploadDataToTextureDirectly(e,t,i=0,r=0,s,n=!1){let a=this._gl,o=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format),l=void 0===s?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(s,e._useSRGBBuffer);this._unpackFlipY(e.invertY);let u=a.TEXTURE_2D;e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+i);let c=Math.round(Math.log(e.width)*Math.LOG2E),_=Math.round(Math.log(e.height)*Math.LOG2E),d=n?e.width:Math.pow(2,Math.max(c-r,0)),p=n?e.height:Math.pow(2,Math.max(_-r,0));a.texImage2D(u,r,l,d,p,0,h,o,t)}updateTextureData(e,t,i,r,s,n,a=0,o=0,h=!1){let l=this._gl,u=this._getWebGLTextureType(e.type),c=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);let _=l.TEXTURE_2D,d=l.TEXTURE_2D;e.isCube&&(d=l.TEXTURE_CUBE_MAP_POSITIVE_X+a,_=l.TEXTURE_CUBE_MAP),this._bindTextureDirectly(_,e,!0),l.texSubImage2D(d,o,i,r,s,n,c,u,t),h&&this._gl.generateMipmap(d),this._bindTextureDirectly(_,null)}_uploadArrayBufferViewToTexture(e,t,i=0,r=0){let s=this._gl,n=e.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(n,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(n,null,!0)}_prepareWebGLTextureContinuation(e,t,i,r,s){let n=this._gl;if(!n)return;let a=this._getSamplingParameters(s,!i);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,a.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,a.min),i||r||n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}_prepareWebGLTexture(e,t,i,r,s,n,a,o,h,l){let c=this.getCaps().maxTextureSize,_=Math.min(c,this.needPOTTextures?(0,u.p7)(r.width,c):r.width),d=Math.min(c,this.needPOTTextures?(0,u.p7)(r.height,c):r.height),p=this._gl;if(p){if(!e._hardwareTexture){i&&i.removePendingData(e);return}this._bindTextureDirectly(p.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===s||!!s),e.baseWidth=r.width,e.baseHeight=r.height,e.width=_,e.height=d,e.isReady=!0,e.type=-1!==e.type?e.type:0,e.format=-1!==e.format?e.format:l??(".jpg"!==t||e._useSRGBBuffer?5:4),o(_,d,r,t,e,()=>{this._prepareWebGLTextureContinuation(e,i,n,a,h)})||this._prepareWebGLTextureContinuation(e,i,n,a,h)}}_getInternalFormatFromDepthTextureFormat(e,t,i){let r=this._gl;if(!t)return r.STENCIL_INDEX8;let s=i?r.DEPTH_STENCIL:r.DEPTH_COMPONENT;return this.webGLVersion>1?15===e?s=r.DEPTH_COMPONENT16:16===e?s=r.DEPTH_COMPONENT24:17===e||13===e?s=i?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24:14===e?s=r.DEPTH_COMPONENT32F:18===e&&(s=i?r.DEPTH32F_STENCIL8:r.DEPTH_COMPONENT32F):s=r.DEPTH_COMPONENT16,s}_setupFramebufferDepthAttachments(e,t,i,r,s=1,n){let a=this._gl;n=n??(e?13:14);let o=this._getInternalFormatFromDepthTextureFormat(n,t,e);return e&&t?this._createRenderBuffer(i,r,s,a.DEPTH_STENCIL,o,a.DEPTH_STENCIL_ATTACHMENT):t?this._createRenderBuffer(i,r,s,o,o,a.DEPTH_ATTACHMENT):e?this._createRenderBuffer(i,r,s,o,o,a.STENCIL_ATTACHMENT):null}_createRenderBuffer(e,t,i,r,s,n,a=!0){let o=this._gl.createRenderbuffer();return this._updateRenderBuffer(o,e,t,i,r,s,n,a)}_updateRenderBuffer(e,t,i,r,s,n,a,o=!0){let h=this._gl;return h.bindRenderbuffer(h.RENDERBUFFER,e),r>1&&h.renderbufferStorageMultisample?h.renderbufferStorageMultisample(h.RENDERBUFFER,r,n,t,i):h.renderbufferStorage(h.RENDERBUFFER,s,t,i),h.framebufferRenderbuffer(h.FRAMEBUFFER,a,h.RENDERBUFFER,e),o&&h.bindRenderbuffer(h.RENDERBUFFER,null),e}_releaseTexture(e){this._deleteTexture(e._hardwareTexture),this.unbindAllTextures();let t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}_deleteTexture(e){e?.release()}_setProgram(e){this._currentProgram!==e&&((0,r.Q)(e,this._gl),this._currentProgram=e)}bindSamplers(e){let t=e.getPipelineContext();this._setProgram(t.program);let i=e.getSamplers();for(let t=0;t<i.length;t++){let r=e.getUniform(i[t]);r&&(this._boundUniforms[t]=r)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(e,t,i=!1,r=!1){let s=!1,a=t&&t._associatedChannel>-1;if(i&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||r){if(this._activateCurrentTexture(),t&&t.isMultiview)throw n.Y.Error(["_bindTextureDirectly called with a multiview texture!",e,t]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,t?._hardwareTexture?.underlyingResource??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else i&&(s=!0,this._activateCurrentTexture());return a&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),s}_bindTexture(e,t,i){if(void 0===e)return;t&&(t._associatedChannel=e),this._activeChannel=e;let r=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(r,t)}unbindAllTextures(){for(let e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))}_bindSamplerUniformToChannel(e,t){let i=this._boundUniforms[e];i&&i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)}_getTextureWrapMode(e){switch(e){case 1:break;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(e,t,i=!1,r=!1,s=""){let n;if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=e;let i=t.getInternalTexture();i&&(i._associatedChannel=e),t.update()}else if(4===t.delayLoadState)return t.delayLoad(),!1;n=r?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&n&&(n._associatedChannel=e);let a=!0;this._boundTexturesCache[e]===n&&(i||this._bindSamplerUniformToChannel(n._associatedChannel,e),a=!1),this._activeChannel=e;let o=this._getTextureTarget(n);if(a&&this._bindTextureDirectly(o,n,i),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;let e=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=e,t.wrapV=e}n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n.is3D&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(o,n,t.anisotropicFilteringLevel)}return!0}setTextureArray(e,t,i,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(let t=0;t<i.length;t++){let r=i[t].getInternalTexture();r?(this._textureUnits[t]=e+t,r._associatedChannel=e+t):this._textureUnits[t]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let e=0;e<i.length;e++)this._setTexture(this._textureUnits[e],i[e],!0)}}_setAnisotropicLevel(e,t,i){let r=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),r&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)}_setTextureParameterFloat(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)}_setTextureParameterInteger(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e);return}for(let e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)!(e>=this._caps.maxVertexAttribs)&&this._vertexAttribArraysEnabled[e]&&this.disableAttributeByIndex(e)}releaseEffects(){for(let e of Object.keys(this._compiledEffects))this._compiledEffects[e].dispose();this._compiledEffects={}}dispose(){(0,a.CG)()&&this._renderingCanvas&&!this._doNotHandleContextLost&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&this._gl.getExtension("WEBGL_lose_context")?.loseContext(),(0,r.tY)(this._gl)}attachContextLostEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}attachContextRestoredEvent(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(e){let t=this._gl;for(;t.getError()!==t.NO_ERROR;);let i=!0,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if((i=(i=i&&n===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);let e=t.RGBA,r=t.UNSIGNED_BYTE,s=new Uint8Array(4);t.readPixels(0,0,1,1,e,r,s),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(s),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i}_getWebGLTextureType(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:break;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:break;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(e,t=!1){let i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:i=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER}return i}_getRGBABufferInternalSizedFormat(e,t,i=!1){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return i?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(e,t,i,r,s=!0,n=!0){let a=s?this._gl.RGBA:this._gl.RGB,o=new Uint8Array(r*i*(s?4:3));return n&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,r,a,this._gl.UNSIGNED_BYTE,o),Promise.resolve(o)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{let e=c.a._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{let e=c.a._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}T._TempClearColorUint32=new Uint32Array(4),T._TempClearColorInt32=new Int32Array(4),T.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],T._ConcatenateShader=f.Gb,T._IsSupported=null,T._HasMajorPerformanceCaveat=null},66508:function(e,t,i){var r,s;i.d(t,{G:function(){return n}}),(s=r||(r={}))[s.PointerMove=0]="PointerMove",s[s.PointerDown=1]="PointerDown",s[s.PointerUp=2]="PointerUp";class n{}n.DOM_DELTA_PIXEL=0,n.DOM_DELTA_LINE=1,n.DOM_DELTA_PAGE=2},22710:function(e,t,i){i.d(t,{NG:function(){return s},OG:function(){return r},WZ:function(){return n}});class r{}r.KEYDOWN=1,r.KEYUP=2;class s{constructor(e,t){this.type=e,this.event=t}}class n extends s{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(e){this.skipOnKeyboardObservable=e}constructor(e,t){super(e,t),this.type=e,this.event=t,this.skipOnKeyboardObservable=!1}}},74909:function(e,t,i){i.d(t,{FV:function(){return a},R5:function(){return o},kD:function(){return s}});var r=i(39884);class s{}s.POINTERDOWN=1,s.POINTERUP=2,s.POINTERMOVE=4,s.POINTERWHEEL=8,s.POINTERPICK=16,s.POINTERTAP=32,s.POINTERDOUBLETAP=64;class n{constructor(e,t){this.type=e,this.event=t}}class a extends n{constructor(e,t,i,s){super(e,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new r.FM(i,s)}}class o extends n{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(e,t,i,r=null){super(e,t),this._pickInfo=i,this._inputManager=r}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},41329:function(e,t,i){i.d(t,{M:function(){return r}});class r{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}},47076:function(e,t,i){i.d(t,{$:function(){return p}});var r=i(74909),s=i(10035),n=i(88251),a=i(39884),o=i(68361),h=i(22710),l=i(78383),u=i(14286),c=i(51092),_=i(5325);class d{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class p{constructor(e){if(this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new a.FM(0,0),this._previousStartingPointerPosition=new a.FM(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||c.l.LastCreatedScene,!this._scene)return}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new a.FM(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){let t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,t){let i;let s=this._scene,n=s.getEngine(),a=n.getInputElement();for(let i of(a&&(a.tabIndex=n.canvasTabIndex,s.doNotHandleCursors||(a.style.cursor=s.defaultCursor)),this._setCursorAndPointerOverMesh(e,t,s),s._pointerMoveStage)){e=e||this._pickMove(t);let r=!!e?.pickedMesh;e=i.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,r,a)}let o=t.inputIndex>=l.Fz.MouseWheelX&&t.inputIndex<=l.Fz.MouseWheelZ?r.kD.POINTERWHEEL:r.kD.POINTERMOVE;s.onPointerMove&&(e=e||this._pickMove(t),s.onPointerMove(t,e,o)),e?(i=new r.R5(o,t,e),this._setRayOnPointerInfo(e,t)):(i=new r.R5(o,t,null,this),this._movePointerInfo=i),s.onPointerObservable.hasObservers()&&s.onPointerObservable.notifyObservers(i,o)}_setRayOnPointerInfo(e,t){let i=this._scene;e&&_.r._IsPickingAvailable&&!e.ray&&(e.ray=i.createPickingRay(t.offsetX,t.offsetY,a.y3.Identity(),i.activeCamera))}_addCameraPointerObserver(e,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,t)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,t,i){let s=this._scene,n=new r.FV(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(n.originalPickingInfo=e,n.ray=e.ray,"xr-near"===t.pointerType&&e.originMesh&&(n.nearInteractionPickingInfo=e)),s.onPrePointerObservable.notifyObservers(n,i),!!n.skipOnPointerObservable}_pickMove(e){let t=this._scene,i=t.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(i,e,t),i}_setCursorAndPointerOverMesh(e,t,i){let r=i.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,t.pointerId,e,t),!i.doNotHandleCursors&&r&&this._pointerOverMesh){let e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(r.style.cursor=e.hoverCursor||i.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,e,t)}simulatePointerMove(e,t){let i=new PointerEvent("pointermove",t);i.inputIndex=l.Fz.Move,this._checkPrePointerObservable(e,i,r.kD.POINTERMOVE)||this._processPointerMove(e,i)}simulatePointerDown(e,t){let i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,r.kD.POINTERDOWN)||this._processPointerDown(e,i)}_processPointerDown(e,t){let i;let s=this._scene;if(e?.pickedMesh){this._pickedDownMesh=e.pickedMesh;let i=e.pickedMesh._getActionManagerForTrigger();if(i){if(i.hasPickTriggers)switch(i.processTrigger(5,o.V.CreateNew(e.pickedMesh,t,e)),t.button){case 0:i.processTrigger(2,o.V.CreateNew(e.pickedMesh,t,e));break;case 1:i.processTrigger(4,o.V.CreateNew(e.pickedMesh,t,e));break;case 2:i.processTrigger(3,o.V.CreateNew(e.pickedMesh,t,e))}i.hasSpecificTrigger(8)&&window.setTimeout(()=>{let e=s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh,!1,s.cameraToUseForPointers);e?.pickedMesh&&i&&0!==this._totalPointersPressed&&Date.now()-this._startingPointerTime>p.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,i.processTrigger(8,o.V.CreateNew(e.pickedMesh,t)))},p.LongPressDelay)}}else for(let i of s._pointerDownStage)e=i.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,!1);let n=r.kD.POINTERDOWN;e?(s.onPointerDown&&s.onPointerDown(t,e,n),i=new r.R5(n,t,e),this._setRayOnPointerInfo(e,t)):i=new r.R5(n,t,null,this),s.onPointerObservable.hasObservers()&&s.onPointerObservable.notifyObservers(i,n)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,t,i){let s=new PointerEvent("pointerup",t);s.inputIndex=l.Fz.Move;let n=new d;i?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,s,r.kD.POINTERUP)||this._processPointerUp(e,s,n)}_processPointerUp(e,t,i){let s=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(s.onPointerPick&&s.onPointerPick(t,e),i.singleClick&&!i.ignore&&s.onPointerObservable.observers.length>this._cameraObserverCount)){let i=r.kD.POINTERPICK,n=new r.R5(i,t,e);this._setRayOnPointerInfo(e,t),s.onPointerObservable.notifyObservers(n,i)}let n=e.pickedMesh._getActionManagerForTrigger();if(n&&!i.ignore){n.processTrigger(7,o.V.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&n.processTrigger(1,o.V.CreateNew(e.pickedMesh,t,e));let r=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&r&&r.processTrigger(6,o.V.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(let r of s._pointerUpStage)e=r.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t,i.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){let e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,o.V.CreateNew(this._pickedDownMesh,t))}if(!i.ignore){let n=new r.R5(r.kD.POINTERUP,t,e);if(this._setRayOnPointerInfo(e,t),s.onPointerObservable.notifyObservers(n,r.kD.POINTERUP),s.onPointerUp&&s.onPointerUp(t,e,r.kD.POINTERUP),!i.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let n=0;if(i.singleClick?n=r.kD.POINTERTAP:i.doubleClick&&(n=r.kD.POINTERDOUBLETAP),n){let i=new r.R5(n,t,e);s.onPointerObservable.hasObservers()&&s.onPointerObservable.hasSpecificMask(n)&&s.onPointerObservable.notifyObservers(i,n)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,t=!0,i=!0,a=null){let c=this._scene,_=c.getEngine();a||(a=_.getInputElement()),this._alreadyAttached&&this.detachControl(),a&&(this._alreadyAttachedTo=a),this._deviceSourceManager=new u.U(_),this._initActionManager=e=>{if(!this._meshPickProceed){let t=!c.skipPointerUpPicking&&(0!==c._registeredActions||this._checkForPicking()||c.onPointerUp)?c.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerUpPredicate,c.pointerUpFastCheck,c.cameraToUseForPointers,c.pointerUpTrianglePredicate):null;this._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(e,t,i)=>{if((Date.now()-this._previousStartingPointerTime>p.DoubleClickDelay&&!this._doubleClickOccured||e!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,this._delayedClicks[e])){let t=this._delayedClicks[e].evt,i=r.kD.POINTERTAP,s=new r.R5(i,t,this._currentPickResult);c.onPointerObservable.hasObservers()&&c.onPointerObservable.hasSpecificMask(i)&&c.onPointerObservable.notifyObservers(s,i),this._delayedClicks[e]=null}},this._initClickEvent=(e,t,i,n)=>{let a=new d;this._currentPickResult=null;let o=null,h=e.hasSpecificMask(r.kD.POINTERPICK)||t.hasSpecificMask(r.kD.POINTERPICK)||e.hasSpecificMask(r.kD.POINTERTAP)||t.hasSpecificMask(r.kD.POINTERTAP)||e.hasSpecificMask(r.kD.POINTERDOUBLETAP)||t.hasSpecificMask(r.kD.POINTERDOUBLETAP);!h&&s.O&&(o=this._initActionManager(o,a))&&(h=o.hasPickTriggers);let l=!1;if(h){let h=i.button;if(a.hasSwiped=this._isPointerSwiping(),!a.hasSwiped){let u=!p.ExclusiveDoubleClickMode;if(!u&&(u=!e.hasSpecificMask(r.kD.POINTERDOUBLETAP)&&!t.hasSpecificMask(r.kD.POINTERDOUBLETAP))&&!s.O.HasSpecificTrigger(6)&&(o=this._initActionManager(o,a))&&(u=!o.hasSpecificTrigger(6)),u)(Date.now()-this._previousStartingPointerTime>p.DoubleClickDelay||h!==this._previousButtonPressed)&&(a.singleClick=!0,n(a,this._currentPickResult),l=!0);else{let e={evt:i,clickInfo:a,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,h,a,n),p.DoubleClickDelay)};this._delayedClicks[h]=e}let c=e.hasSpecificMask(r.kD.POINTERDOUBLETAP)||t.hasSpecificMask(r.kD.POINTERDOUBLETAP);!c&&s.O.HasSpecificTrigger(6)&&(o=this._initActionManager(o,a))&&(c=o.hasSpecificTrigger(6)),c&&(h===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<p.DoubleClickDelay&&!this._doubleClickOccured?(a.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=h,p.ExclusiveDoubleClickMode?(this._delayedClicks[h]&&(clearTimeout(this._delayedClicks[h]?.timeoutId),this._delayedClicks[h]=null),n(a,this._previousPickResult)):n(a,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,a.doubleClick=!0,a.ignore=!1,p.ExclusiveDoubleClickMode&&this._delayedClicks[h]&&(clearTimeout(this._delayedClicks[h]?.timeoutId),this._delayedClicks[h]=null),n(a,this._currentPickResult)),l=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=h))}}l||n(a,this._currentPickResult)},this._onPointerMove=e=>{if(this._updatePointerPosition(e),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>p.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>p.DragMovementThreshold),_.isPointerLock&&_._verifyPointerLock(),this._checkPrePointerObservable(null,e,e.inputIndex>=l.Fz.MouseWheelX&&e.inputIndex<=l.Fz.MouseWheelZ?r.kD.POINTERWHEEL:r.kD.POINTERMOVE)||!c.cameraToUseForPointers&&!c.activeCamera)return;if(c.skipPointerMovePicking){this._processPointerMove(new n.p,e);return}c.pointerMovePredicate||(c.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||c.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!c.cameraToUseForPointers||(c.cameraToUseForPointers.layerMask&e.layerMask)!=0));let t=c._registeredActions>0||c.constantlyUpdateMeshUnderPointer?this._pickMove(e):null;this._processPointerMove(t,e)},this._onPointerDown=e=>{let t;if(this._totalPointersPressed++,this._pickedDownMesh=null,this._meshPickProceed=!1,p.ExclusiveDoubleClickMode){for(let t=0;t<this._delayedClicks.length;t++)if(this._delayedClicks[t]){if(e.button===t)clearTimeout(this._delayedClicks[t]?.timeoutId);else{let e=this._delayedClicks[t].clickInfo;this._doubleClickOccured=!1,e.singleClick=!0,e.ignore=!1;let i=this._delayedClicks[t].evt,s=r.kD.POINTERTAP,n=new r.R5(s,i,this._currentPickResult);c.onPointerObservable.hasObservers()&&c.onPointerObservable.hasSpecificMask(s)&&c.onPointerObservable.notifyObservers(n,s),this._delayedClicks[t]=null}}}this._updatePointerPosition(e),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=e.button),c.preventDefaultOnPointerDown&&a&&(e.preventDefault(),a.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),!this._checkPrePointerObservable(null,e,r.kD.POINTERDOWN)&&(c.cameraToUseForPointers||c.activeCamera)&&(this._pointerCaptures[e.pointerId]=!0,c.pointerDownPredicate||(c.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||(c.cameraToUseForPointers.layerMask&e.layerMask)!=0)),this._pickedDownMesh=null,t=!c.skipPointerDownPicking&&(0!==c._registeredActions||this._checkForPicking()||c.onPointerDown)?c.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerDownPredicate,c.pointerDownFastCheck,c.cameraToUseForPointers,c.pointerDownTrianglePredicate):new n.p,this._processPointerDown(t,e))},this._onPointerUp=e=>{0!==this._totalPointersPressed&&(this._totalPointersPressed--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),c.preventDefaultOnPointerUp&&a&&(e.preventDefault(),a.focus()),this._initClickEvent(c.onPrePointerObservable,c.onPointerObservable,e,(t,i)=>{if(c.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,e,r.kD.POINTERUP)){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1);return}!t.hasSwiped&&(t.singleClick&&c.onPrePointerObservable.hasSpecificMask(r.kD.POINTERTAP)&&this._checkPrePointerObservable(null,e,r.kD.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&c.onPrePointerObservable.hasSpecificMask(r.kD.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,r.kD.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}if(!this._pointerCaptures[e.pointerId]){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1);return}0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(c.cameraToUseForPointers||c.activeCamera)&&(c.pointerUpPredicate||(c.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!c.cameraToUseForPointers||(c.cameraToUseForPointers.layerMask&e.layerMask)!=0)),!this._meshPickProceed&&(s.O&&s.O.HasTriggers||this._checkForPicking()||c.onPointerUp)&&this._initActionManager(null,t),i||(i=this._currentPickResult),this._processPointerUp(i,e,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))}))},this._onKeyDown=e=>{let t=h.OG.KEYDOWN;if(c.onPreKeyboardObservable.hasObservers()){let i=new h.WZ(t,e);if(c.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){let i=new h.NG(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(14,o.V.CreateNewFromScene(c,e))},this._onKeyUp=e=>{let t=h.OG.KEYUP;if(c.onPreKeyboardObservable.hasObservers()){let i=new h.WZ(t,e);if(c.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(c.onKeyboardObservable.hasObservers()){let i=new h.NG(t,e);c.onKeyboardObservable.notifyObservers(i,t)}c.actionManager&&c.actionManager.processTrigger(15,o.V.CreateNewFromScene(c,e))},this._deviceSourceManager.onDeviceConnectedObservable.add(r=>{r.deviceType===l.Yi.Mouse?r.onInputChangedObservable.add(s=>{this._originMouseEvent=s,s.inputIndex===l.Fz.LeftClick||s.inputIndex===l.Fz.MiddleClick||s.inputIndex===l.Fz.RightClick||s.inputIndex===l.Fz.BrowserBack||s.inputIndex===l.Fz.BrowserForward?t&&1===r.getInput(s.inputIndex)?this._onPointerDown(s):e&&0===r.getInput(s.inputIndex)&&this._onPointerUp(s):i&&(s.inputIndex===l.Fz.Move?this._onPointerMove(s):(s.inputIndex===l.Fz.MouseWheelX||s.inputIndex===l.Fz.MouseWheelY||s.inputIndex===l.Fz.MouseWheelZ)&&this._onPointerMove(s))}):r.deviceType===l.Yi.Touch?r.onInputChangedObservable.add(s=>{s.inputIndex===l.Fz.LeftClick&&(t&&1===r.getInput(s.inputIndex)?(this._onPointerDown(s),this._totalPointersPressed>1&&(this._isMultiTouchGesture=!0)):e&&0===r.getInput(s.inputIndex)&&(this._onPointerUp(s),0===this._totalPointersPressed&&(this._isMultiTouchGesture=!1))),i&&s.inputIndex===l.Fz.Move&&this._onPointerMove(s)}):r.deviceType===l.Yi.Keyboard&&r.onInputChangedObservable.add(e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)})}),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,t=0,i,r){let s;if(this._meshUnderPointerId[t]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;let n=this._meshUnderPointerId[t];n&&(s=n._getActionManagerForTrigger(10))&&s.processTrigger(10,o.V.CreateNew(n,r,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,(s=e._getActionManagerForTrigger(9))&&s.processTrigger(9,o.V.CreateNew(e,r,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){for(let t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]}}p.DragMovementThreshold=10,p.LongPressDelay=500,p.DoubleClickDelay=300,p.ExclusiveDoubleClickMode=!1},42044:function(e,t,i){i.d(t,{m:function(){return r}});class r{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}r.FALLOFF_DEFAULT=0,r.FALLOFF_PHYSICAL=1,r.FALLOFF_GLTF=2,r.FALLOFF_STANDARD=3,r.LIGHTMAP_DEFAULT=0,r.LIGHTMAP_SPECULAR=1,r.LIGHTMAP_SHADOWSONLY=2,r.INTENSITYMODE_AUTOMATIC=0,r.INTENSITYMODE_LUMINOUSPOWER=1,r.INTENSITYMODE_LUMINOUSINTENSITY=2,r.INTENSITYMODE_ILLUMINANCE=3,r.INTENSITYMODE_LUMINANCE=4,r.LIGHTTYPEID_POINTLIGHT=0,r.LIGHTTYPEID_DIRECTIONALLIGHT=1,r.LIGHTTYPEID_SPOTLIGHT=2,r.LIGHTTYPEID_HEMISPHERICLIGHT=3},93733:function(e,t,i){i.d(t,{qr:function(){return a}});var r=i(9719);let s=new Map;function n(e,t){s.delete(e)&&r.Y.Warn(`Extension with the name '${name}' already exists`),s.set(e,t)}function a(e,t){("image/ktx"===t||"image/ktx2"===t)&&(e=".ktx"),!s.has(e)&&(e.endsWith(".dds")&&n(".dds",()=>i.e(8570).then(i.bind(i,18570)).then(e=>new e._DDSTextureLoader)),e.endsWith(".basis")&&n(".basis",()=>i.e(5068).then(i.bind(i,35068)).then(e=>new e._BasisTextureLoader)),e.endsWith(".env")&&n(".env",()=>i.e(6395).then(i.bind(i,6395)).then(e=>new e._ENVTextureLoader)),e.endsWith(".hdr")&&n(".hdr",()=>i.e(6877).then(i.bind(i,46877)).then(e=>new e._HDRTextureLoader)),(e.endsWith(".ktx")||e.endsWith(".ktx2"))&&(n(".ktx",()=>i.e(3751).then(i.bind(i,13751)).then(e=>new e._KTXTextureLoader)),n(".ktx2",()=>i.e(3751).then(i.bind(i,13751)).then(e=>new e._KTXTextureLoader))),e.endsWith(".tga")&&n(".tga",()=>i.e(6861).then(i.bind(i,86861)).then(e=>new e._TGATextureLoader)),e.endsWith(".exr")&&n(".exr",()=>i.e(6331).then(i.bind(i,57301)).then(e=>new e._ExrTextureLoader)));let r=s.get(e);return r?Promise.resolve(r(t)):null}},76019:function(e,t,i){i.d(t,{V:function(){return c}});var r=i(46456),s=i(22287),n=i(82877),a=i(39884),o=i(51092),h=i(25675);i(14684);var l=i(14187),u=i(90212);class c extends l.g{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,e=>e.hasTexture(this))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=(0,h.f)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new n.y$,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?c._IsScene(e)?this._scene=e:this._engine=e:this._scene=o.l.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return a.y3.IdentityReadOnly}getReflectionTextureMatrix(){return a.y3.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,r,s,n){let a=this._getEngine();if(!a)return null;let o=a._getUseSRGBBuffer(!!s,t),h=a.getLoadedTexturesCache();for(let a=0;a<h.length;a++){let l=h[a];if((void 0===s||o===l._useSRGBBuffer)&&(void 0===r||r===l.invertY)&&l.url===e&&!t===l.generateMipMaps&&(!i||i===l.samplingMode)&&(void 0===n||n===l.isCube))return l.incrementReferences(),l}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){let e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,i=null,r=!0,s=!1,n=0,a=0,o=Number.MAX_VALUE,h=Number.MAX_VALUE){if(!this._texture)return null;let l=this._getEngine();if(!l)return null;let u=this.getSize(),c=u.width,_=u.height;0!==t&&(c/=Math.pow(2,t),_/=Math.pow(2,t),c=Math.round(c),_=Math.round(_)),o=Math.min(c,o),h=Math.min(_,h);try{if(this._texture.isCube)return l._readTexturePixels(this._texture,o,h,e,t,i,r,s,n,a);return l._readTexturePixels(this._texture,o,h,-1,t,i,r,s,n,a)}catch(e){return null}}_readPixelsSync(e=0,t=0,i=null,r=!0,s=!1){if(!this._texture)return null;let n=this.getSize(),a=n.width,o=n.height,h=this._getEngine();if(!h)return null;0!=t&&(a/=Math.pow(2,t),o/=Math.pow(2,t),a=Math.round(a),o=Math.round(o));try{if(this._texture.isCube)return h._readTexturePixelsSync(this._texture,a,o,e,t,i,r,s);return h._readTexturePixelsSync(this._texture,a,o,-1,t,i,r,s)}catch(e){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);let e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){let e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;let t=u.p.Serialize(this);return u.p.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(0===i){t();return}for(let r=0;r<e.length;r++){let s=e[r];if(s.isReady())0==--i&&t();else{let e=s.onLoadObservable;e?e.addOnce(()=>{0==--i&&t()}):0==--i&&t()}}}static _IsScene(e){return"Scene"===e.getClassName()}}c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,r.gn)([(0,s.qC)()],c.prototype,"uniqueId",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"name",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"metadata",void 0),(0,r.gn)([(0,s.qC)("hasAlpha")],c.prototype,"_hasAlpha",void 0),(0,r.gn)([(0,s.qC)("getAlphaFromRGB")],c.prototype,"_getAlphaFromRGB",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"level",void 0),(0,r.gn)([(0,s.qC)("coordinatesIndex")],c.prototype,"_coordinatesIndex",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"optimizeUVAllocation",void 0),(0,r.gn)([(0,s.qC)("coordinatesMode")],c.prototype,"_coordinatesMode",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"wrapU",null),(0,r.gn)([(0,s.qC)()],c.prototype,"wrapV",null),(0,r.gn)([(0,s.qC)()],c.prototype,"wrapR",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"anisotropicFilteringLevel",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"isCube",null),(0,r.gn)([(0,s.qC)()],c.prototype,"is3D",null),(0,r.gn)([(0,s.qC)()],c.prototype,"is2DArray",null),(0,r.gn)([(0,s.qC)()],c.prototype,"gammaSpace",null),(0,r.gn)([(0,s.qC)()],c.prototype,"invertZ",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"lodLevelInAlpha",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"lodGenerationOffset",null),(0,r.gn)([(0,s.qC)()],c.prototype,"lodGenerationScale",null),(0,r.gn)([(0,s.qC)()],c.prototype,"linearSpecularLOD",null),(0,r.gn)([(0,s.oU)()],c.prototype,"irradianceTexture",null),(0,r.gn)([(0,s.qC)()],c.prototype,"isRenderTarget",void 0)},9520:function(e,t,i){i.d(t,{l:function(){return o}});var r,s,n=i(82877),a=i(72831);(r=s||(s={}))[r.Unknown=0]="Unknown",r[r.Url=1]="Url",r[r.Temp=2]="Temp",r[r.Raw=3]="Raw",r[r.Dynamic=4]="Dynamic",r[r.RenderTarget=5]="RenderTarget",r[r.MultiRenderTarget=6]="MultiRenderTarget",r[r.Cube=7]="Cube",r[r.CubeRaw=8]="CubeRaw",r[r.CubePrefiltered=9]="CubePrefiltered",r[r.Raw3D=10]="Raw3D",r[r.Raw2DArray=11]="Raw2DArray",r[r.DepthStencil=12]="DepthStencil",r[r.CubeRawRGBD=13]="CubeRawRGBD",r[r.Depth=14]="Depth";class o extends a.a{get useMipMaps(){return this.generateMipMaps}set useMipMaps(e){this.generateMipMaps=e}get uniqueId(){return this._uniqueId}_setUniqueId(e){this._uniqueId=e}getEngine(){return this._engine}get source(){return this._source}constructor(e,t,i=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new n.y$,this.onErrorObservable=new n.y$,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=e,this._source=t,this._uniqueId=o._Counter++,i||(this._hardwareTexture=e._createHardwareTexture())}incrementReferences(){this._references++}updateSize(e,t,i=1){this._engine.updateTextureDimensions(this,e,t,i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i}_rebuild(){let e;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){let e=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=e.isReady};e.isAsync?e.proxy.then(t):t(e.proxy);return}switch(this.source){case 2:break;case 1:e=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,e=>{e._swapAndDie(this,!1),this.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case 3:(e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case 10:(e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case 11:(e=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case 4:(e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,()=>{e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null);return;case 8:(e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:(e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,e=>{e&&e._swapAndDie(this,!1),this.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial;return}}_swapAndDie(e,t=!0){this._hardwareTexture?.setUsage(e._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);let i=this._engine.getLoadedTexturesCache(),r=i.indexOf(this);-1!==r&&i.splice(r,1),-1===(r=i.indexOf(e))&&i.push(e)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}o._Counter=0},6507:function(e,t,i){i.d(t,{_:function(){return _}});var r=i(82877),s=i(39884),n=i(81209),a=i(11538),o=i(15431),h=i(178),l=i(61146),u=i(97937),c=i(9719);u.Q.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)};class _ extends n.x{get renderList(){return this._renderList}set renderList(e){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=(0,h.Mf)(e,this._renderListHasChanged)),this._renderList=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(e,t){let i;i=Array.isArray(e)?e:[e];for(let e=0;e<i.length;++e)for(let r=0;r<this._renderPassIds.length;++r)i[e].setMaterialForRenderPass(this._renderPassIds[r],void 0!==t?Array.isArray(t)?t[r]:t:void 0)}get isMulti(){return this._renderTarget?.isMulti??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;let t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){return this._renderTarget?._depthStencilTexture??null}constructor(e,t,i,a=!1,h=!0,l=0,u=!1,c=n.x.TRILINEAR_SAMPLINGMODE,_=!0,d=!1,p=!1,f=5,g=!1,m,T,E=!1,b=!1){let R;let C=!0;if("object"==typeof a){let e=a;a=!!e.generateMipMaps,h=e.doNotChangeAspectRatio??!0,l=e.type??0,u=!!e.isCube,c=e.samplingMode??n.x.TRILINEAR_SAMPLINGMODE,_=e.generateDepthBuffer??!0,d=!!e.generateStencilBuffer,p=!!e.isMulti,f=e.format??5,g=!!e.delayAllocation,m=e.samples,T=e.creationFlags,E=!!e.noColorAttachment,b=!!e.useSRGBBuffer,R=e.colorAttachment,C=e.gammaSpace??C}if(super(null,i,!a,void 0,c,void 0,void 0,void 0,void 0,f),this._unObserveRenderList=null,this._renderListHasChanged=(e,t)=>{let i=this._renderList?this._renderList.length:0;(0===t&&i>0||0===i)&&this.getScene()?.meshes.forEach(e=>{e._markSubMeshesAsLightDirty()})},this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new r.y$,this.onAfterUnbindObservable=new r.y$,this.onBeforeRenderObservable=new r.y$,this.onAfterRenderObservable=new r.y$,this.onClearObservable=new r.y$,this.onResizeObservable=new r.y$,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=s.P.Zero(),this._dumpToolsLoading=!1,!(i=this.getScene()))return;let P=this.getScene().getEngine();if(this._gammaSpace=C,this._coordinatesMode=n.x.PROJECTION_MODE,this.renderList=[],this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._renderPassIds=[],this._isCubeData=u,this._processSizeParameter(t),this.renderPassId=this._renderPassIds[0],this._resizeObserver=P.onResizeObservable.add(()=>{}),this._generateMipMaps=!!a,this._doNotChangeAspectRatio=h,this._renderingManager=new o.$(i),this._renderingManager._useSceneAutoClearSetup=!0,p)return;this._renderTargetOptions={generateMipMaps:a,type:l,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:_,generateStencilBuffer:d,samples:m,creationFlags:T,noColorAttachment:E,useSRGBBuffer:b,colorAttachment:R,label:this.name},this.samplingMode===n.x.NEAREST_SAMPLINGMODE&&(this.wrapU=n.x.CLAMP_ADDRESSMODE,this.wrapV=n.x.CLAMP_ADDRESSMODE),g||(u?(this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=n.x.INVCUBIC_MODE,this._textureMatrix=s.y3.Identity()):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0===m||(this.samples=m))}createDepthStencilTexture(e=0,t=!0,i=!1,r=1,s=14,n){this._renderTarget?.createDepthStencilTexture(e,t,i,r,s,n)}_releaseRenderPassId(){if(this._scene){let e=this._scene.getEngine();for(let t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();let e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1;for(let i=0;i<t;++i)this._renderPassIds[i]=e.createRenderPassId(`RenderTargetTexture - ${this.name}#${i}`)}_processSizeParameter(e,t=!0){if(e.ratio){this._sizeRatio=e.ratio;let t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e;t&&this._createRenderPassId()}get samples(){return this._renderTarget?.samples??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}addPostProcess(e){if(!this._postProcessManager){let e=this.getScene();if(!e)return;this._postProcessManager=new a.O(e),this._postProcesses=[]}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(let e of this._postProcesses)e.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;let t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}_shouldRender(){return -1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){let e=this._size.layers;return e?e:this._size.depth||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){let t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){let t=this.isCube;this._renderTarget?.dispose(),this._renderTarget=null;let i=this.getScene();i&&(this._processSizeParameter(e,!1),t?this._renderTarget=i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._renderTarget=i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,i.e(2514).then(i.bind(i,32514)).then(e=>this._dumpTools=e)),this._render(!1,!1,!0)}_render(e=!1,t=!1,i=!1){let r=this.getScene();if(!r)return i;let s=r.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let e=0;e<this._waitingRenderList.length;e++){let t=this._waitingRenderList[e],i=r.getMeshById(t);i&&this.renderList.push(i)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];let e=this.getScene();if(!e)return i;let t=e.meshes;for(let e=0;e<t.length;e++){let i=t[e];this.renderListPredicate(i)&&this.renderList.push(i)}}let n=s.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);let a=this.activeCamera??r.activeCamera,o=r.activeCamera;a&&(a!==r.activeCamera&&(r.setTransformMatrix(a.getViewMatrix(),a.getProjectionMatrix(!0)),r.activeCamera=a),s.setViewport(a.rigParent?a.rigParent.viewport:a.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let h=i;if(i){r.getViewMatrix()||r.updateTransformMatrix();let e=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let t=0;t<e&&h;t++){let e=null,n=this.renderList?this.renderList:r.getActiveMeshes().data,a=this.renderList?this.renderList.length:r.getActiveMeshes().length;s.currentRenderPassId=this._renderPassIds[t],this.onBeforeRenderObservable.notifyObservers(t),this.getCustomRenderList&&(e=this.getCustomRenderList(t,n,a)),e||(e=n),this._doNotChangeAspectRatio||r.updateTransformMatrix(!0);for(let t=0;t<e.length&&h;++t){let r=e[t];if(r.isEnabled()&&!r.isBlocked&&r.isVisible&&r.subMeshes){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(r,this.refreshRate,i)){h=!1;continue}}else if(!r.isReady(!0)){h=!1;continue}}}this.onAfterRenderObservable.notifyObservers(t),(this.is2DArray||this.is3D||this.isCube)&&(r.incrementRenderId(),r.resetCachedMaterial())}}else if((this.is2DArray||this.is3D)&&!this.isMulti)for(let i=0;i<this.getRenderLayers();i++)this._renderToTarget(0,e,t,i,a),r.incrementRenderId(),r.resetCachedMaterial();else if(this.isCube&&!this.isMulti)for(let i=0;i<6;i++)this._renderToTarget(i,e,t,void 0,a),r.incrementRenderId(),r.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,a);return this.onAfterUnbindObservable.notifyObservers(this),s.currentRenderPassId=n,o&&(r.activeCamera=o,this.activeCamera&&this.activeCamera!==r.activeCamera&&r.setTransformMatrix(r.activeCamera.getViewMatrix(),r.activeCamera.getProjectionMatrix(!0)),s.setViewport(r.activeCamera.viewport)),r.resetCachedMaterial(),h}_bestReflectionRenderTargetDimension(e,t){let i=e*t,r=(0,l.Tr)(i+16384/(128+i));return Math.min((0,l.Av)(e),r)}_prepareRenderingManager(e,t,i,r){let s=this.getScene();if(!s)return;this._renderingManager.reset();let n=s.getRenderId();for(let a=0;a<t;a++){let t=e[a];if(t&&!t.isBlocked){let e;if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!t.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!t._internalAbstractMeshDataInfo._currentLODIsUpToDate&&s.activeCamera&&(t._internalAbstractMeshDataInfo._currentLOD=s.customLODSelector?s.customLODSelector(t,this.activeCamera||s.activeCamera):t.getLOD(this.activeCamera||s.activeCamera),t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!t._internalAbstractMeshDataInfo._currentLOD)continue;let a=t._internalAbstractMeshDataInfo._currentLOD;if(a._preActivateForIntermediateRendering(n),e=!!r&&!!i&&(t.layerMask&i.layerMask)==0,t.isEnabled()&&t.isVisible&&t.subMeshes&&!e){if(a!==t&&a._activate(n,!0),t._activate(n,!0)&&t.subMeshes.length){t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(a=t):a._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,a._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(let e=0;e<a.subMeshes.length;e++){let t=a.subMeshes[e];this._renderingManager.dispatch(t,a)}}t._postActivate()}}}for(let e=0;e<s.particleSystems.length;e++){let t=s.particleSystems[e],i=t.emitter;t.isStarted()&&i&&(!i.position||i.isEnabled())&&this._renderingManager.dispatchParticles(t)}}_bindFrameBuffer(e=0,t=0){let i=this.getScene();if(!i)return;let r=i.getEngine();this._renderTarget&&r.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,()=>{this.onAfterRenderObservable.notifyObservers(t)})}_prepareFrame(e,t,i,r){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):r&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,i)}_renderToTarget(e,t,i,r=0,s=null){let n=this.getScene();if(!n)return;let a=n.getEngine();if(a._debugPushGroup?.(`render to face #${e} layer #${r}`,1),this._prepareFrame(n,e,r,t),this.is2DArray||this.is3D?(a.currentRenderPassId=this._renderPassIds[r],this.onBeforeRenderObservable.notifyObservers(r)):(a.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e)),a.snapshotRendering&&1===a.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||n.clearColor,!0,!0,!0);else{let o=null,h=this.renderList?this.renderList:n.getActiveMeshes().data,l=this.renderList?this.renderList.length:n.getActiveMeshes().length;for(let t of(this.getCustomRenderList&&(o=this.getCustomRenderList(this.is2DArray||this.is3D?r:e,h,l)),o?this._prepareRenderingManager(o,o.length,s,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(h,l,s,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),o=h),n._beforeRenderTargetClearStage))t.action(this,e,r);for(let t of(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(a):this.skipInitialClear||a.clear(this.clearColor||n.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),n._beforeRenderTargetDrawStage))t.action(this,e,r);for(let t of(this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites),n._afterRenderTargetDrawStage))t.action(this,e,r);let u=this._texture?.generateMipMaps??!1;for(let i of(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&n.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,e),n._afterRenderTargetPostProcessStage))i.action(this,e,r);this._texture&&(this._texture.generateMipMaps=u),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),i&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),a):c.Y.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}this._unbindFrameBuffer(a,e),this._texture&&this.isCube&&5===e&&a.generateMipMapsForCubemap(this._texture,!0),a._debugPopGroup?.(1)}setRenderingOrder(e,t=null,i=null,r=null){this._renderingManager.setRenderingOrder(e,t,i,r)}setRenderingAutoClearDepthStencil(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1}clone(){let e=this.getSize(),t=new _(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;let e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){this._renderTarget?.dispose(!0)}releaseInternalTexture(){this._renderTarget?.releaseTextures(),this._texture=null}dispose(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;let e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);for(let i of(t>=0&&e.customRenderTargets.splice(t,1),e.cameras))(t=i.customRenderTargets.indexOf(this))>=0&&i.customRenderTargets.splice(t,1);this._renderTarget?.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===_.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=_.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}_.REFRESHRATE_RENDER_ONCE=0,_.REFRESHRATE_RENDER_ONEVERYFRAME=1,_.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,n.x._CreateRenderTargetTexture=(e,t,i,r,s)=>new _(e,t,i,r)},81209:function(e,t,i){i.d(t,{x:function(){return m}});var r=i(46456),s=i(22287),n=i(82877),a=i(39884),o=i(76019),h=i(7724),l=i(10633),u=i(15010),c=i(41377),_=i(47941),d=i(72786),p=i(46254),f=i(77210),g=i(90212);class m extends o.V{static _CreateVideoTexture(e,t,i,r=!1,s=!1,n=m.TRILINEAR_SAMPLINGMODE,a={},o,h=5){throw(0,l.S)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,r,s=m.TRILINEAR_SAMPLINGMODE,a=null,o=null,h=null,l=!1,c,_,d,p,g){let T;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new n.y$,this._isBlocking=!0,this.name=e||"",this.url=e;let E=!1,b=null,R=!0;"object"==typeof i&&null!==i?(T=i.noMipmap??!1,r=i.invertY??!f.VJ,s=i.samplingMode??m.TRILINEAR_SAMPLINGMODE,a=i.onLoad??null,o=i.onError??null,h=i.buffer??null,l=i.deleteBuffer??!1,c=i.format,_=i.mimeType,d=i.loaderOptions,p=i.creationFlags,E=i.useSRGBBuffer??!1,b=i.internalTexture??null,R=i.gammaSpace??R):T=!!i,this._gammaSpace=R,this._noMipmap=T,this._invertY=void 0===r?!f.VJ:r,this._initialSamplingMode=s,this._buffer=h,this._deleteBuffer=l,this._mimeType=_,this._loaderOptions=d,this._creationFlags=p,this._useSRGBBuffer=E,this._forcedExtension=g,c&&(this._format=c);let C=this.getScene(),P=this._getEngine();if(!P)return;P.onBeforeTextureInitObservable.notifyObservers(this);let x=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),a&&a(),!this.isBlocking&&C&&C.resetCachedMaterial()},A=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},o&&o(e,t),m.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!b){this._delayedOnLoad=x,this._delayedOnError=A;return}if(this._texture=b??this._getFromCache(this.url,T,s,this._invertY,E,this.isCube),this._texture){if(this._texture.isReady)u.Q.SetImmediate(()=>x());else{let e=this._texture.onLoadedObservable.add(x);this._texture.onErrorObservable.add(t=>{A(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)})}}else if(C&&C.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=x,this._delayedOnError=A;else{try{this._texture=P.createTexture(this.url,T,this._invertY,C,s,x,A,this._buffer,void 0,this._format,this._forcedExtension,_,d,p,E)}catch(e){throw A("error loading",e),e}l&&(this._buffer=null)}}updateURL(e,t=null,i,r){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,e=>e.hasTexture(this))),(!this.name||this.name.startsWith("data:"))&&(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=r,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;let e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?u.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,a.P.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.y3.Zero(),this._rowGenerationMatrix=new a.y3,this._t0=a.P.Zero(),this._t1=a.P.Zero(),this._t2=a.P.Zero()),a.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.jp.Matrix[0]),a.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.jp.Matrix[1]),a.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.jp.Matrix[2]),a.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.jp.Matrix[3]),a.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));let t=this.getScene();if(!t)return this._cachedTextureMatrix;let i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)),this._cachedTextureMatrix}getReflectionTextureMatrix(){let e=this.getScene();if(!e||this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode&&(this.coordinatesMode!==m.PROJECTION_MODE||this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag))return this._cachedReflectionTextureMatrix;this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=a.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.y3.Zero());let t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case m.PLANAR_MODE:a.y3.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case m.PROJECTION_MODE:{a.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);let t=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:a.y3.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&e.markAllMaterialsAsDirty(1,e=>e.hasTexture(this)),this._cachedReflectionTextureMatrix}clone(){let e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return g.p.Clone(()=>new m(this._texture?this._texture.url:null,this.getScene(),e),this)}serialize(){let e=this.name;!m.SerializeBuffers&&this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");let t=super.serialize(m._SerializeInternalTextureUniqueId);return t?((m.SerializeBuffers||m.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(t.base64String=this._buffer,t.name=t.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?t.base64String="data:image/png;base64,"+(0,d.Gh)(this._buffer):(m.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?(0,p._u)(this):(0,p.Jj)(this))),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,m._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=this._texture?.uniqueId??void 0),t.noMipmap=this._noMipmap,this.name=e,t):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){let r;if(e.customType){let r=c.K.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return m._CubeTextureParser(e,t,i);let s=void 0!==e.internalTextureUniqueId;if(!e.name&&!e.isRenderTarget&&!s)return null;if(s){for(let i of t.getEngine().getLoadedTexturesCache())if(i.uniqueId===e.internalTextureUniqueId){r=i;break}}let n=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){let i=e.samplingMode;t&&t.samplingMode!==i&&t.updateSamplingMode(i)}if(t&&e.animations)for(let i=0;i<e.animations.length;i++){let r=e.animations[i],s=(0,h.qw)("BABYLON.Animation");s&&t.animations.push(s.Parse(r))}s&&!r&&t?._texture?._setUniqueId(e.internalTextureUniqueId)};return g.p.Parse(()=>{let s=!0;if(e.noMipmap&&(s=!1),e.mirrorPlane){let i=m._CreateMirror(e.name,e.renderTargetSize,t,s);return i._waitingRenderList=e.renderList,i.mirrorPlane=_.J.FromArray(e.mirrorPlane),n(i),i}if(e.isRenderTarget){let i=null;if(e.isCube){if(t.reflectionProbes)for(let i=0;i<t.reflectionProbes.length;i++){let r=t.reflectionProbes[i];if(r.name===e.name)return r.cubeTexture}}else(i=m._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,s,e._creationFlags??0))._waitingRenderList=e.renderList;return n(i),i}if(e.isVideo){let r=m._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,s,e.invertY,e.samplingMode,e.settings||{});return n(r),r}{let a;if(e.base64String&&!r)(a=m.CreateFromBase64String(e.base64String,e.base64String,t,!s,e.invertY,e.samplingMode,()=>{n(a)},e._creationFlags??0,e._useSRGBBuffer??!1)).name=e.name;else{let o;o=e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||m.UseSerializedUrlIfAny)&&(o=e.url),a=new m(o,t,{noMipmap:!s,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{n(a)},internalTexture:r})}return a}},e,t)}static CreateFromBase64String(e,t,i,r,s,n=m.TRILINEAR_SAMPLINGMODE,a=null,o=null,h=5,l,u){return new m("data:"+t,i,r,s,n,a,o,e,!1,h,void 0,void 0,l,u)}static LoadFromDataString(e,t,i,r=!1,s,n=!0,a=m.TRILINEAR_SAMPLINGMODE,o=null,h=null,l=5,u,c){return"data:"!==e.substring(0,5)&&(e="data:"+e),new m(e,i,s,n,a,o,h,t,r,l,void 0,void 0,u,c)}}m.SerializeBuffers=!0,m.ForceSerializeBuffers=!1,m.OnTextureLoadErrorObservable=new n.y$,m._SerializeInternalTextureUniqueId=!1,m._CubeTextureParser=(e,t,i)=>{throw(0,l.S)("CubeTexture")},m._CreateMirror=(e,t,i,r)=>{throw(0,l.S)("MirrorTexture")},m._CreateRenderTargetTexture=(e,t,i,r,s)=>{throw(0,l.S)("RenderTargetTexture")},m.NEAREST_SAMPLINGMODE=1,m.NEAREST_NEAREST_MIPLINEAR=8,m.BILINEAR_SAMPLINGMODE=2,m.LINEAR_LINEAR_MIPNEAREST=11,m.TRILINEAR_SAMPLINGMODE=3,m.LINEAR_LINEAR_MIPLINEAR=3,m.NEAREST_NEAREST_MIPNEAREST=4,m.NEAREST_LINEAR_MIPNEAREST=5,m.NEAREST_LINEAR_MIPLINEAR=6,m.NEAREST_LINEAR=7,m.NEAREST_NEAREST=1,m.LINEAR_NEAREST_MIPNEAREST=9,m.LINEAR_NEAREST_MIPLINEAR=10,m.LINEAR_LINEAR=2,m.LINEAR_NEAREST=12,m.EXPLICIT_MODE=0,m.SPHERICAL_MODE=1,m.PLANAR_MODE=2,m.CUBIC_MODE=3,m.PROJECTION_MODE=4,m.SKYBOX_MODE=5,m.INVCUBIC_MODE=6,m.EQUIRECTANGULAR_MODE=7,m.FIXED_EQUIRECTANGULAR_MODE=8,m.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,m.CLAMP_ADDRESSMODE=0,m.WRAP_ADDRESSMODE=1,m.MIRROR_ADDRESSMODE=2,m.UseSerializedUrlIfAny=!1,(0,r.gn)([(0,s.qC)()],m.prototype,"url",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"uOffset",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"vOffset",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"uScale",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"vScale",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"uAng",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"vAng",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"wAng",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"uRotationCenter",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"vRotationCenter",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"wRotationCenter",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"homogeneousRotationInUVTransform",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"isBlocking",null),(0,h.H7)("BABYLON.Texture",m),g.p._TextureParser=m.Parse},72831:function(e,t,i){i.d(t,{a:function(){return r}});class r{get wrapU(){return this._cachedWrapU}set wrapU(e){this._cachedWrapU=e}get wrapV(){return this._cachedWrapV}set wrapV(e){this._cachedWrapV=e}get wrapR(){return this._cachedWrapR}set wrapR(e){this._cachedWrapR=e}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(e){this._cachedAnisotropicFilteringLevel=e}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(e){this._comparisonFunction=e}get useMipMaps(){return this._useMipMaps}set useMipMaps(e){this._useMipMaps=e}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(e=1,t=1,i=1,r=1,s=2,n=0){return this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=s,this._comparisonFunction=n,this}compareSampler(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps}}},14187:function(e,t,i){i.d(t,{g:function(){return s}});var r=i(33005);class s{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return e?.shareDepth!==void 0}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=r.$.Zero(),this._cachedBaseSize=r.$.Zero(),this._initialSamplingMode=2,this._texture=s._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;this._texture._size&&(this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size)}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0),this._cachedBaseSize}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}},49449:function(e,t,i){function r(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function s(e,t,i){let r=!!(e.clipPlane??t.clipPlane),s=!!(e.clipPlane2??t.clipPlane2),n=!!(e.clipPlane3??t.clipPlane3),a=!!(e.clipPlane4??t.clipPlane4),o=!!(e.clipPlane5??t.clipPlane5),h=!!(e.clipPlane6??t.clipPlane6);r&&i.push("#define CLIPPLANE"),s&&i.push("#define CLIPPLANE2"),n&&i.push("#define CLIPPLANE3"),a&&i.push("#define CLIPPLANE4"),o&&i.push("#define CLIPPLANE5"),h&&i.push("#define CLIPPLANE6")}function n(e,t,i){let r=!1,s=!!(e.clipPlane??t.clipPlane),n=!!(e.clipPlane2??t.clipPlane2),a=!!(e.clipPlane3??t.clipPlane3),o=!!(e.clipPlane4??t.clipPlane4),h=!!(e.clipPlane5??t.clipPlane5),l=!!(e.clipPlane6??t.clipPlane6);return i.CLIPPLANE!==s&&(i.CLIPPLANE=s,r=!0),i.CLIPPLANE2!==n&&(i.CLIPPLANE2=n,r=!0),i.CLIPPLANE3!==a&&(i.CLIPPLANE3=a,r=!0),i.CLIPPLANE4!==o&&(i.CLIPPLANE4=o,r=!0),i.CLIPPLANE5!==h&&(i.CLIPPLANE5=h,r=!0),i.CLIPPLANE6!==l&&(i.CLIPPLANE6=l,r=!0),r}function a(e,t,i){let r=t.clipPlane??i.clipPlane;o(e,"vClipPlane",r),o(e,"vClipPlane2",r=t.clipPlane2??i.clipPlane2),o(e,"vClipPlane3",r=t.clipPlane3??i.clipPlane3),o(e,"vClipPlane4",r=t.clipPlane4??i.clipPlane4),o(e,"vClipPlane5",r=t.clipPlane5??i.clipPlane5),o(e,"vClipPlane6",r=t.clipPlane6??i.clipPlane6)}function o(e,t,i){i&&e.setFloat4(t,i.normal.x,i.normal.y,i.normal.z,i.d)}i.d(t,{AN:function(){return n},an:function(){return a},lK:function(){return s},qx:function(){return r}})},40172:function(e,t,i){i.d(t,{Q:function(){return r}});function r(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}},90982:function(e,t,i){i.d(t,{U:function(){return h}});var r=i(46456),s=i(22287),n=i(57449),a=i(90212),o=i(40172);class h{constructor(){this._dirty=!0,this._tempColor=new n.HE(0,0,0,0),this._globalCurve=new n.HE(0,0,0,0),this._highlightsCurve=new n.HE(0,0,0,0),this._midtonesCurve=new n.HE(0,0,0,0),this._shadowsCurve=new n.HE(0,0,0,0),this._positiveCurve=new n.HE(0,0,0,0),this._negativeCurve=new n.HE(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(e){this._globalHue=e,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(e){this._globalDensity=e,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(e){this._globalSaturation=e,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(e){this._globalExposure=e,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(e){this._highlightsHue=e,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(e){this._highlightsDensity=e,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(e){this._highlightsSaturation=e,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(e){this._highlightsExposure=e,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(e){this._midtonesHue=e,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(e){this._midtonesDensity=e,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(e){this._midtonesSaturation=e,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(e){this._midtonesExposure=e,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(e){this._shadowsHue=e,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(e){this._shadowsDensity=e,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(e){this._shadowsSaturation=e,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(e){this._shadowsExposure=e,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(e,t,i="vCameraColorCurvePositive",r="vCameraColorCurveNeutral",s="vCameraColorCurveNegative"){e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(s,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))}_getColorGradingDataToRef(e,t,i,r,s){null!=e&&(e=h._Clamp(e,0,360),t=h._Clamp(t,-100,100),i=h._Clamp(i,-100,100),r=h._Clamp(r,-100,100),t=.5*h._ApplyColorGradingSliderNonlinear(t),r=h._ApplyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),h._FromHSBToRef(e,t,50+.25*r,s),s.scaleToRef(2,s),s.a=1+.01*i)}static _ApplyColorGradingSliderNonlinear(e){let t=Math.abs(e/=100);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100}static _FromHSBToRef(e,t,i,r){let s=h._Clamp(e,0,360),n=h._Clamp(t/100,0,1),a=h._Clamp(i/100,0,1);if(0===n)r.r=a,r.g=a,r.b=a;else{let e=Math.floor(s/=60),t=s-e,i=a*(1-n),o=a*(1-n*t),h=a*(1-n*(1-t));switch(e){case 0:r.r=a,r.g=h,r.b=i;break;case 1:r.r=o,r.g=a,r.b=i;break;case 2:r.r=i,r.g=a,r.b=h;break;case 3:r.r=i,r.g=o,r.b=a;break;case 4:r.r=h,r.g=i,r.b=a;break;default:r.r=a,r.g=i,r.b=o}}r.a=1}static _Clamp(e,t,i){return Math.min(Math.max(e,t),i)}clone(){return a.p.Clone(()=>new h,this)}serialize(){return a.p.Serialize(this)}static Parse(e){return a.p.Parse(()=>new h,e,null,null)}}h.PrepareUniforms=o.Q,(0,r.gn)([(0,s.qC)()],h.prototype,"_globalHue",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_globalDensity",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_globalSaturation",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_globalExposure",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_highlightsHue",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_highlightsDensity",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_highlightsSaturation",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_highlightsExposure",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_midtonesHue",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_midtonesDensity",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_midtonesSaturation",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"_midtonesExposure",void 0),a.p._ColorCurvesParser=h.Parse},44673:function(e,t,i){i.d(t,{A:function(){return r}});function r(e){return void 0===e.getPipelineContext}},83260:function(e,t,i){i.d(t,{q:function(){return r}});class r{static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}constructor(e,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}setEffect(e,t,i=!0){this.effect=e,void 0!==t&&(this.defines=t),i&&this.drawContext?.reset()}dispose(){this.drawContext?.dispose()}}},97827:function(e,t,i){i.d(t,{Z9:function(){return c},ZI:function(){return u},dR:function(){return l},sp:function(){return d}});var r=i(28143),s=i(37112),n=i(29427),a=i(9719),o=i(96305),h=i(56172);function l(e,t){return(0,s.iU)(t).cachedPipelines[e]}function u(e){let t=e._name,i=e.context;if(t&&i){let e=(0,s.iU)(i),r=e.cachedPipelines[t];r?.dispose(),delete e.cachedPipelines[t]}}function c(e,t,i,s,n,a,h){let l,u;let c=(0,r.CG)()?a?.getHostDocument():null;l="string"==typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?c?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,u="string"==typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?c?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;let d=[void 0,void 0],p=()=>{if(d[0]&&d[1]){e.isFragment=!0;let[r,l]=d;(0,o.An)(l,e,(a,l)=>{var u,c;h&&(h._fragmentSourceCodeBeforeMigration=l),i&&(a=i("fragment",a));let _=(0,o.Ku)(r,a,e);e=null;let d=(u=_.vertexCode,c=_.fragmentCode,t?{vertexSourceCode:(1===n?"//":"")+"#define SHADER_NAME vertex:"+(t.vertexElement||t.vertex||t.spectorName||t)+"\n"+u,fragmentSourceCode:(1===n?"//":"")+"#define SHADER_NAME fragment:"+(t.fragmentElement||t.fragment||t.spectorName||t)+"\n"+c}:{vertexSourceCode:u,fragmentSourceCode:c});s?.(d.vertexSourceCode,d.fragmentSourceCode)},a)}};_(l,"Vertex","",t=>{(0,o.wz)(e),(0,o.An)(t,e,(e,r)=>{h&&(h._rawVertexSourceCode=t,h._vertexSourceCodeBeforeMigration=r),i&&(e=i("vertex",e)),d[0]=e,p()},a)},n),_(u,"Fragment","Pixel",e=>{h&&(h._rawFragmentSourceCode=e),d[1]=e,p()},n)}function _(e,t,i,s,a,o){let l;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement){s((0,r.v)(e));return}if("source:"===e.substring(0,7)){s(e.substring(7));return}if("base64:"===e.substring(0,7)){s(window.atob(e.substring(7)));return}let u=n.v.GetShadersStore(a);if(u[e+t+"Shader"]){s(u[e+t+"Shader"]);return}if(i&&u[e+i+"Shader"]){s(u[e+i+"Shader"]);return}if(l="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:n.v.GetShadersRepository(a)+e,!(o=o||h.wv))throw Error("loadFileInjection is not defined");o(l+"."+t.toLowerCase()+".fx",s)}let d=(e,t,i,r)=>{try{let n=e.existingPipelineContext||t(e.shaderProcessingContext);return n._name=e.name,e.name&&e.context&&((0,s.iU)(e.context).cachedPipelines[e.name]=n),i(n,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",()=>{r(n,()=>{e.onRenderingStateCompiled?.(n)})}),n}catch(e){throw a.Y.Error("Error compiling effect"),e}}},97937:function(e,t,i){i.d(t,{Q:function(){return o}});var r=i(82877),s=i(9719),n=i(29427),a=i(97827);class o{static get ShadersRepository(){return n.v.ShadersRepository}static set ShadersRepository(e){n.v.ShadersRepository=e}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new r.y$),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(e,t,i,s=null,n,h=null,l=null,u=null,c=null,_,d="",p=0,f){let g;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new r.y$,this.onErrorObservable=new r.y$,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=e,this._key=d;let m=this._key.replace(/\r/g,"").replace(/\n/g,"|");if(t.attributes){if(this._engine=i,this._attributesNames=t.attributes,this._uniformsNames=t.uniformsNames.concat(t.samplers),this._samplerList=t.samplers.slice(),this.defines=t.defines,this.onError=t.onError,this.onCompiled=t.onCompiled,this._fallbacks=t.fallbacks,this._indexParameters=t.indexParameters,this._transformFeedbackVaryings=t.transformFeedbackVaryings||null,this._multiTarget=!!t.multiTarget,this._shaderLanguage=t.shaderLanguage??0,t.uniformBuffersNames){this._uniformBuffersNamesList=t.uniformBuffersNames.slice();for(let e=0;e<t.uniformBuffersNames.length;e++)this._uniformBuffersNames[t.uniformBuffersNames[e]]=e}this._processFinalCode=t.processFinalCode??null,this._processCodeAfterIncludes=t.processCodeAfterIncludes??void 0,g=t.existingPipelineContext}else this._engine=n,this.defines=null==h?"":h,this._uniformsNames=i.concat(s),this._samplerList=s?s.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=p,this.onError=c,this.onCompiled=u,this._indexParameters=_,this._fallbacks=l;"WEBGL2"===this._engine.shaderPlatformName&&(g=(0,a.dR)(m,this._engine._gl)??g),this._attributeLocationByName={},this.uniqueId=o._UniqueIdSeed++,g?(this._pipelineContext=g,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,f)}async _processShaderCodeAsync(e=null,t=!1,i=null,r){r&&await r(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);let s={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:e??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:n.v.GetShadersRepository(this._shaderLanguage),includesShadersStore:n.v.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,a.Z9)(s,this.name,this._processFinalCode,(e,i)=>{this._vertexSourceCode=e,this._fragmentSourceCode=i,this._prepareEffect(t)},this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.isDisposed||!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(e){return this._attributes[e]}getAttributeLocationByName(e){return this._attributeLocationByName[e]}getAttributesCount(){return this._attributes.length}getUniformIndex(e){return this._uniformsNames.indexOf(e)}getUniform(e){return this._uniforms[e]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(e){if(this.isReady()){e(this);return}this.onCompileObservable.add(t=>{e(t)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&setTimeout(()=>{this._checkIsReady(null)},16)}_checkIsReady(e){try{if(this._isReadyInternal())return}catch(t){this._processCompilationErrors(t,e);return}this._isDisposed||setTimeout(()=>{this._checkIsReady(e)},16)}get vertexSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._pipelineContext?._getVertexShaderCode()??this._vertexSourceCode}get fragmentSourceCode(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._pipelineContext?._getFragmentShaderCode()??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride)}}}_rebuildProgram(e,t,i,r){this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=(e,t)=>{r&&r(t)},this.onCompiled=()=>{let e=this.getEngine().scenes;if(e)for(let t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);this._pipelineContext._handlesSpectorRebuildCallback?.(i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(e){if(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let e=0;e<this._attributesNames.length;e++){let t=this._attributesNames[e];this._attributeLocationByName[t]=this._attributes[e]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh()}_prepareEffect(e=!1){let t=this._pipelineContext;this._isReady=!1;try{let i=!!(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride),r=i?null:this.defines,s=i?this._vertexSourceCodeOverride:this._vertexSourceCode,n=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=(0,a.sp)({existingPipelineContext:e?t:null,vertex:s,fragment:n,context:"WEBGL2"===o.shaderPlatformName?o._gl:void 0,rebuildRebind:(e,t,i,r)=>this._rebuildProgram(e,t,i,r),defines:r,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,parallelShaderCompile:o._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{t&&!e&&this._engine._deletePipelineContext(t),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(e){this._processCompilationErrors(e,t)}}_getShaderCodeAndErrorLine(e,t,i){let r=null;if(t&&e){let s=t.match(i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/);if(s&&2===s.length){let t=parseInt(s[1]),n=e.split("\n",-1);n.length>=t&&(r=`Offending line [${t}] in ${i?"fragment":"vertex"} code: ${n[t-1]}`)}}return[e,r]}_processCompilationErrors(e,t=null){this._compilationError=e.message;let i=this._attributesNames,r=this._fallbacks;if(s.Y.Error("Unable to compile effect:"),s.Y.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),s.Y.Error("Attributes: "+i.map(function(e){return" "+e})),s.Y.Error("Defines:\n"+this.defines),o.LogShaderCodeOnCompilationError){let e=null,t=null,i=null;this._pipelineContext?._getVertexShaderCode()&&([i,e]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(s.Y.Error("Vertex code:"),s.Y.Error(i))),this._pipelineContext?._getFragmentShaderCode()&&([i,t]=this._getShaderCodeAndErrorLine(this._pipelineContext?._getFragmentShaderCode(),this._compilationError,!0),i&&(s.Y.Error("Fragment code:"),s.Y.Error(i))),e&&s.Y.Error(e),t&&s.Y.Error(t)}s.Y.Error("Error: "+this._compilationError);let n=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};t&&(this._pipelineContext=t,this._isReady=!0,n()),r?(this._pipelineContext=null,r.hasMoreFallbacks?(this._allFallbacksProcessed=!1,s.Y.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,n(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||n())}get isSupported(){return""===this._compilationError}_bindTexture(e,t){this._engine._bindTexture(this._samplers[e],t,e)}setTexture(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)}setTextureArray(e,t){let i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){let r=this._samplerList.indexOf(e);for(let e=1;e<t.length;e++){let t=i+(e-1).toString();this._samplerList.splice(r+e,0,t)}let s=0;for(let e of this._samplerList)this._samplers[e]=s,s+=1}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)}bindUniformBuffer(e,t){let i=this._uniformBuffersNames[t];void 0===i||o._BaseCache[i]===e&&this._engine._features.useUBOBindingCache||(o._BaseCache[i]=e,this._engine.bindUniformBufferBase(e,i,t))}bindUniformBlock(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)}setInt(e,t){return this._pipelineContext.setInt(e,t),this}setInt2(e,t,i){return this._pipelineContext.setInt2(e,t,i),this}setInt3(e,t,i,r){return this._pipelineContext.setInt3(e,t,i,r),this}setInt4(e,t,i,r,s){return this._pipelineContext.setInt4(e,t,i,r,s),this}setIntArray(e,t){return this._pipelineContext.setIntArray(e,t),this}setIntArray2(e,t){return this._pipelineContext.setIntArray2(e,t),this}setIntArray3(e,t){return this._pipelineContext.setIntArray3(e,t),this}setIntArray4(e,t){return this._pipelineContext.setIntArray4(e,t),this}setUInt(e,t){return this._pipelineContext.setUInt(e,t),this}setUInt2(e,t,i){return this._pipelineContext.setUInt2(e,t,i),this}setUInt3(e,t,i,r){return this._pipelineContext.setUInt3(e,t,i,r),this}setUInt4(e,t,i,r,s){return this._pipelineContext.setUInt4(e,t,i,r,s),this}setUIntArray(e,t){return this._pipelineContext.setUIntArray(e,t),this}setUIntArray2(e,t){return this._pipelineContext.setUIntArray2(e,t),this}setUIntArray3(e,t){return this._pipelineContext.setUIntArray3(e,t),this}setUIntArray4(e,t){return this._pipelineContext.setUIntArray4(e,t),this}setFloatArray(e,t){return this._pipelineContext.setArray(e,t),this}setFloatArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setFloatArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setFloatArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setArray(e,t){return this._pipelineContext.setArray(e,t),this}setArray2(e,t){return this._pipelineContext.setArray2(e,t),this}setArray3(e,t){return this._pipelineContext.setArray3(e,t),this}setArray4(e,t){return this._pipelineContext.setArray4(e,t),this}setMatrices(e,t){return this._pipelineContext.setMatrices(e,t),this}setMatrix(e,t){return this._pipelineContext.setMatrix(e,t),this}setMatrix3x3(e,t){return this._pipelineContext.setMatrix3x3(e,t),this}setMatrix2x2(e,t){return this._pipelineContext.setMatrix2x2(e,t),this}setFloat(e,t){return this._pipelineContext.setFloat(e,t),this}setBool(e,t){return this._pipelineContext.setInt(e,t?1:0),this}setVector2(e,t){return this._pipelineContext.setVector2(e,t),this}setFloat2(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this}setVector3(e,t){return this._pipelineContext.setVector3(e,t),this}setFloat3(e,t,i,r){return this._pipelineContext.setFloat3(e,t,i,r),this}setVector4(e,t){return this._pipelineContext.setVector4(e,t),this}setQuaternion(e,t){return this._pipelineContext.setQuaternion(e,t),this}setFloat4(e,t,i,r,s){return this._pipelineContext.setFloat4(e,t,i,r,s),this}setColor3(e,t){return this._pipelineContext.setColor3(e,t),this}setColor4(e,t,i){return this._pipelineContext.setColor4(e,t,i),this}setDirectColor4(e,t){return this._pipelineContext.setDirectColor4(e,t),this}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,a.ZI)(this._pipelineContext),this._engine._releaseEffect(this),this._isDisposed=!0)}static RegisterShader(e,t,i,r=0){t&&(n.v.GetShadersStore(r)[`${e}PixelShader`]=t),i&&(n.v.GetShadersStore(r)[`${e}VertexShader`]=i)}static ResetCache(){o._BaseCache={}}}o.LogShaderCodeOnCompilationError=!0,o._UniqueIdSeed=0,o._BaseCache={},o.ShadersStore=n.v.ShadersStore,o.IncludesShadersStore=n.v.IncludesShadersStore},42620:function(e,t,i){i.d(t,{O:function(){return n},u:function(){return s}});var r=i(40172);function s(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&e.push("vInverseScreenSize"),t.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&(0,r.Q)(e),t.DITHER&&e.push("ditherIntensity")}function n(e,t){t.COLORGRADING&&e.push("txColorTransform")}},91176:function(e,t,i){i.d(t,{$:function(){return _}});var r=i(46456),s=i(22287),n=i(82877),a=i(57449),o=i(90982),h=i(61146),l=i(90212),u=i(42620),c=i(7724);class _{constructor(){this.colorCurves=new o.U,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=_.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new a.HE(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=_.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new n.y$}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())}get exposure(){return this._exposure}set exposure(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())}get contrast(){return this._contrast}set contrast(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(e){this.vignetteCenterY=e}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(e){this.vignetteCenterX=e}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(e){this._ditheringIntensity!==e&&(this._ditheringIntensity=e,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(e,t=!1){if(t!==this.applyByPostProcess||!this._isEnabled){e.VIGNETTE=!1,e.TONEMAPPING=0,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.DITHER=!1,e.IMAGEPROCESSING=!1,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}if(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===_._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case _.TONEMAPPING_KHR_PBR_NEUTRAL:e.TONEMAPPING=3;break;case _.TONEMAPPING_ACES:e.TONEMAPPING=2;break;default:e.TONEMAPPING=1}else e.TONEMAPPING=0;e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.DITHER=this._ditheringEnabled,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,e.IMAGEPROCESSING=e.VIGNETTE||!!e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING||e.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&o.U.Bind(this.colorCurves,e),this._vignetteEnabled||this._ditheringEnabled){let i=1/e.getEngine().getRenderWidth(),r=1/e.getEngine().getRenderHeight();if(e.setFloat2("vInverseScreenSize",i,r),this._ditheringEnabled&&e.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){let s=null!=t?t:r/i,n=Math.tan(.5*this.vignetteCameraFov),a=n*s,o=Math.sqrt(a*n);a=(0,h.V2)(a,o,this.vignetteStretch),n=(0,h.V2)(n,o,this.vignetteStretch),e.setFloat4("vignetteSettings1",a,n,-a*this.vignetteCenterX,-n*this.vignetteCenterY);let l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);let t=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(t-1)/t,.5/t,t,this.colorGradingTexture.level)}}clone(){return l.p.Clone(()=>new _,this)}serialize(){return l.p.Serialize(this)}static Parse(e){let t=l.p.Parse(()=>new _,e,null,null);return void 0!==e.vignetteCentreX&&(t.vignetteCenterX=e.vignetteCentreX),void 0!==e.vignetteCentreY&&(t.vignetteCenterY=e.vignetteCentreY),t}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}_.TONEMAPPING_STANDARD=0,_.TONEMAPPING_ACES=1,_.TONEMAPPING_KHR_PBR_NEUTRAL=2,_.PrepareUniforms=u.u,_.PrepareSamplers=u.O,_._VIGNETTEMODE_MULTIPLY=0,_._VIGNETTEMODE_OPAQUE=1,(0,r.gn)([(0,s.N$)()],_.prototype,"colorCurves",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_colorCurvesEnabled",void 0),(0,r.gn)([(0,s.oU)("colorGradingTexture")],_.prototype,"_colorGradingTexture",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_colorGradingEnabled",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_colorGradingWithGreenDepth",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_colorGradingBGR",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_exposure",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_toneMappingEnabled",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_toneMappingType",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_contrast",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"vignetteStretch",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"vignetteCenterX",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"vignetteCenterY",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"vignetteWeight",void 0),(0,r.gn)([(0,s.XX)()],_.prototype,"vignetteColor",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"vignetteCameraFov",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_vignetteBlendMode",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_vignetteEnabled",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_ditheringEnabled",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_ditheringIntensity",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_skipFinalColorClamp",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_applyByPostProcess",void 0),(0,r.gn)([(0,s.qC)()],_.prototype,"_isEnabled",void 0),l.p._ImageProcessingConfigurationParser=_.Parse,(0,c.H7)("BABYLON.ImageProcessingConfiguration",_)},5848:function(e,t,i){i.d(t,{F:function(){return g}});var r=i(46456),s=i(22287),n=i(4224),a=i(82877),o=i(51092),h=i(34066),l=i(76608),u=i(9719),c=i(47941),_=i(83260),d=i(90212);class p{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){d.p.Clone(()=>e,this)}serialize(){return d.p.Serialize(this)}parse(e,t,i){d.p.Parse(()=>this,e,t,i)}}(0,r.gn)([(0,s.qC)()],p.prototype,"func",null),(0,r.gn)([(0,s.qC)()],p.prototype,"funcRef",null),(0,r.gn)([(0,s.qC)()],p.prototype,"funcMask",null),(0,r.gn)([(0,s.qC)()],p.prototype,"opStencilFail",null),(0,r.gn)([(0,s.qC)()],p.prototype,"opDepthFail",null),(0,r.gn)([(0,s.qC)()],p.prototype,"opStencilDepthPass",null),(0,r.gn)([(0,s.qC)()],p.prototype,"mask",null),(0,r.gn)([(0,s.qC)()],p.prototype,"enabled",null);var f=i(3609);class g{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;let t=this._alpha;this._alpha=e,(1===t||1===e)&&this.markAsDirty(g.MiscDirtyFlag+g.PrePassDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(g.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.markAsDirty(g.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.markDirty())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new a.y$),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new a.y$),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new a.y$),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(g.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(g.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case g.WireFrameFillMode:case g.LineListDrawMode:case g.LineLoopDrawMode:case g.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?g.WireFrameFillMode:g.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case g.PointFillMode:case g.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?g.PointFillMode:g.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(g.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){let t=this.getScene().getEngine().getCaps().fragmentDepthSupported;e&&!t&&u.Y.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,t,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new a.y$,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new p,this._useUBO=!1,this._fillMode=g.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>void 0,this._callbackPluginEventIsReadyForSubMesh=()=>void 0,this._callbackPluginEventPrepareDefines=()=>void 0,this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>void 0,this._callbackPluginEventHardBindForSubMesh=()=>void 0,this._callbackPluginEventBindForSubMesh=()=>void 0,this._callbackPluginEventHasRenderTargetTextures=()=>void 0,this._callbackPluginEventFillRenderTargetTextures=()=>void 0,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=e;let r=t||o.l.LastCreatedScene;if(!r)return;this._scene=r,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||n.w1.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new _.q(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new l.M(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),g.OnEventObservable.notifyObservers(this,1)}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(e,t){return!0}isReadyForSubMesh(e,t,i){let r=t.materialDefines;return!!r&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=r,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===g.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===g.MATERIAL_OPAQUE||this._transparencyMode===g.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(e){return e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(e=!1){for(let t of this.getScene().meshes)if(t.subMeshes){for(let i of t.subMeshes)if(i.getMaterial()===this)for(let t of i._drawWrappers)t&&this._materialContext===t.materialContext&&(t._wasPreviouslyReady=!1,t._wasPreviouslyUsingInstances=null,t._forceRebindOnNextCall=e)}e&&this.markAsDirty(g.AllDirtyFlag)}_preBind(e,t=null){let i=this._scene.getEngine(),r=(null==t?this.sideOrientation:t)===g.ClockWiseSideOrientation;return i.enableEffect(e||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,r,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),r}bind(e,t){}buildUniformLayout(){let e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,t,i){let r=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),r._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)}_afterBind(e,t=null,i){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,(0,f.ml)(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),e?this._scene._cachedVisibility=e.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){let e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){let e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){let e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}unbind(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,t){let i={};if(this._serializePlugins(i),g._ParsePlugins(i,e,this._scene,t),this.pluginManager)for(let t of this.pluginManager._plugins){let i=e.pluginManager.getPlugin(t.name);i&&t.copyTo(i)}}getBindedMeshes(){if(!this.meshMap)return this._scene.meshes.filter(e=>e.material===this);{let e=[];for(let t in this.meshMap){let i=this.meshMap[t];i&&e.push(i)}return e}}forceCompilation(e,t,i,r){let s={clipPlane:!1,useInstances:!1,...i},n=this.getScene(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;let o=()=>{if(!this._scene||!this._scene.getEngine())return;let i=n.clipPlane;if(s.clipPlane&&(n.clipPlane=new c.J(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,n=null;if(e.subMeshes){let t=new h.P(0,0,0,0,0,e,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(e,t,s.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?n=t.effect.getCompilationError():(i=!1,setTimeout(o,16)))}i&&(this.allowShaderHotSwapping=a,n&&r&&r(n),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=a,t&&t(this)):setTimeout(o,16);s.clipPlane&&(n.clipPlane=i)};o()}forceCompilationAsync(e,t){return new Promise((i,r)=>{this.forceCompilation(e,()=>{i()},t,e=>{r(e)})})}markAsDirty(e){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(g._DirtyCallbackArray.length=0,e&g.TextureDirtyFlag&&g._DirtyCallbackArray.push(g._TextureDirtyCallBack),e&g.LightDirtyFlag&&g._DirtyCallbackArray.push(g._LightsDirtyCallBack),e&g.FresnelDirtyFlag&&g._DirtyCallbackArray.push(g._FresnelDirtyCallBack),e&g.AttributesDirtyFlag&&g._DirtyCallbackArray.push(g._AttributeDirtyCallBack),e&g.MiscDirtyFlag&&g._DirtyCallbackArray.push(g._MiscDirtyCallBack),e&g.PrePassDirtyFlag&&g._DirtyCallbackArray.push(g._PrePassDirtyCallBack),g._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(g._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){for(let e of this.getScene().meshes)if(e.subMeshes)for(let t of e.subMeshes)t.getMaterial()===this&&t.resetDrawCache()}_markAllSubMeshesAsDirty(e){if(!this.getScene().blockMaterialDirtyMechanism&&!this._blockDirtyMechanism){for(let t of this.getScene().meshes)if(t.subMeshes){for(let i of t.subMeshes)if(i.getMaterial(!1)===this)for(let t of i._drawWrappers)t&&t.defines&&t.defines.markAllAsDirty&&this._materialContext===t.materialContext&&e(t.defines)}}}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;let e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(g._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(g._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(g._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(g._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(g._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(g._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(g._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(g._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(g._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(g._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;let e=this._scene.onScenePerformancePriorityChangedObservable.addOnce(()=>{this.checkReadyOnlyOnce=!1});this.onDisposeObservable.add(()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)})}}setPrePassRenderer(e){return!1}dispose(e,t,i){let r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){let e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==i){if(this.meshMap)for(let t in this.meshMap){let i=this.meshMap[t];i&&(i.material=null,this.releaseVertexArrayObject(i,e))}else for(let t of r.meshes)t.material!==this||t.sourceMesh||(t.material=null,this.releaseVertexArrayObject(t,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(e,t){let i=e.geometry;if(i){if(this._storeEffectOnSubMeshes){if(e.subMeshes)for(let r of e.subMeshes)i._releaseVertexArrayObject(r.effect),t&&r.effect&&r.effect.dispose()}else i._releaseVertexArrayObject(this._drawWrapper.effect)}}serialize(){let e=d.p.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(let t of this.pluginManager._plugins)e.plugins[t.getClassName()]=t.serialize()}static Parse(e,t,i){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return u.Y.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";let r=n.w1.Instantiate(e.customType).Parse(e,t,i);return r._loadedUniqueId=e.uniqueId,r}static _ParsePlugins(e,t,i,r){if(e.plugins)for(let s in e.plugins){let a=e.plugins[s],o=t.pluginManager?.getPlugin(a.name);if(!o){let e=n.w1.Instantiate("BABYLON."+s);e&&(o=new e(t))}o?.parse(a,i,r)}}}g.TriangleFillMode=0,g.WireFrameFillMode=1,g.PointFillMode=2,g.PointListDrawMode=3,g.LineListDrawMode=4,g.LineLoopDrawMode=5,g.LineStripDrawMode=6,g.TriangleStripDrawMode=7,g.TriangleFanDrawMode=8,g.ClockWiseSideOrientation=0,g.CounterClockWiseSideOrientation=1,g.TextureDirtyFlag=1,g.LightDirtyFlag=2,g.FresnelDirtyFlag=4,g.AttributesDirtyFlag=8,g.MiscDirtyFlag=16,g.PrePassDirtyFlag=32,g.AllDirtyFlag=63,g.MATERIAL_OPAQUE=0,g.MATERIAL_ALPHATEST=1,g.MATERIAL_ALPHABLEND=2,g.MATERIAL_ALPHATESTANDBLEND=3,g.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,g.MATERIAL_NORMALBLENDMETHOD_RNM=1,g.OnEventObservable=new a.y$,g._AllDirtyCallBack=e=>e.markAllAsDirty(),g._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),g._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),g._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),g._MiscDirtyCallBack=e=>e.markAsMiscDirty(),g._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),g._LightsDirtyCallBack=e=>e.markAsLightDirty(),g._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),g._FresnelAndMiscDirtyCallBack=e=>{g._FresnelDirtyCallBack(e),g._MiscDirtyCallBack(e)},g._TextureAndMiscDirtyCallBack=e=>{g._TextureDirtyCallBack(e),g._MiscDirtyCallBack(e)},g._DirtyCallbackArray=[],g._RunDirtyCallBacks=e=>{for(let t of g._DirtyCallbackArray)t(e)},(0,r.gn)([(0,s.qC)()],g.prototype,"id",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"uniqueId",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"name",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"metadata",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"checkReadyOnEveryCall",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"checkReadyOnlyOnce",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"state",void 0),(0,r.gn)([(0,s.qC)("alpha")],g.prototype,"_alpha",void 0),(0,r.gn)([(0,s.qC)("backFaceCulling")],g.prototype,"_backFaceCulling",void 0),(0,r.gn)([(0,s.qC)("cullBackFaces")],g.prototype,"_cullBackFaces",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"sideOrientation",void 0),(0,r.gn)([(0,s.qC)("alphaMode")],g.prototype,"_alphaMode",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"_needDepthPrePass",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"disableDepthWrite",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"disableColorWrite",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"forceDepthWrite",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"depthFunction",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"separateCullingPass",void 0),(0,r.gn)([(0,s.qC)("fogEnabled")],g.prototype,"_fogEnabled",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"pointSize",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"zOffset",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"zOffsetUnits",void 0),(0,r.gn)([(0,s.qC)()],g.prototype,"pointsCloud",null),(0,r.gn)([(0,s.qC)()],g.prototype,"fillMode",null),(0,r.gn)([(0,s.qC)()],g.prototype,"useLogarithmicDepth",null),(0,r.gn)([(0,s.qC)()],g.prototype,"transparencyMode",null)},3609:function(e,t,i){i.d(t,{BV:function(){return S},D1:function(){return c},DI:function(){return V},Er:function(){return w},FU:function(){return O},KG:function(){return f},KL:function(){return R},Kg:function(){return N},Lh:function(){return y},NL:function(){return T},Ni:function(){return F},TD:function(){return x},UX:function(){return M},VX:function(){return P},Vk:function(){return _},YM:function(){return G},Z7:function(){return L},aM:function(){return C},gz:function(){return u},hR:function(){return k},l6:function(){return v},lw:function(){return m},ml:function(){return g},n5:function(){return d},od:function(){return A},pd:function(){return E},qx:function(){return b},t6:function(){return U},vG:function(){return D},wJ:function(){return B},wg:function(){return I},y9:function(){return p}});var r=i(9719),s=i(57449),n=i(51092),a=i(42044),o=i(49449);let h=s.Wo.Black(),l={NUM_MORPH_INFLUENCERS:0};function u(e,t,i){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){let e=i.activeCamera;1===e.mode&&r.Y.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function c(e,t,i,r=!1){i&&e.fogEnabled&&(!t||t.applyFog)&&0!==e.fogMode&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),r?(e.fogColor.toLinearSpaceToRef(h,e.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",h)):i.setColor3("vFogColor",e.fogColor))}function _(e,t,i){l.NUM_MORPH_INFLUENCERS=i,d(e,t,l)}function d(e,t,i){let s=i.NUM_MORPH_INFLUENCERS;if(s>0&&n.l.LastCreatedEngine){let a=n.l.LastCreatedEngine.getCaps().maxVertexAttribs,o=t.morphTargetManager;if(o?.isUsingTextureForTargets)return;let h=o&&o.supportsNormals&&i.NORMAL,l=o&&o.supportsTangents&&i.TANGENT,u=o&&o.supportsUVs&&i.UV1;for(let i=0;i<s;i++)e.push("position"+i),h&&e.push("normal"+i),l&&e.push("tangent"+i),u&&e.push("uv_"+i),e.length>a&&r.Y.Error("Cannot add more vertex attributes for mesh "+t.name)}}function p(e,t=!1){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function f(e,t){let i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)}function g(e,t){t.bindToEffect(e,"Scene")}function m(e,t,i){t._needUVs=!0,t[i]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[i+"DIRECTUV"]=0}function T(e,t,i){let r=e.getTextureMatrix();t.updateMatrix(i+"Matrix",r)}function E(e,t,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function b(e,t,i){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){let r=e.skeleton;if(r.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){let i=r.getTransformMatrixTexture(e);t.setTexture("boneSampler",i),t.setFloat("boneTextureWidth",4*(r.bones.length+1))}else{let s=r.getTransformMatrices(e);s&&(t.setMatrices("mBones",s),i&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2))&&(i.previousBones[e.uniqueId]||(i.previousBones[e.uniqueId]=s.slice()),t.setMatrices("mPreviousBones",i.previousBones[e.uniqueId]),(0,i.previousBones[e.uniqueId]).set(s))}}}function R(e,t,i){e.transferToEffect(t,i+"")}function C(e,t,i,r,s,n=!0){e._bindLight(t,i,r,s,n)}function P(e,t,i,r,s=4){let n=Math.min(t.lightSources.length,s);for(let s=0;s<n;s++)C(t.lightSources[s],s,e,i,"boolean"==typeof r?r:r.SPECULARTERM,t.receiveShadows)}function x(e,t,i,r){i.NUM_BONE_INFLUENCERS>0&&(r.addCPUSkinningFallback(0,t),e.push("matricesIndices"),e.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function A(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&p(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push("instanceColor")}function y(e,t,i=4,r=0){let s=0;for(let n=0;n<i&&e["LIGHT"+n];n++)n>0&&(s=r+n,t.addFallback(s,"LIGHT"+n)),!e.SHADOWS&&(e["SHADOW"+n]&&t.addFallback(r,"SHADOW"+n),e["SHADOWPCF"+n]&&t.addFallback(r,"SHADOWPCF"+n),e["SHADOWPCSS"+n]&&t.addFallback(r,"SHADOWPCSS"+n),e["SHADOWPOISSON"+n]&&t.addFallback(r,"SHADOWPOISSON"+n),e["SHADOWESM"+n]&&t.addFallback(r,"SHADOWESM"+n),e["SHADOWCLOSEESM"+n]&&t.addFallback(r,"SHADOWCLOSEESM"+n));return s++}function v(e,t){return t.fogEnabled&&e.applyFog&&0!==t.fogMode}function S(e,t,i,r,s,n,a,o=!1){a._areMiscDirty&&(a.LOGARITHMICDEPTH=i,a.POINTSIZE=r,a.FOG=s&&v(e,t),a.NONUNIFORMSCALING=e.nonUniformScaling,a.ALPHATEST=n,a.DECAL_AFTER_DETAIL=o)}function M(e,t,i,r,s=4,n=!1){if(!i._areLightsDirty)return i._needNormals;let a=0,o={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!n){for(let n of t.lightSources)if(I(e,t,n,a,i,r,o),++a===s)break}i.SPECULARTERM=o.specularEnabled,i.SHADOWS=o.shadowEnabled;for(let e=a;e<s;e++)void 0!==i["LIGHT"+e]&&(i["LIGHT"+e]=!1,i["HEMILIGHT"+e]=!1,i["POINTLIGHT"+e]=!1,i["DIRLIGHT"+e]=!1,i["SPOTLIGHT"+e]=!1,i["SHADOW"+e]=!1,i["SHADOWCSM"+e]=!1,i["SHADOWCSMDEBUG"+e]=!1,i["SHADOWCSMNUM_CASCADES"+e]=!1,i["SHADOWCSMUSESHADOWMAXZ"+e]=!1,i["SHADOWCSMNOBLEND"+e]=!1,i["SHADOWCSM_RIGHTHANDED"+e]=!1,i["SHADOWPCF"+e]=!1,i["SHADOWPCSS"+e]=!1,i["SHADOWPOISSON"+e]=!1,i["SHADOWESM"+e]=!1,i["SHADOWCLOSEESM"+e]=!1,i["SHADOWCUBE"+e]=!1,i["SHADOWLOWQUALITY"+e]=!1,i["SHADOWMEDIUMQUALITY"+e]=!1);let h=e.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(o.needRebuild=!0),i.SHADOWFLOAT=o.shadowEnabled&&(h.textureFloatRender&&h.textureFloatLinearFiltering||h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&i.rebuild(),o.needNormals}function I(e,t,i,r,s,n,o){switch(o.needNormals=!0,void 0===s["LIGHT"+r]&&(o.needRebuild=!0),s["LIGHT"+r]=!0,s["SPOTLIGHT"+r]=!1,s["HEMILIGHT"+r]=!1,s["POINTLIGHT"+r]=!1,s["DIRLIGHT"+r]=!1,i.prepareLightSpecificDefines(s,r),s["LIGHT_FALLOFF_PHYSICAL"+r]=!1,s["LIGHT_FALLOFF_GLTF"+r]=!1,s["LIGHT_FALLOFF_STANDARD"+r]=!1,i.falloffType){case a.m.FALLOFF_GLTF:s["LIGHT_FALLOFF_GLTF"+r]=!0;break;case a.m.FALLOFF_PHYSICAL:s["LIGHT_FALLOFF_PHYSICAL"+r]=!0;break;case a.m.FALLOFF_STANDARD:s["LIGHT_FALLOFF_STANDARD"+r]=!0}if(n&&!i.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),s["SHADOW"+r]=!1,s["SHADOWCSM"+r]=!1,s["SHADOWCSMDEBUG"+r]=!1,s["SHADOWCSMNUM_CASCADES"+r]=!1,s["SHADOWCSMUSESHADOWMAXZ"+r]=!1,s["SHADOWCSMNOBLEND"+r]=!1,s["SHADOWCSM_RIGHTHANDED"+r]=!1,s["SHADOWPCF"+r]=!1,s["SHADOWPCSS"+r]=!1,s["SHADOWPOISSON"+r]=!1,s["SHADOWESM"+r]=!1,s["SHADOWCLOSEESM"+r]=!1,s["SHADOWCUBE"+r]=!1,s["SHADOWLOWQUALITY"+r]=!1,s["SHADOWMEDIUMQUALITY"+r]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){let t=i.getShadowGenerator(e.activeCamera)??i.getShadowGenerator();if(t){let e=t.getShadowMap();e&&e.renderList&&e.renderList.length>0&&(o.shadowEnabled=!0,t.prepareDefines(s,r))}}i.lightmapMode!=a.m.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,s["LIGHTMAPEXCLUDED"+r]=!0,s["LIGHTMAPNOSPECULAR"+r]=i.lightmapMode==a.m.LIGHTMAP_SHADOWSONLY):(s["LIGHTMAPEXCLUDED"+r]=!1,s["LIGHTMAPNOSPECULAR"+r]=!1)}function D(e,t,i,r,s,n=null,a=!1){let h=k(e,r);!1!==n&&(h=(0,o.AN)(i,e,r)),!t.getColorWrite()!==r.DEPTHPREPASS&&(r.DEPTHPREPASS=!r.DEPTHPREPASS,h=!0),r.INSTANCES!==s&&(r.INSTANCES=s,h=!0),r.THIN_INSTANCES!==a&&(r.THIN_INSTANCES=a,h=!0),h&&r.markAsUnprocessed()}function F(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;let i=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&i)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!i&&void 0;let r=e.getScene().prePassRenderer;if(r&&r.enabled){let i=-1===r.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=i}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}function O(e,t){let i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}function w(e,t){let i=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!!i&&!!i.isEnabled}function B(e,t,i,r,s=!1,n=!0,a=!0){if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent("normal"),t._needNormals&&e.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let i=1;i<=6;++i)t["UV"+i]=!!t._needUVs&&e.isVerticesDataPresent(`uv${1===i?"":i}`);if(i){let i=e.useVertexColors&&e.isVerticesDataPresent("color");t.VERTEXCOLOR=i,t.VERTEXALPHA=e.hasVertexAlpha&&i&&n}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),r&&F(e,t),s&&O(e,t),a&&w(e,t),!0}function L(e,t){if(e.activeCamera){let i=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=i&&t.markAsUnprocessed()}}function U(e,t,i){let r=t.ORDER_INDEPENDENT_TRANSPARENCY,s=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&i,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,(r!==t.ORDER_INDEPENDENT_TRANSPARENCY||s!==t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&t.markAsUnprocessed()}function N(e,t,i){let r=t.PREPASS;if(!t._arePrePassDirty)return;let s=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&i){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace;for(let i=0;i<s.length;i++){let r=e.prePassRenderer.getIndex(s[i].type);-1!==r?(t[s[i].define]=!0,t[s[i].index]=r):t[s[i].define]=!1}}else{t.PREPASS=!1;for(let e=0;e<s.length;e++)t[s[e].define]=!1}t.PREPASS!=r&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function k(e,t){let i=!1;if(e.activeCamera){let r=t.CAMERA_ORTHOGRAPHIC?1:0,s=t.CAMERA_PERSPECTIVE?1:0,n=1===e.activeCamera.mode?1:0,a=0===e.activeCamera.mode?1:0;(r^n||s^a)&&(t.CAMERA_ORTHOGRAPHIC=1===n,t.CAMERA_PERSPECTIVE=1===a,i=!0)}return i}function G(e,t,i,r,s=null,n=!1){s&&s.push("Light"+e),!n&&(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),i.push("shadowTexture"+e),i.push("depthTexture"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),r&&(i.push("projectionLightTexture"+e),t.push("textureProjectionMatrix"+e)))}function V(e,t,i,r=4){let s;let n=null;e.uniformsNames?(s=e.uniformsNames,n=e.uniformBuffersNames,t=e.samplers,i=e.defines,r=e.maxSimultaneousLights||0):(s=e,t||(t=[]));for(let e=0;e<r&&i["LIGHT"+e];e++)G(e,s,t,i["PROJECTEDLIGHTTEXTURE"+e],n);i.NUM_MORPH_INFLUENCERS&&(s.push("morphTargetInfluences"),s.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(s.push("bakedVertexAnimationSettings"),s.push("bakedVertexAnimationTextureSizeInverted"),s.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}},76608:function(e,t,i){i.d(t,{M:function(){return n}});var r=i(9719),s=i(4224);class n{constructor(e,t,i,r,s=!1){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||s,this._dynamic=i,this._name=r??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(e){let t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){let e=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;let i=this._uniformLocationPointer-e;for(let e=0;e<i;e++)this._data.push(0)}}addUniform(e,t,i=0){let r;if(!this._noUBO&&void 0===this._uniformLocations[e]){if(i>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},16==t)t*=i;else{let e=4-t;t=t*i+e*i}r=[];for(let e=0;e<t;e++)r.push(0)}else{if(t instanceof Array)t=(r=t).length;else{r=[];for(let e=0;e<t;e++)r.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let e=0;e<t;e++)this._data.push(r[e]);this._needSync=!0}}addMatrix(e,t){this.addUniform(e,Array.prototype.slice.call(t.asArray()))}addFloat2(e,t,i){this.addUniform(e,[t,i])}addFloat3(e,t,i,r){this.addUniform(e,[t,i,r])}addColor3(e,t){let i=[t.r,t.g,t.b];this.addUniform(e,i)}addColor4(e,t,i){let r=[t.r,t.g,t.b,i];this.addUniform(e,r)}addVector3(e,t){let i=[t.x,t.y,t.z];this.addUniform(e,i)}addMatrix3x3(e){this.addUniform(e,12)}addMatrix2x2(e){this.addUniform(e,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){let e=[],t=0;for(let i in this._uniformLocations)if(e.push(i),10==++t)break;return e.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(e,t){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}_copyBuffer(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}update(){if(!this._noUBO){if(this.bindUniformBuffer(),!this._buffer){this.create();return}if(!this._dynamic&&!this._needSync){this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1])){this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(n._UpdatedUbosInFrame[this._name]||(n._UpdatedUbosInFrame[this._name]=0),n._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(e,t,i){this._checkNewFrame();let s=this._uniformLocations[e];if(void 0===s){if(this._buffer){r.Y.Error("Cannot add an uniform after UBO has been created. uniformName="+e);return}this.addUniform(e,i),s=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(let e=0;e<i;e++)this._bufferData[s+e]=t[e];else{let e=!1;for(let r=0;r<i;r++)(16!==i||this._engine._features.uniformBufferHardCheckMatrix)&&this._bufferData[s+r]===Math.fround(t[r])||(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+r]=t[r]);this._needSync=this._needSync||e}}updateUniformArray(e,t,i){this._checkNewFrame();let n=this._uniformLocations[e];if(void 0===n){r.Y.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");return}this._buffer||this.create();let a=this._uniformArraySizes[e];if(this._dynamic)for(let e=0;e<i;e++)this._bufferData[n+e]=t[e];else{let e=!1,r=0,o=0;for(let h=0;h<i;h++)if(this._bufferData[n+4*o+r]!==s.w1.FloatRound(t[h])&&(e=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[n+4*o+r]=t[h]),++r===a.strideSize){for(;r<4;r++)this._bufferData[n+4*o+r]=0;r=0,o++}this._needSync=this._needSync||e}}_cacheMatrix(e,t){this._checkNewFrame();let i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)}_updateMatrix3x3ForUniform(e,t){for(let e=0;e<3;e++)n._TempBuffer[4*e]=t[3*e],n._TempBuffer[4*e+1]=t[3*e+1],n._TempBuffer[4*e+2]=t[3*e+2],n._TempBuffer[4*e+3]=0;this.updateUniform(e,n._TempBuffer,12)}_updateMatrix3x3ForEffect(e,t){this._currentEffect.setMatrix3x3(e,t)}_updateMatrix2x2ForEffect(e,t){this._currentEffect.setMatrix2x2(e,t)}_updateMatrix2x2ForUniform(e,t){for(let e=0;e<2;e++)n._TempBuffer[4*e]=t[2*e],n._TempBuffer[4*e+1]=t[2*e+1],n._TempBuffer[4*e+2]=0,n._TempBuffer[4*e+3]=0;this.updateUniform(e,n._TempBuffer,8)}_updateFloatForEffect(e,t){this._currentEffect.setFloat(e,t)}_updateFloatForUniform(e,t){n._TempBuffer[0]=t,this.updateUniform(e,n._TempBuffer,1)}_updateFloat2ForEffect(e,t,i,r=""){this._currentEffect.setFloat2(e+r,t,i)}_updateFloat2ForUniform(e,t,i){n._TempBuffer[0]=t,n._TempBuffer[1]=i,this.updateUniform(e,n._TempBuffer,2)}_updateFloat3ForEffect(e,t,i,r,s=""){this._currentEffect.setFloat3(e+s,t,i,r)}_updateFloat3ForUniform(e,t,i,r){n._TempBuffer[0]=t,n._TempBuffer[1]=i,n._TempBuffer[2]=r,this.updateUniform(e,n._TempBuffer,3)}_updateFloat4ForEffect(e,t,i,r,s,n=""){this._currentEffect.setFloat4(e+n,t,i,r,s)}_updateFloat4ForUniform(e,t,i,r,s){n._TempBuffer[0]=t,n._TempBuffer[1]=i,n._TempBuffer[2]=r,n._TempBuffer[3]=s,this.updateUniform(e,n._TempBuffer,4)}_updateFloatArrayForEffect(e,t){this._currentEffect.setFloatArray(e,t)}_updateFloatArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateArrayForEffect(e,t){this._currentEffect.setArray(e,t)}_updateArrayForUniform(e,t){this.updateUniformArray(e,t,t.length)}_updateIntArrayForEffect(e,t){this._currentEffect.setIntArray(e,t)}_updateIntArrayForUniform(e,t){n._TempBufferInt32View.set(t),this.updateUniformArray(e,n._TempBuffer,t.length)}_updateUIntArrayForEffect(e,t){this._currentEffect.setUIntArray(e,t)}_updateUIntArrayForUniform(e,t){n._TempBufferUInt32View.set(t),this.updateUniformArray(e,n._TempBuffer,t.length)}_updateMatrixForEffect(e,t){this._currentEffect.setMatrix(e,t)}_updateMatrixForUniform(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.asArray(),16)}_updateMatricesForEffect(e,t){this._currentEffect.setMatrices(e,t)}_updateMatricesForUniform(e,t){this.updateUniform(e,t,t.length)}_updateVector3ForEffect(e,t){this._currentEffect.setVector3(e,t)}_updateVector3ForUniform(e,t){n._TempBuffer[0]=t.x,n._TempBuffer[1]=t.y,n._TempBuffer[2]=t.z,this.updateUniform(e,n._TempBuffer,3)}_updateVector4ForEffect(e,t){this._currentEffect.setVector4(e,t)}_updateVector4ForUniform(e,t){n._TempBuffer[0]=t.x,n._TempBuffer[1]=t.y,n._TempBuffer[2]=t.z,n._TempBuffer[3]=t.w,this.updateUniform(e,n._TempBuffer,4)}_updateColor3ForEffect(e,t,i=""){this._currentEffect.setColor3(e+i,t)}_updateColor3ForUniform(e,t){n._TempBuffer[0]=t.r,n._TempBuffer[1]=t.g,n._TempBuffer[2]=t.b,this.updateUniform(e,n._TempBuffer,3)}_updateColor4ForEffect(e,t,i,r=""){this._currentEffect.setColor4(e+r,t,i)}_updateDirectColor4ForEffect(e,t,i=""){this._currentEffect.setDirectColor4(e+i,t)}_updateColor4ForUniform(e,t,i){n._TempBuffer[0]=t.r,n._TempBuffer[1]=t.g,n._TempBuffer[2]=t.b,n._TempBuffer[3]=i,this.updateUniform(e,n._TempBuffer,4)}_updateDirectColor4ForUniform(e,t){n._TempBuffer[0]=t.r,n._TempBuffer[1]=t.g,n._TempBuffer[2]=t.b,n._TempBuffer[3]=t.a,this.updateUniform(e,n._TempBuffer,4)}_updateIntForEffect(e,t,i=""){this._currentEffect.setInt(e+i,t)}_updateIntForUniform(e,t){n._TempBufferInt32View[0]=t,this.updateUniform(e,n._TempBuffer,1)}_updateInt2ForEffect(e,t,i,r=""){this._currentEffect.setInt2(e+r,t,i)}_updateInt2ForUniform(e,t,i){n._TempBufferInt32View[0]=t,n._TempBufferInt32View[1]=i,this.updateUniform(e,n._TempBuffer,2)}_updateInt3ForEffect(e,t,i,r,s=""){this._currentEffect.setInt3(e+s,t,i,r)}_updateInt3ForUniform(e,t,i,r){n._TempBufferInt32View[0]=t,n._TempBufferInt32View[1]=i,n._TempBufferInt32View[2]=r,this.updateUniform(e,n._TempBuffer,3)}_updateInt4ForEffect(e,t,i,r,s,n=""){this._currentEffect.setInt4(e+n,t,i,r,s)}_updateInt4ForUniform(e,t,i,r,s){n._TempBufferInt32View[0]=t,n._TempBufferInt32View[1]=i,n._TempBufferInt32View[2]=r,n._TempBufferInt32View[3]=s,this.updateUniform(e,n._TempBuffer,4)}_updateUIntForEffect(e,t,i=""){this._currentEffect.setUInt(e+i,t)}_updateUIntForUniform(e,t){n._TempBufferUInt32View[0]=t,this.updateUniform(e,n._TempBuffer,1)}_updateUInt2ForEffect(e,t,i,r=""){this._currentEffect.setUInt2(e+r,t,i)}_updateUInt2ForUniform(e,t,i){n._TempBufferUInt32View[0]=t,n._TempBufferUInt32View[1]=i,this.updateUniform(e,n._TempBuffer,2)}_updateUInt3ForEffect(e,t,i,r,s=""){this._currentEffect.setUInt3(e+s,t,i,r)}_updateUInt3ForUniform(e,t,i,r){n._TempBufferUInt32View[0]=t,n._TempBufferUInt32View[1]=i,n._TempBufferUInt32View[2]=r,this.updateUniform(e,n._TempBuffer,3)}_updateUInt4ForEffect(e,t,i,r,s,n=""){this._currentEffect.setUInt4(e+n,t,i,r,s)}_updateUInt4ForUniform(e,t,i,r,s){n._TempBufferUInt32View[0]=t,n._TempBufferUInt32View[1]=i,n._TempBufferUInt32View[2]=r,n._TempBufferUInt32View[3]=s,this.updateUniform(e,n._TempBuffer,4)}setTexture(e,t){this._currentEffect.setTexture(e,t)}setTextureArray(e,t){this._currentEffect.setTextureArray(e,t)}bindTexture(e,t){this._currentEffect._bindTexture(e,t)}updateUniformDirectly(e,t){this.updateUniform(e,t,t.length),this.update()}bindToEffect(e,t){this._currentEffect=e,this._currentEffectName=t}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(e){if(!this._buffers)return this._buffer===e;for(let t=0;t<this._buffers.length;++t)if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0;return!1}dispose(){if(this._noUBO)return;let e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let e=0;e<this._buffers.length;++e){let t=this._buffers[e][0];this._engine._releaseBuffer(t)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}n._UpdatedUbosInFrame={},n._MAX_UNIFORM_SIZE=256,n._TempBuffer=new Float32Array(n._MAX_UNIFORM_SIZE),n._TempBufferInt32View=new Int32Array(n._TempBuffer.buffer),n._TempBufferUInt32View=new Uint32Array(n._TempBuffer.buffer)},50154:function(e,t,i){i.d(t,{RD:function(){return h}});var r,s,n,a,o=i(39884);(r=n||(n={}))[r.LOCAL=0]="LOCAL",r[r.WORLD=1]="WORLD",r[r.BONE=2]="BONE";class h{}h.X=new o.P(1,0,0),h.Y=new o.P(0,1,0),h.Z=new o.P(0,0,1),(s=a||(a={}))[s.X=0]="X",s[s.Y=1]="Y",s[s.Z=2]="Z"},57449:function(e,t,i){i.d(t,{HE:function(){return _},Wo:function(){return c},zZ:function(){return d}});var r=i(178),s=i(7724),n=i(31644),a=i(65330);function o(e){return Math.pow(e,n.Nn)}function h(e){return e<=.04045?.0773993808*e:Math.pow(.947867299*(e+.055),2.4)}function l(e){return Math.pow(e,n.zp)}function u(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class c{constructor(e=0,t=0,i=0){this.r=e,this.g=t,this.b=i}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let e=255*this.r|0;return 397*(e=397*e^(255*this.g|0))^(255*this.b|0)}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this}fromArray(e,t=0){return c.FromArrayToRef(e,t,this),this}toColor4(e=1){return new _(this.r,this.g,this.b,e)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return .3*this.r+.59*this.g+.11*this.b}multiply(e){return new c(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyByFloats(e,t,i){return new c(this.r*e,this.g*t,this.b*i)}divide(e){throw ReferenceError("Can not divide a color")}divideToRef(e,t){throw ReferenceError("Can not divide a color")}divideInPlace(e){throw ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.minimizeInPlaceFromFloats(e.r,e.g,e.b)}maximizeInPlace(e){return this.maximizeInPlaceFromFloats(e.r,e.g,e.b)}minimizeInPlaceFromFloats(e,t,i){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this}maximizeInPlaceFromFloats(e,t,i){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this}floorToRef(e){throw ReferenceError("Can not floor a color")}floor(){throw ReferenceError("Can not floor a color")}fractToRef(e){throw ReferenceError("Can not fract a color")}fract(){throw ReferenceError("Can not fract a color")}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b}equalsFloats(e,t,i){return this.equalsToFloats(e,t,i)}equalsToFloats(e,t,i){return this.r===e&&this.g===t&&this.b===i}equalsWithEpsilon(e,t=n.kn){return(0,a.WithinEpsilon)(this.r,e.r,t)&&(0,a.WithinEpsilon)(this.g,e.g,t)&&(0,a.WithinEpsilon)(this.b,e.b,t)}negate(){throw ReferenceError("Can not negate a color")}negateInPlace(){throw ReferenceError("Can not negate a color")}negateToRef(e){throw ReferenceError("Can not negate a color")}scale(e){return new c(this.r*e,this.g*e,this.b*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t}clampToRef(e=0,t=1,i){return i.r=(0,a.Clamp)(this.r,e,t),i.g=(0,a.Clamp)(this.g,e,t),i.b=(0,a.Clamp)(this.b,e,t),i}add(e){return new c(this.r+e.r,this.g+e.g,this.b+e.b)}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addInPlaceFromFloats(e,t,i){return this.r+=e,this.g+=t,this.b+=i,this}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t}subtract(e){return new c(this.r-e.r,this.g-e.g,this.b-e.b)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this}subtractFromFloats(e,t,i){return new c(this.r-e,this.g-t,this.b-i)}subtractFromFloatsToRef(e,t,i,r){return r.r=this.r-e,r.g=this.g-t,r.b=this.b-i,r}clone(){return new c(this.r,this.g,this.b)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyFromFloats(e,t,i){return this.r=e,this.g=t,this.b=i,this}set(e,t,i){return this.copyFromFloats(e,t,i)}setAll(e){return this.r=this.g=this.b=e,this}toHexString(){let e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+(0,a.ToHex)(e)+(0,a.ToHex)(t)+(0,a.ToHex)(i)}fromHexString(e){return"#"!==e.substring(0,1)||7!==e.length||(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new c)}toHSVToRef(e){let t=this.r,i=this.g,r=this.b,s=Math.max(t,i,r),n=Math.min(t,i,r),a=0,o=0,h=s-n;return 0!==s&&(o=h/s),s!=n&&(s==t?(a=(i-r)/h,i<r&&(a+=6)):s==i?a=(r-t)/h+2:s==r&&(a=(t-i)/h+4),a*=60),e.r=a,e.g=o,e.b=s,e}toLinearSpace(e=!1){let t=new c;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=o(this.r),e.g=o(this.g),e.b=o(this.b)),this}toGammaSpace(e=!1){let t=new c;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=u(this.r),e.g=u(this.g),e.b=u(this.b)):(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)),this}static HSVtoRGBToRef(e,t,i,r){let s=i*t,n=e/60,a=s*(1-Math.abs(n%2-1)),o=0,h=0,l=0;n>=0&&n<=1?(o=s,h=a):n>=1&&n<=2?(o=a,h=s):n>=2&&n<=3?(h=s,l=a):n>=3&&n<=4?(h=a,l=s):n>=4&&n<=5?(o=a,l=s):n>=5&&n<=6&&(o=s,l=a);let u=i-s;return r.r=o+u,r.g=h+u,r.b=l+u,r}static FromHSV(e,t,i){let r=new c(0,0,0);return c.HSVtoRGBToRef(e,t,i,r),r}static FromHexString(e){return new c(0,0,0).fromHexString(e)}static FromArray(e,t=0){return new c(e[t],e[t+1],e[t+2])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2]}static FromInts(e,t,i){return new c(e/255,t/255,i/255)}static Lerp(e,t,i){let r=new c(0,0,0);return c.LerpToRef(e,t,i,r),r}static LerpToRef(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i}static Hermite(e,t,i,r,s){let n=s*s,a=s*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+s,u=a-n;return new c(e.r*o+i.r*h+t.r*l+r.r*u,e.g*o+i.g*h+t.g*l+r.g*u,e.b*o+i.b*h+t.b*l+r.b*u)}static Hermite1stDerivative(e,t,i,r,s){let n=c.Black();return this.Hermite1stDerivativeToRef(e,t,i,r,s,n),n}static Hermite1stDerivativeToRef(e,t,i,r,s,n){let a=s*s;n.r=(a-s)*6*e.r+(3*a-4*s+1)*t.r+(-a+s)*6*i.r+(3*a-2*s)*r.r,n.g=(a-s)*6*e.g+(3*a-4*s+1)*t.g+(-a+s)*6*i.g+(3*a-2*s)*r.g,n.b=(a-s)*6*e.b+(3*a-4*s+1)*t.b+(-a+s)*6*i.b+(3*a-2*s)*r.b}static Red(){return new c(1,0,0)}static Green(){return new c(0,1,0)}static Blue(){return new c(0,0,1)}static Black(){return new c(0,0,0)}static get BlackReadOnly(){return c._BlackReadOnly}static White(){return new c(1,1,1)}static Purple(){return new c(.5,0,.5)}static Magenta(){return new c(1,0,1)}static Yellow(){return new c(1,1,0)}static Gray(){return new c(.5,.5,.5)}static Teal(){return new c(0,1,1)}static Random(){return new c(Math.random(),Math.random(),Math.random())}}c._BlackReadOnly=c.Black(),Object.defineProperties(c.prototype,{dimension:{value:[3]},rank:{value:1}});class _{constructor(e=0,t=0,i=0,r=1){this.r=e,this.g=t,this.b=i,this.a=r}asArray(){return[this.r,this.g,this.b,this.a]}toArray(e,t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}equals(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}add(e){return new _(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}addToRef(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,t.a=this.a+e.a,t}addInPlace(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this}addInPlaceFromFloats(e,t,i,r){return this.r+=e,this.g+=t,this.b+=i,this.a+=r,this}subtract(e){return new _(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}subtractToRef(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,t}subtractInPlace(e){return this.r-=e.r,this.g-=e.g,this.b-=e.b,this.a-=e.a,this}subtractFromFloats(e,t,i,r){return new _(this.r-e,this.g-t,this.b-i,this.a-r)}subtractFromFloatsToRef(e,t,i,r,s){return s.r=this.r-e,s.g=this.g-t,s.b=this.b-i,s.a=this.a-r,s}scale(e){return new _(this.r*e,this.g*e,this.b*e,this.a*e)}scaleInPlace(e){return this.r*=e,this.g*=e,this.b*=e,this.a*=e,this}scaleToRef(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,t}scaleAndAddToRef(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,t}clampToRef(e=0,t=1,i){return i.r=(0,a.Clamp)(this.r,e,t),i.g=(0,a.Clamp)(this.g,e,t),i.b=(0,a.Clamp)(this.b,e,t),i.a=(0,a.Clamp)(this.a,e,t),i}multiply(e){return new _(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}multiplyToRef(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t}multiplyInPlace(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this.a*=e.a,this}multiplyByFloats(e,t,i,r){return new _(this.r*e,this.g*t,this.b*i,this.a*r)}divide(e){throw ReferenceError("Can not divide a color")}divideToRef(e,t){throw ReferenceError("Can not divide a color")}divideInPlace(e){throw ReferenceError("Can not divide a color")}minimizeInPlace(e){return this.r=Math.min(this.r,e.r),this.g=Math.min(this.g,e.g),this.b=Math.min(this.b,e.b),this.a=Math.min(this.a,e.a),this}maximizeInPlace(e){return this.r=Math.max(this.r,e.r),this.g=Math.max(this.g,e.g),this.b=Math.max(this.b,e.b),this.a=Math.max(this.a,e.a),this}minimizeInPlaceFromFloats(e,t,i,r){return this.r=Math.min(e,this.r),this.g=Math.min(t,this.g),this.b=Math.min(i,this.b),this.a=Math.min(r,this.a),this}maximizeInPlaceFromFloats(e,t,i,r){return this.r=Math.max(e,this.r),this.g=Math.max(t,this.g),this.b=Math.max(i,this.b),this.a=Math.max(r,this.a),this}floorToRef(e){throw ReferenceError("Can not floor a color")}floor(){throw ReferenceError("Can not floor a color")}fractToRef(e){throw ReferenceError("Can not fract a color")}fract(){throw ReferenceError("Can not fract a color")}negate(){throw ReferenceError("Can not negate a color")}negateInPlace(){throw ReferenceError("Can not negate a color")}negateToRef(e){throw ReferenceError("Can not negate a color")}equalsWithEpsilon(e,t=n.kn){return(0,a.WithinEpsilon)(this.r,e.r,t)&&(0,a.WithinEpsilon)(this.g,e.g,t)&&(0,a.WithinEpsilon)(this.b,e.b,t)&&(0,a.WithinEpsilon)(this.a,e.a,t)}equalsToFloats(e,t,i,r){return this.r===e&&this.g===t&&this.b===i&&this.a===r}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let e=255*this.r|0;return 397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)}clone(){return new _().copyFrom(this)}copyFrom(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}copyFromFloats(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this}set(e,t,i,r){return this.copyFromFloats(e,t,i,r)}setAll(e){return this.r=this.g=this.b=this.a=e,this}toHexString(e=!1){let t=Math.round(255*this.r),i=Math.round(255*this.g),r=Math.round(255*this.b);if(e)return"#"+(0,a.ToHex)(t)+(0,a.ToHex)(i)+(0,a.ToHex)(r);let s=Math.round(255*this.a);return"#"+(0,a.ToHex)(t)+(0,a.ToHex)(i)+(0,a.ToHex)(r)+(0,a.ToHex)(s)}fromHexString(e){return"#"!==e.substring(0,1)||9!==e.length&&7!==e.length||(this.r=parseInt(e.substring(1,3),16)/255,this.g=parseInt(e.substring(3,5),16)/255,this.b=parseInt(e.substring(5,7),16)/255,9===e.length&&(this.a=parseInt(e.substring(7,9),16)/255)),this}toLinearSpace(e=!1){let t=new _;return this.toLinearSpaceToRef(t,e),t}toLinearSpaceToRef(e,t=!1){return t?(e.r=h(this.r),e.g=h(this.g),e.b=h(this.b)):(e.r=o(this.r),e.g=o(this.g),e.b=o(this.b)),e.a=this.a,this}toGammaSpace(e=!1){let t=new _;return this.toGammaSpaceToRef(t,e),t}toGammaSpaceToRef(e,t=!1){return t?(e.r=u(this.r),e.g=u(this.g),e.b=u(this.b)):(e.r=l(this.r),e.g=l(this.g),e.b=l(this.b)),e.a=this.a,this}static FromHexString(e){return"#"!==e.substring(0,1)||9!==e.length&&7!==e.length?new _(0,0,0,0):new _(0,0,0,1).fromHexString(e)}static Lerp(e,t,i){return _.LerpToRef(e,t,i,new _)}static LerpToRef(e,t,i,r){return r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i,r}static Hermite(e,t,i,r,s){let n=s*s,a=s*n,o=2*a-3*n+1,h=-2*a+3*n,l=a-2*n+s,u=a-n,c=e.r*o+i.r*h+t.r*l+r.r*u;return new _(c,e.g*o+i.g*h+t.g*l+r.g*u,e.b*o+i.b*h+t.b*l+r.b*u,e.a*o+i.a*h+t.a*l+r.a*u)}static Hermite1stDerivative(e,t,i,r,s){let n=new _;return this.Hermite1stDerivativeToRef(e,t,i,r,s,n),n}static Hermite1stDerivativeToRef(e,t,i,r,s,n){let a=s*s;n.r=(a-s)*6*e.r+(3*a-4*s+1)*t.r+(-a+s)*6*i.r+(3*a-2*s)*r.r,n.g=(a-s)*6*e.g+(3*a-4*s+1)*t.g+(-a+s)*6*i.g+(3*a-2*s)*r.g,n.b=(a-s)*6*e.b+(3*a-4*s+1)*t.b+(-a+s)*6*i.b+(3*a-2*s)*r.b,n.a=(a-s)*6*e.a+(3*a-4*s+1)*t.a+(-a+s)*6*i.a+(3*a-2*s)*r.a}static FromColor3(e,t=1){return new _(e.r,e.g,e.b,t)}static FromArray(e,t=0){return new _(e[t],e[t+1],e[t+2],e[t+3])}static FromArrayToRef(e,t=0,i){i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]}static FromInts(e,t,i,r){return new _(e/255,t/255,i/255,r/255)}static CheckColors4(e,t){if(e.length===3*t){let t=[];for(let i=0;i<e.length;i+=3){let r=i/3*4;t[r]=e[i],t[r+1]=e[i+1],t[r+2]=e[i+2],t[r+3]=1}return t}return e}}Object.defineProperties(_.prototype,{dimension:{value:[4]},rank:{value:1}});class d{}d.Color3=(0,r.$G)(3,c.Black),d.Color4=(0,r.$G)(3,()=>new _(0,0,0,0)),(0,s.H7)("BABYLON.Color3",c),(0,s.H7)("BABYLON.Color4",_)},31644:function(e,t,i){i.d(t,{Nn:function(){return s},Q_:function(){return n},kn:function(){return a},zp:function(){return r}});let r=1/2.2,s=2.2,n=(1+Math.sqrt(5))/2,a=.001},75300:function(e,t,i){i.d(t,{i:function(){return s}});var r=i(47941);class s{static GetPlanes(e){let t=[];for(let e=0;e<6;e++)t.push(new r.J(0,0,0,0));return s.GetPlanesToRef(e,t),t}static GetNearPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()}static GetFarPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()}static GetLeftPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()}static GetRightPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()}static GetTopPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()}static GetBottomPlaneToRef(e,t){let i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()}static GetPlanesToRef(e,t){s.GetNearPlaneToRef(e,t[0]),s.GetFarPlaneToRef(e,t[1]),s.GetLeftPlaneToRef(e,t[2]),s.GetRightPlaneToRef(e,t[3]),s.GetTopPlaneToRef(e,t[4]),s.GetBottomPlaneToRef(e,t[5])}static IsPointInFrustum(e,t){for(let i=0;i<6;i++)if(0>t[i].dotCoordinate(e))return!1;return!0}}},59874:function(e,t,i){i.d(t,{k:function(){return h},y:function(){return o}});var r=i(46456),s=i(39884),n=i(22287);class a{static extractMinAndMaxIndexed(e,t,i,r,s,n){for(let a=i;a<i+r;a++){let i=3*t[a],r=e[i],o=e[i+1],h=e[i+2];s.minimizeInPlaceFromFloats(r,o,h),n.maximizeInPlaceFromFloats(r,o,h)}}static extractMinAndMax(e,t,i,r,s,n){for(let a=t,o=t*r;a<t+i;a++,o+=r){let t=e[o],i=e[o+1],r=e[o+2];s.minimizeInPlaceFromFloats(t,i,r),n.maximizeInPlaceFromFloats(t,i,r)}}}function o(e,t,i,r,n=null){let o=new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a.extractMinAndMaxIndexed(e,t,i,r,o,h),n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,h.x+=h.x*n.x+n.y,h.y+=h.y*n.x+n.y,h.z+=h.z*n.x+n.y),{minimum:o,maximum:h}}function h(e,t,i,r=null,n){let o=new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),a.extractMinAndMax(e,t,i,n,o,h),r&&(o.x-=o.x*r.x+r.y,o.y-=o.y*r.x+r.y,o.z-=o.z*r.x+r.y,h.x+=h.x*r.x+r.y,h.y+=h.y*r.x+r.y,h.z+=h.z*r.x+r.y),{minimum:o,maximum:h}}(0,r.gn)([n.G6.filter((...[e,t])=>!Array.isArray(e)&&!Array.isArray(t))],a,"extractMinAndMaxIndexed",null),(0,r.gn)([n.G6.filter((...[e])=>!Array.isArray(e))],a,"extractMinAndMax",null)},78875:function(e,t,i){i.d(t,{RD:function(){return r.RD},Wo:function(){return s.Wo},HE:function(){return s.HE},y3:function(){return n.y3},_f:function(){return n._f},zZ:function(){return s.zZ},jp:function(){return n.jp},FM:function(){return n.FM},P:function(){return n.P},Lt:function(){return n.Lt}});var r=i(50154),s=i(57449);i(31644),i(75300),i(83798),i(47941),i(33005);var n=i(39884);i(52721)},83798:function(e,t,i){i.d(t,{$B:function(){return _},ZZ:function(){return c},hr:function(){return h},j_:function(){return d}});var r,s,n=i(65330),a=i(39884),o=i(31644);(r=s||(s={}))[r.CW=0]="CW",r[r.CCW=1]="CCW";class h{static Interpolate(e,t,i,r,s){let n=1-3*r+3*t,a=3*r-6*t,o=3*t,h=e;for(let t=0;t<5;t++){let t=h*h,i=t*h*n+a*t+o*h,r=1/(3*n*t+2*a*h+o);h-=(i-e)*r,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*s+Math.pow(h,3)}}class l{constructor(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(e,t){let i=t.subtract(e);return new l(Math.atan2(i.y,i.x))}static BetweenTwoVectors(e,t){let i=e.lengthSquared()*t.lengthSquared();if(0===i)return new l(Math.PI/2);i=Math.sqrt(i);let r=e.dot(t)/i;return new l(Math.acos(r=(0,n.Clamp)(r,-1,1)))}static FromRadians(e){return new l(e)}static FromDegrees(e){return new l(e*Math.PI/180)}}class u{constructor(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;let r=Math.pow(t.x,2)+Math.pow(t.y,2),s=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,n=(r-Math.pow(i.x,2)-Math.pow(i.y,2))/2,o=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new a.FM((s*(t.y-i.y)-n*(e.y-t.y))/o,((e.x-t.x)*n-(t.x-i.x)*s)/o),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=l.BetweenTwoPoints(this.centerPoint,this.startPoint);let h=this.startAngle.degrees(),u=l.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=l.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),u-h<-180&&(u+=360),c-u>180&&(c-=360),c-u<-180&&(c+=360),this.orientation=u-h<0?0:1,this.angle=l.FromDegrees(0===this.orientation?h-c:c-h)}}class c{constructor(e,t){this._points=[],this._length=0,this.closed=!1,this._points.push(new a.FM(e,t))}addLineTo(e,t){if(this.closed)return this;let i=new a.FM(e,t),r=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(r).length(),this}addArcTo(e,t,i,r,s=36){if(this.closed)return this;let n=new u(this._points[this._points.length-1],new a.FM(e,t),new a.FM(i,r)),o=n.angle.radians()/s;0===n.orientation&&(o*=-1);let h=n.startAngle.radians()+o;for(let e=0;e<s;e++){let e=Math.cos(h)*n.radius+n.centerPoint.x,t=Math.sin(h)*n.radius+n.centerPoint.y;this.addLineTo(e,t),h+=o}return this}addQuadraticCurveTo(e,t,i,r,s=36){if(this.closed)return this;let n=(e,t,i,r)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r,a=this._points[this._points.length-1];for(let o=0;o<=s;o++){let h=o/s,l=n(h,a.x,e,i),u=n(h,a.y,t,r);this.addLineTo(l,u)}return this}addBezierCurveTo(e,t,i,r,s,n,a=36){if(this.closed)return this;let o=(e,t,i,r,s)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*s,h=this._points[this._points.length-1];for(let l=0;l<=a;l++){let u=l/a,c=o(u,h.x,e,i,s),_=o(u,h.y,t,r,n);this.addLineTo(c,_)}return this}isPointInside(e){let t=!1,i=this._points.length;for(let r=i-1,s=0;s<i;r=s++){let i=this._points[r],n=this._points[s],a=n.x-i.x,o=n.y-i.y;if(Math.abs(o)>Number.EPSILON){if(o<0&&(i=this._points[s],a=-a,n=this._points[r],o=-o),e.y<i.y||e.y>n.y)continue;if(e.y===i.y&&e.x===i.x)return!0;{let r=o*(e.x-i.x)-a*(e.y-i.y);if(0===r)return!0;if(r<0)continue;t=!t}}else{if(e.y!==i.y)continue;if(n.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=n.x)return!0}}return t}close(){return this.closed=!0,this}length(){let e=this._length;if(this.closed){let t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e}area(){let e=this._points.length,t=0;for(let i=e-1,r=0;r<e;i=r++)t+=this._points[i].x*this._points[r].y-this._points[r].x*this._points[i].y;return .5*t}getPoints(){return this._points}getPointAtLengthPosition(e){if(e<0||e>1)return a.FM.Zero();let t=e*this.length(),i=0;for(let e=0;e<this._points.length;e++){let r=(e+1)%this._points.length,s=this._points[e],n=this._points[r].subtract(s),o=n.length()+i;if(t>=i&&t<=o){let e=n.normalize(),r=t-i;return new a.FM(s.x+e.x*r,s.y+e.y*r)}i=o}return a.FM.Zero()}static StartingAt(e,t){return new c(e,t)}}class _{constructor(e,t=null,i,r=!1){this.path=e,this._curve=[],this._distances=[],this._tangents=[],this._normals=[],this._binormals=[],this._pointAtData={id:0,point:a.P.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:a.y3.Identity()};for(let t=0;t<e.length;t++)this._curve[t]=e[t].clone();this._raw=i||!1,this._alignTangentsWithPath=r,this._compute(t,r)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(e){return this._updatePointAtData(e).point}getTangentAt(e,t=!1){return this._updatePointAtData(e,t),t?a.P.TransformCoordinates(a.P.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(e,t=!1){return this._updatePointAtData(e,t),t?a.P.TransformCoordinates(a.P.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(e,t=!1){return this._updatePointAtData(e,t),t?a.P.TransformCoordinates(a.P.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(e){return this.length()*e}getPreviousPointIndexAt(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex}getSubPositionAt(e){return this._updatePointAtData(e),this._pointAtData.subPosition}getClosestPositionTo(e){let t=Number.MAX_VALUE,i=0;for(let r=0;r<this._curve.length-1;r++){let s=this._curve[r+0],n=this._curve[r+1].subtract(s).normalize(),o=this._distances[r+1]-this._distances[r+0],h=Math.min(Math.max(a.P.Dot(n,e.subtract(s).normalize()),0)*a.P.Distance(s,e)/o,1),l=a.P.Distance(s.add(n.scale(h*o)),e);l<t&&(t=l,i=(this._distances[r+0]+o*h)/this.length())}return i}slice(e=0,t=1){if(e<0&&(e=1- -1*e%1),t<0&&(t=1- -1*t%1),e>t){let i=e;e=t,t=i}let i=this.getCurve(),r=this.getPointAt(e),s=this.getPreviousPointIndexAt(e),n=this.getPointAt(t),a=this.getPreviousPointIndexAt(t)+1,o=[];return 0!==e&&(s++,o.push(r)),o.push(...i.slice(s,a)),(1!==t||1===e)&&o.push(n),new _(o,this.getNormalAt(e),this._raw,this._alignTangentsWithPath)}update(e,t=null,i=!1){for(let t=0;t<e.length;t++)this._curve[t].x=e[t].x,this._curve[t].y=e[t].y,this._curve[t].z=e[t].z;return this._compute(t,i),this}_compute(e,t=!1){let i,r,s,n,o;let h=this._curve.length;if(h<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[h-1]=this._curve[h-1].subtract(this._curve[h-2]),this._raw||this._tangents[h-1].normalize();let l=this._tangents[0],u=this._normalVector(l,e);this._normals[0]=u,this._raw||this._normals[0].normalize(),this._binormals[0]=a.P.Cross(l,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let e=1;e<h;e++)i=this._getLastNonNullVector(e),e<h-1&&(r=this._getFirstNonNullVector(e),this._tangents[e]=t?r:i.add(r),this._tangents[e].normalize()),this._distances[e]=this._distances[e-1]+this._curve[e].subtract(this._curve[e-1]).length(),s=this._tangents[e],o=this._binormals[e-1],this._normals[e]=a.P.Cross(o,s),this._raw||(0===this._normals[e].length()?(n=this._normals[e-1],this._normals[e]=n.clone()):this._normals[e].normalize()),this._binormals[e]=a.P.Cross(s,this._normals[e]),this._raw||this._binormals[e].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(e){let t=1,i=this._curve[e+t].subtract(this._curve[e]);for(;0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i}_getLastNonNullVector(e){let t=1,i=this._curve[e].subtract(this._curve[e-t]);for(;0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i}_normalVector(e,t){let i;let r=e.length();if(0===r&&(r=1),null==t){let t;t=(0,n.WithinEpsilon)(Math.abs(e.y)/r,1,o.kn)?(0,n.WithinEpsilon)(Math.abs(e.x)/r,1,o.kn)?(0,n.WithinEpsilon)(Math.abs(e.z)/r,1,o.kn)?a.P.Zero():new a.P(0,0,1):new a.P(1,0,0):new a.P(0,-1,0),i=a.P.Cross(e,t)}else i=a.P.Cross(e,t),a.P.CrossToRef(i,e,i);return i.normalize(),i}_updatePointAtData(e,t=!1){let i;if(this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;let r=this.getPoints();if(e<=0)return this._setPointAtData(0,0,r[0],0,t);if(e>=1)return this._setPointAtData(1,1,r[r.length-1],r.length-1,t);let s=r[0],n=0,o=e*this.length();for(let h=1;h<r.length;h++){i=r[h];let l=a.P.Distance(s,i);if((n+=l)===o)return this._setPointAtData(e,1,i,h,t);if(n>o){let r=(n-o)/l,a=s.subtract(i),u=i.add(a.scaleInPlace(r));return this._setPointAtData(e,1-r,u,h-1,t)}s=i}return this._pointAtData}_setPointAtData(e,t,i,r,s){return this._pointAtData.point=i,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=r,this._pointAtData.interpolateReady=s,s&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=a.y3.Identity();let e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){let t=e+1,i=this._tangents[e].clone(),r=this._normals[e].clone(),s=this._binormals[e].clone(),n=this._tangents[t].clone(),o=this._normals[t].clone(),h=this._binormals[t].clone(),l=a._f.RotationQuaternionFromAxis(r,s,i),u=a._f.RotationQuaternionFromAxis(o,h,n);a._f.Slerp(l,u,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class d{static CreateQuadraticBezier(e,t,i,r){r=r>2?r:3;let s=[],n=(e,t,i,r)=>(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;for(let o=0;o<=r;o++)s.push(new a.P(n(o/r,e.x,t.x,i.x),n(o/r,e.y,t.y,i.y),n(o/r,e.z,t.z,i.z)));return new d(s)}static CreateCubicBezier(e,t,i,r,s){s=s>3?s:4;let n=[],o=(e,t,i,r,s)=>(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*s;for(let h=0;h<=s;h++)n.push(new a.P(o(h/s,e.x,t.x,i.x,r.x),o(h/s,e.y,t.y,i.y,r.y),o(h/s,e.z,t.z,i.z,r.z)));return new d(n)}static CreateHermiteSpline(e,t,i,r,s){let n=[],o=1/s;for(let h=0;h<=s;h++)n.push(a.P.Hermite(e,t,i,r,h*o));return new d(n)}static CreateCatmullRomSpline(e,t,i){let r=[],s=1/t,n=0;if(i){let i=e.length;for(let o=0;o<i;o++){n=0;for(let h=0;h<t;h++)r.push(a.P.CatmullRom(e[o%i],e[(o+1)%i],e[(o+2)%i],e[(o+3)%i],n)),n+=s}r.push(r[0])}else{let i=[];i.push(e[0].clone()),Array.prototype.push.apply(i,e),i.push(e[e.length-1].clone());let o=0;for(;o<i.length-3;o++){n=0;for(let e=0;e<t;e++)r.push(a.P.CatmullRom(i[o],i[o+1],i[o+2],i[o+3],n)),n+=s}o--,r.push(a.P.CatmullRom(i[o],i[o+1],i[o+2],i[o+3],n))}return new d(r)}static ArcThru3Points(e,t,i,r=32,s=!1,n=!1){let o=[],h=t.subtract(e),l=i.subtract(t),u=e.subtract(i),c=a.P.Cross(h,l),_=c.length();if(_<1e-8)return new d(o);let p=h.lengthSquared(),f=l.lengthSquared(),g=u.lengthSquared(),m=c.lengthSquared(),T=.5*h.length()*l.length()*u.length()/_,E=a.P.Dot(h,u),b=a.P.Dot(h,l),R=a.P.Dot(l,u),C=e.scale(-.5*f*E/m).add(t.scale(-.5*g*b/m)).add(i.scale(-.5*p*R/m)),P=e.subtract(C).normalize(),x=a.P.Cross(c,P).normalize();if(n){let t=2*Math.PI/r;for(let e=0;e<=2*Math.PI;e+=t)o.push(C.add(P.scale(T*Math.cos(e)).add(x.scale(T*Math.sin(e)))));o.push(e)}else{let t=1/r,n=0,h=a.P.Zero();do h=C.add(P.scale(T*Math.cos(n)).add(x.scale(T*Math.sin(n)))),o.push(h),n+=t;while(!h.equalsWithEpsilon(i,T*t*1.1));o.push(i),s&&o.push(e)}return new d(o)}constructor(e){this._length=0,this._points=e,this._length=this._computeLength(e)}getPoints(){return this._points}length(){return this._length}continue(e){let t=this._points[this._points.length-1],i=this._points.slice(),r=e.getPoints();for(let e=1;e<r.length;e++)i.push(r[e].subtract(r[0]).add(t));return new d(i)}_computeLength(e){let t=0;for(let i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t}}},47941:function(e,t,i){i.d(t,{J:function(){return s}});var r=i(39884);class s{constructor(e,t,i,s){this.normal=new r.P(e,t,i),this.d=s}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new s(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){return 397*this.normal.getHashCode()^(0|this.d)}normalize(){let e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this}transform(e){let t=s._TmpMatrix;e.invertToRef(t);let i=t.m,r=this.normal.x,n=this.normal.y,a=this.normal.z,o=this.d,h=r*i[0]+n*i[1]+a*i[2]+o*i[3];return new s(h,r*i[4]+n*i[5]+a*i[6]+o*i[7],r*i[8]+n*i[9]+a*i[10]+o*i[11],r*i[12]+n*i[13]+a*i[14]+o*i[15])}dotCoordinate(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d}copyFromPoints(e,t,i){let r;let s=t.x-e.x,n=t.y-e.y,a=t.z-e.z,o=i.x-e.x,h=i.y-e.y,l=i.z-e.z,u=n*l-a*h,c=a*o-s*l,_=s*h-n*o,d=Math.sqrt(u*u+c*c+_*_);return r=0!==d?1/d:0,this.normal.x=u*r,this.normal.y=c*r,this.normal.z=_*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this}isFrontFacingTo(e,t){return r.P.Dot(this.normal,e)<=t}signedDistanceTo(e){return r.P.Dot(e,this.normal)+this.d}static FromArray(e){return new s(e[0],e[1],e[2],e[3])}static FromPoints(e,t,i){let r=new s(0,0,0,0);return r.copyFromPoints(e,t,i),r}static FromPositionAndNormal(e,t){let i=new s(0,0,0,0);return this.FromPositionAndNormalToRef(e,t,i)}static FromPositionAndNormalToRef(e,t,i){return i.normal.copyFrom(t),i.normal.normalize(),i.d=-e.dot(i.normal),i}static SignedDistanceToPlaneFromPositionAndNormal(e,t,i){let s=-(t.x*e.x+t.y*e.y+t.z*e.z);return r.P.Dot(i,t)+s}}s._TmpMatrix=r.y3.Identity()},65330:function(e,t,i){function r(e){return parseInt(e.toString().replace(/\W/g,""))}function s(e,t,i=1401298e-51){return Math.abs(e-t)<=i}function n(e,t){return e===t?e:Math.random()*(t-e)+e}function a(e,t,i){return e+(t-e)*i}function o(e,t,i){let r=f(t-e,360);return r>180&&(r-=360),e+r*c(i)}function h(e,t,i){return e!=t?c((i-e)/(t-e)):0}function l(e,t,i,r,s){let n=s*s,a=s*n;return e*(2*a-3*n+1)+i*(-2*a+3*n)+t*(a-2*n+s)+r*(a-n)}function u(e,t,i,r,s){let n=s*s;return(n-s)*6*e+(3*n-4*s+1)*t+(-n+s)*6*i+(3*n-2*s)*r}function c(e,t=0,i=1){return Math.min(i,Math.max(t,e))}function _(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function d(e){let t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}function p(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}function f(e,t){return e-Math.floor(e/t)*t}function g(e,t,i){return(e-t)/(i-t)}function m(e,t,i){return e*(i-t)+t}function T(e,t){let i=f(t-e,360);return i>180&&(i-=360),i}function E(e,t){let i=f(e,2*t);return t-Math.abs(i-t)}function b(e,t,i){let r=c(i);return t*(r=-2*r*r*r+3*r*r)+e*(1-r)}function R(e,t,i){return Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i}function C(e,t,i){let r=T(e,t),s=0;return-i<r&&r<i?s=t:(t=e+r,s=R(e,t,i)),s}function P(e,t,i){return(e-t)/(i-t)}function x(e,t,i){return(i-t)*e+t}i.r(t),i.d(t,{Clamp:function(){return c},DeltaAngle:function(){return T},Denormalize:function(){return m},ExtractAsInt:function(){return r},Hermite:function(){return l},Hermite1stDerivative:function(){return u},HighestCommonFactor:function(){return function e(t,i){let r=t%i;return 0===r?i:e(i,r)}},ILog2:function(){return p},InverseLerp:function(){return h},Lerp:function(){return a},LerpAngle:function(){return o},MoveTowards:function(){return R},MoveTowardsAngle:function(){return C},Normalize:function(){return g},NormalizeRadians:function(){return _},PercentToRange:function(){return x},PingPong:function(){return E},RandomRange:function(){return n},RangeToPercent:function(){return P},Repeat:function(){return f},SmoothStep:function(){return b},ToHex:function(){return d},WithinEpsilon:function(){return s}})},33005:function(e,t,i){i.d(t,{$:function(){return r}});class r{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){return 397*(0|this.width)^(0|this.height)}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new r(this.width*e,this.height*t)}clone(){return new r(this.width,this.height)}equals(e){return!!e&&this.width===e.width&&this.height===e.height}get surface(){return this.width*this.height}static Zero(){return new r(0,0)}add(e){return new r(this.width+e.width,this.height+e.height)}subtract(e){return new r(this.width-e.width,this.height-e.height)}scale(e){return new r(this.width*e,this.height*e)}static Lerp(e,t,i){return new r(e.width+(t.width-e.width)*i,e.height+(t.height-e.height)*i)}}},52721:function(e,t,i){i.d(t,{l:function(){return r}});class r{constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}toGlobal(e,t){return new r(this.x*e,this.y*t,this.width*e,this.height*t)}toGlobalToRef(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this}clone(){return new r(this.x,this.y,this.width,this.height)}}},8937:function(e,t,i){i.d(t,{_:function(){return l},i:function(){return u}});var r=i(39884),s=i(78875);let n=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],a=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],o=(e,t)=>n[e]*a[e](t),h=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class l{constructor(){this.preScaled=!1,this.l00=r.P.Zero(),this.l1_1=r.P.Zero(),this.l10=r.P.Zero(),this.l11=r.P.Zero(),this.l2_2=r.P.Zero(),this.l2_1=r.P.Zero(),this.l20=r.P.Zero(),this.l21=r.P.Zero(),this.l22=r.P.Zero()}addLight(e,t,i){s.jp.Vector3[0].set(t.r,t.g,t.b);let r=s.jp.Vector3[0],n=s.jp.Vector3[1];r.scaleToRef(i,n),n.scaleToRef(o(0,e),s.jp.Vector3[2]),this.l00.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(1,e),s.jp.Vector3[2]),this.l1_1.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(2,e),s.jp.Vector3[2]),this.l10.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(3,e),s.jp.Vector3[2]),this.l11.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(4,e),s.jp.Vector3[2]),this.l2_2.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(5,e),s.jp.Vector3[2]),this.l2_1.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(6,e),s.jp.Vector3[2]),this.l20.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(7,e),s.jp.Vector3[2]),this.l21.addInPlace(s.jp.Vector3[2]),n.scaleToRef(o(8,e),s.jp.Vector3[2]),this.l22.addInPlace(s.jp.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(h[0]),this.l1_1.scaleInPlace(h[1]),this.l10.scaleInPlace(h[2]),this.l11.scaleInPlace(h[3]),this.l2_2.scaleInPlace(h[4]),this.l2_1.scaleInPlace(h[5]),this.l20.scaleInPlace(h[6]),this.l21.scaleInPlace(h[7]),this.l22.scaleInPlace(h[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(n[0]),this.l1_1.scaleInPlace(n[1]),this.l10.scaleInPlace(n[2]),this.l11.scaleInPlace(n[3]),this.l2_2.scaleInPlace(n[4]),this.l2_1.scaleInPlace(n[5]),this.l20.scaleInPlace(n[6]),this.l21.scaleInPlace(n[7]),this.l22.scaleInPlace(n[8])}updateFromArray(e){return r.P.FromArrayToRef(e[0],0,this.l00),r.P.FromArrayToRef(e[1],0,this.l1_1),r.P.FromArrayToRef(e[2],0,this.l10),r.P.FromArrayToRef(e[3],0,this.l11),r.P.FromArrayToRef(e[4],0,this.l2_2),r.P.FromArrayToRef(e[5],0,this.l2_1),r.P.FromArrayToRef(e[6],0,this.l20),r.P.FromArrayToRef(e[7],0,this.l21),r.P.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return r.P.FromFloatsToRef(e[0],e[1],e[2],this.l00),r.P.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),r.P.FromFloatsToRef(e[6],e[7],e[8],this.l10),r.P.FromFloatsToRef(e[9],e[10],e[11],this.l11),r.P.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),r.P.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),r.P.FromFloatsToRef(e[18],e[19],e[20],this.l20),r.P.FromFloatsToRef(e[21],e[22],e[23],this.l21),r.P.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}static FromArray(e){return new l().updateFromArray(e)}static FromPolynomial(e){let t=new l;return t.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),t.l1_1=e.y.scale(.977204),t.l10=e.z.scale(.977204),t.l11=e.x.scale(.977204),t.l2_2=e.xy.scale(1.16538),t.l2_1=e.yz.scale(1.16538),t.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),t.l21=e.zx.scale(1.16538),t.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class u{constructor(){this.x=r.P.Zero(),this.y=r.P.Zero(),this.z=r.P.Zero(),this.xx=r.P.Zero(),this.yy=r.P.Zero(),this.zz=r.P.Zero(),this.xy=r.P.Zero(),this.yz=r.P.Zero(),this.zx=r.P.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=l.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){s.jp.Vector3[0].copyFromFloats(e.r,e.g,e.b);let t=s.jp.Vector3[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),s.jp.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),s.jp.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(s.jp.Vector3[0]).addInPlace(s.jp.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(s.jp.Vector3[0]).subtractInPlace(s.jp.Vector3[1]),this.zz.copyFrom(e.l00),s.jp.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(s.jp.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return new u().updateFromHarmonics(e)}static FromArray(e){let t=new u;return r.P.FromArrayToRef(e[0],0,t.x),r.P.FromArrayToRef(e[1],0,t.y),r.P.FromArrayToRef(e[2],0,t.z),r.P.FromArrayToRef(e[3],0,t.xx),r.P.FromArrayToRef(e[4],0,t.yy),r.P.FromArrayToRef(e[5],0,t.zz),r.P.FromArrayToRef(e[6],0,t.yz),r.P.FromArrayToRef(e[7],0,t.zx),r.P.FromArrayToRef(e[8],0,t.xy),t}}},72563:function(e,t,i){i.d(t,{M:function(){return s}});var r=i(17909);class s extends r.h{constructor(e){super(),this._buffer=e}get underlyingResource(){return this._buffer}}},34066:function(e,t,i){i.d(t,{P:function(){return h}});var r=i(93954),s=i(13306),n=i(29892),a=i(59874),o=i(83260);class h{get materialDefines(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new o.q(this._mesh.getScene().getEngine())),i}_removeDrawWrapper(e,t=!0){t&&this._drawWrappers[e]?.dispose(),this._drawWrappers[e]=void 0}get effect(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e,t=null,i,r=!0){let s=this._drawWrapper;s.setEffect(e,t,r),void 0!==i&&(s.materialContext=i),e||(s.defines=null,s.materialContext=void 0)}resetDrawCache(e){if(this._drawWrappers){if(void 0!==e){this._removeDrawWrapper(e);return}for(let e of this._drawWrappers)e?.dispose()}this._drawWrappers=[]}static AddToMesh(e,t,i,r,s,n,a,o=!0){return new h(e,t,i,r,s,n,a,o)}constructor(e,t,i,r,s,n,a,o=!0,h=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=r,this.indexCount=s,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=n,this._renderingMesh=a||n,h&&n.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=n.subMeshes.length-1,o&&(this.refreshBoundingInfo(),n.computeWorldMatrix(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){return(this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null)||this._renderingMesh}getMaterial(e=!0){let t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(t)){let e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return t}_isMultiMaterial(e){return void 0!==e.getSubMaterial}refreshBoundingInfo(e=null){let t;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(r.o.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;let i=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===i.length){let e=this._renderingMesh.getBoundingInfo();t={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else t=(0,a.y)(e,i,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new n.j(t.minimum,t.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){let t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)}isCompletelyInFrustum(e){let t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){let i=[];for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)i.push(e[t],e[t+1],e[t+1],e[t+2],e[t+2],e[t]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer}canIntersects(e){let t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)}intersects(e,t,i,r,s){let n=this.getMaterial();if(!n)return null;let a=3,o=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,o=!0}return 4===n.fillMode?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,r):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,r,s):this._intersectTriangles(e,t,i,a,o,r,s)}_intersectLines(e,t,i,r,n){let a=null;for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){let h=t[i[o]],l=t[i[o+1]],u=e.intersectionSegment(h,l,r);if(!(u<0)&&(n||!a||u<a.distance)&&((a=new s.c(null,null,u)).faceId=o/2,n))break}return a}_intersectUnIndexedLines(e,t,i,r,n){let a=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=2){let o=t[i],h=t[i+1],l=e.intersectionSegment(o,h,r);if(!(l<0)&&(n||!a||l<a.distance)&&((a=new s.c(null,null,l)).faceId=i/2,n))break}return a}_intersectTriangles(e,t,i,r,s,n,a){let o=null,h=-1;for(let l=this.indexStart;l<this.indexStart+this.indexCount-(3-r);l+=r){h++;let r=i[l],u=i[l+1],c=i[l+2];if(s&&4294967295===c){l+=2;continue}let _=t[r],d=t[u],p=t[c];if(!_||!d||!p||a&&!a(_,d,p,e,r,u,c))continue;let f=e.intersectsTriangle(_,d,p);if(f){if(f.distance<0)continue;if((n||!o||f.distance<o.distance)&&((o=f).faceId=h,n))break}}return o}_intersectUnIndexedTriangles(e,t,i,r,s){let n=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){let a=t[i],o=t[i+1],h=t[i+2];if(s&&!s(a,o,h,e,-1,-1,-1))continue;let l=e.intersectsTriangle(a,o,h);if(l){if(l.distance<0)continue;if((r||!n||l.distance<n.distance)&&((n=l).faceId=i/3,r))break}}return n}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){let i=new h(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){let e=this.getBoundingInfo();if(!e)return i;i._boundingInfo=new n.j(e.minimum,e.maximum)}return i}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);let e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,i,r,s,n=!0){let a=Number.MAX_VALUE,o=-Number.MAX_VALUE,l=(s||r).getIndices();for(let e=t;e<t+i;e++){let t=l[e];t<a&&(a=t),t>o&&(o=t)}return new h(e,a,o-a+1,t,i,r,s,n)}}},94480:function(e,t,i){i.d(t,{$:function(){return l}});var r=i(39884),s=i(65330),n=i(8937),a=i(31644),o=i(57449);class h{constructor(e,t,i,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=r}}class l{static ConvertCubeMapTextureToSphericalPolynomial(e){let t,i;if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();let r=e.getSize().width,s=e.readPixels(0,void 0,void 0,!1),n=e.readPixels(1,void 0,void 0,!1);e.isRenderTarget?(t=e.readPixels(3,void 0,void 0,!1),i=e.readPixels(2,void 0,void 0,!1)):(t=e.readPixels(2,void 0,void 0,!1),i=e.readPixels(3,void 0,void 0,!1));let a=e.readPixels(4,void 0,void 0,!1),o=e.readPixels(5,void 0,void 0,!1),h=e.gammaSpace,l=0;return(1==e.textureType||2==e.textureType)&&(l=1),new Promise(e=>{Promise.all([n,s,t,i,a,o]).then(([t,i,s,n,a,o])=>{let u={size:r,right:i,left:t,up:s,down:n,front:a,back:o,format:5,type:l,gammaSpace:h};e(this.ConvertCubeMapToSphericalPolynomial(u))})})}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){let t=new n._,i=0,r=2/e.size,h=.5*r,l=h-1;for(let n=0;n<6;n++){let u=this._FileFaces[n],c=e[u.name],_=l,d=5===e.format?4:3;for(let n=0;n<e.size;n++){let p=l;for(let l=0;l<e.size;l++){let f=u.worldAxisForFileX.scale(p).add(u.worldAxisForFileY.scale(_)).add(u.worldAxisForNormal);f.normalize();let g=this._AreaElement(p-h,_-h)-this._AreaElement(p-h,_+h)-this._AreaElement(p+h,_-h)+this._AreaElement(p+h,_+h),m=c[n*e.size*d+l*d+0],T=c[n*e.size*d+l*d+1],E=c[n*e.size*d+l*d+2];isNaN(m)&&(m=0),isNaN(T)&&(T=0),isNaN(E)&&(E=0),0===e.type&&(m/=255,T/=255,E/=255),e.gammaSpace&&(m=Math.pow((0,s.Clamp)(m),a.Nn),T=Math.pow((0,s.Clamp)(T),a.Nn),E=Math.pow((0,s.Clamp)(E),a.Nn));let b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){let e=Math.max(m,T,E);if(e>b){let t=b/e;m*=t,T*=t,E*=t}}else m=(0,s.Clamp)(m,0,b),T=(0,s.Clamp)(T,0,b),E=(0,s.Clamp)(E,0,b);let R=new o.Wo(m,T,E);t.addLight(f,R,g),i+=g,p+=r}_+=r}}let u=4*Math.PI*6/6/i;return t.scaleInPlace(u),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),n.i.FromHarmonics(t)}}l._FileFaces=[new h("right",new r.P(1,0,0),new r.P(0,0,-1),new r.P(0,-1,0)),new h("left",new r.P(-1,0,0),new r.P(0,0,1),new r.P(0,-1,0)),new h("up",new r.P(0,1,0),new r.P(1,0,0),new r.P(0,0,1)),new h("down",new r.P(0,-1,0),new r.P(1,0,0),new r.P(0,0,-1)),new h("front",new r.P(0,0,1),new r.P(1,0,0),new r.P(0,-1,0)),new h("back",new r.P(0,0,-1),new r.P(-1,0,0),new r.P(0,-1,0))],l.MAX_HDRI_VALUE=4096,l.PRESERVE_CLAMPED_COLORS=!1},39360:function(e,t,i){i.d(t,{q:function(){return r}});class r{static Eval(e,t){return"true"===(e=e.match(/\([^()]*\)/g)?e.replace(/\([^()]*\)/g,e=>(e=e.slice(1,e.length-1),r._HandleParenthesisContent(e,t))):r._HandleParenthesisContent(e,t))||"false"!==e&&r.Eval(e,t)}static _HandleParenthesisContent(e,t){let i;t=t||(e=>"true"===e);let s=e.split("||");for(let e in s)if(Object.prototype.hasOwnProperty.call(s,e)){let n=r._SimplifyNegation(s[e].trim()),a=n.split("&&");if(a.length>1)for(let e=0;e<a.length;++e){let s=r._SimplifyNegation(a[e].trim());if(!(i="true"!==s&&"false"!==s?"!"===s[0]?!t(s.substring(1)):t(s):"true"===s)){n="false";break}}if(i||"true"===n){i=!0;break}i="true"!==n&&"false"!==n?"!"===n[0]?!t(n.substring(1)):t(n):"true"===n}return i?"true":"false"}static _SimplifyNegation(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,e=>(e=e.replace(/[\s]/g,()=>"")).length%2?"!":"")).trim())?e="false":"!false"===e&&(e="true"),e}}},178:function(e,t,i){function r(e,t){let i=[];for(let r=0;r<e;++r)i.push(t());return i}function s(e,t){return r(e,t)}i.d(t,{$G:function(){return r},Mf:function(){return a},rP:function(){return s}});let n=["push","splice","pop","shift","unshift"];function a(e,t){let i=n.map(i=>(function(e,t,i){let r=e[t];if("function"!=typeof r)return null;let s=function(){let r=e.length,n=s.previous.apply(e,arguments);return i(t,r),n};return r.next=s,s.previous=r,e[t]=s,()=>{let i=s.previous;if(!i)return;let r=s.next;r?(i.next=r,r.previous=i):(i.next=void 0,e[t]=i),s.next=void 0,s.previous=void 0}})(e,i,t));return()=>{i.forEach(e=>{e?.()})}}},46254:function(e,t,i){function r(e,t,i=!1){let r=t.width,s=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT,i=new Uint8Array(t);for(;--t>=0;){let r=e[t];r<0?r=0:r>1&&(r=1),i[t]=255*r}e=i}let n=document.createElement("canvas");n.width=r,n.height=s;let a=n.getContext("2d");if(!a)return null;let o=a.createImageData(r,s);if(o.data.set(e),a.putImageData(o,0,0),i){let e=document.createElement("canvas");e.width=r,e.height=s;let t=e.getContext("2d");return t?(t.translate(0,s),t.scale(1,-1),t.drawImage(n,0,0),e.toDataURL("image/png")):null}return n.toDataURL("image/png")}function s(e,t=0,i=0){let s=e.getInternalTexture();if(!s)return null;let n=e._readPixelsSync(t,i);return n?r(n,e.getSize(),s.invertY):null}async function n(e,t=0,i=0){let s=e.getInternalTexture();if(!s)return null;let n=await e.readPixels(t,i);return n?r(n,e.getSize(),s.invertY):null}i.d(t,{Jj:function(){return n},_u:function(){return s}})},90580:function(e,t,i){i.d(t,{N:function(){return _}});var r=i(65330),s=i(9719),n=i(94480),a=i(15096);function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}i(34995);let h=o("DXT1"),l=o("DXT3"),u=o("DXT5"),c=o("DX10");class _{static GetDDSInfo(e){let t=new Int32Array(e.buffer,e.byteOffset,31),i=new Int32Array(e.buffer,e.byteOffset,35),r=1;131072&t[2]&&(r=Math.max(1,t[7]));let s=t[21],n=s===c?i[32]:0,a=0;switch(s){case 113:a=2;break;case 116:a=1;break;case c:if(10===n){a=2;break}2===n&&(a=1)}return{width:t[4],height:t[3],mipmapCount:r,isFourCC:(4&t[20])==4,isRGB:(64&t[20])==64,isLuminance:(131072&t[20])==131072,isCube:(512&t[28])==512,isCompressed:s===h||s===l||s===u,dxgiFormat:n,textureType:a}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,i,r,s,n){let o=new Float32Array(r),h=new Uint16Array(s,i),l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r=(t+i*e)*4;o[l]=(0,a.qZ)(h[r]),o[l+1]=(0,a.qZ)(h[r+1]),o[l+2]=(0,a.qZ)(h[r+2]),_.StoreLODInAlphaChannel?o[l+3]=n:o[l+3]=(0,a.qZ)(h[r+3]),l+=4}return o}static _GetHalfFloatRGBAArrayBuffer(e,t,i,r,s,n){if(_.StoreLODInAlphaChannel){let o=new Uint16Array(r),h=new Uint16Array(s,i),l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r=(t+i*e)*4;o[l]=h[r],o[l+1]=h[r+1],o[l+2]=h[r+2],o[l+3]=(0,a.ay)(n),l+=4}return o}return new Uint16Array(s,i,r)}static _GetFloatRGBAArrayBuffer(e,t,i,r,s,n){if(_.StoreLODInAlphaChannel){let a=new Float32Array(r),o=new Float32Array(s,i),h=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r=(t+i*e)*4;a[h]=o[r],a[h+1]=o[r+1],a[h+2]=o[r+2],a[h+3]=n,h+=4}return a}return new Float32Array(s,i,r)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,i,r,s,n){let o=new Uint16Array(r),h=new Float32Array(s,i),l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++)o[l]=(0,a.ay)(h[l]),o[l+1]=(0,a.ay)(h[l+1]),o[l+2]=(0,a.ay)(h[l+2]),_.StoreLODInAlphaChannel?o[l+3]=(0,a.ay)(n):o[l+3]=(0,a.ay)(h[l+3]),l+=4;return o}static _GetFloatAsUIntRGBAArrayBuffer(e,t,i,s,n,a){let o=new Uint8Array(s),h=new Float32Array(n,i),l=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let s=(t+i*e)*4;o[l]=255*(0,r.Clamp)(h[s]),o[l+1]=255*(0,r.Clamp)(h[s+1]),o[l+2]=255*(0,r.Clamp)(h[s+2]),_.StoreLODInAlphaChannel?o[l+3]=a:o[l+3]=255*(0,r.Clamp)(h[s+3]),l+=4}return o}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,i,s,n,o){let h=new Uint8Array(s),l=new Uint16Array(n,i),u=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let s=(t+i*e)*4;h[u]=255*(0,r.Clamp)((0,a.qZ)(l[s])),h[u+1]=255*(0,r.Clamp)((0,a.qZ)(l[s+1])),h[u+2]=255*(0,r.Clamp)((0,a.qZ)(l[s+2])),_.StoreLODInAlphaChannel?h[u+3]=o:h[u+3]=255*(0,r.Clamp)((0,a.qZ)(l[s+3])),u+=4}return h}static _GetRGBAArrayBuffer(e,t,i,r,s,n,a,o,h){let l=new Uint8Array(r),u=new Uint8Array(s,i),c=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r=(t+i*e)*4;l[c]=u[r+n],l[c+1]=u[r+a],l[c+2]=u[r+o],l[c+3]=u[r+h],c+=4}return l}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+_._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,i,r,s,n,a,o){let h=new Uint8Array(r),l=new Uint8Array(s,i),u=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r=(t+i*e)*3;h[u]=l[r+n],h[u+1]=l[r+a],h[u+2]=l[r+o],u+=3}return h}static _GetLuminanceArrayBuffer(e,t,i,r,s){let n=new Uint8Array(r),a=new Uint8Array(s,i),o=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r=t+i*e;n[o]=a[r],o++}return n}static UploadDDSLevels(e,t,i,r,a,o,d=-1,p,f=!0){let g,m,T,E=null;r.sphericalPolynomial&&(E=[]);let b=!!e.getCaps().s3tc;t.generateMipMaps=a;let R=new Int32Array(i.buffer,i.byteOffset,31),C,P,x,A=0,y,v=0,S=1;if(542327876!==R[0]){s.Y.Error("Invalid magic number in DDS header");return}if(!r.isFourCC&&!r.isRGB&&!r.isLuminance){s.Y.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(r.isCompressed&&!b){s.Y.Error("Compressed textures are not supported on this platform.");return}let M=R[22];y=R[1]+4;let I=!1;if(r.isFourCC)switch(C=R[21]){case h:S=8,v=33777;break;case l:S=16,v=33778;break;case u:S=16,v=33779;break;case 113:I=!0,M=64;break;case 116:I=!0,M=128;break;case c:{y+=20;let e=!1;switch(r.dxgiFormat){case 10:I=!0,M=64,e=!0;break;case 2:I=!0,M=128,e=!0;break;case 88:r.isRGB=!0,r.isFourCC=!1,M=32,e=!0}if(e)break}default:s.Y.Error(["Unsupported FourCC code:",String.fromCharCode(255&C,C>>8&255,C>>16&255,C>>24&255)]);return}let D=_._ExtractLongWordOrder(R[23]),F=_._ExtractLongWordOrder(R[24]),O=_._ExtractLongWordOrder(R[25]),w=_._ExtractLongWordOrder(R[26]);I&&(v=e._getRGBABufferInternalSizedFormat(r.textureType)),m=1,131072&R[2]&&!1!==a&&(m=Math.max(1,R[7]));let B=p||0,L=e.getCaps();for(let s=B;s<o;s++){for(T=0,P=R[4],x=R[3];T<m;++T){if(-1===d||d===T){let n=-1===d?T:0;if(!r.isCompressed&&r.isFourCC){t.format=5,A=P*x*4;let r=null;if(e._badOS||e._badDesktopOS||!L.textureHalfFloat&&!L.textureFloat)128===M?(r=_._GetFloatAsUIntRGBAArrayBuffer(P,x,i.byteOffset+y,A,i.buffer,n),E&&0==n&&E.push(_._GetFloatRGBAArrayBuffer(P,x,i.byteOffset+y,A,i.buffer,n))):64===M&&(r=_._GetHalfFloatAsUIntRGBAArrayBuffer(P,x,i.byteOffset+y,A,i.buffer,n),E&&0==n&&E.push(_._GetHalfFloatAsFloatRGBAArrayBuffer(P,x,i.byteOffset+y,A,i.buffer,n))),t.type=0;else{let e;let s=L.textureFloat&&(f&&L.textureFloatLinearFiltering||!f),a=L.textureHalfFloat&&(f&&L.textureHalfFloatLinearFiltering||!f),o=(128===M||64===M&&!a)&&s?1:(64===M||128===M&&!s)&&a?2:0,h=null;if(128===M)switch(o){case 1:e=_._GetFloatRGBAArrayBuffer,h=null;break;case 2:e=_._GetFloatAsHalfFloatRGBAArrayBuffer,h=_._GetFloatRGBAArrayBuffer;break;case 0:e=_._GetFloatAsUIntRGBAArrayBuffer,h=_._GetFloatRGBAArrayBuffer}else switch(o){case 1:e=_._GetHalfFloatAsFloatRGBAArrayBuffer,h=null;break;case 2:e=_._GetHalfFloatRGBAArrayBuffer,h=_._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:e=_._GetHalfFloatAsUIntRGBAArrayBuffer,h=_._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=o,r=e(P,x,i.byteOffset+y,A,i.buffer,n),E&&0==n&&E.push(h?h(P,x,i.byteOffset+y,A,i.buffer,n):r)}r&&e._uploadDataToTextureDirectly(t,r,s,n)}else if(r.isRGB)t.type=0,24===M?(t.format=4,A=P*x*3,g=_._GetRGBArrayBuffer(P,x,i.byteOffset+y,A,i.buffer,D,F,O)):(t.format=5,A=P*x*4,g=_._GetRGBAArrayBuffer(P,x,i.byteOffset+y,A,i.buffer,D,F,O,w)),e._uploadDataToTextureDirectly(t,g,s,n);else if(r.isLuminance){let r=e._getUnpackAlignement(),a=P;A=Math.floor((P+r-1)/r)*r*(x-1)+a,g=_._GetLuminanceArrayBuffer(P,x,i.byteOffset+y,A,i.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,g,s,n)}else A=Math.max(4,P)/4*Math.max(4,x)/4*S,g=new Uint8Array(i.buffer,i.byteOffset+y,A),t.type=0,e._uploadCompressedDataToTextureDirectly(t,v,P,x,g,s,n)}y+=M?P*x*(M/8):A,P*=.5,x*=.5,P=Math.max(1,P),x=Math.max(1,x)}if(void 0!==p)break}E&&E.length>0?r.sphericalPolynomial=n.$.ConvertCubeMapToSphericalPolynomial({size:R[4],right:E[0],left:E[1],up:E[2],down:E[3],front:E[4],back:E[5],format:5,type:1,gammaSpace:!1}):r.sphericalPolynomial=void 0}}_.StoreLODInAlphaChannel=!1},16973:function(e,t,i){i.d(t,{D:function(){return a},x:function(){return n}});let r={},s={};function n(e){let t=e.getClassName();return s[t]||(s[t]={}),s[t]}function a(e){let t=e.getClassName();if(r[t])return r[t];r[t]={};let i=r[t],n=e,a=t;for(;a;){let e;let t=s[a];for(let e in t)i[e]=t[e];let r=!1;do{if(!(e=Object.getPrototypeOf(n)).getClassName){r=!0;break}if(e.getClassName()!==a)break;n=e}while(e);if(r)break;a=e.getClassName(),n=e}return i}},22287:function(e,t,i){i.d(t,{G6:function(){return E},N$:function(){return d},QC:function(){return u},RR:function(){return _},VE:function(){return T},XX:function(){return p},hd:function(){return c},mv:function(){return g},n9:function(){return h},oQ:function(){return m},oU:function(){return o},qC:function(){return a},qQ:function(){return l},rX:function(){return f},wz:function(){return n}});var r=i(16973);function s(e,t){return(i,s)=>{let n=(0,r.x)(i);n[s]||(n[s]={type:e,sourceName:t})}}function n(e,t=null){return function(e,t=null){return(i,r)=>{let s=t||"_"+r;Object.defineProperty(i,r,{get:function(){return this[s]},set:function(t){"function"==typeof this.equals&&this.equals(t)||this[s]===t||(this[s]=t,i[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function a(e){return s(0,e)}function o(e){return s(1,e)}function h(e){return s(2,e)}function l(e){return s(3,e)}function u(e){return s(4,e)}function c(e){return s(5,e)}function _(e){return s(6,e)}function d(e){return s(7,e)}function p(e){return s(8,e)}function f(e){return s(9,e)}function g(e){return s(10,e)}function m(e){return s(12,e)}function T(e){return s(11,e)}function E(e,t,i,r){let s=i.value;i.value=(...i)=>{let n=s;if("undefined"!=typeof _native&&_native[t]){let e=_native[t];n=r?(...t)=>r(...t)?e(...t):s(...t):e}return e[t]=n,n(...i)}}E.filter=function(e){return(t,i,r)=>E(t,i,r,e)}},90212:function(e,t,i){i.d(t,{p:function(){return l}});var r=i(10633),s=i(88388),n=i(57449),a=i(39884),o=i(16973);let h=function(e,t,i,r={}){let n=e();s.$&&s.$.HasTags(t)&&s.$.AddTagsTo(n,s.$.GetTags(t,!0));let a=(0,o.D)(n),h={};for(let e in a){let s=a[e],o=t[e],u=s.type;if(null!=o&&("uniqueId"!==e||l.AllowLoadingUniqueId))switch(u){case 0:case 6:case 11:n[e]=o;break;case 1:r.cloneTexturesOnlyOnce&&h[o.uniqueId]?n[e]=h[o.uniqueId]:(n[e]=i||o.isRenderTarget?o:o.clone(),h[o.uniqueId]=n[e]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:n[e]=i?o:o.clone()}}return n};class l{static AppendSerializedAnimations(e,t){if(e.animations){t.animations=[];for(let i=0;i<e.animations.length;i++){let r=e.animations[i];t.animations.push(r.serialize())}}}static Serialize(e,t){t||(t={}),s.$&&(t.tags=s.$.GetTags(e));let i=(0,o.D)(e);for(let r in i){let s=i[r],n=s.sourceName||r,a=s.type,o=e[r];if(null!=o&&("uniqueId"!==r||l.AllowLoadingUniqueId))switch(a){case 0:t[n]=o;break;case 1:case 3:case 7:case 9:t[n]=o.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:t[n]=o.asArray();break;case 6:case 11:t[n]=o.id}}return t}static ParseProperties(e,t,i,r){r||(r="");let s=(0,o.D)(t);for(let o in s){let h=s[o],u=e[h.sourceName||o],c=h.type;if(null!=u&&("uniqueId"!==o||l.AllowLoadingUniqueId))switch(c){case 0:t[o]=u;break;case 1:i&&(t[o]=l._TextureParser(u,i,r));break;case 2:t[o]=n.Wo.FromArray(u);break;case 3:t[o]=l._FresnelParametersParser(u);break;case 4:t[o]=a.FM.FromArray(u);break;case 5:t[o]=a.P.FromArray(u);break;case 6:i&&(t[o]=i.getLastMeshById(u));break;case 7:t[o]=l._ColorCurvesParser(u);break;case 8:t[o]=n.HE.FromArray(u);break;case 9:t[o]=l._ImageProcessingConfigurationParser(u);break;case 10:t[o]=a._f.FromArray(u);break;case 11:i&&(t[o]=i.getCameraById(u));break;case 12:t[o]=a.y3.FromArray(u)}}}static Parse(e,t,i,r=null){let n=e();return s.$&&s.$.AddTagsTo(n,t.tags),l.ParseProperties(t,n,i,r),n}static Clone(e,t,i={}){return h(e,t,!1,i)}static Instanciate(e,t){return h(e,t,!0)}}l.AllowLoadingUniqueId=!1,l._ImageProcessingConfigurationParser=e=>{throw(0,r.S)("ImageProcessingConfiguration")},l._FresnelParametersParser=e=>{throw(0,r.S)("FresnelParameters")},l._ColorCurvesParser=e=>{throw(0,r.S)("ColorCurves")},l._TextureParser=(e,t,i)=>{throw(0,r.S)("Texture")}},31642:function(e,t,i){i.d(t,{j:function(){return n}});var r=i(9719);let s=(e,t,i)=>!e||e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&("SubMesh"===e.getClassName()||"PhysicsBody"===e.getClassName())?e.clone(t):e.clone?e.clone():Array.isArray(e)?e.slice():i&&"object"==typeof e?{...e}:null;class n{static DeepCopy(e,t,i,n,a=!1){for(let o of function(e){let t=[];do Object.getOwnPropertyNames(e).forEach(function(e){-1===t.indexOf(e)&&t.push(e)});while(e=Object.getPrototypeOf(e));return t}(e)){if("_"===o[0]&&(!n||-1===n.indexOf(o))||o.endsWith("Observable")||i&&-1!==i.indexOf(o))continue;let h=e[o],l=typeof h;if("function"!==l)try{if("object"===l){if(h instanceof Uint8Array)t[o]=Uint8Array.from(h);else if(h instanceof Array){if(t[o]=[],h.length>0){if("object"==typeof h[0])for(let e=0;e<h.length;e++){let i=s(h[e],t,a);-1===t[o].indexOf(i)&&t[o].push(i)}else t[o]=h.slice(0)}}else t[o]=s(h,t,a)}else t[o]=h}catch(e){r.Y.Warn(e.message)}}}}},10633:function(e,t,i){i.d(t,{S:function(){return s}});let r={};function s(e,t=!1){if(!t||!r[e])return r[e]=!0,`${e} needs to be imported before as it contains a side-effect required by your code.`}},28143:function(e,t,i){function r(){return"undefined"!=typeof window}function s(){return"undefined"!=typeof navigator}function n(){return"undefined"!=typeof document}function a(e){let t="",i=e.firstChild;for(;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t}i.d(t,{CG:function(){return r},n5:function(){return n},up:function(){return s},v:function(){return a}})},77669:function(e,t,i){i.d(t,{GU:function(){return r},LH:function(){return n},SM:function(){return s}});class r extends Error{}r._setPrototypeOf=Object.setPrototypeOf||((e,t)=>(e.__proto__=t,e));let s={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class n extends r{constructor(e,t,i){super(e),this.errorCode=t,this.innerError=i,this.name="RuntimeError",r._setPrototypeOf(this,n.prototype)}}},14684:function(e,t,i){let r;i.d(t,{$K:function(){return D},$M:function(){return C},FV:function(){return v},Ip:function(){return A},VL:function(){return M},r6:function(){return x},rN:function(){return R},vP:function(){return y}});var s=i(79114),n=i(28143),a=i(82877),o=i(26584),h=i(79927),l=i(77669),u=i(72786),c=i(96305),_=i(51092),d=i(9719),p=i(15010),f=i(56172),g=i(3176);let m=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class T extends l.LH{constructor(e,t){super(e,l.SM.LoadFileError),this.name="LoadFileError",l.GU._setPrototypeOf(this,T.prototype),t instanceof s.g?this.request=t:this.file=t}}class E extends l.LH{constructor(e,t){super(e,l.SM.RequestFileError),this.request=t,this.name="RequestFileError",l.GU._setPrototypeOf(this,E.prototype)}}class b extends l.LH{constructor(e,t){super(e,l.SM.ReadFileError),this.file=t,this.name="ReadFileError",l.GU._setPrototypeOf(this,b.prototype)}}let R={DefaultRetryStrategy:h.b.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:e=>e=e.replace(/#/gm,"%23")},C=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&R.CorsBehavior){if("string"==typeof R.CorsBehavior||R.CorsBehavior instanceof String)t.crossOrigin=R.CorsBehavior;else{let i=R.CorsBehavior(e);i&&(t.crossOrigin=i)}}},P={getRequiredSize:null},x=(e,t,i,r,n="",a)=>{let h;let l=_.l.LastCreatedEngine;if("undefined"==typeof HTMLImageElement&&!l?._features.forceBitmapOverHTMLImageElement)return i("LoadImage is only supported in web or BabylonNative environments."),null;let c=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(h=URL.createObjectURL(new Blob([e],{type:n})),c=!0):h=`data:${n};base64,`+(0,u.Gh)(e):e instanceof Blob?(h=URL.createObjectURL(e),c=!0):(h=R.CleanUrl(e),h=R.PreprocessUrl(h));let d=t=>{if(i){let r=h||e.toString();i(`Error while trying to load image: ${0===r.indexOf("http")||r.length<=128?r:r.slice(0,128)+"..."}`,t)}};if(l?._features.forceBitmapOverHTMLImageElement)return y(h,r=>{l.createImageBitmap(new Blob([r],{type:n}),{premultiplyAlpha:"none",...a}).then(e=>{t(e),c&&URL.revokeObjectURL(h)}).catch(t=>{i&&i("Error while trying to load image: "+e,t)})},void 0,r||void 0,!0,(e,t)=>{d(t)}),null;let p=new Image;if(P.getRequiredSize){let t=P.getRequiredSize(e);t.width&&(p.width=t.width),t.height&&(p.height=t.height)}C(h,p);let f=[],g=()=>{f.forEach(e=>{e.target.removeEventListener(e.name,e.handler)}),f.length=0};f.push({target:p,name:"load",handler:()=>{g(),t(p),c&&p.src&&URL.revokeObjectURL(p.src)}}),f.push({target:p,name:"error",handler:e=>{g(),d(e),c&&p.src&&URL.revokeObjectURL(p.src)}}),f.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==p.src||"report"===e.disposition)return;g();let t=Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);_.l.UseFallbackTexture=!1,d(t),c&&p.src&&URL.revokeObjectURL(p.src),p.src=""}}),f.forEach(e=>{e.target.addEventListener(e.name,e.handler)});let m="blob:"===h.substring(0,5),T="data:"===h.substring(0,5),E=()=>{m||T||!s.g.IsCustomRequestAvailable?p.src=h:y(h,(e,t,i)=>{let r=new Blob([e],{type:!n&&i?i:n}),s=URL.createObjectURL(r);c=!0,p.src=s},void 0,r||void 0,!0,(e,t)=>{d(t)})};if(!m&&!T&&r&&r.enableTexturesOffline)r.open(()=>{r&&r.loadImage(h,p)},E);else{if(-1!==h.indexOf("file:")){let e=decodeURIComponent(h.substring(5).toLowerCase());if(o.X.FilesToLoad[e]&&"undefined"!=typeof URL){try{let t;try{t=URL.createObjectURL(o.X.FilesToLoad[e])}catch(i){t=URL.createObjectURL(o.X.FilesToLoad[e])}p.src=t,c=!0}catch(e){p.src=""}return p}}E()}return p},A=(e,t,i,r,s)=>{let n=new FileReader,o={onCompleteObservable:new a.y$,abort:()=>n.abort()};return n.onloadend=()=>o.onCompleteObservable.notifyObservers(o),s&&(n.onerror=()=>{s(new b(`Unable to read ${e.name}`,e))}),n.onload=e=>{t(e.target.result)},i&&(n.onprogress=i),r?n.readAsArrayBuffer(e):n.readAsText(e),o},y=(e,t,i,r,s,n,h)=>{if(e.name)return A(e,t,i,s,n?e=>{n(void 0,e)}:void 0);if(-1!==e.indexOf("file:")){let r=decodeURIComponent(e.substring(5).toLowerCase());0===r.indexOf("./")&&(r=r.substring(2));let a=o.X.FilesToLoad[r];if(a)return A(a,t,i,s,n?e=>n(void 0,new T(e.message,e.file)):void 0)}let{match:l,type:u}=I(e);if(l){let i={onCompleteObservable:new a.y$,abort:()=>()=>{}};try{let i=s?D(e):F(e);t(i,void 0,u)}catch(e){n?n(void 0,e):d.Y.Error(e.message||"Failed to parse the Data URL")}return p.Q.SetImmediate(()=>{i.onCompleteObservable.notifyObservers(i)}),i}return v(e,(e,i)=>{t(e,i?.responseURL,i?.getResponseHeader("content-type"))},i,r,s,n?e=>{n(e.request,new T(e.message,e.request))}:void 0,h)},v=(e,t,i,r,o,h,l)=>{e=R.CleanUrl(e),e=R.PreprocessUrl(e);let u=R.BaseUrl+e,c=!1,_={onCompleteObservable:new a.y$,abort:()=>c=!0},p=()=>{let e,r=new s.g,a=null,p=()=>{r&&(i&&r.removeEventListener("progress",i),e&&r.removeEventListener("readystatechange",e),r.removeEventListener("loadend",f))},f=()=>{p(),_.onCompleteObservable.notifyObservers(_),_.onCompleteObservable.clear(),i=void 0,e=null,f=null,h=void 0,l=void 0,t=void 0};_.abort=()=>{c=!0,f&&f(),r&&r.readyState!==(XMLHttpRequest.DONE||4)&&r.abort(),null!==a&&(clearTimeout(a),a=null),r=null};let g=e=>{let t=e.message||"Unknown error";h&&r?h(new E(t,r)):d.Y.Error(t)},m=_=>{if(r){if(r.open("GET",u),l)try{l(r)}catch(e){g(e);return}o&&(r.responseType="arraybuffer"),i&&r.addEventListener("progress",i),f&&r.addEventListener("loadend",f),e=()=>{if(!c&&r&&r.readyState===(XMLHttpRequest.DONE||4)){if(e&&r.removeEventListener("readystatechange",e),r.status>=200&&r.status<300||0===r.status&&(!(0,n.CG)()||S())){try{t&&t(o?r.response:r.responseText,r)}catch(e){g(e)}return}let i=R.DefaultRetryStrategy;if(i){let e=i(u,r,_);if(-1!==e){p(),r=new s.g,a=setTimeout(()=>m(_+1),e);return}}let l=new E("Error status: "+r.status+" "+r.statusText+" - Unable to load "+u,r);h&&h(l)}},r.addEventListener("readystatechange",e),r.send()}};m(0)};if(r&&r.enableSceneOffline){let s=e=>{e&&e.status>400?h&&h(e):p()};r.open(()=>{r&&r.loadFile(R.BaseUrl+e,e=>{!c&&t&&t(e),_.onCompleteObservable.notifyObservers(_)},i?e=>{!c&&i&&i(e)}:void 0,s,o)},s)}else p();return _},S=()=>"undefined"!=typeof location&&"file:"===location.protocol,M=e=>m.test(e),I=e=>{let t=m.exec(e);return null===t||0===t.length?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function D(e){return(0,u.HQ)(e.split(",")[1])}let F=e=>(0,u.rP)(e.split(",")[1]);g.a._FileToolsLoadImage=x,f.an.loadFile=y,c.PM.loadFile=y,Object.defineProperty(r={DecodeBase64UrlToBinary:D,DecodeBase64UrlToString:F,DefaultRetryStrategy:R.DefaultRetryStrategy,BaseUrl:R.BaseUrl,CorsBehavior:R.CorsBehavior,PreprocessUrl:R.PreprocessUrl,IsBase64DataUrl:M,IsFileURL:S,LoadFile:y,LoadImage:x,ReadFile:A,RequestFile:v,SetCorsBehavior:C},"DefaultRetryStrategy",{get:function(){return R.DefaultRetryStrategy},set:function(e){R.DefaultRetryStrategy=e}}),Object.defineProperty(r,"BaseUrl",{get:function(){return R.BaseUrl},set:function(e){R.BaseUrl=e}}),Object.defineProperty(r,"PreprocessUrl",{get:function(){return R.PreprocessUrl},set:function(e){R.PreprocessUrl=e}}),Object.defineProperty(r,"CorsBehavior",{get:function(){return R.CorsBehavior},set:function(e){R.CorsBehavior=e}})},26584:function(e,t,i){i.d(t,{X:function(){return r}});class r{}r.FilesToLoad={}},25675:function(e,t,i){i.d(t,{f:function(){return r}});function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},41377:function(e,t,i){i.d(t,{K:function(){return n}});var r=i(9719),s=i(7724);class n{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];let t=(0,s.qw)(e);if(t)return t;r.Y.Warn(e+" not found, you may have missed an import.");let i=e.split("."),n=window||this;for(let e=0,t=i.length;e<t;e++)n=n[i[e]];return"function"!=typeof n?null:n}}n.RegisteredExternalClasses={}},9719:function(e,t,i){i.d(t,{Y:function(){return r}});class r{static _CheckLimit(e,t){let i=r._LogLimitOutputs[e];return i?i.current++:(i={limit:t,current:1},r._LogLimitOutputs[e]=i),i.current<=i.limit}static _GenerateLimitMessage(e,t=1){let i=r._LogLimitOutputs[e];if(!i||!r.MessageLimitReached)return;let s=this._Levels[t];i.current===i.limit&&r[s.name](r.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,s.name??""))}static _AddLogEntry(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)}static _FormatMessage(e){let t=e=>e<10?"0"+e:""+e,i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,i){let s=Array.isArray(t)?t[0]:t;if(void 0!==i&&!r._CheckLimit(s,i))return;let n=r._FormatMessage(s),a=this._Levels[e],o=Array.isArray(t)?t.slice(1):[];a.logFunc&&a.logFunc("BJS - "+n,...o);let h=`<div style='color:${a.color}'>${n}</div><br>`;r._AddLogEntry(h),r._GenerateLimitMessage(s,e)}static get LogCache(){return r._LogCache}static ClearLogCache(){r._LogCache="",r._LogLimitOutputs={},r.errorsCount=0}static set LogLevels(e){r.Log=r._LogDisabled,r.Warn=r._LogDisabled,r.Error=r._LogDisabled,[r.MessageLogLevel,r.WarningLogLevel,r.ErrorLogLevel].forEach(t=>{(e&t)===t&&(r[this._Levels[t].name]=r._LogEnabled.bind(r,t))})}}r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",r._LogCache="",r._LogLimitOutputs={},r._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],r.errorsCount=0,r.Log=r._LogEnabled.bind(r,r.MessageLogLevel),r.Warn=r._LogEnabled.bind(r,r.WarningLogLevel),r.Error=r._LogEnabled.bind(r,r.ErrorLogLevel)},82877:function(e,t,i){i.d(t,{he:function(){return r},y$:function(){return n}});class r{constructor(e,t=!1,i,r){this.initialize(e,t,i,r)}initialize(e,t=!1,i,r){return this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this}}class s{constructor(e,t,i=null){this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class n{static FromPromise(e,t){let i=new n;return e.then(e=>{i.notifyObservers(e)}).catch(e=>{if(t)t.notifyObservers(e);else throw e}),i}get observers(){return this._observers}constructor(e,t=!1){this.notifyIfTriggered=t,this._observers=[],this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new r(0),e&&(this._onObserverAdded=e)}add(e,t=-1,i=!1,r=null,n=!1){if(!e)return null;let a=new s(e,t,r);return a.unregisterOnNextCall=n,i?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(a,this._lastNotifiedValue),a._remove=()=>{this.remove(a)},a}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return!!e&&(e._remove=null,-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))}removeCallback(e,t){for(let i=0;i<this._observers.length;i++){let r=this._observers[i];if(!r._willBeUnregistered&&r.callback===e&&(!t||t===r.scope))return this._deferUnregister(r),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(()=>{this._remove(e)},0))}_remove(e,t=!0){if(!e)return!1;let i=this._observers.indexOf(e);return -1!==i&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,t=-1,i,r,s){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;let n=this._eventState;for(let a of(n.mask=t,n.target=i,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=e,n.userInfo=s,this._observers))if(!a._willBeUnregistered&&(a.mask&t&&(a.unregisterOnNextCall&&this._deferUnregister(a),a.scope?n.lastReturnValue=a.callback.apply(a.scope,[e,n]):n.lastReturnValue=a.callback(e,n)),n.skipNextObservers))return!1;return!0}notifyObserver(e,t,i=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),e._willBeUnregistered)return;let r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(t,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){let e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){let e=new n;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(let t of this._observers)if(t.mask&e||t.mask===e)return!0;return!1}}},51366:function(e,t,i){i.d(t,{z:function(){return s}});var r=i(94551);class s{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,t){s.Enabled&&(this._current+=e,t&&this._fetchResult())}beginMonitoring(){s.Enabled&&(this._startMonitoringTime=r.F.Now)}endMonitoring(e=!0){if(!s.Enabled)return;e&&this.fetchNewFrame();let t=r.F.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}endFrame(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;let e=r.F.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}s.Enabled=!0},99558:function(e,t,i){i.d(t,{A:function(){return s}});var r=i(94551);class s{constructor(e=30){this._enabled=!0,this._rollingFrameTime=new n(e)}sampleFrame(e=r.F.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){let t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){let e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class n{constructor(e){this._samples=Array(e),this.reset()}add(e){let t;if(this.isSaturated()){let e=this._samples[this._pos];t=e-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(e-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length}history(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;let t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(e){let t=this._samples.length;return(e%t+t)%t}}},94551:function(e,t,i){i.d(t,{F:function(){return s}});var r=i(28143);class s{static get Now(){return(0,r.CG)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},79927:function(e,t,i){i.d(t,{b:function(){return r}});class r{static ExponentialBackoff(e=3,t=500){return(i,r,s)=>0!==r.status||s>=e||-1!==i.indexOf("file:")?-1:Math.pow(2,s)*t}}},93287:function(e,t,i){i.d(t,{f:function(){return s},t:function(){return r}});class r{constructor(e){this.length=0,this.data=Array(e),this._id=r._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let t=0;t<this.length;t++)e(this.data[t])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(let t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}}indexOf(e){let t=this.data.indexOf(e);return t>=this.length?-1:t}contains(e){return -1!==this.indexOf(e)}}r._GlobalId=0;class s extends r{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(let t=0;t<e.length;t++){let i=(e.data||e)[t];this.pushNoDuplicate(i)}}}}},87676:function(e,t,i){i.d(t,{x:function(){return r}});class r{constructor(){this._count=0,this._data={}}copyFrom(e){this.clear(),e.forEach((e,t)=>this.add(e,t))}get(e){let t=this._data[e];if(void 0!==t)return t}getOrAddWithFactory(e,t){let i=this.get(e);return void 0!==i||(i=t(e))&&this.add(e,i),i}getOrAdd(e,t){let i=this.get(e);return void 0!==i?i:(this.add(e,t),t)}contains(e){return void 0!==this._data[e]}add(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)}set(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)}getAndRemove(e){let t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null}remove(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(e){for(let t in this._data){let i=this._data[t];e(t,i)}}first(e){for(let t in this._data){let i=this._data[t],r=e(t,i);if(r)return r}return null}}},72786:function(e,t,i){i.d(t,{Gh:function(){return r},HQ:function(){return n},rP:function(){return s}});let r=e=>{let t,i,r,s,n,a,o;let h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0,c=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;u<c.length;)t=c[u++],i=u<c.length?c[u++]:Number.NaN,r=u<c.length?c[u++]:Number.NaN,s=t>>2,n=(3&t)<<4|i>>4,a=(15&i)<<2|r>>6,o=63&r,isNaN(i)?a=o=64:isNaN(r)&&(o=64),l+=h.charAt(s)+h.charAt(n)+h.charAt(a)+h.charAt(o);return l},s=e=>atob(e),n=e=>{let t=s(e),i=t.length,r=new Uint8Array(new ArrayBuffer(i));for(let e=0;e<i;e++)r[e]=t.charCodeAt(e);return r.buffer}},88388:function(e,t,i){i.d(t,{$:function(){return s}});var r=i(39360);class s{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>s.HasTags(e),e.addTags=t=>s.AddTagsTo(e,t),e.removeTags=t=>s.RemoveTagsFrom(e,t),e.matchesTagsQuery=t=>s.MatchesQuery(e,t)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;let t=e._tags;for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}static GetTags(e,t=!0){if(!e._tags)return null;if(!t)return e._tags;{let t=[];for(let i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&t.push(i);return t.join(" ")}}static AddTagsTo(e,t){t&&"string"==typeof t&&t.split(" ").forEach(function(t){s._AddTagTo(e,t)})}static _AddTagTo(e,t){""===(t=t.trim())||"true"===t||"false"===t||t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(s.EnableFor(e),e._tags[t]=!0)}static RemoveTagsFrom(e,t){if(!s.HasTags(e))return;let i=t.split(" ");for(let t in i)s._RemoveTagFrom(e,i[t])}static _RemoveTagFrom(e,t){delete e._tags[t]}static MatchesQuery(e,t){return void 0===t||(""===t?s.HasTags(e):r.q.Eval(t,t=>s.HasTags(e)&&e._tags[t]))}}},15096:function(e,t,i){let r,s;i.d(t,{$0:function(){return l},Oi:function(){return d},ay:function(){return u},qZ:function(){return c}});var n=i(81209),a=i(6507),o=i(70214),h=i(49727);function l(e,t,i,r,s,n,a,o){let l=t.getEngine();return t.isReady=!1,s=s??t.samplingMode,r=r??t.type,n=n??t.format,a=a??t.width,o=o??t.height,-1===r&&(r=0),new Promise(u=>{let c=new h.D("postprocess",e,null,null,1,null,s,l,!1,void 0,r,void 0,null,!1,n);c.externalTextureSamplerBinding=!0;let _=l.createRenderTargetTexture({width:a,height:o},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:s,type:r,format:n});c.onEffectCreatedObservable.addOnce(e=>{e.executeWhenCompiled(()=>{c.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},i.postProcessManager.directRender([c],_,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(t),c&&c.dispose(),_._swapAndDie(t),t.type=r,t.format=5,t.isReady=!0,u(t)})})})}function u(e){r||(s=new Int32Array((r=new Float32Array(1)).buffer)),r[0]=e;let t=s[0],i=t>>16&32768,n=t>>12&2047,a=t>>23&255;return a<103?i:a>142?(i|=31744,i|=(255==a?0:1)&&8388607&t):a<113?(n|=2048,i|=(n>>114-a)+(n>>113-a&1)):(i|=a-112<<10|n>>1,i+=1&n)}function c(e){let t=(32768&e)>>15,i=(31744&e)>>10,r=1023&e;return 0===i?(t?-1:1)*6103515625e-14*(r/1024):31==i?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+r/1024)}let _=async(e,t,r,s,o)=>{let l;let u=e.getScene(),c=u.getEngine();c.isWebGPU?e.isCube?await i.e(3148).then(i.bind(i,93148)):await i.e(1511).then(i.bind(i,91511)):e.isCube?await i.e(8734).then(i.bind(i,88734)):await i.e(4667).then(i.bind(i,44667)),l=e.isCube?new h.D("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:n.x.NEAREST_NEAREST_MIPNEAREST,engine:c,defines:["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"][s],shaderLanguage:c.isWebGPU?1:0}):new h.D("lod","lod",{uniforms:["lod","gamma"],samplingMode:n.x.NEAREST_NEAREST_MIPNEAREST,engine:c,shaderLanguage:c.isWebGPU?1:0}),await new Promise(e=>{l.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{e(0)})})});let _=new a._("temp",{width:t,height:r},u,!1);l.onApply=function(t){t.setTexture("textureSampler",e),t.setFloat("lod",o),t.setInt("gamma",e.gammaSpace?1:0)};let d=e.getInternalTexture();try{if(_.renderTarget&&d){let i=d.samplingMode;0!==o?e.updateSamplingMode(n.x.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(n.x.NEAREST_NEAREST),u.postProcessManager.directRender([l],_.renderTarget,!0),e.updateSamplingMode(i);let s=await c.readPixels(0,0,t,r),a=new Uint8Array(s.buffer,0,s.byteLength);return c.unBindFramebuffer(_.renderTarget),a}throw Error("Render to texture failed.")}finally{_.dispose(),l.dispose()}},d={CreateResizedCopy:function(e,t,i,r=!0){let s=e.getScene(),h=s.getEngine(),l=new a._("resized"+e.name,{width:t,height:i},s,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);l.wrapU=e.wrapU,l.wrapV=e.wrapV,l.uOffset=e.uOffset,l.vOffset=e.vOffset,l.uScale=e.uScale,l.vScale=e.vScale,l.uAng=e.uAng,l.vAng=e.vAng,l.wAng=e.wAng,l.coordinatesIndex=e.coordinatesIndex,l.level=e.level,l.anisotropicFilteringLevel=e.anisotropicFilteringLevel,l._texture.isReady=!1,e.wrapU=n.x.CLAMP_ADDRESSMODE,e.wrapV=n.x.CLAMP_ADDRESSMODE;let u=new o.Q("pass",1,null,r?n.x.BILINEAR_SAMPLINGMODE:n.x.NEAREST_SAMPLINGMODE,h,!1,0);return u.externalTextureSamplerBinding=!0,u.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{u.onApply=function(t){t.setTexture("textureSampler",e)};let t=l.renderTarget;t&&(s.postProcessManager.directRender([u],t),h.unBindFramebuffer(t),l.disposeFramebufferObjects(),u.dispose(),l.getInternalTexture().isReady=!0)})}),l},ApplyPostProcess:l,ToHalfFloat:u,FromHalfFloat:c,GetTextureDataAsync:async function(e,t,i,r=0,s=0){return!e.isReady()&&e._texture&&await new Promise((t,i)=>{if(null===e._texture){i(0);return}e._texture.onLoadedObservable.addOnce(()=>{t(0)})}),await _(e,t,i,r,s)}}},15010:function(e,t,i){i.d(t,{Q:function(){return s}});var r=i(28143);class s{static SetImmediate(e){(0,r.CG)()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)}}},61146:function(e,t,i){function r(e){let t=1;do t*=2;while(t<e);return t===e}function s(e,t,i){return e*(1-i)+t*i}function n(e){let t=a(e),i=o(e);return t-e>e-i?i:t}function a(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function o(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function h(e,t,i=2){let r;switch(i){case 1:r=o(e);break;case 2:r=n(e);break;default:r=a(e)}return Math.min(r,t)}i.d(t,{Av:function(){return o},Tr:function(){return n},V2:function(){return s},lP:function(){return r},p7:function(){return h}})},4224:function(e,t,i){i.d(t,{$g:function(){return m},w1:function(){return g}});var r=i(82877),s=i(28143),n=i(9719),a=i(31642),o=i(94551),h=i(10633),l=i(79114),u=i(51092),c=i(14684),_=i(15010),d=i(41377),p=i(25675),f=i(61146);class g{static get BaseUrl(){return c.rN.BaseUrl}static set BaseUrl(e){c.rN.BaseUrl=e}static get CleanUrl(){return c.rN.CleanUrl}static set CleanUrl(e){c.rN.CleanUrl=e}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||!(-1===e.indexOf("://")||-1===e.indexOf(".")||-1===e.indexOf("/")||e.indexOf(":")>e.indexOf("/"))&&(e.indexOf("://")<e.indexOf(".")||0===e.indexOf("data:")||0===e.indexOf("blob:"))}static set ScriptBaseUrl(e){c.rN.ScriptBaseUrl=e}static get ScriptBaseUrl(){return c.rN.ScriptBaseUrl}static set ScriptPreprocessUrl(e){c.rN.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return c.rN.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return c.rN.DefaultRetryStrategy}static set DefaultRetryStrategy(e){c.rN.DefaultRetryStrategy=e}static get CorsBehavior(){return c.rN.CorsBehavior}static set CorsBehavior(e){c.rN.CorsBehavior=e}static get UseFallbackTexture(){return u.l.UseFallbackTexture}static set UseFallbackTexture(e){u.l.UseFallbackTexture=e}static get RegisteredExternalClasses(){return d.K.RegisteredExternalClasses}static set RegisteredExternalClasses(e){d.K.RegisteredExternalClasses=e}static get fallbackTexture(){return u.l.FallbackTexture}static set fallbackTexture(e){u.l.FallbackTexture=e}static FetchToRef(e,t,i,r,s,n){let a=((Math.abs(e)*i%i|0)+(Math.abs(t)*r%r|0)*i)*4;n.r=s[a]/255,n.g=s[a+1]/255,n.b=s[a+2]/255,n.a=s[a+3]/255}static Mix(e,t,i){return 0}static Instantiate(e){return d.K.Instantiate(e)}static SetImmediate(e){_.Q.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){let t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e,t=!1){let i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)}static ToDegrees(e){return 180*e/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t,i=.9){let r=this.ToRadians(e),s=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-i)*Math.sin(s)+i*Math.sin(r),(1-i)*Math.cos(s)+i*Math.cos(r)))}static MakeArray(e,t){return!0!==t&&(void 0===e||null==e)?null:Array.isArray(e)?e:[e]}static GetPointerPrefix(e){return(0,s.CG)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(e,t){(0,c.$M)(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get PreprocessUrl(){return c.rN.PreprocessUrl}static set PreprocessUrl(e){c.rN.PreprocessUrl=e}static LoadImage(e,t,i,r,s,n){return(0,c.r6)(e,t,i,r,s,n)}static LoadFile(e,t,i,r,s,n){return(0,c.vP)(e,t,i,r,s,n)}static LoadFileAsync(e,t=!0){return new Promise((i,r)=>{(0,c.vP)(e,e=>{i(e)},void 0,void 0,t,(e,t)=>{r(t)})})}static GetBabylonScriptURL(e,t){if(!e)return"";if(g.ScriptBaseUrl&&e.startsWith(g._DefaultCdnUrl)){let t="/"===g.ScriptBaseUrl[g.ScriptBaseUrl.length-1]?g.ScriptBaseUrl.substring(0,g.ScriptBaseUrl.length-1):g.ScriptBaseUrl;e=e.replace(g._DefaultCdnUrl,t)}return e=g.ScriptPreprocessUrl(e),t&&(e=g.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,i,r){e=g.GetBabylonScriptURL(e),g.LoadScript(e,t,i)}static LoadBabylonScriptAsync(e){return e=g.GetBabylonScriptURL(e),g.LoadScriptAsync(e)}static LoadScript(e,t,i,r){if("function"==typeof importScripts){try{importScripts(e),t()}catch(t){i?.(`Unable to load script '${e}' in worker`,t)}return}if(!(0,s.CG)()){i?.(`Cannot load script '${e}' outside of a window or a worker`);return}let n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),r&&(a.id=r),a.onload=()=>{t&&t()},a.onerror=t=>{i&&i(`Unable to load script '${e}'`,t)},n.appendChild(a)}static LoadScriptAsync(e,t){return new Promise((i,r)=>{this.LoadScript(e,()=>{i()},(e,t)=>{r(t||Error(e))},t)})}static ReadFileAsDataURL(e,t,i){let s=new FileReader,n={onCompleteObservable:new r.y$,abort:()=>s.abort()};return s.onloadend=()=>{n.onCompleteObservable.notifyObservers(n)},s.onload=e=>{t(e.target.result)},s.onprogress=i,s.readAsDataURL(e),n}static ReadFile(e,t,i,r,s){return(0,c.Ip)(e,t,i,r,s)}static FileAsURL(e){let t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e,t=2){return e.toFixed(t)}static DeepCopy(e,t,i,r){a.j.DeepCopy(e,t,i,r)}static IsEmpty(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){let r=t[i];e.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(e){}}}static UnregisterTopRootEvents(e,t){for(let i=0;i<t.length;i++){let r=t[i];e.removeEventListener(r.name,r.handler);try{e.parent&&e.parent.removeEventListener(r.name,r.handler)}catch(e){}}}static async DumpFramebuffer(e,t,i,r,s="image/png",n,a){throw(0,h.S)("DumpTools")}static DumpData(e,t,i,r,s="image/png",n,a=!1,o=!1,l){throw(0,h.S)("DumpTools")}static DumpDataAsync(e,t,i,r="image/png",s,n=!1,a=!1,o){throw(0,h.S)("DumpTools")}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static ToBlob(e,t,i="image/png",r){g._IsOffScreenCanvas(e)||e.toBlob||(e.toBlob=function(e,t,i){setTimeout(()=>{let r=atob(this.toDataURL(t,i).split(",")[1]),s=r.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=r.charCodeAt(e);e(new Blob([n]))})}),g._IsOffScreenCanvas(e)?e.convertToBlob({type:i,quality:r}).then(e=>t(e)):e.toBlob(function(e){t(e)},i,r)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){let e=new Date;t="screenshot_"+((e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours())+"-"+("0"+e.getMinutes()).slice(-2)+".png"}g.Download(e,t)}else if(e&&"undefined"!=typeof URL){let t=URL.createObjectURL(e),i=window.open("");if(!i)return;let r=i.document.createElement("img");r.onload=function(){URL.revokeObjectURL(t)},r.src=t,i.document.body.appendChild(r)}}static EncodeScreenshotCanvasData(e,t,i="image/png",r,s){if("string"!=typeof r&&t){if(t){if(g._IsOffScreenCanvas(e)){e.convertToBlob({type:i,quality:s}).then(e=>{let i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>{t(i.result)}});return}t(e.toDataURL(i,s))}}else this.ToBlob(e,function(e){e&&g.DownloadBlob(e,r),t&&t("")},i,s)}static Download(e,t){if("undefined"==typeof URL)return;let i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=i,r.download=t,r.addEventListener("click",()=>{r.parentElement&&r.parentElement.removeChild(r)}),r.click(),window.URL.revokeObjectURL(i)}static BackCompatCameraNoPreventDefault(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}static CreateScreenshot(e,t,i,r,s="image/png",n=!1,a){throw(0,h.S)("ScreenshotTools")}static CreateScreenshotAsync(e,t,i,r="image/png",s){throw(0,h.S)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,i,r,s="image/png",n=1,a=!1,o,l=!1,u=!1,c=!0,_,d){throw(0,h.S)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(e,t,i,r="image/png",s=1,n=!1,a,o=!1,l=!1,u=!0,c,_){throw(0,h.S)("ScreenshotTools")}static RandomId(){return(0,p.f)()}static IsBase64(e){return(0,c.VL)(e)}static DecodeBase64(e){return(0,c.$K)(e)}static get errorsCount(){return n.Y.errorsCount}static Log(e){n.Y.Log(e)}static Warn(e){n.Y.Warn(e)}static Error(e){n.Y.Error(e)}static get LogCache(){return n.Y.LogCache}static ClearLogCache(){n.Y.ClearLogCache()}static set LogLevels(e){n.Y.LogLevels=e}static set PerformanceLogLevel(e){if((e&g.PerformanceUserMarkLogLevel)===g.PerformanceUserMarkLogLevel){g.StartPerformanceCounter=g._StartUserMark,g.EndPerformanceCounter=g._EndUserMark;return}if((e&g.PerformanceConsoleLogLevel)===g.PerformanceConsoleLogLevel){g.StartPerformanceCounter=g._StartPerformanceConsole,g.EndPerformanceCounter=g._EndPerformanceConsole;return}g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,g.EndPerformanceCounter=g._EndPerformanceCounterDisabled}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e,t=!0){if(!g._Performance){if(!(0,s.CG)())return;g._Performance=window.performance}t&&g._Performance.mark&&g._Performance.mark(e+"-Begin")}static _EndUserMark(e,t=!0){t&&g._Performance.mark&&(g._Performance.mark(e+"-End"),g._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e,t=!0){t&&(g._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e,t=!0){t&&(g._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return o.F.Now}static GetClassName(e,t=!1){let i=null;return!t&&e.getClassName?i=e.getClassName():(e instanceof Object&&(i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),i||(i=typeof e)),i}static First(e,t){for(let i of e)if(t(i))return i;return null}static getFullClassName(e,t=!1){let i=null,r=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){let s=t?e:Object.getPrototypeOf(e);i=s.constructor.__bjsclassName__,r=s.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=r?r+".":"")+i:null}static DelayAsync(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}static IsSafari(){return!!(0,s.up)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}g.UseCustomRequestHeaders=!1,g.CustomRequestHeaders=l.g.CustomRequestHeaders,g.GetDOMTextContent=s.v,g._DefaultCdnUrl="https://cdn.babylonjs.com",g.GetAbsoluteUrl="object"==typeof document?e=>{let t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?e=>new URL(e,location.origin).href:()=>{throw Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},g.NoneLogLevel=n.Y.NoneLogLevel,g.MessageLogLevel=n.Y.MessageLogLevel,g.WarningLogLevel=n.Y.WarningLogLevel,g.ErrorLogLevel=n.Y.ErrorLogLevel,g.AllLogLevel=n.Y.AllLogLevel,g.IsWindowObjectExist=s.CG,g.PerformanceNoneLogLevel=0,g.PerformanceUserMarkLogLevel=1,g.PerformanceConsoleLogLevel=2,g.StartPerformanceCounter=g._StartPerformanceCounterDisabled,g.EndPerformanceCounter=g._EndPerformanceCounterDisabled;class m{constructor(e,t,i,r=0){this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=i}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(e,t,i,r=0){let s=new m(e,t,i,r);return s.executeNext(),s}static SyncAsyncForLoop(e,t,i,r,s,n=0){return m.Run(Math.ceil(e/t),r=>{s&&s()?r.breakLoop():setTimeout(()=>{for(let n=0;n<t;++n){let a=r.index*t+n;if(a>=e)break;if(i(a),s&&s()){r.breakLoop();break}}r.executeNext()},n)},r)}}g.Mix=f.V2,g.IsExponentOfTwo=f.lP,u.l.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},7724:function(e,t,i){i.d(t,{H7:function(){return s},qw:function(){return n}});let r={};function s(e,t){r[e]=t}function n(e){return r[e]}},73266:function(e,t,i){i.d(t,{K:function(){return r}});class r{static get UniqueId(){let e=this._UniqueIdCounter;return this._UniqueIdCounter++,e}}r._UniqueIdCounter=1},79114:function(e,t,i){i.d(t,{g:function(){return r}});class r{constructor(){this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(r.CustomRequestHeaders).length>0||r.CustomRequestModifiers.length>0}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(let e in r.CustomRequestHeaders){let t=r.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}}_shouldSkipRequestModifications(e){return r.SkipRequestModificationForBabylonCDN&&(e.includes("preview.babylonjs.com")||e.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(e){this._xhr.onprogress=e}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(e){this._xhr.responseType=e}get timeout(){return this._xhr.timeout}set timeout(e){this._xhr.timeout=e}addEventListener(e,t,i){this._xhr.addEventListener(e,t,i)}removeEventListener(e,t,i){this._xhr.removeEventListener(e,t,i)}abort(){this._xhr.abort()}send(e){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)}open(e,t){for(let e of r.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;e(this._xhr,t)}t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=t,this._xhr.open(e,t,!0)}setRequestHeader(e,t){this._xhr.setRequestHeader(e,t)}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}r.CustomRequestHeaders={},r.CustomRequestModifiers=[],r.SkipRequestModificationForBabylonCDN=!0},70214:function(e,t,i){i.d(t,{Q:function(){return o}});var r=i(49727),s=i(3176),n=i(7724),a=i(90212);class o extends r.D{getClassName(){return"PassPostProcess"}constructor(e,t,i=null,r,s,n,a=0,o=!1){super(e,"pass",null,null,t,i,r,s,n,void 0,a,void 0,null,o)}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([i.e(8974).then(i.bind(i,98974))]))):t.push(Promise.all([i.e(7534).then(i.bind(i,97534))])),super._gatherImports(e,t)}static _Parse(e,t,i,r){return a.p.Parse(()=>new o(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable),e,i,r)}}(0,n.H7)("BABYLON.PassPostProcess",o),s.a._RescalePostProcessFactory=e=>new o("rescale",1,null,2,e,!1,0)},49727:function(e,t,i){i.d(t,{D:function(){return p}});var r=i(46456),s=i(93287),n=i(82877),a=i(39884),o=i(97937),h=i(22287),l=i(90212),u=i(7724),c=i(83260),_=i(3176),d=i(61146);_.a.prototype.setTextureFromPostProcess=function(e,t,i){let r=null;t&&(t._forcedOutputTexture?r=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(r=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(e,r?.texture??null,i)},_.a.prototype.setTextureFromPostProcessOutput=function(e,t,i){this._bindTexture(e,t?._outputTexture?.texture??null,i)},o.Q.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},o.Q.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)};class p{static RegisterShaderCodeProcessing(e,t){if(!t){delete p._CustomShaderCodeProcessing[e??""];return}p._CustomShaderCodeProcessing[e??""]=t}static _GetShaderCodeProcessing(e){return p._CustomShaderCodeProcessing[e]??p._CustomShaderCodeProcessing[""]}get samples(){return this._samples}set samples(e){this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach(e=>{e.setSamples(this._samples)})}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))}set onSizeChanged(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)}set onApply(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(e){this._forcedOutputTexture=e}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(e,t,i,r,o,h,l=1,u,_,d=null,p=0,f="postprocess",g,m=!1,T=5,E,b){this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=0,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._shadersLoaded=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new s.t(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new a.FM(1,1),this._texelSize=a.FM.Zero(),this.onEffectCreatedObservable=new n.y$(void 0,!0),this.onActivateObservable=new n.y$,this.onSizeChangedObservable=new n.y$,this.onApplyObservable=new n.y$,this.onBeforeRenderObservable=new n.y$,this.onAfterRenderObservable=new n.y$,this._importPromises=[],this.name=e;let R=1,C=null;if(i&&!Array.isArray(i)){let e=i;i=e.uniforms??null,r=e.samplers??null,R=e.size??1,h=e.camera??null,l=e.samplingMode??1,u=e.engine,_=e.reusable,d=e.defines??null,p=e.textureType??0,f=e.vertexUrl??"postprocess",g=e.indexParameters,m=e.blockCompilation??!1,T=e.textureFormat??5,E=e.shaderLanguage??0,C=e.uniformBuffers??null,b=e.extraInitializations}else o&&(R="number"==typeof o?o:{width:o.width,height:o.height});null!=h?(this._camera=h,this._scene=h.getScene(),h.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):u&&(this._engine=u,this._engine.postProcesses.push(this)),this._options=R,this.renderTargetSamplingMode=l||1,this._reusable=_||!1,this._textureType=p,this._textureFormat=T,this._shaderLanguage=E||0,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=i||[],this._parameters.push("scale"),this._uniformBuffers=C||[],this._indexParameters=g,this._drawWrapper=new c.q(this._engine),this._webGPUReady=1===this._shaderLanguage,this._postConstructor(m,d,b)}_gatherImports(e=!1,t){e&&this._webGPUReady?t.push(Promise.all([i.e(6914).then(i.bind(i,60970))])):t.push(Promise.all([i.e(127).then(i.bind(i,50127))]))}_postConstructor(e,t=null,i){let r=this.getEngine().isWebGPU&&!p.ForceGLSL;this._gatherImports(r,this._importPromises),i&&i(r,this._importPromises),r&&this._webGPUReady&&(this._shaderLanguage=1),e||this.updateEffect(t)}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._drawWrapper.effect}shareOutputWith(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this}useOwnOutput(){0==this._textures.length&&(this._textures=new s.t(2)),this._shareOutputWithPostProcess=null}updateEffect(e=null,t=null,i=null,r,s,n,a,o){let h=p._GetShaderCodeProcessing(this.name);if(h?.defineCustomBindings){let r=t?.slice()??[];r.push(...this._parameters);let s=i?.slice()??[];s.push(...this._samplers),e=h.defineCustomBindings(this.name,e,r,s),t=r,i=s}this._postProcessDefines=e,this._drawWrapper.effect=this._engine.createEffect({vertex:a??this._vertexUrl,fragment:o??this._fragmentUrl},{attributes:["position"],uniformsNames:t||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:i||this._samplers,defines:null!==e?e:"",fallbacks:null,onCompiled:s??null,onError:n??null,indexParameters:r||this._indexParameters,processCodeAfterIncludes:h?.processCodeAfterIncludes?(e,t)=>h.processCodeAfterIncludes(this.name,e,t):null,processFinalCode:h?.processFinalCode?(e,t)=>h.processFinalCode(this.name,e,t):null,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0}},this._engine),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(e,t,i=0){for(let r=0;r<this._textureCache.length;r++)if(this._textureCache[r].texture.width===e.width&&this._textureCache[r].texture.height===e.height&&this._textureCache[r].postProcessChannel===i&&this._textureCache[r].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[r].texture.samples===t.samples)return this._textureCache[r].texture;let r=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:r,postProcessChannel:i,lastUsedRenderId:-1}),r}_flushTextureCache(){let e=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){let e=!1;for(let i=0;i<this._textures.length;i++)if(this._textures.data[i]===this._textureCache[t].texture){e=!0;break}e||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(e,t,i=null,r=!1,s=!1){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;let n=null;if(i){for(let e=0;e<i._postProcesses.length;e++)if(null!==i._postProcesses[e]){n=i._postProcesses[e];break}}let a={width:this.width,height:this.height},o={generateMipMaps:r,generateDepthBuffer:s||n===this,generateStencilBuffer:(s||n===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(a,o,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(a,o,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let e;if(this._shareOutputWithPostProcess)e=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let t;e=this.inputTexture;for(let i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture===e){t=this._textureCache[i];break}t&&(t.lastUsedRenderId=this._renderId)}return e}activate(e,t=null,i){let r=(e=e||this._camera).getScene(),s=r.getEngine(),n=s.getCaps().maxTextureSize,a=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,o=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,h=this._options.width||a,l=this._options.height||o,u=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode,c=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){let e=s.currentViewport;e&&(h*=e.width,l*=e.height)}(u||this.alwaysForcePOT)&&(this._options.width||(h=s.needPOTTextures?(0,d.p7)(h,n,this.scaleMode):h),this._options.height||(l=s.needPOTTextures?(0,d.p7)(l,n,this.scaleMode):l)),this.width===h&&this.height===l&&(c=this._getTarget())||this.resize(h,l,e,u,i),this._textures.forEach(e=>{e.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(e,this.samples)}),this._flushTextureCache(),this._renderId++}return c||(c=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(a/h,o/l),this._engine.bindFramebuffer(c,0,a,o,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(c,0,void 0,void 0,this.forceFullscreenViewport)),this._engine._debugInsertMarker?.(`post process ${this.name} input`),this.onActivateObservable.notifyObservers(e),this.autoClear&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:r.clearColor,r._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),c}get isSupported(){return this._drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._drawWrapper.effect?.isReady()??!1}apply(){let e;return this._drawWrapper.effect?.isReady()?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",e?.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),p._GetShaderCodeProcessing(this.name)?.bindCustomBindings?.(this.name,this._drawWrapper.effect),this._drawWrapper.effect):null}_disposeTextures(){if(this._shareOutputWithPostProcess||this._forcedOutputTexture){this._disposeTextureCache();return}this._disposeTextureCache(),this._textures.dispose()}_disposeTextureCache(){for(let e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0}setPrePassRenderer(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(e){let t;if(e=e||this._camera,this._disposeTextures(),this._scene&&-1!==(t=this._scene.postProcesses.indexOf(this))&&this._scene.postProcesses.splice(t,1),this._parentContainer){let e=this._parentContainer.postProcesses.indexOf(this);e>-1&&this._parentContainer.postProcesses.splice(e,1),this._parentContainer=null}if(-1!==(t=this._engine.postProcesses.indexOf(this))&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),0===(t=e._postProcesses.indexOf(this))&&e._postProcesses.length>0){let e=this._camera._getFirstPostProcess();e&&e.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){let e=l.p.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e}clone(){let e=this.serialize();e._engine=this._engine,e.cameraId=null;let t=p.Parse(e,this._scene,"");return t?(t.onActivateObservable=this.onActivateObservable.clone(),t.onSizeChangedObservable=this.onSizeChangedObservable.clone(),t.onApplyObservable=this.onApplyObservable.clone(),t.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),t.onAfterRenderObservable=this.onAfterRenderObservable.clone(),t._prePassEffectConfiguration=this._prePassEffectConfiguration,t):null}static Parse(e,t,i){let r=(0,u.qw)(e.customType);if(!r||!r._Parse)return null;let s=t?t.getCameraById(e.cameraId):null;return r._Parse(e,s,t,i)}static _Parse(e,t,i,r){return l.p.Parse(()=>new p(e.name,e.fragmentUrl,e.parameters,e.samplers,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable,e.defines,e.textureType,e.vertexUrl,e.indexParameters,!1,e.textureFormat),e,i,r)}}p.ForceGLSL=!1,p._CustomShaderCodeProcessing={},(0,r.gn)([(0,h.qC)()],p.prototype,"uniqueId",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"name",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"width",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"height",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"renderTargetSamplingMode",void 0),(0,r.gn)([(0,h.XX)()],p.prototype,"clearColor",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"autoClear",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"forceAutoClearInAlphaMode",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"alphaMode",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"alphaConstants",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"enablePixelPerfectMode",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"forceFullscreenViewport",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"scaleMode",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"alwaysForcePOT",void 0),(0,r.gn)([(0,h.qC)("samples")],p.prototype,"_samples",void 0),(0,r.gn)([(0,h.qC)()],p.prototype,"adaptScaleToCurrentViewport",void 0),(0,u.H7)("BABYLON.PostProcess",p)},11538:function(e,t,i){i.d(t,{O:function(){return n}});var r=i(93954),s=i(82877);class n{constructor(e){this._vertexBuffers={},this.onBeforeRenderObservable=new s.y$,this._scene=e}_prepareBuffers(){if(this._vertexBuffers[r.o.PositionKind])return;let e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[r.o.PositionKind]=new r.o(this._scene.getEngine(),e,r.o.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){let e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){let e=this._vertexBuffers[r.o.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(e=null,t=null){let i=this._scene.activeCamera;return!!(i&&(t=t||i._postProcesses.filter(e=>null!=e))&&0!==t.length&&this._scene.postProcessesEnabled)&&(t[0].activate(i,e,null!=t),!0)}directRender(e,t=null,i=!1,r=0,s=0,n=!1){let a=this._scene.getEngine();for(let o=0;o<e.length;o++){o<e.length-1?e[o+1].activate(this._scene.activeCamera,t?.texture):(t?a.bindFramebuffer(t,r,void 0,void 0,i,s):n||a.restoreDefaultFramebuffer(),a._debugInsertMarker?.(`post process ${e[o].name} output`));let h=e[o],l=h.apply();l&&(h.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,l),a.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(l))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(e,t,i,r,s=!1){let n=this._scene.activeCamera;if(!n||(this.onBeforeRenderObservable.notifyObservers(this),0===(r=r||n._postProcesses.filter(e=>null!=e)).length||!this._scene.postProcessesEnabled))return;let a=this._scene.getEngine();for(let o=0,h=r.length;o<h;o++){let l=r[o];if(o<h-1?l._outputTexture=r[o+1].activate(n,t?.texture):(t?(a.bindFramebuffer(t,i,void 0,void 0,s),l._outputTexture=t):(a.restoreDefaultFramebuffer(),l._outputTexture=null),a._debugInsertMarker?.(`post process ${r[o].name} output`)),e)break;let u=l.apply();u&&(l.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,u),a.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(u))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}dispose(){let e=this._vertexBuffers[r.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},86134:function(e,t,i){i.d(t,{S:function(){return n}});var r=i(93287),s=i(39884);class n{set opaqueSortCompareFn(e){e?this._opaqueSortCompareFn=e:this._opaqueSortCompareFn=n.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){e?this._alphaTestSortCompareFn=e:this._alphaTestSortCompareFn=n.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){e?this._transparentSortCompareFn=e:this._transparentSortCompareFn=n.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,t,i=null,s=null,n=null){this.index=e,this._opaqueSubMeshes=new r.t(256),this._transparentSubMeshes=new r.t(256),this._alphaTestSubMeshes=new r.t(256),this._depthOnlySubMeshes=new r.t(256),this._particleSystems=new r.t(256),this._spriteManagers=new r.t(256),this._empty=!0,this._edgesRenderers=new r.f(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=s,this.transparentSortCompareFn=n}render(e,t,i,r){if(e){e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}let s=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);let n=s.getStencilBuffer();if(s.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(s.setStencilBuffer(n),this._scene.useOrderIndependentTransparency){let e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);s.setAlphaMode(0)}if(s.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();s.setAlphaMode(0)}s.setStencilBuffer(n)}_renderOpaqueSorted(e){n._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){n._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){n._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,t,i,r){let a,o=0,h=i?i.globalPosition:n._ZeroVector;if(r)for(;o<e.length;o++)(a=e.data[o])._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=s.P.Distance(a.getBoundingInfo().boundingSphere.centerWorld,h);let l=e.length===e.data.length?e.data:e.data.slice(0,e.length);t&&l.sort(t);let u=l[0].getMesh().getScene();for(o=0;o<l.length;o++)if(a=l[o],!u._activeMeshesFrozenButKeepClipping||a.isInFrustum(u._frustumPlanes)){if(r){let e=a.getMaterial();if(e&&e.needDepthPrePass){let t=e.getScene().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),a.render(!1),t.setColorWrite(!0)}}a.render(r)}}static defaultTransparentSortCompare(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:n.backToFrontSortCompare(e,t)}static backToFrontSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(e,t){let i=e.getMesh(),r=t.getMesh();return i.material&&r.material?i.material.uniqueId-r.material.uniqueId:i.uniqueId-r.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(0===this._particleSystems.length)return;let t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){let r=this._particleSystems.data[i];if(0===(t&&t.layerMask&r.layerMask))continue;let s=r.emitter;s.position&&e&&-1===e.indexOf(s)||this._scene._activeParticles.addCount(r.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;let e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){let i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}n._ZeroVector=s.P.Zero()},15431:function(e,t,i){i.d(t,{$:function(){return n}});var r=i(86134);class s{}class n{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(let e of this._scene.meshes)if(e.subMeshes)for(let t of e.subMeshes)t._wasDispatched=!1;if(this._scene.spriteManagers)for(let e of this._scene.spriteManagers)e._wasDispatched=!1;for(let e of this._scene.particleSystems)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=[],this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new s,this._maintainStateBetweenFrames=!1,this._scene=e;for(let e=n.MIN_RENDERINGGROUPS;e<n.MAX_RENDERINGGROUPS;e++)this._autoClearDepthStencil[e]={autoClear:!0,depth:!0,stencil:!0}}getRenderingGroup(e){let t=e||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(e=!0,t=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)}render(e,t,i,r){let s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(let e=0;e<this._scene.spriteManagers.length;e++){let t=this._scene.spriteManagers[e];this.dispatchSprites(t)}for(let a=n.MIN_RENDERINGGROUPS;a<n.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===n.MIN_RENDERINGGROUPS;let o=this._renderingGroups[a];if(!o||o._empty)continue;let h=1<<a;if(s.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,h),n.AUTOCLEAR){let e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a];e&&e.autoClear&&this._clearDepthStencilBuffer(e.depth,e.stencil)}for(let e of this._scene._beforeRenderingGroupDrawStage)e.action(a);for(let s of(o.render(e,r,i,t),this._scene._afterRenderingGroupDrawStage))s.action(a);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,h)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=n.MIN_RENDERINGGROUPS;e<n.MAX_RENDERINGGROUPS;e++){let t=this._renderingGroups[e];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=n.MIN_RENDERINGGROUPS;e<n.MAX_RENDERINGGROUPS;e++){let t=this._renderingGroups[e];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=n.MIN_RENDERINGGROUPS;e<n.MAX_RENDERINGGROUPS;e++){let t=this._renderingGroups[e];t&&t.dispose()}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new r.S(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,t,i){void 0===t&&(t=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(e,t,i))}setRenderingOrder(e,t=null,i=null,r=null){if(this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]){let t=this._renderingGroups[e];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],t.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,t,i=!0,r=!0){this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:r}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}n.MAX_RENDERINGGROUPS=4,n.MIN_RENDERINGGROUPS=0,n.AUTOCLEAR=!0},28858:function(e,t,i){i.d(t,{Q:function(){return r}});class r{constructor(){this._blendFunctionParameters=[,,,,],this._blendEquationParameters=[,,],this._blendConstants=[,,,,],this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(e,t,i,r){(this._blendConstants[0]!==e||this._blendConstants[1]!==t||this._blendConstants[2]!==i||this._blendConstants[3]!==r)&&(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(e,t){(this._blendEquationParameters[0]!==e||this._blendEquationParameters[1]!==t)&&(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}},91887:function(e,t,i){i.d(t,{k:function(){return r}});class r{constructor(e=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}},83762:function(e,t,i){i.d(t,{s:function(){return r}});class r{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=r.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=r.KEEP,this.opDepthFail=r.KEEP,this.opStencilDepthPass=r.REPLACE}get stencilFunc(){return this.func}set stencilFunc(e){this.func=e}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(e){this.funcRef=e}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(e){this.funcMask=e}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(e){this.opStencilFail=e}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(e){this.opDepthFail=e}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(e){this.opStencilDepthPass=e}get stencilMask(){return this.mask}set stencilMask(e){this.mask=e}get stencilTest(){return this.enabled}set stencilTest(e){this.enabled=e}}r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681},89681:function(e,t,i){i.d(t,{C:function(){return r}});class r{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)}constructor(e=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}reset(){this.stencilMaterial=void 0,this.stencilGlobal?.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(e){if(!e)return;let t=!this.useStencilGlobalOnly&&!!this.stencilMaterial?.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}},5325:function(e,t,i){i.d(t,{r:function(){return r}});class r{}r._IsPickingAvailable=!1},67020:function(e,t,i){i.d(t,{N:function(){return c}});var r=i(46456),s=i(39884),n=i(22287),a=i(82877),o=i(51092),h=i(10633),l=i(90212);class u{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new a.y$,this._onClonedObservable=new a.y$}}class c{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,i,r){let s=this._NodeConstructors[e];return s?s(t,i,r):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;let t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){let t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._isDirty=!0,this._parentNode&&((void 0===this._parentNode._children||null===this._parentNode._children)&&(this._parentNode._children=[]),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){let e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e,t=null,i=!0){this._isDirty=!1,this._nodeDataStorage=new u,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new a.y$,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=s.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new a.y$,this._onDisposeObserver=null,this._behaviors=[],this.name=e,this.id=e,this._scene=t||o.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),i&&this._addToSceneRootNodes()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e,t=!1){return -1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(()=>{e.attach(this)}):e.attach(this),this._behaviors.push(e)),this}removeBehavior(e){let t=this._behaviors.indexOf(e);return -1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(e){for(let t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(e){!e&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return(!this._parentNode||!!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(e=!1){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(e=!0){return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(e=>{e._syncParentEnabledState()})}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}_getDescendants(e,t=!1,i){if(this._children)for(let r=0;r<this._children.length;r++){let s=this._children[r];(!i||i(s))&&e.push(s),t||s._getDescendants(e,!1,i)}}getDescendants(e,t){let i=[];return this._getDescendants(i,e,t),i}getChildMeshes(e,t){let i=[];return this._getDescendants(i,e,e=>(!t||t(e))&&void 0!==e.cullingStrategy),i}getChildren(e,t=!0){return this.getDescendants(t,e)}_setReady(e){if(e!==this._nodeDataStorage._isReady){if(!e){this._nodeDataStorage._isReady=!1;return}this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0}}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){let i=this.animations[t];if(i.name===e)return i}return null}createAnimationRange(e,t,i){if(!this._ranges[e]){this._ranges[e]=c._AnimationRangeFactory(e,t,i);for(let r=0,s=this.animations.length;r<s;r++)this.animations[r]&&this.animations[r].createRange(e,t,i)}}deleteAnimationRange(e,t=!0){for(let i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}clone(e,t,i){let r=l.p.Clone(()=>new c(e,this.getScene()),this);if(t&&(r.parent=t),!i){let t=this.getDescendants(!0);for(let i=0;i<t.length;i++){let s=t[i];s.clone(e+"."+s.name,r)}}return r}getAnimationRanges(){let e;let t=[];for(e in this._ranges)t.push(this._ranges[e]);return t}beginAnimation(e,t,i,r){let s=this.getAnimationRange(e);return s?this._scene.beginAnimation(this,s.from,s.to,t,i,r):null}serializeAnimationRanges(){let e=[];for(let t in this._ranges){let i=this._ranges[t];if(!i)continue;let r={};r.name=t,r.from=i.from,r.to=i.to,e.push(r)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=s.y3.Identity()),this._worldMatrix}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e)for(let i of this.getDescendants(!0))i.dispose(e,t);for(let e of(this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear(),this._behaviors))e.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,i){if(t.ranges)for(let i=0;i<t.ranges.length;i++){let r=t.ranges[i];e.createAnimationRange(r.name,r.from,r.to)}}getHierarchyBoundingVectors(e=!0,t=null){let i,r;if(this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){let e=this.getBoundingInfo();i=e.boundingBox.minimumWorld.clone(),r=e.boundingBox.maximumWorld.clone()}else i=new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(let e of this.getDescendants(!1)){if(e.computeWorldMatrix(!0),t&&!t(e)||!e.getBoundingInfo||0===e.getTotalVertices())continue;let n=e.getBoundingInfo().boundingBox,a=n.minimumWorld,o=n.maximumWorld;s.P.CheckExtends(a,i,r),s.P.CheckExtends(o,i,r)}return{min:i,max:r}}}c._AnimationRangeFactory=(e,t,i)=>{throw(0,h.S)("AnimationRange")},c._NodeConstructors={},(0,r.gn)([(0,n.qC)()],c.prototype,"name",void 0),(0,r.gn)([(0,n.qC)()],c.prototype,"id",void 0),(0,r.gn)([(0,n.qC)()],c.prototype,"uniqueId",void 0),(0,r.gn)([(0,n.qC)()],c.prototype,"state",void 0),(0,r.gn)([(0,n.qC)()],c.prototype,"metadata",void 0)},32253:function(e,t,i){i.d(t,{H:function(){return s},l:function(){return r}});class r{}r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="ParticleSystem",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_PREPASSRENDERER="PrePassRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",r.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_SUBSURFACE="SubSurface",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Octree",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.NAME_FLUIDRENDERER="FluidRenderer",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_PREPASS=0,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_LAYER=2,r.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,r.STEP_BEFORERENDERTARGETDRAW_LAYER=1,r.STEP_BEFORERENDERINGMESH_PREPASS=0,r.STEP_BEFORERENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGMESH_PREPASS=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_BEFORECLEAR_PREPASS=1,r.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,r.STEP_AFTERRENDERTARGETDRAW_LAYER=1,r.STEP_AFTERCAMERADRAW_PREPASS=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,r.STEP_AFTERCAMERADRAW_LAYER=4,r.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,r.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,r.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0;class s extends Array{constructor(e){super(...e)}static Create(){return Object.create(s.prototype)}registerStep(e,t,i){let r=0;for(;r<this.length&&!(e<this[r].index);r++);this.splice(r,0,{index:e,component:t,action:i.bind(t)})}clear(){this.length=0}}},46456:function(e,t,i){i.d(t,{gn:function(){return r}});function r(e,t,i,r){var s,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}}}]);