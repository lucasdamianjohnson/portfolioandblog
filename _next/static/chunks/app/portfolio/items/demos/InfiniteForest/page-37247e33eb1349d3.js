(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{22327:function(e,t,i){Promise.resolve().then(i.bind(i,81523)),Promise.resolve().then(i.bind(i,70049)),Promise.resolve().then(i.bind(i,16602)),Promise.resolve().then(i.t.bind(i,4738,23)),Promise.resolve().then(i.t.bind(i,20123,23))},16602:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return x}});var s=i(57437),r=i(2265),o=i(79290),a=i(51914),n=i(84493),d=i(86),l=i(55754),h=i(83542),m=i(55281),c=i(80130),g=i(7610),p=i(77606),w=i(84270);class u{setSeed(e){this.z=this.seed=(null==e?Math.random()*this.m:e)>>>0}getSeed(){return this.seed}rand(){return this.z=(this.a*this.z+this.c)%this.m,this.z/this.m}constructor(e){this.seed=e,this.m=4294967296,this.a=1664525,this.c=1013904223,this.z=0,this.setSeed(e)}}var f=i(33748);console.warn(a,n.e);class v{dispose(){this.mesh&&(this.scene.remove(this.mesh),this.mesh.geometry.dispose(),this.grassMaterial.dispose())}constructor({worker:e,bladeCount:t,bladeWidth:i,bladeHeight:s,grassTexture:r,noiseScale:a,noiseAmplitude:n,chunkX:d,chunkZ:l,gridSize:h,scene:m}){this.mesh=null,this.bladeCount=t,this.scene=m,this.bladeWidth=i,this.bladeHeight=s,this.grassMaterial=new o.MeshStandardMaterial({map:r,side:o.DoubleSide});let c=crypto.randomUUID(),g=t=>{let{data:i}=t;if("set-grass"==i[0]&&i[1]==c){e.removeEventListener("message",g);let{positions:t,uvs:s,colors:r,indices:a}=i[2],n=new o.BufferGeometry;n.setAttribute("position",new o.BufferAttribute(t,3)),n.setAttribute("uv",new o.BufferAttribute(s,2)),n.setAttribute("color",new o.BufferAttribute(r,3)),n.setIndex(new o.BufferAttribute(a,1)),n.computeVertexNormals(),this.mesh=new o.Mesh(n,this.grassMaterial),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.scene.add(this.mesh)}};e.addEventListener("message",g),e.postMessage(["make-grass",c,d,l,h,a,n,i,s])}}class S{static async loadTrees(){let e=new p.E,t=S.treePaths.map(t=>e.loadAsync(t).then(e=>{e.scene.traverse(e=>{e.material&&(e.material.side=o.FrontSide)});let t=e.scene.children[0];S.loadedTrees.push(t)}));await Promise.all(t)}placeTrees(e,t,i){let s=this.gridSize/2,r=0;for(let s of S.loadedTrees){if(r>40)break;let a=new o.InstancedMesh(s.geometry,s.material,10);a.castShadow=!0,a.receiveShadow=!0;let n=0,d=2*Math.random()+.5;for(let s=this.chunkZ*this.gridSize;s<this.chunkZ*this.gridSize+this.gridSize;s+=d){if(Math.random()>.8)continue;r++;let d=3*Math.random();a.setMatrixAt(n,new o.Matrix4().makeTranslation(this.chunkX*this.gridSize-this.gridSize+d+10,e(this.chunkX*this.gridSize*t,s*t,0)*i-1,s)),n++,a.setMatrixAt(n,new o.Matrix4().makeTranslation(this.chunkX*this.gridSize+this.gridSize-d-10,e((this.chunkX*this.gridSize+this.gridSize)*t,s*t,0)*i-1,s)),n++}this.scene.add(a),this.trees.push(a)}for(let r of S.loadedTrees){let a=new o.InstancedMesh(r.geometry,r.material,10);a.castShadow=!0,a.receiveShadow=!0;for(let r=0;r<10;r++){let n=this.chunkX*this.gridSize+Math.random()*this.gridSize-s,d=this.chunkZ*this.gridSize+Math.random()*this.gridSize-s,l=e(n*t,d*t,0)*i;if(l<3)continue;let h=new o.Matrix4().makeTranslation(n,l-1,d);a.setMatrixAt(r,h)}this.scene.add(a),this.trees.push(a)}}dispose(){for(let e of this.trees)this.scene.remove(e),e.dispose();this.trees=[]}constructor({noiseScale:e,noiseAmplitude:t,noiseFunction:i,chunkX:s,chunkZ:r,gridSize:o,scene:a}){this.trees=[],this.scene=a,this.chunkX=s,this.chunkZ=r,this.gridSize=o,S.loadedTrees.length>0&&this.placeTrees(i,e,t)}}S.treePaths=["/assets/InfiniteForest/trees/1.gltf","/assets/InfiniteForest/trees/2.gltf","/assets/InfiniteForest/trees/3.gltf","/assets/InfiniteForest/trees/4.gltf","/assets/InfiniteForest/trees/5.gltf"],S.loadedTrees=[];var x=()=>{let e=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let t=new Worker(i.tu(new URL(i.p+i.u(1693),i.b))),s=new o.Scene,r=new o.PerspectiveCamera(30,window.innerWidth/window.innerHeight,.01,1e3);r.position.set(0,11,-300),r.rotation.x=-.02;let a=new o.WebGLRenderer({canvas:e.current,antialias:!0});a.setSize(window.innerWidth,window.innerHeight),a.setPixelRatio(Math.max(1,window.devicePixelRatio/2)),a.setClearColor(0,1),a.shadowMap.enabled=!0,a.shadowMap.autoUpdate=!0,a.shadowMap.type=o.PCFSoftShadowMap;let n=new w.m(r,a.domElement);n.movementSpeed=200,n.rollSpeed=Math.PI/24,n.dragToLook=!0;let p=new d.x(a);p.addPass(new l.C(s,r));let x=new h.m(new o.Vector2(window.innerWidth,window.innerHeight),1.25,.4,.98);p.addPass(x);let M=new m.t(0,.025,648,!1);p.addPass(M);let b=new f.A(s,r,{focus:100,aperture:25e-6,maxblur:.1});p.addPass(b);let z=new o.AmbientLight(16777215,.4);s.add(z);let C=new o.DirectionalLight(16777215,4);s.add(C.target),C.castShadow=!0,C.shadow.bias=.01,C.shadow.bias=-.0001,C.shadow.normalBias=.05,C.shadow.mapSize.width=4096,C.shadow.mapSize.height=4096,C.shadow.camera.near=.5,C.shadow.camera.far=500;let y=r.aspect;C.shadow.camera.left=-500*y,C.shadow.camera.right=500*y,C.shadow.camera.top=500,C.shadow.camera.bottom=-500,C.shadow.camera.updateProjectionMatrix(),s.add(C);let P=new o.CameraHelper(C.shadow.camera);s.add(P);let k=new o.CubeTextureLoader().load(["/assets/InfiniteForest/px.jpg","/assets/InfiniteForest/nx.jpg","/assets/InfiniteForest/py.jpg","/assets/InfiniteForest/ny.jpg","/assets/InfiniteForest/pz.jpg","/assets/InfiniteForest/nz.jpg"]);s.background=k;let F={uniforms:{topColor:{value:new o.Color(7566716)},bottomColor:{value:new o.Color(16777215)},heightCutoff:{value:200}},vertexShader:"\n        varying vec3 vWorldPosition;\n        void main() {\n          vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n          vWorldPosition = worldPosition.xyz;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform vec3 topColor;\n        uniform vec3 bottomColor;\n        uniform float heightCutoff;\n        varying vec3 vWorldPosition;\n    \n        void main() {\n          float heightFactor = smoothstep(0.0, heightCutoff, vWorldPosition.y);\n          gl_FragColor = vec4(mix(bottomColor, topColor, heightFactor), 1.0);\n        }\n      ",side:o.BackSide},T=new o.ShaderMaterial(F),I=new o.BoxGeometry(800,5e3,800),A=new o.Mesh(I,T);A.position.z=-600,s.add(A);let E=new o.TextureLoader,H=E.load("/assets/InfiniteForest/dirt.png"),W=E.load("/assets/InfiniteForest/grass.png"),B=E.load("/assets/InfiniteForest/grass.png");H.wrapS=H.wrapT=o.RepeatWrapping,W.wrapS=W.wrapT=o.RepeatWrapping,a.toneMapping=o.ACESFilmicToneMapping;let R=new o.MeshStandardMaterial({map:H});R.onBeforeCompile=e=>{e.uniforms.grassTexture={value:W},e.uniforms.lowerHeight={value:-5},e.uniforms.upperHeight={value:0},e.vertexShader=e.vertexShader.replace("#include <common>","#include <common>\n          varying float vHeight;\n          varying vec2 vUv;\n        "),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","#include <begin_vertex>\n          vUv = uv;\n          vHeight = position.z;\n        "),e.fragmentShader=e.fragmentShader.replace("#include <common>","#include <common>\n          uniform sampler2D grassTexture;\n          uniform float lowerHeight;\n          uniform float upperHeight;\n          varying float vHeight;\n          varying vec2 vUv;\n        "),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","\n          // Normalize the height for blending\n          float t = smoothstep(lowerHeight, upperHeight, vHeight);\n          \n          // Sample both textures\n          vec4 dirtColor = texture2D(map, vUv * 10.0); // Dirt texture\n          vec4 grassColor = texture2D(grassTexture, vUv * 10.0); // Grass texture\n          \n    // Convert sampled colors to linear space\ndirtColor.rgb = pow(dirtColor.rgb, vec3(2.2)); // sRGB to linear for dirt texture\ngrassColor.rgb = pow(grassColor.rgb, vec3(2.2)); // sRGB to linear for grass texture\n\n// Blend textures based on height\nvec4 finalColor = mix(dirtColor, grassColor, t);\n\n// Convert final color back to sRGB before setting it\nfinalColor.rgb = pow(finalColor.rgb, vec3(1.0 / 2.2));\n\n// Set the final color\ndiffuseColor = finalColor;\n        ")};let _=new o.Color(16777215);s.fog=new o.Fog(_,.00105);let j=Math.random()*Number.MAX_SAFE_INTEGER>>0,L=new u(j),G=(0,g.zz)(()=>L.rand());t.postMessage(["set-seed",j]);let U=(e,t)=>"".concat(e,"_").concat(t),D=new Map,N=(e,i)=>{let r=new o.PlaneGeometry(300,300,50,50),a=new o.Mesh(r,R);a.receiveShadow=!0,a.castShadow=!1;let n=a.geometry.attributes.position;for(let t=0;t<n.count;t++){let s=10*G((n.getX(t)+300*e)*.015,(0-n.getY(t)+300*i)*.015,0);n.setZ(t,s)}a.rotation.x=-Math.PI/2,a.position.x=300*e,a.position.z=300*i,n.needsUpdate=!0,a.geometry.computeVertexNormals(),s.add(a);let d=new o.PlaneGeometry(300,300),l=new c.B(d,{textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,waterNormals:E.load("/assets/InfiniteForest/water.jpg",e=>{e.wrapS=e.wrapT=o.RepeatWrapping}),sunDirection:C.position.clone().normalize(),sunColor:16777215,waterColor:7855,distortionScale:10,fog:void 0!==s.fog,time:1});l.receiveShadow=!0,l.rotation.x=-Math.PI/2,l.position.x=300*e,l.position.z=300*i,l.position.y=0,s.add(l);let h=new v({worker:t,bladeCount:24e3,bladeWidth:1,bladeHeight:2,noiseScale:.015,noiseAmplitude:10,scene:s,grassTexture:B,chunkX:e,chunkZ:i,gridSize:300});return{mesh:a,waterMesh:l,trees:new S({noiseScale:.015,noiseAmplitude:10,noiseFunction:G,scene:s,chunkX:e,chunkZ:i,gridSize:300}),grass:h,x:e,z:i}},X=()=>{let e=Math.floor(r.position.x/300),t=Math.floor(r.position.z/300);for(let i=t;i>t-3-1;i--){let t=U(e,i);if(!D.has(t)){let s=N(e,i);D.set(t,s)}}D.forEach((i,r)=>{(i.x<e-3||i.x>e+3||i.z<t-6||i.z>t+3)&&(s.remove(i.mesh),i.mesh.geometry.dispose(),i.mesh.material.dispose(),i.waterMesh&&(s.remove(i.waterMesh),i.waterMesh.geometry.dispose(),i.waterMesh.material.dispose()),s.remove(i.grass.mesh),i.grass.dispose(),i.trees.dispose(),D.delete(r))})};(async()=>{await S.loadTrees(),X();let e=new o.Vector3(0,200,100),t=new o.Clock;r.position.z=-10;let i=()=>{requestAnimationFrame(i);let s=t.getDelta();t.getElapsedTime(),D.forEach(e=>{e.waterMesh.material.uniforms.time.value+=.03}),A.position.z-=80*s,r.position.z-=80*s,C.target.position.set(r.position.x,0,r.position.z),C.position.copy(C.target.position).add(e),X(),p.render()};i()})();let V=()=>{let e=window.innerWidth,t=window.innerHeight;r.aspect=e/t,r.updateProjectionMatrix(),a.setSize(e,t)};return window.addEventListener("resize",V),()=>{window.removeEventListener("resize",V),a.dispose(),D.forEach(e=>{s.remove(e.mesh),e.mesh.geometry.dispose(),e.mesh.material.dispose(),e.waterMesh&&(s.remove(e.waterMesh),e.waterMesh.geometry.dispose(),e.waterMesh.material.dispose()),s.remove(e.grass.mesh),e.grass.dispose()}),D.clear(),s.traverse(e=>{if(e.geometry&&e.geometry.dispose(),e.material){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):t.dispose()}})}},[]),(0,s.jsx)("canvas",{ref:e,style:{width:"100%",height:"100%",display:"block"}})}},4738:function(){},20123:function(){}},function(e){e.O(0,[8685,5889,225,6762,7122,3590,2025,813,154,536,545,944,4233,1914,2971,2117,1744],function(){return e(e.s=22327)}),_N_E=e.O()}]);