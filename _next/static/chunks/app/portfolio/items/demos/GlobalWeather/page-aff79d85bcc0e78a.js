(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3731],{95151:function(e,t,i){Promise.resolve().then(i.bind(i,81523)),Promise.resolve().then(i.bind(i,70049)),Promise.resolve().then(i.bind(i,17651)),Promise.resolve().then(i.t.bind(i,61268,23)),Promise.resolve().then(i.t.bind(i,20123,23))},17651:function(e,t,i){"use strict";i.r(t);var n=i(57437),a=i(2265),s=i(79290),r=i(37954),o=i(56503),l=i(93162),h=i(7475);class d{getIndex(e,t,i){return e*this.latDim*this.lonDim+t*this.lonDim+i}isRaining(e,t,i){let n=this.getIndex(e,t,i);return this.data[n]>0}getData(e,t,i){let n=this.getIndex(e,t,i);return this.data[n]}getRainyPoints(e){let t=[],i=this.shape[3],n=this.shape[4];for(let a=0;a<i;a++)for(let i=0;i<n;i++)this.isRaining(e,a,i)&&t.push({latIndex:a,lonIndex:i,value:this.getData(e,a,i)});return t}constructor(e,t){this.totalTime=0,this.timeOrder=[],this.data=e,this.shape=t;let i=this.shape[3],n=this.shape[4];this.totalTime=e.length/(i*n),this.latDim=i,this.lonDim=n,this.timeIndex=h.kS.GetXYZOrder(),this.timeIndex.setBounds(t[0],t[1],t[2]);let[a,s,r]=[t[0],t[1],t[2]];for(let e=0;e<30;e++)this.timeOrder.push(e);console.warn(this.timeOrder);let o=[0,5,10,1,6,11,2,7,12,3,8,13,4,9,14].reverse();o.push(...o.map(e=>e+15)),this.timeOrder=o}}async function p(){let{FS:e}=await l.eN.ready,t=await fetch("/assets/GlobalWeather/data.HDF5"),i=await t.arrayBuffer();e.writeFile("data.HDF5",new Uint8Array(i));let n=new l.eN.File("data.HDF5","r").get("GRID/precipPixel");return new d(n.value,n.shape)}t.default=()=>{let e=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let t,i,n,a,l,h,d;let u=[],c=[],w=-1,m=Date.now();t=new s.Scene;let g=new s.CubeTextureLoader().load(["/assets/PopulationDensity/px.jpg","/assets/PopulationDensity/nx.jpg","/assets/PopulationDensity/py.jpg","/assets/PopulationDensity/ny.jpg","/assets/PopulationDensity/pz.jpg","/assets/PopulationDensity/nz.jpg"]);if(t.background=g,(i=new s.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3)).position.z=300,e.current){(n=new s.WebGLRenderer({canvas:e.current,antialias:!0})).setSize(window.innerWidth,window.innerHeight),(h=new r.z(i,n.domElement)).enableDamping=!0,h.dampingFactor=.05,h.minDistance=100,h.maxDistance=500;let g=new s.AmbientLight(16777215,.5);t.add(g);let y=new s.DirectionalLight(16777215,.5);y.position.set(5,10,7.5),t.add(y);let v=new o.xC(n),b=new o.CD(t,i);v.addPass(b);let D=new o.gh(t,i);v.addPass(D);let P=new o.bn(i,D.texture,{blendFunction:o.YQ.MULTIPLY,samples:21,rings:4,distanceThreshold:.1,distanceFalloff:.02,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.7,radius:20,intensity:15,bias:.05}),x=new o.H5(i,P);function f(){let e=window.innerWidth,t=window.innerHeight;i.aspect=e/t,i.updateProjectionMatrix(),n.setSize(e,t),v.setSize(e,t)}x.renderToScreen=!0,v.addPass(x),window.addEventListener("resize",f,!1);let M=new s.TextureLoader,S=new s.SphereGeometry(50,128,128),C=new s.SphereGeometry(50,128,128),F=new s.SphereGeometry(50,128,128),U=new s.ShaderMaterial({vertexShader:"\n          varying vec4 vColor;\n          void main() {\n            vColor = color;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n          }\n        ",fragmentShader:"\n          varying vec4 vColor;\n          void main() {\n            gl_FragColor = vColor;\n          }\n        ",transparent:!0,side:s.DoubleSide,vertexColors:!0}),I=new s.Mesh(S,U),R=new Float32Array(4*S.attributes.position.count),j=new s.BufferAttribute(R,4);S.setAttribute("color",j);let z=!1,E=document.createElement("canvas");E.width=1440,E.height=720;let G=E.getContext("2d",{willReadFrequently:!0}),L=new Map,O=e=>{let t=L.get(c[e]);t||(G.drawImage(c[e],0,0),t=G.getImageData(0,0,E.width,E.height),L.set(c[e],t));let i=S.attributes.uv,n=S.attributes.position,a=S.attributes.color,r=a.array,o=E.width,l=E.height,h=new s.Color(15),d=new s.Color(65520),p=C.attributes.position,u=F.attributes.position,w=new s.Vector3;for(let e=0;e<n.count;e++){w.fromBufferAttribute(p,e);let n=s.MathUtils.clamp(i.getX(e),0,1),a=s.MathUtils.clamp(i.getY(e),0,1),c=Math.floor(n*(o-1)),m=Math.floor((1-a)*(l-1))*o+c,g=t.data[4*m+3];g||(g=0);let f=Math.min(g/255*.5,1);w.multiplyScalar(1+f),u.setXYZ(e,w.x,w.y,w.z),new s.Color().lerpColors(h,d,f),r[4*e]=0,r[4*e+1]=255*f,r[4*e+2]=255*f,r[4*e+3]=0==g?0:.1}a.needsUpdate=!0,n.needsUpdate=!0,S.attributes.color.needsUpdate=!0,B=new k(n,u)},T=M.load("/assets/PopulationDensity/bluemarble.jpg"),A=new s.SphereGeometry(50,64,64),_=new s.MeshPhongMaterial({map:T,shininess:100,wireframe:!1});a=new s.Mesh(A,_),t.add(a);let H=new s.SphereGeometry(51,64,64),Y=new s.MeshBasicMaterial({map:null,transparent:!0,opacity:.5,side:s.DoubleSide,blending:s.AdditiveBlending});l=new s.Mesh(H,Y),t.add(l);class k{run(e){if(this.alpha>1){B=null;return}this.alpha+=e,this.alpha=Math.min(1,Math.max(0,this.alpha));for(let e=0;e<this.positions.count;e++){let t=this.originalPositions[3*e],i=this.originalPositions[3*e+1],n=this.originalPositions[3*e+2],a=this.newPositions.getX(e),r=this.newPositions.getY(e),o=this.newPositions.getZ(e),l=s.MathUtils.lerp(t,a,this.alpha),h=s.MathUtils.lerp(i,r,this.alpha),d=s.MathUtils.lerp(n,o,this.alpha);this.positions.setXYZ(e,l,h,d)}this.positions.needsUpdate=!0}constructor(e,t){this.alpha=0,this.positions=e,this.newPositions=t,this.originalPositions=new Float32Array(3*e.count),this.originalPositions.set(e.array)}}let B=null,N=()=>{requestAnimationFrame(N),h.update(),B&&B.run(.1);let e=Date.now();e-m>500&&(u.length>0&&(w=(w+1)%d.timeOrder.length,l.material.map=u[d.timeOrder[w]],l.material.needsUpdate=!0,O(d.timeOrder[w]),z||(t.add(I),z=!0)),m=e),v.render()};N();let W=(e,t)=>{let i=document.createElement("canvas");i.width=1440,i.height=720;let n=i.getContext("2d");if(!n)return null;console.log(e.lonDim,e.latDim),n.fillRect(0,0,2,2),n.fillStyle="rgba(255, 255, 255, 0.5)",t.forEach(t=>{let a=t.latIndex/e.latDim*i.width,s=t.lonIndex/e.lonDim*i.height,r=t.value;n.fillStyle="rgb(0, ".concat(r/30*255,", 0)"),n.fillRect(a,s,2,2)});let a=new Image(i.width,i.height);a.src=i.toDataURL("image/png"),c.push(a);let r=new s.Texture(i);return r.needsUpdate=!0,r};return(async()=>{console.warn("Reading file..."),d=await p(),console.log("File read successfully.");let e=d.totalTime;for(let t=0;t<e;t++){let e=d.getRainyPoints(t),i=W(d,e);i&&(u[t]=i)}console.log("Generated ".concat(u.length," rain textures."))})(),()=>{window.removeEventListener("resize",f),n.dispose(),h.dispose(),t.remove(a),t.remove(l),A.dispose(),_.dispose(),l.material.map&&l.material.map.dispose(),l.geometry.dispose()}}},[]),(0,n.jsx)("canvas",{ref:e})}},61268:function(){},20123:function(){}},function(e){e.O(0,[1841,5889,225,7455,201,154,4625,2971,2117,1744],function(){return e(e.s=95151)}),_N_E=e.O()}]);