(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[559],{65618:function(e,t,i){Promise.resolve().then(i.bind(i,81523)),Promise.resolve().then(i.bind(i,70049)),Promise.resolve().then(i.bind(i,17555)),Promise.resolve().then(i.t.bind(i,64162,23)),Promise.resolve().then(i.t.bind(i,20123,23))},17555:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return H}});var r=i(57437),s=i(29723);class n{}n.pixelSize=.001,n.maxPatternTiles=2e3,n.tileSetTileSize=[32,32],n.tileSetPixelSize=[256,256],n.tilePixelSize=[8,8],n.tileMeterSize=[n.tilePixelSize[0]*n.pixelSize,n.tilePixelSize[1]*n.pixelSize],n.rendererTileSize=[58,32],n.rendererMeterSize=[n.rendererTileSize[0]*n.tilePixelSize[0]*n.pixelSize,n.rendererTileSize[1]*n.tilePixelSize[0]*n.pixelSize],n.chunkTileSize=[32,32],n.chunkMeterSize=[n.chunkTileSize[0]*n.tilePixelSize[0]*n.pixelSize,n.chunkTileSize[1]*n.tilePixelSize[0]*n.pixelSize];class a{setPosition(e,t){this.position.set(e,t),this._camera.position.x=e*n.pixelSize+n.rendererMeterSize[0]/2,this._camera.position.y=t*n.pixelSize+n.rendererMeterSize[1]/2}constructor(e){this.position=new s.FM8,this.scene=e;let t=new s.cEJ("PerspectiveCamera",new s.Pa4(0,0,-10),this.scene);this._camera=t,t.mode=s.V1s.PERSPECTIVE_CAMERA,t.setTarget(s.Pa4.Zero()),t.minZ=1e-4,t.maxZ=1e3,this.planeWidth=n.tilePixelSize[0]*n.pixelSize*n.rendererTileSize[0],this.planeHeight=n.tilePixelSize[1]*n.pixelSize*n.rendererTileSize[1];let i=2*Math.atan(this.planeHeight/2/10);t.fov=i,t.rotation.y=2*Math.PI,this.setPosition(0,0)}}var o=i(36600);class l{static Create(e){let t=n.chunkTileSize[0]*n.chunkTileSize[1];return new l({layerId:e.layerId?e.layerId:0,tiles:e.tiles?e.tiles:new Uint16Array(t),tileStates:e.tileStates?e.tileStates:new Uint8Array(t),textures:e.textures?e.textures:new Uint16Array(t),states:e.states?e.states:new Uint16Array(t),colors:e.colors?e.colors:new Uint32Array(t)})}toJSON(){return{layerId:this.layerId?this.layerId:0,tiles:this.tiles,tileStates:this.tileStates,textures:this.textures,states:this.states,colors:this.colors}}constructor(e){this.layerId=e.layerId,this.tiles=e.tiles,this.tileStates=e.tileStates,this.textures=e.textures,this.states=e.states,this.colors=e.colors}}class h{static Create(e){return{layers:e.layers?e.layers:[],position:e.position?e.position:[0,0]}}addLayer(e){return this.layers[e]=new l(l.Create({layerId:e})),!0}toJSON(){return{layers:Object.fromEntries(Object.keys(this.layers).map(e=>[e,this.layers[Number(e)].toJSON()])),position:[...this.position]}}constructor(e){this.layers=Object.fromEntries(Object.keys(e.layers).map(t=>[t,new l(e.layers[Number(t)])])),this.position=e.position}}class d{static Create(e){return{id:e.id?e.id:"main",chunks:e.chunks?e.chunks:[]}}constructor(e){this.chunks=[],this.data=e,this.id=e.id,this.chunks=e.chunks.map(e=>new h(e))}}class c{static getWorldPosition(e,t){return this._position.x=n.tileMeterSize[0]*e,this._position.y=n.tileMeterSize[1]*t,this._position}static getTilePosition(e,t){return this._position.x=Math.floor(e/n.tileMeterSize[0]),this._position.y=Math.floor(t/n.tileMeterSize[1]),this._position}static getChunkPositionArray(e){return[Math.floor(e[0]/n.chunkMeterSize[0]),Math.floor(e[1]/n.chunkMeterSize[1])]}static getChunkPositionVec3(e){return this._position.x=Math.floor(e.x/n.chunkTileSize[0]),this._position.y=Math.floor(e.y/n.chunkTileSize[1]),this._position}static getChunkPositionXY(e,t){return this._position.x=Math.floor(e/n.chunkTileSize[0]),this._position.y=Math.floor(t/n.chunkTileSize[1]),this._position}static getTilePositionArray(e){return[(e[0]%n.chunkTileSize[0]+n.chunkTileSize[0])%n.chunkTileSize[0],(e[1]%n.chunkTileSize[1]+n.chunkTileSize[1])%n.chunkTileSize[1]]}static getTilePositionVec3(e){return this._position.x=(e.x%n.chunkTileSize[0]+n.chunkTileSize[0])%n.chunkTileSize[0],this._position.y=(e.y%n.chunkTileSize[1]+n.chunkTileSize[1])%n.chunkTileSize[1],this._position}static getTilePositionXY(e,t){return this._position.x=(e%n.chunkTileSize[0]+n.chunkTileSize[0])%n.chunkTileSize[0],this._position.y=(t%n.chunkTileSize[1]+n.chunkTileSize[1])%n.chunkTileSize[1],this._position}static getTileIndexArray(e){let t=this.getTilePositionArray(e);return this.chunkTileIndex.getIndexXY(t[0],t[1])}static getTileIndexVec3(e){let t=this.getTilePositionVec3(e);return this.chunkTileIndex.getIndexXY(t.x,t.y)}static getTileIndexXY(e,t){let i=this.getTilePositionXY(e,t);return this.chunkTileIndex.getIndexXY(i.x,i.y)}}c._position=o.Ji.Create(),c.chunkTileIndex=o.h7.GetXYOrder(),c.chunkTileIndex.setBounds(n.chunkTileSize[0],n.chunkTileSize[1]);class u{static createWorld(e){this.worlds.set(e.id,new d(e))}static setWrold(e){let t=this.worlds.get(e);if(!t)throw Error("World with ".concat(e," id does not exist"));this.activeWorld=t}static getChunk(e,t){if(!this.activeWorld)throw Error("A world must be set.");let i=c.getChunkPositionXY(e,t),r=this.activeWorld.chunks[o.Yp.HashXYZ(i.x,i.y,0)];return!!r&&r}static setChunk(e,t,i,r){let s=this.worlds.get(e);if(!s)throw Error("World with ".concat(e," does not exist"));let n=c.getChunkPositionXY(t,i);s.chunks[o.Yp.HashXYZ(n.x,n.y,0)]=r}}function f(e){let t=new s.Kj0("tile-quad",e),i=n.tileMeterSize;t.setVerticesData(s.oZy.PositionKind,[i[0],i[1],0,0,i[1],0,0,0,0,i[0],0,0]),t.setVerticesData(s.oZy.NormalKind,[0,0,1,0,0,1,0,0,1,0,0,1]);let r=[1,0,0,0,0,1,1,1],a=[0,0,0,1,1,1,1,0],o=[0,1,1,1,1,0,0,0],l=[1,1,1,0,0,0,0,1],h=[];for(let e=0;e<r.length;e++)h[e]=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t)if(0!==e&&1!==e)throw Error("Invalid bit value: ".concat(e,". Only 0 or 1 are allowed."));let r=0;for(let e of t)r=r<<1|e;return r}(l[e],o[e],a[e],r[e]);return t.setVerticesData(s.oZy.UVKind,h),t.setIndices([0,1,2,2,3,0]),t}u.worlds=new Map,u.activeWorld=null;let x={IDENTITY_MATRIX:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};class p{setIdentityMatrix(e){for(let t=0;t<16;t++)this.matrices[e+t]=x.IDENTITY_MATRIX[t%16]}setMatricesIndex(e){return this.index=e,this.trueIndex=16*e,this}get positionX(){return this.matrices[this.trueIndex+p.MATRIX_INDEXES.POSITION_X]}set positionX(e){this.matrices[this.trueIndex+p.MATRIX_INDEXES.POSITION_X]=e}get positionY(){return this.matrices[this.trueIndex+p.MATRIX_INDEXES.POSITION_Y]}set positionY(e){this.matrices[this.trueIndex+p.MATRIX_INDEXES.POSITION_Y]=e}get positionZ(){return this.matrices[this.trueIndex+p.MATRIX_INDEXES.POSITION_Z]}set positionZ(e){this.matrices[this.trueIndex+p.MATRIX_INDEXES.POSITION_Z]=e}setPosition(e,t,i){this.positionX=e,this.positionY=t,this.positionZ=i}get scaleX(){return this.matrices[this.trueIndex+p.MATRIX_INDEXES.SCALE_X]}set scaleX(e){this.matrices[this.trueIndex+p.MATRIX_INDEXES.SCALE_X]=e}get scaleY(){return this.matrices[this.trueIndex+p.MATRIX_INDEXES.SCALE_Y]}set scaleY(e){this.matrices[this.trueIndex+p.MATRIX_INDEXES.SCALE_Y]=e}get scaleZ(){return this.matrices[this.trueIndex+p.MATRIX_INDEXES.SCALE_Z]}set scaleZ(e){this.matrices[this.trueIndex+p.MATRIX_INDEXES.SCALE_Z]=e}setScale(e,t,i){this.scaleX=e,this.scaleY=t,this.scaleZ=i}copy(e){for(let t=0;t<16;t++)this.matrices[this.trueIndex+t]=e.matrices[e.trueIndex+t]}multiply(e){let t=new Float32Array(16),i=this.matrices.subarray(this.trueIndex,this.trueIndex+16),r=e.matrices.subarray(e.trueIndex,e.trueIndex+16);for(let e=0;e<4;e++)for(let s=0;s<4;s++)t[4*e+s]=i[4*e+0]*r[s+0]+i[4*e+1]*r[s+4]+i[4*e+2]*r[s+8]+i[4*e+3]*r[s+12];for(let e=0;e<16;e++)this.matrices[this.trueIndex+e]=t[e]}getMatrixValues(){return this.matrices.slice(this.trueIndex,this.trueIndex+16)}constructor(e,t=0){if(this.trueIndex=0,this.index=0,this.setMatricesIndex(t),e instanceof p)this.matrices=e.matrices;else{this.matrices=new Float32Array(16*e);for(let t=0;t<e;t++)this.setIdentityMatrix(16*t)}}}p.MATRIX_INDEXES={POSITION_X:12,POSITION_Y:13,POSITION_Z:14,SCALE_X:0,SCALE_Y:5,SCALE_Z:10};let g=new p(1);g.setPosition(10,20,30),g.setScale(2,2,2),console.log("Position:",g.positionX,g.positionY,g.positionZ),console.log("Scale:",g.scaleX,g.scaleY,g.scaleZ);class I{destroy(){this._tool.returnInstance(this)}constructor(e,t,i){this.index=e,this.matrix=t,this._tool=i}}i(21658);class m{addBuffer(e,t,i){this.mesh.thinInstanceSetBuffer(e,t,i,!1),this._bufferIds.push(e)}setInstanceAmount(e){this._matrixArray=new p(e),this.addBuffer("matrix",this._matrixArray.matrices,16),this._instanceAmount=e;let t=this._instanceAmount;for(;t--;){let e=new I(t,new p(this._matrixArray,t),this);this._instances.push(e)}this.update()}getInstance(){let e=this._instances.shift();return!!e&&(e.matrix.setScale(1,1,1),e.matrix.setPosition(0,0,0),this._usedInstances.add(e),e)}returnInstance(e){e.matrix.setScale(0,0,0),e.matrix.setPosition(0,0,0),this._instances.push(e),this._usedInstances.delete(e)}returnAll(){for(let e of this._usedInstances)this.returnInstance(e);this._usedInstances.clear()}update(){this._bufferIds.forEach(e=>this.mesh.thinInstanceBufferUpdated(e))}constructor(e){this._instanceAmount=0,this._instances=[],this._usedInstances=new Set,this._bufferIds=[],this.mesh=e}}class S{setData(e){return this._data=e>>>0,this}getData(){return this._data>>>0}setTexture(e){return this._data=65535&this._data|(65535&e)<<16,this}getTexture(){return this._data>>>16&65535}setRotation(e){return this._data=4294967280&this._data|15&e,this}getRotation(){return 15&this._data}setFlipVertical(e){return e?this._data|=16:this._data&=-17,this}getFlipVertical(){return(16&this._data)!=0}setFlipHorizontal(e){return e?this._data|=32:this._data&=-33,this}getFlipHorizontal(){return(32&this._data)!=0}setBlendMode(e){return e?this._data|=64:this._data&=-65,this}getBlendMode(){return(64&this._data)!=0}setState(e){return this._data=4294901760&this._data|65535&e,this}getState(){return 65535&this._data}constructor(){this._data=0}}class w{setWorld(e){return this.worldId=e,u.setWrold(e),this}setPosition(e,t){return this.x=e,this.y=t,this}setLayer(e){return this.layer=e,this}loadIn(){let e=u.getChunk(this.x,this.y);if(!e)return!1;let t=e.layers[this.layer];return!!t&&(this._chunk=e,this._layer=t,this._tileIndex=c.getTileIndexXY(this.x,this.y),this._tileId=this._layer.tiles[this._tileIndex],this._tileState=this._layer.tileStates[this._tileIndex],this._textureId=this._layer.textures[this._tileIndex],this._color=this._layer.colors[this._tileIndex],this._state=this._layer.states[this._tileIndex],!0)}commit(){this._layer.tiles[this._tileIndex]=this._tileId,this._layer.tileStates[this._tileIndex]=this._tileState,this._layer.textures[this._tileIndex]=this._textureId,this._layer.colors[this._tileIndex]=this._color,this._layer.states[this._tileIndex]=this._state}getTextureId(){return this._textureId}setTextureId(e){this._textureId=e}getTileId(){return this._tileId}setTileId(e){this._tileId=e}getStateData(){return this._state}setStateData(e){this._state=e}getTileStateData(){return this._tileState}setTileStateData(e){this._tileState=e}getColorData(){return this._color}setColorData(e){this._color=e}getRawTileData(){return[this._tileId,this._tileState,this._textureId,this._state,this._color]}setRawTileData(e){this._tileId=e[0],this._tileState=e[1],this._textureId=e[2],this._state=e[3],this._color=e[4]}constructor(){this.layer=0,this.worldId="main"}}class y{setData(e){return this._data=e>>>0&4294967295,this}getData(){return this._data>>>0}setColorR(e){return this._data=16777215&this._data|(255&e)<<24,this}getColorR(){return this._data>>>24&255}setColorG(e){return this._data=-16711681&this._data|(255&e)<<16,this}getColorG(){return this._data>>>16&255}setColorB(e){return this._data=-65281&this._data|(255&e)<<8,this}getColorB(){return this._data>>>8&255}setColorA(e){return this._data=-256&this._data|255&e,this}getColorA(){return 255&this._data}constructor(){this._data=0}}let T={0:0,1:90,2:180,3:270},A={0:0,90:1,180:2,270:3};class v{setData(e){return this._data=e>>>0&65535,this}getData(){return this._data>>>0}setRotation(e){if(e<0||e>3)throw RangeError("Rotation value must be between 0 and 3.");return this._data&=~v.ROTATION_MASK,this._data|=e<<v.ROTATION_SHIFT&v.ROTATION_MASK,this}getRotation(){return(this._data&v.ROTATION_MASK)>>>v.ROTATION_SHIFT}setRotationDegrees(e){let t=A[e];if(void 0===t)throw RangeError("Degrees must be one of the following: 0, 90, 180, 270.");return this.setRotation(t)}getRotationDegrees(){var e;return null!==(e=T[this.getRotation()])&&void 0!==e?e:0}setFlipVertical(e){return e?this._data|=v.FLIP_VERTICAL_MASK:this._data&=~v.FLIP_VERTICAL_MASK,this}getFlipVertical(){return(this._data&v.FLIP_VERTICAL_MASK)!=0}setFlipHorizontal(e){return e?this._data|=v.FLIP_HORIZONTAL_MASK:this._data&=~v.FLIP_HORIZONTAL_MASK,this}getFlipHorizontal(){return(this._data&v.FLIP_HORIZONTAL_MASK)!=0}setBlendMode(e){return e?this._data|=v.BLEND_MODE_MASK:this._data&=~v.BLEND_MODE_MASK,this}getBlendMode(){return(this._data&v.BLEND_MODE_MASK)!=0}constructor(){this._data=0}}v.ROTATION_MASK=15,v.ROTATION_SHIFT=0,v.FLIP_VERTICAL_MASK=16,v.FLIP_VERTICAL_SHIFT=4,v.FLIP_HORIZONTAL_MASK=32,v.FLIP_HORIZONTAL_SHIFT=5,v.BLEND_MODE_MASK=64,v.BLEND_MODE_SHIFT=6;class D{update(e){for(this._frameTimer+=e;this._frameTimer>=this.data.frameLength[this._frameIndex];){this._frameTimer-=this.data.frameLength[this._frameIndex],this._frameIndex++,this._frameIndex>=this.data.frameOrder.length&&(this._frameIndex=0);let e=this.data.frameOrder[this._frameIndex],t=this.framesBounds.getXY(e);this.animatedFrameOffset[0]=t[0]*this.data.frameSize[0],this.animatedFrameOffset[1]=t[1]*this.data.frameSize[1]}}constructor(e){this.animatedFrameOffset=[0,0],this._frameIndex=0,this._frameTimer=0,this.data=e,console.warn(e);let t=[Math.floor((e.framesRange[1][0]-e.framesRange[0][0])/e.frameSize[0])||1,Math.floor((e.framesRange[1][1]-e.framesRange[0][1])/e.frameSize[1])||1];this.framesBounds=o.h7.GetXYOrder(),this.framesBounds.setBounds(...t)}}class P{static registerAnimations(e){for(let t of e){let[[e,i],[r,s]]=t.framesRange,n=new D(t);this.animations.push(n);for(let a=e;a<r;a++)for(let e=i;e<s;e++){let i=z.getIndex(t.textureId,a,e);this.animatedIndex[i-1]=n}}}static update(e){for(let t=0;t<this.animations.length;t++)this.animations[t].update(e)}}P.animatedIndex=[],P.animations=[];class z{static getIndexData(){let e={};for(let[t,i]of this._bounds)e[t]=this._bounds.get(t);return{textureBounds:this.index.getBounds(),mapped:e}}static setTextureTileBounds(e,t){this.index.setBounds(e,t)}static registerTexture(e,t,i,r,s){this._bounds.set(e,[[t,i],[r,s]])}static getIndex(e,t,i){if("blank"==e)return 0;let r=this._bounds.get(e)[0];return this.index.getIndexXY(r[0]+t,r[1]+i)+1}static isAnimated(e){if(0!=e)return void 0!==P.animatedIndex[e-1]}static getAnimatedIndex(e){let t=P.animatedIndex[e-1];if(!t)return e;let i=this.index.getXY(e-1);return this.index.getIndexXY(i[0]+t.animatedFrameOffset[0],i[1]+t.animatedFrameOffset[1])+1}}z.tilesCount=1,z.index=o.h7.GetXYOrder(),z._bounds=new Map;class C{set enabled(e){this.entityTool.mesh.setEnabled(e),this._enabled=e}get enabled(){return this._enabled}render(){this.entityTool.mesh.position.z=this.zOffset,this.entityTool.mesh.renderingGroupId=this.renderingGroupId;let e=n.tileMeterSize,[t,i]=this.data.tileSize,r=c.getTilePosition(this.renderer.camera.position.x*n.pixelSize,this.renderer.camera.position.y*n.pixelSize),s=r.x+this.data.tileStartOffset[0],a=r.y+this.data.tileStartOffset[1];for(let r=0;r<i;r++)for(let i=0;i<t;i++){var o,l;let t=this.tiles[this.bufferIndex.getIndexXY(i,r)];if(!t)continue;if(t.matrix.setPosition((s+i)*e[0],(a+r)*e[1],this.zOffset),!this.dataTool.setPosition(this.worldDataClamp?((s+i)%(o=this.worldDataClamp)+o)%o:s+i,this.worldDataClamp?((a+r)%(l=this.worldDataClamp)+l)%l:a+r).setLayer(this.worldLayer).loadIn()){this.tileData[2*t.index]=0,this.tileData[2*t.index+1]=0;continue}let n=this.dataTool.getTextureId();z.isAnimated(n)&&(n=z.getAnimatedIndex(n)),this.colorDataDencode.setData(this.dataTool.getColorData()),this.stataeDataEncode.setData(this.dataTool.getTileStateData()),this.tileData[2*t.index]=this.tileDataEncoder.setData(this.tileData[2*t.index]).setFlipHorizontal(this.stataeDataEncode.getFlipHorizontal()).setFlipVertical(this.stataeDataEncode.getFlipVertical()).setRotation(this.stataeDataEncode.getRotation()).setTexture(n).getData(),this.tileData[2*t.index+1]=this.colorDataEncode.setData(this.tileData[2*t.index]).setColorR(this.colorDataDencode.getColorR()).setColorG(this.colorDataDencode.getColorG()).setColorB(this.colorDataDencode.getColorB()).setColorA(this.colorDataDencode.getColorA()).getData()}this.entityTool.update()}constructor(e,t){this._enabled=!0,this.colorDataEncode=new y,this.colorDataDencode=new y,this.stataeDataEncode=new v,this.tiles=[],this.tileDataEncoder=new S,this.dataTool=new w,this.zOffset=0,this.worldLayer=0,this.worldDataClamp=0,this.renderingGroupId=0,this.renderer=e,this.data=t;let i=f(e.scene);i.material=e.tilesMaterial,i.alwaysSelectAsActiveMesh=!0;let r=new m(i);this.bufferIndex=o.h7.GetXYOrder(),this.worldLayer=t.worldLayer,void 0!==t.renderGroup&&(i.renderingGroupId=t.renderGroup),this.renderingGroupId=t.renderGroup||0,t.zPosition&&(this.zOffset=t.zPosition),t.worldDataClamp&&(this.worldDataClamp=t.worldDataClamp);let[s,n]=this.data.tileSize;this.bufferIndex.setBounds(s,n);let a=n*s;r.setInstanceAmount(a),this.tileData=new Uint32Array(2*a),r.addBuffer("tileData",this.tileData,2);for(let e=0;e<s;e++)for(let t=0;t<n;t++){let i=this.bufferIndex.getIndexXY(e,t),s=r.getInstance();if(!s)break;this.tiles[i]=s}r.update(),this.entityTool=r}}var E=i(5377),_=i(97937);_.Q.ShadersStore.retroVertexShader="\n#version 300 es\nprecision highp float;\n// Attributes\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\n\n// Uniforms\nuniform mat4 worldViewProjection;                \nuniform mat4 viewProjection;   \nuniform vec2 tileUVDimenions;\nuniform vec2 tileTextureTileBounds;\n\nuniform float time;\n\n\n#ifdef INSTANCES\n// Matrices\nin vec4 world0;\nin vec4 world1;\nin vec4 world2;\nin vec4 world3;\n// Custom attributes\nin uvec2 tileData;\n#endif\n\n// Varying\nout vec2 vUV;\nout vec4 vColor;\n\nvoid main(void) {\n    #ifdef INSTANCES\n      // Construct the final world matrix\n      mat4 finalWorld = mat4(world0, world1, world2, world3); \n   \n\n\n\n      // Extract the color components (lower 16 bits)\n      float r = float((tileData.y >> 24u) & 0xFFu) / 255.0;\n      float g = float((tileData.y >> 16u) & 0xFFu) / 255.0;\n      float b = float((tileData.y >> 8u) & 0xFFu) / 255.0;\n      float a = float(tileData.y & 0xFFu) / 255.0;\n\n      uint rotationIndex = (tileData.x >> 0u) & 0xFu;  // bits 0-3\n      uint flipVertical = (tileData.x >> 4u) & 0x1u;  // bit 4\n      uint flipHorizontal = (tileData.x >> 5u) & 0x1u;  // bit 5\n      uint blendMode = (tileData.x >> 6u) & 0x7u;  // bits 6-8\n     \n      uint mask = 1u << rotationIndex;\n\n      float uvX = float( (uint(uv.x) & mask ) >> rotationIndex );\n      float uvY = float( (uint(uv.y) & mask ) >> rotationIndex );\n      vec2 uvAdjusted = vec2(uvX,uvY);\n\n      // Apply horizontal and vertical flips\n      if (flipHorizontal == 1u) {\n         uvAdjusted.x = 1.0 - uvAdjusted.x;\n      }\n      if (flipVertical == 1u) {\n          uvAdjusted.y = 1.0 - uvAdjusted.y;\n      }\n\n      float tileIndex = float((tileData.x >> 16u) & 0xFFFFu);\n\n      if(tileIndex == 0.) {\n        vColor.a = 0.;\n        return;\n      }\n      tileIndex -= 1.;\n\n\n      \n\n      vec2 tilePosition = vec2(\n        mod(tileIndex, tileTextureTileBounds.x),\n        floor(tileIndex / tileTextureTileBounds.x)\n      );\n\n    uvAdjusted = uvAdjusted * tileUVDimenions + tilePosition * tileUVDimenions;\n\n\n    vUV = uvAdjusted;\n\n\n\n\n\n      // Pack the RGBA color into vColor\n      vColor = vec4(r, g, b, a);\n    //vColor = vec4(1.,1.,1.,1.);\n      gl_Position = viewProjection * finalWorld * vec4(position, 1.0);  \n    #else\n      gl_Position = worldViewProjection * vec4(position, 1.0); \n    #endif\n\n\n\n\n}\n",_.Q.ShadersStore.retroFragmentShader="\n#version 300 es\nprecision highp float;\nprecision highp sampler2D;\nout vec4 FragColor;\nin vec2 vUV;\nin float vTextureIndex;\nin vec4 vColor;\n\nuniform sampler2D tileTexture;\n\nvoid main() {\n#ifdef INSTANCES\n   vec4 texColor = texture(tileTexture, vec2(vUV));\n   FragColor = texColor * vColor;\n   if(texColor.a < .2) {\n\n    discard;\n   }\n //  FragColor = texColor;\n// FragColor = vec4(1.);\n#endif\n#ifndef INSTANCES\n    FragColor = vec4(1.,1.,1.,1.);\n#endif\n}\n\n";var R=i(81209);async function b(e,t,i){let r=document.createElement("canvas"),a=r.getContext("2d"),o=Math.ceil(Math.sqrt(i.length)),l=Math.ceil(i.length/o),h=o*t[0],d=l*t[1];r.width=h,r.height=d,z.setTextureTileBounds(h/n.tilePixelSize[0],d/n.tilePixelSize[1]),console.warn(h,d,i);for(let e=0;e<d;e+=t[1]){let s=!1;for(let o=0;o<h;o+=t[0]){let l=i.shift();if(!l){s=!0;break}await new Promise(async i=>{let s=new Image;s.onload=()=>{a.save(),a.translate(0,r.height),a.scale(1,-1),a.drawImage(s,o,e,t[0],t[1]),a.restore(),z.registerTexture(l.id,o/n.tilePixelSize[0],e/n.tilePixelSize[1],(o+t[0])/n.tilePixelSize[0],(e+t[1])/n.tilePixelSize[1]),console.warn("register texture",l.id),i(!0)},s.src=l.src})}if(s)break}let c=new s.FM8(n.tilePixelSize[0]/h,n.tilePixelSize[1]/d),u=new s.FM8(h/n.tilePixelSize[0],d/n.tilePixelSize[1]);console.log(c,u);let f=await new Promise((e,t)=>{r.toBlob(i=>{if(!i)return t(Error("Tile texture could not be created."));e(i)},"image/png")});return[new R.x(URL.createObjectURL(f),e,void 0,void 0,R.x.NEAREST_NEAREST),c,u]}class O{dispose(){for(let e of this.tiles)e.destroy();this.renderer.renderPatterns.delete(this)}render(){let e=this.patternData[this.pattern],t=0;for(let i=0;i<e.length;i++)for(let r=0;r<e[i].length;r++){let s=this.tiles[t];s&&(s.matrix.setPosition(this.position.x*n.pixelSize+r*n.tileMeterSize[0],this.position.y*n.pixelSize+i*n.tileMeterSize[1],0),O.tileData[2*s.index]=e[i][r][0],O.tileData[2*s.index+1]=e[i][r][1],t++)}}constructor(e,t){if(this.tiles=[],this.position=new s.FM8,this.renderer=e,this.data=t,!O.entityTool){let t=f(e.scene);t.alwaysSelectAsActiveMesh=!0,t.material=e.tilesMaterial;let i=new m(t);i.setInstanceAmount(n.maxPatternTiles),O.tileData=new Uint32Array(2*n.maxPatternTiles),O.entityTool=i,i.addBuffer("tileData",O.tileData,2)}if(this.pattern=t.defaultPattern,O.patternData.get(t.id)){this.patternData=O.patternData.get(t.id);let e=O.maxTiles.get(t.id);for(let t=0;t<e;t++){let e=O.entityTool.getInstance();if(!e){console.warn("not enough tile instanecs");continue}this.tiles[t]=e}}else{let e=new S,s=new y,n={},a=0;for(let o in t.patterns){let l=t.patterns[o],h=0,d=[];for(let t=0;t<l.length;t++){var i,r;null!==(r=d[i=t])&&void 0!==r||(d[i]=[]);for(let i=0;i<l[t].length;i++){let r=l[t][i];d[t][i]=[e.setData(0).setRotation(r.rotation).setTexture(z.getIndex(r.texture,r.tileX,r.tileY)).getData(),s.setData(0).setColorR(r.color?r.color[0]:1).setColorG(r.color?r.color[1]:1).setColorB(r.color?r.color[2]:1).setColorA(r.color?r.color[3]:1).getData()],r&&h++}}n[o]=d,h>a&&(a=h)}for(let e=0;e<a;e++){let t=O.entityTool.getInstance();if(!t){console.warn("not enough tile instanecs");continue}this.tiles[e]=t}O.maxTiles.set(t.id,a),O.patternData.set(t.id,n),this.patternData=n}e.renderPatterns.add(this)}}O.maxTiles=new Map,O.patternData=new Map;class k{get world(){return this._world}set world(e){this._world=e,console.warn("set world"),e&&(this.layers.forEach(t=>t.dataTool.setWorld(e)),this._rendering=!0),e||(this._rendering=!1)}createPattern(e){return new O(this,e)}render(){if(this._rendering){P.update(this.scene.deltaTime);for(let e=0;e<this.layers.length;e++)this.layers[e].render();for(let e of this.renderPatterns)e.render();O.entityTool&&O.entityTool.update()}}constructor(e,t){this._world=null,this._rendering=!1,this.renderPatterns=new Set,this.layers=[],this.scene=e,this.camera=t}}class M{get size(){return this._count}register(e){let t=this._count;return this._count++,this._palette[t]=e,this._map[e]=t,t}get(){return this._palette}getMap(){return this._map}isRegistered(e){return void 0!==this._map[e]}getNumberId(e){return this._map[e]}getStringId(e){return this._palette[e]}constructor(e){if(this._count=0,this._palette=[],this._map={},e){let t=e.length;for(let i=0;i<t;i++)this.register(e[i])}}}class X{static registerTiles(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t)this.tileTexturePalette.register(e.id),this.tilesTextures[this.tileTexturePalette.getNumberId(e.id)]=e}}X.tileTexturePalette=new M,X.tilesTextures=[],X.registerTiles({id:"blank",src:""});class L{static registerTiles(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t)this.tilePalette.register(e.id),this.tiles[this.tilePalette.getNumberId(e.id)]=e}}L.tilePalette=new M,L.tiles=[],L.registerTiles({id:"blank",properties:{}});class F{static updateSettings(e){}static addWorld(e){u.createWorld(e)}static async create(e){let t=new a(e.scene),i=new k(e.scene,t);X.registerTiles(...e.tileTextures);let r=await b(e.scene,e.tileSetSize,e.tileTextures),s=function(e,t,i,r){let s=new E.j("shader",e,{vertex:"retro",fragment:"retro"},{attributes:["position","normal","tileData","uv","world0","world1","world2","world3"],uniforms:["time","viewProjection","worldViewProjection","tileUVDimenions","tileTextureTileBounds"],samplers:["tileTexture"],needAlphaBlending:!0,needAlphaTesting:!0}),n=0;return e.registerBeforeRender(()=>{s.setFloat("time",n),n+=1}),s.setTexture("tileTexture",t),s.setVector2("tileUVDimenions",i),s.setVector2("tileTextureTileBounds",r),s}(e.scene,...r);i.tilesMaterial=s;for(let t=0;t<e.layers.length;t++)i.layers[t]=new C(i,e.layers[t]);return console.log(z._bounds),L.registerTiles(...e.tiles),P.registerAnimations(e.tileAnimations),{camera:t,renderer:i}}}s.Qmf.ShadersStore.crtFragmentShader="\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define PI 3.1415926538\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Parameters\nuniform vec2 curvature;\nuniform vec2 screenResolution;\nuniform vec2 scanLineOpacity;\nuniform float vignetteOpacity;\nuniform float brightness;\nuniform float vignetteRoundness;\nuniform float glowIntensity; // New uniform for glow intensity\nuniform float contrast; // New uniform for contrast\n\nvec2 curveRemapUV(vec2 uv) {\n    // Distortion using a sinusoid.\n    uv = uv * 2.0 - 1.0;\n    vec2 offset = abs(uv.yx) / vec2(curvature.x, curvature.y);\n    uv = uv + uv * offset * offset;\n    uv = uv * 0.5 + 0.5;\n    return uv;\n}\n\nvec4 scanLineIntensity(float uv, float resolution, float opacity) {\n    float intensity = sin(uv * resolution * PI * 2.0);\n    intensity = ((0.5 * intensity) + 0.5) * 0.9 + 0.1;\n    return vec4(vec3(pow(intensity, opacity)), 1.0);\n}\n\nvec4 vignetteIntensity(vec2 uv, vec2 resolution, float opacity, float roundness) {\n    float intensity = uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y);\n    return vec4(vec3(clamp(pow((resolution.x / roundness) * intensity, opacity), 0.0, 1.0)), 1.0);\n}\n\n// Glow effect function (blurring bright areas)\nvec4 applyGlow(vec4 color, vec2 uv) {\n    vec4 glowColor = vec4(0.0);\n    float blurSize = 1.0 / screenResolution.x * glowIntensity; // Adjust blur size\n\n    // Sample neighboring pixels to create a simple blur effect\n    for (int x = -2; x <= 2; x++) {\n        for (int y = -2; y <= 2; y++) {\n            vec2 offset = vec2(float(x), float(y)) * blurSize;\n            glowColor += texture2D(textureSampler, uv + offset);\n        }\n    }\n    glowColor /= 25.0; // Normalize the blur contribution\n\n    // Add glow based on brightness threshold\n    vec3 brightColor = max(vec3(0.0), color.rgb - vec3(0.8)); // Adjust threshold\n    return vec4(color.rgb + brightColor * glowColor.rgb * glowIntensity, color.a);\n}\n\nvoid main(void) {\n  //  vec2 remappedUV = curveRemapUV(vUV); // Apply curvature\n  vec2 remappedUV = vUV;\n    vec4 baseColor = texture2D(textureSampler, remappedUV);\n\n    // Apply vignette effect\n    baseColor *= vignetteIntensity(remappedUV, screenResolution, vignetteOpacity, vignetteRoundness);\n\n    // Apply scan line effect\n    baseColor *= scanLineIntensity(remappedUV.x, screenResolution.y, scanLineOpacity.x);\n    baseColor *= scanLineIntensity(remappedUV.y, screenResolution.x, scanLineOpacity.y);\n\n    // Apply brightness\n    baseColor *= vec4(vec3(brightness), 1.0);\n\n    // Apply contrast\n    baseColor.rgb = (baseColor.rgb - 0.5) * contrast + 0.5;\n\n    // Apply glow effect\n    baseColor = applyGlow(baseColor, remappedUV);\n\n    // Clamp UV coordinates and set final color\n    if (remappedUV.x < 0.0 || remappedUV.y < 0.0 || remappedUV.x > 1.0 || remappedUV.y > 1.0) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    } else {\n        gl_FragColor = baseColor;\n    }\n}\n";class N{create(e){this.postProcess=new s.Dso("CRTShaderPostProcess","crt",["curvature","screenResolution","scanLineOpacity","vignetteOpacity","brightness","vignetteRoundness","glowIntensity","contrast"],null,1,e),this.postProcess.onApply=e=>{e.setFloat2("curvature",5,5),e.setFloat2("screenResolution",300,300),e.setFloat2("scanLineOpacity",.5,.5),e.setFloat("vignetteOpacity",0),e.setFloat("brightness",2),e.setFloat("vignetteRoundness",.01),e.setFloat("glowIntensity",.1),e.setFloat("contrast",this._contrast)}}setContrast(e){if(this._contrast=e,this.postProcess&&this.postProcess.onApply){var t;this.postProcess.onApply=this.postProcess.onApply.bind(this),null===(t=this.postProcess.getEffect())||void 0===t||t.setFloat("contrast",this._contrast)}}constructor(){this._contrast=1}}async function B(e){let t=atob(e),i=t.length,r=new Uint8Array(i);for(let e=0;e<i;e++)r[e]=t.charCodeAt(e);let s=new Blob([r],{type:"application/octet-stream"}),n=await new Response(s.stream().pipeThrough(new DecompressionStream("gzip"))).blob();return await n.arrayBuffer()}async function U(e){let{data:t}=e,i={id:t.id,chunks:[]},r=new M(t.tilePalette),s=Object.keys(t.tileTextureIndex.mapped),n=o.h7.GetXYOrder();for(let e of(n.setBounds(...t.tileTextureIndex.textureBounds),t.chunks)){let a={position:e.position,layers:[]};for(let h in i.chunks[o.Yp.HashXYZ(e.position[0],e.position[1],0)]=a,e.layers){let i=e.layers[h],o=l.Create({layerId:Number(h),colors:"number"==typeof i.colors?new Uint32Array(c.chunkTileIndex.size).fill(i.colors):new Uint32Array(await B(i.colors)),states:"number"==typeof i.states?new Uint16Array(c.chunkTileIndex.size).fill(i.states):new Uint16Array(await B(i.states)),textures:"number"==typeof i.textures?new Uint16Array(c.chunkTileIndex.size).fill(i.textures):new Uint16Array(await B(i.textures)),tileStates:"number"==typeof i.tileStates?new Uint8Array(c.chunkTileIndex.size).fill(i.tileStates):new Uint8Array(await B(i.tileStates)),tiles:"number"==typeof i.tiles?new Uint16Array(c.chunkTileIndex.size).fill(i.tiles):new Uint16Array(await B(i.tiles))});for(let e=0;e<o.tiles.length;e++){let i=r.getStringId(o.tiles[e]);if(!L.tilePalette.isRegistered(i)){console.warn("".concat(i," is not a registered tile")),o.tiles[e]=0;continue}o.tiles[e]=L.tilePalette.getNumberId(i);let a=o.textures[e];if(0!=a)for(let i=0;i<s.length;i++){let r=t.tileTextureIndex.mapped[s[i]],[l,h]=n.getXY(a-1);if(!(l<r[0][0])&&!(l>r[1][0])&&!(h<r[0][1])&&!(h>r[1][1])){if(!z._bounds.has(s[i])){console.warn("Texture with id ".concat(s[i]," is not registered")),o.textures[e]=0;break}o.textures[e]=z.getIndex(s[i],l-r[0][0],h-r[0][1]);break}}}a.layers[h]=o}}return i}async function V(e,t){e.clearColor.set(0,0,0,1);let{camera:i,renderer:r}=await F.create({scene:e,tileAnimations:[{textureId:"water",framesRange:[[0,0],[17,6]],frameSize:[2,6],frameOrder:[0,1,2,3,4,5,6,7],frameLength:[200,200,200,200,200,200,200,200]},{textureId:"water",framesRange:[[0,16],[32,32]],frameSize:[4,4],frameOrder:Array(32).fill(0).map((e,t)=>t),frameLength:Array(32).fill(0).map((e,t)=>80)}],tileSetSize:[256,256],tileTextures:[{id:"water",src:"/assets/RetroGame/water.png"},{id:"palace",src:"/assets/RetroGame/palace.png"},{id:"plants",src:"/assets/RetroGame/plants.png"},{id:"world",src:"/assets/RetroGame/world.png"}],layers:[{id:-4,tileSize:[120,100],tileStartOffset:[-30,-40],worldLayer:-4,readWorldData:!0,zPosition:10,worldDataClamp:32,renderGroup:0},{id:-3,tileSize:[80,60],tileStartOffset:[-10,-10],worldLayer:-3,readWorldData:!0,zPosition:4,worldDataClamp:0,renderGroup:0},{id:-2,tileSize:[120,80],tileStartOffset:[-30,-30],worldLayer:-2,readWorldData:!0,zPosition:8,worldDataClamp:0,renderGroup:0},{id:-1,tileSize:[62,34],tileStartOffset:[-1,-1],worldLayer:-1,readWorldData:!0,renderGroup:1},{id:0,tileSize:[62,34],tileStartOffset:[-1,-1],worldLayer:0,readWorldData:!0,renderGroup:1},{id:1,tileSize:[62,34],tileStartOffset:[-1,-1],worldLayer:1,readWorldData:!0,renderGroup:1},{id:2,tileSize:[62,34],tileStartOffset:[-1,-1],worldLayer:2,readWorldData:!0,zPosition:0,renderGroup:2},{id:3,tileSize:[58,34],tileStartOffset:[-1,-1],worldLayer:3,readWorldData:!0,zPosition:-1,renderGroup:2}],tiles:[{id:"wall",properties:{solid:!0}}]});new N().create(i._camera);let a=new s.pcH("particles",1e3,e);a.particleTexture=new s.xEZ("data:image/png;base64,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",e),a.updateSpeed=.001,a.emitter=new s.Pa4(0,0,1),a.emitRate=200,a.renderingGroupId=1,a.minEmitBox=new s.Pa4(0,0,3),a.maxEmitBox=new s.Pa4(n.chunkMeterSize[0],0,0);let o=new s._8k("perlin",512,e);a.noiseTexture=o,a.noiseStrength=new s.Pa4(2,2,2),a.direction1=new s.Pa4(-1,1,-1),a.direction2=new s.Pa4(1,1,1),a.blendMode=2,a.minAngularSpeed=.02,a.maxAngularSpeed=1,a.minEmitPower=.5,a.maxEmitPower=2,a.minLifeTime=2,a.maxLifeTime=20,a.color1=new s.HEv(77/255,114/255,214/255,.8),a.color2=new s.HEv(132/255,152/255,207/255,.8),a.colorDead=new s.HEv(24/255,67/255,110/255,.8),a.minSize=.005,a.maxSize=.025,a.gravity=new s.Pa4(.1,-.2,0),a.preWarmCycles=100,a.preWarmStepOffset=10,a.gravity=new s.Pa4(.1,-.2,0),a.start();let l=new s.Pa4;a.emitter=l;let h=[{x:0,y:155},{x:764,y:155},{x:764,y:270},{x:950,y:155},{x:764,y:50},{x:0,y:155}];i.setPosition(0,155);let d=0,c=1;t.runRenderLoop(()=>{let t=h[d],s=h[c],a=s.x-t.x,o=s.y-t.y,u=Math.sqrt(a*a+o*o);i.setPosition(i.position.x+a/u*.8,i.position.y+o/u*.8);let f=i.position.x-t.x,x=i.position.y-t.y;Math.sqrt(f*f+x*x)>=u&&(d=c,++c==h.length&&(d=0,c=1),i.setPosition(s.x,s.y)),l.copyFrom(i._camera.position),l.z=1,l.x-=n.chunkMeterSize[0]/2,l.y-=n.chunkMeterSize[1]/2,r.render(),e.render()}),new s.ezm("",new s.Pa4(0,1,0),r.scene);let f=(0,s.$6X)("",{width:1e6,height:1e6},e);f.position.y=0,f.renderingGroupId=0;let x=new s.KuD("",r.scene);x.alpha=0,x.diffuseColor.set(1,0,0),f.rotation.x=-Math.PI/2,f.material=x,f.actionManager=new s.kOu(e),f.actionManager.registerAction(new s.fQC(s.kOu.OnRightPickTrigger,e=>{e.sourceEvent.preventDefault()}));let p=await (await fetch("/assets/RetroGame/world.json")).json(),g=await U({data:p});u.createWorld(g),r.world=g.id}var Q=i(2265);function H(e){let t=(0,Q.useRef)(null);return(0,Q.useEffect)(()=>{if(!t.current)return;let e=new s.D4V(t.current),i=new s.xsS(e);t.current,(async()=>{await V(i,e)})()},[]),(0,r.jsx)("canvas",{ref:t,id:"main",className:"render-canvas"})}},64162:function(){}},function(e){e.O(0,[4289,5889,1218,5611,4849,8924,7857,6902,6498,6874,6426,6331,6395,3751,4640,4788,7665,5068,9723,9267,2971,2117,1744],function(){return e(e.s=65618)}),_N_E=e.O()}]);