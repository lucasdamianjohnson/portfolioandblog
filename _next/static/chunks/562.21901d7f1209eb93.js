"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{50562:function(t,e,r){r.r(e),r.d(e,{_HDRTextureLoader:function(){return n}});var a=r(42790);class n{constructor(){this.supportCascades=!1}loadCubeData(){throw".env not supported in Cube."}loadData(t,e,r){let n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o=(0,a.dK)(n),i=(0,a.ls)(n,o),h=o.width*o.height,u=new Float32Array(4*h);for(let t=0;t<h;t+=1)u[4*t]=i[3*t],u[4*t+1]=i[3*t+1],u[4*t+2]=i[3*t+2],u[4*t+3]=1;r(o.width,o.height,e.generateMipMaps,!1,()=>{let t=e.getEngine();e.type=1,e.format=5,e._gammaSpace=!1,t._uploadDataToTextureDirectly(e,u)})}}},42790:function(t,e,r){r.d(e,{dK:function(){return i},ls:function(){return u},od:function(){return h}});var a=r(27152);function n(t,e,r,a,n,o){if(n>0){var i;n=(i=n-136)>1023?898846567431158e293*Math.pow(2,i-1023):i<-1074?5e-324*1*Math.pow(2,i+1074):1*Math.pow(2,i),t[o+0]=e*n,t[o+1]=r*n,t[o+2]=a*n}else t[o+0]=0,t[o+1]=0,t[o+2]=0}function o(t,e){let r="",a="";for(let n=e;n<t.length-e&&"\n"!=(a=String.fromCharCode(t[n]));n++)r+=a;return r}function i(t){let e=0,r=0,a=o(t,0);if("#"!=a[0]||"?"!=a[1])throw"Bad HDR Format.";let n=!1,i=!1,h=0;do h+=a.length+1,"FORMAT=32-bit_rle_rgbe"==(a=o(t,h))?i=!0:0==a.length&&(n=!0);while(!n);if(!i)throw"HDR Bad header format, unsupported FORMAT";h+=a.length+1,a=o(t,h);let u=/^-Y (.*) \+X (.*)$/g.exec(a);if(!u||u.length<3)throw"HDR Bad header format, no size";if(r=parseInt(u[2]),e=parseInt(u[1]),r<8||r>32767)throw"HDR Bad header format, unsupported size";return{height:e,width:r,dataPosition:h+=a.length+1}}function h(t,e,r=!1){let n=new Uint8Array(t),o=i(n),h=f(n,o);return a.B.ConvertPanoramaToCubemap(h,o.width,o.height,e,r)}function u(t,e){return f(t,e)}function f(t,e){let r,a,o,i,h,u=e.height,f=e.width,w=e.dataPosition,l=0,s=0,d=0,c=new Uint8Array(new ArrayBuffer(4*f)),C=new Float32Array(new ArrayBuffer(e.width*e.height*12));for(;u>0;){if(r=t[w++],a=t[w++],o=t[w++],i=t[w++],2!=r||2!=a||128&o||e.width<8||e.width>32767)return function(t,e){let r,a,o=e.height,i=e.width,h=e.dataPosition,u=new Float32Array(new ArrayBuffer(e.width*e.height*12));for(;o>0;){for(a=0;a<e.width;a++)r=t[h++],n(u,r,t[h++],t[h++],t[h++],(e.height-o)*i*3+3*a);o--}return u}(t,e);if((o<<8|i)!=f)throw"HDR Bad header format, wrong scan line width";for(d=0,l=0;d<4;d++)for(s=(d+1)*f;l<s;)if(r=t[w++],a=t[w++],r>128){if(0==(h=r-128)||h>s-l)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)c[l++]=a}else{if(0==(h=r)||h>s-l)throw"HDR Bad Format, bad scanline data (non-run)";if(c[l++]=a,--h>0)for(let e=0;e<h;e++)c[l++]=t[w++]}for(d=0;d<f;d++)r=c[d],n(C,r,a=c[d+f],o=c[d+2*f],i=c[d+3*f],(e.height-u)*f*3+3*d);u--}return C}},27152:function(t,e,r){r.d(e,{B:function(){return n}});var a=r(84534);class n{static ConvertPanoramaToCubemap(t,e,r,a,n=!1){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*r*3)throw"ConvertPanoramaToCubemap: input size is wrong";let o=this.CreateCubemapTexture(a,this.FACE_FRONT,t,e,r,n),i=this.CreateCubemapTexture(a,this.FACE_BACK,t,e,r,n),h=this.CreateCubemapTexture(a,this.FACE_LEFT,t,e,r,n);return{front:o,back:i,left:h,right:this.CreateCubemapTexture(a,this.FACE_RIGHT,t,e,r,n),up:this.CreateCubemapTexture(a,this.FACE_UP,t,e,r,n),down:this.CreateCubemapTexture(a,this.FACE_DOWN,t,e,r,n),size:a,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(t,e,r,a,n,o=!1){let i=new Float32Array(new ArrayBuffer(t*t*12)),h=o?Math.max(1,Math.round(a/4/t)):1,u=1/h,f=u*u,w=e[1].subtract(e[0]).scale(u/t),l=e[3].subtract(e[2]).scale(u/t),s=1/t,d=0;for(let o=0;o<t;o++)for(let c=0;c<h;c++){let c=e[0],C=e[2];for(let e=0;e<t;e++)for(let u=0;u<h;u++){let h=C.subtract(c).scale(d).add(c);h.normalize();let u=this.CalcProjectionSpherical(h,r,a,n);i[o*t*3+3*e+0]+=u.r*f,i[o*t*3+3*e+1]+=u.g*f,i[o*t*3+3*e+2]+=u.b*f,c=c.add(w),C=C.add(l)}d+=s*u}return i}static CalcProjectionSpherical(t,e,r,a){let n=Math.atan2(t.z,t.x),o=Math.acos(t.y);for(;n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;let i=n/Math.PI,h=Math.round((i=.5*i+.5)*r);h<0?h=0:h>=r&&(h=r-1);let u=Math.round(o/Math.PI*a);u<0?u=0:u>=a&&(u=a-1);let f=a-u-1;return{r:e[f*r*3+3*h+0],g:e[f*r*3+3*h+1],b:e[f*r*3+3*h+2]}}}n.FACE_LEFT=[new a.P(-1,-1,-1),new a.P(1,-1,-1),new a.P(-1,1,-1),new a.P(1,1,-1)],n.FACE_RIGHT=[new a.P(1,-1,1),new a.P(-1,-1,1),new a.P(1,1,1),new a.P(-1,1,1)],n.FACE_FRONT=[new a.P(1,-1,-1),new a.P(1,-1,1),new a.P(1,1,-1),new a.P(1,1,1)],n.FACE_BACK=[new a.P(-1,-1,1),new a.P(-1,-1,-1),new a.P(-1,1,1),new a.P(-1,1,-1)],n.FACE_DOWN=[new a.P(1,1,-1),new a.P(1,1,1),new a.P(-1,1,-1),new a.P(-1,1,1)],n.FACE_UP=[new a.P(-1,-1,-1),new a.P(-1,-1,1),new a.P(1,-1,-1),new a.P(1,-1,1)]}}]);