"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7857],{94677:function(t,e,i){i.d(e,{t:function(){return a}});var s=i(93954),r=i(9719);function a(t,e,i,a,n,o,h,l){let c=e*s.o.GetTypeByteLength(i),u=h*e;if(l.length!==u)throw Error("Output length is not valid");if(i!==s.o.FLOAT||n!==c){s.o.ForEach(t,a,n,e,i,u,o,(t,e)=>l[e]=t);return}if(t instanceof Array){let e=a/4;l.set(t,e)}else if(t instanceof ArrayBuffer){let e=new Float32Array(t,a,u);l.set(e)}else{let e=t.byteOffset+a;if(e%4){r.Y.Warn("CopyFloatData: copied misaligned data."),l.set(new Float32Array(t.buffer.slice(e,e+4*u)));return}let i=new Float32Array(t.buffer,e,u);l.set(i)}}},40515:function(t,e,i){i.d(e,{a:function(){return r}});var s=i(39884);class r{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new s.P(0,0,0),this._diffPositionForCollisions=new s.P(0,0,0),this._collisionResponse=!0}}},27243:function(t,e,i){i.d(e,{Z:function(){return s}});class s{static get ForceFullSceneLoadingForIncremental(){return s._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(t){s._ForceFullSceneLoadingForIncremental=t}static get ShowLoadingScreen(){return s._ShowLoadingScreen}static set ShowLoadingScreen(t){s._ShowLoadingScreen=t}static get loggingLevel(){return s._LoggingLevel}static set loggingLevel(t){s._LoggingLevel=t}static get CleanBoneMatrixWeights(){return s._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(t){s._CleanBoneMatrixWeights=t}}s._ForceFullSceneLoadingForIncremental=!1,s._ShowLoadingScreen=!0,s._CleanBoneMatrixWeights=!1,s._LoggingLevel=0},34634:function(t,e,i){i.d(e,{L:function(){return s}});class s{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(t,e){this._defines[t]||(t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t),this._defines[t]=[]),this._defines[t].push(e)}addCPUSkinningFallback(t,e){this._mesh=e,t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(t,e){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,t=t.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),e._bonesComputationForcedToCPU=!0;let i=this._mesh.getScene();for(let t=0;t<i.meshes.length;t++){let s=i.meshes[t];if(!s.material){!this._mesh.material&&s.computeBonesUsingShaders&&s.numBoneInfluencers>0&&(s.computeBonesUsingShaders=!1);continue}if(s.computeBonesUsingShaders&&0!==s.numBoneInfluencers){if(s.material.getEffect()===e)s.computeBonesUsingShaders=!1;else if(s.subMeshes){for(let t of s.subMeshes)if(t.effect===e){s.computeBonesUsingShaders=!1;break}}}}}else{let e=this._defines[this._currentRank];if(e)for(let i=0;i<e.length;i++)t=t.replace("#define "+e[i],"");this._currentRank++}return t}}},25074:function(t,e,i){i.d(e,{G:function(){return n}});var s=i(5848),r=i(88388),a=i(7724);class n extends s.F{get subMaterials(){return this._subMaterials}set subMaterials(t){this._subMaterials=t,this._hookArray(t)}getChildren(){return this.subMaterials}constructor(t,e){super(t,e,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(t){let e=t.push;t.push=(...i)=>{let s=e.apply(t,i);return this._markAllSubMeshesAsTexturesDirty(),s};let i=t.splice;t.splice=(e,s)=>{let r=i.apply(t,[e,s]);return this._markAllSubMeshesAsTexturesDirty(),r}}getSubMaterial(t){return t<0||t>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[t]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map(t=>t?t.getActiveTextures():[]))}hasTexture(t){if(super.hasTexture(t))return!0;for(let e=0;e<this.subMaterials.length;e++)if(this.subMaterials[e]?.hasTexture(t))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(t,e,i){for(let s=0;s<this.subMaterials.length;s++){let r=this.subMaterials[s];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(t,e,i))return!1;continue}if(!r.isReady(t))return!1}}return!0}clone(t,e){let i=new n(t,this.getScene());for(let s=0;s<this.subMaterials.length;s++){let r=null,a=this.subMaterials[s];r=e&&a?a.clone(t+"-"+a.name):this.subMaterials[s],i.subMaterials.push(r)}return i}serialize(){let t={};t.name=this.name,t.id=this.id,t.uniqueId=this.uniqueId,r.$&&(t.tags=r.$.GetTags(this)),t.materialsUniqueIds=[],t.materials=[];for(let e=0;e<this.subMaterials.length;e++){let i=this.subMaterials[e];i?(t.materialsUniqueIds.push(i.uniqueId),t.materials.push(i.id)):(t.materialsUniqueIds.push(null),t.materials.push(null))}return t}dispose(t,e,i){let s=this.getScene();if(!s)return;if(i)for(let i=0;i<this.subMaterials.length;i++){let s=this.subMaterials[i];s&&s.dispose(t,e)}let r=s.multiMaterials.indexOf(this);r>=0&&s.multiMaterials.splice(r,1),super.dispose(t,e)}static ParseMultiMaterial(t,e){let i=new n(t.name,e);return i.id=t.id,i._loadedUniqueId=t.uniqueId,r.$&&r.$.AddTagsTo(i,t.tags),t.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=t.materialsUniqueIds:t.materials.forEach(t=>i.subMaterials.push(e.getLastMaterialById(t))),i}}(0,a.H7)("BABYLON.MultiMaterial",n)},31786:function(t,e,i){i.d(e,{a:function(){return a}});var s=i(39884),r=i(5848);class a extends r.F{constructor(t,e,i=!0){super(t,e),this._normalMatrix=new s.y3,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(t,e){return!!t&&(!this._storeEffectOnSubMeshes||!t.subMeshes||0===t.subMeshes.length||this.isReadyForSubMesh(t,t.subMeshes[0],e))}_isReadyForSubMesh(t){let e=t.materialDefines;return!this.checkReadyOnEveryCall&&!!t.effect&&!!e&&e._renderId===this.getScene().getRenderId()}bindOnlyWorldMatrix(t){this._activeEffect.setMatrix("world",t)}bindOnlyNormalMatrix(t){this._activeEffect.setMatrix("normalMatrix",t)}bind(t,e){e&&this.bindForSubMesh(t,e,e.subMeshes[0])}_afterBind(t,e=null,i){super._afterBind(t,e,i),this.getScene()._cachedEffect=e,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(t,e,i,s=1){return i._drawWrapper._forceRebindOnNextCall||t.isCachedMaterialInvalid(this,e,s)}dispose(t,e,i){this._activeEffect=void 0,super.dispose(t,e,i)}}},5377:function(t,e,i){i.d(e,{j:function(){return p}});var s=i(90212),r=i(44755),a=i(39884),n=i(93954),o=i(81209),h=i(7724),l=i(57449),c=i(34634),u=i(79114),d=i(31786),f=i(51092),_=i(49449),m=i(3609);let g={effect:null,subMesh:null};class p extends d.a{constructor(t,e,i,s={},r=!0){super(t,e,r),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new a.y3,this._cachedWorldViewProjectionMatrix=new a.y3,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=i,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...s}}get shaderPath(){return this._shaderPath}set shaderPath(t){this._shaderPath=t}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(t){-1===this._options.uniforms.indexOf(t)&&this._options.uniforms.push(t)}setTexture(t,e){return -1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._textures[t]=e,this}removeTexture(t){delete this._textures[t]}setTextureArray(t,e){return -1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._checkUniform(t),this._textureArrays[t]=e,this}setExternalTexture(t,e){return -1===this._options.externalTextures.indexOf(t)&&this._options.externalTextures.push(t),this._externalTextures[t]=e,this}setFloat(t,e){return this._checkUniform(t),this._floats[t]=e,this}setInt(t,e){return this._checkUniform(t),this._ints[t]=e,this}setUInt(t,e){return this._checkUniform(t),this._uints[t]=e,this}setFloats(t,e){return this._checkUniform(t),this._floatsArrays[t]=e,this}setColor3(t,e){return this._checkUniform(t),this._colors3[t]=e,this}setColor3Array(t,e){return this._checkUniform(t),this._colors3Arrays[t]=e.reduce((t,e)=>(e.toArray(t,t.length),t),[]),this}setColor4(t,e){return this._checkUniform(t),this._colors4[t]=e,this}setColor4Array(t,e){return this._checkUniform(t),this._colors4Arrays[t]=e.reduce((t,e)=>(e.toArray(t,t.length),t),[]),this}setVector2(t,e){return this._checkUniform(t),this._vectors2[t]=e,this}setVector3(t,e){return this._checkUniform(t),this._vectors3[t]=e,this}setVector4(t,e){return this._checkUniform(t),this._vectors4[t]=e,this}setQuaternion(t,e){return this._checkUniform(t),this._quaternions[t]=e,this}setQuaternionArray(t,e){return this._checkUniform(t),this._quaternionsArrays[t]=e.reduce((t,e)=>(e.toArray(t,t.length),t),[]),this}setMatrix(t,e){return this._checkUniform(t),this._matrices[t]=e,this}setMatrices(t,e){this._checkUniform(t);let i=new Float32Array(16*e.length);for(let t=0;t<e.length;t++)e[t].copyToArray(i,16*t);return this._matrixArrays[t]=i,this}setMatrix3x3(t,e){return this._checkUniform(t),this._matrices3x3[t]=e,this}setMatrix2x2(t,e){return this._checkUniform(t),this._matrices2x2[t]=e,this}setArray2(t,e){return this._checkUniform(t),this._vectors2Arrays[t]=e,this}setArray3(t,e){return this._checkUniform(t),this._vectors3Arrays[t]=e,this}setArray4(t,e){return this._checkUniform(t),this._vectors4Arrays[t]=e,this}setUniformBuffer(t,e){return -1===this._options.uniformBuffers.indexOf(t)&&this._options.uniformBuffers.push(t),this._uniformBuffers[t]=e,this}setTextureSampler(t,e){return -1===this._options.samplerObjects.indexOf(t)&&this._options.samplerObjects.push(t),this._textureSamplers[t]=e,this}setStorageBuffer(t,e){return -1===this._options.storageBuffers.indexOf(t)&&this._options.storageBuffers.push(t),this._storageBuffers[t]=e,this}setDefine(t,e){let i=t.trimEnd()+" ",s=this.options.defines.findIndex(e=>e===t||e.startsWith(i));return s>=0&&this.options.defines.splice(s,1),("boolean"!=typeof e||e)&&this.options.defines.push(i+e),this}isReadyForSubMesh(t,e,i){return this.isReady(t,i,e)}isReady(t,e,i){let s=i&&this._storeEffectOnSubMeshes;if(this.isFrozen){let t=s?i._drawWrapper:this._drawWrapper;if(t.effect&&t._wasPreviouslyReady&&t._wasPreviouslyUsingInstances===e)return!0}let a=this.getScene(),o=a.getEngine(),h=[],l=[],u=new c.L,d=this._shaderPath,f=this._options.uniforms,p=this._options.uniformBuffers,x=this._options.samplers;o.getCaps().multiview&&a.activeCamera&&a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,h.push("#define MULTIVIEW"),-1!==f.indexOf("viewProjection")&&-1===f.indexOf("viewProjectionR")&&f.push("viewProjectionR"));for(let t=0;t<this._options.defines.length;t++){let e=0===this._options.defines[t].indexOf("#define")?this._options.defines[t]:`#define ${this._options.defines[t]}`;h.push(e)}for(let t=0;t<this._options.attributes.length;t++)l.push(this._options.attributes[t]);if(t&&t.isVerticesDataPresent(n.o.ColorKind)&&(-1===l.indexOf(n.o.ColorKind)&&l.push(n.o.ColorKind),h.push("#define VERTEXCOLOR")),e&&(h.push("#define INSTANCES"),(0,m.y9)(l,this._materialHelperNeedsPreviousMatrices),t?.hasThinInstances&&(h.push("#define THIN_INSTANCES"),t&&t.isVerticesDataPresent(n.o.ColorInstanceKind)&&(l.push(n.o.ColorInstanceKind),h.push("#define INSTANCESCOLOR")))),t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton){l.push(n.o.MatricesIndicesKind),l.push(n.o.MatricesWeightsKind),t.numBoneInfluencers>4&&(l.push(n.o.MatricesIndicesExtraKind),l.push(n.o.MatricesWeightsExtraKind));let e=t.skeleton;h.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),u.addCPUSkinningFallback(0,t),e.isUsingTextureForMatrices?(h.push("#define BONETEXTURE"),-1===f.indexOf("boneTextureWidth")&&f.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(h.push("#define BonesPerMesh "+(e.bones.length+1)),-1===f.indexOf("mBones")&&f.push("mBones"))}else h.push("#define NUM_BONE_INFLUENCERS 0");let M=0,b=t?t.morphTargetManager:null;if(b){let t=b.supportsUVs&&-1!==h.indexOf("#define UV1"),e=b.supportsTangents&&-1!==h.indexOf("#define TANGENT"),i=b.supportsNormals&&-1!==h.indexOf("#define NORMAL");M=b.numMaxInfluencers||b.numInfluencers,t&&h.push("#define MORPHTARGETS_UV"),e&&h.push("#define MORPHTARGETS_TANGENT"),i&&h.push("#define MORPHTARGETS_NORMAL"),M>0&&h.push("#define MORPHTARGETS"),b.isUsingTextureForTargets&&(h.push("#define MORPHTARGETS_TEXTURE"),-1===f.indexOf("morphTargetTextureIndices")&&f.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),h.push("#define NUM_MORPH_INFLUENCERS "+M);for(let s=0;s<M;s++)l.push(n.o.PositionKind+s),i&&l.push(n.o.NormalKind+s),e&&l.push(n.o.TangentKind+s),t&&l.push(n.o.UVKind+"_"+s);M>0&&((f=f.slice()).push("morphTargetInfluences"),f.push("morphTargetCount"),f.push("morphTargetTextureInfo"),f.push("morphTargetTextureIndices"))}else h.push("#define NUM_MORPH_INFLUENCERS 0");if(t){let e=t.bakedVertexAnimationManager;e&&e.isEnabled&&(h.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===f.indexOf("bakedVertexAnimationSettings")&&f.push("bakedVertexAnimationSettings"),-1===f.indexOf("bakedVertexAnimationTextureSizeInverted")&&f.push("bakedVertexAnimationTextureSizeInverted"),-1===f.indexOf("bakedVertexAnimationTime")&&f.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,m.pd)(l,t,h)}for(let t in this._textures)if(!this._textures[t].isReady())return!1;t&&this._shouldTurnAlphaTestOn(t)&&h.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,_.qx)(f),(0,_.lK)(this,a,h)),a.fogEnabled&&t?.applyFog&&a.fogMode!==r.x.FOGMODE_NONE&&(h.push("#define FOG"),-1===f.indexOf("view")&&f.push("view"),-1===f.indexOf("vFogInfos")&&f.push("vFogInfos"),-1===f.indexOf("vFogColor")&&f.push("vFogColor")),this._useLogarithmicDepth&&(h.push("#define LOGARITHMICDEPTH"),-1===f.indexOf("logarithmicDepthConstant")&&f.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(f=f.slice(),p=p.slice(),x=x.slice(),d=this.customShaderNameResolve(this.name,f,p,x,h,l));let y=s?i._getDrawWrapper(void 0,!0):this._drawWrapper,A=y?.effect??null,v=y?.defines??null,I=h.join("\n"),D=A;return v!==I&&(D=o.createEffect(d,{attributes:l,uniformsNames:f,uniformBuffersNames:p,samplers:x,defines:I,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:M},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},o),s?i.setEffect(D,I,this._materialContext):y&&y.setEffect(D,I),this._onEffectCreatedObservable&&(g.effect=D,g.subMesh=i??t?.subMeshes[0]??null,this._onEffectCreatedObservable.notifyObservers(g))),y._wasPreviouslyUsingInstances=!!e,!(!D?.isReady()??!0)&&(A!==D&&a.resetCachedMaterial(),y._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(t,e){let i=this.getScene(),s=e??this.getEffect();s&&(-1!==this._options.uniforms.indexOf("world")&&s.setMatrix("world",t),-1!==this._options.uniforms.indexOf("worldView")&&(t.multiplyToRef(i.getViewMatrix(),this._cachedWorldViewMatrix),s.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(t.multiplyToRef(i.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),s.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&s.setMatrix("view",i.getViewMatrix()))}bindForSubMesh(t,e,i){this.bind(t,e,i._drawWrapperOverride?.effect,i)}bind(t,e,i,s){let r=s&&this._storeEffectOnSubMeshes,a=i??(r?s.effect:this.getEffect());if(!a)return;let n=this.getScene();this._activeEffect=a,this.bindOnlyWorldMatrix(t,i);let o=this._options.uniformBuffers,h=!1;if(a&&o&&o.length>0&&n.getEngine().supportsUniformBuffers)for(let i=0;i<o.length;++i)switch(o[i]){case"Mesh":e&&(e.getMeshUniformBuffer().bindToEffect(a,"Mesh"),e.transferToEffect(t));break;case"Scene":(0,m.ml)(a,n.getSceneUniformBuffer()),n.finalizeSceneUbo(),h=!0}let l=e&&r?this._mustRebind(n,a,s,e.visibility):n.getCachedMaterial()!==this;if(a&&l){let t;for(t in h||-1===this._options.uniforms.indexOf("view")||a.setMatrix("view",n.getViewMatrix()),h||-1===this._options.uniforms.indexOf("projection")||a.setMatrix("projection",n.getProjectionMatrix()),!h&&-1!==this._options.uniforms.indexOf("viewProjection")&&(a.setMatrix("viewProjection",n.getTransformMatrix()),this._multiview&&a.setMatrix("viewProjectionR",n._transformMatrixR)),n.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&a.setVector3("cameraPosition",n.activeCamera.globalPosition),(0,m.qx)(e,a),(0,_.an)(a,this,n),this._useLogarithmicDepth&&(0,m.gz)(r?s.materialDefines:a.defines,a,n),e&&(0,m.D1)(n,e,a),this._textures)a.setTexture(t,this._textures[t]);for(t in this._textureArrays)a.setTextureArray(t,this._textureArrays[t]);for(t in this._ints)a.setInt(t,this._ints[t]);for(t in this._uints)a.setUInt(t,this._uints[t]);for(t in this._floats)a.setFloat(t,this._floats[t]);for(t in this._floatsArrays)a.setArray(t,this._floatsArrays[t]);for(t in this._colors3)a.setColor3(t,this._colors3[t]);for(t in this._colors3Arrays)a.setArray3(t,this._colors3Arrays[t]);for(t in this._colors4){let e=this._colors4[t];a.setFloat4(t,e.r,e.g,e.b,e.a)}for(t in this._colors4Arrays)a.setArray4(t,this._colors4Arrays[t]);for(t in this._vectors2)a.setVector2(t,this._vectors2[t]);for(t in this._vectors3)a.setVector3(t,this._vectors3[t]);for(t in this._vectors4)a.setVector4(t,this._vectors4[t]);for(t in this._quaternions)a.setQuaternion(t,this._quaternions[t]);for(t in this._matrices)a.setMatrix(t,this._matrices[t]);for(t in this._matrixArrays)a.setMatrices(t,this._matrixArrays[t]);for(t in this._matrices3x3)a.setMatrix3x3(t,this._matrices3x3[t]);for(t in this._matrices2x2)a.setMatrix2x2(t,this._matrices2x2[t]);for(t in this._vectors2Arrays)a.setArray2(t,this._vectors2Arrays[t]);for(t in this._vectors3Arrays)a.setArray3(t,this._vectors3Arrays[t]);for(t in this._vectors4Arrays)a.setArray4(t,this._vectors4Arrays[t]);for(t in this._quaternionsArrays)a.setArray4(t,this._quaternionsArrays[t]);for(t in this._uniformBuffers){let e=this._uniformBuffers[t].getBuffer();e&&a.bindUniformBuffer(e,t)}let i=n.getEngine(),o=i.setExternalTexture;if(o)for(t in this._externalTextures)o.call(i,t,this._externalTextures[t]);let l=i.setTextureSampler;if(l)for(t in this._textureSamplers)l.call(i,t,this._textureSamplers[t]);let c=i.setStorageBuffer;if(c)for(t in this._storageBuffers)c.call(i,t,this._storageBuffers[t])}if(a&&e&&(l||!this.isFrozen)){let t=e.morphTargetManager;t&&t.numInfluencers>0&&(0,m.KG)(e,a);let i=e.bakedVertexAnimationManager;if(i&&i.isEnabled){let t=r?s._drawWrapper:this._drawWrapper;e.bakedVertexAnimationManager?.bind(a,!!t._wasPreviouslyUsingInstances)}}this._afterBind(e,a,s)}getActiveTextures(){let t=super.getActiveTextures();for(let e in this._textures)t.push(this._textures[e]);for(let e in this._textureArrays){let i=this._textureArrays[e];for(let e=0;e<i.length;e++)t.push(i[e])}return t}hasTexture(t){if(super.hasTexture(t))return!0;for(let e in this._textures)if(this._textures[e]===t)return!0;for(let e in this._textureArrays){let i=this._textureArrays[e];for(let e=0;e<i.length;e++)if(i[e]===t)return!0}return!1}clone(t){let e=s.p.Clone(()=>new p(t,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes),this);for(let i in e.name=t,e.id=t,"object"==typeof e._shaderPath&&(e._shaderPath={...e._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach(t=>{let e=this._options[t];Array.isArray(e)&&(this._options[t]=e.slice(0))}),this.stencil.copyTo(e.stencil),this._textures)e.setTexture(i,this._textures[i]);for(let t in this._textureArrays)e.setTextureArray(t,this._textureArrays[t]);for(let t in this._externalTextures)e.setExternalTexture(t,this._externalTextures[t]);for(let t in this._ints)e.setInt(t,this._ints[t]);for(let t in this._uints)e.setUInt(t,this._uints[t]);for(let t in this._floats)e.setFloat(t,this._floats[t]);for(let t in this._floatsArrays)e.setFloats(t,this._floatsArrays[t]);for(let t in this._colors3)e.setColor3(t,this._colors3[t]);for(let t in this._colors3Arrays)e._colors3Arrays[t]=this._colors3Arrays[t];for(let t in this._colors4)e.setColor4(t,this._colors4[t]);for(let t in this._colors4Arrays)e._colors4Arrays[t]=this._colors4Arrays[t];for(let t in this._vectors2)e.setVector2(t,this._vectors2[t]);for(let t in this._vectors3)e.setVector3(t,this._vectors3[t]);for(let t in this._vectors4)e.setVector4(t,this._vectors4[t]);for(let t in this._quaternions)e.setQuaternion(t,this._quaternions[t]);for(let t in this._quaternionsArrays)e._quaternionsArrays[t]=this._quaternionsArrays[t];for(let t in this._matrices)e.setMatrix(t,this._matrices[t]);for(let t in this._matrixArrays)e._matrixArrays[t]=this._matrixArrays[t].slice();for(let t in this._matrices3x3)e.setMatrix3x3(t,this._matrices3x3[t]);for(let t in this._matrices2x2)e.setMatrix2x2(t,this._matrices2x2[t]);for(let t in this._vectors2Arrays)e.setArray2(t,this._vectors2Arrays[t]);for(let t in this._vectors3Arrays)e.setArray3(t,this._vectors3Arrays[t]);for(let t in this._vectors4Arrays)e.setArray4(t,this._vectors4Arrays[t]);for(let t in this._uniformBuffers)e.setUniformBuffer(t,this._uniformBuffers[t]);for(let t in this._textureSamplers)e.setTextureSampler(t,this._textureSamplers[t]);for(let t in this._storageBuffers)e.setStorageBuffer(t,this._storageBuffers[t]);return e}dispose(t,e,i){if(e){let t;for(t in this._textures)this._textures[t].dispose();for(t in this._textureArrays){let e=this._textureArrays[t];for(let t=0;t<e.length;t++)e[t].dispose()}}this._textures={},super.dispose(t,e,i)}serialize(){let t;let e=s.p.Serialize(this);for(t in e.customType="BABYLON.ShaderMaterial",e.uniqueId=this.uniqueId,e.options=this._options,e.shaderPath=this._shaderPath,e.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,e.stencil=this.stencil.serialize(),e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];let i=this._textureArrays[t];for(let s=0;s<i.length;s++)e.textureArrays[t].push(i[s].serialize())}for(t in e.ints={},this._ints)e.ints[t]=this._ints[t];for(t in e.uints={},this._uints)e.uints[t]=this._uints[t];for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.floatsArrays={},this._floatsArrays)e.floatsArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.colors4Arrays={},this._colors4Arrays)e.colors4Arrays[t]=this._colors4Arrays[t];for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.quaternions={},this._quaternions)e.quaternions[t]=this._quaternions[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrixArray={},this._matrixArrays)e.matrixArray[t]=this._matrixArrays[t];for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in e.vectors4Arrays={},this._vectors4Arrays)e.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in e.quaternionsArrays={},this._quaternionsArrays)e.quaternionsArrays[t]=this._quaternionsArrays[t];return e}static Parse(t,e,i){let r;let n=s.p.Parse(()=>new p(t.name,e,t.shaderPath,t.options,t.storeEffectOnSubMeshes),t,e,i);for(r in t.stencil&&n.stencil.parse(t.stencil,e,i),t.textures)n.setTexture(r,o.x.Parse(t.textures[r],e,i));for(r in t.textureArrays){let s=t.textureArrays[r],a=[];for(let t=0;t<s.length;t++)a.push(o.x.Parse(s[t],e,i));n.setTextureArray(r,a)}for(r in t.ints)n.setInt(r,t.ints[r]);for(r in t.uints)n.setUInt(r,t.uints[r]);for(r in t.floats)n.setFloat(r,t.floats[r]);for(r in t.floatsArrays)n.setFloats(r,t.floatsArrays[r]);for(r in t.colors3)n.setColor3(r,l.Wo.FromArray(t.colors3[r]));for(r in t.colors3Arrays){let e=t.colors3Arrays[r].reduce((t,e,i)=>(i%3==0?t.push([e]):t[t.length-1].push(e),t),[]).map(t=>l.Wo.FromArray(t));n.setColor3Array(r,e)}for(r in t.colors4)n.setColor4(r,l.HE.FromArray(t.colors4[r]));for(r in t.colors4Arrays){let e=t.colors4Arrays[r].reduce((t,e,i)=>(i%4==0?t.push([e]):t[t.length-1].push(e),t),[]).map(t=>l.HE.FromArray(t));n.setColor4Array(r,e)}for(r in t.vectors2)n.setVector2(r,a.FM.FromArray(t.vectors2[r]));for(r in t.vectors3)n.setVector3(r,a.P.FromArray(t.vectors3[r]));for(r in t.vectors4)n.setVector4(r,a.Lt.FromArray(t.vectors4[r]));for(r in t.quaternions)n.setQuaternion(r,a._f.FromArray(t.quaternions[r]));for(r in t.matrices)n.setMatrix(r,a.y3.FromArray(t.matrices[r]));for(r in t.matrixArray)n._matrixArrays[r]=new Float32Array(t.matrixArray[r]);for(r in t.matrices3x3)n.setMatrix3x3(r,t.matrices3x3[r]);for(r in t.matrices2x2)n.setMatrix2x2(r,t.matrices2x2[r]);for(r in t.vectors2Arrays)n.setArray2(r,t.vectors2Arrays[r]);for(r in t.vectors3Arrays)n.setArray3(r,t.vectors3Arrays[r]);for(r in t.vectors4Arrays)n.setArray4(r,t.vectors4Arrays[r]);for(r in t.quaternionsArrays)n.setArray4(r,t.quaternionsArrays[r]);return n}static ParseFromFileAsync(t,e,i,s=""){return new Promise((r,a)=>{let n=new u.g;n.addEventListener("readystatechange",()=>{if(4==n.readyState){if(200==n.status){let e=JSON.parse(n.responseText),a=this.Parse(e,i||f.l.LastCreatedScene,s);t&&(a.name=t),r(a)}else a("Unable to load the ShaderMaterial")}}),n.open("GET",e),n.send()})}static ParseFromSnippetAsync(t,e,i=""){return new Promise((s,r)=>{let a=new u.g;a.addEventListener("readystatechange",()=>{if(4==a.readyState){if(200==a.status){let r=JSON.parse(JSON.parse(JSON.parse(a.responseText).jsonPayload).shaderMaterial),n=this.Parse(r,e||f.l.LastCreatedScene,i);n.snippetId=t,s(n)}else r("Unable to load the snippet "+t)}}),a.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),a.send()})}}p.SnippetUrl="https://snippet.babylonjs.com",p.CreateFromSnippetAsync=p.ParseFromSnippetAsync,(0,h.H7)("BABYLON.ShaderMaterial",p)},85017:function(t,e,i){i.d(e,{Qk:function(){return h},jY:function(){return o}});var s=i(39884),r=i(35823),a=i(89754),n=i(77210);function o(t){let e=0|(t.segments||32),i=t.diameterX||t.diameter||1,r=t.diameterY||t.diameter||1,o=t.diameterZ||t.diameter||1,h=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,l=t.slice&&t.slice<=0?1:t.slice||1,c=0===t.sideOrientation?0:t.sideOrientation||a.x.DEFAULTSIDE,u=!!t.dedupTopBottomIndices,d=new s.P(i/2,r/2,o/2),f=2+e,_=2*f,m=[],g=[],p=[],x=[];for(let t=0;t<=f;t++){let e=t/f,i=e*Math.PI*l;for(let t=0;t<=_;t++){let r=t/_,a=r*Math.PI*2*h,o=s.y3.RotationZ(-i),l=s.y3.RotationY(a),c=s.P.TransformCoordinates(s.P.Up(),o),u=s.P.TransformCoordinates(c,l),f=u.multiply(d),m=u.divide(d).normalize();g.push(f.x,f.y,f.z),p.push(m.x,m.y,m.z),x.push(r,n.VJ?1-e:e)}if(t>0){let e=g.length/3;for(let i=e-2*(_+1);i+_+2<e;i++)u?(t>1&&(m.push(i),m.push(i+1),m.push(i+_+1)),(t<f||l<1)&&(m.push(i+_+1),m.push(i+1),m.push(i+_+2))):(m.push(i),m.push(i+1),m.push(i+_+1),m.push(i+_+1),m.push(i+1),m.push(i+_+2))}}a.x._ComputeSides(c,g,m,p,x,t.frontUVs,t.backUVs);let M=new a.x;return M.indices=m,M.positions=g,M.normals=p,M.uvs=x,M}function h(t,e={},i=null){let s=new r.Kj(t,i);return e.sideOrientation=r.Kj._GetDefaultSideOrientation(e.sideOrientation),s._originalBuilderSideOrientation=e.sideOrientation,o(e).applyToMesh(s,e.updatable),s}a.x.CreateSphere=o,r.Kj.CreateSphere=(t,e,i,s,r,a)=>h(t,{segments:e,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:a,updatable:r},s)},98396:function(t,e,i){i.d(e,{x:function(){return v}});var s=i(46456),r=i(82877),a=i(39884),n=i(93954),o=i(89754),h=i(3860),l=i(88251),c=i(29892),u=i(76608),d=i(40515),f=i(10633),_=i(59874),m=i(57449),g=i(31644),p=i(50154),x=i(7724),M=i(22287),b=i(3176);class y{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=a.P.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class A{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new y,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new d.a,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class v extends h.Y{static get BILLBOARDMODE_NONE(){return h.Y.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return h.Y.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return h.Y.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return h.Y.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return h.Y.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return h.Y.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(t){this._internalAbstractMeshDataInfo._collisionRetryCount=t}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(t){this._internalAbstractMeshDataInfo._morphTargetManager!==t&&(this._internalAbstractMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(t){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==t&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=t,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(t){return!!super._updateNonUniformScalingState(t)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(t){this._internalAbstractMeshDataInfo._rawBoundingInfo=t}set onCollide(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)}set onCollisionPositionChange(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(t){if(this._internalAbstractMeshDataInfo._visibility===t)return;let e=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=t,(1===e&&1!==t||1!==e&&1===t)&&this._markSubMeshesAsDirty(t=>{t.markAsMiscDirty(),t.markAsPrePassDirty()})}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(t){this._internalAbstractMeshDataInfo._inheritVisibility=t}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let t=this._parentNode;for(;t;){let e=t.isVisible;if(void 0!==e)return e;t=t.parent}}return this._isVisible}set isVisible(t){this._isVisible=t}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(t){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=t}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(t){this._internalAbstractMeshDataInfo._renderingGroupId=t}get material(){return this._internalAbstractMeshDataInfo._material}set material(t){this._setMaterial(t)}_setMaterial(t){this._internalAbstractMeshDataInfo._material!==t&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(t){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[t]}setMaterialForRenderPass(t,e){this.resetDrawCache(t),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[t]=e}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(t){this._internalAbstractMeshDataInfo._enableDistantPicking=t}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(t)?-1:t}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=t}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(t)?-1:t}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(t){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=t}get lightSources(){return this._lightSources}set skeleton(t){let e=this._internalAbstractMeshDataInfo._skeleton;e&&e.needInitialSkinMatrix&&e._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(t,e=null){switch(super(t,e,!1),this._internalAbstractMeshDataInfo=new A,this._waitingMaterialId=null,this.cullingStrategy=v.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new r.y$,this.onCollisionPositionChangeObservable=new r.y$,this.onMaterialChangedObservable=new r.y$,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=m.Wo.Red(),this.outlineWidth=.02,this.overlayColor=m.Wo.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new a.P(.5,1,.5),this.ellipsoidOffset=new a.P(0,0,0),this.edgesWidth=1,this.edgesColor=new m.HE(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=[],this._unIndexed=!1,this._lightSources=[],this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new r.y$,this._onCollisionPositionChange=(t,e,i=null)=>{e.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>b.a.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),i&&this.onCollideObservable.notifyObservers(i),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(e=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new u.M(this.getScene().getEngine(),void 0,void 0,t,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),e.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(t){let e=this._uniformBuffer;e.updateMatrix("world",t),e.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),e.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(t){let e="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");e+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);let i=this._internalAbstractMeshDataInfo._skeleton;return i&&(e+=", skeleton: "+i.name),t&&(e+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode]+", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),e}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==h.Y.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(t,e=!0){return this.actionManager&&(e||this.actionManager.isRecursive)&&(!t||this.actionManager.hasSpecificTrigger(t))?this.actionManager:this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_rebuild(t=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(let t of this.subMeshes)t._rebuild();this.resetDrawCache()}}_resyncLightSources(){for(let t of(this._lightSources.length=0,this.getScene().lights))t.isEnabled()&&t.canAffectMesh(this)&&this._lightSources.push(t);this._markSubMeshesAsLightDirty()}_resyncLightSource(t){let e=t.isEnabled()&&t.canAffectMesh(this),i=this._lightSources.indexOf(t),s=!1;if(-1===i){if(!e)return;this._lightSources.push(t)}else{if(e)return;s=!0,this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty(s)}_unBindEffect(){for(let t of this.subMeshes)t.setEffect(null)}_removeLightSource(t,e){let i=this._lightSources.indexOf(t);-1!==i&&(this._lightSources.splice(i,1),this._markSubMeshesAsLightDirty(e))}_markSubMeshesAsDirty(t){if(this.subMeshes)for(let e of this.subMeshes)for(let i=0;i<e._drawWrappers.length;++i){let s=e._drawWrappers[i];s&&s.defines&&s.defines.markAllAsDirty&&t(s.defines)}}_markSubMeshesAsLightDirty(t=!1){this._markSubMeshesAsDirty(e=>e.markAsLightDirty(t))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty(t=>t.markAsAttributesDirty())}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty(t=>t.markAsMiscDirty())}markAsDirty(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}resetDrawCache(t){if(this.subMeshes)for(let e of this.subMeshes)e.resetDrawCache(t)}get isBlocked(){return!1}getLOD(t){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(t){return null}setVerticesData(t,e,i,s){return this}updateVerticesData(t,e,i,s){return this}setIndices(t,e){return this}isVerticesDataPresent(t){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(t){return this._boundingInfo=t,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(t,e,i){return this._boundingInfo=new c.j(t,e,i),this._boundingInfo}normalizeToUnitCube(t=!0,e=!1,i){return super.normalizeToUnitCube(t,e,i)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(n.o.MatricesIndicesKind)&&this.isVerticesDataPresent(n.o.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(t){}_activate(t,e){return this._renderId=t,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===h.Y.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(t,e,i){return this.position.addInPlace(this.calcMovePOV(t,e,i)),this}calcMovePOV(t,e,i){let s=new a.y3;(this.rotationQuaternion?this.rotationQuaternion:a._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(s);let r=a.P.Zero(),n=this.definedFacingForward?-1:1;return a.P.TransformCoordinatesFromFloatsToRef(t*n,e,i*n,s,r),r}rotatePOV(t,e,i){return this.rotation.addInPlace(this.calcRotatePOV(t,e,i)),this}calcRotatePOV(t,e,i){let s=this.definedFacingForward?1:-1;return new a.P(t*s,e,i*s)}_refreshBoundingInfo(t,e){if(t){let i=(0,_.k)(t,0,this.getTotalVertices(),e);this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new c.j(i.minimum,i.maximum)}if(this.subMeshes)for(let e=0;e<this.subMeshes.length;e++)this.subMeshes[e].refreshBoundingInfo(t);this._updateBoundingInfo()}_refreshBoundingInfoDirect(t){if(this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new c.j(t.minimum,t.maximum),this.subMeshes)for(let t=0;t<this.subMeshes.length;t++)this.subMeshes[t].refreshBoundingInfo(null);this._updateBoundingInfo()}static _ApplySkeleton(t,e,i,s,r,o,h){!function(t,e,i,s,r,o,h){let l=a.jp.Vector3[0],c=a.jp.Matrix[0],u=a.jp.Matrix[1],d=e===n.o.NormalKind?a.P.TransformNormalFromFloatsToRef:a.P.TransformCoordinatesFromFloatsToRef;for(let e=0,n=0;e<t.length;e+=3,n+=4){let f,_;for(c.reset(),f=0;f<4;f++)(_=r[n+f])>0&&(a.y3.FromFloat32ArrayToRefScaled(i,Math.floor(16*s[n+f]),_,u),c.addToSelf(u));if(o&&h)for(f=0;f<4;f++)(_=h[n+f])>0&&(a.y3.FromFloat32ArrayToRefScaled(i,Math.floor(16*o[n+f]),_,u),c.addToSelf(u));d(t[e],t[e+1],t[e+2],c,l),l.toArray(t,e)}}(t,e,i,s,r,o,h)}_getData(t,e,i=n.o.PositionKind){let s=t.cache,r=t=>{if(s){let e=s._vertexData||(s._vertexData={});return e[t]||this.copyVerticesData(t,e),e[t]}return this.getVerticesData(t)};if(e||(e=r(i)),!e)return null;if(s?(s._outputData?s._outputData.set(e):s._outputData=new Float32Array(e),e=s._outputData):(t.applyMorph&&this.morphTargetManager||t.applySkeleton&&this.skeleton)&&(e=e.slice()),t.applyMorph&&this.morphTargetManager&&function(t,e,i){let s=null;switch(e){case n.o.PositionKind:s=t=>t.getPositions();break;case n.o.NormalKind:s=t=>t.getNormals();break;case n.o.TangentKind:s=t=>t.getTangents();break;case n.o.UVKind:s=t=>t.getUVs();break;default:return}for(let e=0;e<t.length;e++){let r=t[e];for(let a=0;a<i.numTargets;a++){let n=i.getTarget(a),o=n.influence;if(0!==o){let i=s(n);i&&(r+=(i[e]-t[e])*o)}}t[e]=r}}(e,i,this.morphTargetManager),t.applySkeleton&&this.skeleton){let t=r(n.o.MatricesIndicesKind),s=r(n.o.MatricesWeightsKind);if(s&&t){let a=this.numBoneInfluencers>4,o=a?r(n.o.MatricesIndicesExtraKind):null,h=a?r(n.o.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this);v._ApplySkeleton(e,i,l,t,s,o,h)}}if(!1!==t.updatePositionsArray&&i===n.o.PositionKind){let t=this._internalAbstractMeshDataInfo._positions||[],i=t.length;if(t.length=e.length/3,i<t.length)for(let e=i;e<t.length;e++)t[e]=new a.P;for(let i=0,s=0;i<t.length;i++,s+=3)t[i].copyFromFloats(e[s],e[s+1],e[s+2]);this._internalAbstractMeshDataInfo._positions=t}return e}getNormalsData(t=!1,e=!1){return this._getData({applySkeleton:t,applyMorph:e,updatePositionsArray:!1},null,n.o.NormalKind)}getPositionData(t=!1,e=!1,i=null){return this._getData({applySkeleton:t,applyMorph:e,updatePositionsArray:!1},i,n.o.PositionKind)}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new c.j(a.P.Zero(),a.P.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(t){if(!this.subMeshes)return this;let e=this.subMeshes.length;for(let i=0;i<e;i++){let s=this.subMeshes[i];(e>1||!s.IsGlobal)&&s.updateBoundingInfo(t)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(t){return this.getBoundingInfo().isInFrustum(t,this.cullingStrategy)}isCompletelyInFrustum(t){return this.getBoundingInfo().isCompletelyInFrustum(t)}intersectsMesh(t,e=!1,i){let s=this.getBoundingInfo(),r=t.getBoundingInfo();if(s.intersects(r,e))return!0;if(i){for(let i of this.getChildMeshes())if(i.intersectsMesh(t,e,!0))return!0}return!1}intersectsPoint(t){return this.getBoundingInfo().intersectsPoint(t)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(t){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=t}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(t){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);let e=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=e.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,e.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(t,e,i){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(e)){t._lastColliderTransformMatrix=e.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];let i=t.verticesStart,s=t.verticesStart+t.verticesCount;for(let r=i;r<s;r++)t._lastColliderWorldVertices.push(a.P.TransformCoordinates(this._positions[r],e))}return i._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this,this._shouldConvertRHS(),t.getMaterial()?.fillMode===7),this}_processCollisionsForSubMeshes(t,e){let i=this._scene.getCollidingSubMeshCandidates(this,t),s=i.length;for(let r=0;r<s;r++){let a=i.data[r];(!(s>1)||a._checkCollision(t))&&this._collideForSubMesh(a,e,t)}return this}_shouldConvertRHS(){return!1}_checkCollision(t){if(!this.getBoundingInfo()._checkCollision(t))return this;let e=a.jp.Matrix[0],i=a.jp.Matrix[1];return a.y3.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,e),this.worldMatrixFromCache.multiplyToRef(e,i),this._processCollisionsForSubMeshes(t,i),this}_generatePointsArray(){return!1}intersects(t,e,i,s=!1,r,n=!1){let o=new l.p,h=this.getClassName(),c="InstancedLinesMesh"===h||"LinesMesh"===h||"GreasedLineMesh"===h?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes||!n&&(!t.intersectsSphere(u.boundingSphere,c)||!t.intersectsBox(u.boundingBox,c)))return o;if(s)return o.hit=!n,o.pickedMesh=n?null:this,o.distance=n?0:a.P.Distance(t.origin,u.boundingSphere.center),o.subMeshId=0,o;if(!this._generatePointsArray())return o;let d=null,f=this._scene.getIntersectingSubMeshCandidates(this,t),_=f.length,m=!1;for(let t=0;t<_;t++){let e=f.data[t].getMaterial();if(e&&(7==e.fillMode||0==e.fillMode||1==e.fillMode||2==e.fillMode||4==e.fillMode)){m=!0;break}}if(!m)return o.hit=!0,o.pickedMesh=this,o.distance=a.P.Distance(t.origin,u.boundingSphere.center),o.subMeshId=-1,o;for(let s=0;s<_;s++){let r=f.data[s];if(_>1&&!n&&!r.canIntersects(t))continue;let a=r.intersects(t,this._positions,this.getIndices(),e,i);if(a&&(e||!d||a.distance<d.distance)&&((d=a).subMeshId=s,e))break}if(d){let e=r??this.getWorldMatrix(),i=a.jp.Vector3[0],s=a.jp.Vector3[1];a.P.TransformCoordinatesToRef(t.origin,e,i),t.direction.scaleToRef(d.distance,s);let n=a.P.TransformNormal(s,e).addInPlace(i);o.hit=!0,o.distance=a.P.Distance(i,n),o.pickedPoint=n,o.pickedMesh=this,o.bu=d.bu||0,o.bv=d.bv||0,o.subMeshFaceId=d.faceId,o.faceId=d.faceId+f.data[d.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),o.subMeshId=d.subMeshId}return o}clone(t,e,i){return null}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];return this}dispose(t,e=!1){let i;let s=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),s.freeActiveMeshes(),s.freeRenderingGroups(),s.renderingManager.maintainStateBetweenFrames&&s.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some(t=>t!==this&&t.actionManager===this.actionManager)&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){let t=this._intersectionsInProgress[i],e=t._intersectionsInProgress.indexOf(this);t._intersectionsInProgress.splice(e,1)}this._intersectionsInProgress.length=0,s.lights.forEach(t=>{let e=t.includedOnlyMeshes.indexOf(this);-1!==e&&t.includedOnlyMeshes.splice(e,1),-1!==(e=t.excludedMeshes.indexOf(this))&&t.excludedMeshes.splice(e,1);let i=t.getShadowGenerators();if(i){let t=i.values();for(let i=t.next();!0!==i.done;i=t.next()){let t=i.value.getShadowMap();t&&t.renderList&&-1!==(e=t.renderList.indexOf(this))&&t.renderList.splice(e,1)}}}),("InstancedMesh"!==this.getClassName()||"InstancedLinesMesh"!==this.getClassName())&&this.releaseSubMeshes();let r=s.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,r.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),r.wipeCaches(),s.removeMesh(this),this._parentContainer){let t=this._parentContainer.meshes.indexOf(this);t>-1&&this._parentContainer.meshes.splice(t,1),this._parentContainer=null}if(e&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(i=0;i<s.particleSystems.length;i++)s.particleSystems[i].emitter===this&&(s.particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(t,e)}_initFacetData(){let t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=[]),t.facetPositions||(t.facetPositions=[]),t.facetPartitioning||(t.facetPartitioning=[]),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(let e=0;e<t.facetNb;e++)t.facetNormals[e]=a.P.Zero(),t.facetPositions[e]=a.P.Zero();return t.facetDataEnabled=!0,this}updateFacetData(){let t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();let e=this.getVerticesData(n.o.PositionKind),i=this.getIndices(),s=this.getVerticesData(n.o.NormalKind),r=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,i instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(i);else{let e=!1;for(let t=0;t<i.length;t++)if(i[t]>65535){e=!0;break}e?t.depthSortedIndices=new Uint32Array(i):t.depthSortedIndices=new Uint16Array(i)}if(t.facetDepthSortFunction=function(t,e){return e.sqDistance-t.sqDistance},!t.facetDepthSortFrom){let e=this.getScene().activeCamera;t.facetDepthSortFrom=e?e.position:a.P.Zero()}t.depthSortedFacets=[];for(let e=0;e<t.facetNb;e++){let i={ind:3*e,sqDistance:0};t.depthSortedFacets.push(i)}t.invertedMatrix=a.y3.Identity(),t.facetDepthSortOrigin=a.P.Zero()}t.bbSize.x=r.maximum.x-r.minimum.x>g.kn?r.maximum.x-r.minimum.x:g.kn,t.bbSize.y=r.maximum.y-r.minimum.y>g.kn?r.maximum.y-r.minimum.y:g.kn,t.bbSize.z=r.maximum.z-r.minimum.z>g.kn?r.maximum.z-r.minimum.z:g.kn;let h=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(h=h>t.bbSize.z?h:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/h),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/h),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/h),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=r,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),a.P.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,s&&o.x.ComputeNormals(e,i,s,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);let e=t.depthSortedIndices.length/3|0;for(let s=0;s<e;s++){let e=t.depthSortedFacets[s].ind;t.depthSortedIndices[3*s]=i[e],t.depthSortedIndices[3*s+1]=i[e+1],t.depthSortedIndices[3*s+2]=i[e+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals}getFacetLocalPositions(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions}getFacetLocalPartitioning(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning}getFacetPosition(t){let e=a.P.Zero();return this.getFacetPositionToRef(t,e),e}getFacetPositionToRef(t,e){let i=this.getFacetLocalPositions()[t],s=this.getWorldMatrix();return a.P.TransformCoordinatesToRef(i,s,e),this}getFacetNormal(t){let e=a.P.Zero();return this.getFacetNormalToRef(t,e),e}getFacetNormalToRef(t,e){let i=this.getFacetLocalNormals()[t];return a.P.TransformNormalToRef(i,this.getWorldMatrix(),e),this}getFacetsAtLocalCoordinates(t,e,i){let s=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((t-s.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),n=Math.floor((e-s.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),o=Math.floor((i-s.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return a<0||a>r.subDiv.max||n<0||n>r.subDiv.max||o<0||o>r.subDiv.max?null:r.facetPartitioning[a+r.subDiv.max*n+r.subDiv.max*r.subDiv.max*o]}getClosestFacetAtCoordinates(t,e,i,s,r=!1,n=!0){let o=this.getWorldMatrix(),h=a.jp.Matrix[5];o.invertToRef(h);let l=a.jp.Vector3[8];a.P.TransformCoordinatesFromFloatsToRef(t,e,i,h,l);let c=this.getClosestFacetAtLocalCoordinates(l.x,l.y,l.z,s,r,n);return s&&a.P.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,o,s),c}getClosestFacetAtLocalCoordinates(t,e,i,s,r=!1,a=!0){let n,o,h,l=null,c=0,u=0,d=0,f=0,_=0,m=0,g=0,p=0,x=this.getFacetLocalPositions(),M=this.getFacetLocalNormals(),b=this.getFacetsAtLocalCoordinates(t,e,i);if(!b)return null;let y=Number.MAX_VALUE,A=y;for(let v=0;v<b.length;v++)o=M[n=b[v]],f=(t-(h=x[n]).x)*o.x+(e-h.y)*o.y+(i-h.z)*o.z,(!r||r&&a&&f>=0||r&&!a&&f<=0)&&(f=o.x*h.x+o.y*h.y+o.z*h.z,_=-(o.x*t+o.y*e+o.z*i-f)/(o.x*o.x+o.y*o.y+o.z*o.z),m=t+o.x*_,g=e+o.y*_,p=i+o.z*_,(A=(c=m-t)*c+(u=g-e)*u+(d=p-i)*d)<y&&(y=A,l=n,s&&(s.x=m,s.y=g,s.z=p)));return l}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=[],t.facetNormals=[],t.facetPartitioning=[],t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this}updateIndices(t,e,i=!1){return this}createNormals(t){let e;let i=this.getVerticesData(n.o.PositionKind),s=this.getIndices();return e=this.isVerticesDataPresent(n.o.NormalKind)?this.getVerticesData(n.o.NormalKind):[],o.x.ComputeNormals(i,s,e,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(n.o.NormalKind,e,t),this}alignWithNormal(t,e){e||(e=p.RD.Y);let i=a.jp.Vector3[0],s=a.jp.Vector3[1];return a.P.CrossToRef(e,t,s),a.P.CrossToRef(t,s,i),this.rotationQuaternion?a._f.RotationQuaternionFromAxisToRef(i,t,s,this.rotationQuaternion):a.P.RotationFromAxisToRef(i,t,s,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,f.S)("EdgesRenderer")}enableEdgesRendering(t,e,i){throw(0,f.S)("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter(t=>t.emitter===this)}}v.OCCLUSION_TYPE_NONE=0,v.OCCLUSION_TYPE_OPTIMISTIC=1,v.OCCLUSION_TYPE_STRICT=2,v.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,v.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,v.CULLINGSTRATEGY_STANDARD=0,v.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,s.gn)([M.G6.filter((...[t,e,i,s,r])=>!Array.isArray(t)&&!Array.isArray(e)&&!Array.isArray(i)&&!Array.isArray(s)&&!Array.isArray(r))],v,"_ApplySkeleton",null),(0,x.H7)("BABYLON.AbstractMesh",v)},66415:function(t,e,i){i.d(e,{Z:function(){return g}});var s=i(39884),r=i(57449),a=i(89754),n=i(93954),o=i(34066),h=i(27243),l=i(29892),c=i(4224),u=i(88388),d=i(59874),f=i(51092),_=i(77210),m=i(94677);class g{get boundingBias(){return this._boundingBias}set boundingBias(t){this._boundingBias?this._boundingBias.copyFrom(t):this._boundingBias=t.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(t){let e=new g(g.RandomId(),t.getScene());return e.applyToMesh(t),e}get meshes(){return this._meshes}constructor(t,e,i,s=!1,r=null){if(this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=e||f.l.LastCreatedScene,!this._scene)return;this.id=t,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=s,i?this.setAllVerticesData(i,s):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),r&&(this.applyToMesh(r),r.computeWorldMatrix(!0))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let t=0;t<this._meshes.length;t++)if(!this._meshes[t].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));let t=new Set;for(let e in this._vertexBuffers)t.add(this._vertexBuffers[e].getWrapperBuffer());t.forEach(t=>{t._rebuild()})}setAllVerticesData(t,e){t.applyToGeometry(this,e),this._notifyUpdate()}setVerticesData(t,e,i=!1,s){i&&Array.isArray(e)&&(e=new Float32Array(e));let r=new n.o(this._engine,e,t,{updatable:i,postponeInternalCreation:0===this._meshes.length,stride:s,label:"Geometry_"+this.id+"_"+t});this.setVerticesBuffer(r)}removeVerticesData(t){this._vertexBuffers[t]&&(this._vertexBuffers[t].dispose(),delete this._vertexBuffers[t]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(t,e=null,i=!0){let r=t.getKind();this._vertexBuffers[r]&&i&&this._vertexBuffers[r].dispose(),t._buffer&&t._buffer._increaseReferences(),this._vertexBuffers[r]=t;let a=this._meshes,o=a.length;if(r===n.o.PositionKind){this._totalVertices=e??t._maxVerticesCount,this._updateExtend(t.getFloatData(this._totalVertices)),this._resetPointsArrayCache();let i=this._extend&&this._extend.minimum||new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=this._extend&&this._extend.maximum||new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let t=0;t<o;t++){let e=a[t];e.buildBoundingInfo(i,r),e._createGlobalSubMesh(e.isUnIndexed),e.computeWorldMatrix(!0),e.synchronizeInstances()}}this._notifyUpdate(r)}updateVerticesDataDirectly(t,e,i,s=!1){let r=this.getVertexBuffer(t);r&&(r.updateDirectly(e,i,s),this._notifyUpdate(t))}updateVerticesData(t,e,i=!1){let s=this.getVertexBuffer(t);s&&(s.update(e),t===n.o.PositionKind&&this._updateBoundingInfo(i,e),this._notifyUpdate(t))}_updateBoundingInfo(t,e){if(t&&this._updateExtend(e),this._resetPointsArrayCache(),t)for(let t of this._meshes)for(let e of(t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum),t.subMeshes))e.refreshBoundingInfo()}_bind(t,e,i,s){if(!t)return;void 0===e&&(e=this._indexBuffer);let r=this.getVertexBuffers();if(!r)return;if(e!=this._indexBuffer||!this._vertexArrayObjects&&!s){this._engine.bindBuffers(r,e,t,i);return}let a=s||this._vertexArrayObjects,n=this._engine;a[t.key]||(a[t.key]=n.recordVertexArrayObject(r,e,t,i)),n.bindVertexArrayObject(a[t.key],e)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(t,e,i){let s=this.getVertexBuffer(t);return s?s.getFloatData(this._totalVertices,i||e&&1!==this._meshes.length):null}copyVerticesData(t,e){let i=this.getVertexBuffer(t);if(!i)return;e[t]||(e[t]=new Float32Array(this._totalVertices*i.getSize()));let s=i.getData();s&&(0,m.t)(s,i.getSize(),i.type,i.byteOffset,i.byteStride,i.normalized,this._totalVertices,e[t])}isVertexBufferUpdatable(t){let e=this._vertexBuffers[t];return!!e&&e.isUpdatable()}getVertexBuffer(t){return this.isReady()?this._vertexBuffers[t]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(t){return this._vertexBuffers?void 0!==this._vertexBuffers[t]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)}getVerticesDataKinds(){let t;let e=[];if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e}updateIndices(t,e,i=!1){if(this._indexBuffer){if(this._indexBufferIsUpdatable){let s=t.length!==this._indices.length;if(i||(this._indices=t.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,t,e),s)for(let t of this._meshes)t._createGlobalSubMesh(!0)}else this.setIndices(t,null,!0)}}setIndexBuffer(t,e,i){for(let s of(this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=t,this._totalVertices=e,this._totalIndices=i,t.is32Bits||(t.is32Bits=this._totalIndices>65535),this._meshes))s._createGlobalSubMesh(!0),s.synchronizeInstances();this._notifyUpdate()}setIndices(t,e=null,i=!1,s=!1){for(let r of(this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=t,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i,"Geometry_"+this.id+"_IndexBuffer")),void 0!=e&&(this._totalVertices=e),this._meshes))r._createGlobalSubMesh(!s),r.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}getIndices(t,e){if(!this.isReady())return null;let i=this._indices;return e||t&&1!==this._meshes.length?i.slice():i}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(t=null){t&&this._vertexArrayObjects&&this._vertexArrayObjects[t.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t.key]),delete this._vertexArrayObjects[t.key])}releaseForMesh(t,e){let i=this._meshes,s=i.indexOf(t);-1!==s&&(i.splice(s,1),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject(),t._geometry=null,0===i.length&&e&&this.dispose())}applyToMesh(t){if(t._geometry===this)return;let e=t._geometry;e&&e.releaseForMesh(t),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject();let i=this._meshes;t._geometry=this,t._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(t),this.isReady()?this._applyToMesh(t):this._boundingInfo&&t.setBoundingInfo(this._boundingInfo)}_updateExtend(t=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!t&&!(t=this.getVerticesData(n.o.PositionKind)))return;this._extend=(0,d.k)(t,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(t){let e=this._meshes.length;for(let i in this._vertexBuffers)1===e&&this._vertexBuffers[i].create(),i===n.o.PositionKind&&(this._extend||this._updateExtend(),t.buildBoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(t.isUnIndexed),t._updateBoundingInfo());1===e&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),t._syncGeometryWithMorphTargetManager(),t.synchronizeInstances()}_notifyUpdate(t){for(let e of(this.onGeometryUpdated&&this.onGeometryUpdated(this,t),this._vertexArrayObjects&&this._disposeVertexArrayObjects(),this._meshes))e._markSubMeshesAsAttributesDirty()}load(t,e){if(2!==this.delayLoadState){if(this.isReady()){e&&e();return}this.delayLoadState=2,this._queueLoad(t,e)}}_queueLoad(t,e){this.delayLoadingFile&&(t.addPendingData(this),t._loadFile(this.delayLoadingFile,i=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(i),this),this.delayLoadState=1,this._delayInfo=[],t.removePendingData(this);let s=this._meshes,r=s.length;for(let t=0;t<r;t++)this._applyToMesh(s[t]);e&&e()},void 0,!0))}toLeftHanded(){let t=this.getIndices(!1);if(null!=t&&t.length>0){for(let e=0;e<t.length;e+=3){let i=t[e+0];t[e+0]=t[e+2],t[e+2]=i}this.setIndices(t)}let e=this.getVerticesData(n.o.PositionKind,!1);if(null!=e&&e.length>0){for(let t=0;t<e.length;t+=3)e[t+2]=-e[t+2];this.setVerticesData(n.o.PositionKind,e,!1)}let i=this.getVerticesData(n.o.NormalKind,!1);if(null!=i&&i.length>0){for(let t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(n.o.NormalKind,i,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;let t=this.getVerticesData(n.o.PositionKind);if(!t||0===t.length)return!1;for(let e=3*this._positionsCache.length,i=this._positionsCache.length;e<t.length;e+=3,++i)this._positionsCache[i]=s.P.FromArray(t,e);for(let e=0,i=0;e<t.length;e+=3,++i)this._positionsCache[i].set(t[0+e],t[1+e],t[2+e]);return this._positionsCache.length=t.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(let t in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t]);this._vertexArrayObjects={};let t=this._meshes,e=t.length;for(let i=0;i<e;i++)t[i]._invalidateInstanceVertexArrayObject()}}dispose(){let t;let e=this._meshes,i=e.length;for(t=0;t<i;t++)this.releaseForMesh(e[t]);for(let t in this._meshes.length=0,this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[t].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){let t=this._parentContainer.geometries.indexOf(this);t>-1&&this._parentContainer.geometries.splice(t,1),this._parentContainer=null}this._isDisposed=!0}copy(t){let e;let i=new a.x;i.indices=[];let s=this.getIndices();if(s)for(let t=0;t<s.length;t++)i.indices.push(s[t]);let r=!1,n=!1;for(e in this._vertexBuffers){let t=this.getVerticesData(e);if(t&&(t instanceof Float32Array?i.set(new Float32Array(t),e):i.set(t.slice(0),e),!n)){let t=this.getVertexBuffer(e);t&&(n=!(r=t.isUpdatable()))}}let o=new g(t,this._scene,i,r);for(e in o.delayLoadState=this.delayLoadState,o.delayLoadingFile=this.delayLoadingFile,o._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)o._delayInfo=o._delayInfo||[],o._delayInfo.push(e);return o._boundingInfo=new l.j(this._extend.minimum,this._extend.maximum),o}serialize(){let t={};return t.id=this.id,t.uniqueId=this.uniqueId,t.updatable=this._updatable,u.$&&u.$.HasTags(this)&&(t.tags=u.$.GetTags(this)),t}_toNumberArray(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)}clearCachedData(){for(let t in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,t)&&(this._vertexBuffers[t]._buffer._data=null)}serializeVerticeData(){let t=this.serialize();return this.isVerticesDataPresent(n.o.PositionKind)&&(t.positions=this._toNumberArray(this.getVerticesData(n.o.PositionKind)),this.isVertexBufferUpdatable(n.o.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(n.o.NormalKind)&&(t.normals=this._toNumberArray(this.getVerticesData(n.o.NormalKind)),this.isVertexBufferUpdatable(n.o.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(n.o.TangentKind)&&(t.tangents=this._toNumberArray(this.getVerticesData(n.o.TangentKind)),this.isVertexBufferUpdatable(n.o.TangentKind)&&(t.tangents._updatable=!0)),this.isVerticesDataPresent(n.o.UVKind)&&(t.uvs=this._toNumberArray(this.getVerticesData(n.o.UVKind)),this.isVertexBufferUpdatable(n.o.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(n.o.UV2Kind)&&(t.uvs2=this._toNumberArray(this.getVerticesData(n.o.UV2Kind)),this.isVertexBufferUpdatable(n.o.UV2Kind)&&(t.uvs2._updatable=!0)),this.isVerticesDataPresent(n.o.UV3Kind)&&(t.uvs3=this._toNumberArray(this.getVerticesData(n.o.UV3Kind)),this.isVertexBufferUpdatable(n.o.UV3Kind)&&(t.uvs3._updatable=!0)),this.isVerticesDataPresent(n.o.UV4Kind)&&(t.uvs4=this._toNumberArray(this.getVerticesData(n.o.UV4Kind)),this.isVertexBufferUpdatable(n.o.UV4Kind)&&(t.uvs4._updatable=!0)),this.isVerticesDataPresent(n.o.UV5Kind)&&(t.uvs5=this._toNumberArray(this.getVerticesData(n.o.UV5Kind)),this.isVertexBufferUpdatable(n.o.UV5Kind)&&(t.uvs5._updatable=!0)),this.isVerticesDataPresent(n.o.UV6Kind)&&(t.uvs6=this._toNumberArray(this.getVerticesData(n.o.UV6Kind)),this.isVertexBufferUpdatable(n.o.UV6Kind)&&(t.uvs6._updatable=!0)),this.isVerticesDataPresent(n.o.ColorKind)&&(t.colors=this._toNumberArray(this.getVerticesData(n.o.ColorKind)),this.isVertexBufferUpdatable(n.o.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(n.o.MatricesIndicesKind)&&(t.matricesIndices=this._toNumberArray(this.getVerticesData(n.o.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(n.o.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(n.o.MatricesWeightsKind)&&(t.matricesWeights=this._toNumberArray(this.getVerticesData(n.o.MatricesWeightsKind)),this.isVertexBufferUpdatable(n.o.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this._toNumberArray(this.getIndices()),t}static ExtractFromMesh(t,e){let i=t._geometry;return i?i.copy(e):null}static RandomId(){return c.w1.RandomId()}static _GetGeometryByLoadedUniqueId(t,e){for(let i=0;i<e.geometries.length;i++)if(e.geometries[i]._loadedUniqueId===t)return e.geometries[i];return null}static _ImportGeometry(t,e){let i=e.getScene(),s=t.geometryUniqueId,a=t.geometryId;if(s||a){let t=s?this._GetGeometryByLoadedUniqueId(s,i):i.getGeometryById(a);t&&t.applyToMesh(e)}else if(t instanceof ArrayBuffer){let i=e._binaryInfo;if(i.positionsAttrDesc&&i.positionsAttrDesc.count>0){let s=new Float32Array(t,i.positionsAttrDesc.offset,i.positionsAttrDesc.count);e.setVerticesData(n.o.PositionKind,s,!1)}if(i.normalsAttrDesc&&i.normalsAttrDesc.count>0){let s=new Float32Array(t,i.normalsAttrDesc.offset,i.normalsAttrDesc.count);e.setVerticesData(n.o.NormalKind,s,!1)}if(i.tangetsAttrDesc&&i.tangetsAttrDesc.count>0){let s=new Float32Array(t,i.tangetsAttrDesc.offset,i.tangetsAttrDesc.count);e.setVerticesData(n.o.TangentKind,s,!1)}if(i.uvsAttrDesc&&i.uvsAttrDesc.count>0){let s=new Float32Array(t,i.uvsAttrDesc.offset,i.uvsAttrDesc.count);if(_.VJ)for(let t=1;t<s.length;t+=2)s[t]=1-s[t];e.setVerticesData(n.o.UVKind,s,!1)}if(i.uvs2AttrDesc&&i.uvs2AttrDesc.count>0){let s=new Float32Array(t,i.uvs2AttrDesc.offset,i.uvs2AttrDesc.count);if(_.VJ)for(let t=1;t<s.length;t+=2)s[t]=1-s[t];e.setVerticesData(n.o.UV2Kind,s,!1)}if(i.uvs3AttrDesc&&i.uvs3AttrDesc.count>0){let s=new Float32Array(t,i.uvs3AttrDesc.offset,i.uvs3AttrDesc.count);if(_.VJ)for(let t=1;t<s.length;t+=2)s[t]=1-s[t];e.setVerticesData(n.o.UV3Kind,s,!1)}if(i.uvs4AttrDesc&&i.uvs4AttrDesc.count>0){let s=new Float32Array(t,i.uvs4AttrDesc.offset,i.uvs4AttrDesc.count);if(_.VJ)for(let t=1;t<s.length;t+=2)s[t]=1-s[t];e.setVerticesData(n.o.UV4Kind,s,!1)}if(i.uvs5AttrDesc&&i.uvs5AttrDesc.count>0){let s=new Float32Array(t,i.uvs5AttrDesc.offset,i.uvs5AttrDesc.count);if(_.VJ)for(let t=1;t<s.length;t+=2)s[t]=1-s[t];e.setVerticesData(n.o.UV5Kind,s,!1)}if(i.uvs6AttrDesc&&i.uvs6AttrDesc.count>0){let s=new Float32Array(t,i.uvs6AttrDesc.offset,i.uvs6AttrDesc.count);if(_.VJ)for(let t=1;t<s.length;t+=2)s[t]=1-s[t];e.setVerticesData(n.o.UV6Kind,s,!1)}if(i.colorsAttrDesc&&i.colorsAttrDesc.count>0){let s=new Float32Array(t,i.colorsAttrDesc.offset,i.colorsAttrDesc.count);e.setVerticesData(n.o.ColorKind,s,!1,i.colorsAttrDesc.stride)}if(i.matricesIndicesAttrDesc&&i.matricesIndicesAttrDesc.count>0){let s=new Int32Array(t,i.matricesIndicesAttrDesc.offset,i.matricesIndicesAttrDesc.count),r=[];for(let t=0;t<s.length;t++){let e=s[t];r.push(255&e),r.push((65280&e)>>8),r.push((16711680&e)>>16),r.push(e>>24&255)}e.setVerticesData(n.o.MatricesIndicesKind,r,!1)}if(i.matricesIndicesExtraAttrDesc&&i.matricesIndicesExtraAttrDesc.count>0){let s=new Int32Array(t,i.matricesIndicesExtraAttrDesc.offset,i.matricesIndicesExtraAttrDesc.count),r=[];for(let t=0;t<s.length;t++){let e=s[t];r.push(255&e),r.push((65280&e)>>8),r.push((16711680&e)>>16),r.push(e>>24&255)}e.setVerticesData(n.o.MatricesIndicesExtraKind,r,!1)}if(i.matricesWeightsAttrDesc&&i.matricesWeightsAttrDesc.count>0){let s=new Float32Array(t,i.matricesWeightsAttrDesc.offset,i.matricesWeightsAttrDesc.count);e.setVerticesData(n.o.MatricesWeightsKind,s,!1)}if(i.indicesAttrDesc&&i.indicesAttrDesc.count>0){let s=new Int32Array(t,i.indicesAttrDesc.offset,i.indicesAttrDesc.count);e.setIndices(s,null)}if(i.subMeshesAttrDesc&&i.subMeshesAttrDesc.count>0){let s=new Int32Array(t,i.subMeshesAttrDesc.offset,5*i.subMeshesAttrDesc.count);e.subMeshes=[];for(let t=0;t<i.subMeshesAttrDesc.count;t++){let i=s[5*t+0],r=s[5*t+1],a=s[5*t+2],n=s[5*t+3],h=s[5*t+4];o.P.AddToMesh(i,r,a,n,h,e)}}}else if(t.positions&&t.normals&&t.indices){if(e.setVerticesData(n.o.PositionKind,t.positions,t.positions._updatable),e.setVerticesData(n.o.NormalKind,t.normals,t.normals._updatable),t.tangents&&e.setVerticesData(n.o.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&e.setVerticesData(n.o.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&e.setVerticesData(n.o.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&e.setVerticesData(n.o.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&e.setVerticesData(n.o.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&e.setVerticesData(n.o.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&e.setVerticesData(n.o.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&e.setVerticesData(n.o.ColorKind,r.HE.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices){if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,e.setVerticesData(n.o.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{let i=[];for(let e=0;e<t.matricesIndices.length;e++){let s=t.matricesIndices[e];i.push(255&s),i.push((65280&s)>>8),i.push((16711680&s)>>16),i.push(s>>24&255)}e.setVerticesData(n.o.MatricesIndicesKind,i,t.matricesIndices._updatable)}}if(t.matricesIndicesExtra){if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,e.setVerticesData(n.o.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{let i=[];for(let e=0;e<t.matricesIndicesExtra.length;e++){let s=t.matricesIndicesExtra[e];i.push(255&s),i.push((65280&s)>>8),i.push((16711680&s)>>16),i.push(s>>24&255)}e.setVerticesData(n.o.MatricesIndicesExtraKind,i,t.matricesIndicesExtra._updatable)}}t.matricesWeights&&(g._CleanMatricesWeights(t,e),e.setVerticesData(n.o.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&e.setVerticesData(n.o.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),e.setIndices(t.indices,null)}if(t.subMeshes){e.subMeshes=[];for(let i=0;i<t.subMeshes.length;i++){let s=t.subMeshes[i];o.P.AddToMesh(s.materialIndex,s.verticesStart,s.verticesCount,s.indexStart,s.indexCount,e)}}e._shouldGenerateFlatShading&&(e.convertToFlatShadedMesh(),e._shouldGenerateFlatShading=!1),e.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(e)}static _CleanMatricesWeights(t,e){if(!h.Z.CleanBoneMatrixWeights)return;let i=0;if(!(t.skeletonId>-1))return;{let s=e.getScene().getLastSkeletonById(t.skeletonId);if(!s)return;i=s.bones.length}let s=e.getVerticesData(n.o.MatricesIndicesKind),r=e.getVerticesData(n.o.MatricesIndicesExtraKind),a=t.matricesWeights,o=t.matricesWeightsExtra,l=t.numBoneInfluencer,c=a.length;for(let t=0;t<c;t+=4){let e=0,n=-1;for(let i=0;i<4;i++){let s=a[t+i];e+=s,s<.001&&n<0&&(n=i)}if(o)for(let i=0;i<4;i++){let s=o[t+i];e+=s,s<.001&&n<0&&(n=i+4)}if((n<0||n>l-1)&&(n=l-1),e>.001){let i=1/e;for(let e=0;e<4;e++)a[t+e]*=i;if(o)for(let e=0;e<4;e++)o[t+e]*=i}else n>=4?(o[t+n-4]=1-e,r[t+n-4]=i):(a[t+n]=1-e,s[t+n]=i)}e.setVerticesData(n.o.MatricesIndicesKind,s),t.matricesWeightsExtra&&e.setVerticesData(n.o.MatricesIndicesExtraKind,r)}static Parse(t,e,i){let r=new g(t.id,e,void 0,t.updatable);return r._loadedUniqueId=t.uniqueId,u.$&&u.$.AddTagsTo(r,t.tags),t.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+t.delayLoadingFile,r._boundingInfo=new l.j(s.P.FromArray(t.boundingBoxMinimum),s.P.FromArray(t.boundingBoxMaximum)),r._delayInfo=[],t.hasUVs&&r._delayInfo.push(n.o.UVKind),t.hasUVs2&&r._delayInfo.push(n.o.UV2Kind),t.hasUVs3&&r._delayInfo.push(n.o.UV3Kind),t.hasUVs4&&r._delayInfo.push(n.o.UV4Kind),t.hasUVs5&&r._delayInfo.push(n.o.UV5Kind),t.hasUVs6&&r._delayInfo.push(n.o.UV6Kind),t.hasColors&&r._delayInfo.push(n.o.ColorKind),t.hasMatricesIndices&&r._delayInfo.push(n.o.MatricesIndicesKind),t.hasMatricesWeights&&r._delayInfo.push(n.o.MatricesWeightsKind),r._delayLoadingFunction=a.x.ImportVertexData):a.x.ImportVertexData(t,r),e.pushGeometry(r,!0),r}}},89754:function(t,e,i){i.d(e,{D:function(){return f},x:function(){return _}});var s=i(46456),r=i(39884),a=i(93954),n=i(10633),o=i(57449),h=i(9719),l=i(22287),c=i(78314),u=i(77669),d=i(34066);class f{}class _{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,c.vp)(this._applyToCoroutine.bind(this)),this.uniqueId=_._UniqueIDGenerator,_._UniqueIDGenerator++}set(t,e){switch(t.length||h.Y.Warn(`Setting vertex data kind '${e}' with an empty array`),e){case a.o.PositionKind:this.positions=t;break;case a.o.NormalKind:this.normals=t;break;case a.o.TangentKind:this.tangents=t;break;case a.o.UVKind:this.uvs=t;break;case a.o.UV2Kind:this.uvs2=t;break;case a.o.UV3Kind:this.uvs3=t;break;case a.o.UV4Kind:this.uvs4=t;break;case a.o.UV5Kind:this.uvs5=t;break;case a.o.UV6Kind:this.uvs6=t;break;case a.o.ColorKind:this.colors=t;break;case a.o.MatricesIndicesKind:this.matricesIndices=t;break;case a.o.MatricesWeightsKind:this.matricesWeights=t;break;case a.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case a.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}}applyToMesh(t,e){return this._applyTo(t,e,!1),this}applyToGeometry(t,e){return this._applyTo(t,e,!1),this}updateMesh(t){return this._update(t),this}updateGeometry(t){return this._update(t),this}*_applyToCoroutine(t,e=!1,i){if(this.positions&&(t.setVerticesData(a.o.PositionKind,this.positions,e),i&&(yield)),this.normals&&(t.setVerticesData(a.o.NormalKind,this.normals,e),i&&(yield)),this.tangents&&(t.setVerticesData(a.o.TangentKind,this.tangents,e),i&&(yield)),this.uvs&&(t.setVerticesData(a.o.UVKind,this.uvs,e),i&&(yield)),this.uvs2&&(t.setVerticesData(a.o.UV2Kind,this.uvs2,e),i&&(yield)),this.uvs3&&(t.setVerticesData(a.o.UV3Kind,this.uvs3,e),i&&(yield)),this.uvs4&&(t.setVerticesData(a.o.UV4Kind,this.uvs4,e),i&&(yield)),this.uvs5&&(t.setVerticesData(a.o.UV5Kind,this.uvs5,e),i&&(yield)),this.uvs6&&(t.setVerticesData(a.o.UV6Kind,this.uvs6,e),i&&(yield)),this.colors&&(t.setVerticesData(a.o.ColorKind,this.colors,e),this.hasVertexAlpha&&void 0!==t.hasVertexAlpha&&(t.hasVertexAlpha=!0),i&&(yield)),this.matricesIndices&&(t.setVerticesData(a.o.MatricesIndicesKind,this.matricesIndices,e),i&&(yield)),this.matricesWeights&&(t.setVerticesData(a.o.MatricesWeightsKind,this.matricesWeights,e),i&&(yield)),this.matricesIndicesExtra&&(t.setVerticesData(a.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,e),i&&(yield)),this.matricesWeightsExtra&&(t.setVerticesData(a.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,e),i&&(yield)),this.indices?(t.setIndices(this.indices,null,e),i&&(yield)):t.setIndices([],null),t.subMeshes&&this.materialInfos&&this.materialInfos.length>1)for(let e of(t.subMeshes=[],this.materialInfos))new d.P(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,t);return this}_update(t,e,i){return this.positions&&t.updateVerticesData(a.o.PositionKind,this.positions,e,i),this.normals&&t.updateVerticesData(a.o.NormalKind,this.normals,e,i),this.tangents&&t.updateVerticesData(a.o.TangentKind,this.tangents,e,i),this.uvs&&t.updateVerticesData(a.o.UVKind,this.uvs,e,i),this.uvs2&&t.updateVerticesData(a.o.UV2Kind,this.uvs2,e,i),this.uvs3&&t.updateVerticesData(a.o.UV3Kind,this.uvs3,e,i),this.uvs4&&t.updateVerticesData(a.o.UV4Kind,this.uvs4,e,i),this.uvs5&&t.updateVerticesData(a.o.UV5Kind,this.uvs5,e,i),this.uvs6&&t.updateVerticesData(a.o.UV6Kind,this.uvs6,e,i),this.colors&&t.updateVerticesData(a.o.ColorKind,this.colors,e,i),this.matricesIndices&&t.updateVerticesData(a.o.MatricesIndicesKind,this.matricesIndices,e,i),this.matricesWeights&&t.updateVerticesData(a.o.MatricesWeightsKind,this.matricesWeights,e,i),this.matricesIndicesExtra&&t.updateVerticesData(a.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,i),this.matricesWeightsExtra&&t.updateVerticesData(a.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,i),this.indices&&t.setIndices(this.indices,null),this}static _TransformVector3Coordinates(t,e,i=0,s=t.length){let a=r.jp.Vector3[0],n=r.jp.Vector3[1];for(let o=i;o<i+s;o+=3)r.P.FromArrayToRef(t,o,a),r.P.TransformCoordinatesToRef(a,e,n),t[o]=n.x,t[o+1]=n.y,t[o+2]=n.z}static _TransformVector3Normals(t,e,i=0,s=t.length){let a=r.jp.Vector3[0],n=r.jp.Vector3[1];for(let o=i;o<i+s;o+=3)r.P.FromArrayToRef(t,o,a),r.P.TransformNormalToRef(a,e,n),t[o]=n.x,t[o+1]=n.y,t[o+2]=n.z}static _TransformVector4Normals(t,e,i=0,s=t.length){let a=r.jp.Vector4[0],n=r.jp.Vector4[1];for(let o=i;o<i+s;o+=4)r.Lt.FromArrayToRef(t,o,a),r.Lt.TransformNormalToRef(a,e,n),t[o]=n.x,t[o+1]=n.y,t[o+2]=n.z,t[o+3]=n.w}static _FlipFaces(t,e=0,i=t.length){for(let s=e;s<e+i;s+=3){let e=t[s+1];t[s+1]=t[s+2],t[s+2]=e}}transform(t){let e=0>t.determinant();return this.positions&&_._TransformVector3Coordinates(this.positions,t),this.normals&&_._TransformVector3Normals(this.normals,t),this.tangents&&_._TransformVector4Normals(this.tangents,t),e&&this.indices&&_._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];let t=[];for(let e of this.materialInfos){let i=new _;if(this.positions&&(i.positions=this.positions.slice(3*e.verticesStart,(e.verticesCount+e.verticesStart)*3)),this.normals&&(i.normals=this.normals.slice(3*e.verticesStart,(e.verticesCount+e.verticesStart)*3)),this.tangents&&(i.tangents=this.tangents.slice(4*e.verticesStart,(e.verticesCount+e.verticesStart)*4)),this.colors&&(i.colors=this.colors.slice(4*e.verticesStart,(e.verticesCount+e.verticesStart)*4)),this.uvs&&(i.uvs=this.uvs.slice(2*e.verticesStart,(e.verticesCount+e.verticesStart)*2)),this.uvs2&&(i.uvs2=this.uvs2.slice(2*e.verticesStart,(e.verticesCount+e.verticesStart)*2)),this.uvs3&&(i.uvs3=this.uvs3.slice(2*e.verticesStart,(e.verticesCount+e.verticesStart)*2)),this.uvs4&&(i.uvs4=this.uvs4.slice(2*e.verticesStart,(e.verticesCount+e.verticesStart)*2)),this.uvs5&&(i.uvs5=this.uvs5.slice(2*e.verticesStart,(e.verticesCount+e.verticesStart)*2)),this.uvs6&&(i.uvs6=this.uvs6.slice(2*e.verticesStart,(e.verticesCount+e.verticesStart)*2)),this.matricesIndices&&(i.matricesIndices=this.matricesIndices.slice(4*e.verticesStart,(e.verticesCount+e.verticesStart)*4)),this.matricesIndicesExtra&&(i.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*e.verticesStart,(e.verticesCount+e.verticesStart)*4)),this.matricesWeights&&(i.matricesWeights=this.matricesWeights.slice(4*e.verticesStart,(e.verticesCount+e.verticesStart)*4)),this.matricesWeightsExtra&&(i.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*e.verticesStart,(e.verticesCount+e.verticesStart)*4)),this.indices){i.indices=[];for(let t=e.indexStart;t<e.indexStart+e.indexCount;t++)i.indices.push(this.indices[t]-e.verticesStart)}let s=new f;s.indexStart=0,s.indexCount=i.indices?i.indices.length:0,s.materialIndex=e.materialIndex,s.verticesStart=0,s.verticesCount=(i.positions?i.positions.length:0)/3,i.materialInfos=[s],t.push(i)}return t}merge(t,e=!1,i=!1,s=!1,r=!1){let a=Array.isArray(t)?t.map(t=>({vertexData:t})):[{vertexData:t}];return(0,c.s3)(this._mergeCoroutine(void 0,a,e,!1,i,s,r))}*_mergeCoroutine(t,e,i=!1,s,r,n=!1,o=!1){this._validate();let h=e.map(t=>t.vertexData),l=this;if(o)for(let t of h)t&&(t._validate(),!this.normals&&t.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&t.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&t.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&t.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&t.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&t.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&t.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&t.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&t.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&t.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&t.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&t.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&t.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(let t of h)if(t){if(o)this.normals&&!t.normals&&(t.normals=new Float32Array(t.positions.length)),this.tangents&&!t.tangents&&(t.tangents=new Float32Array(t.positions.length/3*4)),this.uvs&&!t.uvs&&(t.uvs=new Float32Array(t.positions.length/3*2)),this.uvs2&&!t.uvs2&&(t.uvs2=new Float32Array(t.positions.length/3*2)),this.uvs3&&!t.uvs3&&(t.uvs3=new Float32Array(t.positions.length/3*2)),this.uvs4&&!t.uvs4&&(t.uvs4=new Float32Array(t.positions.length/3*2)),this.uvs5&&!t.uvs5&&(t.uvs5=new Float32Array(t.positions.length/3*2)),this.uvs6&&!t.uvs6&&(t.uvs6=new Float32Array(t.positions.length/3*2)),this.colors&&!t.colors&&(t.colors=new Float32Array(t.positions.length/3*4),t.colors.fill(1)),this.matricesIndices&&!t.matricesIndices&&(t.matricesIndices=new Float32Array(t.positions.length/3*4)),this.matricesWeights&&!t.matricesWeights&&(t.matricesWeights=new Float32Array(t.positions.length/3*4)),this.matricesIndicesExtra&&!t.matricesIndicesExtra&&(t.matricesIndicesExtra=new Float32Array(t.positions.length/3*4)),this.matricesWeightsExtra&&!t.matricesWeightsExtra&&(t.matricesWeightsExtra=new Float32Array(t.positions.length/3*4));else if(t._validate(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw Error("Cannot merge vertex data that do not have the same set of attributes")}if(n){let i=0,s=0,r=0,a=[],n=null,o=[];for(let e of this.splitBasedOnMaterialID())o.push({vertexData:e,transform:t});for(let t of e)if(t.vertexData)for(let e of t.vertexData.splitBasedOnMaterialID())o.push({vertexData:e,transform:t.transform});for(let t of(o.sort((t,e)=>{let i=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0,s=e.vertexData.materialInfos?e.vertexData.materialInfos[0].materialIndex:0;return i>s?1:i===s?0:-1}),o)){let e=t.vertexData;if(i=e.materialInfos?e.materialInfos[0].materialIndex:0,n&&n.materialIndex===i)n.indexCount+=e.indices.length,n.verticesCount+=e.positions.length/3;else{let t=new f;t.materialIndex=i,t.indexStart=s,t.indexCount=e.indices.length,t.verticesStart=r,t.verticesCount=e.positions.length/3,a.push(t),n=t}s+=e.indices.length,r+=e.positions.length/3}let c=o.splice(0,1)[0];l=c.vertexData,t=c.transform,h=o.map(t=>t.vertexData),e=o,this.materialInfos=a}let c=h.reduce((t,e)=>t+(e.indices?.length??0),l.indices?.length??0),u=r||h.some(t=>t.indices===l.indices)?l.indices?.slice():l.indices;if(c>0){let r=u?.length??0;if(u||(u=Array(c)),u.length!==c){if(Array.isArray(u))u.length=c;else{let t=i||u instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);t.set(u),u=t}t&&0>t.determinant()&&_._FlipFaces(u,0,r)}let a=l.positions?l.positions.length/3:0;for(let{vertexData:t,transform:i}of e)if(t.indices){for(let e=0;e<t.indices.length;e++)u[r+e]=t.indices[e]+a;i&&0>i.determinant()&&_._FlipFaces(u,r,t.indices.length),a+=t.positions.length/3,r+=t.indices.length,s&&(yield)}}return this.indices=u,this.positions=_._MergeElement(a.o.PositionKind,l.positions,t,e.map(t=>[t.vertexData.positions,t.transform])),s&&(yield),l.normals&&(this.normals=_._MergeElement(a.o.NormalKind,l.normals,t,e.map(t=>[t.vertexData.normals,t.transform])),s&&(yield)),l.tangents&&(this.tangents=_._MergeElement(a.o.TangentKind,l.tangents,t,e.map(t=>[t.vertexData.tangents,t.transform])),s&&(yield)),l.uvs&&(this.uvs=_._MergeElement(a.o.UVKind,l.uvs,t,e.map(t=>[t.vertexData.uvs,t.transform])),s&&(yield)),l.uvs2&&(this.uvs2=_._MergeElement(a.o.UV2Kind,l.uvs2,t,e.map(t=>[t.vertexData.uvs2,t.transform])),s&&(yield)),l.uvs3&&(this.uvs3=_._MergeElement(a.o.UV3Kind,l.uvs3,t,e.map(t=>[t.vertexData.uvs3,t.transform])),s&&(yield)),l.uvs4&&(this.uvs4=_._MergeElement(a.o.UV4Kind,l.uvs4,t,e.map(t=>[t.vertexData.uvs4,t.transform])),s&&(yield)),l.uvs5&&(this.uvs5=_._MergeElement(a.o.UV5Kind,l.uvs5,t,e.map(t=>[t.vertexData.uvs5,t.transform])),s&&(yield)),l.uvs6&&(this.uvs6=_._MergeElement(a.o.UV6Kind,l.uvs6,t,e.map(t=>[t.vertexData.uvs6,t.transform])),s&&(yield)),l.colors&&(this.colors=_._MergeElement(a.o.ColorKind,l.colors,t,e.map(t=>[t.vertexData.colors,t.transform])),(void 0!==l.hasVertexAlpha||e.some(t=>void 0!==t.vertexData.hasVertexAlpha))&&(this.hasVertexAlpha=l.hasVertexAlpha||e.some(t=>t.vertexData.hasVertexAlpha)),s&&(yield)),l.matricesIndices&&(this.matricesIndices=_._MergeElement(a.o.MatricesIndicesKind,l.matricesIndices,t,e.map(t=>[t.vertexData.matricesIndices,t.transform])),s&&(yield)),l.matricesWeights&&(this.matricesWeights=_._MergeElement(a.o.MatricesWeightsKind,l.matricesWeights,t,e.map(t=>[t.vertexData.matricesWeights,t.transform])),s&&(yield)),l.matricesIndicesExtra&&(this.matricesIndicesExtra=_._MergeElement(a.o.MatricesIndicesExtraKind,l.matricesIndicesExtra,t,e.map(t=>[t.vertexData.matricesIndicesExtra,t.transform])),s&&(yield)),l.matricesWeightsExtra&&(this.matricesWeightsExtra=_._MergeElement(a.o.MatricesWeightsExtraKind,l.matricesWeightsExtra,t,e.map(t=>[t.vertexData.matricesWeightsExtra,t.transform]))),this}static _MergeElement(t,e,i,s){let r=s.filter(t=>null!==t[0]&&void 0!==t[0]);if(!e&&0==r.length)return e;if(!e)return this._MergeElement(t,r[0][0],r[0][1],r.slice(1));let n=r.reduce((t,e)=>t+e[0].length,e.length),o=t===a.o.PositionKind?_._TransformVector3Coordinates:t===a.o.NormalKind?_._TransformVector3Normals:t===a.o.TangentKind?_._TransformVector4Normals:()=>{};if(e instanceof Float32Array){let t=new Float32Array(n);t.set(e),i&&o(t,i,0,e.length);let s=e.length;for(let[e,i]of r)t.set(e,s),i&&o(t,i,s,e.length),s+=e.length;return t}{let t=Array(n);for(let i=0;i<e.length;i++)t[i]=e[i];i&&o(t,i,0,e.length);let s=e.length;for(let[e,i]of r){for(let i=0;i<e.length;i++)t[s+i]=e[i];i&&o(t,i,s,e.length),s+=e.length}return t}}_validate(){if(!this.positions)throw new u.LH("Positions are required",u.SM.MeshInvalidPositionsError);let t=(t,e)=>{let i=a.o.DeduceStride(t);if(e.length%i!=0)throw Error("The "+t+"s array count must be a multiple of "+i);return e.length/i},e=t(a.o.PositionKind,this.positions),i=(i,s)=>{let r=t(i,s);if(r!==e)throw Error("The "+i+"s element count ("+r+") does not match the positions count ("+e+")")};this.normals&&i(a.o.NormalKind,this.normals),this.tangents&&i(a.o.TangentKind,this.tangents),this.uvs&&i(a.o.UVKind,this.uvs),this.uvs2&&i(a.o.UV2Kind,this.uvs2),this.uvs3&&i(a.o.UV3Kind,this.uvs3),this.uvs4&&i(a.o.UV4Kind,this.uvs4),this.uvs5&&i(a.o.UV5Kind,this.uvs5),this.uvs6&&i(a.o.UV6Kind,this.uvs6),this.colors&&i(a.o.ColorKind,this.colors),this.matricesIndices&&i(a.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(a.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(a.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(a.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){let t=this.serialize();return _.Parse(t)}serialize(){let t={};if(this.positions&&(t.positions=Array.from(this.positions)),this.normals&&(t.normals=Array.from(this.normals)),this.tangents&&(t.tangents=Array.from(this.tangents)),this.uvs&&(t.uvs=Array.from(this.uvs)),this.uvs2&&(t.uvs2=Array.from(this.uvs2)),this.uvs3&&(t.uvs3=Array.from(this.uvs3)),this.uvs4&&(t.uvs4=Array.from(this.uvs4)),this.uvs5&&(t.uvs5=Array.from(this.uvs5)),this.uvs6&&(t.uvs6=Array.from(this.uvs6)),this.colors&&(t.colors=Array.from(this.colors),t.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(t.matricesIndices=Array.from(this.matricesIndices),t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(t.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),t.indices=Array.from(this.indices),this.materialInfos)for(let e of(t.materialInfos=[],this.materialInfos)){let i={indexStart:e.indexStart,indexCount:e.indexCount,materialIndex:e.materialIndex,verticesStart:e.verticesStart,verticesCount:e.verticesCount};t.materialInfos.push(i)}return t}static ExtractFromMesh(t,e,i){return _._ExtractFrom(t,e,i)}static ExtractFromGeometry(t,e,i){return _._ExtractFrom(t,e,i)}static _ExtractFrom(t,e,i){let s=new _;if(t.isVerticesDataPresent(a.o.PositionKind)&&(s.positions=t.getVerticesData(a.o.PositionKind,e,i)),t.isVerticesDataPresent(a.o.NormalKind)&&(s.normals=t.getVerticesData(a.o.NormalKind,e,i)),t.isVerticesDataPresent(a.o.TangentKind)&&(s.tangents=t.getVerticesData(a.o.TangentKind,e,i)),t.isVerticesDataPresent(a.o.UVKind)&&(s.uvs=t.getVerticesData(a.o.UVKind,e,i)),t.isVerticesDataPresent(a.o.UV2Kind)&&(s.uvs2=t.getVerticesData(a.o.UV2Kind,e,i)),t.isVerticesDataPresent(a.o.UV3Kind)&&(s.uvs3=t.getVerticesData(a.o.UV3Kind,e,i)),t.isVerticesDataPresent(a.o.UV4Kind)&&(s.uvs4=t.getVerticesData(a.o.UV4Kind,e,i)),t.isVerticesDataPresent(a.o.UV5Kind)&&(s.uvs5=t.getVerticesData(a.o.UV5Kind,e,i)),t.isVerticesDataPresent(a.o.UV6Kind)&&(s.uvs6=t.getVerticesData(a.o.UV6Kind,e,i)),t.isVerticesDataPresent(a.o.ColorKind)){let r=t.geometry||t,n=r.getVertexBuffer(a.o.ColorKind),o=r.getVerticesData(a.o.ColorKind,e,i);if(3===n.getSize()){let t=new Float32Array(4*o.length/3);for(let e=0,i=0;e<o.length;e+=3,i+=4)t[i]=o[e],t[i+1]=o[e+1],t[i+2]=o[e+2],t[i+3]=1;s.colors=t}else if(4===n.getSize())s.colors=o;else throw Error(`Unexpected number of color components: ${n.getSize()}`)}return t.isVerticesDataPresent(a.o.MatricesIndicesKind)&&(s.matricesIndices=t.getVerticesData(a.o.MatricesIndicesKind,e,i)),t.isVerticesDataPresent(a.o.MatricesWeightsKind)&&(s.matricesWeights=t.getVerticesData(a.o.MatricesWeightsKind,e,i)),t.isVerticesDataPresent(a.o.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=t.getVerticesData(a.o.MatricesIndicesExtraKind,e,i)),t.isVerticesDataPresent(a.o.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=t.getVerticesData(a.o.MatricesWeightsExtraKind,e,i)),s.indices=t.getIndices(e,i),s}static CreateRibbon(t){throw(0,n.S)("ribbonBuilder")}static CreateBox(t){throw(0,n.S)("boxBuilder")}static CreateTiledBox(t){throw(0,n.S)("tiledBoxBuilder")}static CreateTiledPlane(t){throw(0,n.S)("tiledPlaneBuilder")}static CreateSphere(t){throw(0,n.S)("sphereBuilder")}static CreateCylinder(t){throw(0,n.S)("cylinderBuilder")}static CreateTorus(t){throw(0,n.S)("torusBuilder")}static CreateLineSystem(t){throw(0,n.S)("linesBuilder")}static CreateDashedLines(t){throw(0,n.S)("linesBuilder")}static CreateGround(t){throw(0,n.S)("groundBuilder")}static CreateTiledGround(t){throw(0,n.S)("groundBuilder")}static CreateGroundFromHeightMap(t){throw(0,n.S)("groundBuilder")}static CreatePlane(t){throw(0,n.S)("planeBuilder")}static CreateDisc(t){throw(0,n.S)("discBuilder")}static CreatePolygon(t,e,i,s,r,a,o){throw(0,n.S)("polygonBuilder")}static CreateIcoSphere(t){throw(0,n.S)("icoSphereBuilder")}static CreatePolyhedron(t){throw(0,n.S)("polyhedronBuilder")}static CreateCapsule(t={orientation:r.P.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw(0,n.S)("capsuleBuilder")}static CreateTorusKnot(t){throw(0,n.S)("torusKnotBuilder")}static ComputeNormals(t,e,i,s){let a=0,n=0,o=0,h=0,l=0,c=0,u=0,d=0,f=0,_=0,m=0,g=0,p=0,x=0,M=0,b=0,y=0,A=0,v=0,I=0,D=!1,S=!1,P=!1,V=!1,T=1,B=0,C=null;s&&(D=!!s.facetNormals,S=!!s.facetPositions,P=!!s.facetPartitioning,T=!0===s.useRightHandedSystem?-1:1,B=s.ratio||0,V=!!s.depthSort,C=s.distanceTo,V&&void 0===C&&(C=r.P.Zero()));let R=0,E=0,F=0,O=0;for(P&&s&&s.bbSize&&(R=s.subDiv.X*B/s.bbSize.x,E=s.subDiv.Y*B/s.bbSize.y,F=s.subDiv.Z*B/s.bbSize.z,O=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0),a=0;a<t.length;a++)i[a]=0;let w=e.length/3|0;for(a=0;a<w;a++){if(p=(g=3*e[3*a])+1,x=g+2,b=(M=3*e[3*a+1])+1,y=M+2,v=(A=3*e[3*a+2])+1,I=A+2,n=t[g]-t[M],o=t[p]-t[b],h=t[x]-t[y],l=t[A]-t[M],c=t[v]-t[b],m=0===(m=Math.sqrt((d=T*(o*(u=t[I]-t[y])-h*c))*d+(f=T*(h*l-n*u))*f+(_=T*(n*c-o*l))*_))?1:m,d/=m,f/=m,_/=m,D&&s&&(s.facetNormals[a].x=d,s.facetNormals[a].y=f,s.facetNormals[a].z=_),S&&s&&(s.facetPositions[a].x=(t[g]+t[M]+t[A])/3,s.facetPositions[a].y=(t[p]+t[b]+t[v])/3,s.facetPositions[a].z=(t[x]+t[y]+t[I])/3),P&&s){let e=Math.floor((s.facetPositions[a].x-s.bInfo.minimum.x*B)*R),i=Math.floor((s.facetPositions[a].y-s.bInfo.minimum.y*B)*E),r=Math.floor((s.facetPositions[a].z-s.bInfo.minimum.z*B)*F),n=Math.floor((t[g]-s.bInfo.minimum.x*B)*R),o=Math.floor((t[p]-s.bInfo.minimum.y*B)*E),h=Math.floor((t[x]-s.bInfo.minimum.z*B)*F),l=Math.floor((t[M]-s.bInfo.minimum.x*B)*R),c=Math.floor((t[b]-s.bInfo.minimum.y*B)*E),u=Math.floor((t[y]-s.bInfo.minimum.z*B)*F),d=Math.floor((t[A]-s.bInfo.minimum.x*B)*R),f=Math.floor((t[v]-s.bInfo.minimum.y*B)*E),_=Math.floor((t[I]-s.bInfo.minimum.z*B)*F),m=n+s.subDiv.max*o+O*h,D=l+s.subDiv.max*c+O*u,S=d+s.subDiv.max*f+O*_,P=e+s.subDiv.max*i+O*r;s.facetPartitioning[P]=s.facetPartitioning[P]?s.facetPartitioning[P]:[],s.facetPartitioning[m]=s.facetPartitioning[m]?s.facetPartitioning[m]:[],s.facetPartitioning[D]=s.facetPartitioning[D]?s.facetPartitioning[D]:[],s.facetPartitioning[S]=s.facetPartitioning[S]?s.facetPartitioning[S]:[],s.facetPartitioning[m].push(a),D!=m&&s.facetPartitioning[D].push(a),S==D||S==m||s.facetPartitioning[S].push(a),P==m||P==D||P==S||s.facetPartitioning[P].push(a)}if(V&&s&&s.facetPositions){let t=s.depthSortedFacets[a];t.ind=3*a,t.sqDistance=r.P.DistanceSquared(s.facetPositions[a],C)}i[g]+=d,i[p]+=f,i[x]+=_,i[M]+=d,i[b]+=f,i[y]+=_,i[A]+=d,i[v]+=f,i[I]+=_}for(a=0;a<i.length/3;a++)m=0===(m=Math.sqrt((d=i[3*a])*d+(f=i[3*a+1])*f+(_=i[3*a+2])*_))?1:m,d/=m,f/=m,_/=m,i[3*a]=d,i[3*a+1]=f,i[3*a+2]=_}static _ComputeSides(t,e,i,s,a,n,o){let h,l;let c=i.length,u=s.length;switch(t=t||_.DEFAULTSIDE){case _.FRONTSIDE:break;case _.BACKSIDE:for(h=0;h<c;h+=3){let t=i[h];i[h]=i[h+2],i[h+2]=t}for(l=0;l<u;l++)s[l]=-s[l];break;case _.DOUBLESIDE:{let t=e.length,d=t/3;for(let i=0;i<t;i++)e[t+i]=e[i];for(h=0;h<c;h+=3)i[h+c]=i[h+2]+d,i[h+1+c]=i[h+1]+d,i[h+2+c]=i[h]+d;for(l=0;l<u;l++)s[u+l]=-s[l];let f=a.length,_=0;for(_=0;_<f;_++)a[_+f]=a[_];for(h=0,n=n||new r.Lt(0,0,1,1),o=o||new r.Lt(0,0,1,1),_=0;h<f/2;h++)a[_]=n.x+(n.z-n.x)*a[_],a[_+1]=n.y+(n.w-n.y)*a[_+1],a[_+f]=o.x+(o.z-o.x)*a[_+f],a[_+f+1]=o.y+(o.w-o.y)*a[_+f+1],_+=2}}}static Parse(t){let e=new _,i=t.positions;i&&e.set(i,a.o.PositionKind);let s=t.normals;s&&e.set(s,a.o.NormalKind);let r=t.tangents;r&&e.set(r,a.o.TangentKind);let n=t.uvs;n&&e.set(n,a.o.UVKind);let h=t.uvs2;h&&e.set(h,a.o.UV2Kind);let l=t.uvs3;l&&e.set(l,a.o.UV3Kind);let c=t.uvs4;c&&e.set(c,a.o.UV4Kind);let u=t.uvs5;u&&e.set(u,a.o.UV5Kind);let d=t.uvs6;d&&e.set(d,a.o.UV6Kind);let m=t.colors;m&&(e.set(o.HE.CheckColors4(m,i.length/3),a.o.ColorKind),void 0!==t.hasVertexAlpha&&(e.hasVertexAlpha=t.hasVertexAlpha));let g=t.matricesIndices;g&&e.set(g,a.o.MatricesIndicesKind);let p=t.matricesWeights;p&&e.set(p,a.o.MatricesWeightsKind);let x=t.indices;x&&(e.indices=x);let M=t.materialInfos;if(M)for(let t of(e.materialInfos=[],M)){let i=new f;i.indexCount=t.indexCount,i.indexStart=t.indexStart,i.verticesCount=t.verticesCount,i.verticesStart=t.verticesStart,i.materialIndex=t.materialIndex,e.materialInfos.push(i)}return e}static ImportVertexData(t,e){let i=_.Parse(t);e.setAllVerticesData(i,t.updatable)}}_.FRONTSIDE=0,_.BACKSIDE=1,_.DOUBLESIDE=2,_.DEFAULTSIDE=0,_._UniqueIDGenerator=0,(0,s.gn)([l.G6.filter((...[t])=>!Array.isArray(t))],_,"_TransformVector3Coordinates",null),(0,s.gn)([l.G6.filter((...[t])=>!Array.isArray(t))],_,"_TransformVector3Normals",null),(0,s.gn)([l.G6.filter((...[t])=>!Array.isArray(t))],_,"_TransformVector4Normals",null),(0,s.gn)([l.G6.filter((...[t])=>!Array.isArray(t))],_,"_FlipFaces",null)},80292:function(t,e,i){i.d(e,{g:function(){return s}});class s{constructor(t,e){this.distanceOrScreenCoverage=t,this.mesh=e}}},3860:function(t,e,i){i.d(e,{Y:function(){return u}});var s=i(46456),r=i(22287),a=i(90212),n=i(82877),o=i(39884),h=i(67020),l=i(7724);let c=o.y3.Compose(o.P.One(),o._f.FromEulerAngles(0,Math.PI,0),o.P.Zero());class u extends h.N{get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=(this._billboardMode&u.BILLBOARDMODE_USE_POSITION)!=0,this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)}constructor(t,e=null,i=!0){super(t,e,!1),this._forward=new o.P(0,0,1),this._up=new o.P(0,1,0),this._right=new o.P(1,0,0),this._position=o.P.Zero(),this._rotation=o.P.Zero(),this._rotationQuaternion=null,this._scaling=o.P.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=u.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=o.y3.Zero(),this._usePivotMatrix=!1,this._absolutePosition=o.P.Zero(),this._absoluteScaling=o.P.Zero(),this._absoluteRotationQuaternion=o._f.Identity(),this._pivotMatrix=o.y3.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new n.y$,this._nonUniformScaling=!1,i&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(t){this._position=t,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._rotationQuaternion=null,this._isDirty=!0}get scaling(){return this._scaling}set scaling(t){this._scaling=t,this._isDirty=!0}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._isDirty=!0}get forward(){return o.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return o.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return o.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(t){return this._poseMatrix?this._poseMatrix.copyFrom(t):this._poseMatrix=t.clone(),this}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=o.y3.Identity()),this._poseMatrix}_isSynchronized(){let t=this._cache;return this._billboardMode===t.billboardMode&&this._billboardMode===u.BILLBOARDMODE_NONE&&!t.pivotMatrixUpdated&&!this._infiniteDistance&&!this._position._isDirty&&!this._scaling._isDirty&&(!this._rotationQuaternion||!this._rotationQuaternion._isDirty)&&!this._rotation._isDirty}_initCache(){super._initCache();let t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1,t.useBillboardPosition=!1,t.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(t){return this.setPivotMatrix(t,!1)}setPivotMatrix(t,e=!0){return this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=e,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=o.y3.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(t=null,e,i){let s=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);for(let t of(s&&i&&i(this,s),this.getChildTransformNodes(!0)))t.instantiateHierarchy(s,e,i);return s}freezeWorldMatrix(t=null,e=!1){return t?e?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||o._f.Identity(),t.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=t,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(t){let e,i,s;if(!t)return this;if(void 0===t.x){if(arguments.length<3)return this;e=arguments[0],i=arguments[1],s=arguments[2]}else e=t.x,i=t.y,s=t.z;if(this.parent){let t=o.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(t),o.P.TransformCoordinatesFromFloatsToRef(e,i,s,t,this.position)}else this.position.x=e,this.position.y=i,this.position.z=s;return this._absolutePosition.copyFrom(t),this}setPositionWithLocalVector(t){return this.computeWorldMatrix(),this.position=o.P.TransformNormal(t,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();let t=o.jp.Matrix[0];return this._localMatrix.invertToRef(t),o.P.TransformNormal(this.position,t)}locallyTranslate(t){return this.computeWorldMatrix(!0),this.position=o.P.TransformCoordinates(t,this._localMatrix),this}lookAt(t,e=0,i=0,s=0,r=0){let a=u._LookAtVectorCache,n=0===r?this.position:this.getAbsolutePosition();if(t.subtractToRef(n,a),this.setDirection(a,e,i,s),1===r&&this.parent){if(this.rotationQuaternion){let t=o.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(t);let e=o.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.invert(),t.multiplyToRef(e,t),this.rotationQuaternion.fromRotationMatrix(t)}else{let t=o.jp.Quaternion[0];o._f.FromEulerVectorToRef(this.rotation,t);let e=o.jp.Matrix[0];t.toRotationMatrix(e);let i=o.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.invert(),e.multiplyToRef(i,e),t.fromRotationMatrix(e),t.toEulerAnglesToRef(this.rotation)}}return this}getDirection(t){let e=o.P.Zero();return this.getDirectionToRef(t,e),e}getDirectionToRef(t,e){return o.P.TransformNormalToRef(t,this.getWorldMatrix(),e),this}setDirection(t,e=0,i=0,s=0){let r=-Math.atan2(t.z,t.x)+Math.PI/2,a=Math.sqrt(t.x*t.x+t.z*t.z),n=-Math.atan2(t.y,a);return this.rotationQuaternion?o._f.RotationYawPitchRollToRef(r+e,n+i,s,this.rotationQuaternion):(this.rotation.x=n+i,this.rotation.y=r+e,this.rotation.z=s),this}setPivotPoint(t,e=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);let i=this.getWorldMatrix();if(1==e){let e=o.jp.Matrix[0];i.invertToRef(e),t=o.P.TransformCoordinates(t,e)}return this.setPivotMatrix(o.y3.Translation(-t.x,-t.y,-t.z),!0)}getPivotPoint(){let t=o.P.Zero();return this.getPivotPointToRef(t),t}getPivotPointToRef(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){let t=o.P.Zero();return this.getAbsolutePivotPointToRef(t),t}getAbsolutePivotPointToRef(t){return this.getPivotPointToRef(t),o.P.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this}markAsDirty(t){if(this._isDirty)return this;if(this._children)for(let e of this._children)e.markAsDirty(t);return super.markAsDirty(t)}setParent(t,e=!1,i=!1){if(!t&&!this.parent)return this;let s=o.jp.Quaternion[0],r=o.jp.Vector3[0],a=o.jp.Vector3[1],n=o.jp.Matrix[1];o.y3.IdentityToRef(n);let h=o.jp.Matrix[0];this.computeWorldMatrix(!0);let l=this.rotationQuaternion;return l||(l=u._TmpRotation,o._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,l)),o.y3.ComposeToRef(this.scaling,l,this.position,h),this.parent&&h.multiplyToRef(this.parent.computeWorldMatrix(!0),h),t&&(t.computeWorldMatrix(!0).invertToRef(n),h.multiplyToRef(n,h)),h.decompose(a,s,r,e?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(a),this.position.copyFrom(r),this.parent=t,i&&this.setPivotMatrix(o.y3.Identity()),this}addChild(t,e=!1){return t.setParent(this,e),this}removeChild(t,e=!1){return t.setParent(null,e),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)}attachToBone(t,e){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=e,this.parent=t,t.getSkeleton().prepare(!0),0>t.getFinalMatrix().determinant()&&(this.scalingDeterminant*=-1),this}detachFromBone(t=!1){return this.parent?(0>this.parent.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,t?this.parent=this._currentParentWhenAttachingToBone:this.parent=null):t&&(this.parent=this._currentParentWhenAttachingToBone),this}rotate(t,e,i){let s;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&0!==i){if(this.parent){let i=this.parent.getWorldMatrix(),s=o.jp.Matrix[0];i.invertToRef(s),t=o.P.TransformNormal(t,s),0>i.determinant()&&(e*=-1)}(s=o._f.RotationAxisToRef(t,e,u._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else s=o._f.RotationAxisToRef(t,e,u._RotationAxisCache),this.rotationQuaternion.multiplyToRef(s,this.rotationQuaternion);return this}rotateAround(t,e,i){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=o._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));let s=o.jp.Vector3[0],r=o.jp.Vector3[1],a=o.jp.Vector3[2],n=o.jp.Quaternion[0],h=o.jp.Matrix[0],l=o.jp.Matrix[1],c=o.jp.Matrix[2],u=o.jp.Matrix[3];return t.subtractToRef(this.position,s),o.y3.TranslationToRef(s.x,s.y,s.z,h),o.y3.TranslationToRef(-s.x,-s.y,-s.z,l),o.y3.RotationAxisToRef(e,i,c),l.multiplyToRef(c,u),u.multiplyToRef(h,u),u.decompose(r,n,a),this.position.addInPlace(a),n.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(t,e,i){let s=t.scale(e);if(i&&0!==i)this.setAbsolutePosition(this.getAbsolutePosition().add(s));else{let t=this.getPositionExpressedInLocalSpace().add(s);this.setPositionWithLocalVector(t)}return this}addRotation(t,e,i){let s;this.rotationQuaternion?s=this.rotationQuaternion:(s=o.jp.Quaternion[1],o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));let r=o.jp.Quaternion[0];return o._f.RotationYawPitchRollToRef(e,t,i,r),s.multiplyInPlace(r),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(t=!1,e=null){let i;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;let s=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===s||this.isSynchronized()))return this._currentRenderId=s,this._worldMatrix;e=e||this.getScene().activeCamera,this._updateCache();let r=this._cache;r.pivotMatrixUpdated=!1,r.billboardMode=this.billboardMode,r.infiniteDistance=this.infiniteDistance,r.parent=this._parentNode,this._currentRenderId=s,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;let a=this._getEffectiveParent(),n=u._TmpScaling,h=this._position;if(this._infiniteDistance&&!this.parent&&e){let t=e.getWorldMatrix(),i=new o.P(t.m[12],t.m[13],t.m[14]);(h=u._TmpTranslation).copyFromFloats(this._position.x+i.x,this._position.y+i.y,this._position.z+i.z)}if(n.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,i=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(o._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(i=u._TmpRotation,o._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,i)),this._usePivotMatrix){let t=o.jp.Matrix[1];o.y3.ScalingToRef(n.x,n.y,n.z,t);let e=o.jp.Matrix[0];i.toRotationMatrix(e),this._pivotMatrix.multiplyToRef(t,o.jp.Matrix[4]),o.jp.Matrix[4].multiplyToRef(e,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(h.x,h.y,h.z)}else o.y3.ComposeToRef(n,i,h,this._localMatrix);if(a&&a.getWorldMatrix){if(t&&a.computeWorldMatrix(t),r.useBillboardPath){if(this._transformToBoneReferal){let t=this.parent;t.getSkeleton().prepare(),t.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.jp.Matrix[7])}else o.jp.Matrix[7].copyFrom(a.getWorldMatrix());let t=o.jp.Vector3[5],e=o.jp.Vector3[6],i=o.jp.Quaternion[0];o.jp.Matrix[7].decompose(e,i,t),o.y3.ScalingToRef(e.x,e.y,e.z,o.jp.Matrix[7]),o.jp.Matrix[7].setTranslation(t),u.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(i,t),this._localMatrix.setTranslation(t)),this._localMatrix.multiplyToRef(o.jp.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){let t=this.parent;t.getSkeleton().prepare(),this._localMatrix.multiplyToRef(t.getFinalMatrix(),o.jp.Matrix[6]),o.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(a.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(r.useBillboardPath&&e&&this.billboardMode&&!r.useBillboardPosition){let t=o.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(t),o.jp.Matrix[1].copyFrom(e.getViewMatrix()),this._scene.useRightHandedSystem&&o.jp.Matrix[1].multiplyToRef(c,o.jp.Matrix[1]),o.jp.Matrix[1].setTranslationFromFloats(0,0,0),o.jp.Matrix[1].invertToRef(o.jp.Matrix[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){o.jp.Matrix[0].decompose(void 0,o.jp.Quaternion[0],void 0);let t=o.jp.Vector3[1];o.jp.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(t.z=0),o.y3.RotationYawPitchRollToRef(t.y,t.x,t.z,o.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(o.jp.Vector3[0])}else if(r.useBillboardPath&&e&&r.useBillboardPosition){let t=o.jp.Vector3[0];this._worldMatrix.getTranslationToRef(t);let i=e.globalPosition;this._worldMatrix.invertToRef(o.jp.Matrix[1]);let s=o.jp.Vector3[1];o.P.TransformCoordinatesToRef(i,o.jp.Matrix[1],s),s.normalize();let r=-Math.atan2(s.z,s.x)+Math.PI/2,a=Math.sqrt(s.x*s.x+s.z*s.z),n=-Math.atan2(s.y,a);if(o._f.RotationYawPitchRollToRef(r,n,0,o.jp.Quaternion[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){let t=o.jp.Vector3[1];o.jp.Quaternion[0].toEulerAnglesToRef(t),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(t.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(t.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(t.z=0),o.y3.RotationYawPitchRollToRef(t.y,t.x,t.z,o.jp.Matrix[0])}else o.y3.FromQuaternionToRef(o.jp.Quaternion[0],o.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(o.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(o.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):a&&a._nonUniformScaling?this._updateNonUniformScalingState(a._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=o.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(t=!0){if(this.computeWorldMatrix(),t){let t=this.getChildren();for(let e=0;e<t.length;++e){let i=t[e];if(i){i.computeWorldMatrix();let t=o.jp.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,t);let e=o.jp.Quaternion[0];t.decompose(i.scaling,e,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(e):e.toEulerAnglesToRef(i.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=o._f.Identity()),this._worldMatrix=o.y3.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this}unregisterAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this}getPositionInCameraSpace(t=null){return t||(t=this.getScene().activeCamera),o.P.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())}getDistanceToCamera(t=null){return t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()}clone(t,e,i){let s=a.p.Clone(()=>new u(t,this.getScene()),this);if(s.name=t,s.id=t,e&&(s.parent=e),!i){let e=this.getDescendants(!0);for(let i=0;i<e.length;i++){let r=e[i];r.clone&&r.clone(t+"."+r.name,s)}}return s}serialize(t){let e=a.p.Serialize(this,t);return e.type=this.getClassName(),e.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(e),e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(),a.p.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e}static Parse(t,e,i){let s=a.p.Parse(()=>new u(t.name,e),t,e,i);if(t.localMatrix?s.setPreTransformMatrix(o.y3.FromArray(t.localMatrix)):t.pivotMatrix&&s.setPivotMatrix(o.y3.FromArray(t.pivotMatrix)),s.setEnabled(t.isEnabled),s._waitingParsedUniqueId=t.uniqueId,void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),t.animations){for(let e=0;e<t.animations.length;e++){let i=t.animations[e],r=(0,l.qw)("BABYLON.Animation");r&&s.animations.push(r.Parse(i))}h.N.ParseAnimationRanges(s,t,e)}return t.autoAnimate&&e.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),s}getChildTransformNodes(t,e){let i=[];return this._getDescendants(i,t,t=>(!e||e(t))&&t instanceof u),i}dispose(t,e=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){let t=this._parentContainer.transformNodes.indexOf(this);t>-1&&this._parentContainer.transformNodes.splice(t,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t)for(let t of this.getChildTransformNodes(!0))t.parent=null,t.computeWorldMatrix(!0);super.dispose(t,e)}normalizeToUnitCube(t=!0,e=!1,i){let s=null,r=null;e&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(s=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));let a=this.getHierarchyBoundingVectors(t,i),n=a.max.subtract(a.min),o=Math.max(n.x,n.y,n.z);return 0===o||(this.scaling.scaleInPlace(1/o),e&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&s&&this.rotation.copyFrom(s))),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}u.BILLBOARDMODE_NONE=0,u.BILLBOARDMODE_X=1,u.BILLBOARDMODE_Y=2,u.BILLBOARDMODE_Z=4,u.BILLBOARDMODE_ALL=7,u.BILLBOARDMODE_USE_POSITION=128,u.BillboardUseParentOrientation=!1,u._TmpRotation=o._f.Zero(),u._TmpScaling=o.P.Zero(),u._TmpTranslation=o.P.Zero(),u._LookAtVectorCache=new o.P(0,0,0),u._RotationAxisCache=new o._f,(0,s.gn)([(0,r.hd)("position")],u.prototype,"_position",void 0),(0,s.gn)([(0,r.hd)("rotation")],u.prototype,"_rotation",void 0),(0,s.gn)([(0,r.mv)("rotationQuaternion")],u.prototype,"_rotationQuaternion",void 0),(0,s.gn)([(0,r.hd)("scaling")],u.prototype,"_scaling",void 0),(0,s.gn)([(0,r.qC)("billboardMode")],u.prototype,"_billboardMode",void 0),(0,s.gn)([(0,r.qC)()],u.prototype,"scalingDeterminant",void 0),(0,s.gn)([(0,r.qC)("infiniteDistance")],u.prototype,"_infiniteDistance",void 0),(0,s.gn)([(0,r.qC)()],u.prototype,"ignoreNonUniformScaling",void 0),(0,s.gn)([(0,r.qC)()],u.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},78314:function(t,e,i){function s(t,e,i){try{let s=t.next();s.done?e(s):s.value?s.value.then(()=>{s.value=void 0,e(s)},i):e(s)}catch(t){i(t)}}function r(t=25){let e;return(i,r,a)=>{let n=performance.now();void 0===e||n-e>t?(e=n,setTimeout(()=>{s(i,r,a)},0)):s(i,r,a)}}function a(t,e,i,s,r){let a=()=>{let n;let o=t=>{t.done?i(t.value):void 0===n?n=!0:a()};do n=void 0,r&&r.aborted?s(Error("Aborted")):e(t,o,s),void 0===n&&(n=!1);while(n)};a()}function n(t,e){let i;return a(t,s,t=>i=t,t=>{throw t},e),i}function o(t,e,i){return new Promise((s,r)=>{a(t,e,s,r,i)})}function h(t,e){return(...i)=>n(t(...i),e)}i.d(e,{KO:function(){return r},WP:function(){return s},s3:function(){return n},sM:function(){return o},vp:function(){return h}})}}]);