"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5068],{35068:function(e,t,a){a.r(t),a.d(t,{_BasisTextureLoader:function(){return n}});var r=a(84684),s=a(4224);class n{constructor(){this.supportCascades=!1}loadCubeData(e,t,a,n,o){if(Array.isArray(e))return;let i=t.getEngine().getCaps(),c={supportedCompressionFormats:{etc1:!!i.etc1,s3tc:!!i.s3tc,pvrtc:!!i.pvrtc,etc2:!!i.etc2,astc:!!i.astc,bc7:!!i.bptc}};(0,r.rz)(e,c).then(e=>{let a=e.fileInfo.images[0].levels.length>1&&t.generateMipMaps;(0,r.nG)(t,e),t.getEngine()._setCubeMapTextureParams(t,a),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n()}).catch(e=>{s.w1.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),t.isReady=!0,o&&o(e)})}loadData(e,t,a){let n=t.getEngine().getCaps(),o={supportedCompressionFormats:{etc1:!!n.etc1,s3tc:!!n.s3tc,pvrtc:!!n.pvrtc,etc2:!!n.etc2,astc:!!n.astc,bc7:!!n.bptc}};(0,r.rz)(e,o).then(e=>{let s=e.fileInfo.images[0].levels[0],n=e.fileInfo.images[0].levels.length>1&&t.generateMipMaps;a(s.width,s.height,n,-1!==e.format,()=>{(0,r.nG)(t,e)})}).catch(e=>{s.w1.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),s.w1.Warn(`Failed to transcode Basis file: ${e}`),a(0,0,!1,!1,()=>{},!0)})}}},84684:function(e,t,a){a.d(t,{nG:function(){return f},rz:function(){return g}});var r,s,n=a(4224),o=a(81209),i=a(9520);function c(){let e={cTFETC1:0,cTFETC2:1,cTFBC1:2,cTFBC3:3,cTFBC7:6,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4:10,cTFRGB565:14},t=null;onmessage=a=>{if("init"===a.data.action){if(a.data.url)try{importScripts(a.data.url)}catch(e){postMessage({action:"error",error:e})}t||(t=BASIS({wasmBinary:a.data.wasmBinary})),null!==t&&t.then(e=>{BASIS=e,e.initializeBasis(),postMessage({action:"init"})})}else if("transcode"===a.data.action){var r;let t;let s=a.data.config,n=a.data.imageData,o=new BASIS.BasisFile(n),i=function(e){let t=e.getHasAlpha(),a=e.getNumImages(),r=[];for(let t=0;t<a;t++){let a={levels:[]},s=e.getNumLevels(t);for(let r=0;r<s;r++){let s={width:e.getImageWidth(t,r),height:e.getImageHeight(t,r)};a.levels.push(s)}r.push(a)}return{hasAlpha:t,images:r}}(o),c=a.data.ignoreSupportedFormats?null:(r=a.data.config,t=null,r.supportedCompressionFormats&&(t=r.supportedCompressionFormats.astc?e.cTFASTC_4x4:r.supportedCompressionFormats.bc7?e.cTFBC7:r.supportedCompressionFormats.s3tc?i.hasAlpha?e.cTFBC3:e.cTFBC1:r.supportedCompressionFormats.pvrtc?i.hasAlpha?e.cTFPVRTC1_4_RGBA:e.cTFPVRTC1_4_RGB:r.supportedCompressionFormats.etc2?e.cTFETC2:r.supportedCompressionFormats.etc1?e.cTFETC1:e.cTFRGB565),t),l=!1;null===c&&(l=!0,c=i.hasAlpha?e.cTFBC3:e.cTFBC1);let d=!0;o.startTranscoding()||(d=!1);let T=[];for(let e=0;e<i.images.length&&d;e++){let t=i.images[e];if(void 0===s.loadSingleImage||s.loadSingleImage===e){let a=t.levels.length;!1===s.loadMipmapLevels&&(a=1);for(let r=0;r<a;r++){let a=t.levels[r],s=function(e,t,a,r,s){let n=new Uint8Array(e.getImageTranscodedSizeInBytes(t,a,r));return e.transcodeImage(n,t,a,r,1,0)?(s&&(n=function(e,t,a,r){let s=new Uint16Array(4),n=new Uint16Array(a*r),o=a/4,i=r/4;for(let t=0;t<i;t++)for(let r=0;r<o;r++){let i=0+8*(t*o+r);s[0]=e[i]|e[i+1]<<8,s[1]=e[i+2]|e[i+3]<<8,s[2]=(2*(31&s[0])+1*(31&s[1]))/3|(2*(2016&s[0])+1*(2016&s[1]))/3&2016|(2*(63488&s[0])+1*(63488&s[1]))/3&63488,s[3]=(2*(31&s[1])+1*(31&s[0]))/3|(2*(2016&s[1])+1*(2016&s[0]))/3&2016|(2*(63488&s[1])+1*(63488&s[0]))/3&63488;for(let o=0;o<4;o++){let c=e[i+4+o],l=(4*t+o)*a+4*r;n[l++]=s[3&c],n[l++]=s[c>>2&3],n[l++]=s[c>>4&3],n[l++]=s[c>>6&3]}}return n}(n,0,e.getImageWidth(t,a)+3&-4,e.getImageHeight(t,a)+3&-4)),n):null}(o,e,r,c,l);if(!s){d=!1;break}a.transcodedPixels=s,T.push(a.transcodedPixels.buffer)}}}o.close(),o.delete(),l&&(c=-1),d?postMessage({action:"transcode",success:d,id:a.data.id,fileInfo:i,format:c},T):postMessage({action:"transcode",success:d,id:a.data.id})}}}(r=s||(s={}))[r.cTFETC1=0]="cTFETC1",r[r.cTFETC2=1]="cTFETC2",r[r.cTFBC1=2]="cTFBC1",r[r.cTFBC3=3]="cTFBC3",r[r.cTFBC4=4]="cTFBC4",r[r.cTFBC5=5]="cTFBC5",r[r.cTFBC7=6]="cTFBC7",r[r.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",r[r.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",r[r.cTFASTC_4x4=10]="cTFASTC_4x4",r[r.cTFATC_RGB=11]="cTFATC_RGB",r[r.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",r[r.cTFRGBA32=13]="cTFRGBA32",r[r.cTFRGB565=14]="cTFRGB565",r[r.cTFBGR565=15]="cTFBGR565",r[r.cTFRGBA4444=16]="cTFRGBA4444",r[r.cTFFXT1_RGB=17]="cTFFXT1_RGB",r[r.cTFPVRTC2_4_RGB=18]="cTFPVRTC2_4_RGB",r[r.cTFPVRTC2_4_RGBA=19]="cTFPVRTC2_4_RGBA",r[r.cTFETC2_EAC_R11=20]="cTFETC2_EAC_R11",r[r.cTFETC2_EAC_RG11=21]="cTFETC2_EAC_RG11";let l={JSModuleURL:`${n.w1._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.js`,WasmModuleURL:`${n.w1._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.wasm`},d=null,T=null,u=0,p=()=>(d||(d=new Promise((e,t)=>{T?e(T):n.w1.LoadFileAsync(n.w1.GetBabylonScriptURL(l.WasmModuleURL)).then(a=>{var r,s;if("function"!=typeof URL)return t("Basis transcoder requires an environment with a URL constructor");(r=T=new Worker(URL.createObjectURL(new Blob([`(${c})()`],{type:"application/javascript"}))),s=l.JSModuleURL,new Promise((e,t)=>{let o=a=>{"init"===a.data.action?(r.removeEventListener("message",o),e(r)):"error"===a.data.action&&t(a.data.error||"error initializing worker")};r.addEventListener("message",o),r.postMessage({action:"init",url:s?n.w1.GetBabylonScriptURL(s):void 0,wasmBinary:a},[a])})).then(e,t)}).catch(t)})),d),g=(e,t)=>{let a=e instanceof ArrayBuffer?new Uint8Array(e):e;return new Promise((e,r)=>{p().then(()=>{let s=u++,n=t=>{"transcode"===t.data.action&&t.data.id===s&&(T.removeEventListener("message",n),t.data.success?e(t.data):r("Transcode is not supported on this device"))};T.addEventListener("message",n);let o=new Uint8Array(a.byteLength);o.set(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),T.postMessage({action:"transcode",id:s,imageData:o,config:t,ignoreSupportedFormats:!1},[o.buffer])},e=>{r(e)})})},F=(e,t)=>{let a=t._gl?.TEXTURE_2D;e.isCube&&(a=t._gl?.TEXTURE_CUBE_MAP),t._bindTextureDirectly(a,e,!0)},f=(e,t)=>{let a=e.getEngine();for(let r=0;r<t.fileInfo.images.length;r++){let c=t.fileInfo.images[r].levels[0];if(e._invertVScale=e.invertY,-1===t.format||t.format===s.cTFRGB565){if(e.type=10,e.format=4,a._features.basisNeedsPOT&&(Math.log2(c.width)%1!=0||Math.log2(c.height)%1!=0)){let t=new i.l(a,2);e._invertVScale=e.invertY,t.type=10,t.format=4,t.width=c.width+3&-4,t.height=c.height+3&-4,F(t,a),a._uploadDataToTextureDirectly(t,new Uint16Array(c.transcodedPixels.buffer),r,0,4,!0),a._rescaleTexture(t,e,a.scenes[0],a._getInternalFormat(4),()=>{a._releaseTexture(t),F(e,a)})}else e._invertVScale=!e.invertY,e.width=c.width+3&-4,e.height=c.height+3&-4,e.samplingMode=2,F(e,a),a._uploadDataToTextureDirectly(e,new Uint16Array(c.transcodedPixels.buffer),r,0,4,!0)}else{e.width=c.width,e.height=c.height,e.generateMipMaps=t.fileInfo.images[r].levels.length>1;let s=h.GetInternalFormatFromBasisFormat(t.format,a);e.format=s,F(e,a),t.fileInfo.images[r].levels.forEach((t,n)=>{a._uploadCompressedDataToTextureDirectly(e,s,t.width,t.height,t.transcodedPixels,r,n)}),a._features.basisNeedsPOT&&(Math.log2(e.width)%1!=0||Math.log2(e.height)%1!=0)&&(n.w1.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),e._cachedWrapU=o.x.CLAMP_ADDRESSMODE,e._cachedWrapV=o.x.CLAMP_ADDRESSMODE)}}},h={JSModuleURL:l.JSModuleURL,WasmModuleURL:l.WasmModuleURL,GetInternalFormatFromBasisFormat:(e,t)=>{let a;switch(e){case s.cTFETC1:a=36196;break;case s.cTFBC1:a=33776;break;case s.cTFBC4:a=33779;break;case s.cTFASTC_4x4:a=37808;break;case s.cTFETC2:a=37496;break;case s.cTFBC7:a=36492}if(void 0===a)throw"The chosen Basis transcoder format is not currently supported";return a},TranscodeAsync:g,LoadTextureFromTranscodeResult:f};Object.defineProperty(h,"JSModuleURL",{get:function(){return l.JSModuleURL},set:function(e){l.JSModuleURL=e}}),Object.defineProperty(h,"WasmModuleURL",{get:function(){return l.WasmModuleURL},set:function(e){l.WasmModuleURL=e}})}}]);