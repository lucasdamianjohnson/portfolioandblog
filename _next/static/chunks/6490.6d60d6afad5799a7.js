"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6490],{19472:function(e,t,n){n.d(t,{H:function(){return l},I:function(){return d}});var r=n(54025),s=n(23032),i=n(60584),a=n(1806),o=n(98421);let f={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class d{constructor(e,t=f){this._fullscreenViewport=new s.l(0,0,1,1);let n=t.positions??f.positions,i=t.indices??f.indices;this.engine=e,this._vertexBuffers={[r.o.PositionKind]:new r.o(e,n,r.o.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(i),this._onContextRestoredObserver=e.onContextRestoredObservable.add(()=>{for(let t in this._indexBuffer=e.createIndexBuffer(i),this._vertexBuffers)this._vertexBuffers[t]._rebuild()})}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return void 0!==e.renderTarget}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();let n=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;n&&this.engine.bindFramebuffer(n),this.applyEffectWrapper(e),this.draw(),n&&this.engine.unBindFramebuffer(n),this.restoreStates()}dispose(){let e=this._vertexBuffers[r.o.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[r.o.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class l{get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){let t;this.onApplyObservable=new i.y$;let n=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(n.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add(()=>{this.effect.setFloat2("scale",1,1)}));let r=e.defines?e.defines.join("\n"):"";this._drawWrapper=new o.q(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],n,e.samplerNames,r,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync)):(this.effect=new a.Q(t,e.attributeNames||["position"],n,e.samplerNames,e.engine,r,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add(()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}}},26490:function(e,t,n){let r;n.r(t),n.d(t,{Dispose:function(){return h},DumpData:function(){return u},DumpDataAsync:function(){return p},DumpFramebuffer:function(){return l},DumpTools:function(){return c}});var s=n(19472),i=n(98727),a=n(39028),o=n(31779);let f=null;async function d(){return f||(f=new Promise((e,t)=>{let i;let a=null,f={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(n.bind(n,81673)).then(({ThinEngine:d})=>{try{i=new OffscreenCanvas(100,100),a=new d(i,!1,f)}catch(e){a=new d(i=document.createElement("canvas"),!1,f)}o.l.Instances.pop(),o.l.OnEnginesDisposedObservable.add(e=>{a&&e!==a&&!a.isDisposed&&0===o.l.Instances.length&&h()}),a.getCaps().parallelShaderCompile=void 0;let l=new s.I(a);n.e(6410).then(n.bind(n,16410)).then(({passPixelShader:n})=>{if(!a){t("Engine is not defined");return}let o=new s.H({engine:a,name:n.name,fragmentShader:n.shader,samplerNames:["textureSampler"]});e(r={canvas:i,engine:a,renderer:l,wrapper:o})})}).catch(t)})),await f}async function l(e,t,n,r,s="image/png",i,a){let o=new Uint8Array((await n.readPixels(0,0,e,t)).buffer);u(e,t,o,r,s,i,!0,void 0,a)}function p(e,t,n,r="image/png",s,i=!1,a=!1,o){return new Promise(f=>{u(e,t,n,e=>f(e),r,s,i,a,o)})}function u(e,t,n,r,s="image/png",o,f=!1,l=!1,p){d().then(d=>{if(d.engine.setSize(e,t,!0),n instanceof Float32Array){let e=new Uint8Array(n.length),t=n.length;for(;t--;){let r=n[t];e[t]=Math.round(255*(0,a.Clamp)(r))}n=e}let u=d.engine.createRawTexture(n,e,t,5,!1,!f,1);d.renderer.setViewport(),d.renderer.applyEffectWrapper(d.wrapper),d.wrapper.effect._bindTexture("textureSampler",u),d.renderer.draw(),l?i.w1.ToBlob(d.canvas,e=>{let t=new FileReader;t.onload=e=>{let t=e.target.result;r&&r(t)},t.readAsArrayBuffer(e)},s,p):i.w1.EncodeScreenshotCanvasData(d.canvas,r,s,o,p),u.dispose()})}function h(){r?(r.wrapper.dispose(),r.renderer.dispose(),r.engine.dispose()):f?.then(e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()}),r=null}let c={DumpData:u,DumpDataAsync:p,DumpFramebuffer:l,Dispose:h};i.w1.DumpData=u,i.w1.DumpDataAsync=p,i.w1.DumpFramebuffer=l}}]);