"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9988,6490],{73204:function(e,t,r){r.r(t),r.d(t,{_ENVTextureLoader:function(){return i}});var n=r(46801);class i{constructor(){this.supportCascades=!1}loadCubeData(e,t,r,i,a){if(Array.isArray(e))return;let o=(0,n.qJ)(e);if(o){t.width=o.width,t.height=o.width;try{(0,n.qC)(t,o),(0,n.Ro)(t,e,o).then(()=>{t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),i&&i()},e=>{a?.("Can not upload environment levels",e)})}catch(e){a?.("Can not upload environment file",e)}}else a&&a("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},31233:function(e,t,r){var n=r(13559),i=r(68061);i.V.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(i.V.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;this._texture.isReady&&!this._texture._sphericalPolynomialPromise&&(this._texture._sphericalPolynomialPromise=n.$.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},19472:function(e,t,r){r.d(t,{H:function(){return d},I:function(){return u}});var n=r(54025),i=r(23032),a=r(60584),o=r(1806),s=r(98421);let l={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class u{constructor(e,t=l){this._fullscreenViewport=new i.l(0,0,1,1);let r=t.positions??l.positions,a=t.indices??l.indices;this.engine=e,this._vertexBuffers={[n.o.PositionKind]:new n.o(e,r,n.o.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(a),this._onContextRestoredObserver=e.onContextRestoredObservable.add(()=>{for(let t in this._indexBuffer=e.createIndexBuffer(a),this._vertexBuffers)this._vertexBuffers[t]._rebuild()})}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return void 0!==e.renderTarget}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();let r=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;r&&this.engine.bindFramebuffer(r),this.applyEffectWrapper(e),this.draw(),r&&this.engine.unBindFramebuffer(r),this.restoreStates()}dispose(){let e=this._vertexBuffers[n.o.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[n.o.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class d{get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){let t;this.onApplyObservable=new a.y$;let r=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(r.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add(()=>{this.effect.setFloat2("scale",1,1)}));let n=e.defines?e.defines.join("\n"):"";this._drawWrapper=new s.q(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],r,e.samplerNames,n,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync)):(this.effect=new o.Q(t,e.attributeNames||["position"],r,e.samplerNames,e.engine,n,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add(()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}}},26490:function(e,t,r){let n;r.r(t),r.d(t,{Dispose:function(){return c},DumpData:function(){return f},DumpDataAsync:function(){return p},DumpFramebuffer:function(){return d},DumpTools:function(){return h}});var i=r(19472),a=r(98727),o=r(39028),s=r(31779);let l=null;async function u(){return l||(l=new Promise((e,t)=>{let a;let o=null,l={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(r.bind(r,81673)).then(({ThinEngine:u})=>{try{a=new OffscreenCanvas(100,100),o=new u(a,!1,l)}catch(e){o=new u(a=document.createElement("canvas"),!1,l)}s.l.Instances.pop(),s.l.OnEnginesDisposedObservable.add(e=>{o&&e!==o&&!o.isDisposed&&0===s.l.Instances.length&&c()}),o.getCaps().parallelShaderCompile=void 0;let d=new i.I(o);r.e(6410).then(r.bind(r,16410)).then(({passPixelShader:r})=>{if(!o){t("Engine is not defined");return}let s=new i.H({engine:o,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});e(n={canvas:a,engine:o,renderer:d,wrapper:s})})}).catch(t)})),await l}async function d(e,t,r,n,i="image/png",a,o){let s=new Uint8Array((await r.readPixels(0,0,e,t)).buffer);f(e,t,s,n,i,a,!0,void 0,o)}function p(e,t,r,n="image/png",i,a=!1,o=!1,s){return new Promise(l=>{f(e,t,r,e=>l(e),n,i,a,o,s)})}function f(e,t,r,n,i="image/png",s,l=!1,d=!1,p){u().then(u=>{if(u.engine.setSize(e,t,!0),r instanceof Float32Array){let e=new Uint8Array(r.length),t=r.length;for(;t--;){let n=r[t];e[t]=Math.round(255*(0,o.Clamp)(n))}r=e}let f=u.engine.createRawTexture(r,e,t,5,!1,!l,1);u.renderer.setViewport(),u.renderer.applyEffectWrapper(u.wrapper),u.wrapper.effect._bindTexture("textureSampler",f),u.renderer.draw(),d?a.w1.ToBlob(u.canvas,e=>{let t=new FileReader;t.onload=e=>{let t=e.target.result;n&&n(t)},t.readAsArrayBuffer(e)},i,p):a.w1.EncodeScreenshotCanvasData(u.canvas,n,i,s,p),f.dispose()})}function c(){n?(n.wrapper.dispose(),n.renderer.dispose(),n.engine.dispose()):l?.then(e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()}),n=null}let h={DumpData:f,DumpDataAsync:p,DumpFramebuffer:d,Dispose:c};a.w1.DumpData=f,a.w1.DumpDataAsync=p,a.w1.DumpFramebuffer=d},46801:function(e,t,r){r.d(t,{Do:function(){return m},Lf:function(){return b},Ro:function(){return g},qC:function(){return y},qJ:function(){return c}});var n=r(98727),i=r(84534),a=r(39028),o=r(95332),s=r(24007),l=r(68061);r(70591);var u=r(38692),d=r(70626);r(66484),r(31233),r(26490);let p="image/png",f=[134,22,135,150,246,214,150,54];function c(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=0;for(let e=0;e<f.length;e++)if(t.getUint8(r++)!==f[e])return d.Y.Error("Not a babylon environment map"),null;let n="",i=0;for(;i=t.getUint8(r++);)n+=String.fromCharCode(i);let a=JSON.parse(n);return(a=h(a)).specular&&(a.specular.specularDataPosition=r,a.specular.lodGenerationScale=a.specular.lodGenerationScale||.8),a}function h(e){if(e.version>2)throw Error(`Unsupported babylon environment map version "${e.version}". Latest supported version is "2".`);return 2===e.version?e:e={...e,version:2,imageType:p}}function m(e,t){let r=(t=h(t)).specular,n=Math.log2(t.width);if(n=Math.round(n)+1,r.mipmaps.length!==6*n)throw Error(`Unsupported specular mipmaps number "${r.mipmaps.length}"`);let i=Array(n);for(let t=0;t<n;t++){i[t]=Array(6);for(let n=0;n<6;n++){let a=r.mipmaps[6*t+n];i[t][n]=new Uint8Array(e.buffer,e.byteOffset+r.specularDataPosition+a.position,a.length)}}return i}function g(e,t,r){let n=(r=h(r)).specular;return n?(e._lodGenerationScale=n.lodGenerationScale,_(e,m(t,r),r.imageType)):Promise.resolve()}function x(e,t,r,n,i,a,o,s,l,u,d){return new Promise((p,f)=>{if(r){let r=t.createTexture(null,!0,!0,null,1,null,e=>{f(e)},e);n?.onEffectCreatedObservable.addOnce(s=>{s.executeWhenCompiled(()=>{n.externalTextureSamplerBinding=!0,n.onApply=n=>{n._bindTexture("textureSampler",r),n.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([n],u,!0,a,o),t.restoreDefaultFramebuffer(),r.dispose(),URL.revokeObjectURL(i),p())})})}else{if(t._uploadImageToTexture(d,e,a,o),s){let r=l[o];r&&t._uploadImageToTexture(r._texture,e,a,0)}p()}})}async function _(e,t,i=p){if(!n.w1.IsExponentOfTwo(e.width))throw Error("Texture size must be a power of two");let o=(0,a.ILog2)(e.width)+1,d=e.getEngine(),f=!1,c=!1,h=null,m=null,g=null,_=d.getCaps();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,d.updateTextureSamplingMode(3,e),_.textureLOD?d._features.supportRenderAndCopyToLodForFloatTextures?_.textureHalfFloatRender&&_.textureHalfFloatLinearFiltering?(f=!0,e.type=2):_.textureFloatRender&&_.textureFloatLinearFiltering&&(f=!0,e.type=1):f=!1:(f=!1,c=!0,g={});let y=0;if(f)d.isWebGPU?(y=1,await r.e(304).then(r.bind(r,70304))):await r.e(9912).then(r.bind(r,49912)),h=new u.D("rgbdDecode","rgbdDecode",null,null,1,null,3,d,!1,void 0,e.type,void 0,null,!1,void 0,y),e._isRGBD=!1,e.invertY=!1,m=d.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,c){let t=e._lodGenerationScale,r=e._lodGenerationOffset;for(let n=0;n<3;n++){let i=(o-1)*t+r,a=Math.round(Math.min(Math.max(r+(i-r)*(1-n/2),0),i)),u=new s.l(d,2);u.isCube=!0,u.invertY=!0,u.generateMipMaps=!1,d.updateTextureSamplingMode(2,u);let p=new l.V(null);switch(p._isCube=!0,p._texture=u,g[a]=p,n){case 0:e._lodTextureLow=p;break;case 1:e._lodTextureMid=p;break;case 2:e._lodTextureHigh=p}}}let b=[];for(let r=0;r<t.length;r++)for(let n=0;n<6;n++){let a;let o=new Blob([t[r][n]],{type:i}),s=URL.createObjectURL(o);if(d._features.forceBitmapOverHTMLImageElement)a=d.createImageBitmap(o,{premultiplyAlpha:"none"}).then(t=>x(t,d,f,h,s,n,r,c,g,m,e));else{let t=new Image;t.src=s,a=new Promise((i,a)=>{t.onload=()=>{x(t,d,f,h,s,n,r,c,g,m,e).then(()=>i()).catch(e=>{a(e)})},t.onerror=e=>{a(e)}})}b.push(a)}if(t.length<o){let r;let n=Math.pow(2,o-1-t.length),i=n*n*4;switch(e.type){case 0:r=new Uint8Array(i);break;case 2:r=new Uint16Array(i);break;case 1:r=new Float32Array(i)}for(let n=t.length;n<o;n++)for(let t=0;t<6;t++)d._uploadArrayBufferViewToTexture(e,r,t,n)}return Promise.all(b).then(()=>{m&&(d._releaseTexture(e),m._swapAndDie(e)),h&&h.dispose(),c&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))})}function y(e,t){let r=(t=h(t)).irradiance;if(!r)return;let n=new o.i;i.P.FromArrayToRef(r.x,0,n.x),i.P.FromArrayToRef(r.y,0,n.y),i.P.FromArrayToRef(r.z,0,n.z),i.P.FromArrayToRef(r.xx,0,n.xx),i.P.FromArrayToRef(r.yy,0,n.yy),i.P.FromArrayToRef(r.zz,0,n.zz),i.P.FromArrayToRef(r.yz,0,n.yz),i.P.FromArrayToRef(r.zx,0,n.zx),i.P.FromArrayToRef(r.xy,0,n.xy),e._sphericalPolynomial=n}function b(e,t,r,n,i){let a=_(e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),t).then(()=>e);return e.onRebuildCallback=e=>({proxy:a,isReady:!0,isAsync:!0}),e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=n,e._lodGenerationOffset=i,e._sphericalPolynomial=r,_(e,t).then(()=>(e.isReady=!0,e))}},66484:function(e,t,r){r.d(t,{r:function(){return a}});var n=r(38692),i=r(41587);class a{static ExpandRGBDTexture(e){let t=e._texture;if(!t||!e.isRGBD)return;let i=t.getEngine(),a=i.getCaps(),o=t.isReady,s=!1;a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?(s=!0,t.type=2):a.textureFloatRender&&a.textureFloatLinearFiltering&&(s=!0,t.type=1),s&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);let l=async()=>{let a=i.isWebGPU;t.isReady=!1,a?await Promise.all([r.e(304).then(r.bind(r,70304)),r.e(3226).then(r.bind(r,3226))]):await Promise.all([r.e(9912).then(r.bind(r,49912)),r.e(4810).then(r.bind(r,64810))]);let o=new n.D("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,t.type,void 0,null,!1,void 0,a?1:0);o.externalTextureSamplerBinding=!0;let s=i.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});o.onEffectCreatedObservable.addOnce(r=>{r.executeWhenCompiled(()=>{o.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},e.getScene().postProcessManager.directRender([o],s,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(t),o&&o.dispose(),s._swapAndDie(t),t.isReady=!0})})};s&&(o?l():e.onLoadObservable.addOnce(l))}static EncodeTextureToRGBD(e,t,r=0){return(0,i.$0)("rgbdEncode",e,t,r,1,5)}}}}]);