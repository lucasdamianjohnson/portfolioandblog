(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1471],{93813:function(e,t,r){!function(){var t={452:function(e){"use strict";e.exports=r(85605)}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var n=i[e]={exports:{}},a=!0;try{t[e](n,n.exports,s),a=!1}finally{a&&delete i[e]}return n.exports}s.ab="//";var n={};!function(){var e,t=(e=s(452))&&"object"==typeof e&&"default"in e?e.default:e,r=/https?|ftp|gopher|file/;function i(e){"string"==typeof e&&(e=m(e));var i,s,n,a,o,l,h,c,f,u=(s=(i=e).auth,n=i.hostname,a=i.protocol||"",o=i.pathname||"",l=i.hash||"",h=i.query||"",c=!1,s=s?encodeURIComponent(s).replace(/%3A/i,":")+"@":"",i.host?c=s+i.host:n&&(c=s+(~n.indexOf(":")?"["+n+"]":n),i.port&&(c+=":"+i.port)),h&&"object"==typeof h&&(h=t.encode(h)),f=i.search||h&&"?"+h||"",a&&":"!==a.substr(-1)&&(a+=":"),i.slashes||(!a||r.test(a))&&!1!==c?(c="//"+(c||""),o&&"/"!==o[0]&&(o="/"+o)):c||(c=""),l&&"#"!==l[0]&&(l="#"+l),f&&"?"!==f[0]&&(f="?"+f),{protocol:a,host:c,pathname:o=o.replace(/[?#]/g,encodeURIComponent),search:f=f.replace("#","%23"),hash:l});return""+u.protocol+u.host+u.pathname+u.search+u.hash}var a="http://",o=a+"w.w",l=/^([a-z0-9.+-]*:\/\/\/)([a-z0-9.+-]:\/*)?/i,h=/https?|ftp|gopher|file/;function c(e,t){var r="string"==typeof e?m(e):e;e="object"==typeof e?i(e):e;var s=m(t),n="";r.protocol&&!r.slashes&&(n=r.protocol,e=e.replace(r.protocol,""),n+="/"===t[0]||"/"===e[0]?"/":""),n&&s.protocol&&(n="",s.slashes||(n=s.protocol,t=t.replace(s.protocol,"")));var c=e.match(l);c&&!s.protocol&&(e=e.substr((n=c[1]+(c[2]||"")).length),/^\/\/[^/]/.test(t)&&(n=n.slice(0,-1)));var f=new URL(e,o+"/"),u=new URL(t,f).toString().replace(o,""),g=s.protocol||r.protocol;return g+=r.slashes||s.slashes?"//":"",!n&&g?u=u.replace(a,g):n&&(u=u.replace(a,"")),h.test(u)||~t.indexOf(".")||"/"===e.slice(-1)||"/"===t.slice(-1)||"/"!==u.slice(-1)||(u=u.slice(0,-1)),n&&(u=n+("/"===u[0]?u.substr(1):u)),u}function f(){}f.prototype.parse=m,f.prototype.format=i,f.prototype.resolve=c,f.prototype.resolveObject=c;var u=/^https?|ftp|gopher|file/,g=/^(.*?)([#?].*)/,d=/^([a-z0-9.+-]*:)(\/{0,3})(.*)/i,p=/^([a-z0-9.+-]*:)?\/\/\/*/i,y=/^([a-z0-9.+-]*:)(\/{0,2})\[(.*)\]$/i;function m(e,r,s){if(void 0===r&&(r=!1),void 0===s&&(s=!1),e&&"object"==typeof e&&e instanceof f)return e;var n=(e=e.trim()).match(g);e=n?n[1].replace(/\\/g,"/")+n[2]:e.replace(/\\/g,"/"),y.test(e)&&"/"!==e.slice(-1)&&(e+="/");var a=!/(^javascript)/.test(e)&&e.match(d),l=p.test(e),h="";a&&(u.test(a[1])||(h=a[1].toLowerCase(),e=""+a[2]+a[3]),a[2]||(l=!1,u.test(a[1])?(h=a[1],e=""+a[3]):e="//"+a[3]),3!==a[2].length&&1!==a[2].length||(h=a[1],e="/"+a[3]));var c,m=(n?n[1]:e).match(/^https?:\/\/[^/]+(:[0-9]+)(?=\/|$)/),w=m&&m[1],b=new f,S="",I="";try{c=new URL(e)}catch(t){S=t,h||s||!/^\/\//.test(e)||/^\/\/.+[@.]/.test(e)||(I="/",e=e.substr(1));try{c=new URL(e,o)}catch(e){return b.protocol=h,b.href=h,b}}b.slashes=l&&!I,b.host="w.w"===c.host?"":c.host,b.hostname="w.w"===c.hostname?"":c.hostname.replace(/(\[|\])/g,""),b.protocol=S?h||null:c.protocol,b.search=c.search.replace(/\\/g,"%5C"),b.hash=c.hash.replace(/\\/g,"%5C");var x=e.split("#");!b.search&&~x[0].indexOf("?")&&(b.search="?"),b.hash||""!==x[1]||(b.hash="#"),b.query=r?t.decode(c.search.substr(1)):b.search.substr(1),b.pathname=I+(a?c.pathname.replace(/['^|`]/g,function(e){return"%"+e.charCodeAt().toString(16).toUpperCase()}).replace(/((?:%[0-9A-F]{2})+)/g,function(e,t){try{return decodeURIComponent(t).split("").map(function(e){var t=e.charCodeAt();return t>256||/^[a-z0-9]$/i.test(e)?e:"%"+t.toString(16).toUpperCase()}).join("")}catch(e){return t}}):c.pathname),"about:"===b.protocol&&"blank"===b.pathname&&(b.protocol="",b.pathname=""),S&&"/"!==e[0]&&(b.pathname=b.pathname.substr(1)),h&&!u.test(h)&&"/"!==e.slice(-1)&&"/"===b.pathname&&(b.pathname=""),b.path=b.pathname+b.search,b.auth=[c.username,c.password].map(decodeURIComponent).filter(Boolean).join(":"),b.port=c.port,w&&!b.host.endsWith(w)&&(b.host+=w,b.port=w.slice(1)),b.href=I?""+b.pathname+b.search+b.hash:i(b);var A=/^(file)/.test(b.href)?["host","hostname"]:[];return Object.keys(b).forEach(function(e){~A.indexOf(e)||(b[e]=b[e]||null)}),b}n.parse=m,n.format=i,n.resolve=c,n.resolveObject=function(e,t){return m(c(e,t))},n.Url=f}(),e.exports=n}()},85605:function(e){!function(){"use strict";var t={815:function(e){e.exports=function(e,r,i,s){r=r||"&",i=i||"=";var n={};if("string"!=typeof e||0===e.length)return n;var a=/\+/g;e=e.split(r);var o=1e3;s&&"number"==typeof s.maxKeys&&(o=s.maxKeys);var l=e.length;o>0&&l>o&&(l=o);for(var h=0;h<l;++h){var c,f,u,g,d=e[h].replace(a,"%20"),p=d.indexOf(i);(p>=0?(c=d.substr(0,p),f=d.substr(p+1)):(c=d,f=""),u=decodeURIComponent(c),g=decodeURIComponent(f),Object.prototype.hasOwnProperty.call(n,u))?t(n[u])?n[u].push(g):n[u]=[n[u],g]:n[u]=g}return n};var t=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},577:function(e){var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,n,a,o){return(n=n||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e)?i(s(e),function(s){var o=encodeURIComponent(t(s))+a;return r(e[s])?i(e[s],function(e){return o+encodeURIComponent(t(e))}).join(n):o+encodeURIComponent(t(e[s]))}).join(n):o?encodeURIComponent(t(o))+a+encodeURIComponent(t(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var r=[],i=0;i<e.length;i++)r.push(t(e[i],i));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}}},r={};function i(e){var s=r[e];if(void 0!==s)return s.exports;var n=r[e]={exports:{}},a=!0;try{t[e](n,n.exports,i),a=!1}finally{a&&delete r[e]}return n.exports}i.ab="//";var s={};s.decode=s.parse=i(815),s.encode=s.stringify=i(577),e.exports=s}()},95517:function(e){function t(e,t){let r=RegExp(t,"g"),i=e.match(r);return i?i.length:0}e.exports=t,e.exports.default=t},28015:function(e,t,r){let i=r(49145),s=r(90465),n=r(95517);function a(e,t,r){let a=r&&r.debug||!1,o=(r&&r.nested,!0),l=r&&r.startIndex||0;a&&console.log("[xml-utils] starting findTagByName with",t," and ",r);let h=i(e,`<${t}[ 
>/]`,l);if(a&&console.log("[xml-utils] start:",h),-1===h)return;let c=e.slice(h+t.length),f=s(c,"^[^<]*[ /]>",0),u=-1!==f&&"/"===c[f-1];if(a&&console.log("[xml-utils] selfClosing:",u),!1===u){if(o){let e=0,r=1,i=0;for(;-1!==(f=s(c,"[ /]"+t+">",e));){let s=c.substring(e,f+1);if(r+=n(s,"<"+t+"[ \n	>]"),(i+=n(s,"</"+t+">"))>=r)break;e=f}}else f=s(c,"[ /]"+t+">",0)}let g=h+t.length+f+1;if(a&&console.log("[xml-utils] end:",g),-1===g)return;let d=e.slice(h,g);return{inner:u?null:d.slice(d.indexOf(">")+1,d.lastIndexOf("<")),outer:d,start:h,end:g}}e.exports=a,e.exports.default=a},1049:function(e,t,r){let i=r(28015);function s(e,t,r){let s;let n=[],a=r&&r.debug||!1,o=!r||"boolean"!=typeof r.nested||r.nested,l=r&&r.startIndex||0;for(;s=i(e,t,{debug:a,startIndex:l});)l=o?s.start+1+t.length:s.end,n.push(s);return a&&console.log("findTagsByName found",n.length,"tags"),n}e.exports=s,e.exports.default=s},19410:function(e){function t(e,t,r){let i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+e);let s="object"==typeof e?e.outer:e,n=s.slice(0,s.indexOf(">")+1),a=['"',"'"];for(let e=0;e<a.length;e++){let r=a[e],s=t+"\\="+r+"([^"+r+"]*)"+r;i&&console.log("[xml-utils] pattern:",s);let o=new RegExp(s).exec(n);if(i&&console.log("[xml-utils] match:",o),o)return o[1]}}e.exports=t,e.exports.default=t},90465:function(e){function t(e,t,r){let i=new RegExp(t).exec(e.slice(r));return i?r+i.index+i[0].length-1:-1}e.exports=t,e.exports.default=t},49145:function(e){function t(e,t,r){let i=new RegExp(t).exec(e.slice(r));return i?r+i.index:-1}e.exports=t,e.exports.default=t},31471:function(e,t,r){"use strict";function i(e){return(t,...r)=>n(e,t,r)}function s(e,t){return i(h(e,t).get)}r.d(t,{W0:function(){return e2}});let{apply:n,construct:a,defineProperty:o,get:l,getOwnPropertyDescriptor:h,getPrototypeOf:c,has:f,ownKeys:u,set:g,setPrototypeOf:d}=Reflect,{EPSILON:p,MAX_SAFE_INTEGER:y,isFinite:m,isNaN:w}=Number,{iterator:b,species:S,toStringTag:I,for:x}=Symbol,A=Object,{create:T,defineProperty:E,freeze:D,is:C}=A,P=A.prototype;P.__lookupGetter__&&i(P.__lookupGetter__),A.hasOwn||i(P.hasOwnProperty);let M=Array;M.isArray;let _=M.prototype;i(_.join),i(_.push),i(_.toLocaleString);let U=_[b],O=i(U),{abs:R,trunc:k}=Math,v=ArrayBuffer;v.isView;let G=v.prototype;i(G.slice),s(G,"byteLength");let F="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null;F&&s(F.prototype,"byteLength");let L=c(Uint8Array);L.from;let B=L.prototype;B[b],i(B.keys),i(B.values),i(B.entries),i(B.set),i(B.reverse),i(B.fill),i(B.copyWithin),i(B.sort),i(B.slice),i(B.subarray),s(B,"buffer"),s(B,"byteOffset"),s(B,"length"),s(B,I);let N=Uint8Array,z=Uint16Array,V=Uint32Array,j=Float32Array,K=c([][b]()),q=i(K.next),H=i(function*(){}().next),W=c(K),$=DataView.prototype,Y=i($.getUint16);i($.setUint16);let X=WeakSet.prototype;i(X.add),i(X.has);let Z=WeakMap,J=Z.prototype,Q=i(J.get);i(J.has);let ee=i(J.set),et=new Z,er=T(null,{next:{value:function(){return q(Q(et,this))}},[b]:{value:function(){return this}}}),ei=new Z,es=T(W,{next:{value:function(){return H(Q(ei,this))},writable:!0,configurable:!0}});for(let e of u(K))"next"!==e&&E(es,e,h(K,e));let en=new v(4),ea=new j(en),eo=new V(en),el=new z(512),eh=new N(512);for(let e=0;e<256;++e){let t=e-127;t<-24?(el[e]=0,el[256|e]=32768,eh[e]=24,eh[256|e]=24):t<-14?(el[e]=1024>>-t-14,el[256|e]=1024>>-t-14|32768,eh[e]=-t-1,eh[256|e]=-t-1):t<=15?(el[e]=t+15<<10,el[256|e]=t+15<<10|32768,eh[e]=13,eh[256|e]=13):t<128?(el[e]=31744,el[256|e]=64512,eh[e]=24,eh[256|e]=24):(el[e]=31744,el[256|e]=64512,eh[e]=13,eh[256|e]=13)}let ec=new V(2048);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;(8388608&t)==0;)t<<=1,r-=8388608;t&=-8388609,r+=947912704,ec[e]=t|r}for(let e=1024;e<2048;++e)ec[e]=939524096+(e-1024<<13);let ef=new V(64);for(let e=1;e<31;++e)ef[e]=e<<23;ef[31]=1199570944,ef[32]=2147483648;for(let e=33;e<63;++e)ef[e]=2147483648+(e-32<<23);ef[63]=3347054592;let eu=new z(64);for(let e=1;e<64;++e)32!==e&&(eu[e]=1024);function eg(e,t,...r){return function(e){let t=e>>10;return eo[0]=ec[eu[t]+(1023&e)]+ef[t],ea[0]}(Y(e,t,...function(e){if(e[b]===U&&K.next===q)return e;let t=T(er);return ee(et,t,O(e)),t}(r)))}var ed=r(19410),ep=r(1049),ey=r(72093);let em=new Map;function ew(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>em.set(e,t))}async function eb(e){let t=em.get(e.Compression);if(!t)throw Error(`Unknown compression method identifier: ${e.Compression}`);return new(await t())(e)}function eS(e,t,r,i=1){return new(Object.getPrototypeOf(e)).constructor(t*r*i)}function eI(e,t,r){switch(e){case 1:if(t<=8)return new Uint8Array(r);if(t<=16)return new Uint16Array(r);if(t<=32)return new Uint32Array(r);break;case 2:if(8===t)return new Int8Array(r);if(16===t)return new Int16Array(r);if(32===t)return new Int32Array(r);break;case 3:switch(t){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}}throw Error("Unsupported data format/bitsPerSample")}ew([void 0,1],()=>r.e(229).then(r.bind(r,90229)).then(e=>e.default)),ew(5,()=>r.e(1203).then(r.bind(r,51203)).then(e=>e.default)),ew(6,()=>{throw Error("old style JPEG compression is not supported.")}),ew(7,()=>r.e(8737).then(r.bind(r,38737)).then(e=>e.default)),ew([8,32946],()=>Promise.all([r.e(3125),r.e(9630)]).then(r.bind(r,69630)).then(e=>e.default)),ew(32773,()=>r.e(6229).then(r.bind(r,6229)).then(e=>e.default)),ew(34887,()=>Promise.all([r.e(3125),r.e(3844)]).then(r.bind(r,43844)).then(async e=>(await e.zstd.init(),e)).then(e=>e.default)),ew(50001,()=>r.e(8593).then(r.bind(r,88593)).then(e=>e.default));class ex{constructor(e,t,r,i,s,n){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;let a=e.PlanarConfiguration;if(this.planarConfiguration=void 0===a?1:a,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw Error("Invalid planar configuration.");this.source=n}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){let t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(e,t){return eg(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){return eI(this.getSampleFormat(e),this.getBitsPerSample(e),t)}async getTileOrStrip(e,t,r,i,s){let n,a,o,l;let h=Math.ceil(this.getWidth()/this.getTileWidth()),c=Math.ceil(this.getHeight()/this.getTileHeight()),{tiles:f}=this;1===this.planarConfiguration?n=t*h+e:2===this.planarConfiguration&&(n=r*h*c+t*h+e),this.isTiled?(a=this.fileDirectory.TileOffsets[n],o=this.fileDirectory.TileByteCounts[n]):(a=this.fileDirectory.StripOffsets[n],o=this.fileDirectory.StripByteCounts[n]);let u=(await this.source.fetch([{offset:a,length:o}],s))[0];return null!==f&&f[n]?l=f[n]:(l=(async()=>{let e=await i.decode(this.fileDirectory,u),r=this.getSampleFormat(),s=this.getBitsPerSample();return(1===r||2===r)&&s<=32&&s%8==0||3===r&&(16===s||32===s||64===s)||(e=function(e,t,r,i,s,n,a){let o=new DataView(e),l=2===r?1:i,h=eI(t,s,2===r?a*n:a*n*i),c=parseInt("1".repeat(s),2);if(1===t){let e=n*(1===r?i*s:s);(7&e)!=0&&(e=e+7&-8);for(let t=0;t<a;++t){let r=t*e;for(let e=0;e<n;++e){let i=r+e*l*s;for(let r=0;r<l;++r){let a=i+r*s,f=(t*n+e)*l+r,u=Math.floor(a/8),g=a%8;if(g+s<=8)h[f]=o.getUint8(u)>>8-s-g&c;else if(g+s<=16)h[f]=o.getUint16(u)>>16-s-g&c;else if(g+s<=24){let e=o.getUint16(u)<<8|o.getUint8(u+2);h[f]=e>>24-s-g&c}else h[f]=o.getUint32(u)>>32-s-g&c}}}}return h.buffer}(e,r,this.planarConfiguration,this.getSamplesPerPixel(),s,this.getTileWidth(),this.getBlockHeight(t))),e})(),null!==f&&(f[n]=l)),{x:e,y:t,sample:r,data:await l}}async _readRaster(e,t,r,i,s,n,a,o,l){let h=this.getTileWidth(),c=this.getTileHeight(),f=this.getWidth(),u=this.getHeight(),g=Math.max(Math.floor(e[0]/h),0),d=Math.min(Math.ceil(e[2]/h),Math.ceil(f/h)),p=Math.max(Math.floor(e[1]/c),0),y=Math.min(Math.ceil(e[3]/c),Math.ceil(u/c)),m=e[2]-e[0],w=this.getBytesPerPixel(),b=[],S=[];for(let e=0;e<t.length;++e)1===this.planarConfiguration?b.push(function(e,t,r){let i=0;for(let t=0;t<r;++t)i+=e[t];return i}(this.fileDirectory.BitsPerSample,0,t[e])/8):b.push(0),S.push(this.getReaderForSample(t[e]));let I=[],{littleEndian:x}=this;for(let n=p;n<y;++n)for(let a=g;a<d;++a){let o;1===this.planarConfiguration&&(o=this.getTileOrStrip(a,n,0,s,l));for(let g=0;g<t.length;++g){let d=g,p=t[g];2===this.planarConfiguration&&(w=this.getSampleByteSize(p),o=this.getTileOrStrip(a,n,p,s,l));let y=o.then(s=>{let n=new DataView(s.data),a=this.getBlockHeight(s.y),o=s.y*c,l=s.x*h,g=o+a,p=(s.x+1)*h,y=S[d],I=Math.min(a,a-(g-e[3]),u-o),A=Math.min(h,h-(p-e[2]),f-l);for(let s=Math.max(0,e[1]-o);s<I;++s)for(let a=Math.max(0,e[0]-l);a<A;++a){let c;let f=(s*h+a)*w,u=y.call(n,f+b[d],x);i?r[c=(s+o-e[1])*m*t.length+(a+l-e[0])*t.length+d]=u:(c=(s+o-e[1])*m+a+l-e[0],r[d][c]=u)}});I.push(y)}}if(await Promise.all(I),n&&e[2]-e[0]!==n||a&&e[3]-e[1]!==a){let s;return(s=i?function(e,t,r,i,s,n,a="nearest"){switch(a.toLowerCase()){case"nearest":return function(e,t,r,i,s,n){let a=t/i,o=r/s,l=eS(e,i,s,n);for(let h=0;h<s;++h){let s=Math.min(Math.round(o*h),r-1);for(let r=0;r<i;++r){let o=Math.min(Math.round(a*r),t-1);for(let a=0;a<n;++a){let c=e[s*t*n+o*n+a];l[h*i*n+r*n+a]=c}}}return l}(e,t,r,i,s,n);case"bilinear":case"linear":return function(e,t,r,i,s,n){let a=t/i,o=r/s,l=eS(e,i,s,n);for(let u=0;u<s;++u){let s=o*u,g=Math.floor(s),d=Math.min(Math.ceil(s),r-1);for(let r=0;r<i;++r){let o=a*r,p=o%1,y=Math.floor(o),m=Math.min(Math.ceil(o),t-1);for(let a=0;a<n;++a){var h,c,f;let o=e[g*t*n+y*n+a],w=e[g*t*n+m*n+a],b=e[d*t*n+y*n+a],S=e[d*t*n+m*n+a],I=(h=(1-p)*o+p*w,c=(1-p)*b+p*S,(1-(f=s%1))*h+f*c);l[u*i*n+r*n+a]=I}}}return l}(e,t,r,i,s,n);default:throw Error(`Unsupported resampling method: '${a}'`)}}(r,e[2]-e[0],e[3]-e[1],n,a,t.length,o):function(e,t,r,i,s,n="nearest"){switch(n.toLowerCase()){case"nearest":return function(e,t,r,i,s){let n=t/i,a=r/s;return e.map(e=>{let o=eS(e,i,s);for(let l=0;l<s;++l){let s=Math.min(Math.round(a*l),r-1);for(let r=0;r<i;++r){let a=Math.min(Math.round(n*r),t-1),h=e[s*t+a];o[l*i+r]=h}}return o})}(e,t,r,i,s);case"bilinear":case"linear":return function(e,t,r,i,s){let n=t/i,a=r/s;return e.map(e=>{let o=eS(e,i,s);for(let f=0;f<s;++f){let s=a*f,u=Math.floor(s),g=Math.min(Math.ceil(s),r-1);for(let r=0;r<i;++r){var l,h,c;let a=n*r,d=a%1,p=Math.floor(a),y=Math.min(Math.ceil(a),t-1),m=e[u*t+p],w=e[u*t+y],b=e[g*t+p],S=e[g*t+y],I=(l=(1-d)*m+d*w,h=(1-d)*b+d*S,(1-(c=s%1))*l+c*h);o[f*i+r]=I}}return o})}(e,t,r,i,s);default:throw Error(`Unsupported resampling method: '${n}'`)}}(r,e[2]-e[0],e[3]-e[1],n,a,o)).width=n,s.height=a,s}return r.width=n||e[2]-e[0],r.height=a||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:s,height:n,resampleMethod:a,fillValue:o,signal:l}={}){let h;let c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw Error("Invalid subsets");let f=(c[2]-c[0])*(c[3]-c[1]),u=this.getSamplesPerPixel();if(t&&t.length){for(let e=0;e<t.length;++e)if(t[e]>=u)return Promise.reject(RangeError(`Invalid sample index '${t[e]}'.`))}else for(let e=0;e<u;++e)t.push(e);if(r)h=eI(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),f*t.length),o&&h.fill(o);else{h=[];for(let e=0;e<t.length;++e){let r=this.getArrayForSample(t[e],f);Array.isArray(o)&&e<o.length?r.fill(o[e]):o&&!Array.isArray(o)&&r.fill(o),h.push(r)}}let g=i||await eb(this.fileDirectory);return await this._readRaster(c,t,h,r,g,s,n,a,l)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:s,resampleMethod:n,enableAlpha:a=!1,signal:o}={}){let l,h;let c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw Error("Invalid subsets");let f=this.fileDirectory.PhotometricInterpretation;if(f===ey.Ie.RGB){let l=[0,1,2];if(this.fileDirectory.ExtraSamples!==ey.pd.Unspecified&&a){l=[];for(let e=0;e<this.fileDirectory.BitsPerSample.length;e+=1)l.push(e)}return this.readRasters({window:e,interleave:t,samples:l,pool:r,width:i,height:s,resampleMethod:n,signal:o})}switch(f){case ey.Ie.WhiteIsZero:case ey.Ie.BlackIsZero:case ey.Ie.Palette:l=[0];break;case ey.Ie.CMYK:l=[0,1,2,3];break;case ey.Ie.YCbCr:case ey.Ie.CIELab:l=[0,1,2];break;default:throw Error("Invalid or unsupported photometric interpretation.")}let u={window:c,interleave:!0,samples:l,pool:r,width:i,height:s,resampleMethod:n,signal:o},{fileDirectory:g}=this,d=await this.readRasters(u),p=2**this.fileDirectory.BitsPerSample[0];switch(f){case ey.Ie.WhiteIsZero:h=function(e,t){let r;let{width:i,height:s}=e,n=new Uint8Array(i*s*3);for(let i=0,s=0;i<e.length;++i,s+=3)r=256-e[i]/t*256,n[s]=r,n[s+1]=r,n[s+2]=r;return n}(d,p);break;case ey.Ie.BlackIsZero:h=function(e,t){let r;let{width:i,height:s}=e,n=new Uint8Array(i*s*3);for(let i=0,s=0;i<e.length;++i,s+=3)r=e[i]/t*256,n[s]=r,n[s+1]=r,n[s+2]=r;return n}(d,p);break;case ey.Ie.Palette:h=function(e,t){let{width:r,height:i}=e,s=new Uint8Array(r*i*3),n=t.length/3,a=t.length/3*2;for(let r=0,i=0;r<e.length;++r,i+=3){let o=e[r];s[i]=t[o]/65536*256,s[i+1]=t[o+n]/65536*256,s[i+2]=t[o+a]/65536*256}return s}(d,g.ColorMap);break;case ey.Ie.CMYK:h=function(e){let{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=4,r+=3){let s=e[t],n=e[t+1],a=e[t+2],o=e[t+3];i[r]=(255-s)/256*255*((255-o)/256),i[r+1]=(255-n)/256*255*((255-o)/256),i[r+2]=(255-a)/256*255*((255-o)/256)}return i}(d);break;case ey.Ie.YCbCr:h=function(e){let{width:t,height:r}=e,i=new Uint8ClampedArray(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){let s=e[t],n=e[t+1],a=e[t+2];i[r]=s+1.402*(a-128),i[r+1]=s-.34414*(n-128)-.71414*(a-128),i[r+2]=s+1.772*(n-128)}return i}(d);break;case ey.Ie.CIELab:h=function(e){let{width:t,height:r}=e,i=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){let s,n,a;let o=e[t+0],l=e[t+1]<<24>>24,h=e[t+2]<<24>>24,c=(o+16)/116,f=l/500+c,u=c-h/200;s=(s=3.2406*(f=.95047*(f*f*f>.008856?f*f*f:(f-16/116)/7.787))+-1.5372*(c=1*(c*c*c>.008856?c*c*c:(c-16/116)/7.787))+-.4986*(u=1.08883*(u*u*u>.008856?u*u*u:(u-16/116)/7.787)))>.0031308?1.055*s**(1/2.4)-.055:12.92*s,n=(n=-.9689*f+1.8758*c+.0415*u)>.0031308?1.055*n**(1/2.4)-.055:12.92*n,a=(a=.0557*f+-.204*c+1.057*u)>.0031308?1.055*a**(1/2.4)-.055:12.92*a,i[r]=255*Math.max(0,Math.min(1,s)),i[r+1]=255*Math.max(0,Math.min(1,n)),i[r+2]=255*Math.max(0,Math.min(1,a))}return i}(d);break;default:throw Error("Unsupported photometric interpretation.")}if(!t){let e=new Uint8Array(h.length/3),t=new Uint8Array(h.length/3),r=new Uint8Array(h.length/3);for(let i=0,s=0;i<h.length;i+=3,++s)e[s]=h[i],t[s]=h[i+1],r[s]=h[i+2];h=[e,t,r]}return h.width=d.width,h.height=d.height,h}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];let e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){let t={};if(!this.fileDirectory.GDAL_METADATA)return null;let r=ep(this.fileDirectory.GDAL_METADATA,"Item");r=null===e?r.filter(e=>void 0===ed(e,"sample")):r.filter(t=>Number(ed(t,"sample"))===e);for(let e=0;e<r.length;++e){let i=r[e];t[ed(i,"name")]=i.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;let e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){let e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw Error("The image does not have an affine transformation.")}getResolution(e=null){let t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return 0===r[1]&&0===r[4]?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){let[t,r,i]=e.getResolution();return[t*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),i*e.getWidth()/this.getWidth()]}throw Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(e=!1){let t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){let[e,i,s,n,a,o,l,h]=this.fileDirectory.ModelTransformation,c=[[0,0],[0,t],[r,0],[r,t]].map(([t,r])=>[n+e*t+i*r,h+a*t+o*r]),f=c.map(e=>e[0]),u=c.map(e=>e[1]);return[Math.min(...f),Math.min(...u),Math.max(...f),Math.max(...u)]}{let e=this.getOrigin(),i=this.getResolution(),s=e[0],n=e[1],a=s+i[0]*r,o=n+i[1]*t;return[Math.min(s,a),Math.min(n,o),Math.max(s,a),Math.max(n,o)]}}}class eA{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){let r;let i=this.getUint32(e,t),s=this.getUint32(e+4,t);if(t){if(!Number.isSafeInteger(r=i+4294967296*s))throw Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(!Number.isSafeInteger(r=4294967296*i+s))throw Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(e,t){let r=0,i=(128&this._dataView.getUint8(e+(t?7:0)))>0,s=!0;for(let n=0;n<8;n++){let a=this._dataView.getUint8(e+(t?n:7-n));i&&(s?0!==a&&(a=255&~(a-1),s=!1):a=255&~a),r+=a*256**n}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return eg(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class eT{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){let t;let r=this.readUint32(e),i=this.readUint32(e+4);if(this._littleEndian){if(!Number.isSafeInteger(t=r+4294967296*i))throw Error(`${t} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return t}if(!Number.isSafeInteger(t=4294967296*r+i))throw Error(`${t} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return t}readInt64(e){let t=0,r=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0,i=!0;for(let s=0;s<8;s++){let n=this._dataView.getUint8(e+(this._littleEndian?s:7-s));r&&(i?0!==n&&(n=255&~(n-1),i=!1):n=255&~n),t+=n*256**s}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}let eE="\r\n\r\n";function eD(e){if(void 0!==Object.fromEntries)return Object.fromEntries(e);let t={};for(let[r,i]of e)t[r.toLowerCase()]=i;return t}function eC(e){let t,r,i;return e&&([,t,r,i]=e.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),r=parseInt(r,10),i=parseInt(i,10)),{start:t,end:r,total:i}}class eP{async fetch(e,t){return Promise.all(e.map(e=>this.fetchSlice(e,t)))}async fetchSlice(e){throw Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class eM extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(let[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return!!("number"==typeof t.expiry&&t.expiry<=Date.now())&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,r]=e;this.cache.has(t)||!1!==this._deleteIfExpired(t,r)||(yield e)}for(let e of this.cache){let[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){let i="number"==typeof r&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}for(let e of this.oldCache){let[t,r]=e;this.cache.has(t)||!1!==this._deleteIfExpired(t,r)||(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let[r,i]=e[t];!1===this._deleteIfExpired(r,i)&&(yield[r,i.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let[r,i]=e[t];this.cache.has(r)||!1!==this._deleteIfExpired(r,i)||(yield[r,i.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())!this.cache.has(t)&&e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function e_(e){return new Promise(t=>setTimeout(t,e))}class eU extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,eU),this.name="AbortError"}}class eO extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}class eR{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class ek{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class ev extends eP{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new eM({maxSize:r,onEviction:(e,t)=>{this.evictedBlocks.set(e,t)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){let r=[],i=[],s=[];for(let{offset:t,length:n}of(this.evictedBlocks.clear(),e)){let e=t+n,{fileSize:a}=this;null!==a&&(e=Math.min(e,a));let o=Math.floor(t/this.blockSize)*this.blockSize;for(let t=o;t<e;t+=this.blockSize){let e=Math.floor(t/this.blockSize);this.blockCache.has(e)||this.blockRequests.has(e)||(this.blockIdsToFetch.add(e),i.push(e)),this.blockRequests.has(e)&&r.push(this.blockRequests.get(e)),s.push(e)}}await e_(),this.fetchBlocks(t);let n=[];for(let e of i)this.blockRequests.has(e)&&n.push(this.blockRequests.get(e));await Promise.allSettled(r),await Promise.allSettled(n);let a=[],o=s.filter(e=>this.abortedBlockIds.has(e)||!this.blockCache.has(e));if(o.forEach(e=>this.blockIdsToFetch.add(e)),o.length>0&&t&&!t.aborted){for(let e of(this.fetchBlocks(null),o)){let t=this.blockRequests.get(e);if(!t)throw Error(`Block ${e} is not in the block requests`);a.push(t)}await Promise.allSettled(a)}if(t&&t.aborted)throw new eU("Request was aborted");let l=s.map(e=>this.blockCache.get(e)||this.evictedBlocks.get(e)),h=l.filter(e=>!e);if(h.length)throw new eO(h,"Request failed");let c=new Map(function(e,t){let r=Array.isArray(e)?e:Array.from(e),i=Array.isArray(t)?t:Array.from(t);return r.map((e,t)=>[e,i[t]])}(s,l));return this.readSliceData(e,c)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){let t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i)for(let s of t[i].blockIds)this.blockRequests.set(s,(async()=>{try{let e=(await r)[i],t=s*this.blockSize,n=t-e.offset,a=Math.min(n+this.blockSize,e.data.byteLength),o=e.data.slice(n,a),l=new eR(t,o.byteLength,o,s);this.blockCache.set(s,l),this.abortedBlockIds.delete(s)}catch(t){if("AbortError"===t.name)t.signal=e,this.blockCache.delete(s),this.abortedBlockIds.add(s);else throw t}finally{this.blockRequests.delete(s)}})());this.blockIdsToFetch.clear()}}groupBlocks(e){let t=Array.from(e).sort((e,t)=>e-t);if(0===t.length)return[];let r=[],i=null,s=[];for(let e of t)null===i||i+1===e?r.push(e):(s.push(new ek(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[e]),i=e;return s.push(new ek(r[0]*this.blockSize,r.length*this.blockSize,r)),s}readSliceData(e,t){return e.map(e=>{let r=e.offset+e.length;null!==this.fileSize&&(r=Math.min(this.fileSize,r));let i=Math.floor(e.offset/this.blockSize),s=Math.floor(r/this.blockSize),n=new ArrayBuffer(e.length),a=new Uint8Array(n);for(let n=i;n<=s;++n){let i;let s=t.get(n),o=s.offset-e.offset,l=s.top-r,h=0,c=0;o<0?h=-o:o>0&&(c=o),i=l<0?s.length-h:r-s.offset-h;let f=new Uint8Array(s.data,h,i);a.set(f,c)}return n})}}class eG{get ok(){return this.status>=200&&this.status<=299}get status(){throw Error("not implemented")}getHeader(e){throw Error("not implemented")}async getData(){throw Error("not implemented")}}class eF{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw Error("request is not implemented")}}class eL extends eG{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class eB extends eF{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){return new eL(await fetch(this.url,{headers:e,credentials:this.credentials,signal:t}))}}class eN extends eG{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class ez extends eF{constructRequest(e,t){return new Promise((r,i)=>{let s=new XMLHttpRequest;for(let[t,r]of(s.open("GET",this.url),s.responseType="arraybuffer",Object.entries(e)))s.setRequestHeader(t,r);s.onload=()=>{let e=s.response;r(new eN(s,e))},s.onerror=i,s.onabort=()=>i(new eU("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}var eV=r(73752),ej=r(13640),eK=r(93813),eq=r(10536).lW;class eH extends eG{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class eW extends eF{constructor(e){super(e),this.parsedUrl=eK.parse(this.url),this.httpApi="http:"===this.parsedUrl.protocol?eV:ej}constructRequest(e,t){return new Promise((r,i)=>{let s=this.httpApi.get({...this.parsedUrl,headers:e},e=>{let t=new Promise(t=>{let r=[];e.on("data",e=>{r.push(e)}),e.on("end",()=>{t(eq.concat(r).buffer)}),e.on("error",i)});r(new eH(e,t))});s.on("error",i),t&&(t.aborted&&s.destroy(new eU("Request aborted")),t.addEventListener("abort",()=>s.destroy(new eU("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class e$ extends eP{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length,Promise.all(e.map(e=>this.fetchSlice(e,t))))}async fetchSlices(e,t){let r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:e,length:t})=>`${e}-${e+t}`).join(",")}`},signal:t});if(r.ok){if(206===r.status){let{type:i,params:s}=function(e){let[t,...r]=e.split(";").map(e=>e.trim());return{type:t,params:eD(r.map(e=>e.split("=")))}}(r.getHeader("content-type"));if("multipart/byteranges"===i){let e=function(e,t){let r=null,i=new TextDecoder("ascii"),s=[],n=`--${t}`,a=`${n}--`;for(let t=0;t<10;++t)i.decode(new Uint8Array(e,t,n.length))===n&&(r=t);if(null===r)throw Error("Could not find initial boundary");for(;r<e.byteLength;){let t=i.decode(new Uint8Array(e,r,Math.min(n.length+1024,e.byteLength-r)));if(0===t.length||t.startsWith(a))break;if(!t.startsWith(n))throw Error("Part does not start with boundary");let o=t.substr(n.length+2);if(0===o.length)break;let l=o.indexOf(eE),h=eD(o.substr(0,l).split("\r\n").map(e=>{let t=e.split(":").map(e=>e.trim());return t[0]=t[0].toLowerCase(),t})),{start:c,end:f,total:u}=eC(h["content-range"]),g=r+n.length+l+eE.length,d=parseInt(f,10)+1-parseInt(c,10);s.push({headers:h,data:e.slice(g,g+d),offset:c,length:d,fileSize:u}),r=g+d+4}return s}(await r.getData(),s.boundary);return this._fileSize=e[0].fileSize||null,e}let n=await r.getData(),{start:a,end:o,total:l}=eC(r.getHeader("content-range"));this._fileSize=l||null;let h=[{data:n,offset:a,length:o-a}];if(e.length>1){let r=await Promise.all(e.slice(1).map(e=>this.fetchSlice(e,t)));return h.concat(r)}return h}{if(!this.allowFullFile)throw Error("Server responded with full file");let e=await r.getData();return this._fileSize=e.byteLength,[{data:e,offset:0,length:e.byteLength}]}}throw Error("Error fetching data.")}async fetchSlice(e,t){let{offset:r,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(s.ok){if(206===s.status){let e=await s.getData(),{total:t}=eC(s.getHeader("content-range"));return this._fileSize=t||null,{data:e,offset:r,length:i}}{if(!this.allowFullFile)throw Error("Server responded with full file");let e=await s.getData();return this._fileSize=e.byteLength,{data:e,offset:0,length:e.byteLength}}}throw Error("Error fetching data.")}get fileSize(){return this._fileSize}}function eY(e,{blockSize:t,cacheSize:r}){return null===t?e:new ev(e,{blockSize:t,cacheSize:r})}function eX(e){switch(e){case ey.sf.BYTE:case ey.sf.ASCII:case ey.sf.SBYTE:case ey.sf.UNDEFINED:return 1;case ey.sf.SHORT:case ey.sf.SSHORT:return 2;case ey.sf.LONG:case ey.sf.SLONG:case ey.sf.FLOAT:case ey.sf.IFD:return 4;case ey.sf.RATIONAL:case ey.sf.SRATIONAL:case ey.sf.DOUBLE:case ey.sf.LONG8:case ey.sf.SLONG8:case ey.sf.IFD8:return 8;default:throw RangeError(`Invalid field type: ${e}`)}}function eZ(e,t,r,i){let s=null,n=null,a=eX(t);switch(t){case ey.sf.BYTE:case ey.sf.ASCII:case ey.sf.UNDEFINED:s=new Uint8Array(r),n=e.readUint8;break;case ey.sf.SBYTE:s=new Int8Array(r),n=e.readInt8;break;case ey.sf.SHORT:s=new Uint16Array(r),n=e.readUint16;break;case ey.sf.SSHORT:s=new Int16Array(r),n=e.readInt16;break;case ey.sf.LONG:case ey.sf.IFD:s=new Uint32Array(r),n=e.readUint32;break;case ey.sf.SLONG:s=new Int32Array(r),n=e.readInt32;break;case ey.sf.LONG8:case ey.sf.IFD8:s=Array(r),n=e.readUint64;break;case ey.sf.SLONG8:s=Array(r),n=e.readInt64;break;case ey.sf.RATIONAL:s=new Uint32Array(2*r),n=e.readUint32;break;case ey.sf.SRATIONAL:s=new Int32Array(2*r),n=e.readInt32;break;case ey.sf.FLOAT:s=new Float32Array(r),n=e.readFloat32;break;case ey.sf.DOUBLE:s=new Float64Array(r),n=e.readFloat64;break;default:throw RangeError(`Invalid field type: ${t}`)}if(t===ey.sf.RATIONAL||t===ey.sf.SRATIONAL)for(let t=0;t<r;t+=2)s[t]=n.call(e,i+t*a),s[t+1]=n.call(e,i+(t*a+4));else for(let t=0;t<r;++t)s[t]=n.call(e,i+t*a);return t===ey.sf.ASCII?new TextDecoder("utf-8").decode(s):s}class eJ{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class eQ extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class e0{async readRasters(e={}){let{window:t,width:r,height:i}=e,{resX:s,resY:n,bbox:a}=e,o=await this.getImage(),l=o,h=await this.getImageCount(),c=o.getBoundingBox();if(t&&a)throw Error('Both "bbox" and "window" passed.');if(r||i){if(t){let[e,r]=o.getOrigin(),[i,s]=o.getResolution();a=[e+t[0]*i,r+t[1]*s,e+t[2]*i,r+t[3]*s]}let e=a||c;if(r){if(s)throw Error("Both width and resX passed");s=(e[2]-e[0])/r}if(i){if(n)throw Error("Both width and resY passed");n=(e[3]-e[1])/i}}if(s||n){let e=[];for(let t=0;t<h;++t){let r=await this.getImage(t),{SubfileType:i,NewSubfileType:s}=r.fileDirectory;(0===t||2===i||1&s)&&e.push(r)}e.sort((e,t)=>e.getWidth()-t.getWidth());for(let t=0;t<e.length;++t){let r=e[t],i=(c[2]-c[0])/r.getWidth(),a=(c[3]-c[1])/r.getHeight();if(l=r,s&&s>i||n&&n>a)break}}let f=t;if(a){let[e,t]=o.getOrigin(),[r,i]=l.getResolution(o);f=[Math.min((f=[Math.round((a[0]-e)/r),Math.round((a[1]-t)/i),Math.round((a[2]-e)/r),Math.round((a[3]-t)/i)])[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return l.readRasters({...e,window:f})}}class e1 extends e0{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){let r=this.bigTiff?4048:1024;return new eT((await this.source.fetch([{offset:e,length:void 0!==t?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){let t=this.bigTiff?20:12,r=this.bigTiff?8:2,i=await this.getSlice(e),s=this.bigTiff?i.readUint64(e):i.readUint16(e),n=s*t+(this.bigTiff?16:6);i.covers(e,n)||(i=await this.getSlice(e,n));let a={},o=e+(this.bigTiff?8:2);for(let e=0;e<s;o+=t,++e){let e,t;let r=i.readUint16(o),s=i.readUint16(o+2),n=this.bigTiff?i.readUint64(o+4):i.readUint32(o+4),l=eX(s),h=o+(this.bigTiff?12:8);if(l*n<=(this.bigTiff?8:4))e=eZ(i,s,n,h);else{let t=i.readOffset(h),r=eX(s)*n;e=i.covers(t,r)?eZ(i,s,n,t):eZ(await this.getSlice(t,r),s,n,t)}t=1!==n||-1!==ey.It.indexOf(r)||s===ey.sf.RATIONAL||s===ey.sf.SRATIONAL?e:e[0],a[ey.L[r]]=t}let l=function(e){let t=e.GeoKeyDirectory;if(!t)return null;let r={};for(let i=4;i<=4*t[3];i+=4){let s=ey.P1[t[i]],n=t[i+1]?ey.L[t[i+1]]:null,a=t[i+2],o=t[i+3],l=null;if(n){if(null==(l=e[n]))throw Error(`Could not get value of geoKey '${s}'.`);"string"==typeof l?l=l.substring(o,o+a-1):l.subarray&&(l=l.subarray(o,o+a),1===a&&(l=l[0]))}else l=o;r[s]=l}return r}(a);return new eJ(a,l,i.readOffset(e+r+t*s))}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof eQ)throw new eQ(e);throw t}return this.ifdRequests[e]=(async()=>{let t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new eQ(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){let t=await this.requestIFD(e);return new ex(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(e){if(e instanceof eQ)t=!1;else throw e}return e}async getGhostValues(){let e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;let t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100,i=await this.getSlice(e,r);if(t===eZ(i,ey.sf.ASCII,t.length,e)){let t=eZ(i,ey.sf.ASCII,r,e).split("\n")[0],s=Number(t.split("=")[1].split(" ")[0])+t.length;s>r&&(i=await this.getSlice(e,s));let n=eZ(i,ey.sf.ASCII,s,e);this.ghostValues={},n.split("\n").filter(e=>e.length>0).map(e=>e.split("=")).forEach(([e,t])=>{this.ghostValues[e]=t})}return this.ghostValues}static async fromSource(e,t,r){let i,s;let n=new eA((await e.fetch([{offset:0,length:1024}],r))[0]),a=n.getUint16(0,0);if(18761===a)i=!0;else if(19789===a)i=!1;else throw TypeError("Invalid byte order value.");let o=n.getUint16(2,i);if(42===o)s=!1;else if(43===o){if(s=!0,8!==n.getUint16(4,i))throw Error("Unsupported offset byte-size.")}else throw TypeError("Invalid magic number.");let l=s?n.getUint64(8,i):n.getUint32(4,i);return new e1(e,i,s,l,t)}close(){return"function"==typeof this.source.close&&this.source.close()}}async function e2(e,t={},r){return e1.fromSource(function(e,{forceXHR:t=!1,...r}={}){return"function"!=typeof fetch||t?"undefined"!=typeof XMLHttpRequest?function(e,{headers:t={},maxRanges:r=0,allowFullFile:i=!1,...s}={}){return eY(new e$(new ez(e),t,r,i),s)}(e,r):function(e,{headers:t={},maxRanges:r=0,allowFullFile:i=!1,...s}={}){return eY(new e$(new eW(e),t,r,i),s)}(e,r):function(e,{headers:t={},credentials:r,maxRanges:i=0,allowFullFile:s=!1,...n}={}){return eY(new e$(new eB(e,r),t,i,s),n)}(e,r)}(e,t),r)}},72093:function(e,t,r){"use strict";r.d(t,{Ie:function(){return l},It:function(){return n},L:function(){return i},L5:function(){return c},P1:function(){return u},Qb:function(){return f},pd:function(){return h},sf:function(){return o}});let i={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},s={};for(let e in i)i.hasOwnProperty(e)&&(s[i[e]]=parseInt(e,10));let n=[s.BitsPerSample,s.ExtraSamples,s.SampleFormat,s.StripByteCounts,s.StripOffsets,s.StripRowCounts,s.TileByteCounts,s.TileOffsets,s.SubIFDs],a={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},o={};for(let e in a)a.hasOwnProperty(e)&&(o[a[e]]=parseInt(e,10));let l={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},h={Unspecified:0,Assocalpha:1,Unassalpha:2},c={Version:0,AddCompression:1},f={None:0,Deflate:1,Zstandard:2},u={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},g={};for(let e in u)u.hasOwnProperty(e)&&(g[u[e]]=parseInt(e,10))}}]);