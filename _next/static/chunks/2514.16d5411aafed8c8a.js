"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2514,127],{85774:function(e,t,n){n.d(t,{H:function(){return l},I:function(){return f}});var r=n(93954),s=n(52721),i=n(82877),a=n(97937),o=n(83260);n(50127);let d={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class f{constructor(e,t=d){this._fullscreenViewport=new s.l(0,0,1,1);let n=t.positions??d.positions,i=t.indices??d.indices;this.engine=e,this._vertexBuffers={[r.o.PositionKind]:new r.o(e,n,r.o.PositionKind,!1,!1,2)},this._indexBuffer=e.createIndexBuffer(i),this._onContextRestoredObserver=e.onContextRestoredObservable.add(()=>{for(let t in this._indexBuffer=e.createIndexBuffer(i),this._vertexBuffers)this._vertexBuffers[t]._rebuild()})}setViewport(e=this._fullscreenViewport){this.engine.setViewport(e)}bindBuffers(e){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)}applyEffectWrapper(e){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(e){return void 0!==e.renderTarget}render(e,t=null){if(!e.effect.isReady())return;this.saveStates(),this.setViewport();let n=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;n&&this.engine.bindFramebuffer(n),this.applyEffectWrapper(e),this.draw(),n&&this.engine.unBindFramebuffer(n),this.restoreStates()}dispose(){let e=this._vertexBuffers[r.o.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[r.o.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class l{get effect(){return this._drawWrapper.effect}set effect(e){this._drawWrapper.effect=e}constructor(e){let t;this.onApplyObservable=new i.y$;let n=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(n.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add(()=>{this.effect.setFloat2("scale",1,1)}));let r=e.defines?e.defines.join("\n"):"";this._drawWrapper=new o.q(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],n,e.samplerNames,r,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync)):(this.effect=new a.Q(t,e.attributeNames||["position"],n,e.samplerNames,e.engine,r,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage,e.extraInitializationsAsync),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add(()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))}dispose(e=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}}},32514:function(e,t,n){let r;n.r(t),n.d(t,{Dispose:function(){return u},DumpData:function(){return c},DumpDataAsync:function(){return p},DumpFramebuffer:function(){return l},DumpTools:function(){return h}});var s=n(85774),i=n(4224),a=n(65330),o=n(51092);let d=null;async function f(){return d||(d=new Promise((e,t)=>{let i;let a=null,d={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(n.bind(n,46263)).then(({ThinEngine:f})=>{try{i=new OffscreenCanvas(100,100),a=new f(i,!1,d)}catch(e){a=new f(i=document.createElement("canvas"),!1,d)}o.l.Instances.pop(),o.l.OnEnginesDisposedObservable.add(e=>{a&&e!==a&&!a.isDisposed&&0===o.l.Instances.length&&u()}),a.getCaps().parallelShaderCompile=void 0;let l=new s.I(a);n.e(7534).then(n.bind(n,97534)).then(({passPixelShader:n})=>{if(!a){t("Engine is not defined");return}let o=new s.H({engine:a,name:n.name,fragmentShader:n.shader,samplerNames:["textureSampler"]});e(r={canvas:i,engine:a,renderer:l,wrapper:o})})}).catch(t)})),await d}async function l(e,t,n,r,s="image/png",i,a){let o=new Uint8Array((await n.readPixels(0,0,e,t)).buffer);c(e,t,o,r,s,i,!0,void 0,a)}function p(e,t,n,r="image/png",s,i=!1,a=!1,o){return new Promise(d=>{c(e,t,n,e=>d(e),r,s,i,a,o)})}function c(e,t,n,r,s="image/png",o,d=!1,l=!1,p){f().then(f=>{if(f.engine.setSize(e,t,!0),n instanceof Float32Array){let e=new Uint8Array(n.length),t=n.length;for(;t--;){let r=n[t];e[t]=Math.round(255*(0,a.Clamp)(r))}n=e}let c=f.engine.createRawTexture(n,e,t,5,!1,!d,1);f.renderer.setViewport(),f.renderer.applyEffectWrapper(f.wrapper),f.wrapper.effect._bindTexture("textureSampler",c),f.renderer.draw(),l?i.w1.ToBlob(f.canvas,e=>{let t=new FileReader;t.onload=e=>{let t=e.target.result;r&&r(t)},t.readAsArrayBuffer(e)},s,p):i.w1.EncodeScreenshotCanvasData(f.canvas,r,s,o,p),c.dispose()})}function u(){r?(r.wrapper.dispose(),r.renderer.dispose(),r.engine.dispose()):d?.then(e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()}),r=null}let h={DumpData:c,DumpDataAsync:p,DumpFramebuffer:l,Dispose:u};i.w1.DumpData=c,i.w1.DumpDataAsync=p,i.w1.DumpFramebuffer=l},50127:function(e,t,n){n.r(t),n.d(t,{postprocessVertexShader:function(){return a}});var r=n(29427);let s="postprocessVertexShader",i=`attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);
#define CUSTOM_VERTEX_MAIN_END
}`;r.v.ShadersStore[s]=i;let a={name:s,shader:i}}}]);