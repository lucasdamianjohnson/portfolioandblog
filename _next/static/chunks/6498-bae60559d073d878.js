"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6498],{80527:function(e,t,i){i.d(t,{w:function(){return T}});var s=i(46456),r=i(22287),n=i(4224),a=i(82877),o=i(57449),l=i(51092),h=i(93954),u=i(81209),d=i(6507),c=i(5848),f=i(10633),p=i(34634),_=i(83260),g=i(49449),x=i(38104),m=i(61146);class T{get camera(){return this._effectLayerOptions.camera}get renderingGroupId(){return this._effectLayerOptions.renderingGroupId}set renderingGroupId(e){this._effectLayerOptions.renderingGroupId=e}get mainTexture(){return this._mainTexture}get shaderLanguage(){return this._shaderLanguage}setMaterialForRendering(e,t){if(this._mainTexture.setMaterialForRendering(e,t),Array.isArray(e))for(let i=0;i<e.length;++i){let s=e[i];t?this._materialForRendering[s.uniqueId]=[s,t]:delete this._materialForRendering[s.uniqueId]}else t?this._materialForRendering[e.uniqueId]=[e,t]:delete this._materialForRendering[e.uniqueId]}getEffectIntensity(e){return this._effectIntensity[e.uniqueId]??1}setEffectIntensity(e,t){this._effectIntensity[e.uniqueId]=t}constructor(e,t,i=!1){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new o.HE},this._effectIntensity={},this.neutralColor=new o.HE,this.isEnabled=!0,this.disableBoundingBoxesFromEffectLayer=!1,this.onDisposeObservable=new a.y$,this.onBeforeRenderMainTextureObservable=new a.y$,this.onBeforeComposeObservable=new a.y$,this.onBeforeRenderMeshToEffect=new a.y$,this.onAfterRenderMeshToEffect=new a.y$,this.onAfterComposeObservable=new a.y$,this.onSizeChangedObservable=new a.y$,this._shaderLanguage=0,this._materialForRendering={},this._shadersLoaded=!1,this.name=e,this._scene=t||l.l.LastCreatedScene,T._SceneComponentInitialization(this._scene),!this._scene.getEngine().isWebGPU||i||T.ForceGLSL||(this._shaderLanguage=1),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._mergeDrawWrapper=[],this._generateIndexBuffer(),this._generateVertexBuffer()}_numInternalDraws(){return 1}_init(e){this._effectLayerOptions={mainTextureRatio:.5,alphaBlendingMode:2,camera:null,renderingGroupId:-1,mainTextureType:0,generateStencilBuffer:!1,...e},this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses()}_generateIndexBuffer(){let e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)}_generateVertexBuffer(){let e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1);let t=new h.o(this._engine,e,h.o.PositionKind,!1,!1,2);this._vertexBuffers[h.o.PositionKind]=t}_setMainTextureSize(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?(0,m.p7)(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?(0,m.p7)(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)}_createMainTexture(){for(let e in this._mainTexture=new d._("EffectLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,this._effectLayerOptions.mainTextureType,!1,u.x.TRILINEAR_SAMPLINGMODE,!0,this._effectLayerOptions.generateStencilBuffer),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=u.x.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=u.x.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(u.x.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._materialForRendering){let[t,i]=this._materialForRendering[e];this._mainTexture.setMaterialForRendering(t,i)}if(this._mainTexture.customIsReadyFunction=(e,t,i)=>{if((i||0===t)&&e.subMeshes)for(let t=0;t<e.subMeshes.length;++t){let i=e.subMeshes[t],s=i.getMaterial(),r=i.getRenderingMesh();if(!s)continue;let n=r._getInstancesRenderList(i._id,!!i.getReplacementMesh()).hardwareInstancedRendering[i._id]||r.hasThinInstances;if(this._setEmissiveTextureAndColor(r,i,s),!this._isReady(i,n,this._emissiveTextureAndColor.texture))return!1}return!0},this._mainTexture.customRenderFunction=(e,t,i,s)=>{let r;this.onBeforeRenderMainTextureObservable.notifyObservers(this);let n=this._scene.getEngine();if(s.length){for(n.setColorWrite(!1),r=0;r<s.length;r++)this._renderSubMesh(s.data[r]);n.setColorWrite(!0)}for(r=0;r<e.length;r++)this._renderSubMesh(e.data[r]);for(r=0;r<t.length;r++)this._renderSubMesh(t.data[r]);let a=n.getAlphaMode();for(r=0;r<i.length;r++){let e=i.data[r],t=e.getMaterial();if(t&&t.needDepthPrePass){let i=t.getScene().getEngine();i.setColorWrite(!1),this._renderSubMesh(e),i.setColorWrite(!0)}this._renderSubMesh(e,!0)}n.setAlphaMode(a)},this._mainTexture.onClearObservable.add(e=>{e.clear(this.neutralColor,!0,!0,!0)}),this._scene.getBoundingBoxRenderer){let e=this._scene.getBoundingBoxRenderer().enabled;this._mainTexture.onBeforeBindObservable.add(()=>{this._scene.getBoundingBoxRenderer().enabled=!this.disableBoundingBoxesFromEffectLayer&&e}),this._mainTexture.onAfterUnbindObservable.add(()=>{this._scene.getBoundingBoxRenderer().enabled=e})}}_addCustomEffectDefines(e){}_isReady(e,t,i){let s=this._scene.getEngine(),r=e.getMesh(),n=r._internalAbstractMeshDataInfo._materialForRenderPass?.[s.currentRenderPassId];if(n)return n.isReadyForSubMesh(r,e,t);let a=e.getMaterial();if(!a)return!1;if(this._useMeshMaterial(e.getRenderingMesh()))return a.isReadyForSubMesh(e.getMesh(),e,t);let o=[],l=[h.o.PositionKind],u=!1,d=!1;if(a){let e=a.needAlphaTesting(),t=a.getAlphaTestTexture(),i=t&&t.hasAlpha&&(a.useAlphaFromDiffuseTexture||a._useAlphaFromAlbedoTexture);t&&(e||i)&&(o.push("#define DIFFUSE"),r.isVerticesDataPresent(h.o.UV2Kind)&&1===t.coordinatesIndex?(o.push("#define DIFFUSEUV2"),d=!0):r.isVerticesDataPresent(h.o.UVKind)&&(o.push("#define DIFFUSEUV1"),u=!0),e&&(o.push("#define ALPHATEST"),o.push("#define ALPHATESTVALUE 0.4")),t.gammaSpace||o.push("#define DIFFUSE_ISLINEAR"));let s=a.opacityTexture;s&&(o.push("#define OPACITY"),r.isVerticesDataPresent(h.o.UV2Kind)&&1===s.coordinatesIndex?(o.push("#define OPACITYUV2"),d=!0):r.isVerticesDataPresent(h.o.UVKind)&&(o.push("#define OPACITYUV1"),u=!0))}i&&(o.push("#define EMISSIVE"),r.isVerticesDataPresent(h.o.UV2Kind)&&1===i.coordinatesIndex?(o.push("#define EMISSIVEUV2"),d=!0):r.isVerticesDataPresent(h.o.UVKind)&&(o.push("#define EMISSIVEUV1"),u=!0),i.gammaSpace||o.push("#define EMISSIVE_ISLINEAR")),r.useVertexColors&&r.isVerticesDataPresent(h.o.ColorKind)&&r.hasVertexAlpha&&a.transparencyMode!==c.F.MATERIAL_OPAQUE&&(l.push(h.o.ColorKind),o.push("#define VERTEXALPHA")),u&&(l.push(h.o.UVKind),o.push("#define UV1")),d&&(l.push(h.o.UV2Kind),o.push("#define UV2"));let f=new p.L;if(r.useBones&&r.computeBonesUsingShaders){l.push(h.o.MatricesIndicesKind),l.push(h.o.MatricesWeightsKind),r.numBoneInfluencers>4&&(l.push(h.o.MatricesIndicesExtraKind),l.push(h.o.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers);let e=r.skeleton;e&&e.isUsingTextureForMatrices?o.push("#define BONETEXTURE"):o.push("#define BonesPerMesh "+(e?e.bones.length+1:0)),r.numBoneInfluencers>0&&f.addCPUSkinningFallback(0,r)}else o.push("#define NUM_BONE_INFLUENCERS 0");let _=r.morphTargetManager,m=0;_&&(m=_.numMaxInfluencers||_.numInfluencers)>0&&(o.push("#define MORPHTARGETS"),o.push("#define NUM_MORPH_INFLUENCERS "+m),_.isUsingTextureForTargets&&o.push("#define MORPHTARGETS_TEXTURE"),(0,x.Vk)(l,r,m)),t&&(o.push("#define INSTANCES"),(0,x.y9)(l),e.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES")),(0,g.lK)(a,this._scene,o),this._addCustomEffectDefines(o);let T=e._getDrawWrapper(void 0,!0),E=T.defines,b=o.join("\n");if(E!==b){let e=["world","mBones","viewProjection","glowColor","morphTargetInfluences","morphTargetCount","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity","morphTargetTextureInfo","morphTargetTextureIndices","glowIntensity"];(0,g.qx)(e),T.setEffect(this._engine.createEffect("glowMapGeneration",l,e,["diffuseSampler","emissiveSampler","opacitySampler","boneSampler","morphTargets"],b,f,void 0,void 0,{maxSimultaneousMorphTargets:m},this._shaderLanguage,this._shadersLoaded?void 0:async()=>{await this._importShadersAsync(),this._shadersLoaded=!0}),b)}return T.effect.isReady()}async _importShadersAsync(){1===this._shaderLanguage?await Promise.all([i.e(3758).then(i.bind(i,33758)),i.e(7933).then(i.bind(i,37933))]):await Promise.all([i.e(6884).then(i.bind(i,96884)),i.e(215).then(i.bind(i,20215))])}render(){for(let e=0;e<this._postProcesses.length;e++)if(!this._postProcesses[e].isReady())return;let e=this._scene.getEngine(),t=this._numInternalDraws(),i=!0;for(let e=0;e<t;++e){let t=this._mergeDrawWrapper[e];t||(t=this._mergeDrawWrapper[e]=new _.q(this._engine)).setEffect(this._createMergeEffect()),i=i&&t.effect.isReady()}if(!i)return;this.onBeforeComposeObservable.notifyObservers(this);let s=e.getAlphaMode();for(let i=0;i<t;++i){let t=this._mergeDrawWrapper[i];e.enableEffect(t),e.setState(!1),e.bindBuffers(this._vertexBuffers,this._indexBuffer,t.effect),e.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(t.effect,i)}e.setAlphaMode(s),this.onAfterComposeObservable.notifyObservers(this);let r=this._mainTexture.getSize();this._setMainTextureSize(),(r.width!==this._mainTextureDesiredSize.width||r.height!==this._mainTextureDesiredSize.height)&&0!==this._mainTextureDesiredSize.width&&0!==this._mainTextureDesiredSize.height&&(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}hasMesh(e){return -1===this.renderingGroupId||e.renderingGroupId===this.renderingGroupId}shouldRender(){return this.isEnabled&&this._shouldRender}_shouldRenderMesh(e){return!0}_canRenderMesh(e,t){return!t.needAlphaBlendingForMesh(e)}_shouldRenderEmissiveTextureForMesh(){return!0}_renderSubMesh(e,t=!1){if(!this.shouldRender())return;let i=e.getMaterial(),s=e.getMesh(),r=e.getReplacementMesh(),n=e.getRenderingMesh(),a=e.getEffectiveMesh(),o=this._scene,l=o.getEngine();if(a._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!i||!this._canRenderMesh(n,i))return;let h=i._getEffectiveOrientation(n);0>a._getWorldMatrixDeterminant()&&(h=h===c.F.ClockWiseSideOrientation?c.F.CounterClockWiseSideOrientation:c.F.ClockWiseSideOrientation);let u=h===c.F.ClockWiseSideOrientation;l.setState(i.backFaceCulling,i.zOffset,void 0,u,i.cullBackFaces,void 0,i.zOffsetUnits);let d=n._getInstancesRenderList(e._id,!!r);if(d.mustReturn||!this._shouldRenderMesh(n))return;let f=d.hardwareInstancedRendering[e._id]||n.hasThinInstances;if(this._setEmissiveTextureAndColor(n,e,i),this.onBeforeRenderMeshToEffect.notifyObservers(s),this._useMeshMaterial(n))n.render(e,t,r||void 0);else if(this._isReady(e,f,this._emissiveTextureAndColor.texture)){let s=a._internalAbstractMeshDataInfo._materialForRenderPass?.[l.currentRenderPassId],r=e._getDrawWrapper();if(!r&&s&&(r=s._getDrawWrapper()),!r)return;let h=r.effect;if(l.enableEffect(r),f||n._bind(e,h,i.fillMode),s?s.bindForSubMesh(a.getWorldMatrix(),a,e):(h.setMatrix("viewProjection",o.getTransformMatrix()),h.setMatrix("world",a.getWorldMatrix()),h.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a)),!s){let e=i.needAlphaTesting(),s=i.getAlphaTestTexture(),r=s&&s.hasAlpha&&(i.useAlphaFromDiffuseTexture||i._useAlphaFromAlbedoTexture);if(s&&(e||r)){h.setTexture("diffuseSampler",s);let e=s.getTextureMatrix();e&&h.setMatrix("diffuseMatrix",e)}let a=i.opacityTexture;if(a){h.setTexture("opacitySampler",a),h.setFloat("opacityIntensity",a.level);let e=a.getTextureMatrix();e&&h.setMatrix("opacityMatrix",e)}if(this._emissiveTextureAndColor.texture&&(h.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),h.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),n.useBones&&n.computeBonesUsingShaders&&n.skeleton){let e=n.skeleton;if(e.isUsingTextureForMatrices){let t=e.getTransformMatrixTexture(n);if(!t)return;h.setTexture("boneSampler",t),h.setFloat("boneTextureWidth",4*(e.bones.length+1))}else h.setMatrices("mBones",e.getTransformMatrices(n))}(0,x.KG)(n,h),n.morphTargetManager&&n.morphTargetManager.isUsingTextureForTargets&&n.morphTargetManager._bind(h),t&&l.setAlphaMode(i.alphaMode),h.setFloat("glowIntensity",this.getEffectIntensity(n)),(0,g.an)(h,i,o)}n._processRendering(a,e,h,i.fillMode,d,f,(e,t)=>h.setMatrix("world",t))}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(s)}_useMeshMaterial(e){return!1}_rebuild(){let e=this._vertexBuffers[h.o.PositionKind];e&&e._rebuild(),this._generateIndexBuffer()}_disposeTextureAndPostProcesses(){this._mainTexture.dispose();for(let e=0;e<this._postProcesses.length;e++)this._postProcesses[e]&&this._postProcesses[e].dispose();this._postProcesses=[];for(let e=0;e<this._textures.length;e++)this._textures[e]&&this._textures[e].dispose();this._textures=[]}dispose(){let e=this._vertexBuffers[h.o.PositionKind];for(let t of(e&&(e.dispose(),this._vertexBuffers[h.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._mergeDrawWrapper))t.dispose();this._mergeDrawWrapper=[],this._disposeTextureAndPostProcesses();let t=this._scene.effectLayers.indexOf(this,0);t>-1&&this._scene.effectLayers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()}getClassName(){return"EffectLayer"}static Parse(e,t,i){return n.w1.Instantiate(e.customType).Parse(e,t,i)}}T.ForceGLSL=!1,T._SceneComponentInitialization=e=>{throw(0,f.S)("EffectLayerSceneComponent")},(0,s.gn)([(0,r.qC)()],T.prototype,"name",void 0),(0,s.gn)([(0,r.XX)()],T.prototype,"neutralColor",void 0),(0,s.gn)([(0,r.qC)()],T.prototype,"isEnabled",void 0),(0,s.gn)([(0,r.VE)()],T.prototype,"camera",null),(0,s.gn)([(0,r.qC)()],T.prototype,"renderingGroupId",null),(0,s.gn)([(0,r.qC)()],T.prototype,"disableBoundingBoxesFromEffectLayer",void 0)},4326:function(e,t,i){var s=i(35910),r=i(44755),n=i(32253),a=i(80527),o=i(51092);(0,i(10430).PS)(n.l.NAME_EFFECTLAYER,(e,t,i,s)=>{if(e.effectLayers){i.effectLayers||(i.effectLayers=[]);for(let r=0;r<e.effectLayers.length;r++){let n=a.w.Parse(e.effectLayers[r],t,s);i.effectLayers.push(n)}}}),r.x.prototype.removeEffectLayer=function(e){let t=this.effectLayers.indexOf(e);return -1!==t&&this.effectLayers.splice(t,1),t},r.x.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};class l{constructor(e){if(this.name=n.l.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e||o.l.LastCreatedScene,!this.scene)return;this._engine=this.scene.getEngine()}register(){this.scene._isReadyForMeshStage.registerStep(n.l.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(n.l.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(n.l.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(n.l.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(n.l.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(n.l.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)}rebuild(){for(let e of this.scene.effectLayers)e._rebuild()}serialize(e){for(let t of(e.effectLayers=[],this.scene.effectLayers))t.serialize&&e.effectLayers.push(t.serialize())}addFromContainer(e){e.effectLayers&&e.effectLayers.forEach(e=>{this.scene.addEffectLayer(e)})}removeFromContainer(e,t){e.effectLayers&&e.effectLayers.forEach(e=>{this.scene.removeEffectLayer(e),t&&e.dispose()})}dispose(){let e=this.scene.effectLayers;for(;e.length;)e[0].dispose()}_isReadyForMesh(e,t){let i=this._engine.currentRenderPassId;for(let s of this.scene.effectLayers){if(!s.hasMesh(e))continue;let r=s._mainTexture;for(let n of(this._engine.currentRenderPassId=r.renderPassId,e.subMeshes))if(!s.isReady(n,t))return this._engine.currentRenderPassId=i,!1}return this._engine.currentRenderPassId=i,!0}_renderMainTexture(e){this._renderEffects=!1,this._needStencil=!1;let t=!1,i=this.scene.effectLayers;if(i&&i.length>0){for(let r of(this._previousStencilState=this._engine.getStencilBuffer(),i))if(r.shouldRender()&&(!r.camera||r.camera.cameraRigMode===s.V.RIG_MODE_NONE&&e===r.camera||r.camera.cameraRigMode!==s.V.RIG_MODE_NONE&&r.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||r.needStencil();let e=r._mainTexture;e._shouldRender()&&(this.scene.incrementRenderId(),e.render(!1,!1),t=!0)}this.scene.incrementRenderId()}return t}_setStencil(){this._needStencil&&this._engine.setStencilBuffer(!0)}_setStencilBack(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)}_draw(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);let t=this.scene.effectLayers;for(let i=0;i<t.length;i++){let s=t[i];s.renderingGroupId===e&&s.shouldRender()&&s.render()}this._engine.setDepthBuffer(!0)}}_drawCamera(){this._renderEffects&&this._draw(-1)}_drawRenderingGroup(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)}}a.w._SceneComponentInitialization=e=>{let t=e._getComponent(n.l.NAME_EFFECTLAYER);t||(t=new l(e),e._addComponent(t))}},48895:function(e,t,i){i.d(t,{c:function(){return x}});var s=i(46456),r=i(22287),n=i(44755),a=i(39884),o=i(93954),l=i(81209),h=i(6507),u=i(5848),d=i(23891),c=i(80527),f=i(7724),p=i(57449);i(4326);var _=i(90212),g=i(61146);n.x.prototype.getGlowLayerByName=function(e){for(let t=0;t<this.effectLayers?.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===x.EffectName)return this.effectLayers[t];return null};class x extends c.w{set blurKernelSize(e){if(e===this._options.blurKernelSize)return;this._options.blurKernelSize=e;let t=this._getEffectiveBlurKernelSize();this._horizontalBlurPostprocess1.kernel=t,this._verticalBlurPostprocess1.kernel=t,this._horizontalBlurPostprocess2.kernel=t,this._verticalBlurPostprocess2.kernel=t}get blurKernelSize(){return this._options.blurKernelSize}set intensity(e){this._intensity=e}get intensity(){return this._intensity}constructor(e,t,i){super(e,t),this._intensity=1,this._includedOnlyMeshes=[],this._excludedMeshes=[],this._meshesUsingTheirOwnMaterials=[],this.neutralColor=new p.HE(0,0,0,1),this._options={mainTextureRatio:x.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1,ldrMerge:!1,alphaBlendingMode:1,mainTextureType:0,generateStencilBuffer:!1,...i},this._init({alphaBlendingMode:this._options.alphaBlendingMode,camera:this._options.camera,mainTextureFixedSize:this._options.mainTextureFixedSize,mainTextureRatio:this._options.mainTextureRatio,renderingGroupId:this._options.renderingGroupId,mainTextureType:this._options.mainTextureType,generateStencilBuffer:this._options.generateStencilBuffer})}async _importShadersAsync(){1===this._shaderLanguage?await Promise.all([i.e(1903).then(i.bind(i,41903)),i.e(5356).then(i.bind(i,75356)),i.e(4879).then(i.bind(i,54879))]):await Promise.all([i.e(7623).then(i.bind(i,27623)),i.e(1442).then(i.bind(i,81442)),i.e(5899).then(i.bind(i,5899))]),await super._importShadersAsync()}getEffectName(){return x.EffectName}_createMergeEffect(){let e="#define EMISSIVE \n";return this._options.ldrMerge&&(e+="#define LDR \n"),this._engine.createEffect("glowMapMerge",[o.o.PositionKind],["offset"],["textureSampler","textureSampler2"],e,void 0,void 0,void 0,void 0,this.shaderLanguage,this._shadersLoaded?void 0:async()=>{await this._importShadersAsync(),this._shadersLoaded=!0})}_createTextureAndPostProcesses(){let e=this._mainTextureDesiredSize.width,t=this._mainTextureDesiredSize.height;e=this._engine.needPOTTextures?(0,g.p7)(e,this._maxSize):e,t=this._engine.needPOTTextures?(0,g.p7)(t,this._maxSize):t;let i=0;i=this._engine.getCaps().textureHalfFloatRender?2:0,this._blurTexture1=new h._("GlowLayerBlurRTT",{width:e,height:t},this._scene,!1,!0,i),this._blurTexture1.wrapU=l.x.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=l.x.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(l.x.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;let s=Math.floor(e/2),r=Math.floor(t/2);this._blurTexture2=new h._("GlowLayerBlurRTT2",{width:s,height:r},this._scene,!1,!0,i),this._blurTexture2.wrapU=l.x.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=l.x.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(l.x.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2];let n=this._getEffectiveBlurKernelSize();this._horizontalBlurPostprocess1=new d.i("GlowLayerHBP1",new a.FM(1,0),n,{width:e,height:t},null,l.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess1.width=e,this._horizontalBlurPostprocess1.height=t,this._horizontalBlurPostprocess1.externalTextureSamplerBinding=!0,this._horizontalBlurPostprocess1.onApplyObservable.add(e=>{e.setTexture("textureSampler",this._mainTexture)}),this._verticalBlurPostprocess1=new d.i("GlowLayerVBP1",new a.FM(0,1),n,{width:e,height:t},null,l.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess2=new d.i("GlowLayerHBP2",new a.FM(1,0),n,{width:s,height:r},null,l.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._horizontalBlurPostprocess2.width=s,this._horizontalBlurPostprocess2.height=r,this._horizontalBlurPostprocess2.externalTextureSamplerBinding=!0,this._horizontalBlurPostprocess2.onApplyObservable.add(e=>{e.setTexture("textureSampler",this._blurTexture1)}),this._verticalBlurPostprocess2=new d.i("GlowLayerVBP2",new a.FM(0,1),n,{width:s,height:r},null,l.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,i),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(()=>{let e=this._blurTexture1.renderTarget;if(e){this._scene.postProcessManager.directRender(this._postProcesses1,e,!0);let t=this._blurTexture2.renderTarget;t&&this._scene.postProcessManager.directRender(this._postProcesses2,t,!0),this._engine.unBindFramebuffer(t??e,!0)}}),this._postProcesses.map(e=>{e.autoClear=!1})}_getEffectiveBlurKernelSize(){return this._options.blurKernelSize/2}isReady(e,t){let i=e.getMaterial(),s=e.getRenderingMesh();if(!i||!s)return!1;let r=i.emissiveTexture;return super._isReady(e,t,r)}needStencil(){return!1}_canRenderMesh(e,t){return!0}_internalRender(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);let t=this._engine,i=t.getStencilBuffer();t.setStencilBuffer(!1),t.drawElementsType(u.F.TriangleFillMode,0,6),t.setStencilBuffer(i)}_setEmissiveTextureAndColor(e,t,i){let s=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,t,i):i?(this._emissiveTextureAndColor.texture=i.emissiveTexture,this._emissiveTextureAndColor.texture&&(s=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,t,i,this._emissiveTextureAndColor.color):i.emissiveColor?(s*=i.emissiveIntensity??1,this._emissiveTextureAndColor.color.set(i.emissiveColor.r*s,i.emissiveColor.g*s,i.emissiveColor.b*s,i.alpha)):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)}_shouldRenderMesh(e){return this.hasMesh(e)}_addCustomEffectDefines(e){e.push("#define GLOW")}addExcludedMesh(e){-1===this._excludedMeshes.indexOf(e.uniqueId)&&this._excludedMeshes.push(e.uniqueId)}removeExcludedMesh(e){let t=this._excludedMeshes.indexOf(e.uniqueId);-1!==t&&this._excludedMeshes.splice(t,1)}addIncludedOnlyMesh(e){-1===this._includedOnlyMeshes.indexOf(e.uniqueId)&&this._includedOnlyMeshes.push(e.uniqueId)}removeIncludedOnlyMesh(e){let t=this._includedOnlyMeshes.indexOf(e.uniqueId);-1!==t&&this._includedOnlyMeshes.splice(t,1)}hasMesh(e){return!!super.hasMesh(e)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(e.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(e.uniqueId))}_useMeshMaterial(e){return 0!=this._meshesUsingTheirOwnMaterials.length&&this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)>-1}referenceMeshToUseItsOwnMaterial(e){e.resetDrawCache(this._mainTexture.renderPassId),this._meshesUsingTheirOwnMaterials.push(e.uniqueId),e.onDisposeObservable.add(()=>{this._disposeMesh(e)})}unReferenceMeshFromUsingItsOwnMaterial(e){let t=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);for(;t>=0;)this._meshesUsingTheirOwnMaterials.splice(t,1),t=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);e.resetDrawCache(this._mainTexture.renderPassId)}_disposeMesh(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)}getClassName(){return"GlowLayer"}serialize(){let e;let t=_.p.Serialize(this);if(t.customType="BABYLON.GlowLayer",t.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++){let i=this._scene.getMeshByUniqueId(this._includedOnlyMeshes[e]);i&&t.includedMeshes.push(i.id)}if(t.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){let i=this._scene.getMeshByUniqueId(this._excludedMeshes[e]);i&&t.excludedMeshes.push(i.id)}return t}static Parse(e,t,i){let s;let r=_.p.Parse(()=>new x(e.name,t,e.options),e,t,i);for(s=0;s<e.excludedMeshes.length;s++){let i=t.getMeshById(e.excludedMeshes[s]);i&&r.addExcludedMesh(i)}for(s=0;s<e.includedMeshes.length;s++){let i=t.getMeshById(e.includedMeshes[s]);i&&r.addIncludedOnlyMesh(i)}return r}}x.EffectName="GlowLayer",x.DefaultBlurKernelSize=32,x.DefaultTextureRatio=.5,(0,s.gn)([(0,r.qC)()],x.prototype,"blurKernelSize",null),(0,s.gn)([(0,r.qC)()],x.prototype,"intensity",null),(0,s.gn)([(0,r.qC)("options")],x.prototype,"_options",void 0),(0,f.H7)("BABYLON.GlowLayer",x)},10430:function(e,t,i){i.d(t,{PS:function(){return n},Ze:function(){return l},jq:function(){return a},t:function(){return o}});let s={},r={};function n(e,t){s[e]=t}function a(e,t){r[e]=t}function o(e){return r[e]?r[e]:null}function l(e,t,i,r){for(let n in s)Object.prototype.hasOwnProperty.call(s,n)&&s[n](e,t,i,r)}},33776:function(e,t,i){i.d(t,{p:function(){return d}});var s=i(46456),r=i(5848),n=i(22287),a=i(50953),o=i(16188),l=i(65940),h=i(38104);class u extends o.H{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class d extends l.n{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,t=!0){super(e,"DetailMap",140,new u,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=r.F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,t,i){return!this._isEnabled||!e._areTexturesDirty||!t.texturesEnabled||!i.getCaps().standardDerivatives||!this._texture||!a.k.DetailTextureEnabled||!!this._texture.isReady()}prepareDefines(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;let i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&a.k.DetailTextureEnabled&&this._isEnabled?((0,h.lw)(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}bindForSubMesh(e,t){if(!this._isEnabled)return;let i=this._material.isFrozen;e.useUbo&&i&&e.isSync||!this._texture||!a.k.DetailTextureEnabled||(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,h.NL)(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&a.k.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture?.dispose()}getClassName(){return"DetailMapConfiguration"}getSamplers(e){e.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,s.gn)([(0,n.oU)("detailTexture"),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"texture",void 0),(0,s.gn)([(0,n.qC)()],d.prototype,"diffuseBlendLevel",void 0),(0,s.gn)([(0,n.qC)()],d.prototype,"roughnessBlendLevel",void 0),(0,s.gn)([(0,n.qC)()],d.prototype,"bumpLevel",void 0),(0,s.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalBlendMethod",void 0),(0,s.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isEnabled",void 0)},50953:function(e,t,i){i.d(t,{k:function(){return r}});var s=i(3176);class r{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,s.a.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,s.a.MarkAllMaterialsAsDirty(1))}}r._DiffuseTextureEnabled=!0,r._DetailTextureEnabled=!0,r._DecalMapEnabled=!0,r._AmbientTextureEnabled=!0,r._OpacityTextureEnabled=!0,r._ReflectionTextureEnabled=!0,r._EmissiveTextureEnabled=!0,r._SpecularTextureEnabled=!0,r._BumpTextureEnabled=!0,r._LightmapTextureEnabled=!0,r._RefractionTextureEnabled=!0,r._ColorGradingTextureEnabled=!0,r._FresnelEnabled=!0,r._ClearCoatTextureEnabled=!0,r._ClearCoatBumpTextureEnabled=!0,r._ClearCoatTintTextureEnabled=!0,r._SheenTextureEnabled=!0,r._AnisotropicTextureEnabled=!0,r._ThicknessTextureEnabled=!0,r._RefractionIntensityTextureEnabled=!0,r._TranslucencyIntensityTextureEnabled=!0,r._TranslucencyColorTextureEnabled=!0,r._IridescenceTextureEnabled=!0},65940:function(e,t,i){i.d(t,{n:function(){return l}});var s=i(46456),r=i(22287),n=i(32365),a=i(90212),o=i(7724);class l{isCompatible(e){return 0===e}_enable(e){e&&this._pluginManager._activatePlugin(this)}constructor(e,t,i,s,r=!0,a=!1,o=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=e,this.name=t,this.priority=i,this.resolveIncludes=o,e.pluginManager||(e.pluginManager=new n.BK(e),e.onDisposeObservable.add(()=>{e.pluginManager=void 0})),this._pluginDefineNames=s,this._pluginManager=e.pluginManager,r&&this._pluginManager._addPlugin(this),a&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(e,t,i,s){return!0}hardBindForSubMesh(e,t,i,s){}bindForSubMesh(e,t,i,s){}dispose(e){}getCustomCode(e,t=0){return null}collectDefines(e){if(this._pluginDefineNames)for(let t of Object.keys(this._pluginDefineNames)){if("_"===t[0])continue;let i=typeof this._pluginDefineNames[t];e[t]={type:"number"===i?"number":"string"===i?"string":"boolean"===i?"boolean":"object",default:this._pluginDefineNames[t]}}}prepareDefinesBeforeAttributes(e,t,i){}prepareDefines(e,t,i){}hasTexture(e){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(e){}getActiveTextures(e){}getAnimatables(e){}addFallbacks(e,t,i){return i}getSamplers(e){}getAttributes(e,t,i){}getUniformBuffersNames(e){}getUniforms(e=0){return{}}copyTo(e){a.p.Clone(()=>e,this)}serialize(){return a.p.Serialize(this)}parse(e,t,i){a.p.Parse(()=>this,e,t,i)}}(0,s.gn)([(0,r.qC)()],l.prototype,"name",void 0),(0,s.gn)([(0,r.qC)()],l.prototype,"priority",void 0),(0,s.gn)([(0,r.qC)()],l.prototype,"resolveIncludes",void 0),(0,s.gn)([(0,r.qC)()],l.prototype,"registerForExtraEvents",void 0),(0,o.H7)("BABYLON.MaterialPluginBase",l)},32365:function(e,t,i){i.d(t,{BK:function(){return l}});var s=i(5848),r=i(51092),n=i(96305),a=i(29427);let o=RegExp("^([gimus]+)!");class l{constructor(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}_addPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e.name)return!1;if(this._material._uniformBufferLayoutBuilt)throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.`;if(!e.isCompatible(this._material.shaderLanguage))throw`The plugin "${e.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;let t=e.getClassName();l._MaterialPluginClassToMainDefine[t]||(l._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++l._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(e,t)=>this._handlePluginEvent(e,t),this._plugins.push(e),this._plugins.sort((e,t)=>e.priority-t.priority),this._codeInjectionPoints={};let i={};for(let e of(i[l._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0},this._plugins))e.collectDefines(i),this._collectPointNames("vertex",e.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",e.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=i,!0}_activatePlugin(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort((e,t)=>e.priority-t.priority),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort((e,t)=>e.priority-t.priority),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(e){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(e){let t=!0;for(let i of this._activePlugins)t=t&&i.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh);e.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(e){for(let t of this._activePlugins)t.prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}_handlePluginEventPrepareDefines(e){for(let t of this._activePlugins)t.prepareDefines(e.defines,this._scene,e.mesh)}_handlePluginEventHardBindForSubMesh(e){for(let t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventBindForSubMesh(e){for(let t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}_handlePluginEventHasRenderTargetTextures(e){let t=!1;for(let e of this._activePluginsForExtraEvents)if(t=e.hasRenderTargetTextures())break;e.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(e){for(let t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(e.renderTargets)}_handlePluginEvent(e,t){switch(e){case 512:for(let e of this._activePlugins)e.getActiveTextures(t.activeTextures);break;case 256:for(let e of this._activePlugins)e.getAnimatables(t.animatables);break;case 1024:{let e=!1;for(let i of this._activePlugins)if(e=i.hasTexture(t.texture))break;t.hasTexture=e;break}case 2:for(let e of this._plugins)e.dispose(t.forceDisposeTextures);break;case 4:t.defineNames=this._defineNamesFromPlugins;break;case 128:for(let e of this._activePlugins)t.fallbackRank=e.addFallbacks(t.defines,t.fallbacks,t.fallbackRank),e.getAttributes(t.attributes,this._scene,t.mesh);this._uniformList.length>0&&t.uniforms.push(...this._uniformList),this._samplerList.length>0&&t.samplers.push(...this._samplerList),this._uboList.length>0&&t.uniformBuffersNames.push(...this._uboList),t.customCode=this._injectCustomCode(t,t.customCode);break;case 8:{this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];let e=1===this._material.shaderLanguage;for(let i of this._plugins){let s=i.getUniforms(this._material.shaderLanguage);if(s){if(s.ubo)for(let i of s.ubo){if(i.size&&i.type){let s=i.arraySize??0;if(t.ubo.addUniform(i.name,i.size,s),e){let e;switch(i.type){case"mat4":e="mat4x4f";break;case"float":e="f32";break;default:e=`${i.type}f`}this._uboDeclaration+=`uniform ${i.name}: ${e}${s>0?`[${s}]`:""};
`}else this._uboDeclaration+=`${i.type} ${i.name}${s>0?`[${s}]`:""};
`}this._uniformList.push(i.name)}s.vertex&&(this._vertexDeclaration+=s.vertex+"\n"),s.fragment&&(this._fragmentDeclaration+=s.fragment+"\n")}i.getSamplers(this._samplerList),i.getUniformBuffersNames(this._uboList)}}}}_collectPointNames(e,t){if(t)for(let i in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][i]=!0}_injectCustomCode(e,t){return(i,s)=>{t&&(s=t(i,s)),this._uboDeclaration&&(s=s.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(s=s.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(s=s.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));let r=this._codeInjectionPoints?.[i];if(!r)return s;let l=null;for(let t in r){let r="";for(let s of this._activePlugins){let o=s.getCustomCode(i,this._material.shaderLanguage)?.[t];o&&(s.resolveIncludes&&(null===l&&(l={defines:[],indexParameters:e.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:a.v.GetShadersRepository(0),includesShadersStore:a.v.GetIncludesShadersStore(0),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}),l.isFragment="fragment"===i,(0,n.xd)(o,l,e=>o=e)),r+=o+"\n")}if(r.length>0){if("!"===t.charAt(0)){t=t.substring(1);let e="g";if("!"===t.charAt(0))e="",t=t.substring(1);else{let i=o.exec(t);i&&i.length>=2&&(e=i[1],t=t.substring(e.length+1))}0>e.indexOf("g")&&(e+="g");let i=s,n=new RegExp(t,e),a=n.exec(i);for(;null!==a;){let e=r;for(let t=0;t<a.length;++t)e=e.replace("$"+t,a[t]);s=s.replace(a[0],e),a=n.exec(i)}}else{let e="#define "+t;s=s.replace(e,"\n"+r+"\n"+e)}}}return s}}}l._MaterialPluginClassToMainDefine={},l._MaterialPluginCounter=0,r.l.OnEnginesDisposedObservable.add(()=>{h.length=0,s.F.OnEventObservable.remove(u),u=null});let h=[],u=null},58487:function(e,t,i){i.d(t,{o:function(){return s}});class s{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(e){e.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(e){}bindForSubMesh(e,t,i,s,r){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(-1!==t.prePassRenderer.getIndex(2)||-1!==t.prePassRenderer.getIndex(11))){this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=s.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());let r=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=r.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==r.frameId&&(this._lastUpdateFrameId=r.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=s.clone()}}}},90404:function(e,t,i){i.d(t,{K:function(){return M}});var s=i(46456),r=i(22287),n=i(93287),a=i(44755),o=i(39884),l=i(57449),h=i(93954),u=i(58487),d=i(91176),c=i(5848),f=i(16188),p=i(31786),_=i(81209),g=i(7724),x=i(50953),m=i(34634),T=i(33776),E=i(49449),b=i(38104),A=i(90212),P=i(76608);let I={effect:null,subMesh:null};class v extends f.H{constructor(e){super(e),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(e){for(let t of["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"])this[t]=t===e}}class M extends p.a{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e?this._imageProcessingConfiguration=e:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this._imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this._imageProcessingConfiguration.colorCurves=e}get canRenderToMRT(){return!0}constructor(e,t,i=!1){super(e,t),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new l.Wo(0,0,0),this.diffuseColor=new l.Wo(1,1,1),this.specularColor=new l.Wo(1,1,1),this.emissiveColor=new l.Wo(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new n.t(16),this._worldViewProjectionMatrix=o.y3.Zero(),this._globalAmbientColor=new l.Wo(0,0,0),this._cacheHasRenderTargetTextures=!1;let s=this.getScene().getEngine();!s.isWebGPU||i||M.ForceGLSL||(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new P.M(s,void 0,void 0,this.name,!0),this._shaderLanguage=1),this.detailMap=new T.p(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new u.o,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),M.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),M.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!M.ReflectionTextureEnabled&&!!this._reflectionTexture&&!!this._reflectionTexture.isRenderTarget||!!M.RefractionTextureEnabled&&!!this._refractionTexture&&!!this._refractionTexture.isRenderTarget||this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===c.F.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==c.F.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(e,t,s=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();let r=t._drawWrapper;if(r.effect&&this.isFrozen&&r._wasPreviouslyReady&&r._wasPreviouslyUsingInstances===s)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new v(this._eventInfo.defineNames));let n=this.getScene(),a=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;let o=n.getEngine();a._needNormals=(0,b.UX)(n,e,a,!0,this._maxSimultaneousLights,this._disableLighting),(0,b.Z7)(n,a);let l=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if((0,b.Kg)(n,a,this.canRenderToMRT&&!l),(0,b.t6)(n,a,l),a._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,a._needUVs=!1;for(let e=1;e<=6;++e)a["MAINUV"+e]=!1;if(n.texturesEnabled){if(a.DIFFUSEDIRECTUV=0,a.BUMPDIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.SPECULARDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&M.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,b.lw)(this._diffuseTexture,a,"DIFFUSE")}else a.DIFFUSE=!1;if(this._ambientTexture&&M.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,b.lw)(this._ambientTexture,a,"AMBIENT")}else a.AMBIENT=!1;if(this._opacityTexture&&M.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,b.lw)(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&M.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===_.x.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,a.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case _.x.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case _.x.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case _.x.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case _.x.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case _.x.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case _.x.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case _.x.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case _.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case _.x.CUBIC_MODE:case _.x.INVCUBIC_MODE:default:a.setReflectionMode("REFLECTIONMAP_CUBIC")}a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else a.REFLECTION=!1,a.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&M.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,b.lw)(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(this._lightmapTexture&&M.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,b.lw)(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else a.LIGHTMAP=!1;if(this._specularTexture&&M.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,b.lw)(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(n.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&M.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,b.lw)(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAX_RHS=n.useRightHandedSystem,a.PARALLAXOCCLUSION=this._useParallaxOcclusion,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&M.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube,a.RGBDREFRACTION=this._refractionTexture.isRGBD,a.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,a.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=a,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(a._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a),a.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,a.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}a._areFresnelDirty&&(M.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),(0,b.BV)(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,a,this._applyDecalMapAfterDetailMap),(0,b.vG)(n,o,this,a,s,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=a,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,b.wJ)(e,a,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let c=!1;if(a.isDirty){let s=a._areLightsDisposed;a.markAsProcessed();let r=new m.L;a.REFLECTION&&r.addFallback(0,"REFLECTION"),a.SPECULAR&&r.addFallback(0,"SPECULAR"),a.BUMP&&r.addFallback(0,"BUMP"),a.PARALLAX&&r.addFallback(1,"PARALLAX"),a.PARALLAX_RHS&&r.addFallback(1,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&r.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&r.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&r.addFallback(1,"FOG"),a.POINTSIZE&&r.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&r.addFallback(0,"LOGARITHMICDEPTH"),(0,b.Lh)(a,r,this._maxSimultaneousLights),a.SPECULARTERM&&r.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&r.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&r.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&r.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&r.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&r.addFallback(4,"FRESNEL"),a.MULTIVIEW&&r.addFallback(0,"MULTIVIEW");let l=[h.o.PositionKind];a.NORMAL&&l.push(h.o.NormalKind),a.TANGENT&&l.push(h.o.TangentKind);for(let e=1;e<=6;++e)a["UV"+e]&&l.push(`uv${1===e?"":e}`);a.VERTEXCOLOR&&l.push(h.o.ColorKind),(0,b.TD)(l,e,a,r),(0,b.od)(l,a),(0,b.n5)(l,e,a),(0,b.pd)(l,e,a);let f="default",p=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],_=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],g=["Material","Scene","Mesh"],x={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=r,this._eventInfo.fallbackRank=0,this._eventInfo.defines=a,this._eventInfo.uniforms=p,this._eventInfo.attributes=l,this._eventInfo.samplers=_,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=x,this._callbackPluginEventGeneric(128,this._eventInfo),u.o.AddUniforms(p),u.o.AddSamplers(_),d.$&&(d.$.PrepareUniforms(p,a),d.$.PrepareSamplers(_,a)),(0,b.DI)({uniformsNames:p,uniformBuffersNames:g,samplers:_,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),(0,E.qx)(p);let T={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,p,g,_,a,l,T));let A=a.toString(),P=t.effect,v=n.getEngine().createEffect(f,{attributes:l,uniformsNames:p,uniformBuffersNames:g,samplers:_,defines:A,fallbacks:r,onCompiled:this.onCompiled,onError:this.onError,indexParameters:x,processFinalCode:T.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([i.e(4640),i.e(3384)]).then(i.bind(i,74640)),i.e(6874).then(i.bind(i,96874))]):await Promise.all([Promise.all([i.e(7665),i.e(716)]).then(i.bind(i,67665)),i.e(6426).then(i.bind(i,86426))]),this._shadersLoaded=!0}},o);if(this._eventInfo.customCode=void 0,v){if(this._onEffectCreatedObservable&&(I.effect=v,I.subMesh=t,this._onEffectCreatedObservable.notifyObservers(I)),this.allowShaderHotSwapping&&P&&!v.isReady()){if(v=P,a.markAsUnprocessed(),c=this.isFrozen,s)return a._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(v,a,this._materialContext)}}return!!(t.effect&&t.effect.isReady())&&(a._renderId=n.getRenderId(),r._wasPreviouslyReady=!c,r._wasPreviouslyUsingInstances=s,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){let e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("alphaCutOff",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vRefractionPosition",3),e.addUniform("vRefractionSize",3),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vDiffuseColor",4),e.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(e,t,i){let s=this.getScene(),r=i.materialDefines;if(!r)return;let n=i.effect;if(!n)return;this._activeEffect=n,t.getMeshUniformBuffer().bindToEffect(n,"Mesh"),t.transferToEffect(e),this._uniformBuffer.bindToEffect(n,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,s,t,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),r.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));let o=this._mustRebind(s,n,i,t.visibility);(0,b.qx)(t,n);let h=this._uniformBuffer;if(o){if(this.bindViewProjection(n),!h.useUbo||!this.isFrozen||!h.isSync||i._drawWrapper._forceRebindOnNextCall){if(M.FresnelEnabled&&r.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(h.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),h.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&h.updateColor4("opacityParts",new l.Wo(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(h.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),h.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(h.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),h.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(h.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),h.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),s.texturesEnabled){if(this._diffuseTexture&&M.DiffuseTextureEnabled&&(h.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,b.NL)(this._diffuseTexture,h,"diffuse")),this._ambientTexture&&M.AmbientTextureEnabled&&(h.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,b.NL)(this._ambientTexture,h,"ambient")),this._opacityTexture&&M.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,b.NL)(this._opacityTexture,h,"opacity")),this._hasAlphaChannel()&&h.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&M.ReflectionTextureEnabled&&(h.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),h.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){let e=this._reflectionTexture;h.updateVector3("vReflectionPosition",e.boundingBoxPosition),h.updateVector3("vReflectionSize",e.boundingBoxSize)}if(this._emissiveTexture&&M.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,b.NL)(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&M.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,b.NL)(this._lightmapTexture,h,"lightmap")),this._specularTexture&&M.SpecularTextureEnabled&&(h.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,b.NL)(this._specularTexture,h,"specular")),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&M.BumpTextureEnabled&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,b.NL)(this._bumpTexture,h,"bump"),s._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&M.RefractionTextureEnabled){let e=1;if(!this._refractionTexture.isCube&&(h.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(e=this._refractionTexture.depth)),h.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){let e=this._refractionTexture;h.updateVector3("vRefractionPosition",e.boundingBoxPosition),h.updateVector3("vRefractionSize",e.boundingBoxSize)}}}this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),r.SPECULARTERM&&h.updateColor4("vSpecularColor",this.specularColor,this.specularPower),h.updateColor3("vEmissiveColor",M.EmissiveTextureEnabled?this.emissiveColor:l.Wo.BlackReadOnly),h.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),s.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor)}s.texturesEnabled&&(this._diffuseTexture&&M.DiffuseTextureEnabled&&n.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&M.AmbientTextureEnabled&&n.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&M.OpacityTextureEnabled&&n.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&M.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?n.setTexture("reflectionCubeSampler",this._reflectionTexture):n.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&M.EmissiveTextureEnabled&&n.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&M.LightmapTextureEnabled&&n.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&M.SpecularTextureEnabled&&n.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&M.BumpTextureEnabled&&n.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&M.RefractionTextureEnabled&&(this._refractionTexture.isCube?n.setTexture("refractionCubeSampler",this._refractionTexture):n.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(n),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,E.an)(n,this,s),this.bindEyePosition(n)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(o||!this.isFrozen)&&(s.lightsEnabled&&!this._disableLighting&&(0,b.VX)(s,t,n,r,this._maxSimultaneousLights),(s.fogEnabled&&t.applyFog&&s.fogMode!==a.x.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||r.PREPASS)&&this.bindView(n),(0,b.D1)(s,t,n),r.NUM_MORPH_INFLUENCERS&&(0,b.KG)(t,n),r.BAKED_VERTEX_ANIMATION_TEXTURE&&t.bakedVertexAnimationManager?.bind(n,r.INSTANCES),this.useLogarithmicDepth&&(0,b.gz)(r,n,s),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect,i),h.update()}getAnimatables(){let e=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e}getActiveTextures(){let e=super.getActiveTextures();return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._diffuseTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._specularTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this._refractionTexture===e}dispose(e,t){t&&(this._diffuseTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._specularTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._refractionTexture?.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,t)}clone(e,t=!0,i=""){let s=A.p.Clone(()=>new M(e,this.getScene()),this,{cloneTexturesOnlyOnce:t});return s.name=e,s.id=e,this.stencil.copyTo(s.stencil),this._clonePlugins(s,i),s}static Parse(e,t,i){let s=A.p.Parse(()=>new M(e.name,t),e,t,i);return e.stencil&&s.stencil.parse(e.stencil,t,i),c.F._ParsePlugins(e,s,t,i),s}static get DiffuseTextureEnabled(){return x.k.DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){x.k.DiffuseTextureEnabled=e}static get DetailTextureEnabled(){return x.k.DetailTextureEnabled}static set DetailTextureEnabled(e){x.k.DetailTextureEnabled=e}static get AmbientTextureEnabled(){return x.k.AmbientTextureEnabled}static set AmbientTextureEnabled(e){x.k.AmbientTextureEnabled=e}static get OpacityTextureEnabled(){return x.k.OpacityTextureEnabled}static set OpacityTextureEnabled(e){x.k.OpacityTextureEnabled=e}static get ReflectionTextureEnabled(){return x.k.ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){x.k.ReflectionTextureEnabled=e}static get EmissiveTextureEnabled(){return x.k.EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){x.k.EmissiveTextureEnabled=e}static get SpecularTextureEnabled(){return x.k.SpecularTextureEnabled}static set SpecularTextureEnabled(e){x.k.SpecularTextureEnabled=e}static get BumpTextureEnabled(){return x.k.BumpTextureEnabled}static set BumpTextureEnabled(e){x.k.BumpTextureEnabled=e}static get LightmapTextureEnabled(){return x.k.LightmapTextureEnabled}static set LightmapTextureEnabled(e){x.k.LightmapTextureEnabled=e}static get RefractionTextureEnabled(){return x.k.RefractionTextureEnabled}static set RefractionTextureEnabled(e){x.k.RefractionTextureEnabled=e}static get ColorGradingTextureEnabled(){return x.k.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){x.k.ColorGradingTextureEnabled=e}static get FresnelEnabled(){return x.k.FresnelEnabled}static set FresnelEnabled(e){x.k.FresnelEnabled=e}}M.ForceGLSL=!1,(0,s.gn)([(0,r.oU)("diffuseTexture")],M.prototype,"_diffuseTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"diffuseTexture",void 0),(0,s.gn)([(0,r.oU)("ambientTexture")],M.prototype,"_ambientTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTexture",void 0),(0,s.gn)([(0,r.oU)("opacityTexture")],M.prototype,"_opacityTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"opacityTexture",void 0),(0,s.gn)([(0,r.oU)("reflectionTexture")],M.prototype,"_reflectionTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionTexture",void 0),(0,s.gn)([(0,r.oU)("emissiveTexture")],M.prototype,"_emissiveTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveTexture",void 0),(0,s.gn)([(0,r.oU)("specularTexture")],M.prototype,"_specularTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"specularTexture",void 0),(0,s.gn)([(0,r.oU)("bumpTexture")],M.prototype,"_bumpTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,s.gn)([(0,r.oU)("lightmapTexture")],M.prototype,"_lightmapTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"lightmapTexture",void 0),(0,s.gn)([(0,r.oU)("refractionTexture")],M.prototype,"_refractionTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"refractionTexture",void 0),(0,s.gn)([(0,r.n9)("ambient")],M.prototype,"ambientColor",void 0),(0,s.gn)([(0,r.n9)("diffuse")],M.prototype,"diffuseColor",void 0),(0,s.gn)([(0,r.n9)("specular")],M.prototype,"specularColor",void 0),(0,s.gn)([(0,r.n9)("emissive")],M.prototype,"emissiveColor",void 0),(0,s.gn)([(0,r.qC)()],M.prototype,"specularPower",void 0),(0,s.gn)([(0,r.qC)("useAlphaFromDiffuseTexture")],M.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"useAlphaFromDiffuseTexture",void 0),(0,s.gn)([(0,r.qC)("useEmissiveAsIllumination")],M.prototype,"_useEmissiveAsIllumination",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useEmissiveAsIllumination",void 0),(0,s.gn)([(0,r.qC)("linkEmissiveWithDiffuse")],M.prototype,"_linkEmissiveWithDiffuse",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"linkEmissiveWithDiffuse",void 0),(0,s.gn)([(0,r.qC)("useSpecularOverAlpha")],M.prototype,"_useSpecularOverAlpha",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useSpecularOverAlpha",void 0),(0,s.gn)([(0,r.qC)("useReflectionOverAlpha")],M.prototype,"_useReflectionOverAlpha",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useReflectionOverAlpha",void 0),(0,s.gn)([(0,r.qC)("disableLighting")],M.prototype,"_disableLighting",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],M.prototype,"disableLighting",void 0),(0,s.gn)([(0,r.qC)("useObjectSpaceNormalMap")],M.prototype,"_useObjectSpaceNormalMap",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useObjectSpaceNormalMap",void 0),(0,s.gn)([(0,r.qC)("useParallax")],M.prototype,"_useParallax",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallax",void 0),(0,s.gn)([(0,r.qC)("useParallaxOcclusion")],M.prototype,"_useParallaxOcclusion",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallaxOcclusion",void 0),(0,s.gn)([(0,r.qC)()],M.prototype,"parallaxScaleBias",void 0),(0,s.gn)([(0,r.qC)("roughness")],M.prototype,"_roughness",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"roughness",void 0),(0,s.gn)([(0,r.qC)()],M.prototype,"indexOfRefraction",void 0),(0,s.gn)([(0,r.qC)()],M.prototype,"invertRefractionY",void 0),(0,s.gn)([(0,r.qC)()],M.prototype,"alphaCutOff",void 0),(0,s.gn)([(0,r.qC)("useLightmapAsShadowmap")],M.prototype,"_useLightmapAsShadowmap",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLightmapAsShadowmap",void 0),(0,s.gn)([(0,r.qQ)("diffuseFresnelParameters")],M.prototype,"_diffuseFresnelParameters",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"diffuseFresnelParameters",void 0),(0,s.gn)([(0,r.qQ)("opacityFresnelParameters")],M.prototype,"_opacityFresnelParameters",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsFresnelAndMiscDirty")],M.prototype,"opacityFresnelParameters",void 0),(0,s.gn)([(0,r.qQ)("reflectionFresnelParameters")],M.prototype,"_reflectionFresnelParameters",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"reflectionFresnelParameters",void 0),(0,s.gn)([(0,r.qQ)("refractionFresnelParameters")],M.prototype,"_refractionFresnelParameters",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"refractionFresnelParameters",void 0),(0,s.gn)([(0,r.qQ)("emissiveFresnelParameters")],M.prototype,"_emissiveFresnelParameters",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"emissiveFresnelParameters",void 0),(0,s.gn)([(0,r.qC)("useReflectionFresnelFromSpecular")],M.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsFresnelDirty")],M.prototype,"useReflectionFresnelFromSpecular",void 0),(0,s.gn)([(0,r.qC)("useGlossinessFromSpecularMapAlpha")],M.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,s.gn)([(0,r.qC)("maxSimultaneousLights")],M.prototype,"_maxSimultaneousLights",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],M.prototype,"maxSimultaneousLights",void 0),(0,s.gn)([(0,r.qC)("invertNormalMapX")],M.prototype,"_invertNormalMapX",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapX",void 0),(0,s.gn)([(0,r.qC)("invertNormalMapY")],M.prototype,"_invertNormalMapY",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapY",void 0),(0,s.gn)([(0,r.qC)("twoSidedLighting")],M.prototype,"_twoSidedLighting",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"twoSidedLighting",void 0),(0,s.gn)([(0,r.qC)("applyDecalMapAfterDetailMap")],M.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],M.prototype,"applyDecalMapAfterDetailMap",void 0),(0,g.H7)("BABYLON.StandardMaterial",M),a.x.DefaultMaterialFactory=e=>new M("default material",e)},63647:function(e,t,i){i.d(t,{NR:function(){return d},ZU:function(){return u},aR:function(){return h}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(77210),l=i(96366);function h(e){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[],l=[],h=e.width||e.size||1,u=e.height||e.size||1,d=e.depth||e.size||1,c=e.wrap||!1,f=void 0===e.topBaseAt?1:e.topBaseAt,p=void 0===e.bottomBaseAt?0:e.bottomBaseAt;f=(f+4)%4,p=(p+4)%4;let _=[2,0,3,1][f],g=[2,0,1,3][p],x=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],x=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],s=[17,18,19,16],r=[22,23,20,21];for(;_>0;)e.unshift(e.pop()),s.unshift(s.pop()),_--;for(;g>0;)i.unshift(i.pop()),r.unshift(r.pop()),g--;e=e.flat(),i=i.flat(),x=x.concat(e).concat(i),t.push(s[0],s[2],s[3],s[0],s[1],s[2]),t.push(r[0],r[2],r[3],r[0],r[1],r[2])}let m=[h/2,u/2,d/2];l=x.reduce((e,t,i)=>e.concat(t*m[i%3]),[]);let T=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,E=e.faceUV||Array(6),b=e.faceColors,A=[];for(let e=0;e<6;e++)void 0===E[e]&&(E[e]=new s.Lt(0,0,1,1)),b&&void 0===b[e]&&(b[e]=new r.HE(1,1,1,1));for(let e=0;e<6;e++)if(n.push(E[e].z,o.VJ?1-E[e].w:E[e].w),n.push(E[e].x,o.VJ?1-E[e].w:E[e].w),n.push(E[e].x,o.VJ?1-E[e].y:E[e].y),n.push(E[e].z,o.VJ?1-E[e].y:E[e].y),b)for(let t=0;t<4;t++)A.push(b[e].r,b[e].g,b[e].b,b[e].a);a.x._ComputeSides(T,l,t,i,n,e.frontUVs,e.backUVs);let P=new a.x;if(P.indices=t,P.positions=l,P.normals=i,P.uvs=n,b){let e=T===a.x.DOUBLESIDE?A.concat(A):A;P.colors=e}return P}function u(e){let t=e.width||e.size||1,i=e.height||e.size||1,r=e.depth||e.size||1,n=0|(e.widthSegments||e.segments||1),a=0|(e.heightSegments||e.segments||1),o=0|(e.depthSegments||e.segments||1),h=new s.y3,u=new s.y3,d=new s.y3,c=(0,l.kt)({width:t,height:r,subdivisionsX:n,subdivisionsY:o});s.y3.TranslationToRef(0,-i/2,0,u),s.y3.RotationZToRef(Math.PI,h),h.multiplyToRef(u,d),c.transform(d);let f=(0,l.kt)({width:t,height:r,subdivisionsX:n,subdivisionsY:o});s.y3.TranslationToRef(0,i/2,0,d),f.transform(d);let p=(0,l.kt)({width:i,height:r,subdivisionsX:a,subdivisionsY:o});s.y3.TranslationToRef(-t/2,0,0,u),s.y3.RotationZToRef(Math.PI/2,h),h.multiplyToRef(u,d),p.transform(d);let _=(0,l.kt)({width:i,height:r,subdivisionsX:a,subdivisionsY:o});s.y3.TranslationToRef(t/2,0,0,u),s.y3.RotationZToRef(-Math.PI/2,h),h.multiplyToRef(u,d),_.transform(d);let g=(0,l.kt)({width:t,height:i,subdivisionsX:n,subdivisionsY:a});s.y3.TranslationToRef(0,0,-r/2,u),s.y3.RotationXToRef(-Math.PI/2,h),h.multiplyToRef(u,d),g.transform(d);let x=(0,l.kt)({width:t,height:i,subdivisionsX:n,subdivisionsY:a});return s.y3.TranslationToRef(0,0,r/2,u),s.y3.RotationXToRef(Math.PI/2,h),h.multiplyToRef(u,d),x.transform(d),c.merge([f,_,p,g,x],!0),c}function d(e,t={},i=null){let s=new n.Kj(e,i);return t.sideOrientation=n.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,h(t).applyToMesh(s,t.updatable),s}a.x.CreateBox=h,n.Kj.CreateBox=(e,t,i=null,s,r)=>d(e,{size:t,sideOrientation:r,updatable:s},i)},37542:function(e,t,i){i.d(t,{VF:function(){return o},iz:function(){return l}});var s=i(89754),r=i(39884),n=i(35823),a=i(77210);function o(e={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){let t,i;let n=0|Math.max(e.subdivisions?e.subdivisions:2,1),o=0|Math.max(e.tessellation?e.tessellation:16,3),l=Math.max(e.height?e.height:1,0),h=Math.max(e.radius?e.radius:.25,0),u=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),d=Math.max(e.radiusTop?e.radiusTop:h,0),c=Math.max(e.radiusBottom?e.radiusBottom:h,0),f=2*Math.PI,p=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:u,1),_=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:u,1),g=Math.acos((c-d)/l),x=[],m=[],T=[],E=[],b=0,A=[],P=.5*(l-(d+c)),I=.5*Math.PI,v=r.P.Zero(),M=r.P.Zero(),y=Math.cos(g),R=Math.sin(g),S=new r.FM(d*R,P+d*y).subtract(new r.FM(c*R,-P+c*y)).length(),C=d*g+S+c*(I-g),O=0;for(i=0;i<=p;i++){let e=[],s=I-i/p*g;O+=d*g/p;let r=Math.cos(s),n=Math.sin(s),l=r*d;for(t=0;t<=o;t++){let i=t/o,s=i*f+0,h=Math.sin(s),u=Math.cos(s);M.x=l*h,M.y=P+n*d,M.z=l*u,m.push(M.x,M.y,M.z),v.set(r*h,n,r*u),T.push(v.x,v.y,v.z),E.push(i,a.VJ?O/C:1-O/C),e.push(b),b++}A.push(e)}let L=l-d-c+y*d-y*c,D=R*(c-d)/L;for(i=1;i<=n;i++){let e=[];O+=S/n;let s=R*(i*(c-d)/n+d);for(t=0;t<=o;t++){let r=t/o,l=r*f+0,h=Math.sin(l),u=Math.cos(l);M.x=s*h,M.y=P+y*d-i*L/n,M.z=s*u,m.push(M.x,M.y,M.z),v.set(h,D,u).normalize(),T.push(v.x,v.y,v.z),E.push(r,a.VJ?O/C:1-O/C),e.push(b),b++}A.push(e)}for(i=1;i<=_;i++){let e=[],s=I-g-i/_*(Math.PI-g);O+=c*g/_;let r=Math.cos(s),n=Math.sin(s),l=r*c;for(t=0;t<=o;t++){let i=t/o,s=i*f+0,h=Math.sin(s),u=Math.cos(s);M.x=l*h,M.y=-P+n*c,M.z=l*u,m.push(M.x,M.y,M.z),v.set(r*h,n,r*u),T.push(v.x,v.y,v.z),E.push(i,a.VJ?O/C:1-O/C),e.push(b),b++}A.push(e)}for(t=0;t<o;t++)for(i=0;i<p+n+_;i++){let e=A[i][t],s=A[i+1][t],r=A[i+1][t+1],n=A[i][t+1];x.push(e),x.push(s),x.push(n),x.push(s),x.push(r),x.push(n)}if(x=x.reverse(),e.orientation&&!e.orientation.equals(r.P.Up())){let t=new r.y3;e.orientation.clone().scale(.5*Math.PI).cross(r.P.Up()).toQuaternion().toRotationMatrix(t);let i=r.P.Zero();for(let e=0;e<m.length;e+=3)i.set(m[e],m[e+1],m[e+2]),r.P.TransformCoordinatesToRef(i.clone(),t,i),m[e]=i.x,m[e+1]=i.y,m[e+2]=i.z}let F=new s.x;return F.positions=m,F.normals=T,F.uvs=E,F.indices=x,F}function l(e,t={orientation:r.P.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=null){let s=new n.Kj(e,i);return o(t).applyToMesh(s,t.updatable),s}n.Kj.CreateCapsule=(e,t,i)=>l(e,t,i),s.x.CreateCapsule=o},53413:function(e,t,i){i.d(t,{wf:function(){return d},zD:function(){return u}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(44755),l=i(50154),h=i(77210);function u(e){let t,i,o,u,d,c,f;let p=e.height||2,_=0===e.diameterTop?0:e.diameterTop||e.diameter||1,g=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;_=_||1e-5,g=g||1e-5;let x=0|(e.tessellation||24),m=0|(e.subdivisions||1),T=!!e.hasRings,E=!!e.enclose,b=0===e.cap?0:e.cap||n.Kj.CAP_ALL,A=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,P=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,I=e.faceUV||[,,,],v=e.faceColors,M=2+(1+(1!==A&&E?2:0))*(T?m:1);for(t=0;t<M;t++)v&&void 0===v[t]&&(v[t]=new r.HE(1,1,1,1));for(t=0;t<M;t++)I&&void 0===I[t]&&(I[t]=new s.Lt(0,0,1,1));let y=[],R=[],S=[],C=[],O=[],L=2*Math.PI*A/x,D=(g-_)/2/p,F=s.P.Zero(),B=s.P.Zero(),w=s.P.Zero(),N=s.P.Zero(),U=s.P.Zero(),z=l.RD.Y,V=1,k=1,K=0,j=0;for(d=0;d<=m;d++)for(f=0,u=((o=d/m)*(_-g)+g)/2,V=T&&0!==d&&d!==m?2:1;f<V;f++){for(T&&(k+=f),E&&(k+=2*f),c=0;c<=x;c++)i=c*L,F.x=Math.cos(-i)*u,F.y=-p/2+o*p,F.z=Math.sin(-i)*u,0===_&&d===m?(B.x=S[S.length-(x+1)*3],B.y=S[S.length-(x+1)*3+1],B.z=S[S.length-(x+1)*3+2]):(B.x=F.x,B.z=F.z,B.y=Math.sqrt(B.x*B.x+B.z*B.z)*D,B.normalize()),0===c&&(w.copyFrom(F),N.copyFrom(B)),R.push(F.x,F.y,F.z),S.push(B.x,B.y,B.z),j=T?K!==k?I[k].y:I[k].w:I[k].y+(I[k].w-I[k].y)*o,C.push(I[k].x+(I[k].z-I[k].x)*c/x,h.VJ?1-j:j),v&&O.push(v[k].r,v[k].g,v[k].b,v[k].a);1!==A&&E&&(R.push(F.x,F.y,F.z),R.push(0,F.y,0),R.push(0,F.y,0),R.push(w.x,w.y,w.z),s.P.CrossToRef(z,B,U),U.normalize(),S.push(U.x,U.y,U.z,U.x,U.y,U.z),s.P.CrossToRef(N,z,U),U.normalize(),S.push(U.x,U.y,U.z,U.x,U.y,U.z),j=T?K!==k?I[k+1].y:I[k+1].w:I[k+1].y+(I[k+1].w-I[k+1].y)*o,C.push(I[k+1].x,h.VJ?1-j:j),C.push(I[k+1].z,h.VJ?1-j:j),j=T?K!==k?I[k+2].y:I[k+2].w:I[k+2].y+(I[k+2].w-I[k+2].y)*o,C.push(I[k+2].x,h.VJ?1-j:j),C.push(I[k+2].z,h.VJ?1-j:j),v&&(O.push(v[k+1].r,v[k+1].g,v[k+1].b,v[k+1].a),O.push(v[k+1].r,v[k+1].g,v[k+1].b,v[k+1].a),O.push(v[k+2].r,v[k+2].g,v[k+2].b,v[k+2].a),O.push(v[k+2].r,v[k+2].g,v[k+2].b,v[k+2].a))),K!==k&&(K=k)}let G=1!==A&&E?x+4:x;for(k=0,d=0;k<m;k++){let e=0,t=0,i=0,s=0;for(c=0;c<x;c++)e=d*(G+1)+c,t=(d+1)*(G+1)+c,i=d*(G+1)+(c+1),s=(d+1)*(G+1)+(c+1),y.push(e,t,i),y.push(s,i,t);1!==A&&E&&(y.push(e+2,t+2,i+2),y.push(s+2,i+2,t+2),y.push(e+4,t+4,i+4),y.push(s+4,i+4,t+4)),d=T?d+2:d+1}let W=e=>{let t,i,r;let n=e?_/2:g/2;if(0===n)return;let a=e?I[M-1]:I[0],o=null;v&&(o=e?v[M-1]:v[0]);let l=R.length/3,u=e?p/2:-p/2,d=new s.P(0,u,0);R.push(d.x,d.y,d.z),S.push(0,e?1:-1,0);let c=a.y+(a.w-a.y)*.5;C.push(a.x+(a.z-a.x)*.5,h.VJ?1-c:c),o&&O.push(o.r,o.g,o.b,o.a);let f=new s.FM(.5,.5);for(r=0;r<=x;r++){let l=Math.cos(-(t=2*Math.PI*r*A/x)),d=Math.sin(-t);i=new s.P(l*n,u,d*n);let c=new s.FM(l*f.x+.5,d*f.y+.5);R.push(i.x,i.y,i.z),S.push(0,e?1:-1,0);let p=a.y+(a.w-a.y)*c.y;C.push(a.x+(a.z-a.x)*c.x,h.VJ?1-p:p),o&&O.push(o.r,o.g,o.b,o.a)}for(r=0;r<x;r++)e?(y.push(l),y.push(l+(r+2)),y.push(l+(r+1))):(y.push(l),y.push(l+(r+1)),y.push(l+(r+2)))};(b===n.Kj.CAP_START||b===n.Kj.CAP_ALL)&&W(!1),(b===n.Kj.CAP_END||b===n.Kj.CAP_ALL)&&W(!0),a.x._ComputeSides(P,R,y,S,C,e.frontUVs,e.backUVs);let H=new a.x;return H.indices=y,H.positions=R,H.normals=S,H.uvs=C,v&&(H.colors=O),H}function d(e,t={},i){let s=new n.Kj(e,i);return t.sideOrientation=n.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,u(t).applyToMesh(s,t.updatable),s}a.x.CreateCylinder=u,n.Kj.CreateCylinder=(e,t,i,s,r,a,l,h,u)=>(void 0!==l&&l instanceof o.x||(void 0!==l&&(u=h||n.Kj.DEFAULTSIDE,h=l),l=a,a=1),d(e,{height:t,diameterTop:i,diameterBottom:s,tessellation:r,subdivisions:a,sideOrientation:u,updatable:h},l))},16:function(e,t,i){i.d(t,{t:function(){return g}});var s=i(39884),r=i(65330),n=i(35823),a=i(93954),o=i(89754),l=i(77210);let h=new s.P(1,0,0),u=new s.P(-1,0,0),d=new s.P(0,1,0),c=new s.P(0,-1,0),f=new s.P(0,0,1),p=new s.P(0,0,-1);class _{constructor(e=s.P.Zero(),t=s.P.Up(),i=s.FM.Zero(),r=0,n=0,a=null,o=null,l=null,h=null){this.position=e,this.normal=t,this.uv=i,this.vertexIdx=r,this.vertexIdxForBones=n,this.localPositionOverride=a,this.localNormalOverride=o,this.matrixIndicesOverride=l,this.matrixWeightsOverride=h}clone(){return new _(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,this.localPositionOverride?.slice(),this.localNormalOverride?.slice(),this.matrixIndicesOverride?.slice(),this.matrixWeightsOverride?.slice())}}function g(e,t,i){let g=!!t.skeleton,x=i.localMode||g,m=t.getIndices(),T=g?t.getPositionData(!0,!0):t.getVerticesData(a.o.PositionKind),E=g?t.getNormalsData(!0,!0):t.getVerticesData(a.o.NormalKind),b=x?g?t.getVerticesData(a.o.PositionKind):T:null,A=x?g?t.getVerticesData(a.o.NormalKind):E:null,P=t.getVerticesData(a.o.UVKind),I=g?t.getVerticesData(a.o.MatricesIndicesKind):null,v=g?t.getVerticesData(a.o.MatricesWeightsKind):null,M=g?t.getVerticesData(a.o.MatricesIndicesExtraKind):null,y=g?t.getVerticesData(a.o.MatricesWeightsExtraKind):null,R=i.position||s.P.Zero(),S=i.normal||s.P.Up(),C=i.size||s.P.One(),O=i.angle||0;if(!S){let e=new s.P(0,0,1),i=t.getScene().activeCamera,r=s.P.TransformCoordinates(e,i.getWorldMatrix());S=i.globalPosition.subtract(r)}let L=-Math.atan2(S.z,S.x)-Math.PI/2,D=Math.sqrt(S.x*S.x+S.z*S.z),F=Math.atan2(S.y,D),B=new o.x;B.indices=[],B.positions=[],B.normals=[],B.uvs=[],B.matricesIndices=g?[]:null,B.matricesWeights=g?[]:null,B.matricesIndicesExtra=M?[]:null,B.matricesWeightsExtra=y?[]:null;let w=0,N=(e,t)=>{let r=new _;if(!m||!T||!E)return r;let n=m[e];if(r.vertexIdx=3*n,r.vertexIdxForBones=4*n,r.position=new s.P(T[3*n],T[3*n+1],T[3*n+2]),s.P.TransformCoordinatesToRef(r.position,t,r.position),r.normal=new s.P(E[3*n],E[3*n+1],E[3*n+2]),s.P.TransformNormalToRef(r.normal,t,r.normal),i.captureUVS&&P){let e=P[2*n+1];r.uv=new s.FM(P[2*n],l.VJ?1-e:e)}return r},U=[0,0,0,0],z=(e,t)=>{if(0===e.length)return e;let i=.5*Math.abs(s.P.Dot(C,t)),n=(e,t,i,s)=>{for(let r=0;r<s;++r)if(e[i+r]===t)return i+r;return -1},a=(e,a)=>{let o=s.P.GetClipFactor(e.position,a.position,t,i),l=U,h=U;if(I&&v){let t=e.matrixIndicesOverride?0:e.vertexIdxForBones,i=e.matrixIndicesOverride??I,s=e.matrixWeightsOverride??v,u=a.matrixIndicesOverride?0:a.vertexIdxForBones,d=a.matrixIndicesOverride??I,c=a.matrixWeightsOverride??v;l=[0,0,0,0],h=[0,0,0,0];let f=0;for(let e=0;e<4;++e)if(s[t+e]>0){let a=n(d,i[t+e],u,4);l[f]=i[t+e],h[f]=(0,r.Lerp)(s[t+e],a>=0?c[a]:0,o),f++}for(let e=0;e<4&&f<4;++e){let s=d[u+e];-1===n(i,s,t,4)&&(l[f]=s,h[f]=(0,r.Lerp)(0,c[u+e],o),f++)}let p=h[0]+h[1]+h[2]+h[3];h[0]/=p,h[1]/=p,h[2]/=p,h[3]/=p}let u=e.localPositionOverride?e.localPositionOverride[0]:b?.[e.vertexIdx]??0,d=e.localPositionOverride?e.localPositionOverride[1]:b?.[e.vertexIdx+1]??0,c=e.localPositionOverride?e.localPositionOverride[2]:b?.[e.vertexIdx+2]??0,f=a.localPositionOverride?a.localPositionOverride[0]:b?.[a.vertexIdx]??0,p=a.localPositionOverride?a.localPositionOverride[1]:b?.[a.vertexIdx+1]??0,g=a.localPositionOverride?a.localPositionOverride[2]:b?.[a.vertexIdx+2]??0,x=e.localNormalOverride?e.localNormalOverride[0]:A?.[e.vertexIdx]??0,m=e.localNormalOverride?e.localNormalOverride[1]:A?.[e.vertexIdx+1]??0,T=e.localNormalOverride?e.localNormalOverride[2]:A?.[e.vertexIdx+2]??0,E=a.localNormalOverride?a.localNormalOverride[0]:A?.[a.vertexIdx]??0,P=a.localNormalOverride?a.localNormalOverride[1]:A?.[a.vertexIdx+1]??0,M=a.localNormalOverride?a.localNormalOverride[2]:A?.[a.vertexIdx+2]??0,y=x+(E-x)*o,R=m+(P-m)*o,S=T+(M-T)*o,C=Math.sqrt(y*y+R*R+S*S);return new _(s.P.Lerp(e.position,a.position,o),s.P.Lerp(e.normal,a.normal,o).normalize(),s.FM.Lerp(e.uv,a.uv,o),-1,-1,b?[u+(f-u)*o,d+(p-d)*o,c+(g-c)*o]:null,A?[y/C,R/C,S/C]:null,l,h)},o=null;e.length>3&&(o=[]);for(let r=0;r<e.length;r+=3){let n=null,l=null,h=null,u=null,d=s.P.Dot(e[r].position,t)-i,c=s.P.Dot(e[r+1].position,t)-i,f=s.P.Dot(e[r+2].position,t)-i,p=d>0,_=c>0,g=f>0;switch((p?1:0)+(_?1:0)+(g?1:0)){case 0:e.length>3?(o.push(e[r]),o.push(e[r+1]),o.push(e[r+2])):o=e;break;case 1:if(o=o??[],p&&(n=e[r+1],l=e[r+2],h=a(e[r],n),u=a(e[r],l)),_){n=e[r],l=e[r+2],h=a(e[r+1],n),u=a(e[r+1],l),o.push(h),o.push(l.clone()),o.push(n.clone()),o.push(l.clone()),o.push(h.clone()),o.push(u);break}g&&(n=e[r],l=e[r+1],h=a(e[r+2],n),u=a(e[r+2],l)),n&&l&&h&&u&&(o.push(n.clone()),o.push(l.clone()),o.push(h),o.push(u),o.push(h.clone()),o.push(l.clone()));break;case 2:o=o??[],p||(l=a(n=e[r].clone(),e[r+1]),h=a(n,e[r+2]),o.push(n),o.push(l),o.push(h)),_||(l=a(n=e[r+1].clone(),e[r+2]),h=a(n,e[r]),o.push(n),o.push(l),o.push(h)),g||(l=a(n=e[r+2].clone(),e[r]),h=a(n,e[r+1]),o.push(n),o.push(l),o.push(h))}}return o},V=t instanceof n.Kj?t:null,k=V?._thinInstanceDataStorage.matrixData,K=V?.thinInstanceCount||1,j=s.jp.Matrix[0];j.copyFrom(s.y3.IdentityReadOnly);for(let e=0;e<K;++e){if(V?.hasThinInstances&&k){let t=16*e;j.setRowFromFloats(0,k[t+0],k[t+1],k[t+2],k[t+3]),j.setRowFromFloats(1,k[t+4],k[t+5],k[t+6],k[t+7]),j.setRowFromFloats(2,k[t+8],k[t+9],k[t+10],k[t+11]),j.setRowFromFloats(3,k[t+12],k[t+13],k[t+14],k[t+15])}let r=s.y3.RotationYawPitchRoll(L,F,O).multiply(s.y3.Translation(R.x,R.y,R.z)),n=s.y3.Invert(r),a=t.getWorldMatrix(),o=j.multiply(a).multiply(n),_=[,,,];for(let e=0;e<m.length;e+=3){let t=_;if(t[0]=N(e,o),t[1]=N(e+1,o),t[2]=N(e+2,o),!(i.cullBackFaces&&0>=-t[0].normal.z&&0>=-t[1].normal.z&&0>=-t[2].normal.z)&&(t=z(t,h))&&(t=z(t,u))&&(t=z(t,d))&&(t=z(t,c))&&(t=z(t,f))&&(t=z(t,p)))for(let e=0;e<t.length;e++){let s=t[e];if(B.indices.push(w),x?(s.localPositionOverride?(B.positions[3*w]=s.localPositionOverride[0],B.positions[3*w+1]=s.localPositionOverride[1],B.positions[3*w+2]=s.localPositionOverride[2]):b&&(B.positions[3*w]=b[s.vertexIdx],B.positions[3*w+1]=b[s.vertexIdx+1],B.positions[3*w+2]=b[s.vertexIdx+2]),s.localNormalOverride?(B.normals[3*w]=s.localNormalOverride[0],B.normals[3*w+1]=s.localNormalOverride[1],B.normals[3*w+2]=s.localNormalOverride[2]):A&&(B.normals[3*w]=A[s.vertexIdx],B.normals[3*w+1]=A[s.vertexIdx+1],B.normals[3*w+2]=A[s.vertexIdx+2])):(s.position.toArray(B.positions,3*w),s.normal.toArray(B.normals,3*w)),B.matricesIndices&&B.matricesWeights&&(s.matrixIndicesOverride?(B.matricesIndices[4*w]=s.matrixIndicesOverride[0],B.matricesIndices[4*w+1]=s.matrixIndicesOverride[1],B.matricesIndices[4*w+2]=s.matrixIndicesOverride[2],B.matricesIndices[4*w+3]=s.matrixIndicesOverride[3]):(I&&(B.matricesIndices[4*w]=I[s.vertexIdxForBones],B.matricesIndices[4*w+1]=I[s.vertexIdxForBones+1],B.matricesIndices[4*w+2]=I[s.vertexIdxForBones+2],B.matricesIndices[4*w+3]=I[s.vertexIdxForBones+3]),M&&B.matricesIndicesExtra&&(B.matricesIndicesExtra[4*w]=M[s.vertexIdxForBones],B.matricesIndicesExtra[4*w+1]=M[s.vertexIdxForBones+1],B.matricesIndicesExtra[4*w+2]=M[s.vertexIdxForBones+2],B.matricesIndicesExtra[4*w+3]=M[s.vertexIdxForBones+3])),s.matrixWeightsOverride?(B.matricesWeights[4*w]=s.matrixWeightsOverride[0],B.matricesWeights[4*w+1]=s.matrixWeightsOverride[1],B.matricesWeights[4*w+2]=s.matrixWeightsOverride[2],B.matricesWeights[4*w+3]=s.matrixWeightsOverride[3]):(v&&(B.matricesWeights[4*w]=v[s.vertexIdxForBones],B.matricesWeights[4*w+1]=v[s.vertexIdxForBones+1],B.matricesWeights[4*w+2]=v[s.vertexIdxForBones+2],B.matricesWeights[4*w+3]=v[s.vertexIdxForBones+3]),y&&B.matricesWeightsExtra&&(B.matricesWeightsExtra[4*w]=y[s.vertexIdxForBones],B.matricesWeightsExtra[4*w+1]=y[s.vertexIdxForBones+1],B.matricesWeightsExtra[4*w+2]=y[s.vertexIdxForBones+2],B.matricesWeightsExtra[4*w+3]=y[s.vertexIdxForBones+3]))),i.captureUVS)s.uv.toArray(B.uvs,2*w);else{B.uvs.push(.5+s.position.x/C.x);let e=.5+s.position.y/C.y;B.uvs.push(l.VJ?1-e:e)}w++}}}0===B.indices.length&&(B.indices=null),0===B.positions.length&&(B.positions=null),0===B.normals.length&&(B.normals=null),0===B.uvs.length&&(B.uvs=null),B.matricesIndices?.length===0&&(B.matricesIndices=null),B.matricesWeights?.length===0&&(B.matricesWeights=null),B.matricesIndicesExtra?.length===0&&(B.matricesIndicesExtra=null),B.matricesWeightsExtra?.length===0&&(B.matricesWeightsExtra=null);let G=new n.Kj(e,t.getScene());return B.applyToMesh(G),x?(G.skeleton=t.skeleton,G.parent=t):(G.position=R.clone(),G.rotation=new s.P(F,L,O)),G.computeWorldMatrix(!0),G.refreshBoundingInfo(!0,!0),G}n.Kj.CreateDecal=(e,t,i,s,r,n)=>g(e,t,{position:i,normal:s,size:r,angle:n})},21947:function(e,t,i){i.d(t,{uH:function(){return o},vM:function(){return a}});var s=i(35823),r=i(89754),n=i(77210);function a(e){let t=[],i=[],s=[],a=[],o=e.radius||.5,l=e.tessellation||64,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,u=0===e.sideOrientation?0:e.sideOrientation||r.x.DEFAULTSIDE;t.push(0,0,0),a.push(.5,.5);let d=2*Math.PI*h,c=1===h?d/l:d/(l-1),f=0;for(let e=0;e<l;e++){let e=Math.cos(f),i=Math.sin(f),s=(e+1)/2,r=(1-i)/2;t.push(o*e,o*i,0),a.push(s,n.VJ?1-r:r),f+=c}1===h&&(t.push(t[3],t[4],t[5]),a.push(a[2],n.VJ?1-a[3]:a[3]));let p=t.length/3;for(let e=1;e<p-1;e++)i.push(e+1,0,e);r.x.ComputeNormals(t,i,s),r.x._ComputeSides(u,t,i,s,a,e.frontUVs,e.backUVs);let _=new r.x;return _.indices=i,_.positions=t,_.normals=s,_.uvs=a,_}function o(e,t={},i=null){let r=new s.Kj(e,i);return t.sideOrientation=s.Kj._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,a(t).applyToMesh(r,t.updatable),r}r.x.CreateDisc=a,s.Kj.CreateDisc=(e,t,i,s=null,r,n)=>o(e,{radius:t,tessellation:i,sideOrientation:n,updatable:r},s)},21568:function(e,t,i){i.d(t,{M:function(){return a}});var s=i(617),r=i(9719),n=i(21716);function a(e,t,i=null){let a=t.m||1;a!==Math.floor(a)&&(a=Math.floor(a),r.Y.Warn("m not an integer only floor(m) used"));let o=t.n||0;if(o!==Math.floor(o)&&(o=Math.floor(o),r.Y.Warn("n not an integer only floor(n) used")),o>a){let e=o;o=a,a=e,r.Y.Warn("n > m therefore m and n swapped")}let l=new n.Bn;l.build(a,o);let h={custom:n.zz.BuildGeodesicData(l),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs};return(0,s.sh)(e,h,i)}},66589:function(e,t,i){i.d(t,{_:function(){return d}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(9719),l=i(21716),h=i(98317),u=i(77210);function d(e,t,i=null){let d=t.size,c=t.sizeX||d||1,f=t.sizeY||d||1,p=t.sizeZ||d||1,_=t.m||1;_!==Math.floor(_)&&(_=Math.floor(_),o.Y.Warn("m not an integer only floor(m) used"));let g=t.n||0;if(g!==Math.floor(g)&&(g=Math.floor(g),o.Y.Warn("n not an integer only floor(n) used")),g>_){let e=g;g=_,_=e,o.Y.Warn("n > m therefore m and n swapped")}let x=new l.Bn;x.build(_,g);let m=l.zz.BuildGeodesicData(x),T=m.toGoldbergPolyhedronData(),E=new h.R(e,i);t.sideOrientation=n.Kj._GetDefaultSideOrientation(t.sideOrientation),E._originalBuilderSideOrientation=t.sideOrientation,(function(e,t){let i=e.size,r=e.sizeX||i||1,n=e.sizeY||i||1,o=e.sizeZ||i||1,l=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,h=[],d=[],c=[],f=[],p=1/0,_=-1/0,g=1/0,x=-1/0;for(let e=0;e<t.vertex.length;e++)p=Math.min(p,t.vertex[e][0]*r),_=Math.max(_,t.vertex[e][0]*r),g=Math.min(g,t.vertex[e][1]*n),x=Math.max(x,t.vertex[e][1]*n);let m=0;for(let e=0;e<t.face.length;e++){let i=t.face[e],a=s.P.FromArray(t.vertex[i[0]]),l=s.P.FromArray(t.vertex[i[2]]),T=s.P.FromArray(t.vertex[i[1]]),E=l.subtract(a),b=T.subtract(a),A=s.P.Cross(b,E).normalize();for(let e=0;e<i.length;e++){c.push(A.x,A.y,A.z);let s=t.vertex[i[e]];h.push(s[0]*r,s[1]*n,s[2]*o);let a=(s[1]*n-g)/(x-g);f.push((s[0]*r-p)/(_-p),u.VJ?1-a:a)}for(let e=0;e<i.length-2;e++)d.push(m,m+e+2,m+e+1);m+=i.length}a.x._ComputeSides(l,h,d,c,f);let T=new a.x;return T.positions=h,T.indices=d,T.normals=c,T.uvs=f,T})(t,T).applyToMesh(E,t.updatable),E.goldbergData.nbSharedFaces=m.sharedNodes,E.goldbergData.nbUnsharedFaces=m.poleNodes,E.goldbergData.adjacentFaces=m.adjacentFaces,E.goldbergData.nbFaces=E.goldbergData.nbSharedFaces+E.goldbergData.nbUnsharedFaces,E.goldbergData.nbFacesAtPole=(E.goldbergData.nbUnsharedFaces-12)/12;for(let e=0;e<m.vertex.length;e++)E.goldbergData.faceCenters.push(s.P.FromArray(m.vertex[e])),E.goldbergData.faceCenters[e].x*=c,E.goldbergData.faceCenters[e].y*=f,E.goldbergData.faceCenters[e].z*=p,E.goldbergData.faceColors.push(new r.HE(1,1,1,1));for(let e=0;e<T.face.length;e++){let t=T.face[e],i=s.P.FromArray(T.vertex[t[0]]),r=s.P.FromArray(T.vertex[t[2]]),n=s.P.FromArray(T.vertex[t[1]]),a=r.subtract(i),o=n.subtract(i),l=s.P.Cross(o,a).normalize(),h=s.P.Cross(o,l).normalize();E.goldbergData.faceXaxis.push(o.normalize()),E.goldbergData.faceYaxis.push(l),E.goldbergData.faceZaxis.push(h)}return E}},96366:function(e,t,i){i.d(t,{$6:function(){return _},DG:function(){return g},W:function(){return x},kt:function(){return c}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(33416),l=i(4224),h=i(51092),u=i(31644),d=i(77210);function c(e){let t,i;let r=[],n=[],o=[],l=[],h=e.width||e.size||1,u=e.height||e.size||1,c=0|(e.subdivisionsX||e.subdivisions||1),f=0|(e.subdivisionsY||e.subdivisions||1);for(t=0;t<=f;t++)for(i=0;i<=c;i++){let e=new s.P(i*h/c-h/2,0,(f-t)*u/f-u/2),r=new s.P(0,1,0);n.push(e.x,e.y,e.z),o.push(r.x,r.y,r.z),l.push(i/c,d.VJ?t/f:1-t/f)}for(t=0;t<f;t++)for(i=0;i<c;i++)r.push(i+1+(t+1)*(c+1)),r.push(i+1+t*(c+1)),r.push(i+t*(c+1)),r.push(i+(t+1)*(c+1)),r.push(i+1+(t+1)*(c+1)),r.push(i+t*(c+1));let p=new a.x;return p.indices=r,p.positions=n,p.normals=o,p.uvs=l,p}function f(e){let t,i,r,n;let o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,l=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,h=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,u=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,d=e.subdivisions||{w:1,h:1},c=e.precision||{w:1,h:1},f=[],p=[],_=[],g=[];d.h=d.h<1?1:d.h,d.w=d.w<1?1:d.w,c.w=c.w<1?1:c.w,c.h=c.h<1?1:c.h;let x={w:(h-o)/d.w,h:(u-l)/d.h};for(r=0;r<d.h;r++)for(n=0;n<d.w;n++)!function(e,r,n,a){let o=p.length/3,l=c.w+1;for(t=0;t<c.h;t++)for(i=0;i<c.w;i++){let e=[o+i+t*l,o+(i+1)+t*l,o+(i+1)+(t+1)*l,o+i+(t+1)*l];f.push(e[1]),f.push(e[2]),f.push(e[3]),f.push(e[0]),f.push(e[1]),f.push(e[3])}let h=s.P.Zero(),u=new s.P(0,1,0);for(t=0;t<=c.h;t++)for(i=0,h.z=t*(a-r)/c.h+r;i<=c.w;i++)h.x=i*(n-e)/c.w+e,h.y=0,p.push(h.x,h.y,h.z),_.push(u.x,u.y,u.z),g.push(i/c.w,t/c.h)}(o+n*x.w,l+r*x.h,o+(n+1)*x.w,l+(r+1)*x.h);let m=new a.x;return m.indices=f,m.positions=p,m.normals=_,m.uvs=g,m}function p(e){let t,i;let n=[],o=[],l=[],h=[],d=e.colorFilter||new r.Wo(.3,.59,.11),c=e.alphaFilter||0,f=!1;if(e.minHeight>e.maxHeight){f=!0;let t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(t=0;t<=e.subdivisions;t++)for(i=0;i<=e.subdivisions;i++){let r=new s.P(i*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),n=(((r.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(r.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth)*4,a=e.buffer[n]/255,p=e.buffer[n+1]/255,_=e.buffer[n+2]/255,g=e.buffer[n+3]/255;f&&(a=1-a,p=1-p,_=1-_);let x=a*d.r+p*d.g+_*d.b;g>=c?r.y=e.minHeight+(e.maxHeight-e.minHeight)*x:r.y=e.minHeight-u.kn,e.heightBuffer&&(e.heightBuffer[t*(e.subdivisions+1)+i]=r.y),o.push(r.x,r.y,r.z),l.push(0,0,0),h.push(i/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(i=0;i<e.subdivisions;i++){let s=i+1+(t+1)*(e.subdivisions+1),r=i+1+t*(e.subdivisions+1),a=i+t*(e.subdivisions+1),l=i+(t+1)*(e.subdivisions+1),h=o[3*s+1]>=e.minHeight,u=o[3*r+1]>=e.minHeight,d=o[3*a+1]>=e.minHeight;h&&u&&d&&(n.push(s),n.push(r),n.push(a)),o[3*l+1]>=e.minHeight&&h&&d&&(n.push(l),n.push(s),n.push(a))}a.x.ComputeNormals(o,n,l);let p=new a.x;return p.indices=n,p.positions=o,p.normals=l,p.uvs=h,p}function _(e,t={},i){let s=new o.E(e,i);return s._setReady(!1),s._subdivisionsX=t.subdivisionsX||t.subdivisions||1,s._subdivisionsY=t.subdivisionsY||t.subdivisions||1,s._width=t.width||1,s._height=t.height||1,s._maxX=s._width/2,s._maxZ=s._height/2,s._minX=-s._maxX,s._minZ=-s._maxZ,c(t).applyToMesh(s,t.updatable),s._setReady(!0),s}function g(e,t,i=null){let s=new n.Kj(e,i);return f(t).applyToMesh(s,t.updatable),s}function x(e,t,i={},s=null){let n;let a=i.width||10,u=i.height||10,d=i.subdivisions||1,c=i.minHeight||0,f=i.maxHeight||1,_=i.colorFilter||new r.Wo(.3,.59,.11),g=i.alphaFilter||0,x=i.updatable,m=i.onReady;s=s||h.l.LastCreatedScene;let T=new o.E(e,s);T._subdivisionsX=d,T._subdivisionsY=d,T._width=a,T._height=u,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ,T._setReady(!1),i.passHeightBufferInCallback&&(n=new Float32Array((d+1)*(d+1)));let E=(e,t,i)=>{p({width:a,height:u,subdivisions:d,minHeight:c,maxHeight:f,colorFilter:_,buffer:e,bufferWidth:t,bufferHeight:i,alphaFilter:g,heightBuffer:n}).applyToMesh(T,x),m&&m(T,n),T._setReady(!0)};return"string"==typeof t?l.w1.LoadImage(t,e=>{let t=e.width,i=e.height;s.isDisposed||E(s?.getEngine().resizeImageBitmap(e,t,i),t,i)},i.onError?i.onError:()=>{},s.offlineProvider):E(t.data,t.width,t.height),T}a.x.CreateGround=c,a.x.CreateTiledGround=f,a.x.CreateGroundFromHeightMap=p,n.Kj.CreateGround=(e,t,i,s,r,n)=>_(e,{width:t,height:i,subdivisions:s,updatable:n},r),n.Kj.CreateTiledGround=(e,t,i,s,r,n,a,o,l)=>g(e,{xmin:t,zmin:i,xmax:s,zmax:r,subdivisions:n,precision:a,updatable:l},o),n.Kj.CreateGroundFromHeightMap=(e,t,i,s,r,n,a,o,l,h,u)=>x(e,t,{width:i,height:s,subdivisions:r,minHeight:n,maxHeight:a,updatable:l,onReady:h,alphaFilter:u},o)},62317:function(e,t,i){i.d(t,{Au:function(){return l},GQ:function(){return o}});var s=i(39884),r=i(35823),n=i(89754),a=i(77210);function o(e){let t;let i=e.sideOrientation||n.x.DEFAULTSIDE,r=e.radius||1,o=void 0===e.flat||e.flat,l=0|(e.subdivisions||4),h=e.radiusX||r,u=e.radiusY||r,d=e.radiusZ||r,c=(1+Math.sqrt(5))/2,f=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1],p=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],_=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],g=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],x=138/1024,m=239/1024,T=60/1024,E=26/1024,b=-40/1024,A=20/1024,P=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],I=[],v=[],M=[],y=[],R=0,S=[,,,],C=[,,,];for(t=0;t<3;t++)S[t]=s.P.Zero(),C[t]=s.FM.Zero();for(let e=0;e<20;e++){for(t=0;t<3;t++){let i=p[3*e+t];S[t].copyFromFloats(f[3*_[i]],f[3*_[i]+1],f[3*_[i]+2]),S[t].normalize(),C[t].copyFromFloats(g[2*i]*x+T+P[e]*b,g[2*i+1]*m+E+P[e]*A)}let i=(e,t,i,r)=>{let n;let c=s.P.Lerp(S[0],S[2],t/l),f=s.P.Lerp(S[1],S[2],t/l),p=l===t?S[2]:s.P.Lerp(c,f,e/(l-t));if(p.normalize(),o){let e=s.P.Lerp(S[0],S[2],r/l),t=s.P.Lerp(S[1],S[2],r/l);n=s.P.Lerp(e,t,i/(l-r))}else n=new s.P(p.x,p.y,p.z);n.x/=h,n.y/=u,n.z/=d,n.normalize();let _=s.FM.Lerp(C[0],C[2],t/l),g=s.FM.Lerp(C[1],C[2],t/l),x=l===t?C[2]:s.FM.Lerp(_,g,e/(l-t));v.push(p.x*h,p.y*u,p.z*d),M.push(n.x,n.y,n.z),y.push(x.x,a.VJ?1-x.y:x.y),I.push(R),R++};for(let e=0;e<l;e++)for(let t=0;t+e<l;t++)i(t,e,t+1/3,e+1/3),i(t+1,e,t+1/3,e+1/3),i(t,e+1,t+1/3,e+1/3),t+e+1<l&&(i(t+1,e,t+2/3,e+2/3),i(t+1,e+1,t+2/3,e+2/3),i(t,e+1,t+2/3,e+2/3))}n.x._ComputeSides(i,v,I,M,y,e.frontUVs,e.backUVs);let O=new n.x;return O.indices=I,O.positions=v,O.normals=M,O.uvs=y,O}function l(e,t={},i=null){let s=new r.Kj(e,i);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,o(t).applyToMesh(s,t.updatable),s}n.x.CreateIcoSphere=o,r.Kj.CreateIcoSphere=(e,t,i)=>l(e,t,i)},27283:function(e,t,i){i.d(t,{O:function(){return a}});var s=i(39884),r=i(35823),n=i(57813);function a(e,t,i=null){let a,o;let l=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,h=void 0===t.closed||t.closed,u=t.shape,d=t.radius||1,c=t.tessellation||64,f=t.clip||0,p=t.updatable,_=r.Kj._GetDefaultSideOrientation(t.sideOrientation),g=t.cap||r.Kj.NO_CAP,x=[],m=t.invertUV||!1,T=0,E=0,b=2*Math.PI/c*l;for(T=0;T<=c-f;T++){for(o=[],(g==r.Kj.CAP_START||g==r.Kj.CAP_ALL)&&(o.push(new s.P(0,u[0].y,0)),o.push(new s.P(Math.cos(T*b)*u[0].x*d,u[0].y,Math.sin(T*b)*u[0].x*d))),E=0;E<u.length;E++)a=new s.P(Math.cos(T*b)*u[E].x*d,u[E].y,Math.sin(T*b)*u[E].x*d),o.push(a);(g==r.Kj.CAP_END||g==r.Kj.CAP_ALL)&&(o.push(new s.P(Math.cos(T*b)*u[u.length-1].x*d,u[u.length-1].y,Math.sin(T*b)*u[u.length-1].x*d)),o.push(new s.P(0,u[u.length-1].y,0))),x.push(o)}return(0,n.LY)(e,{pathArray:x,closeArray:h,sideOrientation:_,updatable:p,invertUV:m,frontUVs:t.frontUVs,backUVs:t.backUVs},i)}r.Kj.CreateLathe=(e,t,i,s,r,n,o)=>a(e,{shape:t,radius:i,tessellation:s,sideOrientation:o,updatable:n},r)},23596:function(e,t,i){i.d(t,{Gz:function(){return f},nL:function(){return c},xW:function(){return d}});var s=i(39884),r=i(35823),n=i(89754),a=i(63548),o=i(93954),l=i(9719);function h(e){let t=[],i=[],s=e.lines,r=e.colors,a=[],o=0;for(let e=0;e<s.length;e++){let n=s[e];for(let s=0;s<n.length;s++){let{x:l,y:h,z:u}=n[s];if(i.push(l,h,u),r){let{r:t,g:i,b:n,a:o}=r[e][s];a.push(t,i,n,o)}s>0&&(t.push(o-1),t.push(o)),o++}}let l=new n.x;return l.indices=t,l.positions=i,r&&(l.colors=a),l}function u(e){let t=e.dashSize||3,i=e.gapSize||1,r=e.dashNb||200,a=e.points,o=[],l=[],h=s.P.Zero(),u=0,d=0,c=0,f=0,p=0,_=0,g=0;for(g=0;g<a.length-1;g++)a[g+1].subtractToRef(a[g],h),u+=h.length();for(g=0,f=t*(c=u/r)/(t+i);g<a.length-1;g++){a[g+1].subtractToRef(a[g],h),d=Math.floor(h.length()/c),h.normalize();for(let e=0;e<d;e++)p=c*e,o.push(a[g].x+p*h.x,a[g].y+p*h.y,a[g].z+p*h.z),o.push(a[g].x+(p+f)*h.x,a[g].y+(p+f)*h.y,a[g].z+(p+f)*h.z),l.push(_,_+1),_+=2}let x=new n.x;return x.positions=o,x.indices=l,x}function d(e,t,i=null){let s=t.instance,r=t.lines,n=t.colors;if(s){let e,t;let i=s.getVerticesData(o.o.PositionKind);n&&(e=s.getVerticesData(o.o.ColorKind));let a=0,l=0;for(let s=0;s<r.length;s++){let o=r[s];for(let r=0;r<o.length;r++)i[a]=o[r].x,i[a+1]=o[r].y,i[a+2]=o[r].z,n&&e&&(t=n[s],e[l]=t[r].r,e[l+1]=t[r].g,e[l+2]=t[r].b,e[l+3]=t[r].a,l+=4),a+=3}return s.updateVerticesData(o.o.PositionKind,i,!1,!1),n&&e&&s.updateVerticesData(o.o.ColorKind,e,!1,!1),s.refreshBoundingInfo(),s}let l=new a._(e,i,null,void 0,void 0,!!n,t.useVertexAlpha,t.material);return h(t).applyToMesh(l,t.updatable),l}function c(e,t,i=null){let s=t.colors?[t.colors]:null;return d(e,{lines:[t.points],updatable:t.updatable,instance:t.instance,colors:s,useVertexAlpha:t.useVertexAlpha,material:t.material},i)}function f(e,t,i=null){let n=t.points,o=t.instance,h=t.gapSize||1,d=t.dashSize||3;if(o)return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&l.Y.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),o.updateMeshPositions(e=>{let t=s.P.Zero(),i=e.length/6,r=0,a=0,l=0,h=0,u=0,d=0,c=0,f=0;for(c=0;c<n.length-1;c++)n[c+1].subtractToRef(n[c],t),r+=t.length();l=r/i;let p=o._creationDataStorage.dashSize;for(c=0,h=p*l/(p+o._creationDataStorage.gapSize);c<n.length-1;c++)for(n[c+1].subtractToRef(n[c],t),a=Math.floor(t.length()/l),t.normalize(),f=0;f<a&&d<e.length;)u=l*f,e[d]=n[c].x+u*t.x,e[d+1]=n[c].y+u*t.y,e[d+2]=n[c].z+u*t.z,e[d+3]=n[c].x+(u+h)*t.x,e[d+4]=n[c].y+(u+h)*t.y,e[d+5]=n[c].z+(u+h)*t.z,d+=6,f++;for(;d<e.length;)e[d]=n[c].x,e[d+1]=n[c].y,e[d+2]=n[c].z,d+=3},!1),o;let c=new a._(e,i,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return u(t).applyToMesh(c,t.updatable),c._creationDataStorage=new r.gW,c._creationDataStorage.dashSize=d,c._creationDataStorage.gapSize=h,c}n.x.CreateLineSystem=h,n.x.CreateDashedLines=u,r.Kj.CreateLines=(e,t,i=null,s=!1,r=null)=>c(e,{points:t,updatable:s,instance:r},i),r.Kj.CreateDashedLines=(e,t,i,s,r,n=null,a,o)=>f(e,{points:t,dashSize:i,gapSize:s,dashNb:r,updatable:a,instance:o},n)},74591:function(e,t,i){i.d(t,{pT:function(){return o}});var s=i(35823),r=i(89754),n=i(77210);function a(e){let t=[],i=[],s=[],a=[],o=e.width||e.size||1,l=e.height||e.size||1,h=0===e.sideOrientation?0:e.sideOrientation||r.x.DEFAULTSIDE,u=o/2,d=l/2;i.push(-u,-d,0),s.push(0,0,-1),a.push(0,n.VJ?1:0),i.push(u,-d,0),s.push(0,0,-1),a.push(1,n.VJ?1:0),i.push(u,d,0),s.push(0,0,-1),a.push(1,n.VJ?0:1),i.push(-u,d,0),s.push(0,0,-1),a.push(0,n.VJ?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),r.x._ComputeSides(h,i,t,s,a,e.frontUVs,e.backUVs);let c=new r.x;return c.indices=t,c.positions=i,c.normals=s,c.uvs=a,c}function o(e,t={},i=null){let r=new s.Kj(e,i);return t.sideOrientation=s.Kj._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,a(t).applyToMesh(r,t.updatable),t.sourcePlane&&(r.translate(t.sourcePlane.normal,-t.sourcePlane.d),r.setDirection(t.sourcePlane.normal.scale(-1))),r}r.x.CreatePlane=a,s.Kj.CreatePlane=(e,t,i,s,r)=>o(e,{size:t,width:t,height:t,sideOrientation:r,updatable:s},i)},42257:function(e,t,i){i.d(t,{Yo:function(){return f},a4:function(){return c}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(4601),l=i(93954),h=i(51092),u=i(77210);function d(e,t,i,n,o,h,d){let c=i||[,,,],f=[],p=d||!1;for(let e=0;e<3;e++)void 0===c[e]&&(c[e]=new s.Lt(0,0,1,1)),n&&void 0===n[e]&&(n[e]=new r.HE(1,1,1,1));let _=e.getVerticesData(l.o.PositionKind),g=e.getVerticesData(l.o.NormalKind),x=e.getVerticesData(l.o.UVKind),m=e.getIndices(),T=_.length/9,E=0,b=0,A=0,P=0,I=[0];if(p)for(let e=T;e<_.length/3;e+=4)I.push(P+=Math.sqrt((b=_[3*(e+2)]-_[3*e])*b+(A=_[3*(e+2)+2]-_[3*e+2])*A));let v=0,M=0;for(let e=0;e<g.length;e+=3).001>Math.abs(g[e+1])&&(M=1),.001>Math.abs(g[e+1]-1)&&(M=0),.001>Math.abs(g[e+1]+1)&&(M=2),v=e/3,1===M?((E=v-T)%4<1.5?p?x[2*v]=c[M].x+(c[M].z-c[M].x)*I[Math.floor(E/4)]/P:x[2*v]=c[M].x:p?x[2*v]=c[M].x+(c[M].z-c[M].x)*I[Math.floor(E/4)+1]/P:x[2*v]=c[M].z,E%2==0?x[2*v+1]=u.VJ?1-c[M].w:c[M].w:x[2*v+1]=u.VJ?1-c[M].y:c[M].y):(x[2*v]=(1-x[2*v])*c[M].x+x[2*v]*c[M].z,x[2*v+1]=(1-x[2*v+1])*c[M].y+x[2*v+1]*c[M].w,u.VJ&&(x[2*v+1]=1-x[2*v+1])),n&&f.push(n[M].r,n[M].g,n[M].b,n[M].a);a.x._ComputeSides(t,_,m,g,x,o,h);let y=new a.x;if(y.indices=m,y.positions=_,y.normals=g,y.uvs=x,n){let e=t===a.x.DOUBLESIDE?f.concat(f):f;y.colors=e}return y}function c(e,t,i=null,r=earcut){t.sideOrientation=n.Kj._GetDefaultSideOrientation(t.sideOrientation);let a=t.shape,l=t.holes||[],u=t.depth||0,c=t.smoothingThreshold||2,f=[],p=[];for(let e=0;e<a.length;e++)f[e]=new s.FM(a[e].x,a[e].z);f[0].equalsWithEpsilon(f[f.length-1],1e-8)&&f.pop();let _=new o.z(e,f,i||h.l.LastCreatedScene,r);for(let e=0;e<l.length;e++){p=[];for(let t=0;t<l[e].length;t++)p.push(new s.FM(l[e][t].x,l[e][t].z));_.addHole(p)}let g=_.build(!1,u,c);return g._originalBuilderSideOrientation=t.sideOrientation,d(g,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(g,t.updatable),g}function f(e,t,i=null,s=earcut){return c(e,t,i,s)}a.x.CreatePolygon=d,n.Kj.CreatePolygon=(e,t,i,s,r,n,a=earcut)=>c(e,{shape:t,holes:s,updatable:r,sideOrientation:n},i,a),n.Kj.ExtrudePolygon=(e,t,i,s,r,n,a,o=earcut)=>f(e,{shape:t,holes:r,depth:i,updatable:n,sideOrientation:a},s,o)},617:function(e,t,i){i.d(t,{sh:function(){return h}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(77210);function l(e){let t,i,n,l,h,u;let d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};let c=e.type&&(e.type<0||e.type>=d.length)?0:e.type||0,f=e.size,p=e.sizeX||f||1,_=e.sizeY||f||1,g=e.sizeZ||f||1,x=e.custom||d[c],m=x.face.length,T=e.faceUV||Array(m),E=e.faceColors,b=void 0===e.flat||e.flat,A=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,P=[],I=[],v=[],M=[],y=[],R=0,S=0,C=[],O=0,L=0;if(b)for(L=0;L<m;L++)E&&void 0===E[L]&&(E[L]=new r.HE(1,1,1,1)),T&&void 0===T[L]&&(T[L]=new s.Lt(0,0,1,1));if(b)for(L=0;L<m;L++){let e=x.face[L].length;for(O=0,l=.5*Math.tan((n=2*Math.PI/e)/2),h=.5;O<e;O++)P.push(x.vertex[x.face[L][O]][0]*p,x.vertex[x.face[L][O]][1]*_,x.vertex[x.face[L][O]][2]*g),C.push(R),R++,t=T[L].x+(T[L].z-T[L].x)*(.5+l),i=T[L].y+(T[L].w-T[L].y)*(h-.5),M.push(t,o.VJ?1-i:i),u=l*Math.cos(n)-h*Math.sin(n),h=l*Math.sin(n)+h*Math.cos(n),l=u,E&&y.push(E[L].r,E[L].g,E[L].b,E[L].a);for(O=0;O<e-2;O++)I.push(C[0+S],C[O+2+S],C[O+1+S]);S+=e}else{for(O=0;O<x.vertex.length;O++)P.push(x.vertex[O][0]*p,x.vertex[O][1]*_,x.vertex[O][2]*g),M.push(0,o.VJ?1:0);for(L=0;L<m;L++)for(O=0;O<x.face[L].length-2;O++)I.push(x.face[L][0],x.face[L][O+2],x.face[L][O+1])}a.x.ComputeNormals(P,I,v),a.x._ComputeSides(A,P,I,v,M,e.frontUVs,e.backUVs);let D=new a.x;return D.positions=P,D.indices=I,D.normals=v,D.uvs=M,E&&b&&(D.colors=y),D}function h(e,t={},i=null){let s=new n.Kj(e,i);return t.sideOrientation=n.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,l(t).applyToMesh(s,t.updatable),s}a.x.CreatePolyhedron=l,n.Kj.CreatePolyhedron=(e,t,i)=>h(e,t,i)},57813:function(e,t,i){i.d(t,{LY:function(){return h}});var s=i(39884),r=i(35823),n=i(93954),a=i(89754),o=i(77210);function l(e){let t,i,s,r,l,h,u,d,c,f,p,_=e.pathArray,g=e.closeArray||!1,x=e.closePath||!1,m=e.invertUV||!1,T=Math.floor(_[0].length/2),E=e.offset||T;E=E>T?T:Math.floor(E);let b=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE,A=e.uvs,P=e.colors,I=[],v=[],M=[],y=[],R=[],S=[],C=[],O=[],L=[],D=[];if(_.length<2){let e=[],t=[];for(s=0;s<_[0].length-E;s++)e.push(_[0][s]),t.push(_[0][s+E]);_=[e,t]}let F=0,B=x?1:0,w=g?1:0;for(i=0,t=_[0].length;i<_.length+w;i++){for(C[i]=0,R[i]=[0],t=t<(h=(l=i===_.length?_[0]:_[i]).length)?t:h,r=0;r<h;)I.push(l[r].x,l[r].y,l[r].z),r>0&&(u=l[r].subtract(l[r-1]).length()+C[i],R[i].push(u),C[i]=u),r++;x&&(r--,I.push(l[0].x,l[0].y,l[0].z),u=l[r].subtract(l[0]).length()+C[i],R[i].push(u),C[i]=u),L[i]=h+B,D[i]=F,F+=h+B}let N=null,U=null;for(s=0;s<t+B;s++)for(i=0,O[s]=0,S[s]=[0];i<_.length-1+w;i++)d=_[i],c=i===_.length-1?_[0]:_[i+1],s===t?(N=d[0],U=c[0]):(N=d[s],U=c[s]),u=U.subtract(N).length()+O[s],S[s].push(u),O[s]=u;if(A)for(i=0;i<A.length;i++)y.push(A[i].x,o.VJ?1-A[i].y:A[i].y);else for(i=0;i<_.length+w;i++)for(s=0;s<t+B;s++)f=0!=C[i]?R[i][s]/C[i]:0,p=0!=O[s]?S[s][i]/O[s]:0,m?y.push(p,f):y.push(f,o.VJ?1-p:p);let z=0,V=L[i=0]-1,k=L[i+1]-1,K=V<k?V:k,j=D[1]-D[0],G=L.length-1;for(;z<=K&&i<G;)v.push(z,z+j,z+1),v.push(z+j+1,z+1,z+j),(z+=1)===K&&(j=D[++i+1]-D[i],V=L[i]-1,k=L[i+1]-1,z=D[i],K=V<k?V+z:k+z);if(a.x.ComputeNormals(I,v,M),x){let e=0,t=0;for(i=0;i<_.length;i++){e=3*D[i],t=i+1<_.length?(D[i+1]-1)*3:M.length-3,M[e]=(M[e]+M[t])*.5,M[e+1]=(M[e+1]+M[t+1])*.5,M[e+2]=(M[e+2]+M[t+2])*.5;let s=Math.sqrt(M[e]*M[e]+M[e+1]*M[e+1]+M[e+2]*M[e+2]);M[e]/=s,M[e+1]/=s,M[e+2]/=s,M[t]=M[e],M[t+1]=M[e+1],M[t+2]=M[e+2]}}if(g){let e=3*D[0],i=3*D[_.length];for(s=0;s<t+B;s++){M[e]=(M[e]+M[i])*.5,M[e+1]=(M[e+1]+M[i+1])*.5,M[e+2]=(M[e+2]+M[i+2])*.5;let t=Math.sqrt(M[e]*M[e]+M[e+1]*M[e+1]+M[e+2]*M[e+2]);M[e]/=t,M[e+1]/=t,M[e+2]/=t,M[i]=M[e],M[i+1]=M[e+1],M[i+2]=M[e+2],e+=3,i+=3}}a.x._ComputeSides(b,I,v,M,y,e.frontUVs,e.backUVs);let W=null;if(P){W=new Float32Array(4*P.length);for(let e=0;e<P.length;e++)W[4*e]=P[e].r,W[4*e+1]=P[e].g,W[4*e+2]=P[e].b,W[4*e+3]=P[e].a}let H=new a.x,X=new Float32Array(I),Y=new Float32Array(M),q=new Float32Array(y);return H.indices=v,H.positions=X,H.normals=Y,H.uvs=q,W&&H.set(W,n.o.ColorKind),x&&(H._idx=D),H}function h(e,t,i=null){let h=t.pathArray,u=t.closeArray,d=t.closePath,c=r.Kj._GetDefaultSideOrientation(t.sideOrientation),f=t.instance,p=t.updatable;if(f){let e=s.jp.Vector3[0].setAll(Number.MAX_VALUE),i=s.jp.Vector3[1].setAll(-Number.MAX_VALUE),l=f.getVerticesData(n.o.PositionKind);if((t=>{let s=h[0].length,n=0,a=f._originalBuilderSideOrientation===r.Kj.DOUBLESIDE?2:1;for(let r=1;r<=a;++r)for(let r=0;r<h.length;++r){let a=h[r],o=a.length;s=s<o?s:o;for(let r=0;r<s;++r){let s=a[r];t[n]=s.x,t[n+1]=s.y,t[n+2]=s.z,e.minimizeInPlaceFromFloats(s.x,s.y,s.z),i.maximizeInPlaceFromFloats(s.x,s.y,s.z),n+=3}if(f._creationDataStorage&&f._creationDataStorage.closePath){let e=a[0];t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z,n+=3}}})(l),f.hasBoundingInfo?f.getBoundingInfo().reConstruct(e,i,f._worldMatrix):f.buildBoundingInfo(e,i,f._worldMatrix),f.updateVerticesData(n.o.PositionKind,l,!1,!1),t.colors){let e=f.getVerticesData(n.o.ColorKind);for(let i=0,s=0;i<t.colors.length;i++,s+=4){let r=t.colors[i];e[s]=r.r,e[s+1]=r.g,e[s+2]=r.b,e[s+3]=r.a}f.updateVerticesData(n.o.ColorKind,e,!1,!1)}if(t.uvs){let e=f.getVerticesData(n.o.UVKind);for(let i=0;i<t.uvs.length;i++)e[2*i]=t.uvs[i].x,e[2*i+1]=o.VJ?1-t.uvs[i].y:t.uvs[i].y;f.updateVerticesData(n.o.UVKind,e,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){let e=f.getIndices(),t=f.getVerticesData(n.o.NormalKind),i=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(a.x.ComputeNormals(l,e,t,i),f._creationDataStorage&&f._creationDataStorage.closePath){let e=0,i=0;for(let s=0;s<h.length;s++)e=3*f._creationDataStorage.idx[s],i=s+1<h.length?(f._creationDataStorage.idx[s+1]-1)*3:t.length-3,t[e]=(t[e]+t[i])*.5,t[e+1]=(t[e+1]+t[i+1])*.5,t[e+2]=(t[e+2]+t[i+2])*.5,t[i]=t[e],t[i+1]=t[e+1],t[i+2]=t[e+2]}f.areNormalsFrozen||f.updateVerticesData(n.o.NormalKind,t,!1,!1)}return f}{let s=new r.Kj(e,i);s._originalBuilderSideOrientation=c,s._creationDataStorage=new r.gW;let n=l(t);return d&&(s._creationDataStorage.idx=n._idx),s._creationDataStorage.closePath=d,s._creationDataStorage.closeArray=u,n.applyToMesh(s,p),s}}a.x.CreateRibbon=l,r.Kj.CreateRibbon=(e,t,i=!1,s,r,n,a=!1,o,l)=>h(e,{pathArray:t,closeArray:i,closePath:s,offset:r,updatable:a,sideOrientation:o,instance:l},n)},52821:function(e,t,i){i.d(t,{Gc:function(){return o},bC:function(){return l}});var s=i(39884),r=i(35823),n=i(57813),a=i(83798);function o(e,t,i=null){let s=t.path,n=t.shape,a=t.scale||1,o=t.rotation||0,l=0===t.cap?0:t.cap||r.Kj.NO_CAP,u=t.updatable,d=r.Kj._GetDefaultSideOrientation(t.sideOrientation),c=t.instance||null,f=t.invertUV||!1,p=t.closeShape||!1;return h(e,n,s,a,o,null,null,t.closePath||!1,p,l,!1,i,!!u,d,c,f,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function l(e,t,i=null){let s=t.path,n=t.shape,a=t.scaleFunction||(()=>1),o=t.rotationFunction||(()=>0),l=t.closePath||t.ribbonCloseArray||!1,u=t.closeShape||t.ribbonClosePath||!1,d=0===t.cap?0:t.cap||r.Kj.NO_CAP,c=t.updatable,f=t.firstNormal||null,p=t.adjustFrame||!1;return h(e,n,s,null,null,a,o,l,u,d,!0,i,!!c,r.Kj._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,f,p)}function h(e,t,i,o,l,h,u,d,c,f,p,_,g,x,m,T,E,b,A,P){let I,v;let M=(e,t,i,n,a,o,l,h,u,d,c)=>{let f=i.getTangents(),p=i.getNormals(),_=i.getBinormals(),g=i.getDistances();if(c){for(let e=0;e<f.length;e++)if(0==f[e].x&&0==f[e].y&&0==f[e].z&&f[e].copyFrom(f[e-1]),0==p[e].x&&0==p[e].y&&0==p[e].z&&p[e].copyFrom(p[e-1]),0==_[e].x&&0==_[e].y&&0==_[e].z&&_[e].copyFrom(_[e-1]),e>0){let t=f[e-1];0>s.P.Dot(t,f[e])&&f[e].scaleInPlace(-1),t=p[e-1],0>s.P.Dot(t,p[e])&&p[e].scaleInPlace(-1),t=_[e-1],0>s.P.Dot(t,_[e])&&_[e].scaleInPlace(-1)}}let x=0,m=d&&h?h:()=>null!==o?o:0,T=d&&l?l:()=>null!==a?a:1,E=u===r.Kj.NO_CAP||u===r.Kj.CAP_END?0:2,b=s.jp.Matrix[0];for(let i=0;i<t.length;i++){let r=[],a=m(i,g[i]),o=T(i,g[i]);s.y3.RotationAxisToRef(f[i],x,b);for(let n=0;n<e.length;n++){let a=f[i].scale(e[n].z).add(p[i].scale(e[n].x)).add(_[i].scale(e[n].y)),l=s.P.Zero();s.P.TransformCoordinatesToRef(a,b,l),l.scaleInPlace(o).addInPlace(t[i]),r[n]=l}n[E]=r,x+=a,E++}let A=e=>{let t;let i=[],r=s.P.Zero();for(t=0;t<e.length;t++)r.addInPlace(e[t]);for(r.scaleInPlace(1/e.length),t=0;t<e.length;t++)i.push(r);return i};switch(u){case r.Kj.NO_CAP:break;case r.Kj.CAP_START:n[0]=A(n[2]),n[1]=n[2];break;case r.Kj.CAP_END:n[E]=n[E-1],n[E+1]=A(n[E-1]);break;case r.Kj.CAP_ALL:n[0]=A(n[2]),n[1]=n[2],n[E]=n[E-1],n[E+1]=A(n[E-1])}return n};if(m){let e=m._creationDataStorage;return I=A?e.path3D.update(i,A):e.path3D.update(i),v=M(t,i,e.path3D,e.pathArray,o,l,h,u,e.cap,p,P),m=(0,n.LY)("",{pathArray:v,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:m},_||void 0)}I=A?new a.$B(i,A):new a.$B(i),v=M(t,i,I,[],o,l,h,u,f=f<0||f>3?0:f,p,P);let y=(0,n.LY)(e,{pathArray:v,closeArray:d,closePath:c,updatable:g,sideOrientation:x,invertUV:T,frontUVs:E||void 0,backUVs:b||void 0},_);return y._creationDataStorage.pathArray=v,y._creationDataStorage.path3D=I,y._creationDataStorage.cap=f,y}r.Kj.ExtrudeShape=(e,t,i,s,n,a,l=null,h,u,d)=>o(e,{shape:t,path:i,scale:s,rotation:n,cap:0===a?0:a||r.Kj.NO_CAP,sideOrientation:u,instance:d,updatable:h},l),r.Kj.ExtrudeShapeCustom=(e,t,i,s,n,a,o,h,u,d,c,f)=>l(e,{shape:t,path:i,scaleFunction:s,rotationFunction:n,ribbonCloseArray:a,ribbonClosePath:o,cap:0===h?0:h||r.Kj.NO_CAP,sideOrientation:c,instance:f,updatable:d},u)},67351:function(e,t,i){i.d(t,{p:function(){return u},v:function(){return h}});var s=i(83798),r=i(39884),n=i(35823),a=i(3860),o=i(42257);class l{constructor(e){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=e}moveTo(e,t){this._currentPath=new s.ZZ(e,t),this._tempPaths.push(this._currentPath)}lineTo(e,t){this._currentPath.addLineTo(e,t)}quadraticCurveTo(e,t,i,s){this._currentPath.addQuadraticCurveTo(e,t,i,s,this._resolution)}bezierCurveTo(e,t,i,s,r,n){this._currentPath.addBezierCurveTo(e,t,i,s,r,n,this._resolution)}extractHoles(){for(let e of this._tempPaths)e.area()>0?this._holes.push(e):this._paths.push(e);if(!this._paths.length&&this._holes.length){let e=this._holes;this._holes=this._paths,this._paths=e}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function h(e,t,i,s){let r=Array.from(e),n=t/s.resolution,a=(s.boundingBox.yMax-s.boundingBox.yMin+s.underlineThickness)*n,o=[],h=0,u=0;for(let e=0;e<r.length;e++){let t=r[e];if("\n"===t)h=0,u-=a;else{let e=function(e,t,i,s,r,n){let a=n.glyphs[e]||n.glyphs["?"];if(!a)return null;let o=new l(r);if(a.o){let e=a.o.split(" ");for(let r=0,n=e.length;r<n;)switch(e[r++]){case"m":{let n=parseInt(e[r++])*t+i,a=parseInt(e[r++])*t+s;o.moveTo(n,a);break}case"l":{let n=parseInt(e[r++])*t+i,a=parseInt(e[r++])*t+s;o.lineTo(n,a);break}case"q":{let n=parseInt(e[r++])*t+i,a=parseInt(e[r++])*t+s,l=parseInt(e[r++])*t+i,h=parseInt(e[r++])*t+s;o.quadraticCurveTo(l,h,n,a);break}case"b":{let n=parseInt(e[r++])*t+i,a=parseInt(e[r++])*t+s,l=parseInt(e[r++])*t+i,h=parseInt(e[r++])*t+s,u=parseInt(e[r++])*t+i,d=parseInt(e[r++])*t+s;o.bezierCurveTo(l,h,u,d,n,a)}}}return o.extractHoles(),{offsetX:a.ha*t,shapePath:o}}(t,n,h,u,i,s);e&&(h+=e.offsetX,o.push(e.shapePath))}}return o}function u(e,t,i,s={size:50,resolution:8,depth:1},l=null,u=earcut){let d=h(t,s.size||50,s.resolution||8,i),c=[],f=0;for(let t of d){if(!t.paths.length)continue;let i=t.holes.slice();for(let a of t.paths){let t=[],h=[];for(let e of a.getPoints())h.push(new r.P(e.x,0,e.y));for(let e of i.slice()){let s=e.getPoints(),n=!1;for(let e of s)if(a.isPointInside(e)){n=!0;break}if(!n)continue;let o=[];for(let e of s)o.push(new r.P(e.x,0,e.y));t.push(o),i.splice(i.indexOf(e),1)}if(!t.length&&i.length)for(let e of i){let i=e.getPoints(),s=[];for(let e of i)s.push(new r.P(e.x,0,e.y));t.push(s)}let d=(0,o.Yo)(e,{shape:h,holes:t.length?t:void 0,depth:s.depth||1,faceUV:s.faceUV||s.perLetterFaceUV?.(f),faceColors:s.faceColors||s.perLetterFaceColors?.(f),sideOrientation:n.Kj._GetDefaultSideOrientation(s.sideOrientation||n.Kj.DOUBLESIDE)},l,u);c.push(d),f++}}let p=n.Kj.MergeMeshes(c,!0,!0);if(p){let t=p.getBoundingInfo().boundingBox;p.position.x+=-(t.minimumWorld.x+t.maximumWorld.x)/2,p.position.y+=-(t.minimumWorld.y+t.maximumWorld.y)/2,p.position.z+=-(t.minimumWorld.z+t.maximumWorld.z)/2+t.extendSize.z,p.name=e;let i=new a.Y("pivot",l);i.rotation.x=-Math.PI/2,p.parent=i,p.bakeCurrentTransformIntoVertices(),p.parent=null,i.dispose()}return p}},73722:function(e,t,i){i.d(t,{cQ:function(){return u}});var s=i(39884),r=i(57449),n=i(35823),a=i(89754),o=i(96799),l=i(77210);function h(e){let t=e.faceUV||Array(6),i=e.faceColors,h=e.pattern||n.Kj.NO_FLIP,u=e.width||e.size||1,d=e.height||e.size||1,c=e.depth||e.size||1,f=e.tileWidth||e.tileSize||1,p=e.tileHeight||e.tileSize||1,_=e.alignHorizontal||0,g=e.alignVertical||0,x=0===e.sideOrientation?0:e.sideOrientation||a.x.DEFAULTSIDE;for(let e=0;e<6;e++)void 0===t[e]&&(t[e]=new s.Lt(0,0,1,1)),i&&void 0===i[e]&&(i[e]=new r.HE(1,1,1,1));let m=[];for(let e=0;e<2;e++)m[e]=(0,o.mm)({pattern:h,tileWidth:f,tileHeight:p,width:u,height:d,alignVertical:g,alignHorizontal:_,sideOrientation:x});for(let e=2;e<4;e++)m[e]=(0,o.mm)({pattern:h,tileWidth:f,tileHeight:p,width:c,height:d,alignVertical:g,alignHorizontal:_,sideOrientation:x});let T=g;g===n.Kj.BOTTOM?T=n.Kj.TOP:g===n.Kj.TOP&&(T=n.Kj.BOTTOM);for(let e=4;e<6;e++)m[e]=(0,o.mm)({pattern:h,tileWidth:f,tileHeight:p,width:u,height:c,alignVertical:T,alignHorizontal:_,sideOrientation:x});let E=[],b=[],A=[],P=[],I=[],v=[],M=[],y=[],R=0,S=0;for(let e=0;e<6;e++){let r=m[e].positions.length;v[e]=[],M[e]=[];for(let t=0;t<r/3;t++)v[e].push(new s.P(m[e].positions[3*t],m[e].positions[3*t+1],m[e].positions[3*t+2])),M[e].push(new s.P(m[e].normals[3*t],m[e].normals[3*t+1],m[e].normals[3*t+2]));R=m[e].uvs.length,y[e]=[];for(let i=0;i<R;i+=2)y[e][i]=t[e].x+(t[e].z-t[e].x)*m[e].uvs[i],y[e][i+1]=t[e].y+(t[e].w-t[e].y)*m[e].uvs[i+1],l.VJ&&(y[e][i+1]=1-y[e][i+1]);if(A=A.concat(y[e]),P=P.concat(m[e].indices.map(e=>e+S)),S+=v[e].length,i)for(let t=0;t<4;t++)I.push(i[e].r,i[e].g,i[e].b,i[e].a)}let C=new s.P(0,0,c/2),O=s.y3.RotationY(Math.PI);E=v[0].map(e=>s.P.TransformNormal(e,O).add(C)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[]),b=M[0].map(e=>s.P.TransformNormal(e,O)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[]),E=E.concat(v[1].map(e=>e.subtract(C)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[])),b=b.concat(M[1].map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[]));let L=new s.P(u/2,0,0),D=s.y3.RotationY(-Math.PI/2);E=E.concat(v[2].map(e=>s.P.TransformNormal(e,D).add(L)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[])),b=b.concat(M[2].map(e=>s.P.TransformNormal(e,D)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[]));let F=s.y3.RotationY(Math.PI/2);E=E.concat(v[3].map(e=>s.P.TransformNormal(e,F).subtract(L)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[])),b=b.concat(M[3].map(e=>s.P.TransformNormal(e,F)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[]));let B=new s.P(0,d/2,0),w=s.y3.RotationX(Math.PI/2);E=E.concat(v[4].map(e=>s.P.TransformNormal(e,w).add(B)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[])),b=b.concat(M[4].map(e=>s.P.TransformNormal(e,w)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[]));let N=s.y3.RotationX(-Math.PI/2);E=E.concat(v[5].map(e=>s.P.TransformNormal(e,N).subtract(B)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[])),b=b.concat(M[5].map(e=>s.P.TransformNormal(e,N)).map(e=>[e.x,e.y,e.z]).reduce((e,t)=>e.concat(t),[])),a.x._ComputeSides(x,E,P,b,A);let U=new a.x;if(U.indices=P,U.positions=E,U.normals=b,U.uvs=A,i){let e=x===a.x.DOUBLESIDE?I.concat(I):I;U.colors=e}return U}function u(e,t,i=null){let s=new n.Kj(e,i);return t.sideOrientation=n.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,h(t).applyToMesh(s,t.updatable),s}a.x.CreateTiledBox=h},96799:function(e,t,i){i.d(t,{KA:function(){return a},mm:function(){return n}});var s=i(35823),r=i(89754);function n(e){let t=e.pattern||s.Kj.NO_FLIP,i=e.tileWidth||e.tileSize||1,n=e.tileHeight||e.tileSize||1,a=e.alignHorizontal||0,o=e.alignVertical||0,l=e.width||e.size||1,h=Math.floor(l/i),u=l-h*i,d=e.height||e.size||1,c=Math.floor(d/n),f=d-c*n,p=i*h/2,_=n*c/2,g=0,x=0,m=0,T=0,E=0,b=0;if(u>0||f>0){switch(m=-p,T=-_,E=p,b=_,a){case s.Kj.CENTER:u/=2,m-=u,E+=u;break;case s.Kj.LEFT:E+=u,g=-u/2;break;case s.Kj.RIGHT:m-=u,g=u/2}switch(o){case s.Kj.CENTER:f/=2,T-=f,b+=f;break;case s.Kj.BOTTOM:b+=f,x=-f/2;break;case s.Kj.TOP:T-=f,x=f/2}}let A=[],P=[],I=[];I[0]=[0,0,1,0,1,1,0,1],I[1]=[0,0,1,0,1,1,0,1],(t===s.Kj.ROTATE_TILE||t===s.Kj.ROTATE_ROW)&&(I[1]=[1,1,0,1,0,0,1,0]),(t===s.Kj.FLIP_TILE||t===s.Kj.FLIP_ROW)&&(I[1]=[1,0,0,0,0,1,1,1]),(t===s.Kj.FLIP_N_ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_ROW)&&(I[1]=[0,1,1,1,1,0,0,0]);let v=[],M=[],y=[],R=0;for(let e=0;e<c;e++)for(let r=0;r<h;r++)A.push(-p+r*i+g,-_+e*n+x,0),A.push(-p+(r+1)*i+g,-_+e*n+x,0),A.push(-p+(r+1)*i+g,-_+(e+1)*n+x,0),A.push(-p+r*i+g,-_+(e+1)*n+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),v=t===s.Kj.FLIP_TILE||t===s.Kj.ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_TILE?v.concat(I[(r%2+e%2)%2]):t===s.Kj.FLIP_ROW||t===s.Kj.ROTATE_ROW||t===s.Kj.FLIP_N_ROTATE_ROW?v.concat(I[e%2]):v.concat(I[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),R+=4;if(u>0||f>0){let e,r,l,d;let I=f>0&&(o===s.Kj.CENTER||o===s.Kj.TOP),S=f>0&&(o===s.Kj.CENTER||o===s.Kj.BOTTOM),C=u>0&&(a===s.Kj.CENTER||a===s.Kj.RIGHT),O=u>0&&(a===s.Kj.CENTER||a===s.Kj.LEFT),L=[];if(I&&C&&(A.push(m+g,T+x,0),A.push(-p+g,T+x,0),A.push(-p+g,T+f+x,0),A.push(m+g,T+f+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,l=1,d=1,L=[e=1-u/i,r=1-f/n,l,r,l,d,e,d],t===s.Kj.ROTATE_ROW&&(L=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),t===s.Kj.FLIP_ROW&&(L=[1-e,r,1-l,r,1-l,d,1-e,d]),t===s.Kj.FLIP_N_ROTATE_ROW&&(L=[e,1-r,l,1-r,l,1-d,e,1-d]),v=v.concat(L),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&O&&(A.push(p+g,T+x,0),A.push(E+g,T+x,0),A.push(E+g,T+f+x,0),A.push(p+g,T+f+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,d=1,L=[e=0,r=1-f/n,l=u/i,r,l,d,e,d],(t===s.Kj.ROTATE_ROW||t===s.Kj.ROTATE_TILE&&h%2==0)&&(L=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_ROW||t===s.Kj.FLIP_TILE&&h%2==0)&&(L=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_ROW||t===s.Kj.FLIP_N_ROTATE_TILE&&h%2==0)&&(L=[e,1-r,l,1-r,l,1-d,e,1-d]),v=v.concat(L),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&C&&(A.push(m+g,_+x,0),A.push(-p+g,_+x,0),A.push(-p+g,b+x,0),A.push(m+g,b+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,r=0,l=1,L=[e=1-u/i,r,l,r,l,d=f/n,e,d],(t===s.Kj.ROTATE_ROW&&c%2==1||t===s.Kj.ROTATE_TILE&&c%1==0)&&(L=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_ROW&&c%2==1||t===s.Kj.FLIP_TILE&&c%2==0)&&(L=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_ROW&&c%2==1||t===s.Kj.FLIP_N_ROTATE_TILE&&c%2==0)&&(L=[e,1-r,l,1-r,l,1-d,e,1-d]),v=v.concat(L),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&O&&(A.push(p+g,_+x,0),A.push(E+g,_+x,0),A.push(E+g,b+x,0),A.push(p+g,b+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,L=[e=0,r=0,l=u/i,r,l,d=f/n,e,d],(t===s.Kj.ROTATE_ROW&&c%2==1||t===s.Kj.ROTATE_TILE&&(c+h)%2==1)&&(L=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_ROW&&c%2==1||t===s.Kj.FLIP_TILE&&(c+h)%2==1)&&(L=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_ROW&&c%2==1||t===s.Kj.FLIP_N_ROTATE_TILE&&(c+h)%2==1)&&(L=[e,1-r,l,1-r,l,1-d,e,1-d]),v=v.concat(L),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I){let a=[];e=0,r=1-f/n,l=1,d=1,a[0]=[e,r,l,r,l,d,e,d],a[1]=[e,r,l,r,l,d,e,d],(t===s.Kj.ROTATE_TILE||t===s.Kj.ROTATE_ROW)&&(a[1]=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_TILE||t===s.Kj.FLIP_ROW)&&(a[1]=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_ROW)&&(a[1]=[e,1-r,l,1-r,l,1-d,e,1-d]);for(let e=0;e<h;e++)A.push(-p+e*i+g,T+x,0),A.push(-p+(e+1)*i+g,T+x,0),A.push(-p+(e+1)*i+g,T+f+x,0),A.push(-p+e*i+g,T+f+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=t===s.Kj.FLIP_TILE||t===s.Kj.ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_TILE?v.concat(a[(e+1)%2]):t===s.Kj.FLIP_ROW||t===s.Kj.ROTATE_ROW||t===s.Kj.FLIP_N_ROTATE_ROW?v.concat(a[1]):v.concat(a[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){let a=[];e=0,r=0,l=1,d=f/n,a[0]=[e,r,l,r,l,d,e,d],a[1]=[e,r,l,r,l,d,e,d],(t===s.Kj.ROTATE_TILE||t===s.Kj.ROTATE_ROW)&&(a[1]=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_TILE||t===s.Kj.FLIP_ROW)&&(a[1]=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_ROW)&&(a[1]=[e,1-r,l,1-r,l,1-d,e,1-d]);for(let e=0;e<h;e++)A.push(-p+e*i+g,b-f+x,0),A.push(-p+(e+1)*i+g,b-f+x,0),A.push(-p+(e+1)*i+g,b+x,0),A.push(-p+e*i+g,b+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=t===s.Kj.FLIP_TILE||t===s.Kj.ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_TILE?v.concat(a[(e+c)%2]):t===s.Kj.FLIP_ROW||t===s.Kj.ROTATE_ROW||t===s.Kj.FLIP_N_ROTATE_ROW?v.concat(a[c%2]):v.concat(a[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){let a=[];e=1-u/i,r=0,l=1,d=1,a[0]=[e,r,l,r,l,d,e,d],a[1]=[e,r,l,r,l,d,e,d],(t===s.Kj.ROTATE_TILE||t===s.Kj.ROTATE_ROW)&&(a[1]=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_TILE||t===s.Kj.FLIP_ROW)&&(a[1]=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_ROW)&&(a[1]=[e,1-r,l,1-r,l,1-d,e,1-d]);for(let e=0;e<c;e++)A.push(m+g,-_+e*n+x,0),A.push(m+u+g,-_+e*n+x,0),A.push(m+u+g,-_+(e+1)*n+x,0),A.push(m+g,-_+(e+1)*n+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=t===s.Kj.FLIP_TILE||t===s.Kj.ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_TILE?v.concat(a[(e+1)%2]):t===s.Kj.FLIP_ROW||t===s.Kj.ROTATE_ROW||t===s.Kj.FLIP_N_ROTATE_ROW?v.concat(a[e%2]):v.concat(a[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){let i=[];e=0,r=0,l=u/n,d=1,i[0]=[e,r,l,r,l,d,e,d],i[1]=[e,r,l,r,l,d,e,d],(t===s.Kj.ROTATE_TILE||t===s.Kj.ROTATE_ROW)&&(i[1]=[1-e,1-r,1-l,1-r,1-l,1-d,1-e,1-d]),(t===s.Kj.FLIP_TILE||t===s.Kj.FLIP_ROW)&&(i[1]=[1-e,r,1-l,r,1-l,d,1-e,d]),(t===s.Kj.FLIP_N_ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_ROW)&&(i[1]=[e,1-r,l,1-r,l,1-d,e,1-d]);for(let e=0;e<c;e++)A.push(E-u+g,-_+e*n+x,0),A.push(E+g,-_+e*n+x,0),A.push(E+g,-_+(e+1)*n+x,0),A.push(E-u+g,-_+(e+1)*n+x,0),y.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=t===s.Kj.FLIP_TILE||t===s.Kj.ROTATE_TILE||t===s.Kj.FLIP_N_ROTATE_TILE?v.concat(i[(e+h)%2]):t===s.Kj.FLIP_ROW||t===s.Kj.ROTATE_ROW||t===s.Kj.FLIP_N_ROTATE_ROW?v.concat(i[e%2]):v.concat(i[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),P.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}let S=0===e.sideOrientation?0:e.sideOrientation||r.x.DEFAULTSIDE;r.x._ComputeSides(S,A,y,P,v,e.frontUVs,e.backUVs);let C=new r.x;C.indices=y,C.positions=A,C.normals=P,C.uvs=v;let O=S===r.x.DOUBLESIDE?M.concat(M):M;return C.colors=O,C}function a(e,t,i=null){let r=new s.Kj(e,i);return t.sideOrientation=s.Kj._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,n(t).applyToMesh(r,t.updatable),r}r.x.CreateTiledPlane=n},77958:function(e,t,i){i.d(t,{eu:function(){return l},h5:function(){return o}});var s=i(39884),r=i(35823),n=i(89754),a=i(77210);function o(e){let t=[],i=[],r=[],o=[],l=e.diameter||1,h=e.thickness||.5,u=0|(e.tessellation||16),d=0===e.sideOrientation?0:e.sideOrientation||n.x.DEFAULTSIDE,c=u+1;for(let e=0;e<=u;e++){let n=e/u,d=e*Math.PI*2/u-Math.PI/2,f=s.y3.Translation(l/2,0,0).multiply(s.y3.RotationY(d));for(let l=0;l<=u;l++){let d=1-l/u,p=l*Math.PI*2/u+Math.PI,_=Math.cos(p),g=Math.sin(p),x=new s.P(_,g,0),m=x.scale(h/2),T=new s.FM(n,d);m=s.P.TransformCoordinates(m,f),x=s.P.TransformNormal(x,f),i.push(m.x,m.y,m.z),r.push(x.x,x.y,x.z),o.push(T.x,a.VJ?1-T.y:T.y);let E=(e+1)%c,b=(l+1)%c;t.push(e*c+l),t.push(e*c+b),t.push(E*c+l),t.push(e*c+b),t.push(E*c+b),t.push(E*c+l)}}n.x._ComputeSides(d,i,t,r,o,e.frontUVs,e.backUVs);let f=new n.x;return f.indices=t,f.positions=i,f.normals=r,f.uvs=o,f}function l(e,t={},i){let s=new r.Kj(e,i);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,o(t).applyToMesh(s,t.updatable),s}n.x.CreateTorus=o,r.Kj.CreateTorus=(e,t,i,s,r,n,a)=>l(e,{diameter:t,thickness:i,tessellation:s,sideOrientation:a,updatable:n},r)},36556:function(e,t,i){i.d(t,{eB:function(){return l}});var s=i(39884),r=i(35823),n=i(89754),a=i(77210);function o(e){let t,i;let r=[],o=[],l=[],h=[],u=e.radius||2,d=e.tube||.5,c=e.radialSegments||32,f=e.tubularSegments||32,p=e.p||2,_=e.q||3,g=0===e.sideOrientation?0:e.sideOrientation||n.x.DEFAULTSIDE,x=e=>{let t=_/p*e,i=Math.cos(t);return new s.P(u*(2+i)*.5*Math.cos(e),u*(2+i)*Math.sin(e)*.5,u*Math.sin(t)*.5)};for(t=0;t<=c;t++){let e=t%c/c*2*p*Math.PI,r=x(e),n=x(e+.01),l=n.subtract(r),u=n.add(r),_=s.P.Cross(l,u);for(u=s.P.Cross(_,l),_.normalize(),u.normalize(),i=0;i<f;i++){let e=i%f/f*2*Math.PI,s=-d*Math.cos(e),n=d*Math.sin(e);o.push(r.x+s*u.x+n*_.x),o.push(r.y+s*u.y+n*_.y),o.push(r.z+s*u.z+n*_.z),h.push(t/c),h.push(a.VJ?1-i/f:i/f)}}for(t=0;t<c;t++)for(i=0;i<f;i++){let e=(i+1)%f,s=t*f+i,n=(t+1)*f+i,a=(t+1)*f+e,o=t*f+e;r.push(o),r.push(n),r.push(s),r.push(o),r.push(a),r.push(n)}n.x.ComputeNormals(o,r,l),n.x._ComputeSides(g,o,r,l,h,e.frontUVs,e.backUVs);let m=new n.x;return m.indices=r,m.positions=o,m.normals=l,m.uvs=h,m}function l(e,t={},i){let s=new r.Kj(e,i);return t.sideOrientation=r.Kj._GetDefaultSideOrientation(t.sideOrientation),s._originalBuilderSideOrientation=t.sideOrientation,o(t).applyToMesh(s,t.updatable),s}n.x.CreateTorusKnot=o,r.Kj.CreateTorusKnot=(e,t,i,s,r,n,a,o,h,u)=>l(e,{radius:t,tube:i,radialSegments:s,tubularSegments:r,p:n,q:a,sideOrientation:u,updatable:h},o)},79470:function(e,t,i){i.d(t,{_:function(){return o}});var s=i(39884),r=i(35823),n=i(57813),a=i(83798);function o(e,t,i=null){let o,l;let h=t.path,u=t.instance,d=1;void 0!==t.radius?d=t.radius:u&&(d=u._creationDataStorage.radius);let c=t.tessellation||64,f=t.radiusFunction||null,p=t.cap||r.Kj.NO_CAP,_=t.invertUV||!1,g=t.updatable,x=r.Kj._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;let m=(e,t,i,n,a,o,l,h)=>{let u,d,c,f;let p=t.getTangents(),_=t.getNormals(),g=t.getDistances(),x=2*Math.PI/a*h,m=o||(()=>n),T=s.jp.Matrix[0],E=l===r.Kj.NO_CAP||l===r.Kj.CAP_END?0:2;for(let t=0;t<e.length;t++){d=m(t,g[t]),u=[],c=_[t];for(let i=0;i<a;i++)s.y3.RotationAxisToRef(p[t],x*i,T),f=u[i]?u[i]:s.P.Zero(),s.P.TransformCoordinatesToRef(c,T,f),f.scaleInPlace(d).addInPlace(e[t]),u[i]=f;i[E]=u,E++}let b=(t,i)=>{let s=[];for(let r=0;r<t;r++)s.push(e[i]);return s};switch(l){case r.Kj.NO_CAP:break;case r.Kj.CAP_START:i[0]=b(a,0),i[1]=i[2].slice(0);break;case r.Kj.CAP_END:i[E]=i[E-1].slice(0),i[E+1]=b(a,e.length-1);break;case r.Kj.CAP_ALL:i[0]=b(a,0),i[1]=i[2].slice(0),i[E]=i[E-1].slice(0),i[E+1]=b(a,e.length-1)}return i};if(u){let e=u._creationDataStorage,i=t.arc||e.arc;return o=e.path3D.update(h),l=m(h,o,e.pathArray,d,e.tessellation,f,e.cap,i),u=(0,n.LY)("",{pathArray:l,instance:u}),e.path3D=o,e.pathArray=l,e.arc=i,e.radius=d,u}o=new a.$B(h),l=m(h,o,[],d,c,f,p=p<0||p>3?0:p,t.arc);let T=(0,n.LY)(e,{pathArray:l,closePath:!0,closeArray:!1,updatable:g,sideOrientation:x,invertUV:_,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return T._creationDataStorage.pathArray=l,T._creationDataStorage.path3D=o,T._creationDataStorage.tessellation=c,T._creationDataStorage.cap=p,T._creationDataStorage.arc=t.arc,T._creationDataStorage.radius=d,T}r.Kj.CreateTube=(e,t,i,s,r,n,a,l,h,u)=>o(e,{path:t,radius:i,tessellation:s,radiusFunction:r,arc:1,cap:n,updatable:l,sideOrientation:h,instance:u},a)},21716:function(e,t,i){i.d(t,{zz:function(){return u},Bn:function(){return l}});var s=i(39884),r=i(65330),n=i(31644),a=i(9719);class o{constructor(e=0,t=0){this.x=e,this.y=t,e!==Math.floor(e)&&(e=Math.floor(e),a.Y.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),a.Y.Warn("y is not an integer, floor(y) used"))}clone(){return new o(this.x,this.y)}rotate60About(e){let t=this.x;return this.x=e.x+e.y-this.y,this.y=t+this.y-e.x,this}rotateNeg60About(e){let t=this.x;return this.x=t+this.y-e.y,this.y=e.x+e.y-t,this}rotate120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),a.Y.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),a.Y.Warn("n not an integer only floor(n) used"));let i=this.x;return this.x=e-i-this.y,this.y=t+i,this}rotateNeg120(e,t){e!==Math.floor(e)&&(e=Math.floor(e),a.Y.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),a.Y.Warn("n is not an integer,   floor(n) used"));let i=this.x;return this.x=this.y-t,this.y=e+t-i-this.y,this}toCartesianOrigin(e,t){let i=s.P.Zero();return i.x=e.x+2*this.x*t+this.y*t,i.y=e.y+Math.sqrt(3)*this.y*t,i}static Zero(){return new o(0,0)}}class l{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new h("icosahedron","Regular",[[0,n.Q_,-1],[-n.Q_,1,0],[-1,0,-n.Q_],[1,0,-n.Q_],[n.Q_,1,0],[0,n.Q_,1],[-1,0,n.Q_],[-n.Q_,-1,0],[0,-n.Q_,-1],[n.Q_,-1,0],[1,0,n.Q_],[0,-n.Q_,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e,t,i,s,n,a,l,h,u=12,d={},c=this.m,f=this.n,p=c,_=1,g=0;0!==f&&(p=(0,r.HighestCommonFactor)(c,f)),_=c/p,g=f/p;let x=o.Zero(),m=new o(c,f),T=new o(-f,c+f),E=o.Zero(),b=o.Zero(),A=o.Zero(),P=[],I=[],v=this.vertByDist,M=(e,t,i,s)=>{a=e+"|"+i,l=t+"|"+s,a in d||l in d?a in d&&!(l in d)?d[l]=d[a]:l in d&&!(a in d)&&(d[a]=d[l]):(d[a]=u,d[l]=u,u++),v[i][0]>2?I[d[a]]=[-v[i][0],v[i][1],d[a]]:I[d[a]]=[P[v[i][0]],v[i][1],d[a]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let r=0;r<20;r++){if(i=(P=this.IDATA.face[r])[2],s=P[1],n=P[0],(a=r+"|"+(h=x.x+"|"+x.y))in d||(d[a]=i,I[i]=[P[v[h][0]],v[h][1]]),(a=r+"|"+(h=m.x+"|"+m.y))in d||(d[a]=s,I[s]=[P[v[h][0]],v[h][1]]),(a=r+"|"+(h=T.x+"|"+T.y))in d||(d[a]=n,I[n]=[P[v[h][0]],v[h][1]]),e=this.IDATA.edgematch[r][0],"B"===(t=this.IDATA.edgematch[r][1]))for(let t=1;t<p;t++)b.x=c-t*(_+g),b.y=f+t*_,A.x=-t*g,A.y=t*(_+g),M(r,e,h=b.x+"|"+b.y,A.x+"|"+A.y);if("O"===t)for(let t=1;t<p;t++)A.x=-t*g,A.y=t*(_+g),E.x=t*_,E.y=t*g,M(r,e,h=A.x+"|"+A.y,E.x+"|"+E.y);if(e=this.IDATA.edgematch[r][2],(t=this.IDATA.edgematch[r][3])&&"A"===t)for(let t=1;t<p;t++)E.x=t*_,E.y=t*g,b.x=c-(p-t)*(_+g),b.y=f+(p-t)*_,M(r,e,h=E.x+"|"+E.y,b.x+"|"+b.y);for(let e=0;e<this.vertices.length;e++)(a=r+"|"+(h=this.vertices[e].x+"|"+this.vertices[e].y))in d||(d[a]=u++,v[h][0]>2?I[d[a]]=[-v[h][0],v[h][1],d[a]]:I[d[a]]=[P[v[h][0]],v[h][1],d[a]])}this.closestTo=I,this.vecToidx=d}calcCoeffs(){let e=this.m,t=this.n,i=Math.sqrt(3)/3,s=e*e+t*t+e*t;this.coau=(e+t)/s,this.cobu=-t/s,this.coav=-i*(e-t)/s,this.cobv=i*(2*e+t)/s}createInnerFacets(){let e=this.m,t=this.n;for(let i=0;i<t+e+1;i++)for(let e=this.min[i];e<this.max[i]+1;e++)e<this.max[i]&&e<this.max[i+1]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+e+"|"+(i+1),"|"+(e+1)+"|"+i]),i>0&&e<this.max[i-1]&&e+1<this.max[i]+1&&this.innerFacets.push(["|"+e+"|"+i,"|"+(e+1)+"|"+i,"|"+(e+1)+"|"+(i-1)])}edgeVecsABOB(){let e=this.m,t=this.n,i=new o(-t,e+t);for(let s=1;s<e+t;s++){let e=new o(this.min[s],s),t=new o(this.min[s-1],s-1),r=new o(this.min[s+1],s+1),n=e.clone(),a=t.clone(),l=r.clone();n.rotate60About(i),a.rotate60About(i),l.rotate60About(i);let h=new o(this.max[n.y],n.y),u=new o(this.max[n.y-1],n.y-1),d=new o(this.max[n.y-1]-1,n.y-1);(n.x!==h.x||n.y!==h.y)&&(n.x!==u.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,u,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,d,h])):n.y===l.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,u]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,u,r])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,t,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,u,h])))}}mapABOBtoOBOA(){let e=new o(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){let i=[];for(let s=0;s<3;s++)e.x=this.isoVecsABOB[t][s].x,e.y=this.isoVecsABOB[t][s].y,0===this.vertexTypes[t][s]&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){let e=new o(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){let i=[];for(let s=0;s<3;s++)e.x=this.isoVecsABOB[t][s].x,e.y=this.isoVecsABOB[t][s].y,1===this.vertexTypes[t][s]&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}}MapToFace(e,t){let i;let r=this.IDATA.face[e],n=r[2],a=r[1],o=r[0],l=s.P.FromArray(this.IDATA.vertex[n]),h=s.P.FromArray(this.IDATA.vertex[a]),u=s.P.FromArray(this.IDATA.vertex[o]),d=h.subtract(l),c=u.subtract(l),f=d.scale(this.coau).add(c.scale(this.cobu)),p=d.scale(this.coav).add(c.scale(this.cobv)),_=[],g=s.jp.Vector3[0];for(let s=0;s<this.cartesian.length;s++)g=f.scale(this.cartesian[s].x).add(p.scale(this.cartesian[s].y)).add(l),_[s]=[g.x,g.y,g.z],i=e+"|"+this.vertices[s].x+"|"+this.vertices[s].y,t.vertex[this.vecToidx[i]]=[g.x,g.y,g.z]}build(e,t){let i=[],s=o.Zero(),n=new o(e,t),a=new o(-t,e+t);i.push(s,n,a);for(let s=t;s<e+1;s++)for(let t=0;t<e+1-s;t++)i.push(new o(t,s));if(t>0){let s=(0,r.HighestCommonFactor)(e,t),n=e/s,a=t/s;for(let r=1;r<s;r++)i.push(new o(r*n,r*a)),i.push(new o(-r*a,r*(n+a))),i.push(new o(e-r*(n+a),t+r*n));let l=e/t;for(let s=1;s<t;s++)for(let r=0;r<s*l;r++)i.push(new o(r,s)),i.push(new o(r,s).rotate120(e,t)),i.push(new o(r,s).rotateNeg120(e,t))}i.sort((e,t)=>e.x-t.x),i.sort((e,t)=>e.y-t.y);let l=Array(e+t+1),h=Array(e+t+1);for(let e=0;e<l.length;e++)l[e]=1/0,h[e]=-1/0;let u=0,d=0,c=i.length;for(let e=0;e<c;e++)d=i[e].x,l[u=i[e].y]=Math.min(d,l[u]),h[u]=Math.max(d,h[u]);let f=(i,s)=>{let r=i.clone();return("A"===s&&r.rotateNeg120(e,t),"B"===s&&r.rotate120(e,t),r.x<0)?r.y:r.x+r.y},p=[],_=[],g=[],x=[],m={},T=[],E=-1,b=-1;for(let e=0;e<c;e++)p[e]=i[e].toCartesianOrigin(new o(0,0),.5),_[e]=f(i[e],"O"),g[e]=f(i[e],"A"),x[e]=f(i[e],"B"),_[e]===g[e]&&g[e]===x[e]?(E=3,b=_[e]):_[e]===g[e]?(E=4,b=_[e]):g[e]===x[e]?(E=5,b=g[e]):x[e]===_[e]&&(E=6,b=_[e]),_[e]<g[e]&&_[e]<x[e]&&(E=2,b=_[e]),g[e]<_[e]&&g[e]<x[e]&&(E=1,b=g[e]),x[e]<g[e]&&x[e]<_[e]&&(E=0,b=x[e]),T.push([E,b,i[e].x,i[e].y]);T.sort((e,t)=>e[2]-t[2]),T.sort((e,t)=>e[3]-t[3]),T.sort((e,t)=>e[1]-t[1]),T.sort((e,t)=>e[0]-t[0]);for(let e=0;e<T.length;e++)m[T[e][2]+"|"+T[e][3]]=[T[e][0],T[e][1],e];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=m,this.cartesian=p,this.min=l,this.max=h,this}}class h{constructor(e,t,i,s){this.name=e,this.category=t,this.vertex=i,this.face=s}}class u extends h{innerToData(e,t){for(let i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map(i=>t.vecToidx[e+i]))}mapABOBtoDATA(e,t){let i=t.IDATA.edgematch[e][0];for(let s=0;s<t.isoVecsABOB.length;s++){let r=[];for(let n=0;n<3;n++)0===t.vertexTypes[s][n]?r.push(e+"|"+t.isoVecsABOB[s][n].x+"|"+t.isoVecsABOB[s][n].y):r.push(i+"|"+t.isoVecsABOB[s][n].x+"|"+t.isoVecsABOB[s][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapOBOAtoDATA(e,t){let i=t.IDATA.edgematch[e][0];for(let s=0;s<t.isoVecsOBOA.length;s++){let r=[];for(let n=0;n<3;n++)1===t.vertexTypes[s][n]?r.push(e+"|"+t.isoVecsOBOA[s][n].x+"|"+t.isoVecsOBOA[s][n].y):r.push(i+"|"+t.isoVecsOBOA[s][n].x+"|"+t.isoVecsOBOA[s][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}mapBAOAtoDATA(e,t){let i=t.IDATA.edgematch[e][2];for(let s=0;s<t.isoVecsBAOA.length;s++){let r=[];for(let n=0;n<3;n++)1===t.vertexTypes[s][n]?r.push(e+"|"+t.isoVecsBAOA[s][n].x+"|"+t.isoVecsBAOA[s][n].y):r.push(i+"|"+t.isoVecsBAOA[s][n].x+"|"+t.isoVecsBAOA[s][n].y);this.face.push([t.vecToidx[r[0]],t.vecToidx[r[1]],t.vecToidx[r[2]]])}}orderData(e){let t=[];for(let e=0;e<13;e++)t[e]=[];let i=e.closestTo;for(let e=0;e<i.length;e++)i[e][0]>-1?i[e][1]>0&&t[i[e][0]].push([e,i[e][1]]):t[12].push([e,i[e][0]]);let s=[];for(let e=0;e<12;e++)s[e]=e;let r=12;for(let e=0;e<12;e++){t[e].sort((e,t)=>e[1]-t[1]);for(let i=0;i<t[e].length;i++)s[t[e][i][0]]=r++}for(let e=0;e<t[12].length;e++)s[t[12][e][0]]=r++;for(let e=0;e<this.vertex.length;e++)this.vertex[e].push(s[e]);this.vertex.sort((e,t)=>e[3]-t[3]);for(let e=0;e<this.vertex.length;e++)this.vertex[e].pop();for(let e=0;e<this.face.length;e++)for(let t=0;t<this.face[e].length;t++)this.face[e][t]=s[this.face[e][t]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,t){let i=[],s=[],r=t.pop();s.push(r);let n=this.face[r].indexOf(e);n=(n+2)%3;let a=this.face[r][n];i.push(a);let o=0;for(;t.length>0;)r=t[o],this.face[r].indexOf(a)>-1?(n=(this.face[r].indexOf(a)+1)%3,a=this.face[r][n],i.push(a),s.push(r),t.splice(o,1),o=0):o++;return this.adjacentFaces.push(i),s}toGoldbergPolyhedronData(){let e=new h("GeoDual","Goldberg",[],[]);e.name="GD dual";let t=this.vertex.length,i=Array(t);for(let e=0;e<t;e++)i[e]=[];for(let e=0;e<this.face.length;e++)for(let t=0;t<3;t++)i[this.face[e][t]].push(e);let s=0,r=0,n=0,a=[],o=[];this.adjacentFaces=[];for(let t=0;t<i.length;t++)e.face[t]=this.setOrder(t,i[t].concat([])),i[t].forEach(t=>{s=0,r=0,n=0,a=this.face[t];for(let e=0;e<3;e++)o=this.vertex[a[e]],s+=o[0],r+=o[1],n+=o[2];e.vertex[t]=[s/3,r/3,n/3]});return e}static BuildGeodesicData(e){let t=new u("Geodesic-m-n","Geodesic",[[0,n.Q_,-1],[-n.Q_,1,0],[-1,0,-n.Q_],[1,0,-n.Q_],[n.Q_,1,0],[0,n.Q_,1],[-1,0,n.Q_],[-n.Q_,-1,0],[0,-n.Q_,-1],[n.Q_,-1,0],[1,0,n.Q_],[0,-n.Q_,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let i=0;i<e.IDATA.face.length;i++)e.MapToFace(i,t),t.innerToData(i,e),"B"===e.IDATA.edgematch[i][1]&&t.mapABOBtoDATA(i,e),"O"===e.IDATA.edgematch[i][1]&&t.mapOBOAtoDATA(i,e),"A"===e.IDATA.edgematch[i][3]&&t.mapBAOAtoDATA(i,e);return t.orderData(e),t.vertex=t.vertex.map(function(e){let t=e[0],i=e[1],s=e[2],r=Math.sqrt(t*t+i*i+s*s);return e[0]*=1/r,e[1]*=1/r,e[2]*=1/r,e}),t}}},98317:function(e,t,i){i.d(t,{R:function(){return l}});var s=i(39884),r=i(93954),n=i(35823),a=i(57449),o=i(9719);n.Kj._GoldbergMeshParser=(e,t)=>l.Parse(e,t);class l extends n.Kj{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(o.Y.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(o.Y.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(o.Y.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(e){for(let t=0;t<e.length;t++){let i=e[t][0],s=e[t][1],r=e[t][2];for(let e=i;e<s+1;e++)this.goldbergData.faceColors[e]=r}let t=[];for(let e=0;e<12;e++)for(let i=0;i<5;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let i=0;i<6;i++)t.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return t}setGoldbergFaceColors(e){let t=this._changeGoldbergFaceColors(e);this.setVerticesData(r.o.ColorKind,t)}updateGoldbergFaceColors(e){let t=this._changeGoldbergFaceColors(e);this.updateVerticesData(r.o.ColorKind,t)}_changeGoldbergFaceUVs(e){let t=this.getVerticesData(r.o.UVKind);for(let i=0;i<e.length;i++){let s,r;let n=e[i][0],a=e[i][1],o=e[i][2],l=e[i][3],h=e[i][4],u=[],d=[];for(let e=0;e<5;e++)s=o.x+l*Math.cos(h+e*Math.PI/2.5),r=o.y+l*Math.sin(h+e*Math.PI/2.5),s<0&&(s=0),s>1&&(s=1),u.push(s,r);for(let e=0;e<6;e++)s=o.x+l*Math.cos(h+e*Math.PI/3),r=o.y+l*Math.sin(h+e*Math.PI/3),s<0&&(s=0),s>1&&(s=1),d.push(s,r);for(let e=n;e<Math.min(12,a+1);e++)for(let i=0;i<5;i++)t[10*e+2*i]=u[2*i],t[10*e+2*i+1]=u[2*i+1];for(let e=Math.max(12,n);e<a+1;e++)for(let i=0;i<6;i++)t[12*e-24+2*i]=d[2*i],t[12*e-23+2*i]=d[2*i+1]}return t}setGoldbergFaceUVs(e){let t=this._changeGoldbergFaceUVs(e);this.setVerticesData(r.o.UVKind,t)}updateGoldbergFaceUVs(e){let t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(r.o.UVKind,t)}placeOnGoldbergFaceAt(e,t,i){let r=s.P.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=r,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";let t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors)for(let e of(t.faceColors=[],this.goldbergData.faceColors))t.faceColors.push(e.asArray());if(this.goldbergData.faceCenters)for(let e of(t.faceCenters=[],this.goldbergData.faceCenters))t.faceCenters.push(e.asArray());if(this.goldbergData.faceZaxis)for(let e of(t.faceZaxis=[],this.goldbergData.faceZaxis))t.faceZaxis.push(e.asArray());if(this.goldbergData.faceYaxis)for(let e of(t.faceYaxis=[],this.goldbergData.faceYaxis))t.faceYaxis.push(e.asArray());if(this.goldbergData.faceXaxis)for(let e of(t.faceXaxis=[],this.goldbergData.faceXaxis))t.faceXaxis.push(e.asArray());e.goldbergData=t}static Parse(e,t){let i=e.goldbergData;i.faceColors=i.faceColors.map(e=>a.HE.FromArray(e)),i.faceCenters=i.faceCenters.map(e=>s.P.FromArray(e)),i.faceZaxis=i.faceZaxis.map(e=>s.P.FromArray(e)),i.faceXaxis=i.faceXaxis.map(e=>s.P.FromArray(e)),i.faceYaxis=i.faceYaxis.map(e=>s.P.FromArray(e));let r=new l(e.name,t);return r.goldbergData=i,r}}},33416:function(e,t,i){i.d(t,{E:function(){return a}});var s=i(39884),r=i(93954),n=i(35823);n.Kj._GroundMeshParser=(e,t)=>a.Parse(e,t);class a extends n.Kj{constructor(e,t){super(e,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e,t=32){this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(e,t){let i=this.getWorldMatrix(),r=s.jp.Matrix[5];i.invertToRef(r);let n=s.jp.Vector3[8];if(s.P.TransformCoordinatesFromFloatsToRef(e,0,t,r,n),e=n.x,t=n.z,e<this._minX||e>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());let a=this._getFacetAt(e,t),o=-(a.x*e+a.z*t+a.w)/a.y;return s.P.TransformCoordinatesFromFloatsToRef(0,o,0,i,n),n.y}getNormalAtCoordinates(e,t){let i=new s.P(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i}getNormalAtCoordinatesToRef(e,t,i){let r=this.getWorldMatrix(),n=s.jp.Matrix[5];r.invertToRef(n);let a=s.jp.Vector3[8];if(s.P.TransformCoordinatesFromFloatsToRef(e,0,t,n,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());let o=this._getFacetAt(e,t);return s.P.TransformNormalFromFloatsToRef(o.x,o.y,o.z,r,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,t){let i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[s*this._subdivisionsX+i];return t<r.slope.x*e+r.slope.y?r.facet1:r.facet2}_initHeightQuads(){let e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=[];for(let i=0;i<t;i++)for(let t=0;t<e;t++){let r={slope:s.FM.Zero(),facet1:new s.Lt(0,0,0,0),facet2:new s.Lt(0,0,0,0)};this._heightQuads[i*e+t]=r}return this}_computeHeightQuads(){let e=this.getVerticesData(r.o.PositionKind);if(!e)return this;let t=s.jp.Vector3[3],i=s.jp.Vector3[2],n=s.jp.Vector3[1],a=s.jp.Vector3[0],o=s.jp.Vector3[4],l=s.jp.Vector3[5],h=s.jp.Vector3[6],u=s.jp.Vector3[7],d=s.jp.Vector3[8],c=0,f=0,p=0,_=0,g=0,x=0,m=0,T=this._subdivisionsX,E=this._subdivisionsY;for(let r=0;r<E;r++)for(let E=0;E<T;E++){c=3*E,f=r*(T+1)*3,p=(r+1)*(T+1)*3,t.x=e[f+c],t.y=e[f+c+1],t.z=e[f+c+2],i.x=e[f+c+3],i.y=e[f+c+4],i.z=e[f+c+5],n.x=e[p+c],n.y=e[p+c+1],n.z=e[p+c+2],a.x=e[p+c+3],a.y=e[p+c+4],a.z=e[p+c+5],_=(a.z-t.z)/(a.x-t.x),g=t.z-_*t.x,i.subtractToRef(t,o),n.subtractToRef(t,l),a.subtractToRef(t,h),s.P.CrossToRef(h,l,u),s.P.CrossToRef(o,h,d),u.normalize(),d.normalize(),x=-(u.x*t.x+u.y*t.y+u.z*t.z),m=-(d.x*i.x+d.y*i.y+d.z*i.z);let b=this._heightQuads[r*T+E];b.slope.copyFromFloats(_,g),b.facet1.copyFromFloats(u.x,u.y,u.z,x),b.facet2.copyFromFloats(d.x,d.y,d.z,m)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,t){let i=new a(e.name,t);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i}}},50356:function(e,t,i){i.d(t,{S:function(){return c}});var s=i(39884),r=i(9719),n=i(98396),a=i(35823),o=i(31642),l=i(3860),h=i(93954),u=i(4224),d=i(7724);a.Kj._instancedMeshFactory=(e,t)=>{let i=new c(e,t);if(t.instancedBuffers)for(let e in i.instancedBuffers={},t.instancedBuffers)i.instancedBuffers[e]=t.instancedBuffers[e];return i};class c extends n.x{constructor(e,t){for(let i of(super(e,t.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.addInstance(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice(),t.getAnimationRanges()))null!=i&&this.createAnimationRange(i.name,i.from,i.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(e){this._sourceMesh?.receiveShadows!==e&&u.w1.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(e){this._sourceMesh?.material!==e&&u.w1.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(e){this._sourceMesh?.visibility!==e&&u.w1.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(e){this._sourceMesh?.skeleton!==e&&u.w1.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&r.Y.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(e){return this._sourceMesh.createInstance(e)}isReady(e=!1){return this._sourceMesh.isReady(e,!0)}getVerticesData(e,t,i){return this._sourceMesh.getVerticesData(e,t,i)}copyVerticesData(e,t){this._sourceMesh.copyVerticesData(e,t)}setVerticesData(e,t,i,s){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,s),this.sourceMesh}updateVerticesData(e,t,i,s){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,s),this.sourceMesh}setIndices(e,t=null){return this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh}isVerticesDataPresent(e){return this._sourceMesh.isVerticesDataPresent(e)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(e=!1,t=!1){let i;if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;i="object"==typeof e?e:{applySkeleton:e,applyMorph:t};let s=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(i,null,h.o.PositionKind),s),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(e,t){if(super._activate(e,t),this._sourceMesh.subMeshes||r.Y.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==l.Y.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new s.y3);let e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,s.jp.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(s.jp.Vector3[7]),this._currentLOD._masterMesh=e,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(e){if(!e)return this;let t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){let t=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(e){return this.sourceMesh._preActivateForIntermediateRendering(e)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(e,t=null,i,s){let r=(s||this._sourceMesh).createInstance(e);if(o.j.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(let e=0;e<this.getScene().meshes.length;e++){let t=this.getScene().meshes[e];t.parent===this&&t.clone(t.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r}dispose(e,t=!1){this._sourceMesh.removeInstance(this),super.dispose(e,t)}_serializeAsParent(e){super._serializeAsParent(e),e.parentId=this._sourceMesh.uniqueId,e.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(e=null,t,i){let s=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0,t&&t.newSourcedMesh);for(let e of(s&&i&&i(this,s),this.getChildTransformNodes(!0)))e.instantiateHierarchy(s,t,i);return s}}a.Kj.prototype.registerInstancedBuffer=function(e,t){if(this._userInstancedBuffersStorage?.vertexBuffers[e]?.dispose(),!this.instancedBuffers)for(let e of(this.instancedBuffers={},this.instances))e.instancedBuffers={};for(let i of(this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new h.o(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0),this.instances))i.instancedBuffers[e]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},a.Kj.prototype._processInstancedBuffers=function(e,t){let i=e?e.length:0;for(let s in this.instancedBuffers){let r=this._userInstancedBuffersStorage.sizes[s],n=this._userInstancedBuffersStorage.strides[s],a=(i+1)*n;for(;r<a;)r*=2;this._userInstancedBuffersStorage.data[s].length!=r&&(this._userInstancedBuffersStorage.data[s]=new Float32Array(r),this._userInstancedBuffersStorage.sizes[s]=r,this._userInstancedBuffersStorage.vertexBuffers[s]&&(this._userInstancedBuffersStorage.vertexBuffers[s].dispose(),this._userInstancedBuffersStorage.vertexBuffers[s]=null));let o=this._userInstancedBuffersStorage.data[s],l=0;if(t){let e=this.instancedBuffers[s];e.toArray?e.toArray(o,l):e.copyToArray?e.copyToArray(o,l):o[l]=e,l+=n}for(let t=0;t<i;t++){let i=e[t].instancedBuffers[s];i.toArray?i.toArray(o,l):i.copyToArray?i.copyToArray(o,l):o[l]=i,l+=n}this._userInstancedBuffersStorage.vertexBuffers[s]?this._userInstancedBuffersStorage.vertexBuffers[s].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[s]=new h.o(this.getEngine(),this._userInstancedBuffersStorage.data[s],s,!0,!1,n,!0),this._invalidateInstanceVertexArrayObject())}},a.Kj.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(let e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},a.Kj.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(let e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,d.H7)("BABYLON.InstancedMesh",c)},63548:function(e,t,i){i.d(t,{E:function(){return u},_:function(){return h}});var s=i(57449),r=i(93954),n=i(35823),a=i(50356),o=i(5848),l=i(5377);n.Kj._LinesMeshParser=(e,t)=>h.Parse(e,t);class h extends n.Kj{_isShaderMaterial(e){return"ShaderMaterial"===e.getClassName()}constructor(e,t=null,n=null,a=null,o,u,d,c){super(e,t,n,a,o),this.useVertexColor=u,this.useVertexAlpha=d,this.color=new s.Wo(1,1,1),this.alpha=1,this._shaderLanguage=0,a&&(this.color=a.color.clone(),this.alpha=a.alpha,this.useVertexColor=a.useVertexColor,this.useVertexAlpha=a.useVertexAlpha),this.intersectionThreshold=.1;let f={attributes:[r.o.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};!1===d?f.needAlphaBlending=!1:f.defines.push("#define VERTEXALPHA"),u?(f.defines.push("#define VERTEXCOLOR"),f.attributes.push(r.o.ColorKind)):(f.uniforms.push("color"),this._color4=new s.HE),c?this.material=c:(this.getScene().getEngine().isWebGPU&&!h.ForceGLSL&&(this._shaderLanguage=1),f.shaderLanguage=this._shaderLanguage,f.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([i.e(2030).then(i.bind(i,92030)),i.e(5691).then(i.bind(i,65691))]):await Promise.all([i.e(9948).then(i.bind(i,19948)),i.e(8860).then(i.bind(i,8860))])},this.material=new l.j("colorShader",this.getScene(),"color",f,!1),this.material.doNotSerialize=!0)}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(e){this._lineMaterial=e,this._lineMaterial.fillMode=o.F.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(e){}_bind(e,t){if(!this._geometry)return this;let i=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){let{r:e,g:t,b:i}=this.color;this._color4.set(e,t,i,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;let s=this.getScene().getEngine();return this._unIndexed?s.drawArraysType(o.F.LineListDrawMode,e.verticesStart,e.verticesCount,i):s.drawElementsType(o.F.LineListDrawMode,e.indexStart,e.indexCount,i),this}dispose(e,t=!1,i){i||this._lineMaterial.dispose(!1,!1,!0),super.dispose(e)}clone(e,t=null,i){return new h(e,this.getScene(),t,this,i)}createInstance(e){let t=new u(e,this);if(this.instancedBuffers)for(let e in t.instancedBuffers={},this.instancedBuffers)t.instancedBuffers[e]=this.instancedBuffers[e];return t}serialize(e){super.serialize(e),e.color=this.color.asArray(),e.alpha=this.alpha}static Parse(e,t){let i=new h(e.name,t);return i.color=s.Wo.FromArray(e.color),i.alpha=e.alpha,i}}h.ForceGLSL=!1;class u extends a.S{constructor(e,t){super(e,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},62115:function(e,t,i){i.d(t,{V:function(){return M}});var s=i(57813),r=i(21947),n=i(63647),a=i(73722),o=i(85017),l=i(53413),h=i(77958),u=i(36556),d=i(23596),c=i(42257),f=i(52821),p=i(27283),_=i(74591),g=i(96799),x=i(96366),m=i(79470),T=i(617),E=i(62317),b=i(16),A=i(37542),P=i(21568),I=i(66589),v=i(67351);let M={CreateBox:n.NR,CreateTiledBox:a.cQ,CreateSphere:o.Qk,CreateDisc:r.uH,CreateIcoSphere:E.Au,CreateRibbon:s.LY,CreateCylinder:l.wf,CreateTorus:h.eu,CreateTorusKnot:u.eB,CreateLineSystem:d.xW,CreateLines:d.nL,CreateDashedLines:d.Gz,ExtrudeShape:f.Gc,ExtrudeShapeCustom:f.bC,CreateLathe:p.O,CreateTiledPlane:g.KA,CreatePlane:_.pT,CreateGround:x.$6,CreateTiledGround:x.DG,CreateGroundFromHeightMap:x.W,CreatePolygon:c.a4,ExtrudePolygon:c.Yo,CreateTube:m._,CreatePolyhedron:T.sh,CreateGeodesic:P.M,CreateGoldberg:I._,CreateDecal:b.t,CreateCapsule:A.iz,CreateText:v.p}},4601:function(e,t,i){i.d(t,{z:function(){return f}});var s=i(9719),r=i(39884),n=i(93954),a=i(35823),o=i(89754),l=i(83798),h=i(31644),u=i(51092);class d extends r.FM{constructor(e,t){super(e.x,e.y),this.index=t}}class c{constructor(){this.elements=[]}add(e){let t=[];return e.forEach(e=>{let i=new d(e,this.elements.length);t.push(i),this.elements.push(i)}),t}computeBounds(){let e=new r.FM(this.elements[0].x,this.elements[0].y),t=new r.FM(this.elements[0].x,this.elements[0].y);return this.elements.forEach(i=>{i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}}}class f{_addToepoint(e){for(let t of e)this._epoints.push(t.x,t.y)}constructor(e,t,i,r=earcut){let n;this._points=new c,this._outlinepoints=new c,this._holes=[],this._epoints=[],this._eholes=[],this.bjsEarcut=r,this._name=e,this._scene=i||u.l.LastCreatedScene,n=t instanceof l.ZZ?t.getPoints():t,this._addToepoint(n),this._points.add(n),this._outlinepoints.add(n),void 0===this.bjsEarcut&&s.Y.Warn("Earcut was not found, the polygon will not be built.")}addHole(e){this._points.add(e);let t=new c;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this}build(e=!1,t=0,i=2){let s=new a.Kj(this._name,this._scene),r=this.buildVertexData(t,i);return s.setVerticesData(n.o.PositionKind,r.positions,e),s.setVerticesData(n.o.NormalKind,r.normals,e),s.setVerticesData(n.o.UVKind,r.uvs,e),s.setIndices(r.indices),s}buildVertexData(e=0,t=2){let i=new o.x,s=[],r=[],n=[],a=this._points.computeBounds();this._points.elements.forEach(e=>{s.push(0,1,0),r.push(e.x,0,e.y),n.push((e.x-a.min.x)/a.width,(e.y-a.min.y)/a.height)});let l=[],h=this.bjsEarcut(this._epoints,this._eholes,2);for(let e=0;e<h.length;e++)l.push(h[e]);if(e>0){let i=r.length/3;this._points.elements.forEach(t=>{s.push(0,-1,0),r.push(t.x,-e,t.y),n.push(1-(t.x-a.min.x)/a.width,1-(t.y-a.min.y)/a.height)});let o=l.length;for(let e=0;e<o;e+=3){let t=l[e+0],s=l[e+1],r=l[e+2];l.push(r+i),l.push(s+i),l.push(t+i)}this._addSide(r,s,n,l,a,this._outlinepoints,e,!1,t),this._holes.forEach(i=>{this._addSide(r,s,n,l,a,i,e,!0,t)})}return i.indices=l,i.positions=r,i.normals=s,i.uvs=n,i}_addSide(e,t,i,s,n,a,o,l,u){let d=e.length/3,c=0;for(let f=0;f<a.elements.length;f++){let p=a.elements[f],_=a.elements[(f+1)%a.elements.length];e.push(p.x,0,p.y),e.push(p.x,-o,p.y),e.push(_.x,0,_.y),e.push(_.x,-o,_.y);let g=a.elements[(f+a.elements.length-1)%a.elements.length],x=a.elements[(f+2)%a.elements.length],m=new r.P(-(_.y-p.y),0,_.x-p.x),T=new r.P(-(p.y-g.y),0,p.x-g.x),E=new r.P(-(x.y-_.y),0,x.x-_.x);l||(m=m.scale(-1),T=T.scale(-1),E=E.scale(-1));let b=m.normalizeToNew(),A=T.normalizeToNew(),P=E.normalizeToNew(),I=r.P.Dot(A,b);A=I>u?I<h.kn-1?new r.P(p.x,0,p.y).subtract(new r.P(_.x,0,_.y)).normalize():T.add(m).normalize():b;let v=r.P.Dot(E,m);P=v>u?v<h.kn-1?new r.P(_.x,0,_.y).subtract(new r.P(p.x,0,p.y)).normalize():E.add(m).normalize():b,i.push(c/n.width,0),i.push(c/n.width,1),c+=m.length(),i.push(c/n.width,0),i.push(c/n.width,1),t.push(A.x,A.y,A.z),t.push(A.x,A.y,A.z),t.push(P.x,P.y,P.z),t.push(P.x,P.y,P.z),l?(s.push(d),s.push(d+2),s.push(d+1),s.push(d+1),s.push(d+2),s.push(d+3)):(s.push(d),s.push(d+1),s.push(d+2),s.push(d+1),s.push(d+3),s.push(d+2)),d+=4}}}},23891:function(e,t,i){i.d(t,{i:function(){return h}});var s=i(46456),r=i(49727),n=i(81209),a=i(7724),o=i(22287),l=i(90212);class h extends r.D{set kernel(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._blockCompilation||this._updateParameters())}get kernel(){return this._idealKernel}set packedFloat(e){this._packedFloat!==e&&(this._packedFloat=e,this._blockCompilation||this._updateParameters())}get packedFloat(){return this._packedFloat}getClassName(){return"BlurPostProcess"}constructor(e,t,i,s,r,a=n.x.BILINEAR_SAMPLINGMODE,o,l,h=0,u="",d=!1,c=5){super(e,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],s,r,a,o,l,null,h,"kernelBlur",{varyingCount:0,depCount:0},!0,c),this._blockCompilation=d,this._packedFloat=!1,this._staticDefines="",this._staticDefines=u,this.direction=t,this.onApplyObservable.add(e=>{this._outputTexture?e.setFloat2("delta",1/this._outputTexture.width*this.direction.x,1/this._outputTexture.height*this.direction.y):e.setFloat2("delta",1/this.width*this.direction.x,1/this.height*this.direction.y)}),this.kernel=i}_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([i.e(4669).then(i.bind(i,74669)),i.e(5250).then(i.bind(i,25250))]))):t.push(Promise.all([i.e(4378).then(i.bind(i,54378)),i.e(1778).then(i.bind(i,1778))])),super._gatherImports(e,t)}updateEffect(e=null,t=null,i=null,s,r,n){this._updateParameters(r,n)}_updateParameters(e,t){let i=this._kernel,s=(i-1)/2,r=[],n=[],a=0;for(let e=0;e<i;e++){let t=e/(i-1),o=this._gaussianWeight(2*t-1);r[e]=e-s,n[e]=o,a+=o}for(let e=0;e<n.length;e++)n[e]/=a;let o=[],l=[],h=[];for(let e=0;e<=s;e+=2){let t=Math.min(e+1,Math.floor(s));if(e===t)h.push({o:r[e],w:n[e]});else{let i=t===s,a=n[e]+n[t]*(i?.5:1),o=r[e]+1/(1+n[e]/n[t]);0===o?(h.push({o:r[e],w:n[e]}),h.push({o:r[e+1],w:n[e+1]})):(h.push({o:o,w:a}),h.push({o:-o,w:a}))}}for(let e=0;e<h.length;e++)l[e]=h[e].o,o[e]=h[e].w;r=l,n=o;let u=Math.max(this.getEngine().getCaps().maxVaryingVectors-(1===this.shaderLanguage?1:0),0)-1,d=Math.min(r.length,u),c="";c+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(c+=`#define CENTER_WEIGHT ${this._glslFloat(n[d-1])}
`,d--);for(let e=0;e<d;e++)c+=`#define KERNEL_OFFSET${e} ${this._glslFloat(r[e])}
#define KERNEL_WEIGHT${e} ${this._glslFloat(n[e])}
`;let f=0;for(let e=u;e<r.length;e++)c+=`#define KERNEL_DEP_OFFSET${f} ${this._glslFloat(r[e])}
#define KERNEL_DEP_WEIGHT${f} ${this._glslFloat(n[e])}
`,f++;this.packedFloat&&(c+="#define PACKEDFLOAT 1"),this._blockCompilation=!1,super.updateEffect(c,null,null,{varyingCount:d,depCount:f},e,t)}_nearestBestKernel(e){let t=Math.round(e);for(let e of[t,t-1,t+1,t-2,t+2])if(e%2!=0&&Math.floor(e/2)%2==0&&e>0)return Math.max(e,3);return Math.max(t,3)}_gaussianWeight(e){return 1/(1/3*Math.sqrt(2*Math.PI))*Math.exp(-(e*e/(1/3*2*(1/3))))}_glslFloat(e,t=8){return e.toFixed(t).replace(/0+$/,"")}static _Parse(e,t,i,s){return l.p.Parse(()=>new h(e.name,e.direction,e.kernel,e.options,t,e.renderTargetSamplingMode,i.getEngine(),e.reusable,e.textureType,void 0,!1),e,i,s)}}(0,s.gn)([(0,o.qC)("kernel")],h.prototype,"_kernel",void 0),(0,s.gn)([(0,o.qC)("packedFloat")],h.prototype,"_packedFloat",void 0),(0,s.gn)([(0,o.QC)()],h.prototype,"direction",void 0),(0,a.H7)("BABYLON.BlurPostProcess",h)},48250:function(e,t,i){var s=i(44755),r=i(93954),n=i(98396),a=i(39884),o=i(93287),l=i(32253),h=i(5848),u=i(5377),d=i(57449),c=i(82877),f=i(83260),p=i(76608),_=i(63647);Object.defineProperty(s.x.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(e){this._forceShowBoundingBoxes=e,e&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),s.x.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new g(this)),this._boundingBoxRenderer},Object.defineProperty(n.x.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(e){this._showBoundingBox=e,e&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});class g{get shaderLanguage(){return this._shaderLanguage}constructor(e){this.name=l.l.NAME_BOUNDINGBOXRENDERER,this.frontColor=new d.Wo(1,1,1),this.backColor=new d.Wo(.1,.1,.1),this.showBackLines=!0,this.onBeforeBoxRenderingObservable=new c.y$,this.onAfterBoxRenderingObservable=new c.y$,this.onResourcesReadyObservable=new c.y$,this.enabled=!0,this._shaderLanguage=0,this.renderList=new o.t(32),this._vertexBuffers={},this._fillIndexBuffer=null,this._fillIndexData=null,this.scene=e,this.scene.getEngine().isWebGPU&&(this._shaderLanguage=1),e._addComponent(this),this._uniformBufferFront=new p.M(this.scene.getEngine(),void 0,void 0,"BoundingBoxRendererFront",!0),this._buildUniformLayout(this._uniformBufferFront),this._uniformBufferBack=new p.M(this.scene.getEngine(),void 0,void 0,"BoundingBoxRendererBack",!0),this._buildUniformLayout(this._uniformBufferBack)}_buildUniformLayout(e){e.addUniform("color",4),e.addUniform("world",16),e.addUniform("viewProjection",16),e.addUniform("viewProjectionR",16),e.create()}register(){this.scene._beforeEvaluateActiveMeshStage.registerStep(l.l.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._preActiveMeshStage.registerStep(l.l.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,this,this._preActiveMesh),this.scene._evaluateSubMeshStage.registerStep(l.l.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(l.l.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)}_evaluateSubMesh(e,t){if(e.showSubMeshesBoundingBox){let i=t.getBoundingInfo();null!=i&&(i.boundingBox._tag=e.renderingGroupId,this.renderList.push(i.boundingBox))}}_preActiveMesh(e){if(e.showBoundingBox||this.scene.forceShowBoundingBoxes){let t=e.getBoundingInfo();t.boundingBox._tag=e.renderingGroupId,this.renderList.push(t.boundingBox)}}_prepareResources(){if(this._colorShader)return;this._colorShader=new u.j("colorShader",this.scene,"boundingBoxRenderer",{attributes:[r.o.PositionKind],uniforms:["world","viewProjection","viewProjectionR","color"],uniformBuffers:["BoundingBoxRenderer"],shaderLanguage:this._shaderLanguage,extraInitializationsAsync:async()=>{1===this._shaderLanguage?await Promise.all([i.e(6018).then(i.bind(i,96018)),i.e(3581).then(i.bind(i,23581))]):await Promise.all([i.e(4359).then(i.bind(i,94359)),i.e(8272).then(i.bind(i,48272))])}},!1),this._colorShader.doNotSerialize=!0,this._colorShader.reservedDataStore={hidden:!0},this._colorShaderForOcclusionQuery=new u.j("colorShaderOccQuery",this.scene,"boundingBoxRenderer",{attributes:[r.o.PositionKind],uniforms:["world","viewProjection","viewProjectionR","color"],uniformBuffers:["BoundingBoxRenderer"],shaderLanguage:this._shaderLanguage,extraInitializationsAsync:async()=>{1===this._shaderLanguage?await Promise.all([i.e(6018).then(i.bind(i,96018)),i.e(3581).then(i.bind(i,23581))]):await Promise.all([i.e(4359).then(i.bind(i,94359)),i.e(8272).then(i.bind(i,48272))])}},!0),this._colorShaderForOcclusionQuery.doNotSerialize=!0,this._colorShaderForOcclusionQuery.reservedDataStore={hidden:!0};let e=this.scene.getEngine(),t=(0,_.aR)({size:1});this._vertexBuffers[r.o.PositionKind]=new r.o(e,t.positions,r.o.PositionKind,!1),this._createIndexBuffer(),this._fillIndexData=t.indices,this.onResourcesReadyObservable.notifyObservers(this)}_createIndexBuffer(){let e=this.scene.getEngine();this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}rebuild(){let e=this._vertexBuffers[r.o.PositionKind];e&&e._rebuild(),this._createIndexBuffer()}reset(){this.renderList.reset()}render(e){if(0===this.renderList.length||!this.enabled||(this._prepareResources(),!this._colorShader.isReady()))return;let t=this.scene.getEngine();t.setDepthWrite(!1);let i=this.scene.getTransformMatrix();for(let s=0;s<this.renderList.length;s++){let r=this.renderList.data[s];if(r._tag!==e)continue;this._createWrappersForBoundingBox(r),this.onBeforeBoxRenderingObservable.notifyObservers(r);let n=r.minimum,o=r.maximum.subtract(n),l=n.add(o.scale(.5)),u=a.y3.Scaling(o.x,o.y,o.z).multiply(a.y3.Translation(l.x,l.y,l.z)).multiply(r.getWorldMatrix()),d=t.useReverseDepthBuffer;if(this.showBackLines){let e=r._drawWrapperBack??this._colorShader._getDrawWrapper();this._colorShader._preBind(e),t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),d?t.setDepthFunctionToLessOrEqual():t.setDepthFunctionToGreaterOrEqual(),this._uniformBufferBack.bindToEffect(e.effect,"BoundingBoxRenderer"),this._uniformBufferBack.updateColor4("color",this.backColor,1),this._uniformBufferBack.updateMatrix("world",u),this._uniformBufferBack.updateMatrix("viewProjection",i),this._uniformBufferBack.update(),t.drawElementsType(h.F.LineListDrawMode,0,24)}let c=r._drawWrapperFront??this._colorShader._getDrawWrapper();this._colorShader._preBind(c),t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),d?t.setDepthFunctionToGreater():t.setDepthFunctionToLess(),this._uniformBufferFront.bindToEffect(c.effect,"BoundingBoxRenderer"),this._uniformBufferFront.updateColor4("color",this.frontColor,1),this._uniformBufferFront.updateMatrix("world",u),this._uniformBufferFront.updateMatrix("viewProjection",i),this._uniformBufferFront.update(),t.drawElementsType(h.F.LineListDrawMode,0,24),this.onAfterBoxRenderingObservable.notifyObservers(r)}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}_createWrappersForBoundingBox(e){if(!e._drawWrapperFront){let t=this.scene.getEngine();e._drawWrapperFront=new f.q(t),e._drawWrapperBack=new f.q(t),e._drawWrapperFront.setEffect(this._colorShader.getEffect()),e._drawWrapperBack.setEffect(this._colorShader.getEffect())}}renderOcclusionBoundingBox(e){let t=this.scene.getEngine();void 0===this._renderPassIdForOcclusionQuery&&(this._renderPassIdForOcclusionQuery=t.createRenderPassId("Render pass for occlusion query"));let i=t.currentRenderPassId;t.currentRenderPassId=this._renderPassIdForOcclusionQuery,this._prepareResources();let s=e.subMeshes[0];if(!this._colorShaderForOcclusionQuery.isReady(e,void 0,s)||!e.hasBoundingInfo){t.currentRenderPassId=i;return}this._fillIndexBuffer||(this._fillIndexBuffer=t.createIndexBuffer(this._fillIndexData));let r=t.useReverseDepthBuffer;t.setDepthWrite(!1),t.setColorWrite(!1);let n=e.getBoundingInfo().boundingBox,o=n.minimum,l=n.maximum.subtract(o),u=o.add(l.scale(.5)),d=a.y3.Scaling(l.x,l.y,l.z).multiply(a.y3.Translation(u.x,u.y,u.z)).multiply(n.getWorldMatrix()),c=s._drawWrapper;this._colorShaderForOcclusionQuery._preBind(c),t.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,c.effect),r?t.setDepthFunctionToGreater():t.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._uniformBufferFront.bindToEffect(c.effect,"BoundingBoxRenderer"),this._uniformBufferFront.updateMatrix("world",d),this._uniformBufferFront.updateMatrix("viewProjection",this.scene.getTransformMatrix()),this._uniformBufferFront.update(),t.drawElementsType(h.F.TriangleFillMode,0,36),this._colorShaderForOcclusionQuery.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0),t.setColorWrite(!0),t.currentRenderPassId=i}dispose(){if(void 0!==this._renderPassIdForOcclusionQuery&&(this.scene.getEngine().releaseRenderPassId(this._renderPassIdForOcclusionQuery),this._renderPassIdForOcclusionQuery=void 0),!this._colorShader)return;this.onBeforeBoxRenderingObservable.clear(),this.onAfterBoxRenderingObservable.clear(),this.onResourcesReadyObservable.clear(),this.renderList.dispose(),this._colorShader.dispose(),this._colorShaderForOcclusionQuery.dispose(),this._uniformBufferFront.dispose(),this._uniformBufferBack.dispose();let e=this._vertexBuffers[r.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.o.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer),this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}}}}]);