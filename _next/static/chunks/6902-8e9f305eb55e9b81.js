"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6902],{9521:function(t,e,i){i.d(e,{O:function(){return o}});var r=i(46456),s=i(22287),n=i(4224),a=i(74909);class o{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(t){t=n.w1.BackCompatCameraNoPreventDefault(arguments);let e=this.camera.getEngine(),i=e.getInputElement(),r=0,s=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{let o=n.event,h="touch"===o.pointerType;if(n.type!==a.kD.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;let d=o.target;if(this._altKey=o.altKey,this._ctrlKey=o.ctrlKey,this._metaKey=o.metaKey,this._shiftKey=o.shiftKey,this._buttonsPressed=o.buttons,e.isPointerLock){let t=o.movementX,e=o.movementY;this.onTouch(null,t,e),this._pointA=null,this._pointB=null}else if(n.type!==a.kD.POINTERDOWN&&n.type!==a.kD.POINTERDOUBLETAP&&h&&this._pointA?.pointerId!==o.pointerId&&this._pointB?.pointerId!==o.pointerId)return;else if(n.type===a.kD.POINTERDOWN&&(-1===this._currentActiveButton||h)){try{d?.setPointerCapture(o.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType};else{if(null!==this._pointB)return;this._pointB={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType}}-1!==this._currentActiveButton||h||(this._currentActiveButton=o.button),this.onButtonDown(o),!t&&(o.preventDefault(),i&&i.focus())}else if(n.type===a.kD.POINTERDOUBLETAP)this.onDoubleTap(o.pointerType);else if(n.type===a.kD.POINTERUP&&(this._currentActiveButton===o.button||h)){try{d?.releasePointerCapture(o.pointerId)}catch(t){}h||(this._pointB=null),e._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==o.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==o.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==r||s)&&(this.onMultiTouch(this._pointA,this._pointB,r,0,s,null),r=0,s=null),this._currentActiveButton=-1,this.onButtonUp(o),t||o.preventDefault()}else if(n.type===a.kD.POINTERMOVE){if(t||o.preventDefault(),this._pointA&&null===this._pointB){let t=o.clientX-this._pointA.x,e=o.clientY-this._pointA.y;this._pointA.x=o.clientX,this._pointA.y=o.clientY,this.onTouch(this._pointA,t,e)}else if(this._pointA&&this._pointB){let t=this._pointA.pointerId===o.pointerId?this._pointA:this._pointB;t.x=o.clientX,t.y=o.clientY;let e=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,a=e*e+i*i,h={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:o.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,r,a,s,h),s=h,r=a}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,a.kD.POINTERDOWN|a.kD.POINTERUP|a.kD.POINTERMOVE|a.kD.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,r=0,s=null,this.onLostFocus()},this._contextMenuBind=t=>this.onContextMenu(t),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);let o=this.camera.getScene().getEngine().getHostWindow();o&&n.w1.RegisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){let t=this.camera.getScene().getEngine().getHostWindow();t&&n.w1.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){let t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,e,i){}onMultiTouch(t,e,i,r,s,n){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,r.gn)([(0,s.qC)()],o.prototype,"buttons",void 0)},35558:function(t,e,i){i.d(e,{R:function(){return o}});var r=i(46456),s=i(22287),n=i(94656),a=i(49109);class o{constructor(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(t){this._yAxisScale=t?-1:1}attachControl(){let t=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add(t=>{t.type===a.nJ.POSE_ENABLED||this.gamepad&&t.type!==a.nJ.XBOX||(this.gamepad=t)}),this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add(t=>{this.gamepad===t&&(this.gamepad=null)}),this.gamepad=t.getGamepadByType(a.nJ.XBOX),!this.gamepad&&t.gamepads.length&&(this.gamepad=t.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad){let t=this.camera,e=this.gamepad.rightStick;if(e){if(0!=e.x){let i=e.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(t.inertialAlphaOffset+=i)}if(0!=e.y){let i=e.y/this.gamepadRotationSensibility*this._yAxisScale;0!=i&&Math.abs(i)>.005&&(t.inertialBetaOffset+=i)}}let i=this.gamepad.leftStick;if(i&&0!=i.y){let t=i.y/this.gamepadMoveSensibility;0!=t&&Math.abs(t)>.005&&(this.camera.inertialRadiusOffset-=t)}}}getClassName(){return"ArcRotateCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,r.gn)([(0,s.qC)()],o.prototype,"gamepadRotationSensibility",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"gamepadMoveSensibility",void 0),n.u.ArcRotateCameraGamepadInput=o},98934:function(t,e,i){i.d(e,{v:function(){return h}});var r=i(46456),s=i(22287),n=i(94656),a=i(22710),o=i(4224);class h{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=[]}attachControl(t){t=o.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(()=>{this._keys.length=0}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(e=>{let i=e.event;if(!i.metaKey){if(e.type===a.OG.KEYDOWN)this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode))&&(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&!t&&i.preventDefault());else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){let e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),i.preventDefault&&!t&&i.preventDefault()}}}))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){let t=this.camera;for(let e=0;e<this._keys.length;e++){let i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,r.gn)([(0,s.qC)()],h.prototype,"keysUp",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"keysDown",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"keysLeft",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"keysRight",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"keysReset",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"panningSensibility",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"zoomingSensibility",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"useAltToZoom",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"angularSpeed",void 0),n.u.ArcRotateCameraKeyboardMoveInput=h},55364:function(t,e,i){i.d(e,{F:function(){return m}});var r=i(46456),s=i(22287),n=i(94656),a=i(74909),o=i(47941),h=i(39884),d=i(31644),l=i(66508),c=i(65330),u=i(4224);class m{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new h.P(0,0,0),this._globalOffset=new h.P(0,0,0),this._inertialPanning=h.P.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,e){let i=.01*t*this.wheelDeltaPercentage*e;return t>0?i/(1+this.wheelDeltaPercentage):i*(1+this.wheelDeltaPercentage)}attachControl(t){t=u.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==a.kD.POINTERWHEEL)return;let i=e.event,r=0,s=i.deltaMode===l.G.DOM_DELTA_LINE?40:1,n=-(i.deltaY*s);if(this.customComputeDeltaFromMouseWheel)r=this.customComputeDeltaFromMouseWheel(n,this,i);else if(this.wheelDeltaPercentage){if((r=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius))>0){let t=this.camera.radius,e=this.camera.inertialRadiusOffset+r;for(let i=0;i<20&&Math.abs(e)>.001;i++)t-=e,e*=this.camera.inertia;t=(0,c.Clamp)(t,0,Number.MAX_VALUE),r=this._computeDeltaFromMouseWheelLegacyEvent(n,t)}}else r=n/(40*this.wheelPrecision);r&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(r)):this.camera.inertialRadiusOffset+=r),i.preventDefault&&!t&&i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,a.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;let t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){let t=this.camera,e=t.target.subtract(t.position);this._hitPlane=o.J.FromPositionAndNormal(t.target,e)}_getPosition(){let t=this.camera,e=t.getScene(),i=e.createPickingRay(e.pointerX,e.pointerY,h.y3.Identity(),t,!1);(0!==t.targetScreenOffset.x||0!==t.targetScreenOffset.y)&&(this._viewOffset.set(t.targetScreenOffset.x,t.targetScreenOffset.y,0),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),this._globalOffset=h.P.TransformNormal(this._viewOffset,t._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let r=0;return this._hitPlane&&(r=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(r))}_zoomToMouse(t){let e=this.camera,i=1-e.inertia;if(e.lowerRadiusLimit){let r=e.lowerRadiusLimit??0;e.radius-(e.inertialRadiusOffset+t)/i<r&&(t=(e.radius-r)*i-e.inertialRadiusOffset)}if(e.upperRadiusLimit){let r=e.upperRadiusLimit??0;e.radius-(e.inertialRadiusOffset+t)/i>r&&(t=(e.radius-r)*i-e.inertialRadiusOffset)}let r=t/i/e.radius,s=this._getPosition(),n=h.jp.Vector3[6];s.subtractToRef(e.target,n),n.scaleInPlace(r),n.scaleInPlace(i),this._inertialPanning.addInPlace(n),e.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<d.kn&&(t.x=0),Math.abs(t.y)<d.kn&&(t.y=0),Math.abs(t.z)<d.kn&&(t.z=0)}}(0,r.gn)([(0,s.qC)()],m.prototype,"wheelPrecision",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"zoomToMouseLocation",void 0),(0,r.gn)([(0,s.qC)()],m.prototype,"wheelDeltaPercentage",void 0),n.u.ArcRotateCameraMouseWheelInput=m},30103:function(t,e,i){i.d(e,{H:function(){return o}});var r=i(46456),s=i(22287),n=i(94656),a=i(9521);class o extends a.O{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,e){if(0!==this.panningSensibility&&t&&e){let i=e.x-t.x,r=e.y-t.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility}}_computePinchZoom(t,e){let i=this.camera.radius||o.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(t)/Math.sqrt(e):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(e-t)*.001*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,e,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,e,i,r,s,n){(0!==i||null!==s)&&(0!==r||null!==n)&&(this.multiTouchPanAndZoom?(this._computePinchZoom(i,r),this._computeMultiTouchPanning(s,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(r)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,r),this._isPinching=!0):this._computeMultiTouchPanning(s,n)):this.multiTouchPanning?this._computeMultiTouchPanning(s,n):this.pinchZoom&&this._computePinchZoom(i,r))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(t){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}o.MinimumRadiusForPinch=.001,(0,r.gn)([(0,s.qC)()],o.prototype,"buttons",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"angularSensibilityX",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"angularSensibilityY",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"pinchPrecision",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"pinchDeltaPercentage",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"useNaturalPinchZoom",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"pinchZoom",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"panningSensibility",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"multiTouchPanning",void 0),(0,r.gn)([(0,s.qC)()],o.prototype,"multiTouchPanAndZoom",void 0),n.u.ArcRotateCameraPointersInput=o},57982:function(t,e,i){i.d(e,{c:function(){return h}});var r=i(46456),s=i(22287),n=i(94656),a=i(39884),o=i(49109);class h{constructor(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=a.y3.Identity(),this._deltaTransform=a.P.Zero(),this._vector3=a.P.Zero(),this._vector2=a.FM.Zero()}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(t){this._yAxisScale=t?-1:1}attachControl(){let t=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add(t=>{t.type===o.nJ.POSE_ENABLED||this.gamepad&&t.type!==o.nJ.XBOX||(this.gamepad=t)}),this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add(t=>{this.gamepad===t&&(this.gamepad=null)}),this.gamepad=t.getGamepadByType(o.nJ.XBOX),!this.gamepad&&t.gamepads.length&&(this.gamepad=t.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad&&this.gamepad.leftStick){let t=this.camera,e=this.gamepad.leftStick;0!==this.gamepadMoveSensibility&&(e.x=Math.abs(e.x)>this.deadzoneDelta?e.x/this.gamepadMoveSensibility:0,e.y=Math.abs(e.y)>this.deadzoneDelta?e.y/this.gamepadMoveSensibility:0);let i=this.gamepad.rightStick;i&&0!==this.gamepadAngularSensibility?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):a.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);let r=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*r,0,-e.y*r),a.P.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),t.cameraRotation.addInPlace(this._vector2)}}getClassName(){return"FreeCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,r.gn)([(0,s.qC)()],h.prototype,"gamepadAngularSensibility",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"gamepadMoveSensibility",void 0),n.u.FreeCameraGamepadInput=h},87431:function(t,e,i){i.d(e,{$:function(){return o}});var r=i(30103),s=i(98934),n=i(55364),a=i(94656);class o extends a.p{constructor(t){super(t)}addMouseWheel(){return this.add(new n.F),this}addPointers(){return this.add(new r.H),this}addKeyboard(){return this.add(new s.v),this}}},45637:function(t,e,i){i.d(e,{H:function(){return n}});var r=i(16606),s=i(39884);i(67020).N.AddNodeConstructor("TouchCamera",(t,e)=>()=>new n(t,s.P.Zero(),e));class n extends r.c{get touchAngularSensibility(){let t=this.inputs.attached.touch;return t?t.touchAngularSensibility:0}set touchAngularSensibility(t){let e=this.inputs.attached.touch;e&&(e.touchAngularSensibility=t)}get touchMoveSensibility(){let t=this.inputs.attached.touch;return t?t.touchMoveSensibility:0}set touchMoveSensibility(t){let e=this.inputs.attached.touch;e&&(e.touchMoveSensibility=t)}constructor(t,e,i){super(t,e,i),this.inputs.addTouch(),this._setupInputs()}getClassName(){return"TouchCamera"}_setupInputs(){let t=this.inputs.attached.touch,e=this.inputs.attached.mouse;e?e.touchEnabled=!t:t.allowMouse=!e}}},64765:function(t,e,i){i.d(e,{x:function(){return o}});var r=i(45637),s=i(67020),n=i(39884),a=i(35910);i(99632),s.N.AddNodeConstructor("FreeCamera",(t,e)=>()=>new o(t,n.P.Zero(),e));class o extends r.H{get gamepadAngularSensibility(){let t=this.inputs.attached.gamepad;return t?t.gamepadAngularSensibility:0}set gamepadAngularSensibility(t){let e=this.inputs.attached.gamepad;e&&(e.gamepadAngularSensibility=t)}get gamepadMoveSensibility(){let t=this.inputs.attached.gamepad;return t?t.gamepadMoveSensibility:0}set gamepadMoveSensibility(t){let e=this.inputs.attached.gamepad;e&&(e.gamepadMoveSensibility=t)}constructor(t,e,i){super(t,e,i),this.inputs.addGamepad()}getClassName(){return"UniversalCamera"}}a.V._CreateDefaultParsedCamera=(t,e)=>new o(t,n.P.Zero(),e)},52111:function(t,e,i){i.d(e,{Xq:function(){return d}});var r,s,n,a,o=i(82877),h=i(49109);(r=n||(n={}))[r.Cross=0]="Cross",r[r.Circle=1]="Circle",r[r.Square=2]="Square",r[r.Triangle=3]="Triangle",r[r.L1=4]="L1",r[r.R1=5]="R1",r[r.Share=8]="Share",r[r.Options=9]="Options",r[r.LeftStick=10]="LeftStick",r[r.RightStick=11]="RightStick",(s=a||(a={}))[s.Up=12]="Up",s[s.Down=13]="Down",s[s.Left=14]="Left",s[s.Right=15]="Right";class d extends h.nJ{constructor(t,e,i){super(t.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),e,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new o.y$,this.onButtonUpObservable=new o.y$,this.onPadDownObservable=new o.y$,this.onPadUpObservable=new o.y$,this._buttonCross=0,this._buttonCircle=0,this._buttonSquare=0,this._buttonTriangle=0,this._buttonShare=0,this._buttonOptions=0,this._buttonL1=0,this._buttonR1=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this.type=h.nJ.DUALSHOCK}onlefttriggerchanged(t){this._onlefttriggerchanged=t}onrighttriggerchanged(t){this._onrighttriggerchanged=t}get leftTrigger(){return this._leftTrigger}set leftTrigger(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t}get rightTrigger(){return this._rightTrigger}set rightTrigger(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t}onbuttondown(t){this._onbuttondown=t}onbuttonup(t){this._onbuttonup=t}ondpaddown(t){this._ondpaddown=t}ondpadup(t){this._ondpadup=t}_setButtonValue(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t}_setDPadValue(t,e,i){return t!==e&&(1===t&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===t&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),t}get buttonCross(){return this._buttonCross}set buttonCross(t){this._buttonCross=this._setButtonValue(t,this._buttonCross,0)}get buttonCircle(){return this._buttonCircle}set buttonCircle(t){this._buttonCircle=this._setButtonValue(t,this._buttonCircle,1)}get buttonSquare(){return this._buttonSquare}set buttonSquare(t){this._buttonSquare=this._setButtonValue(t,this._buttonSquare,2)}get buttonTriangle(){return this._buttonTriangle}set buttonTriangle(t){this._buttonTriangle=this._setButtonValue(t,this._buttonTriangle,3)}get buttonOptions(){return this._buttonOptions}set buttonOptions(t){this._buttonOptions=this._setButtonValue(t,this._buttonOptions,9)}get buttonShare(){return this._buttonShare}set buttonShare(t){this._buttonShare=this._setButtonValue(t,this._buttonShare,8)}get buttonL1(){return this._buttonL1}set buttonL1(t){this._buttonL1=this._setButtonValue(t,this._buttonL1,4)}get buttonR1(){return this._buttonR1}set buttonR1(t){this._buttonR1=this._setButtonValue(t,this._buttonR1,5)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(t){this._buttonLeftStick=this._setButtonValue(t,this._buttonLeftStick,10)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(t){this._buttonRightStick=this._setButtonValue(t,this._buttonRightStick,11)}get dPadUp(){return this._dPadUp}set dPadUp(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,12)}get dPadDown(){return this._dPadDown}set dPadDown(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,13)}get dPadLeft(){return this._dPadLeft}set dPadLeft(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,14)}get dPadRight(){return this._dPadRight}set dPadRight(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,15)}update(){super.update(),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}},49109:function(t,e,i){i.d(e,{If:function(){return n},nJ:function(){return s}});var r=i(82877);class s{get isConnected(){return this._isConnected}constructor(t,e,i,r=0,n=1,a=2,o=3){this.id=t,this.index=e,this.browserGamepad=i,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=s.GAMEPAD,this._leftStickAxisX=r,this._leftStickAxisY=n,this._rightStickAxisX=a,this._rightStickAxisY=o,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}onleftstickchanged(t){this._onleftstickchanged=t}onrightstickchanged(t){this._onrightstickchanged=t}get leftStick(){return this._leftStick}set leftStick(t){this._onleftstickchanged&&(this._leftStick.x!==t.x||this._leftStick.y!==t.y)&&this._onleftstickchanged(t),this._leftStick=t}get rightStick(){return this._rightStick}set rightStick(t){this._onrightstickchanged&&(this._rightStick.x!==t.x||this._rightStick.y!==t.y)&&this._onrightstickchanged(t),this._rightStick=t}update(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}dispose(){}}s.GAMEPAD=0,s.GENERIC=1,s.XBOX=2,s.POSE_ENABLED=3,s.DUALSHOCK=4;class n extends s{onbuttondown(t){this._onbuttondown=t}onbuttonup(t){this._onbuttonup=t}constructor(t,e,i){super(t,e,i),this.onButtonDownObservable=new r.y$,this.onButtonUpObservable=new r.y$,this.type=s.GENERIC,this._buttons=Array(i.buttons.length)}_setButtonValue(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t}update(){super.update();for(let t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()}}},30990:function(t,e,i){i.d(e,{v:function(){return l}});var r=i(82877),s=i(28143),n=i(8434),a=i(49109),o=i(52111),h=i(4224),d=i(3176);class l{constructor(t){if(this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new r.y$,(0,s.CG)()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator&&navigator.getGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new r.y$(t=>{for(let e in this._babylonGamepads){let i=this._babylonGamepads[e];i&&i._isConnected&&this.onGamepadConnectedObservable.notifyObserver(t,i)}}),this._onGamepadConnectedEvent=t=>{let e;let i=t.gamepad;i.index in this._babylonGamepads&&this._babylonGamepads[i.index].isConnected||(this._babylonGamepads[i.index]?((e=this._babylonGamepads[i.index]).browserGamepad=i,e._isConnected=!0):e=this._addNewGamepad(i),this.onGamepadConnectedObservable.notifyObservers(e),this._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=t=>{let e=t.gamepad;for(let t in this._babylonGamepads)if(this._babylonGamepads[t].index===e.index){let e=this._babylonGamepads[t];e._isConnected=!1,this.onGamepadDisconnectedObservable.notifyObservers(e),e.dispose&&e.dispose();break}},this._gamepadSupport){if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){let t=this._scene?this._scene.getEngine().getHostWindow():window;t&&(t.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),t.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}}get gamepads(){return this._babylonGamepads}getGamepadByType(t=a.nJ.XBOX){for(let e of this._babylonGamepads)if(e&&e.type===t)return e;return null}dispose(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(t=>{t.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]}_addNewGamepad(t){let e;this._oneGamepadConnected||(this._oneGamepadConnected=!0);let i=-1!==t.id.search("054c")&&-1===t.id.search("0ce6"),r=-1!==t.id.search("Xbox One");return e=r||-1!==t.id.search("Xbox 360")||-1!==t.id.search("xinput")||-1!==t.id.search("045e")&&-1===t.id.search("Surface Dock")?new n.FI(t.id,t.index,t,r):i?new o.Xq(t.id,t.index,t):new a.If(t.id,t.index,t),this._babylonGamepads[e.index]=e,e}_startMonitoringGamepads(){this._isMonitoring||(this._isMonitoring=!0,this._checkGamepadsStatus())}_stopMonitoringGamepads(){this._isMonitoring=!1}_checkGamepadsStatus(){for(let t in this._updateGamepadObjects(),this._babylonGamepads){let e=this._babylonGamepads[t];if(e&&e.isConnected)try{e.update()}catch{-1===this._loggedErrors.indexOf(e.index)&&(h.w1.Warn(`Error updating gamepad ${e.id}`),this._loggedErrors.push(e.index))}}this._isMonitoring&&d.a.QueueNewFrame(()=>{this._checkGamepadsStatus()})}_updateGamepadObjects(){let t=navigator.getGamepads?navigator.getGamepads():[];for(let e=0;e<t.length;e++){let i=t[e];if(i){if(this._babylonGamepads[i.index])this._babylonGamepads[e].browserGamepad=i,this._babylonGamepads[e].isConnected||(this._babylonGamepads[e]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[e]));else{let t=this._addNewGamepad(i);this.onGamepadConnectedObservable.notifyObservers(t)}}}}}},99632:function(t,e,i){var r=i(44755),s=i(32253),n=i(30990),a=i(7603),o=i(57982),h=i(87431),d=i(35558);Object.defineProperty(r.x.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new n.v(this);let t=this._getComponent(s.l.NAME_GAMEPAD);t||(t=new l(this),this._addComponent(t))}return this._gamepadManager},enumerable:!0,configurable:!0}),a.a.prototype.addGamepad=function(){return this.add(new o.c),this},h.$.prototype.addGamepad=function(){return this.add(new d.R),this};class l{constructor(t){this.name=s.l.NAME_GAMEPAD,this.scene=t}register(){this.scene._beforeCameraUpdateStage.registerStep(s.l.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)}rebuild(){}dispose(){let t=this.scene._gamepadManager;t&&(t.dispose(),this.scene._gamepadManager=null)}_beforeCameraUpdate(){let t=this.scene._gamepadManager;t&&t._isMonitoring&&t._checkGamepadsStatus()}}},8434:function(t,e,i){i.d(e,{FI:function(){return d}});var r,s,n,a,o=i(82877),h=i(49109);(r=n||(n={}))[r.A=0]="A",r[r.B=1]="B",r[r.X=2]="X",r[r.Y=3]="Y",r[r.LB=4]="LB",r[r.RB=5]="RB",r[r.Back=8]="Back",r[r.Start=9]="Start",r[r.LeftStick=10]="LeftStick",r[r.RightStick=11]="RightStick",(s=a||(a={}))[s.Up=12]="Up",s[s.Down=13]="Down",s[s.Left=14]="Left",s[s.Right=15]="Right";class d extends h.nJ{constructor(t,e,i,r=!1){super(t,e,i,0,1,2,3),this._leftTrigger=0,this._rightTrigger=0,this.onButtonDownObservable=new o.y$,this.onButtonUpObservable=new o.y$,this.onPadDownObservable=new o.y$,this.onPadUpObservable=new o.y$,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0,this._isXboxOnePad=!1,this.type=h.nJ.XBOX,this._isXboxOnePad=r}onlefttriggerchanged(t){this._onlefttriggerchanged=t}onrighttriggerchanged(t){this._onrighttriggerchanged=t}get leftTrigger(){return this._leftTrigger}set leftTrigger(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t}get rightTrigger(){return this._rightTrigger}set rightTrigger(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t}onbuttondown(t){this._onbuttondown=t}onbuttonup(t){this._onbuttonup=t}ondpaddown(t){this._ondpaddown=t}ondpadup(t){this._ondpadup=t}_setButtonValue(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t}_setDPadValue(t,e,i){return t!==e&&(1===t&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===t&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),t}get buttonA(){return this._buttonA}set buttonA(t){this._buttonA=this._setButtonValue(t,this._buttonA,0)}get buttonB(){return this._buttonB}set buttonB(t){this._buttonB=this._setButtonValue(t,this._buttonB,1)}get buttonX(){return this._buttonX}set buttonX(t){this._buttonX=this._setButtonValue(t,this._buttonX,2)}get buttonY(){return this._buttonY}set buttonY(t){this._buttonY=this._setButtonValue(t,this._buttonY,3)}get buttonStart(){return this._buttonStart}set buttonStart(t){this._buttonStart=this._setButtonValue(t,this._buttonStart,9)}get buttonBack(){return this._buttonBack}set buttonBack(t){this._buttonBack=this._setButtonValue(t,this._buttonBack,8)}get buttonLB(){return this._buttonLB}set buttonLB(t){this._buttonLB=this._setButtonValue(t,this._buttonLB,4)}get buttonRB(){return this._buttonRB}set buttonRB(t){this._buttonRB=this._setButtonValue(t,this._buttonRB,5)}get buttonLeftStick(){return this._buttonLeftStick}set buttonLeftStick(t){this._buttonLeftStick=this._setButtonValue(t,this._buttonLeftStick,10)}get buttonRightStick(){return this._buttonRightStick}set buttonRightStick(t){this._buttonRightStick=this._setButtonValue(t,this._buttonRightStick,11)}get dPadUp(){return this._dPadUp}set dPadUp(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,12)}get dPadDown(){return this._dPadDown}set dPadDown(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,13)}get dPadLeft(){return this._dPadLeft}set dPadLeft(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,14)}get dPadRight(){return this._dPadRight}set dPadRight(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,15)}update(){super.update(),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value}dispose(){super.dispose(),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()}}},97375:function(t,e,i){i.d(e,{e:function(){return l}});var r=i(46456),s=i(22287),n=i(39884),a=i(57449),o=i(67020),h=i(59744),d=i(7724);o.N.AddNodeConstructor("Light_Type_3",(t,e)=>()=>new l(t,n.P.Zero(),e));class l extends h._{constructor(t,e,i){super(t,i),this.groundColor=new a.Wo(0,0,0),this.direction=e||n.P.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(t){return this.direction=n.P.Normalize(t.subtract(n.P.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,e){let i=n.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,e),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),e),this}transferToNodeMaterialEffect(t,e){let i=n.P.Normalize(this.direction);return t.setFloat3(e,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=n.y3.Identity()),this._worldMatrix}getTypeID(){return h._.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,e){t["HEMILIGHT"+e]=!0}}(0,r.gn)([(0,s.n9)()],l.prototype,"groundColor",void 0),(0,r.gn)([(0,s.hd)()],l.prototype,"direction",void 0),(0,d.H7)("BABYLON.HemisphericLight",l)},59744:function(t,e,i){i.d(e,{_:function(){return u}});var r=i(46456),s=i(22287),n=i(39884),a=i(57449),o=i(67020),h=i(76608),d=i(7724),l=i(42044),c=i(90212);class u extends o.N{get range(){return this._range}set range(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(t){this._intensityMode=t,this._computePhotometricScale()}get radius(){return this._radius}set radius(t){this._radius=t,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(t){this._excludeWithLayerMask=t,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())}getViewMatrix(t){return null}getProjectionMatrix(t,e){return null}constructor(t,e){super(t,e,!1),this.diffuse=new a.Wo(1,1,1),this.specular=new a.Wo(1,1,1),this.falloffType=u.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=u.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=[],this._includedOnlyMeshesIds=[],this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new h.M(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(t,e){return this}_bindLight(t,e,i,r,s=!0){let n=t.toString(),o=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+n),this._renderId!==e.getRenderId()||this._lastUseSpecular!==r||!this._uniformBuffer.useUbo){this._renderId=e.getRenderId(),this._lastUseSpecular=r;let t=this.getScaledIntensity();this.transferToEffect(i,n),this.diffuse.scaleToRef(t,a.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",a.zZ.Color3[0],this.range,n),r&&(this.specular.scaleToRef(t,a.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",a.zZ.Color3[1],this.radius,n)),o=!0}if(this.transferTexturesToEffect(i,n),e.shadowsEnabled&&this.shadowEnabled&&s){let t=this.getShadowGenerator(e.activeCamera)??this.getShadowGenerator();t&&(t.bindShadowLight(n,i),o=!0)}o?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(t){let e="Name: "+this.name;if(e+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(t){super.setEnabled(t),this._resyncMeshes()}getShadowGenerator(t=null){return null===this._shadowGenerators?null:this._shadowGenerators.get(t)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return n.P.Zero()}canAffectMesh(t){return!t||(!this.includedOnlyMeshes||!(this.includedOnlyMeshes.length>0)||-1!==this.includedOnlyMeshes.indexOf(t))&&(!this.excludedMeshes||!(this.excludedMeshes.length>0)||-1===this.excludedMeshes.indexOf(t))&&(0===this.includeOnlyWithLayerMask||(this.includeOnlyWithLayerMask&t.layerMask)!=0)&&(0===this.excludeWithLayerMask||!(this.excludeWithLayerMask&t.layerMask))}dispose(t,e=!1){if(this._shadowGenerators){let t=this._shadowGenerators.values();for(let e=t.next();!0!==e.done;e=t.next())e.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){let t=this._parentContainer.lights.indexOf(this);t>-1&&this._parentContainer.lights.splice(t,1),this._parentContainer=null}for(let t of this.getScene().meshes)t._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(t,e)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(t,e=null){let i=u.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!i)return null;let r=c.p.Clone(i,this);return t&&(r.name=t),e&&(r.parent=e),r.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}serialize(){let t=c.p.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(t),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(e=>{t.excludedMeshesIds.push(e.id)})),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(e=>{t.includedOnlyMeshesIds.push(e.id)})),c.p.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}static GetConstructorFromName(t,e,i){return o.N.Construct("Light_Type_"+t,e,i)||null}static Parse(t,e){let i=u.GetConstructorFromName(t.type,t.name,e);if(!i)return null;let r=c.p.Parse(i,t,e);if(t.excludedMeshesIds&&(r._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(r._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(r._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(r.falloffType=t.falloffType),void 0!==t.lightmapMode&&(r.lightmapMode=t.lightmapMode),t.animations){for(let e=0;e<t.animations.length;e++){let i=t.animations[e],s=(0,d.qw)("BABYLON.Animation");s&&r.animations.push(s.Parse(i))}o.N.ParseAnimationRanges(r,t,e)}return t.autoAnimate&&e.beginAnimation(r,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&r.setEnabled(t.isEnabled),r}_hookArrayForExcluded(t){let e=t.push;t.push=(...i)=>{let r=e.apply(t,i);for(let t of i)t._resyncLightSource(this);return r};let i=t.splice;for(let e of(t.splice=(e,r)=>{let s=i.apply(t,[e,r]);for(let t of s)t._resyncLightSource(this);return s},t))e._resyncLightSource(this)}_hookArrayForIncludedOnly(t){let e=t.push;t.push=(...i)=>{let r=e.apply(t,i);return this._resyncMeshes(),r};let i=t.splice;t.splice=(e,r)=>{let s=i.apply(t,[e,r]);return this._resyncMeshes(),s},this._resyncMeshes()}_resyncMeshes(){for(let t of this.getScene().meshes)t._resyncLightSource(this)}_markMeshesAsLightDirty(){for(let t of this.getScene().meshes)-1!==t.lightSources.indexOf(this)&&t._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let t=0,e=this.getTypeID(),i=this.intensityMode;switch(i===u.INTENSITYMODE_AUTOMATIC&&(i=e===u.LIGHTTYPEID_DIRECTIONALLIGHT?u.INTENSITYMODE_ILLUMINANCE:u.INTENSITYMODE_LUMINOUSINTENSITY),e){case u.LIGHTTYPEID_POINTLIGHT:case u.LIGHTTYPEID_SPOTLIGHT:switch(i){case u.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case u.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case u.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case u.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case u.INTENSITYMODE_ILLUMINANCE:t=1;break;case u.INTENSITYMODE_LUMINANCE:{let e=this.radius;t=2*Math.PI*(1-Math.cos(e=Math.max(e,.001)))}}break;case u.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}_reorderLightsInScene(){let t=this.getScene();0!=this._renderPriority&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}u.FALLOFF_DEFAULT=l.m.FALLOFF_DEFAULT,u.FALLOFF_PHYSICAL=l.m.FALLOFF_PHYSICAL,u.FALLOFF_GLTF=l.m.FALLOFF_GLTF,u.FALLOFF_STANDARD=l.m.FALLOFF_STANDARD,u.LIGHTMAP_DEFAULT=l.m.LIGHTMAP_DEFAULT,u.LIGHTMAP_SPECULAR=l.m.LIGHTMAP_SPECULAR,u.LIGHTMAP_SHADOWSONLY=l.m.LIGHTMAP_SHADOWSONLY,u.INTENSITYMODE_AUTOMATIC=l.m.INTENSITYMODE_AUTOMATIC,u.INTENSITYMODE_LUMINOUSPOWER=l.m.INTENSITYMODE_LUMINOUSPOWER,u.INTENSITYMODE_LUMINOUSINTENSITY=l.m.INTENSITYMODE_LUMINOUSINTENSITY,u.INTENSITYMODE_ILLUMINANCE=l.m.INTENSITYMODE_ILLUMINANCE,u.INTENSITYMODE_LUMINANCE=l.m.INTENSITYMODE_LUMINANCE,u.LIGHTTYPEID_POINTLIGHT=l.m.LIGHTTYPEID_POINTLIGHT,u.LIGHTTYPEID_DIRECTIONALLIGHT=l.m.LIGHTTYPEID_DIRECTIONALLIGHT,u.LIGHTTYPEID_SPOTLIGHT=l.m.LIGHTTYPEID_SPOTLIGHT,u.LIGHTTYPEID_HEMISPHERICLIGHT=l.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,r.gn)([(0,s.n9)()],u.prototype,"diffuse",void 0),(0,r.gn)([(0,s.n9)()],u.prototype,"specular",void 0),(0,r.gn)([(0,s.qC)()],u.prototype,"falloffType",void 0),(0,r.gn)([(0,s.qC)()],u.prototype,"intensity",void 0),(0,r.gn)([(0,s.qC)()],u.prototype,"range",null),(0,r.gn)([(0,s.qC)()],u.prototype,"intensityMode",null),(0,r.gn)([(0,s.qC)()],u.prototype,"radius",null),(0,r.gn)([(0,s.qC)()],u.prototype,"_renderPriority",void 0),(0,r.gn)([(0,s.wz)("_reorderLightsInScene")],u.prototype,"renderPriority",void 0),(0,r.gn)([(0,s.qC)("shadowEnabled")],u.prototype,"_shadowEnabled",void 0),(0,r.gn)([(0,s.qC)("excludeWithLayerMask")],u.prototype,"_excludeWithLayerMask",void 0),(0,r.gn)([(0,s.qC)("includeOnlyWithLayerMask")],u.prototype,"_includeOnlyWithLayerMask",void 0),(0,r.gn)([(0,s.qC)("lightmapMode")],u.prototype,"_lightmapMode",void 0)},87117:function(t,e,i){i.d(e,{l:function(){return s}});var r=i(81209);class s extends r.x{constructor(t,e,i,s,n,a=!0,o=!1,h=3,d=0,l,c){if(super(null,n,!a,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,l),this.format=s,!this._engine)return;this._engine._caps.textureFloatLinearFiltering||1!==d||(h=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==d||(h=1),this._texture=this._engine.createRawTexture(t,e,i,s,a,o,h,null,d,l??0,c??!1),this.wrapU=r.x.CLAMP_ADDRESSMODE,this.wrapV=r.x.CLAMP_ADDRESSMODE}update(t){this._getEngine().updateRawTexture(this._texture,t,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();let t=new s(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return t._texture=this._texture,this._texture.incrementReferences(),t}static CreateLuminanceTexture(t,e,i,r,n=!0,a=!1,o=3){return new s(t,e,i,1,r,n,a,o)}static CreateLuminanceAlphaTexture(t,e,i,r,n=!0,a=!1,o=3){return new s(t,e,i,2,r,n,a,o)}static CreateAlphaTexture(t,e,i,r,n=!0,a=!1,o=3){return new s(t,e,i,0,r,n,a,o)}static CreateRGBTexture(t,e,i,r,n=!0,a=!1,o=3,h=0,d=0,l=!1){return new s(t,e,i,4,r,n,a,o,h,d,l)}static CreateRGBATexture(t,e,i,r,n=!0,a=!1,o=3,h=0,d=0,l=!1){return new s(t,e,i,5,r,n,a,o,h,d,l)}static CreateRGBAStorageTexture(t,e,i,r,n=!0,a=!1,o=3,h=0,d=!1){return new s(t,e,i,5,r,n,a,o,h,1,d)}static CreateRTexture(t,e,i,n,a=!0,o=!1,h=r.x.TRILINEAR_SAMPLINGMODE,d=1){return new s(t,e,i,6,n,a,o,h,d)}static CreateRStorageTexture(t,e,i,n,a=!0,o=!1,h=r.x.TRILINEAR_SAMPLINGMODE,d=1){return new s(t,e,i,6,n,a,o,h,d,1)}}},16188:function(t,e,i){i.d(e,{H:function(){return r}});class r{constructor(t){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=t,t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&this._setDefaultValue(e)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(t=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||t,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){for(let t of(this._keys.length=0,Object.keys(this)))"_"!==t[0]&&this._keys.push(t);if(this._externalProperties)for(let t in this._externalProperties)-1===this._keys.indexOf(t)&&this._keys.push(t)}isEqual(t){if(this._keys.length!==t._keys.length)return!1;for(let e=0;e<this._keys.length;e++){let i=this._keys[e];if(this[i]!==t[i])return!1}return!0}cloneTo(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(let e=0;e<this._keys.length;e++){let i=this._keys[e];t[i]=this[i]}}reset(){this._keys.forEach(t=>this._setDefaultValue(t))}_setDefaultValue(t){let e=this._externalProperties?.[t]?.type??typeof this[t],i=this._externalProperties?.[t]?.default;switch(e){case"number":this[t]=i??0;break;case"string":this[t]=i??"";break;default:this[t]=i??!1}}toString(){let t="";for(let e=0;e<this._keys.length;e++){let i=this._keys[e],r=this[i];switch(typeof r){case"number":case"string":t+="#define "+i+" "+r+"\n";break;default:r&&(t+="#define "+i+"\n")}}return t}}},31944:function(t,e,i){i.d(e,{b3:function(){return a},bK:function(){return s},cw:function(){return n},fR:function(){return o}});var r=i(57449);class s{constructor(t,e,i){this.gradient=t,this.color1=e,this.color2=i}getColorToRef(t){if(!this.color2){t.copyFrom(this.color1);return}r.HE.LerpToRef(this.color1,this.color2,Math.random(),t)}}class n{constructor(t,e){this.gradient=t,this.color=e}}class a{constructor(t,e,i){this.gradient=t,this.factor1=e,this.factor2=i}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class o{static GetCurrentGradient(t,e,i){if(e[0].gradient>t){i(e[0],e[0],1);return}for(let r=0;r<e.length-1;r++){let s=e[r],n=e[r+1];if(t>=s.gradient&&t<=n.gradient){let e=(t-s.gradient)/(n.gradient-s.gradient);i(s,n,e);return}}let r=e.length-1;i(e[r],e[r],1)}}},92539:function(t,e,i){i.d(e,{S:function(){return a}});var r=i(39884),s=i(65330),n=i(31642);class a{constructor(){this.direction1=new r.P(0,1,0),this.direction2=new r.P(0,1,0),this.minEmitBox=new r.P(-.5,-.5,-.5),this.maxEmitBox=new r.P(.5,.5,.5)}startDirectionFunction(t,e,i,n){let a=(0,s.RandomRange)(this.direction1.x,this.direction2.x),o=(0,s.RandomRange)(this.direction1.y,this.direction2.y),h=(0,s.RandomRange)(this.direction1.z,this.direction2.z);if(n){e.x=a,e.y=o,e.z=h;return}r.P.TransformNormalFromFloatsToRef(a,o,h,t,e)}startPositionFunction(t,e,i,n){let a=(0,s.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),o=(0,s.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),h=(0,s.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(n){e.x=a,e.y=o,e.z=h;return}r.P.TransformCoordinatesFromFloatsToRef(a,o,h,t,e)}clone(){let t=new a;return n.j.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3),t.addUniform("minEmitBox",3),t.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t}parse(t){r.P.FromArrayToRef(t.direction1,0,this.direction1),r.P.FromArrayToRef(t.direction2,0,this.direction2),r.P.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),r.P.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)}}},39500:function(t,e,i){i.d(e,{L:function(){return a},Y:function(){return o}});var r=i(31642),s=i(39884),n=i(65330);class a{get radius(){return this._radius}set radius(t){this._radius=t,this._buildHeight()}get angle(){return this._angle}set angle(t){this._angle=t,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(t=1,e=Math.PI,i=0){this.directionRandomizer=i,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=e,this.radius=t}startDirectionFunction(t,e,i,r){r?s.jp.Vector3[0].copyFrom(i._localPosition).normalize():i.position.subtractToRef(t.getTranslation(),s.jp.Vector3[0]).normalize();let a=(0,n.RandomRange)(0,this.directionRandomizer),o=(0,n.RandomRange)(0,this.directionRandomizer),h=(0,n.RandomRange)(0,this.directionRandomizer);e.x=s.jp.Vector3[0].x+a,e.y=s.jp.Vector3[0].y+o,e.z=s.jp.Vector3[0].z+h,e.normalize()}startPositionFunction(t,e,i,r){let a;let o=(0,n.RandomRange)(0,2*Math.PI);a=this.emitFromSpawnPointOnly?1e-4:1-(a=(0,n.RandomRange)(0,this.heightRange))*a;let h=this._radius-(0,n.RandomRange)(0,this._radius*this.radiusRange),d=(h*=a)*Math.sin(o),l=h*Math.cos(o),c=a*this._height;if(r){e.x=d,e.y=c,e.z=l;return}s.P.TransformCoordinatesFromFloatsToRef(d,c,l,t,e)}clone(){let t=new a(this._radius,this._angle,this.directionRandomizer);return r.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",2),t.addUniform("coneAngle",1),t.addUniform("height",2),t.addUniform("directionRandomizer",1)}getEffectDefines(){let t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+="\n#define CONEEMITTERSPAWNPOINT"),t}getClassName(){return"ConeParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t}parse(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=void 0!==t.radiusRange?t.radiusRange:1,this.heightRange=void 0!==t.radiusRange?t.heightRange:1,this.emitFromSpawnPointOnly=void 0!==t.emitFromSpawnPointOnly&&t.emitFromSpawnPointOnly}}class o extends a{constructor(t=1,e=Math.PI,i=new s.P(0,1,0),r=new s.P(0,1,0)){super(t,e),this.direction1=i,this.direction2=r}startDirectionFunction(t,e){let i=(0,n.RandomRange)(this.direction1.x,this.direction2.x),r=(0,n.RandomRange)(this.direction1.y,this.direction2.y),a=(0,n.RandomRange)(this.direction1.z,this.direction2.z);s.P.TransformNormalFromFloatsToRef(i,r,a,t,e)}clone(){let t=new o(this.radius,this.angle,this.direction1,this.direction2);return r.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){let t=super.serialize();return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t}parse(t){super.parse(t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)}}},21398:function(t,e,i){i.d(e,{E:function(){return n}});var r=i(31642),s=i(39884);class n{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(t,e,i,r){let n=s.jp.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,i,n);let t=s.jp.Vector3[1];n.subtractToRef(i.position,t),t.scaleToRef(1/i.lifeTime,n)}else n.set(0,0,0);if(r){e.copyFrom(n);return}s.P.TransformNormalToRef(n,t,e)}startPositionFunction(t,e,i,r){let n=s.jp.Vector3[0];if(this.particlePositionGenerator?this.particlePositionGenerator(-1,i,n):n.set(0,0,0),r){e.copyFrom(n);return}s.P.TransformCoordinatesToRef(n,t,e)}clone(){let t=new n;return r.j.DeepCopy(this,t),t}applyToShader(t){}buildUniformLayout(t){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.particlePositionGenerator=this.particlePositionGenerator,t.particleDestinationGenerator=this.particleDestinationGenerator,t}parse(t){t.particlePositionGenerator&&(this.particlePositionGenerator=t.particlePositionGenerator),t.particleDestinationGenerator&&(this.particleDestinationGenerator=t.particleDestinationGenerator)}}},75890:function(t,e,i){i.d(e,{k:function(){return a},z:function(){return o}});var r=i(39884),s=i(65330),n=i(31642);class a{constructor(t=1,e=1,i=1,s=0){this.radius=t,this.height=e,this.radiusRange=i,this.directionRandomizer=s,this._tempVector=r.P.Zero()}startDirectionFunction(t,e,i,n,a){i.position.subtractToRef(t.getTranslation(),this._tempVector),this._tempVector.normalize(),r.P.TransformNormalToRef(this._tempVector,a,this._tempVector);let o=(0,s.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2),h=Math.atan2(this._tempVector.x,this._tempVector.z);if(h+=(0,s.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=o,this._tempVector.x=Math.sin(h),this._tempVector.z=Math.cos(h),this._tempVector.normalize(),n){e.copyFrom(this._tempVector);return}r.P.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t,e)}startPositionFunction(t,e,i,n){let a=(0,s.RandomRange)(-this.height/2,this.height/2),o=(0,s.RandomRange)(0,2*Math.PI),h=Math.sqrt((0,s.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1))*this.radius,d=h*Math.cos(o),l=h*Math.sin(o);if(n){e.copyFromFloats(d,a,l);return}r.P.TransformCoordinatesFromFloatsToRef(d,a,l,t,e)}clone(){let t=new a(this.radius,this.directionRandomizer);return n.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class o extends a{constructor(t=1,e=1,i=1,s=new r.P(0,1,0),n=new r.P(0,1,0)){super(t,e,i),this.direction1=s,this.direction2=n}startDirectionFunction(t,e,i,n){let a=(0,s.RandomRange)(this.direction1.x,this.direction2.x),o=(0,s.RandomRange)(this.direction1.y,this.direction2.y),h=(0,s.RandomRange)(this.direction1.z,this.direction2.z);if(n){e.copyFromFloats(a,o,h);return}r.P.TransformNormalFromFloatsToRef(a,o,h,t,e)}clone(){let t=new o(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return n.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){let t=super.serialize();return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t}parse(t){super.parse(t),r.P.FromArrayToRef(t.direction1,0,this.direction1),r.P.FromArrayToRef(t.direction2,0,this.direction2)}}},44062:function(t,e,i){i.d(e,{V:function(){return a}});var r=i(31642),s=i(39884),n=i(65330);class a{constructor(t=1,e=1,i=0){this.radius=t,this.radiusRange=e,this.directionRandomizer=i}startDirectionFunction(t,e,i,r){let a=i.position.subtract(t.getTranslation()).normalize(),o=(0,n.RandomRange)(0,this.directionRandomizer),h=(0,n.RandomRange)(0,this.directionRandomizer),d=(0,n.RandomRange)(0,this.directionRandomizer);if(a.x+=o,a.y+=h,a.z+=d,a.normalize(),r){e.copyFrom(a);return}s.P.TransformNormalFromFloatsToRef(a.x,a.y,a.z,t,e)}startPositionFunction(t,e,i,r){let a=this.radius-(0,n.RandomRange)(0,this.radius*this.radiusRange),o=(0,n.RandomRange)(0,1),h=(0,n.RandomRange)(0,2*Math.PI),d=Math.acos(2*o-1),l=a*Math.cos(h)*Math.sin(d),c=a*Math.cos(d),u=a*Math.sin(h)*Math.sin(d);if(r){e.copyFromFloats(l,Math.abs(c),u);return}s.P.TransformCoordinatesFromFloatsToRef(l,Math.abs(c),u,t,e)}clone(){let t=new a(this.radius,this.directionRandomizer);return r.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}},25425:function(t,e,i){i.d(e,{F:function(){return o}});var r=i(31642),s=i(39884),n=i(65330),a=i(93954);class o{get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.getIndices(),this._positions=t.getVerticesData(a.o.PositionKind),this._normals=t.getVerticesData(a.o.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(t=null){this._indices=null,this._positions=null,this._normals=null,this._storedNormal=s.P.Zero(),this._mesh=null,this.direction1=new s.P(0,1,0),this.direction2=new s.P(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}startDirectionFunction(t,e,i,r){if(this.useMeshNormalsForDirection&&this._normals){s.P.TransformNormalToRef(this._storedNormal,t,e);return}let a=(0,n.RandomRange)(this.direction1.x,this.direction2.x),o=(0,n.RandomRange)(this.direction1.y,this.direction2.y),h=(0,n.RandomRange)(this.direction1.z,this.direction2.z);if(r){e.copyFromFloats(a,o,h);return}s.P.TransformNormalFromFloatsToRef(a,o,h,t,e)}startPositionFunction(t,e,i,r){if(!this._indices||!this._positions)return;let n=3*Math.random()*(this._indices.length/3)|0,a=Math.random(),o=Math.random()*(1-a),h=1-a-o,d=this._indices[n],l=this._indices[n+1],c=this._indices[n+2],u=s.jp.Vector3[0],m=s.jp.Vector3[1],p=s.jp.Vector3[2],_=s.jp.Vector3[3];s.P.FromArrayToRef(this._positions,3*d,u),s.P.FromArrayToRef(this._positions,3*l,m),s.P.FromArrayToRef(this._positions,3*c,p),_.x=a*u.x+o*m.x+h*p.x,_.y=a*u.y+o*m.y+h*p.y,_.z=a*u.z+o*m.z+h*p.z,r?e.copyFromFloats(_.x,_.y,_.z):s.P.TransformCoordinatesFromFloatsToRef(_.x,_.y,_.z,t,e),this.useMeshNormalsForDirection&&this._normals&&(s.P.FromArrayToRef(this._normals,3*d,u),s.P.FromArrayToRef(this._normals,3*l,m),s.P.FromArrayToRef(this._normals,3*c,p),this._storedNormal.x=a*u.x+o*m.x+h*p.x,this._storedNormal.y=a*u.y+o*m.y+h*p.y,this._storedNormal.z=a*u.z+o*m.z+h*p.z)}clone(){let t=new o(this.mesh);return r.j.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.meshId=this.mesh?.id,t.useMeshNormalsForDirection=this.useMeshNormalsForDirection,t}parse(t,e){s.P.FromArrayToRef(t.direction1,0,this.direction1),s.P.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&e&&(this.mesh=e.getLastMeshById(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection}}},1871:function(t,e,i){i.d(e,{c:function(){return a}});var r=i(31642),s=i(39884),n=i(65330);class a{constructor(){this.direction1=new s.P(0,1,0),this.direction2=new s.P(0,1,0)}startDirectionFunction(t,e,i,r){let a=(0,n.RandomRange)(this.direction1.x,this.direction2.x),o=(0,n.RandomRange)(this.direction1.y,this.direction2.y),h=(0,n.RandomRange)(this.direction1.z,this.direction2.z);if(r){e.copyFromFloats(a,o,h);return}s.P.TransformNormalFromFloatsToRef(a,o,h,t,e)}startPositionFunction(t,e,i,r){if(r){e.copyFromFloats(0,0,0);return}s.P.TransformCoordinatesFromFloatsToRef(0,0,0,t,e)}clone(){let t=new a;return r.j.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t}parse(t){s.P.FromArrayToRef(t.direction1,0,this.direction1),s.P.FromArrayToRef(t.direction2,0,this.direction2)}}},46715:function(t,e,i){i.d(e,{A:function(){return a},c:function(){return o}});var r=i(39884),s=i(65330),n=i(31642);class a{constructor(t=1,e=1,i=0){this.radius=t,this.radiusRange=e,this.directionRandomizer=i}startDirectionFunction(t,e,i,n){let a=i.position.subtract(t.getTranslation()).normalize(),o=(0,s.RandomRange)(0,this.directionRandomizer),h=(0,s.RandomRange)(0,this.directionRandomizer),d=(0,s.RandomRange)(0,this.directionRandomizer);if(a.x+=o,a.y+=h,a.z+=d,a.normalize(),n){e.copyFrom(a);return}r.P.TransformNormalFromFloatsToRef(a.x,a.y,a.z,t,e)}startPositionFunction(t,e,i,n){let a=this.radius-(0,s.RandomRange)(0,this.radius*this.radiusRange),o=(0,s.RandomRange)(0,1),h=(0,s.RandomRange)(0,2*Math.PI),d=Math.acos(2*o-1),l=a*Math.cos(h)*Math.sin(d),c=a*Math.cos(d),u=a*Math.sin(h)*Math.sin(d);if(n){e.copyFromFloats(l,c,u);return}r.P.TransformCoordinatesFromFloatsToRef(l,c,u,t,e)}clone(){let t=new a(this.radius,this.directionRandomizer);return n.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){let t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class o extends a{constructor(t=1,e=new r.P(0,1,0),i=new r.P(0,1,0)){super(t),this.direction1=e,this.direction2=i}startDirectionFunction(t,e){let i=(0,s.RandomRange)(this.direction1.x,this.direction2.x),n=(0,s.RandomRange)(this.direction1.y,this.direction2.y),a=(0,s.RandomRange)(this.direction1.z,this.direction2.z);r.P.TransformNormalFromFloatsToRef(i,n,a,t,e)}clone(){let t=new o(this.radius,this.direction1,this.direction2);return n.j.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){let t=super.serialize();return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t}parse(t){super.parse(t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)}}},96840:function(t,e,i){i.d(e,{U:function(){return h}});var r=i(39884),s=i(16188);class n extends s.H{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var a=i(57449);i(63296);var o=i(7724);class h{get noiseTexture(){return this._noiseTexture}set noiseTexture(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){this._useLogarithmicDepth=t&&this.getScene().getEngine().getCaps().fragmentDepthSupported}getScene(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:r.P.Zero()}set direction1(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:r.P.Zero()}set direction2(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:r.P.Zero()}set minEmitBox(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:r.P.Zero()}set maxEmitBox(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)}get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(t){this._attachImageProcessingConfiguration(t)}_attachImageProcessingConfiguration(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)}_reset(){}_removeGradientAndTexture(t,e,i){if(!e)return this;let r=0;for(let i of e){if(i.gradient===t){e.splice(r,1);break}r++}return i&&i.dispose(),this}constructor(t){this.animations=[],this.renderingGroupId=0,this.emitter=r.P.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new r.P(10,10,10),this.onAnimationEnd=null,this.blendMode=h.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new r.FM(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new r.P(0,0,0),this._useLogarithmicDepth=!1,this.gravity=r.P.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new a.HE(1,1,1,1),this.color2=new a.HE(1,1,1,1),this.colorDead=new a.HE(0,0,0,1),this.textureMask=new a.HE(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new n,this.id=t,this.name=t}createPointEmitter(t,e){throw Error("Method not implemented.")}createHemisphericEmitter(t=1,e=1){throw Error("Method not implemented.")}createSphereEmitter(t=1,e=1){throw Error("Method not implemented.")}createDirectedSphereEmitter(t=1,e=new r.P(0,1,0),i=new r.P(0,1,0)){throw Error("Method not implemented.")}createCylinderEmitter(t=1,e=1,i=1,r=0){throw Error("Method not implemented.")}createDirectedCylinderEmitter(t=1,e=1,i=1,s=new r.P(0,1,0),n=new r.P(0,1,0)){throw Error("Method not implemented.")}createConeEmitter(t=1,e=Math.PI/4){throw Error("Method not implemented.")}createDirectedConeEmitter(t=1,e=Math.PI/4,i=new r.P(0,1,0),s=new r.P(0,1,0)){throw Error("Method not implemented.")}createBoxEmitter(t,e,i,r){throw Error("Method not implemented.")}}h.BLENDMODE_ONEONE=0,h.BLENDMODE_STANDARD=1,h.BLENDMODE_ADD=2,h.BLENDMODE_MULTIPLY=3,h.BLENDMODE_MULTIPLYADD=4,(0,o.H7)("BABYLON.BaseParticleSystem",h)},84228:function(t,e,i){i.d(e,{h:function(){return a}});var r=i(39884),s=i(57449),n=i(65330);class a{constructor(t){if(this.particleSystem=t,this.position=r.P.Zero(),this.direction=r.P.Zero(),this.color=new s.HE(0,0,0,0),this.colorStep=new s.HE(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new r.FM(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new s.HE(0,0,0,0),this._currentColor2=new s.HE(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=a._Count++,!this.particleSystem.isAnimationSheetEnabled)return;this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let t,e=this.age,i=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===i?(i=1,e=this._randomCellOffset):e+=this._randomCellOffset);let r=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;t=this._initialSpriteCellLoop?(0,n.Clamp)(e*i%this.lifeTime/this.lifeTime):(0,n.Clamp)(e*i/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+t*r|0}_inheritParticleInfoToSubEmitter(t){if(t.particleSystem.emitter.position){let e=t.particleSystem.emitter;if(e.position.copyFrom(this.position),t.inheritDirection){let t=r.jp.Vector3[0];this.direction.normalizeToRef(t),e.setDirection(t,0,Math.PI/2)}}else t.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(t.inheritedVelocityAmount/2,r.jp.Vector3[0]),t.particleSystem._inheritedVelocityOffset.copyFrom(r.jp.Vector3[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(t=>{this._inheritParticleInfoToSubEmitter(t)})}_reset(){this.age=0,this.id=a._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(t){t.position.copyFrom(this.position),this._initialDirection?t._initialDirection?t._initialDirection.copyFrom(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.copyFrom(this.direction),this._localPosition&&(t._localPosition?t._localPosition.copyFrom(this._localPosition):t._localPosition=this._localPosition.clone()),t.color.copyFrom(this.color),t.colorStep.copyFrom(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.copyFrom(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.copyFrom(this._currentColor1),t._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this._initialStartSpriteCellID,t._initialEndSpriteCellID=this._initialEndSpriteCellID,t._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.copyFrom(this.remapData):t.remapData=new r.Lt(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}a._Count=0},42818:function(t,e,i){i.d(e,{Ei:function(){return d},FC:function(){return m},OV:function(){return p},Sc:function(){return l},UJ:function(){return g},Xb:function(){return _},qx:function(){return c},zg:function(){return u}});var r=i(39884),s=i(1871),n=i(44062),a=i(46715),o=i(75890),h=i(39500);function d(t,e){let i=new s.c;return i.direction1=t,i.direction2=e,i}function l(t=1,e=1){return new n.V(t,e)}function c(t=1,e=1){return new a.A(t,e)}function u(t=1,e=new r.P(0,1,0),i=new r.P(0,1,0)){return new a.c(t,e,i)}function m(t=1,e=1,i=1,r=0){return new o.k(t,e,i,r)}function p(t=1,e=1,i=1,s=new r.P(0,1,0),n=new r.P(0,1,0)){return new o.z(t,e,i,s,n)}function _(t=1,e=Math.PI/4){return new h.L(t,e)}function g(t=1,e=Math.PI/4,i=new r.P(0,1,0),s=new r.P(0,1,0)){return new h.Y(t,e,i,s)}},7312:function(t,e,i){i.d(e,{p:function(){return M}});var r=i(31944),s=i(82877),n=i(39884),a=i(93954),o=i(87117),h=i(51092),d=i(96840),l=i(84228),c=i(83260),u=i(57449);i(95330);var m=i(49449),p=i(3609),_=i(92539),g=i(65330),f=i(42620);class y extends d.U{set onDispose(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}get useRampGradients(){return this._useRampGradients}set useRampGradients(t){this._useRampGradients!==t&&(this._useRampGradients=t,this._resetEffect())}get particles(){return this._particles}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this._particles.length}getClassName(){return"ParticleSystem"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(t=0){return this._customWrappers[t]?.effect??this._customWrappers[0].effect}_getCustomDrawWrapper(t=0){return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t,e=0){this._customWrappers[e]=new c.q(this._engine),this._customWrappers[e].effect=t,this._customWrappers[e].drawContext&&(this._customWrappers[e].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.y$),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(t,e,i,a=null,o=!1,d=.01){super(t),this._emitterInverseWorldMatrix=n.y3.Identity(),this._inheritedVelocityOffset=new n.P,this.onDisposeObservable=new s.y$,this.onStoppedObservable=new s.y$,this._particles=[],this._stockParticles=[],this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new u.HE(0,0,0,0),this._colorDiff=new u.HE(0,0,0,0),this._scaledDirection=n.P.Zero(),this._scaledGravity=n.P.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=t=>{},this.recycleParticle=t=>{let e=this._particles.pop();e!==t&&e.copyTo(t),this._stockParticles.push(e)},this._createParticle=()=>{let t;return 0!==this._stockParticles.length?(t=this._stockParticles.pop())._reset():t=new l.h(this),this._prepareParticle(t),t},this._shadersLoaded=!1,this._capacity=e,this._epsilon=d,this._isAnimationSheetEnabled=o,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=n.y3.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||h.l.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.particleSystems.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new c.q(this._engine)},this._customWrappers[0].effect=a,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new _.S;let m=null;this.updateFunction=t=>{let e=null;this.noiseTexture&&(e=this.noiseTexture.getSize(),this.noiseTexture.getContent()?.then(t=>{m=t}));let i=t===this._particles;for(let s=0;s<t.length;s++){let a=t[s],o=this._scaledUpdateSpeed,h=a.age;if(a.age+=o,a.age>a.lifeTime){let t=a.age-h;o=(a.lifeTime-h)*o/t,a.age=a.lifeTime}let d=a.age/a.lifeTime;this._colorGradients&&this._colorGradients.length>0?r.fR.GetCurrentGradient(d,this._colorGradients,(t,e,i)=>{t!==a._currentColorGradient&&(a._currentColor1.copyFrom(a._currentColor2),e.getColorToRef(a._currentColor2),a._currentColorGradient=t),u.HE.LerpToRef(a._currentColor1,a._currentColor2,i,a.color)}):(a.colorStep.scaleToRef(o,this._scaledColorStep),a.color.addInPlace(this._scaledColorStep),a.color.a<0&&(a.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&r.fR.GetCurrentGradient(d,this._angularSpeedGradients,(t,e,i)=>{t!==a._currentAngularSpeedGradient&&(a._currentAngularSpeed1=a._currentAngularSpeed2,a._currentAngularSpeed2=e.getFactor(),a._currentAngularSpeedGradient=t),a.angularSpeed=(0,g.Lerp)(a._currentAngularSpeed1,a._currentAngularSpeed2,i)}),a.angle+=a.angularSpeed*o;let l=o;if(this._velocityGradients&&this._velocityGradients.length>0&&r.fR.GetCurrentGradient(d,this._velocityGradients,(t,e,i)=>{t!==a._currentVelocityGradient&&(a._currentVelocity1=a._currentVelocity2,a._currentVelocity2=e.getFactor(),a._currentVelocityGradient=t),l*=(0,g.Lerp)(a._currentVelocity1,a._currentVelocity2,i)}),a.direction.scaleToRef(l,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&r.fR.GetCurrentGradient(d,this._limitVelocityGradients,(t,e,i)=>{t!==a._currentLimitVelocityGradient&&(a._currentLimitVelocity1=a._currentLimitVelocity2,a._currentLimitVelocity2=e.getFactor(),a._currentLimitVelocityGradient=t);let r=(0,g.Lerp)(a._currentLimitVelocity1,a._currentLimitVelocity2,i);a.direction.length()>r&&a.direction.scaleInPlace(this.limitVelocityDamping)}),this._dragGradients&&this._dragGradients.length>0&&r.fR.GetCurrentGradient(d,this._dragGradients,(t,e,i)=>{t!==a._currentDragGradient&&(a._currentDrag1=a._currentDrag2,a._currentDrag2=e.getFactor(),a._currentDragGradient=t);let r=(0,g.Lerp)(a._currentDrag1,a._currentDrag2,i);this._scaledDirection.scaleInPlace(1-r)}),this.isLocal&&a._localPosition?(a._localPosition.addInPlace(this._scaledDirection),n.P.TransformCoordinatesToRef(a._localPosition,this._emitterWorldMatrix,a.position)):a.position.addInPlace(this._scaledDirection),m&&e&&a._randomNoiseCoordinates1){let t=this._fetchR(a._randomNoiseCoordinates1.x,a._randomNoiseCoordinates1.y,e.width,e.height,m),i=this._fetchR(a._randomNoiseCoordinates1.z,a._randomNoiseCoordinates2.x,e.width,e.height,m),r=this._fetchR(a._randomNoiseCoordinates2.y,a._randomNoiseCoordinates2.z,e.width,e.height,m),s=n.jp.Vector3[0],h=n.jp.Vector3[1];s.copyFromFloats((2*t-1)*this.noiseStrength.x,(2*i-1)*this.noiseStrength.y,(2*r-1)*this.noiseStrength.z),s.scaleToRef(o,h),a.direction.addInPlace(h)}if(this.gravity.scaleToRef(o,this._scaledGravity),a.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&r.fR.GetCurrentGradient(d,this._sizeGradients,(t,e,i)=>{t!==a._currentSizeGradient&&(a._currentSize1=a._currentSize2,a._currentSize2=e.getFactor(),a._currentSizeGradient=t),a.size=(0,g.Lerp)(a._currentSize1,a._currentSize2,i)}),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&r.fR.GetCurrentGradient(d,this._colorRemapGradients,(t,e,i)=>{let r=(0,g.Lerp)(t.factor1,e.factor1,i),s=(0,g.Lerp)(t.factor2,e.factor2,i);a.remapData.x=r,a.remapData.y=s-r}),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&r.fR.GetCurrentGradient(d,this._alphaRemapGradients,(t,e,i)=>{let r=(0,g.Lerp)(t.factor1,e.factor1,i),s=(0,g.Lerp)(t.factor2,e.factor2,i);a.remapData.z=r,a.remapData.w=s-r})),this._isAnimationSheetEnabled&&a.updateCellIndex(),a._inheritParticleInfoToSubEmitters(),a.age>=a.lifeTime){this._emitFromParticle(a),a._attachedSubEmitters&&(a._attachedSubEmitters.forEach(t=>{t.particleSystem.disposeOnStop=!0,t.particleSystem.stop()}),a._attachedSubEmitters=null),this.recycleParticle(a),i&&s--;continue}}}}serialize(t){throw Error("Method not implemented.")}clone(t,e,i=!1){throw Error("Method not implemented.")}_addFactorGradient(t,e,i,s){let n=new r.b3(e,i,s);t.push(n),t.sort((t,e)=>t.gradient<e.gradient?-1:t.gradient>e.gradient?1:0)}_removeFactorGradient(t,e){if(!t)return;let i=0;for(let r of t){if(r.gradient===e){t.splice(i,1);break}i++}}addLifeTimeGradient(t,e,i){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,t,e,i),this}removeLifeTimeGradient(t){return this._removeFactorGradient(this._lifeTimeGradients,t),this}addSizeGradient(t,e,i){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,t,e,i),this}removeSizeGradient(t){return this._removeFactorGradient(this._sizeGradients,t),this}addColorRemapGradient(t,e,i){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,t,e,i),this}removeColorRemapGradient(t){return this._removeFactorGradient(this._colorRemapGradients,t),this}addAlphaRemapGradient(t,e,i){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,t,e,i),this}removeAlphaRemapGradient(t){return this._removeFactorGradient(this._alphaRemapGradients,t),this}addAngularSpeedGradient(t,e,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,t,e,i),this}removeAngularSpeedGradient(t){return this._removeFactorGradient(this._angularSpeedGradients,t),this}addVelocityGradient(t,e,i){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,t,e,i),this}removeVelocityGradient(t){return this._removeFactorGradient(this._velocityGradients,t),this}addLimitVelocityGradient(t,e,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,t,e,i),this}removeLimitVelocityGradient(t){return this._removeFactorGradient(this._limitVelocityGradients,t),this}addDragGradient(t,e,i){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,t,e,i),this}removeDragGradient(t){return this._removeFactorGradient(this._dragGradients,t),this}addEmitRateGradient(t,e,i){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,t,e,i),this}removeEmitRateGradient(t){return this._removeFactorGradient(this._emitRateGradients,t),this}addStartSizeGradient(t,e,i){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,t,e,i),this}removeStartSizeGradient(t){return this._removeFactorGradient(this._startSizeGradients,t),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;let t=new Uint8Array(4*this._rawTextureWidth),e=u.zZ.Color3[0];for(let i=0;i<this._rawTextureWidth;i++){let s=i/this._rawTextureWidth;r.fR.GetCurrentGradient(s,this._rampGradients,(r,s,n)=>{u.Wo.LerpToRef(r.color,s.color,n,e),t[4*i]=255*e.r,t[4*i+1]=255*e.g,t[4*i+2]=255*e.b,t[4*i+3]=255})}this._rampGradientsTexture=o.l.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort((t,e)=>t.gradient<e.gradient?-1:t.gradient>e.gradient?1:0),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(t,e){this._rampGradients||(this._rampGradients=[]);let i=new r.cw(t,e);return this._rampGradients.push(i),this._syncRampGradientTexture(),this}removeRampGradient(t){return this._removeGradientAndTexture(t,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(t,e,i){this._colorGradients||(this._colorGradients=[]);let s=new r.bK(t,e,i);return this._colorGradients.push(s),this._colorGradients.sort((t,e)=>t.gradient<e.gradient?-1:t.gradient>e.gradient?1:0),this}removeColorGradient(t){if(!this._colorGradients)return this;let e=0;for(let i of this._colorGradients){if(i.gradient===t){this._colorGradients.splice(e,1);break}e++}return this}resetDrawCache(){for(let t of this._drawWrappers)if(t)for(let e of t)e?.dispose();this._drawWrappers=[]}_fetchR(t,e,i,r,s){return s[(((t=.5*Math.abs(t)+.5)*i%i|0)+((e=.5*Math.abs(e)+.5)*r%r|0)*i)*4]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){let t;this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);let e=this._engine,i=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*i),this._vertexBuffer=new a.l(e,this._vertexData,!0,i);let r=0,s=this._vertexBuffer.createVertexBuffer(a.o.PositionKind,r,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[a.o.PositionKind]=s,r+=3;let n=this._vertexBuffer.createVertexBuffer(a.o.ColorKind,r,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[a.o.ColorKind]=n,r+=4;let o=this._vertexBuffer.createVertexBuffer("angle",r,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=o,r+=1;let h=this._vertexBuffer.createVertexBuffer("size",r,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=h,r+=2,this._isAnimationSheetEnabled){let t=this._vertexBuffer.createVertexBuffer("cellIndex",r,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=t,r+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){let t=this._vertexBuffer.createVertexBuffer("direction",r,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=t,r+=3}if(this._useRampGradients){let t=this._vertexBuffer.createVertexBuffer("remapData",r,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=t,r+=4}if(this._useInstancing){let i=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new a.l(e,i,!1,2),t=this._spriteBuffer.createVertexBuffer("offset",0,2)}else t=this._vertexBuffer.createVertexBuffer("offset",r,2,this._vertexBufferSize,this._useInstancing),r+=2;this._vertexBuffers.offset=t,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]));return}let t=[],e=[],i=0;for(let r=0;r<this._capacity;r++)t.push(i),t.push(i+1),t.push(i+2),t.push(i),t.push(i+2),t.push(i+3),e.push(i,i+1,i+1,i+2,i+2,i+3,i+3,i,i,i+3),i+=4;this._indexBuffer=this._engine.createIndexBuffer(t),this._linesIndexBuffer=this._engine.createIndexBuffer(e)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(t=this.startDelay){if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(t){setTimeout(()=>{this.start(0)},t);return}if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter?.getClassName().indexOf("Mesh")!==-1&&this.emitter.computeWorldMatrix(!0);let t=this.noiseTexture;if(t&&t.onGeneratedObservable)t.onGeneratedObservable.addOnce(()=>{setTimeout(()=>{for(let e=0;e<this.preWarmCycles;e++)this.animate(!0),t.render()})});else for(let t=0;t<this.preWarmCycles;t++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}stop(t=!0){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(t))}_postStop(t){}reset(){this._stockParticles.length=0,this._particles.length=0}_appendParticleVertex(t,e,i,r){let s=t*this._vertexBufferSize;if(this._vertexData[s++]=e.position.x+this.worldOffset.x,this._vertexData[s++]=e.position.y+this.worldOffset.y,this._vertexData[s++]=e.position.z+this.worldOffset.z,this._vertexData[s++]=e.color.r,this._vertexData[s++]=e.color.g,this._vertexData[s++]=e.color.b,this._vertexData[s++]=e.color.a,this._vertexData[s++]=e.angle,this._vertexData[s++]=e.scale.x*e.size,this._vertexData[s++]=e.scale.y*e.size,this._isAnimationSheetEnabled&&(this._vertexData[s++]=e.cellIndex),this._isBillboardBased)(8===this.billboardMode||9===this.billboardMode)&&(this._vertexData[s++]=e.direction.x,this._vertexData[s++]=e.direction.y,this._vertexData[s++]=e.direction.z);else if(e._initialDirection){let t=e._initialDirection;this.isLocal&&(n.P.TransformNormalToRef(t,this._emitterWorldMatrix,n.jp.Vector3[0]),t=n.jp.Vector3[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[s++]=t.x,this._vertexData[s++]=t.y,this._vertexData[s++]=t.z}else{let t=e.direction;this.isLocal&&(n.P.TransformNormalToRef(t,this._emitterWorldMatrix,n.jp.Vector3[0]),t=n.jp.Vector3[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[s++]=t.x,this._vertexData[s++]=t.y,this._vertexData[s++]=t.z}this._useRampGradients&&e.remapData&&(this._vertexData[s++]=e.remapData.x,this._vertexData[s++]=e.remapData.y,this._vertexData[s++]=e.remapData.z,this._vertexData[s++]=e.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon)),this._vertexData[s++]=i,this._vertexData[s++]=r)}_prepareParticle(t){}_update(t){let e;if(this._alive=this._particles.length>0,this.emitter.position){let t=this.emitter;this._emitterWorldMatrix=t.getWorldMatrix()}else{let t=this.emitter;this._emitterWorldMatrix=n.y3.Translation(t.x,t.y,t.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this._particles);for(let i=0;i<t&&this._particles.length!==this._capacity;i++){if(e=this._createParticle(),this._particles.push(e),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){let t=(0,g.Clamp)(this._actualFrame/this.targetStopDuration);r.fR.GetCurrentGradient(t,this._lifeTimeGradients,(i,r)=>{let s=i.getFactor(),n=r.getFactor(),a=(t-i.gradient)/(r.gradient-i.gradient);e.lifeTime=(0,g.Lerp)(s,n,a)})}else e.lifeTime=(0,g.RandomRange)(this.minLifeTime,this.maxLifeTime);let t=(0,g.RandomRange)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,e.position,e,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,e.position,e,this.isLocal),this.isLocal&&(e._localPosition?e._localPosition.copyFrom(e.position):e._localPosition=e.position.clone(),n.P.TransformCoordinatesToRef(e._localPosition,this._emitterWorldMatrix,e.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,e.direction,e,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,e.direction,e,this.isLocal,this._emitterInverseWorldMatrix),0===t?e._initialDirection?e._initialDirection.copyFrom(e.direction):e._initialDirection=e.direction.clone():e._initialDirection=null,e.direction.scaleInPlace(t),this._sizeGradients&&0!==this._sizeGradients.length?(e._currentSizeGradient=this._sizeGradients[0],e._currentSize1=e._currentSizeGradient.getFactor(),e.size=e._currentSize1,this._sizeGradients.length>1?e._currentSize2=this._sizeGradients[1].getFactor():e._currentSize2=e._currentSize1):e.size=(0,g.RandomRange)(this.minSize,this.maxSize),e.scale.copyFromFloats((0,g.RandomRange)(this.minScaleX,this.maxScaleX),(0,g.RandomRange)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){let t=this._actualFrame/this.targetStopDuration;r.fR.GetCurrentGradient(t,this._startSizeGradients,(t,i,r)=>{t!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=i.getFactor(),this._currentStartSizeGradient=t);let s=(0,g.Lerp)(this._currentStartSize1,this._currentStartSize2,r);e.scale.scaleInPlace(s)})}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(e._currentAngularSpeedGradient=this._angularSpeedGradients[0],e.angularSpeed=e._currentAngularSpeedGradient.getFactor(),e._currentAngularSpeed1=e.angularSpeed,this._angularSpeedGradients.length>1?e._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():e._currentAngularSpeed2=e._currentAngularSpeed1):e.angularSpeed=(0,g.RandomRange)(this.minAngularSpeed,this.maxAngularSpeed),e.angle=(0,g.RandomRange)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(e._currentVelocityGradient=this._velocityGradients[0],e._currentVelocity1=e._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?e._currentVelocity2=this._velocityGradients[1].getFactor():e._currentVelocity2=e._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(e._currentLimitVelocityGradient=this._limitVelocityGradients[0],e._currentLimitVelocity1=e._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?e._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():e._currentLimitVelocity2=e._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(e._currentDragGradient=this._dragGradients[0],e._currentDrag1=e._currentDragGradient.getFactor(),this._dragGradients.length>1?e._currentDrag2=this._dragGradients[1].getFactor():e._currentDrag2=e._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)e._currentColorGradient=this._colorGradients[0],e._currentColorGradient.getColorToRef(e.color),e._currentColor1.copyFrom(e.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(e._currentColor2):e._currentColor2.copyFrom(e.color);else{let t=(0,g.RandomRange)(0,1);u.HE.LerpToRef(this.color1,this.color2,t,e.color),this.colorDead.subtractToRef(e.color,this._colorDiff),this._colorDiff.scaleToRef(1/e.lifeTime,e.colorStep)}this._isAnimationSheetEnabled&&(e._initialStartSpriteCellID=this.startSpriteCellID,e._initialEndSpriteCellID=this.endSpriteCellID,e._initialSpriteCellLoop=this.spriteCellLoop),e.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(e.remapData=new n.Lt(0,1,0,1)),this.noiseTexture&&(e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),e._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(e._randomNoiseCoordinates1=new n.P(Math.random(),Math.random(),Math.random()),e._randomNoiseCoordinates2=new n.P(Math.random(),Math.random(),Math.random()))),e._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(t=!1,e=!1,i=!1){let r=[a.o.PositionKind,a.o.ColorKind,"angle","offset","size"];return t&&r.push("cellIndex"),e||r.push("direction"),i&&r.push("remapData"),r}static _GetEffectCreationOptions(t=!1,e=!1,i=!1){let r=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,m.qx)(r),t&&r.push("particlesInfos"),e&&r.push("logarithmicDepthConstant"),i&&(r.push("vFogInfos"),r.push("vFogColor")),r}fillDefines(t,e,i=!0){if(this._scene&&((0,m.lK)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&t.push("#define FOG")),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),e===d.U.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&t.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case 2:t.push("#define BILLBOARDY");break;case 8:case 9:t.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&t.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:t.push("#define BILLBOARDMODE_ALL")}i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,e,i){e.push(...y._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),t.push(...y._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,f.u)(t,this._imageProcessingConfigurationDefines),(0,f.O)(i,this._imageProcessingConfigurationDefines))}_getWrapper(t){let e=this._getCustomDrawWrapper(t);if(e?.effect)return e;let i=[];this.fillDefines(i,t);let r=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0,s=this._drawWrappers[r];s||(s=this._drawWrappers[r]=[]);let n=s[t];n||((n=new c.q(this._engine)).drawContext&&(n.drawContext.useInstancing=this._useInstancing),s[t]=n);let a=i.join("\n");if(n.defines!==a){let t=[],e=[],i=[];this.fillUniformsAttributesAndSamplerNames(e,t,i),n.setEffect(this._engine.createEffect("particles",t,e,i,a,void 0,void 0,void 0,void 0,this._shaderLanguage),a)}return n}animate(t=!1){let e;if(this._started){if(!t&&this._scene){if(!this.isReady()||this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(t?this.preWarmStepOffset:this._scene?.getAnimationRatio()||1),this.manualEmitCount>-1)e=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let t=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){let e=this._actualFrame/this.targetStopDuration;r.fR.GetCurrentGradient(e,this._emitRateGradients,(e,i,r)=>{e!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=i.getFactor(),this._currentEmitRateGradient=e),t=(0,g.Lerp)(this._currentEmitRate1,this._currentEmitRate2,r)})}e=t*this._scaledUpdateSpeed>>0,this._newPartsExcess+=t*this._scaledUpdateSpeed-e}if(this._newPartsExcess>1&&(e+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?e=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(e),this._stopped&&!this._alive&&(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this)),!t){let t=0;for(let e=0;e<this._particles.length;e++){let i=this._particles[e];this._appendParticleVertices(t,i),t+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this._particles.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(t,e){this._appendParticleVertex(t++,e,0,0),this._useInstancing||(this._appendParticleVertex(t++,e,1,0),this._appendParticleVertex(t++,e,1,1),this._appendParticleVertex(t++,e,0,1))}rebuild(){this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),this._spriteBuffer?._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!y.ForceGLSL?(this._shaderLanguage=1,await Promise.all([i.e(9089).then(i.bind(i,59089)),i.e(5667).then(i.bind(i,85667))])):await Promise.all([i.e(670).then(i.bind(i,70670)),i.e(3886).then(i.bind(i,43886))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded||!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==d.U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else if(!this._getWrapper(d.U.BLENDMODE_MULTIPLY).effect.isReady()||!this._getWrapper(d.U.BLENDMODE_ADD).effect.isReady())return!1;return!0}_render(t){let e=this._getWrapper(t),i=e.effect,r=this._engine;r.enableEffect(e);let s=this.defaultViewMatrix??this._scene.getViewMatrix();if(i.setTexture("diffuseSampler",this.particleTexture),i.setMatrix("view",s),i.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){let t=this.particleTexture.getBaseSize();i.setFloat3("particlesInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,this.spriteCellWidth/t.width)}if(i.setVector2("translationPivot",this.translationPivot),i.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){let t=this._scene.activeCamera;i.setVector3("eyePosition",t.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),i.setTexture("rampSampler",this._rampGradientsTexture));let a=i.defines;switch(this._scene&&((0,m.an)(i,this,this._scene),this.applyFog&&(0,p.D1)(this._scene,void 0,i)),a.indexOf("#define BILLBOARDMODE_ALL")>=0&&(s.invertToRef(n.jp.Matrix[0]),i.setMatrix("invView",n.jp.Matrix[0])),void 0!==this._vertexArrayObject?this._scene?.forceWireframe?r.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,i):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,i)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._scene?.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?r.bindBuffers(this._vertexBuffers,this._scene?.forceWireframe?this._linesIndexBuffer:this._indexBuffer,i):r.bindBuffers(this._vertexBuffers,this._scene?.forceWireframe?this._linesIndexBufferUseInstancing:null,i),this.useLogarithmicDepth&&this._scene&&(0,p.gz)(a,i,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(i),t){case d.U.BLENDMODE_ADD:r.setAlphaMode(1);break;case d.U.BLENDMODE_ONEONE:r.setAlphaMode(6);break;case d.U.BLENDMODE_STANDARD:r.setAlphaMode(2);break;case d.U.BLENDMODE_MULTIPLY:r.setAlphaMode(4)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(i),this._useInstancing?this._scene?.forceWireframe?r.drawElementsType(6,0,10,this._particles.length):r.drawArraysType(7,0,4,this._particles.length):this._scene?.forceWireframe?r.drawElementsType(1,0,10*this._particles.length):r.drawElementsType(0,0,6*this._particles.length),this._particles.length}render(){if(!this.isReady()||!this._particles.length)return 0;let t=this._engine;t.setState&&(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0));let e=0;return e=this.blendMode===d.U.BLENDMODE_MULTIPLYADD?this._render(d.U.BLENDMODE_MULTIPLY)+this._render(d.U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),e}_onDispose(t=!1,e=!1){}dispose(t=!0,e=!1,i=!1){if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(e,i),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){let t=this._scene.particleSystems.indexOf(this);t>-1&&this._scene.particleSystems.splice(t,1),this._scene._activeParticleSystems.dispose()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()}}y.ForceGLSL=!1;var b=i(22510),S=i(3176),E=i(7724),P=i(90212),G=i(25425),D=i(21398),x=i(1871),R=i(44062),T=i(46715),v=i(75890),C=i(39500),A=i(42818);class M extends y{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=t=>{if(!this._subEmitters||0===this._subEmitters.length)return;let e=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[e].forEach(e=>{if(1===e.type){let i=e.clone();t._inheritParticleInfoToSubEmitter(i),i.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(i.particleSystem),i.particleSystem.start()}})}}createPointEmitter(t,e){let i=(0,A.Ei)(t,e);return this.particleEmitterType=i,i}createHemisphericEmitter(t=1,e=1){let i=(0,A.Sc)(t,e);return this.particleEmitterType=i,i}createSphereEmitter(t=1,e=1){let i=(0,A.qx)(t,e);return this.particleEmitterType=i,i}createDirectedSphereEmitter(t=1,e=new n.P(0,1,0),i=new n.P(0,1,0)){let r=(0,A.zg)(t,e,i);return this.particleEmitterType=r,r}createCylinderEmitter(t=1,e=1,i=1,r=0){let s=(0,A.FC)(t,e,i,r);return this.particleEmitterType=s,s}createDirectedCylinderEmitter(t=1,e=1,i=1,r=new n.P(0,1,0),s=new n.P(0,1,0)){let a=(0,A.OV)(t,e,i,r,s);return this.particleEmitterType=a,a}createConeEmitter(t=1,e=Math.PI/4){let i=(0,A.Xb)(t,e);return this.particleEmitterType=i,i}createDirectedConeEmitter(t=1,e=Math.PI/4,i=new n.P(0,1,0),r=new n.P(0,1,0)){let s=(0,A.UJ)(t,e,i,r);return this.particleEmitterType=s,s}createBoxEmitter(t,e,i,r){let s=new _.S;return this.particleEmitterType=s,this.direction1=t,this.direction2=e,this.minEmitBox=i,this.maxEmitBox=r,s}_prepareSubEmitterInternalArray(){this._subEmitters=[],this.subEmitters&&this.subEmitters.forEach(t=>{t instanceof M?this._subEmitters.push([new b.H(t)]):t instanceof b.H?this._subEmitters.push([t]):t instanceof Array&&this._subEmitters.push(t)})}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach(t=>{t.stop(!0)}),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;let t=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==t&&this._rootParticleSystem.activeSubSystems.splice(t,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(t){t&&this._stopSubEmitters()}_prepareParticle(t){if(this._subEmitters&&this._subEmitters.length>0){let e=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];t._attachedSubEmitters=[],e.forEach(e=>{if(0===e.type){let i=e.clone();t._attachedSubEmitters.push(i),i.particleSystem.start()}})}}_onDispose(t=!1,e=!1){if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),t&&this.particles?.forEach(t=>{if(t._attachedSubEmitters)for(let e=t._attachedSubEmitters.length-1;e>=0;e-=1)t._attachedSubEmitters[e].dispose()}),e&&this.activeSubSystems)for(let t=this.activeSubSystems.length-1;t>=0;t-=1)this.activeSubSystems[t].dispose();if(this._subEmitters&&this._subEmitters.length){for(let t=0;t<this._subEmitters.length;t++)for(let e of this._subEmitters[t])e.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0)}static _Parse(t,e,i,r){let s,a;s=i instanceof S.a?null:i;let o=(0,E.qw)("BABYLON.Texture");if(o&&s&&(t.texture?e.particleTexture=o.Parse(t.texture,s,r):t.textureName&&(e.particleTexture=new o(r+t.textureName,s,!1,void 0===t.invertY||t.invertY),e.particleTexture.name=t.textureName)),t.emitterId||0===t.emitterId||void 0!==t.emitter?t.emitterId&&s?e.emitter=s.getLastMeshById(t.emitterId):e.emitter=n.P.FromArray(t.emitter):e.emitter=n.P.Zero(),e.isLocal=!!t.isLocal,void 0!==t.renderingGroupId&&(e.renderingGroupId=t.renderingGroupId),void 0!==t.isBillboardBased&&(e.isBillboardBased=t.isBillboardBased),void 0!==t.billboardMode&&(e.billboardMode=t.billboardMode),void 0!==t.useLogarithmicDepth&&(e.useLogarithmicDepth=t.useLogarithmicDepth),t.animations){for(let i=0;i<t.animations.length;i++){let r=t.animations[i],s=(0,E.qw)("BABYLON.Animation");s&&e.animations.push(s.Parse(r))}e.beginAnimationOnStart=t.beginAnimationOnStart,e.beginAnimationFrom=t.beginAnimationFrom,e.beginAnimationTo=t.beginAnimationTo,e.beginAnimationLoop=t.beginAnimationLoop}if(t.autoAnimate&&s&&s.beginAnimation(e,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),e.startDelay=0|t.startDelay,e.minAngularSpeed=t.minAngularSpeed,e.maxAngularSpeed=t.maxAngularSpeed,e.minSize=t.minSize,e.maxSize=t.maxSize,t.minScaleX&&(e.minScaleX=t.minScaleX,e.maxScaleX=t.maxScaleX,e.minScaleY=t.minScaleY,e.maxScaleY=t.maxScaleY),void 0!==t.preWarmCycles&&(e.preWarmCycles=t.preWarmCycles,e.preWarmStepOffset=t.preWarmStepOffset),void 0!==t.minInitialRotation&&(e.minInitialRotation=t.minInitialRotation,e.maxInitialRotation=t.maxInitialRotation),e.minLifeTime=t.minLifeTime,e.maxLifeTime=t.maxLifeTime,e.minEmitPower=t.minEmitPower,e.maxEmitPower=t.maxEmitPower,e.emitRate=t.emitRate,e.gravity=n.P.FromArray(t.gravity),t.noiseStrength&&(e.noiseStrength=n.P.FromArray(t.noiseStrength)),e.color1=u.HE.FromArray(t.color1),e.color2=u.HE.FromArray(t.color2),e.colorDead=u.HE.FromArray(t.colorDead),e.updateSpeed=t.updateSpeed,e.targetStopDuration=t.targetStopDuration,e.blendMode=t.blendMode,t.colorGradients)for(let i of t.colorGradients)e.addColorGradient(i.gradient,u.HE.FromArray(i.color1),i.color2?u.HE.FromArray(i.color2):void 0);if(t.rampGradients){for(let i of t.rampGradients)e.addRampGradient(i.gradient,u.Wo.FromArray(i.color));e.useRampGradients=t.useRampGradients}if(t.colorRemapGradients)for(let i of t.colorRemapGradients)e.addColorRemapGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.alphaRemapGradients)for(let i of t.alphaRemapGradients)e.addAlphaRemapGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.sizeGradients)for(let i of t.sizeGradients)e.addSizeGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.angularSpeedGradients)for(let i of t.angularSpeedGradients)e.addAngularSpeedGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.velocityGradients)for(let i of t.velocityGradients)e.addVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.dragGradients)for(let i of t.dragGradients)e.addDragGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.emitRateGradients)for(let i of t.emitRateGradients)e.addEmitRateGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.startSizeGradients)for(let i of t.startSizeGradients)e.addStartSizeGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.lifeTimeGradients)for(let i of t.lifeTimeGradients)e.addLifeTimeGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);if(t.limitVelocityGradients){for(let i of t.limitVelocityGradients)e.addLimitVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);e.limitVelocityDamping=t.limitVelocityDamping}if(t.noiseTexture&&s){let i=(0,E.qw)("BABYLON.ProceduralTexture");e.noiseTexture=i.Parse(t.noiseTexture,s,r)}if(t.particleEmitterType){switch(t.particleEmitterType.type){case"SphereParticleEmitter":a=new T.A;break;case"SphereDirectedParticleEmitter":a=new T.c;break;case"ConeEmitter":case"ConeParticleEmitter":a=new C.L;break;case"ConeDirectedParticleEmitter":a=new C.Y;break;case"CylinderParticleEmitter":a=new v.k;break;case"CylinderDirectedParticleEmitter":a=new v.z;break;case"HemisphericParticleEmitter":a=new R.V;break;case"PointParticleEmitter":a=new x.c;break;case"MeshParticleEmitter":a=new G.F;break;case"CustomParticleEmitter":a=new D.E;break;default:a=new _.S}a.parse(t.particleEmitterType,s)}else(a=new _.S).parse(t,s);e.particleEmitterType=a,e.startSpriteCellID=t.startSpriteCellID,e.endSpriteCellID=t.endSpriteCellID,e.spriteCellLoop=t.spriteCellLoop??!0,e.spriteCellWidth=t.spriteCellWidth,e.spriteCellHeight=t.spriteCellHeight,e.spriteCellChangeSpeed=t.spriteCellChangeSpeed,e.spriteRandomStartCell=t.spriteRandomStartCell,e.disposeOnStop=t.disposeOnStop??!1,e.manualEmitCount=t.manualEmitCount??-1}static Parse(t,e,i,r=!1,s){let a;let o=t.name,h=null,d=null;if(a=e instanceof S.a?e:e.getEngine(),t.customShader&&a.createEffectForParticles){let e=(d=t.customShader).shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"";h=a.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,e)}let l=new M(o,s||t.capacity,e,h,t.isAnimationSheetEnabled);if(l.customShader=d,l._rootUrl=i,t.id&&(l.id=t.id),t.subEmitters)for(let r of(l.subEmitters=[],t.subEmitters)){let t=[];for(let s of r)t.push(b.H.Parse(s,e,i));l.subEmitters.push(t)}return M._Parse(t,l,e,i),t.textureMask&&(l.textureMask=u.HE.FromArray(t.textureMask)),t.worldOffset&&(l.worldOffset=n.P.FromArray(t.worldOffset)),t.preventAutoStart&&(l.preventAutoStart=t.preventAutoStart),r||l.preventAutoStart||l.start(),l}serialize(t=!1){let e={};if(M._Serialize(e,this,t),e.textureMask=this.textureMask.asArray(),e.customShader=this.customShader,e.preventAutoStart=this.preventAutoStart,e.worldOffset=this.worldOffset.asArray(),this.subEmitters)for(let i of(e.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray(),this._subEmitters)){let r=[];for(let e of i)r.push(e.serialize(t));e.subEmitters.push(r)}return e}static _Serialize(t,e,i){if(t.name=e.name,t.id=e.id,t.capacity=e.getCapacity(),t.disposeOnStop=e.disposeOnStop,t.manualEmitCount=e.manualEmitCount,e.emitter.position){let i=e.emitter;t.emitterId=i.id}else{let i=e.emitter;t.emitter=i.asArray()}e.particleEmitterType&&(t.particleEmitterType=e.particleEmitterType.serialize()),e.particleTexture&&(i?t.texture=e.particleTexture.serialize():(t.textureName=e.particleTexture.name,t.invertY=!!e.particleTexture._invertY)),t.isLocal=e.isLocal,P.p.AppendSerializedAnimations(e,t),t.beginAnimationOnStart=e.beginAnimationOnStart,t.beginAnimationFrom=e.beginAnimationFrom,t.beginAnimationTo=e.beginAnimationTo,t.beginAnimationLoop=e.beginAnimationLoop,t.startDelay=e.startDelay,t.renderingGroupId=e.renderingGroupId,t.isBillboardBased=e.isBillboardBased,t.billboardMode=e.billboardMode,t.minAngularSpeed=e.minAngularSpeed,t.maxAngularSpeed=e.maxAngularSpeed,t.minSize=e.minSize,t.maxSize=e.maxSize,t.minScaleX=e.minScaleX,t.maxScaleX=e.maxScaleX,t.minScaleY=e.minScaleY,t.maxScaleY=e.maxScaleY,t.minEmitPower=e.minEmitPower,t.maxEmitPower=e.maxEmitPower,t.minLifeTime=e.minLifeTime,t.maxLifeTime=e.maxLifeTime,t.emitRate=e.emitRate,t.gravity=e.gravity.asArray(),t.noiseStrength=e.noiseStrength.asArray(),t.color1=e.color1.asArray(),t.color2=e.color2.asArray(),t.colorDead=e.colorDead.asArray(),t.updateSpeed=e.updateSpeed,t.targetStopDuration=e.targetStopDuration,t.blendMode=e.blendMode,t.preWarmCycles=e.preWarmCycles,t.preWarmStepOffset=e.preWarmStepOffset,t.minInitialRotation=e.minInitialRotation,t.maxInitialRotation=e.maxInitialRotation,t.startSpriteCellID=e.startSpriteCellID,t.spriteCellLoop=e.spriteCellLoop,t.endSpriteCellID=e.endSpriteCellID,t.spriteCellChangeSpeed=e.spriteCellChangeSpeed,t.spriteCellWidth=e.spriteCellWidth,t.spriteCellHeight=e.spriteCellHeight,t.spriteRandomStartCell=e.spriteRandomStartCell,t.isAnimationSheetEnabled=e.isAnimationSheetEnabled,t.useLogarithmicDepth=e.useLogarithmicDepth;let r=e.getColorGradients();if(r)for(let e of(t.colorGradients=[],r)){let i={gradient:e.gradient,color1:e.color1.asArray()};e.color2?i.color2=e.color2.asArray():i.color2=e.color1.asArray(),t.colorGradients.push(i)}let s=e.getRampGradients();if(s){for(let e of(t.rampGradients=[],s)){let i={gradient:e.gradient,color:e.color.asArray()};t.rampGradients.push(i)}t.useRampGradients=e.useRampGradients}let n=e.getColorRemapGradients();if(n)for(let e of(t.colorRemapGradients=[],n)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.colorRemapGradients.push(i)}let a=e.getAlphaRemapGradients();if(a)for(let e of(t.alphaRemapGradients=[],a)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.alphaRemapGradients.push(i)}let o=e.getSizeGradients();if(o)for(let e of(t.sizeGradients=[],o)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.sizeGradients.push(i)}let h=e.getAngularSpeedGradients();if(h)for(let e of(t.angularSpeedGradients=[],h)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.angularSpeedGradients.push(i)}let d=e.getVelocityGradients();if(d)for(let e of(t.velocityGradients=[],d)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.velocityGradients.push(i)}let l=e.getDragGradients();if(l)for(let e of(t.dragGradients=[],l)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.dragGradients.push(i)}let c=e.getEmitRateGradients();if(c)for(let e of(t.emitRateGradients=[],c)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.emitRateGradients.push(i)}let u=e.getStartSizeGradients();if(u)for(let e of(t.startSizeGradients=[],u)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.startSizeGradients.push(i)}let m=e.getLifeTimeGradients();if(m)for(let e of(t.lifeTimeGradients=[],m)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.lifeTimeGradients.push(i)}let p=e.getLimitVelocityGradients();if(p){for(let e of(t.limitVelocityGradients=[],p)){let i={gradient:e.gradient,factor1:e.factor1};void 0!==e.factor2?i.factor2=e.factor2:i.factor2=e.factor1,t.limitVelocityGradients.push(i)}t.limitVelocityDamping=e.limitVelocityDamping}e.noiseTexture&&(t.noiseTexture=e.noiseTexture.serialize())}clone(t,e,i=!1){let r={...this._customWrappers},s=null,n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){let t=(s=this.customShader).shaderOptions.defines.length>0?s.shaderOptions.defines.join("\n"):"",e=n.createEffectForParticles(s.shaderPath.fragmentElement,s.shaderOptions.uniforms,s.shaderOptions.samplers,t);r[0]?r[0].effect=e:this.setCustomEffect(e,0)}let a=this.serialize(i),o=M.Parse(a,this._scene||this._engine,this._rootUrl);return o.name=t,o.customShader=s,o._customWrappers=r,void 0===e&&(e=this.emitter),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.emitter=e,this.preventAutoStart||o.start(),o}}M.BILLBOARDMODE_Y=2,M.BILLBOARDMODE_ALL=7,M.BILLBOARDMODE_STRETCHED=8,M.BILLBOARDMODE_STRETCHED_LOCAL=9,b.H._ParseParticleSystem=M.Parse},22510:function(t,e,i){i.d(e,{H:function(){return h}});var r,s,n=i(39884),a=i(10633),o=i(7724);(r=s||(s={}))[r.ATTACHED=0]="ATTACHED",r[r.END=1]="END";class h{constructor(t){if(this.particleSystem=t,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.emitter||!t.emitter.dispose){let e=(0,o.qw)("BABYLON.AbstractMesh");t.emitter=new e("SubemitterSystemEmitter",t.getScene()),t._disposeEmitterOnDispose=!0}}clone(){let t=this.particleSystem.emitter;t?t instanceof n.P?t=t.clone():-1!==t.getClassName().indexOf("Mesh")&&((t=new((0,o.qw)("BABYLON.Mesh"))("",t.getScene())).isVisible=!1):t=new n.P;let e=new h(this.particleSystem.clone(this.particleSystem.name,t));return e.particleSystem.name+="Clone",e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem._disposeEmitterOnDispose=!0,e.particleSystem.disposeOnStop=!0,e}serialize(t=!1){let e={};return e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem=this.particleSystem.serialize(t),e}static _ParseParticleSystem(t,e,i,r=!1){throw(0,a.S)("ParseParticle")}static Parse(t,e,i){let r=t.particleSystem,s=new h(h._ParseParticleSystem(r,e,i,!0));return s.type=t.type,s.inheritDirection=t.inheritDirection,s.inheritedVelocityAmount=t.inheritedVelocityAmount,s.particleSystem._isSubEmitter=!0,s}dispose(){this.particleSystem.dispose()}}}}]);