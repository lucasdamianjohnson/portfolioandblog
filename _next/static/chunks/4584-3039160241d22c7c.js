"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4584],{9609:function(e,t,r){r.d(t,{r:function(){return n}});function n(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}},64584:function(e,t,r){let n,a,s,o,l,h,c,u,d,m,p,A,f,g,v,y,x,b,w,C,E,I,M,B,S,T,F,P,_,D,R,L,N,k;r.r(t),r.d(t,{ACESFilmicToneMappingShader:function(){return hr},AMFLoader:function(){return d4},ARButton:function(){return lr},AdaptiveToneMappingPass:function(){return oE},AfterimagePass:function(){return oN},AfterimageShader:function(){return o_},AmmoPhysics:function(){return co},AnaglyphEffect:function(){return cu},AnimationClipCreator:function(){return r_},ArcballControls:function(){return sX},AsciiEffect:function(){return cd},AssimpLoader:function(){return uR},BVHLoader:function(){return c4},BasicShader:function(){return hn},BasisTextureLoader:function(){return uq},BatchedMesh:function(){return nu},BleachBypassShader:function(){return ha},BlendShader:function(){return hs},BloomPass:function(){return o6},BlurShaderUtils:function(){return oT},BokehDepthShader:function(){return af},BokehPass:function(){return ox.A},BokehShader:function(){return ho.v},BokehShader2:function(){return aA},BoxLineGeometry:function(){return lq},BrightnessContrastShader:function(){return hl},CCDIKHelper:function(){return rX},CCDIKSolver:function(){return rV},CSM:function(){return ht},CSMFrustum:function(){return l3},CSMHelper:function(){return hi},CSMShader:function(){return l4},CSS2DObject:function(){return eY},CSS2DRenderer:function(){return e0},CSS3DObject:function(){return e4},CSS3DRenderer:function(){return e9},CSS3DSprite:function(){return e5},CameraControls:function(){return a7},Capsule:function(){return aH},CinematicCamera:function(){return ag},CinquefoilKnot:function(){return pi},ClearMaskPass:function(){return ok.M},ClearPass:function(){return s2},ColladaExporter:function(){return rf},ColladaLoader:function(){return c5},ColorConverter:function(){return aV},ColorCorrectionShader:function(){return hh},ColorMapKeywords:function(){return a4},ColorifyShader:function(){return hc},ConvexGeometry:function(){return eA},ConvexHull:function(){return ec},ConvexObjectBreaker:function(){return eg},ConvolutionShader:function(){return o3},CopyShader:function(){return ol.C},CubeTexturePass:function(){return oM},DDSLoader:function(){return uH},DOFMipMapShader:function(){return hu},DRACOExporter:function(){return rd},DRACOLoader:function(){return mc},DecalGeometry:function(){return lZ},DecalVertex:function(){return l$},DecoratedTorusKnot4a:function(){return pa},DecoratedTorusKnot4b:function(){return ps},DecoratedTorusKnot5a:function(){return po},DecoratedTorusKnot5c:function(){return pl},DepthLimitedBlurShader:function(){return oS},DeviceOrientationControls:function(){return sP},DigitalGlitch:function(){return s3},DotScreenPass:function(){return oz},DotScreenShader:function(){return oQ},DragControls:function(){return sg},EXRLoader:function(){return uk},EdgeSplitModifier:function(){return t_},EffectComposer:function(){return oU.x},FBXLoader:function(){return cI},FXAAShader:function(){return hd},Face:function(){return eu},Face3:function(){return pp},FigureEightPolynomialKnot:function(){return pn},FilmPass:function(){return oo.t},FilmShader:function(){return hm.e},FirstPersonControls:function(){return so},FlakesTexture:function(){return to},Flow:function(){return tf},FlyControls:function(){return sY.m},FocusShader:function(){return hp},Font:function(){return cY},FontLoader:function(){return cX},FreiChenShader:function(){return hA},FresnelShader:function(){return hf},FullScreenQuad:function(){return sZ.T},GCodeLoader:function(){return uj},GLTFExporter:function(){return tH},GLTFLoader:function(){return ln.E},GPUComputationRenderer:function(){return ev},GammaCorrectionShader:function(){return hg},Geometry:function(){return pd},GeometryCompressionUtils:function(){return am},GeometryUtils:function(){return n9},GlitchPass:function(){return s6},GodRaysCombineShader:function(){return hx},GodRaysDepthMaskShader:function(){return hv},GodRaysFakeSunShader:function(){return hb},GodRaysGenerateShader:function(){return hy},GrannyKnot:function(){return m5},GroundProjectedEnv:function(){return n3},Gyroscope:function(){return eI},HDRCubeTextureLoader:function(){return md},HTMLMesh:function(){return hX},HalfEdge:function(){return ed},HalftonePass:function(){return oi},HalftoneShader:function(){return s9},HeartCurve:function(){return m8},HelixCurve:function(){return m7},HorizontalBlurShader:function(){return hw},HorizontalTiltShiftShader:function(){return hC},HueSaturationShader:function(){return hE},ImprovedNoise:function(){return aY},InstancedFlow:function(){return tv},InteractiveGroup:function(){return h$},KMZLoader:function(){return c8},KTX2Loader:function(){return uC},KTXLoader:function(){return mi},KaleidoShader:function(){return hI},KnotCurve:function(){return m9},LDrawLoader:function(){return dH},LUT3dlLoader:function(){return uG},LUTCubeLoader:function(){return cq},LUTPass:function(){return sq},LWOLoader:function(){return mP},Lensflare:function(){return nB},LensflareElement:function(){return nS},LightProbeGenerator:function(){return m3},LightProbeHelper:function(){return mW},LightningStorm:function(){return nH},LightningStrike:function(){return nG},Line2:function(){return mj},LineGeometry:function(){return mk},LineMaterial:function(){return mU.Y},LineSegments2:function(){return mV.w},LineSegmentsGeometry:function(){return mN.z},LottieLoader:function(){return uF},LuminosityHighPassShader:function(){return hM.Y},LuminosityShader:function(){return ow},Lut:function(){return a3},MD2Character:function(){return eH},MD2CharacterComplex:function(){return en},MD2Loader:function(){return ei},MDDLoader:function(){return uL},MMDAnimationHelper:function(){return r4},MMDExporter:function(){return rb},MMDLoader:function(){return d5},MMDPhysics:function(){return rK},MTLLoader:function(){return c1},MapControls:function(){return sN.o},MapControlsExp:function(){return st},MarchingCubes:function(){return nF},MaskPass:function(){return ok.F},MeshSurfaceSampler:function(){return ax},MeshoptDecoder:function(){return pA},MirrorShader:function(){return hB},MorphAnimMesh:function(){return eM},MorphBlendMesh:function(){return er},MotionController:function(){return lF},MotionControllerConstants:function(){return lC},NRRDLoader:function(){return cZ},NURBSCurve:function(){return cC},NURBSSurface:function(){return m4},NormalMapShader:function(){return hS},OBB:function(){return ak},OBJExporter:function(){return rF},OBJLoader:function(){return d3},Octree:function(){return a2},OculusHandModel:function(){return ld},OculusHandPointerModel:function(){return lA},OrbitControls:function(){return sN.z},OrbitControlsExp:function(){return se},OutlineEffect:function(){return cc},OutlinePass:function(){return od},PCDLoader:function(){return mE},PDBLoader:function(){return mm},PLYExporter:function(){return ro},PLYLoader:function(){return mL},PRWMLoader:function(){return my},PVRLoader:function(){return uz},PackedPhongMaterial:function(){return ap},ParallaxBarrierEffect:function(){return cl},ParallaxShader:function(){return hT},ParametricGeometries:function(){return lX},ParametricGeometry:function(){return lj},Pass:function(){return sZ.w},PeppersGhostEffect:function(){return ch},PixelShader:function(){return hF},PointerLockControls:function(){return sB},PositionalAudioHelper:function(){return mJ},ProgressiveLightMap:function(){return eX},Projector:function(){return tn},RGBELoader:function(){return uD},RGBMLoader:function(){return mx},RGBShiftShader:function(){return hP},RectAreaLightHelper:function(){return m1},RectAreaLightUniformsLib:function(){return m2.a},Reflector:function(){return np},ReflectorForSSRPass:function(){return nW},ReflectorRTT:function(){return nz},Refractor:function(){return ng},RenderPass:function(){return o0.C},RenderPixelatedPass:function(){return o1},RenderableFace:function(){return te},RenderableLine:function(){return ti},RenderableObject:function(){return e7},RenderableSprite:function(){return tr},RenderableVertex:function(){return tt},Rhino3dmLoader:function(){return dj},RollerCoasterGeometry:function(){return eB},RollerCoasterLiftersGeometry:function(){return eS},RollerCoasterShadowGeometry:function(){return eT},RoomEnvironment:function(){return rP},RoughnessMipmapper:function(){return as},RoundedBoxGeometry:function(){return lJ},SAOPass:function(){return oP},SAOShader:function(){return oB},SMAABlendShader:function(){return oa},SMAAEdgesShader:function(){return or},SMAAPass:function(){return os},SMAAWeightsShader:function(){return on},SSAARenderPass:function(){return oJ},SSAOBlurShader:function(){return oA},SSAODepthShader:function(){return op},SSAOPass:function(){return ov},SSAOShader:function(){return om},SSRBlurShader:function(){return oW},SSRDepthShader:function(){return oj},SSRPass:function(){return oK},SSRShader:function(){return oV},STATE:function(){return a9},STLExporter:function(){return rM},STLLoader:function(){return c0},SVGLoader:function(){return dz},SVGObject:function(){return ta},SVGRenderer:function(){return ts},SavePass:function(){return oy},SceneUtils:function(){return n4},SelectionBox:function(){return cs},SelectionHelper:function(){return h0},SepiaShader:function(){return h_},ShaderPass:function(){return sK.T},ShadowMapViewer:function(){return ad},ShadowMesh:function(){return ny},SimplexNoise:function(){return nN},SimplifyModifier:function(){return tS},SkeletonUtils:function(){return ac},Sky:function(){return nZ},SkyGeometry:function(){return eF},SobelOperatorShader:function(){return hD},StereoEffect:function(){return cm},SubsurfaceScatteringShader:function(){return hL},TAARenderPass:function(){return oZ},TDSLoader:function(){return uZ},TGALoader:function(){return cK},TTFLoader:function(){return u_},TeapotGeometry:function(){return l0},TechnicolorShader:function(){return hN},TessellateModifier:function(){return tN},TextBufferGeometry:function(){return l1},TextGeometry:function(){return l1},TexturePass:function(){return ob},ThreeMFLoader:function(){return uU},TiltLoader:function(){return mn},Timer:function(){return eL},ToneMapShader:function(){return oC},ToonShader1:function(){return hk},ToonShader2:function(){return hU},ToonShaderDotted:function(){return hO},ToonShaderHatching:function(){return hQ},TorusKnot:function(){return pt},TrackballControls:function(){return sL},TrackballControlsExp:function(){return si},TransformControls:function(){return su},TransformControlsGizmo:function(){return sd},TransformControlsPlane:function(){return sm},TreesGeometry:function(){return eP},TrefoilKnot:function(){return pe},TrefoilPolynomialKnot:function(){return pr},TriangleBlurShader:function(){return hG},TubePainter:function(){return eV},USDZExporter:function(){return rs},UVsDebug:function(){return n5},UnpackDepthRGBAShader:function(){return au},UnrealBloomPass:function(){return oI.m},VOXData3DTexture:function(){return mC},VOXLoader:function(){return mb},VOXMesh:function(){return mw},VRButton:function(){return ly},VRMLLoader:function(){return c7},VRMLoader:function(){return c6},VTKLoader:function(){return uO},VertexList:function(){return ep},VertexNode:function(){return em},VertexNormalsHelper:function(){return m0},VertexTangentsHelper:function(){return mK},VerticalBlurShader:function(){return hH},VerticalTiltShiftShader:function(){return hz},VignetteShader:function(){return hV},VivianiCurve:function(){return m6},Volume:function(){return ej},VolumeRenderShader1:function(){return hj},VolumeSlice:function(){return ez},Water:function(){return nT.B},Water2:function(){return n1},WaterPass:function(){return li},WaterRefractionShader:function(){return hW},Wireframe:function(){return mH},WireframeGeometry2:function(){return mz},XLoader:function(){return c3},XRControllerModelFactory:function(){return lk},XREstimatedLight:function(){return lQ},XRHandMeshModel:function(){return ll},XRHandModelFactory:function(){return lV},XRHandPrimitiveModel:function(){return lH},XYZLoader:function(){return uQ},calcBSplineDerivatives:function(){return cv},calcBSplinePoint:function(){return cf},calcBasisFunctionDerivatives:function(){return cg},calcBasisFunctions:function(){return cA},calcKoverI:function(){return cy},calcNURBSDerivatives:function(){return cb},calcRationalCurveDerivatives:function(){return cx},calcSurfacePoint:function(){return cw},computeMorphedAttributes:function(){return ty.computeMorphedAttributes},createText:function(){return lf},edgeTable:function(){return nP},estimateBytesUsed:function(){return ty.estimateBytesUsed},fetchProfile:function(){return lM},fetchProfilesList:function(){return lI},findSpan:function(){return cp},getErrorMessage:function(){return eG},getUniforms:function(){return tp},getWebGL2ErrorMessage:function(){return eO},getWebGLErrorMessage:function(){return eQ},initSplineTexture:function(){return tu},interleaveAttributes:function(){return ty.interleaveAttributes},isWebGL2Available:function(){return eU},isWebGLAvailable:function(){return ek},mergeBufferAttributes:function(){return ty.mergeBufferAttributes},mergeBufferGeometries:function(){return ty.mergeBufferGeometries},mergeVertices:function(){return ty.mergeVertices},modifyShader:function(){return tA},toCreasedNormals:function(){return ty.toCreasedNormals},toTrianglesDrawMode:function(){return ty.toTrianglesDrawMode},triTable:function(){return n_},updateSplineTexture:function(){return td}});var U,Q,O,G,H,z,V,j,W,X,Y,K,J,q,Z,$,ee=r(79290);let et=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class ei extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=new DataView(e),r={},n=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let e=0;e<n.length;e++)r[n[e]]=t.getInt32(4*e,!0);if(844121161!==r.ident||8!==r.version){console.error("Not a valid MD2 file");return}if(r.offset_end!==t.byteLength){console.error("Corrupted MD2 file");return}let a=new ee.u9r,s=[],o=r.offset_st;for(let e=0,n=r.num_st;e<n;e++){let e=t.getInt16(o+0,!0),n=t.getInt16(o+2,!0);s.push(e/r.skinwidth,1-n/r.skinheight),o+=4}o=r.offset_tris;let l=[],h=[];for(let e=0,n=r.num_tris;e<n;e++)l.push(t.getUint16(o+0,!0),t.getUint16(o+2,!0),t.getUint16(o+4,!0)),h.push(t.getUint16(o+6,!0),t.getUint16(o+8,!0),t.getUint16(o+10,!0)),o+=12;let c=new ee.Pa4,u=new ee.Pa4,d=[],m=[];o=r.offset_frames;for(let e=0,n=r.num_frames;e<n;e++){u.set(t.getFloat32(o+0,!0),t.getFloat32(o+4,!0),t.getFloat32(o+8,!0)),c.set(t.getFloat32(o+12,!0),t.getFloat32(o+16,!0),t.getFloat32(o+20,!0)),o+=24;for(let e=0;e<16;e++){let r=t.getUint8(o+e,!0);if(0===r)break;d[e]=r}let e={name:String.fromCharCode.apply(null,d),vertices:[],normals:[]};o+=16;for(let n=0;n<r.num_vertices;n++){let r=t.getUint8(o++,!0),n=t.getUint8(o++,!0),a=t.getUint8(o++,!0),s=et[t.getUint8(o++,!0)];r=r*u.x+c.x,n=n*u.y+c.y,a=a*u.z+c.z,e.vertices.push(r,a,n),e.normals.push(s[0],s[2],s[1])}m.push(e)}let p=[],A=[],f=[],g=m[0].vertices,v=m[0].normals;for(let e=0,t=l.length;e<t;e++){let t=3*l[e],r=g[t],n=g[t+1],a=g[t+2];p.push(r,n,a);let o=v[t],c=v[t+1],u=v[t+2];A.push(o,c,u);let d=s[t=2*h[e]],m=s[t+1];f.push(d,m)}a.setAttribute("position",new ee.a$l(p,3)),a.setAttribute("normal",new ee.a$l(A,3)),a.setAttribute("uv",new ee.a$l(f,2));let y=[],x=[];for(let e=0,t=m.length;e<t;e++){let t=m[e],r=t.name;if(t.vertices.length>0){let e=[];for(let r=0,n=l.length;r<n;r++){let n=3*l[r],a=t.vertices[n],s=t.vertices[n+1],o=t.vertices[n+2];e.push(a,s,o)}let n=new ee.a$l(e,3);n.name=r,y.push(n)}if(t.normals.length>0){let e=[];for(let r=0,n=l.length;r<n;r++){let n=3*l[r],a=t.normals[n],s=t.normals[n+1],o=t.normals[n+2];e.push(a,s,o)}let n=new ee.a$l(e,3);n.name=r,x.push(n)}}return a.morphAttributes.position=y,a.morphAttributes.normal=x,a.morphTargetsRelative=!1,a.animations=ee.m7l.CreateClipsFromMorphTargetSequences(m,10),a}}class er extends ee.Kj0{constructor(e,t){super(e,t),this.animationsMap={},this.animationsList=[];let r=Object.keys(this.morphTargetDictionary).length,n="__default";this.createAnimation(n,0,r-1,r/1),this.setAnimationWeight(n,1)}createAnimation(e,t,r,n){let a={start:t,end:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=a,this.animationsList.push(a)}autoCreateAnimations(e){let t;let r=/([a-z]+)_?(\d+)/i,n={},a=0;for(let e in this.morphTargetDictionary){let s=e.match(r);if(s&&s.length>1){let e=s[1];n[e]||(n[e]={start:1/0,end:-1/0});let r=n[e];a<r.start&&(r.start=a),a>r.end&&(r.end=a),t||(t=e)}a++}for(let t in n){let r=n[t];this.createAnimation(t,r.start,r.end,e)}this.firstAnimation=t}setAnimationDirectionForward(e){let t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)}setAnimationDirectionBackward(e){let t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)}setAnimationFPS(e,t){let r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)}setAnimationDuration(e,t){let r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)}setAnimationWeight(e,t){let r=this.animationsMap[e];r&&(r.weight=t)}setAnimationTime(e,t){let r=this.animationsMap[e];r&&(r.time=t)}getAnimationTime(e){let t=0,r=this.animationsMap[e];return r&&(t=r.time),t}getAnimationDuration(e){let t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t}playAnimation(e){let t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")}stopAnimation(e){let t=this.animationsMap[e];t&&(t.active=!1)}update(e){for(let t=0,r=this.animationsList.length;t<r;t++){let r=this.animationsList[t];if(!r.active)continue;let n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));let a=r.start+ee.M8C.clamp(Math.floor(r.time/n),0,r.length-1),s=r.weight;a!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[a]=0,r.lastFrame=r.currentFrame,r.currentFrame=a);let o=r.time%n/n;r.directionBackwards&&(o=1-o),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=o*s,this.morphTargetInfluences[r.lastFrame]=(1-o)*s):this.morphTargetInfluences[r.currentFrame]=s}}}class en{constructor(){this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new ee.Tme,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=.5*this.maxSpeed,this.activeAnimation=null,this.oldAnimation=null}enableShadows(e){for(let t=0;t<this.meshes.length;t++)this.meshes[t].castShadow=e,this.meshes[t].receiveShadow=e}setVisible(e){for(let t=0;t<this.meshes.length;t++)this.meshes[t].visible=e,this.meshes[t].visible=e}shareParts(e){this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.skinsBody=e.skinsBody,this.skinsWeapon=e.skinsWeapon;let t=this._createPart(e.meshBody.geometry,this.skinsBody[0]);t.scale.set(this.scale,this.scale,this.scale),this.root.position.y=e.root.position.y,this.root.add(t),this.meshBody=t,this.meshes.push(t);for(let t=0;t<e.weapons.length;t++){let r=this._createPart(e.weapons[t].geometry,this.skinsWeapon[t]);r.scale.set(this.scale,this.scale,this.scale),r.visible=!1,r.name=e.weapons[t].name,this.root.add(r),this.weapons[t]=r,this.meshWeapon=r,this.meshes.push(r)}}loadParts(e){let t=this;function r(e,t){let r=new ee.dpR,a=[];for(let s=0;s<t.length;s++)a[s]=r.load(e+t[s],n),a[s].mapping=ee.xfE,a[s].name=t[s],"colorSpace"in a[s]?a[s].colorSpace="srgb":a[s].encoding=3001;return a}function n(){t.loadCounter-=1,0===t.loadCounter&&t.onLoadComplete()}this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.loadCounter=2*e.weapons.length+e.skins.length+1;let a=[];for(let t=0;t<e.weapons.length;t++)a[t]=e.weapons[t][1];this.skinsBody=r(e.baseUrl+"skins/",e.skins),this.skinsWeapon=r(e.baseUrl+"skins/",a);let s=new ei;s.load(e.baseUrl+e.body,function(e){let r=new ee.ZzF;r.setFromBufferAttribute(e.attributes.position),t.root.position.y=-t.scale*r.min.y;let a=t._createPart(e,t.skinsBody[0]);a.scale.set(t.scale,t.scale,t.scale),t.root.add(a),t.meshBody=a,t.meshes.push(a),n()});let o=function(e,r){return function(a){let s=t._createPart(a,t.skinsWeapon[e]);s.scale.set(t.scale,t.scale,t.scale),s.visible=!1,s.name=r,t.root.add(s),t.weapons[e]=s,t.meshWeapon=s,t.meshes.push(s),n()}};for(let t=0;t<e.weapons.length;t++)s.load(e.baseUrl+e.weapons[t][0],o(t,e.weapons[t][0]))}setPlaybackRate(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)}setWireframe(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e],this.currentSkin=e)}setWeapon(e){for(let e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;let t=this.weapons[e];t&&(t.visible=!0,this.meshWeapon=t,this.activeAnimation&&(t.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))}setAnimation(e){e!==this.activeAnimation&&e&&(this.meshBody&&(this.meshBody.setAnimationWeight(e,0),this.meshBody.playAnimation(e),this.oldAnimation=this.activeAnimation,this.activeAnimation=e,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(e,0),this.meshWeapon.playAnimation(e)))}update(e){this.controls&&this.updateMovementModel(e),this.animations&&(this.updateBehaviors(),this.updateAnimations(e))}updateAnimations(e){let t=1;this.blendCounter>0&&(t=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(e),this.meshBody.setAnimationWeight(this.activeAnimation,t),this.meshBody.setAnimationWeight(this.oldAnimation,1-t)),this.meshWeapon&&(this.meshWeapon.update(e),this.meshWeapon.setAnimationWeight(this.activeAnimation,t),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-t))}updateBehaviors(){let e,t;let r=this.controls,n=this.animations;r.crouch?(e=n.crouchMove,t=n.crouchIdle):(e=n.move,t=n.idle),r.jump&&(e=n.jump,t=n.jump),r.attack&&(r.crouch?(e=n.crouchAttack,t=n.crouchAttack):(e=n.attack,t=n.attack)),(r.moveForward||r.moveBackward||r.moveLeft||r.moveRight)&&this.activeAnimation!==e&&this.setAnimation(e),Math.abs(this.speed)<.2*this.maxSpeed&&!(r.moveLeft||r.moveRight||r.moveForward||r.moveBackward)&&this.activeAnimation!==t&&this.setAnimation(t),r.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),r.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))}updateMovementModel(e){function t(e){return 1===e?1:-Math.pow(2,-10*e)+1}let r=this.controls;if(r.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,r.moveForward&&(this.speed=ee.M8C.clamp(this.speed+e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),r.moveBackward&&(this.speed=ee.M8C.clamp(this.speed-e*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed)),r.moveLeft&&(this.bodyOrientation+=e*this.angularSpeed,this.speed=ee.M8C.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),r.moveRight&&(this.bodyOrientation-=e*this.angularSpeed,this.speed=ee.M8C.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!(r.moveForward||r.moveBackward)){if(this.speed>0){let r=t(this.speed/this.maxSpeed);this.speed=ee.M8C.clamp(this.speed-r*e*this.frontDecceleration,0,this.maxSpeed)}else{let r=t(this.speed/this.maxReverseSpeed);this.speed=ee.M8C.clamp(this.speed+r*e*this.backAcceleration,this.maxReverseSpeed,0)}}let n=this.speed*e;this.root.position.x+=Math.sin(this.bodyOrientation)*n,this.root.position.z+=Math.cos(this.bodyOrientation)*n,this.root.rotation.y=this.bodyOrientation}_createPart(e,t){let r=new ee.YBo({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),n=new ee.YBo({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),a=new er(e,n);return a.rotation.y=-Math.PI/2,a.materialTexture=n,a.materialWireframe=r,a.autoCreateAnimations(this.animationFPS),a}}let ea=new ee.Pa4,es=new ee.Zzh,eo=new ee.JOQ,el=new ee.Pa4,eh=new ee.CJI;class ec{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new ep,this.unassigned=new ep,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.vertices.push(new em(e[t]));this.compute()}return this}setFromObject(e){let t=[];return e.updateMatrixWorld(!0),e.traverse(function(e){let r=e.geometry;if(void 0!==r){let n=r.attributes.position;if(void 0!==n)for(let r=0,a=n.count;r<a;r++){let a=new ee.Pa4;a.fromBufferAttribute(n,r).applyMatrix4(e.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){let t=this.faces;for(let r=0,n=t.length;r<n;r++)if(t[r].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){let r=this.faces,n=-1/0,a=1/0;for(let t=0,s=r.length;t<s;t++){let s=r[t],o=s.distanceToPoint(e.origin),l=s.normal.dot(e.direction);if(o>0&&l>=0)return null;let h=0!==l?-o/l:0;if(!(h<=0)&&(l>0?a=Math.min(h,a):n=Math.max(h,n),n>a))return null}return n!==-1/0?e.at(n,t):e.at(a,t),t}intersectsRay(e){return null!==this.intersectRay(e,ea)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(null!==e.outside){let t=e.outside,r=e.outside;for(;null!==r.next&&r.next.face===e;)r=r.next;return this.assigned.removeSubList(t,r),t.prev=r.next=null,e.outside=null,t}}deleteFaceVertices(e,t){let r=this.removeAllVerticesFromFace(e);if(void 0!==r){if(void 0===t)this.unassigned.appendChain(r);else{let e=r;do{let r=e.next;t.distanceToPoint(e.point)>this.tolerance?this.addVertexToFace(e,t):this.unassigned.append(e),e=r}while(null!==e)}}return this}resolveUnassignedPoints(e){if(!1===this.unassigned.isEmpty()){let t=this.unassigned.first();do{let r=t.next,n=this.tolerance,a=null;for(let r=0;r<e.length;r++){let s=e[r];if(0===s.mark){let e=s.distanceToPoint(t.point);if(e>n&&(n=e,a=s),n>1e3*this.tolerance)break}}null!==a&&this.addVertexToFace(t,a),t=r}while(null!==t)}return this}computeExtremes(){let e=new ee.Pa4,t=new ee.Pa4,r=[],n=[];for(let e=0;e<3;e++)r[e]=n[e]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let a=0,s=this.vertices.length;a<s;a++){let s=this.vertices[a],o=s.point;for(let t=0;t<3;t++)o.getComponent(t)<e.getComponent(t)&&(e.setComponent(t,o.getComponent(t)),r[t]=s);for(let e=0;e<3;e++)o.getComponent(e)>t.getComponent(e)&&(t.setComponent(e,o.getComponent(e)),n[e]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:r,max:n}}computeInitialHull(){let e,t;let r=this.vertices,n=this.computeExtremes(),a=n.min,s=n.max,o=0,l=0;for(let e=0;e<3;e++){let t=s[e].point.getComponent(e)-a[e].point.getComponent(e);t>o&&(o=t,l=e)}let h=a[l],c=s[l];o=0,es.set(h.point,c.point);for(let t=0,n=this.vertices.length;t<n;t++){let n=r[t];if(n!==h&&n!==c){es.closestPointToPoint(n.point,!0,el);let t=el.distanceToSquared(n.point);t>o&&(o=t,e=n)}}o=-1,eo.setFromCoplanarPoints(h.point,c.point,e.point);for(let n=0,a=this.vertices.length;n<a;n++){let a=r[n];if(a!==h&&a!==c&&a!==e){let e=Math.abs(eo.distanceToPoint(a.point));e>o&&(o=e,t=a)}}let u=[];if(0>eo.distanceToPoint(t.point)){u.push(eu.create(h,c,e),eu.create(t,c,h),eu.create(t,e,c),eu.create(t,h,e));for(let e=0;e<3;e++){let t=(e+1)%3;u[e+1].getEdge(2).setTwin(u[0].getEdge(t)),u[e+1].getEdge(1).setTwin(u[t+1].getEdge(0))}}else{u.push(eu.create(h,e,c),eu.create(t,h,c),eu.create(t,c,e),eu.create(t,e,h));for(let e=0;e<3;e++){let t=(e+1)%3;u[e+1].getEdge(2).setTwin(u[0].getEdge((3-e)%3)),u[e+1].getEdge(0).setTwin(u[t+1].getEdge(1))}}for(let e=0;e<4;e++)this.faces.push(u[e]);for(let n=0,a=r.length;n<a;n++){let a=r[n];if(a!==h&&a!==c&&a!==e&&a!==t){o=this.tolerance;let e=null;for(let t=0;t<4;t++){let r=this.faces[t].distanceToPoint(a.point);r>o&&(o=r,e=this.faces[t])}null!==e&&this.addVertexToFace(a,e)}}return this}reindexFaces(){let e=[];for(let t=0;t<this.faces.length;t++){let r=this.faces[t];0===r.mark&&e.push(r)}return this.faces=e,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let e,t=0,r=this.assigned.first().face,n=r.outside;do{let a=r.distanceToPoint(n.point);a>t&&(t=a,e=n),n=n.next}while(null!==n&&n.face===r);return e}}computeHorizon(e,t,r,n){let a;this.deleteFaceVertices(r),r.mark=1,a=null===t?t=r.getEdge(0):t.next;do{let t=a.twin,r=t.face;0===r.mark&&(r.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,t,r,n):n.push(a)),a=a.next}while(a!==t);return this}addAdjoiningFace(e,t){let r=eu.create(e,t.tail(),t.head());return this.faces.push(r),r.getEdge(-1).setTwin(t.twin),r.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let r=null,n=null;for(let a=0;a<t.length;a++){let s=t[a],o=this.addAdjoiningFace(e,s);null===r?r=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return r.next.setTwin(n),this}addVertexToHull(e){let t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class eu{constructor(){this.normal=new ee.Pa4,this.midpoint=new ee.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(e,t,r){let n=new eu,a=new ed(e,n),s=new ed(t,n),o=new ed(r,n);return a.next=o.prev=s,s.next=a.prev=o,o.next=s.prev=a,n.edge=a,n.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){let e=this.edge.tail(),t=this.edge.head(),r=this.edge.next.head();return eh.set(e.point,t.point,r.point),eh.getNormal(this.normal),eh.getMidpoint(this.midpoint),this.area=eh.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class ed{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){let e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}lengthSquared(){let e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class em{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class ep{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this}remove(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return null===this.head}}class eA extends ee.u9r{constructor(e=[]){super();let t=[],r=[],n=new ec().setFromPoints(e).faces;for(let e=0;e<n.length;e++){let a=n[e],s=a.edge;do{let e=s.head().point;t.push(e.x,e.y,e.z),r.push(a.normal.x,a.normal.y,a.normal.z),s=s.next}while(s!==a.edge)}this.setAttribute("position",new ee.a$l(t,3)),this.setAttribute("normal",new ee.a$l(r,3))}}let ef=new ee.Pa4;class eg{constructor(e=1.4,t=1e-4){this.minSizeForBreak=e,this.smallDelta=t,this.tempLine1=new ee.Zzh,this.tempPlane1=new ee.JOQ,this.tempPlane2=new ee.JOQ,this.tempPlane_Cut=new ee.JOQ,this.tempCM1=new ee.Pa4,this.tempCM2=new ee.Pa4,this.tempVector3=new ee.Pa4,this.tempVector3_2=new ee.Pa4,this.tempVector3_3=new ee.Pa4,this.tempVector3_P0=new ee.Pa4,this.tempVector3_P1=new ee.Pa4,this.tempVector3_P2=new ee.Pa4,this.tempVector3_N0=new ee.Pa4,this.tempVector3_N1=new ee.Pa4,this.tempVector3_AB=new ee.Pa4,this.tempVector3_CB=new ee.Pa4,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(let e=0;e<900;e++)this.segments[e]=!1}prepareBreakableObject(e,t,r,n,a){let s=e.userData;s.mass=t,s.velocity=r.clone(),s.angularVelocity=n.clone(),s.breakable=a}subdivideByImpact(e,t,r,n,a){let s=[],o=this.tempPlane1,l=this.tempPlane2;this.tempVector3.addVectors(t,r),o.setFromCoplanarPoints(t,e.position,this.tempVector3);let h=a+n,c=this;return!function a(u,d,m,p){if(Math.random()<.05*p||p>h){s.push(u);return}let A=Math.PI;0===p?(l.normal.copy(o.normal),l.constant=o.constant):p<=n?(A=(m-d)*(.2+.6*Math.random())+d,c.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(r,A).add(t),l.setFromCoplanarPoints(t,c.tempVector3,c.tempVector3_2)):(A=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,c.tempVector3_2.copy(t).sub(u.position).applyAxisAngle(r,A).add(u.position),c.tempVector3_3.copy(r).add(u.position),l.setFromCoplanarPoints(u.position,c.tempVector3_3,c.tempVector3_2)),c.cutByPlane(u,l,c.tempResultObjects);let f=c.tempResultObjects.object1,g=c.tempResultObjects.object2;f&&a(f,d,A,p+1),g&&a(g,A,m,p+1)}(e,0,2*Math.PI,0),s}cutByPlane(e,t,r){let n=e.geometry,a=n.attributes.position.array,s=n.attributes.normal.array,o=a.length/3,l=o/3,h=n.getIndex();function c(e,t){let r=3*e+t;return h?h[r]:r}h&&(l=(h=h.array).length/3);let u=[],d=[],m=this.smallDelta,p=o*o;for(let e=0;e<p;e++)this.segments[e]=!1;let A=this.tempVector3_P0,f=this.tempVector3_P1,g=this.tempVector3_N0,v=this.tempVector3_N1;for(let e=0;e<l-1;e++){let t=c(e,0),r=c(e,1),n=c(e,2);g.set(s[t],s[t]+1,s[t]+2);for(let a=e+1;a<l;a++){let e=c(a,0),l=c(a,1),h=c(a,2);v.set(s[e],s[e]+1,s[e]+2),1-g.dot(v)<m&&(t===e||t===l||t===h?r===e||r===l||r===h?(this.segments[t*o+r]=!0,this.segments[r*o+t]=!0):(this.segments[n*o+t]=!0,this.segments[t*o+n]=!0):(r===e||r===l||r===h)&&(this.segments[n*o+r]=!0,this.segments[r*o+n]=!0))}}let y=this.tempPlane_Cut;e.updateMatrix(),eg.transformPlaneToLocalSpace(t,e.matrix,y);for(let e=0;e<l;e++){let t=c(e,0),n=c(e,1),s=c(e,2);for(let e=0;e<3;e++){let l=0===e?t:1===e?n:s,h=0===e?n:1===e?s:t;if(this.segments[l*o+h])continue;this.segments[l*o+h]=!0,this.segments[h*o+l]=!0,A.set(a[3*l],a[3*l+1],a[3*l+2]),f.set(a[3*h],a[3*h+1],a[3*h+2]);let c=0,p=y.distanceToPoint(A);p>m?(c=2,d.push(A.clone())):p<-m?(c=1,u.push(A.clone())):(c=3,u.push(A.clone()),d.push(A.clone()));let g=0;if((p=y.distanceToPoint(f))>m?(g=2,d.push(f.clone())):p<-m?(g=1,u.push(f.clone())):(g=3,u.push(f.clone()),d.push(f.clone())),1===c&&2===g||2===c&&1===g){this.tempLine1.start.copy(A),this.tempLine1.end.copy(f);let e=new ee.Pa4;if(null===(e=y.intersectLine(this.tempLine1,e)))return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;u.push(e),d.push(e.clone())}}}let x=.5*e.userData.mass;this.tempCM1.set(0,0,0);let b=0,w=u.length;if(w>0){for(let e=0;e<w;e++)this.tempCM1.add(u[e]);this.tempCM1.divideScalar(w);for(let e=0;e<w;e++){let t=u[e];t.sub(this.tempCM1),b=Math.max(b,t.x,t.y,t.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);let C=0,E=d.length;if(E>0){for(let e=0;e<E;e++)this.tempCM2.add(d[e]);this.tempCM2.divideScalar(E);for(let e=0;e<E;e++){let t=d[e];t.sub(this.tempCM2),C=Math.max(C,t.x,t.y,t.z)}this.tempCM2.add(e.position)}let I=null,M=null,B=0;return w>4&&((I=new ee.Kj0(new eA(u),e.material)).position.copy(this.tempCM1),I.quaternion.copy(e.quaternion),this.prepareBreakableObject(I,x,e.userData.velocity,e.userData.angularVelocity,2*b>this.minSizeForBreak),B++),E>4&&((M=new ee.Kj0(new eA(d),e.material)).position.copy(this.tempCM2),M.quaternion.copy(e.quaternion),this.prepareBreakableObject(M,x,e.userData.velocity,e.userData.angularVelocity,2*C>this.minSizeForBreak),B++),r.object1=I,r.object2=M,B}static transformFreeVector(e,t){let r=e.x,n=e.y,a=e.z,s=t.elements;return e.x=s[0]*r+s[4]*n+s[8]*a,e.y=s[1]*r+s[5]*n+s[9]*a,e.z=s[2]*r+s[6]*n+s[10]*a,e}static transformFreeVectorInverse(e,t){let r=e.x,n=e.y,a=e.z,s=t.elements;return e.x=s[0]*r+s[1]*n+s[2]*a,e.y=s[4]*r+s[5]*n+s[6]*a,e.z=s[8]*r+s[9]*n+s[10]*a,e}static transformTiedVectorInverse(e,t){let r=e.x,n=e.y,a=e.z,s=t.elements;return e.x=s[0]*r+s[1]*n+s[2]*a-s[12],e.y=s[4]*r+s[5]*n+s[6]*a-s[13],e.z=s[8]*r+s[9]*n+s[10]*a-s[14],e}static transformPlaneToLocalSpace(e,t,r){r.normal.copy(e.normal),r.constant=e.constant;let n=eg.transformTiedVectorInverse(e.coplanarPoint(ef),t);eg.transformFreeVectorInverse(r.normal,t),r.constant=-n.dot(r.normal)}}class ev{constructor(e,t,r){this.variables=[],this.currentTextureIndex=0;let n=ee.VzW,a=new ee.xsS,s=new ee.V1s;s.position.z=1;let o={passThruTexture:{value:null}},l=u("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n	vec2 uv = gl_FragCoord.xy / resolution.xy;\n\n	gl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",o),h=new ee.Kj0(new ee._12(2,2),l);function c(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function u(e,t){t=t||{};let r=new ee.jyz({uniforms:t,vertexShader:"void main()	{\n\n	gl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return c(r),r}a.add(h),this.setDataType=function(e){return n=e,this},this.addVariable=function(e,t,r){let n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:ee.TyD,magFilter:ee.TyD};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===r.capabilities.isWebGL2&&!1===r.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let r=0;r<this.variables.length;r++){let n=this.variables[r];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);let a=n.material,s=a.uniforms;if(null!==n.dependencies)for(let e=0;e<n.dependencies.length;e++){let t=n.dependencies[e];if(t.name!==n.name){let e=!1;for(let r=0;r<this.variables.length;r++)if(t.name===this.variables[r].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+n.name+", dependency="+t.name}s[t.name]={value:null},a.fragmentShader="\nuniform sampler2D "+t.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let r=0,n=this.variables.length;r<n;r++){let n=this.variables[r];if(null!==n.dependencies){let t=n.material.uniforms;for(let r=0,a=n.dependencies.length;r<a;r++){let a=n.dependencies[r];t[a.name].value=a.renderTargets[e].texture}}this.doRenderTarget(n.material,n.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){h.geometry.dispose(),h.material.dispose();let e=this.variables;for(let t=0;t<e.length;t++){let r=e[t];r.initialValueTexture&&r.initialValueTexture.dispose();let n=r.renderTargets;for(let e=0;e<n.length;e++)n[e].dispose()}},this.addResolutionDefine=c,this.createShaderMaterial=u,this.createRenderTarget=function(r,a,s,o,l,h){return r=r||e,a=a||t,s=s||ee.uWy,o=o||ee.uWy,l=l||ee.TyD,h=h||ee.TyD,new ee.dd2(r,a,{wrapS:s,wrapT:o,minFilter:l,magFilter:h,format:ee.wk1,type:n,depthBuffer:!1})},this.createTexture=function(){let r=new Float32Array(e*t*4),n=new ee.IEO(r,e,t,ee.wk1,ee.VzW);return n.needsUpdate=!0,n},this.renderTexture=function(e,t){o.passThruTexture.value=e,this.doRenderTarget(l,t),o.passThruTexture.value=null},this.doRenderTarget=function(e,t){let n=r.getRenderTarget(),o=r.xr.enabled,c=r.shadowMap.autoUpdate,u=r.outputColorSpace,d=r.toneMapping;r.xr.enabled=!1,r.shadowMap.autoUpdate=!1,"outputColorSpace"in r?r.outputColorSpace="srgb-linear":r.encoding=3e3,r.toneMapping=ee.uL9,h.material=e,r.setRenderTarget(t),r.render(a,s),h.material=l,r.xr.enabled=o,r.shadowMap.autoUpdate=c,r.outputColorSpace=u,r.toneMapping=d,r.setRenderTarget(n)}}}let ey=new ee.Pa4,ex=new ee._fP,eb=new ee.Pa4,ew=new ee.Pa4,eC=new ee._fP,eE=new ee.Pa4;class eI extends ee.Tme{constructor(){super()}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(ew,eC,eE),this.matrix.decompose(ey,ex,eb),this.matrixWorld.compose(ew,ex,eE)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(let t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)}}class eM extends ee.Kj0{constructor(e,t){super(e,t),this.type="MorphAnimMesh",this.mixer=new ee.Xcj(this),this.activeAction=null}setDirectionForward(){this.mixer.timeScale=1}setDirectionBackward(){this.mixer.timeScale=-1}playAnimation(e,t){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);let r=ee.m7l.findByName(this,e);if(r){let e=this.mixer.clipAction(r);e.timeScale=r.tracks.length*t/r.duration,this.activeAction=e.play()}else throw Error("THREE.MorphAnimMesh: animations["+e+"] undefined in .playAnimation()")}updateAnimation(e){this.mixer.update(e)}copy(e,t){return super.copy(e,t),this.mixer=new ee.Xcj(this),this}}class eB extends ee.u9r{constructor(e,t){super();let r=[],n=[],a=[],s=[1,1,1],o=[1,1,0],l=new ee.Pa4(0,1,0),h=new ee.Pa4,c=new ee.Pa4,u=new ee._fP,d=new ee._fP;d.setFromAxisAngle(l,Math.PI/2);let m=new ee.Pa4,p=new ee.Pa4;p.copy(e.getPointAt(0));let A=[new ee.Pa4(-.225,0,0),new ee.Pa4(0,-.05,0),new ee.Pa4(0,-.175,0),new ee.Pa4(0,-.05,0),new ee.Pa4(.225,0,0),new ee.Pa4(0,-.175,0)],f=2*Math.PI,g=5,v=[];for(let e=0;e<g;e++){let t=e/g*f;v.push(new ee.Pa4(.06*Math.sin(t),.06*Math.cos(t),0))}g=6;let y=[];for(let e=0;e<g;e++){let t=e/g*f;y.push(new ee.Pa4(.025*Math.sin(t),.025*Math.cos(t),0))}let x=new ee.Pa4,b=new ee.Pa4,w=new ee.Pa4,C=new ee.Pa4,E=new ee.Pa4,I=new ee.Pa4,M=new ee.Pa4,B=new ee.Pa4,S=new ee.Pa4,T=new ee.Pa4;function F(e,t,s){for(let o=0,l=e.length;o<l;o++){let h=e[o],c=e[(o+1)%l];w.copy(h).add(t),w.applyQuaternion(u),w.add(m),C.copy(c).add(t),C.applyQuaternion(u),C.add(m),E.copy(c).add(t),E.applyQuaternion(d),E.add(p),I.copy(h).add(t),I.applyQuaternion(d),I.add(p),r.push(w.x,w.y,w.z),r.push(C.x,C.y,C.z),r.push(I.x,I.y,I.z),r.push(C.x,C.y,C.z),r.push(E.x,E.y,E.z),r.push(I.x,I.y,I.z),M.copy(h),M.applyQuaternion(u),M.normalize(),B.copy(c),B.applyQuaternion(u),B.normalize(),S.copy(c),S.applyQuaternion(d),S.normalize(),T.copy(h),T.applyQuaternion(d),T.normalize(),n.push(M.x,M.y,M.z),n.push(B.x,B.y,B.z),n.push(T.x,T.y,T.z),n.push(B.x,B.y,B.z),n.push(S.x,S.y,S.z),n.push(T.x,T.y,T.z),a.push(s[0],s[1],s[2]),a.push(s[0],s[1],s[2]),a.push(s[0],s[1],s[2]),a.push(s[0],s[1],s[2]),a.push(s[0],s[1],s[2]),a.push(s[0],s[1],s[2])}}let P=new ee.Pa4;for(let f=1;f<=t;f++){m.copy(e.getPointAt(f/t)),l.set(0,1,0),h.subVectors(m,p).normalize(),c.crossVectors(l,h).normalize(),l.crossVectors(h,c);let g=Math.atan2(h.x,h.z);u.setFromAxisAngle(l,g),f%2==0&&function(e,t){b.set(0,0,-1).applyQuaternion(u);for(let s=0;s<e.length;s++)x.copy(e[s]),x.applyQuaternion(u),x.add(m),r.push(x.x,x.y,x.z),n.push(b.x,b.y,b.z),a.push(t[0],t[1],t[2]);b.set(0,0,1).applyQuaternion(u);for(let s=e.length-1;s>=0;s--)x.copy(e[s]),x.applyQuaternion(u),x.add(m),r.push(x.x,x.y,x.z),n.push(b.x,b.y,b.z),a.push(t[0],t[1],t[2])}(A,o),F(v,P.set(0,-.125,0),o),F(y,P.set(.2,0,0),s),F(y,P.set(-.2,0,0),s),p.copy(m),d.copy(u)}this.setAttribute("position",new ee.TlE(new Float32Array(r),3)),this.setAttribute("normal",new ee.TlE(new Float32Array(n),3)),this.setAttribute("color",new ee.TlE(new Float32Array(a),3))}}class eS extends ee.u9r{constructor(e,t){super();let r=[],n=[],a=new ee._fP,s=new ee.Pa4(0,1,0),o=new ee.Pa4,l=new ee.Pa4,h=[new ee.Pa4(0,.05,-.05),new ee.Pa4(0,.05,.05),new ee.Pa4(0,-.05,0)],c=[new ee.Pa4(-.05,0,.05),new ee.Pa4(-.05,0,-.05),new ee.Pa4(.05,0,0)],u=[new ee.Pa4(.05,0,-.05),new ee.Pa4(.05,0,.05),new ee.Pa4(-.05,0,0)],d=new ee.Pa4,m=new ee.Pa4,p=new ee.Pa4,A=new ee.Pa4,f=new ee.Pa4,g=new ee.Pa4,v=new ee.Pa4,y=new ee.Pa4;function x(e,t,s){for(let o=0,l=e.length;o<l;o++){let h=e[o],c=e[(o+1)%l];d.copy(h),d.applyQuaternion(a),d.add(t),m.copy(c),m.applyQuaternion(a),m.add(t),p.copy(c),p.applyQuaternion(a),p.add(s),A.copy(h),A.applyQuaternion(a),A.add(s),r.push(d.x,d.y,d.z),r.push(m.x,m.y,m.z),r.push(A.x,A.y,A.z),r.push(m.x,m.y,m.z),r.push(p.x,p.y,p.z),r.push(A.x,A.y,A.z),f.copy(h),f.applyQuaternion(a),f.normalize(),g.copy(c),g.applyQuaternion(a),g.normalize(),v.copy(c),v.applyQuaternion(a),v.normalize(),y.copy(h),y.applyQuaternion(a),y.normalize(),n.push(f.x,f.y,f.z),n.push(g.x,g.y,g.z),n.push(y.x,y.y,y.z),n.push(g.x,g.y,g.z),n.push(v.x,v.y,v.z),n.push(y.x,y.y,y.z)}}let b=new ee.Pa4,w=new ee.Pa4;for(let r=1;r<=t;r++){o.copy(e.getPointAt(r/t)),l.copy(e.getTangentAt(r/t));let n=Math.atan2(l.x,l.z);a.setFromAxisAngle(s,n),o.y>10?(b.set(-.75,-.35,0),b.applyQuaternion(a),b.add(o),w.set(.75,-.35,0),w.applyQuaternion(a),w.add(o),x(h,b,w),b.set(-.7,-.3,0),b.applyQuaternion(a),b.add(o),w.set(-.7,-o.y,0),w.applyQuaternion(a),w.add(o),x(c,b,w),b.set(.7,-.3,0),b.applyQuaternion(a),b.add(o),w.set(.7,-o.y,0)):(b.set(0,-.2,0),b.applyQuaternion(a),b.add(o),w.set(0,-o.y,0)),w.applyQuaternion(a),w.add(o),x(u,b,w)}this.setAttribute("position",new ee.TlE(new Float32Array(r),3)),this.setAttribute("normal",new ee.TlE(new Float32Array(n),3))}}class eT extends ee.u9r{constructor(e,t){super();let r=[],n=new ee.Pa4(0,1,0),a=new ee.Pa4,s=new ee._fP,o=new ee._fP;o.setFromAxisAngle(n,Math.PI/2);let l=new ee.Pa4,h=new ee.Pa4;h.copy(e.getPointAt(0)),h.y=0;let c=new ee.Pa4,u=new ee.Pa4,d=new ee.Pa4,m=new ee.Pa4;for(let p=1;p<=t;p++){l.copy(e.getPointAt(p/t)),l.y=0,a.subVectors(l,h);let A=Math.atan2(a.x,a.z);s.setFromAxisAngle(n,A),c.set(-.3,0,0),c.applyQuaternion(s),c.add(l),u.set(.3,0,0),u.applyQuaternion(s),u.add(l),d.set(.3,0,0),d.applyQuaternion(o),d.add(h),m.set(-.3,0,0),m.applyQuaternion(o),m.add(h),r.push(c.x,c.y,c.z),r.push(u.x,u.y,u.z),r.push(m.x,m.y,m.z),r.push(u.x,u.y,u.z),r.push(d.x,d.y,d.z),r.push(m.x,m.y,m.z),h.copy(l),o.copy(s)}this.setAttribute("position",new ee.TlE(new Float32Array(r),3))}}class eF extends ee.u9r{constructor(){super();let e=[];for(let t=0;t<100;t++){let t=800*Math.random()-400,r=50*Math.random()+50,n=800*Math.random()-400,a=40*Math.random()+20;e.push(t-a,r,n-a),e.push(t+a,r,n-a),e.push(t-a,r,n+a),e.push(t+a,r,n-a),e.push(t+a,r,n+a),e.push(t-a,r,n+a)}this.setAttribute("position",new ee.TlE(new Float32Array(e),3))}}class eP extends ee.u9r{constructor(e){super();let t=[],r=[],n=new ee.iMs;n.ray.direction.set(0,-1,0);let a=new ee.Ilk;for(let s=0;s<2e3;s++){let s=500*Math.random()-250,o=500*Math.random()-250;n.ray.origin.set(s,50,o);let l=n.intersectObject(e);if(0===l.length)continue;let h=l[0].point.y,c=5*Math.random()+.5,u=Math.random()*Math.PI*2;t.push(s+Math.sin(u),h,o+Math.cos(u)),t.push(s,h+c,o),t.push(s+Math.sin(u+Math.PI),h,o+Math.cos(u+Math.PI)),u+=Math.PI/2,t.push(s+Math.sin(u),h,o+Math.cos(u)),t.push(s,h+c,o),t.push(s+Math.sin(u+Math.PI),h,o+Math.cos(u+Math.PI));let d=.1*Math.random();for(let e=0;e<6;e++)a.setRGB(.2+d,.4+d,0,"srgb"),r.push(a.r,a.g,a.b)}this.setAttribute("position",new ee.TlE(new Float32Array(t),3)),this.setAttribute("color",new ee.TlE(new Float32Array(r),3))}}var e_=Object.defineProperty,eD=(e,t,r)=>t in e?e_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,eR=(e,t,r)=>(eD(e,"symbol"!=typeof t?t+"":t,r),r);class eL{constructor(){eR(this,"_previousTime"),eR(this,"_currentTime"),eR(this,"_delta"),eR(this,"_elapsed"),eR(this,"_timescale"),eR(this,"_useFixedDelta"),eR(this,"_fixedDelta"),eR(this,"_usePageVisibilityAPI"),eR(this,"_pageVisibilityHandler"),this._previousTime=0,this._currentTime=0,this._delta=0,this._elapsed=0,this._timescale=1,this._useFixedDelta=!1,this._fixedDelta=16.67,this._usePageVisibilityAPI="undefined"!=typeof document&&void 0!==document.hidden}connect(){return this._usePageVisibilityAPI&&(this._pageVisibilityHandler=eN.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1)),this}dispose(){return this._usePageVisibilityAPI&&this._pageVisibilityHandler&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}disableFixedDelta(){return this._useFixedDelta=!1,this}enableFixedDelta(){return this._useFixedDelta=!0,this}getDelta(){return this._delta/1e3}getElapsedTime(){return this._elapsed/1e3}getFixedDelta(){return this._fixedDelta/1e3}getTimescale(){return this._timescale}reset(){return this._currentTime=this._now(),this}setFixedDelta(e){return this._fixedDelta=1e3*e,this}setTimescale(e){return this._timescale=e,this}update(){return!0===this._useFixedDelta?this._delta=this._fixedDelta:(this._previousTime=this._currentTime,this._currentTime=this._now(),this._delta=this._currentTime-this._previousTime),this._delta*=this._timescale,this._elapsed+=this._delta,this}get elapsedTime(){return this.getElapsedTime()}_now(){return("undefined"==typeof performance?Date:performance).now()}}function eN(){!1===document.hidden&&this.reset()}function ek(){var e;if(void 0!==n)return n;try{let t;let r=document.createElement("canvas");return n=!!(window.WebGLRenderingContext&&(t=r.getContext("webgl"))),t&&(null==(e=t.getExtension("WEBGL_lose_context"))||e.loseContext()),n}catch(e){return n=!1}}function eU(){var e;if(void 0!==a)return a;try{let t;let r=document.createElement("canvas");return a=!!(window.WebGL2RenderingContext&&(t=r.getContext("webgl2"))),t&&(null==(e=t.getExtension("WEBGL_lose_context"))||e.loseContext()),a}catch(e){return a=!1}}function eQ(){return eG(1)}function eO(){return eG(2)}function eG(e){let t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},r=document.createElement("div");r.id="webglmessage",r.style.fontFamily="monospace",r.style.fontSize="13px",r.style.fontWeight="normal",r.style.textAlign="center",r.style.background="#fff",r.style.color="#000",r.style.padding="1.5em",r.style.width="400px",r.style.margin="5em auto 0";let n='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';return n=(n=t[e]?n.replace("$0","graphics card"):n.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),r.innerHTML=n,r}class eH{constructor(){this.scale=1,this.animationFPS=6,this.root=new ee.Tme,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0}loadParts(e){let t=this;function r(e,t){let r=new ee.YBo({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),n=new ee.YBo({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),a=new ee.Kj0(e,n);return a.rotation.y=-Math.PI/2,a.castShadow=!0,a.receiveShadow=!0,a.materialTexture=n,a.materialWireframe=r,a}function n(e,t){let r=new ee.dpR,n=[];for(let s=0;s<t.length;s++)n[s]=r.load(e+t[s],a),n[s].mapping=ee.xfE,n[s].name=t[s],"colorSpace"in n[s]?n[s].colorSpace="srgb":n[s].encoding=3001;return n}function a(){t.loadCounter-=1,0===t.loadCounter&&t.onLoadComplete()}this.loadCounter=2*e.weapons.length+e.skins.length+1;let s=[];for(let t=0;t<e.weapons.length;t++)s[t]=e.weapons[t][1];this.skinsBody=n(e.baseUrl+"skins/",e.skins),this.skinsWeapon=n(e.baseUrl+"skins/",s);let o=new ei;o.load(e.baseUrl+e.body,function(e){let n=new ee.ZzF;n.setFromBufferAttribute(e.attributes.position),t.root.position.y=-t.scale*n.min.y;let s=r(e,t.skinsBody[0]);s.scale.set(t.scale,t.scale,t.scale),t.root.add(s),t.meshBody=s,t.meshBody.clipOffset=0,t.activeAnimationClipName=s.geometry.animations[0].name,t.mixer=new ee.Xcj(s),a()});let l=function(e,n){return function(s){let o=r(s,t.skinsWeapon[e]);o.scale.set(t.scale,t.scale,t.scale),o.visible=!1,o.name=n,t.root.add(o),t.weapons[e]=o,t.meshWeapon=o,a()}};for(let t=0;t<e.weapons.length;t++)o.load(e.baseUrl+e.weapons[t][0],l(t,e.weapons[t][0]))}setPlaybackRate(e){0!==e?this.mixer.timeScale=1/e:this.mixer.timeScale=0}setWireframe(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])}setWeapon(e){for(let e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;let t=this.weapons[e];t&&(t.visible=!0,this.meshWeapon=t,this.syncWeaponAnimation())}setAnimation(e){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);let t=this.mixer.clipAction(e,this.meshBody);t&&(this.meshBody.activeAction=t.play())}this.activeClipName=e,this.syncWeaponAnimation()}syncWeaponAnimation(){let e=this.activeClipName;if(this.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);let t=this.mixer.clipAction(e,this.meshWeapon);t&&(this.meshWeapon.activeAction=t.syncWith(this.meshBody.activeAction).play())}}update(e){this.mixer&&this.mixer.update(e)}}class ez{constructor(e,t,r){let n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();let a=new ee.xEZ(this.canvas);a.minFilter=ee.wem,a.wrapS=a.wrapT=ee.uWy,"colorSpace"in a?a.colorSpace="srgb":a.encoding=3001;let s=new ee.vBJ({map:a,side:ee.ehD,transparent:!0});this.mesh=new ee.Kj0(this.geometry,s),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()}repaint(){this.geometryNeedsUpdate&&this.updateGeometry();let e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,a=this.canvasBuffer,s=this.ctxBuffer,o=s.getImageData(0,0,e,t),l=o.data,h=n.data,c=n.upperThreshold,u=n.lowerThreshold,d=n.windowLow,m=n.windowHigh,p=0;if("label"===n.dataType)for(let n=0;n<t;n++)for(let t=0;t<e;t++){let e=h[r(t,n)];e=e>=this.colorMap.length?e%this.colorMap.length+1:e;let a=this.colorMap[e];l[4*p]=a>>24&255,l[4*p+1]=a>>16&255,l[4*p+2]=a>>8&255,l[4*p+3]=255&a,p++}else for(let n=0;n<t;n++)for(let t=0;t<e;t++){let e=h[r(t,n)],a=255;a=c>=e&&u<=e?a:0,e=(e=Math.floor(255*(e-d)/(m-d)))>255?255:e<0?0:0|e,l[4*p]=e,l[4*p+1]=e,l[4*p+2]=e,l[4*p+3]=a,p++}s.putImageData(o,0,0),this.ctx.drawImage(a,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0}updateGeometry(){let e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new ee._12(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}}function eV(){let e=1e6*3,t=new ee.TlE(new Float32Array(e),3);t.usage=ee.dj0;let r=new ee.TlE(new Float32Array(e),3);r.usage=ee.dj0;let n=new ee.TlE(new Float32Array(e),3);n.usage=ee.dj0;let a=new ee.u9r;a.setAttribute("position",t),a.setAttribute("normal",r),a.setAttribute("color",n),a.drawRange.count=0;let s=new ee.Wid({vertexColors:!0}),o=new ee.Kj0(a,s);o.frustumCulled=!1;let l=new ee.Pa4,h=new ee.Pa4,c=new ee.Pa4,u=new ee.Pa4,d=new ee.Ilk(16777215),m=1,p=new ee.Pa4(0,1,0),A=new ee.Pa4,f=new ee.Pa4,g=new ee.yGw,v=new ee.yGw,y=0;return{mesh:o,moveTo:function(e){A.copy(e),g.lookAt(f,A,p),f.copy(e),v.copy(g)},lineTo:function(e){A.copy(e),g.lookAt(f,A,p),function(e,s,o,p){if(0===e.distanceToSquared(s))return;let A=a.drawRange.count,f=function(e){let t=2*Math.PI,r=[],n=.01*e;for(let e=0;e<10;e++){let a=e/10*t;r.push(new ee.Pa4(Math.sin(a)*n,Math.cos(a)*n,0))}return r}(m);for(let a=0,m=f.length;a<m;a++){let g=f[a],v=f[(a+1)%m];l.copy(g).applyMatrix4(p).add(s),h.copy(v).applyMatrix4(p).add(s),c.copy(v).applyMatrix4(o).add(e),u.copy(g).applyMatrix4(o).add(e),l.toArray(t.array,(A+0)*3),h.toArray(t.array,(A+1)*3),u.toArray(t.array,(A+2)*3),h.toArray(t.array,(A+3)*3),c.toArray(t.array,(A+4)*3),u.toArray(t.array,(A+5)*3),l.copy(g).applyMatrix4(p).normalize(),h.copy(v).applyMatrix4(p).normalize(),c.copy(v).applyMatrix4(o).normalize(),u.copy(g).applyMatrix4(o).normalize(),l.toArray(r.array,(A+0)*3),h.toArray(r.array,(A+1)*3),u.toArray(r.array,(A+2)*3),h.toArray(r.array,(A+3)*3),c.toArray(r.array,(A+4)*3),u.toArray(r.array,(A+5)*3),d.toArray(n.array,(A+0)*3),d.toArray(n.array,(A+1)*3),d.toArray(n.array,(A+2)*3),d.toArray(n.array,(A+3)*3),d.toArray(n.array,(A+4)*3),d.toArray(n.array,(A+5)*3),A+=6}a.drawRange.count=A}(A,f,g,v),f.copy(A),v.copy(g)},setSize:function(e){m=e},update:function(){let e=y,s=a.drawRange.count;e!==s&&(t.updateRange.offset=3*e,t.updateRange.count=(s-e)*3,t.needsUpdate=!0,r.updateRange.offset=3*e,r.updateRange.count=(s-e)*3,r.needsUpdate=!0,n.updateRange.offset=3*e,n.updateRange.count=(s-e)*3,n.needsUpdate=!0,y=a.drawRange.count)}}}class ej{constructor(e,t,r,n,a){if(void 0!==e){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,this.axisOrder=["x","y","z"],n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":default:this.data=new Uint8Array(a);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(a);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(a);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(a);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(a);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(a);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw Error("Error in Volume constructor : this type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(a);break;case"Float64":case"float64":case"double":this.data=new Float64Array(a)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw Error("Error in Volume constructor, lengths are not matching arrayBuffer size")}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new ee.Vkp,this.matrix.identity();let s=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return s},set:function(e){s=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}});let o=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}}),this.sliceList=[],this.segmentation=!1}getData(e,t,r){return this.data[r*this.xLength*this.yLength+t*this.xLength+e]}access(e,t,r){return r*this.xLength*this.yLength+t*this.xLength+e}reverseAccess(e){let t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]}map(e,t){let r=this.data.length;t=t||this;for(let n=0;n<r;n++)this.data[n]=e.call(t,this.data[n],n,this.data);return this}extractPerpendicularPlane(e,t){let r,n,a,s,o,l;let h=new ee.Pa4,c=new ee.Pa4,u=new ee.Pa4,d=new ee.yGw().identity(),m=this,p=new ee.Pa4(this.xLength,this.yLength,this.zLength);switch(e){case"x":h.set(1,0,0),c.set(0,0,-1),u.set(0,-1,0),r=this.spacing[this.axisOrder.indexOf("z")],n=this.spacing[this.axisOrder.indexOf("y")],s=new ee.Pa4(t,0,0),d.multiply(new ee.yGw().makeRotationY(Math.PI/2)),a=(m.RASDimensions[0]-1)/2,d.setPosition(new ee.Pa4(t-a,0,0));break;case"y":h.set(0,1,0),c.set(1,0,0),u.set(0,0,1),r=this.spacing[this.axisOrder.indexOf("x")],n=this.spacing[this.axisOrder.indexOf("z")],s=new ee.Pa4(0,t,0),d.multiply(new ee.yGw().makeRotationX(-Math.PI/2)),a=(m.RASDimensions[1]-1)/2,d.setPosition(new ee.Pa4(0,t-a,0));break;default:h.set(0,0,1),c.set(1,0,0),u.set(0,-1,0),r=this.spacing[this.axisOrder.indexOf("x")],n=this.spacing[this.axisOrder.indexOf("y")],s=new ee.Pa4(0,0,t),a=(m.RASDimensions[2]-1)/2,d.setPosition(new ee.Pa4(0,0,t-a))}this.segmentation||(c.applyMatrix4(m.inverseMatrix).normalize(),u.applyMatrix4(m.inverseMatrix).normalize(),h.applyMatrix4(m.inverseMatrix).normalize()),c.arglet="i",u.arglet="j",o=Math.floor(Math.abs(c.dot(p))),l=Math.floor(Math.abs(u.dot(p)));let A=Math.abs(o*r),f=Math.abs(l*n);s=Math.abs(Math.round(s.applyMatrix4(m.inverseMatrix).dot(h)));let g=[new ee.Pa4(1,0,0),new ee.Pa4(0,1,0),new ee.Pa4(0,0,1)],v=[c,u,h].find(function(e){return Math.abs(e.dot(g[0]))>.9}),y=[c,u,h].find(function(e){return Math.abs(e.dot(g[1]))>.9}),x=[c,u,h].find(function(e){return Math.abs(e.dot(g[2]))>.9});return{iLength:o,jLength:l,sliceAccess:function(e,t){let r=v===h?s:"i"===v.arglet?e:t,n=y===h?s:"i"===y.arglet?e:t,a=x===h?s:"i"===x.arglet?e:t,o=v.dot(g[0])>0?r:m.xLength-1-r,l=y.dot(g[1])>0?n:m.yLength-1-n,c=x.dot(g[2])>0?a:m.zLength-1-a;return m.access(o,l,c)},matrix:d,planeWidth:A,planeHeight:f}}extractSlice(e,t){let r=new ez(this,t,e);return this.sliceList.push(r),r}repaintAllSlices(){return this.sliceList.forEach(function(e){e.repaint()}),this}computeMinMax(){let e=1/0,t=-1/0,r=this.data.length,n=0;for(n=0;n<r;n++)if(!isNaN(this.data[n])){let r=this.data[n];e=Math.min(e,r),t=Math.max(t,r)}return this.min=e,this.max=t,[e,t]}}var eW=r(96394);class eX{constructor(e,t=1024){this.renderer=e,this.res=t,this.lightMapContainers=[],this.compiled=!1,this.scene=new ee.xsS,this.scene.background=null,this.tinyTarget=new ee.dd2(1,1),this.buffer1Active=!1,this.firstUpdate=!0,this.warned=!1;let r=/(Android|iPad|iPhone|iPod)/g.test(navigator.userAgent)?alfFloatType:ee.VzW;this.progressiveLightMap1=new ee.dd2(this.res,this.res,{type:r}),this.progressiveLightMap2=new ee.dd2(this.res,this.res,{type:r}),this.uvMat=new ee.xoR,this.uvMat.uniforms={},this.uvMat.onBeforeCompile=e=>{e.vertexShader="#define USE_LIGHTMAP\n"+e.vertexShader.slice(0,-1)+`	gl_Position = vec4((${eW.i} - 0.5) * 2.0, 1.0, 1.0); }`;let t=e.fragmentShader.indexOf("void main() {");e.fragmentShader=`varying vec2 v${"uv1"===eW.i?eW.i:"Uv2"};
`+e.fragmentShader.slice(0,t)+"	uniform sampler2D previousShadowMap;\n	uniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, v${"uv1"===eW.i?eW.i:"Uv2"}).rgb;
				gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/averagingWindow);
			}`,e.uniforms.previousShadowMap={value:this.progressiveLightMap1.texture},e.uniforms.averagingWindow={value:100},this.uvMat.uniforms=e.uniforms,this.uvMat.userData.shader=e,this.compiled=!0}}addObjectsToLightMap(e){this.uv_boxes=[];let t=3/this.res;for(let r=0;r<e.length;r++){let n=e[r];if(n.isLight){this.scene.attach(n);continue}if(!n.geometry.hasAttribute("uv")){console.warn("All lightmap objects need UVs!");continue}null==this.blurringPlane&&this._initializeBlurPlane(this.res,this.progressiveLightMap1),n.material.lightMap=this.progressiveLightMap2.texture,n.material.dithering=!0,n.castShadow=!0,n.receiveShadow=!0,n.renderOrder=1e3+r,this.uv_boxes.push({w:1+2*t,h:1+2*t,index:r}),this.lightMapContainers.push({basicMat:n.material,object:n}),this.compiled=!1}let r=function(e){let t=0,r=0;for(let n of e)t+=n.w*n.h,r=Math.max(r,n.w);e.sort((e,t)=>t.h-e.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],a=0,s=0;for(let t of e)for(let e=n.length-1;e>=0;e--){let r=n[e];if(!(t.w>r.w)&&!(t.h>r.h)){if(t.x=r.x,t.y=r.y,s=Math.max(s,t.y+t.h),a=Math.max(a,t.x+t.w),t.w===r.w&&t.h===r.h){let t=n.pop();e<n.length&&(n[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):(t.w===r.w||n.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:a,h:s,fill:t/(a*s)||0}}(this.uv_boxes);this.uv_boxes.forEach(n=>{let a=e[n.index].geometry.getAttribute("uv").clone();for(let e=0;e<a.array.length;e+=a.itemSize)a.array[e]=(a.array[e]+n.x+t)/r.w,a.array[e+1]=(a.array[e+1]+n.y+t)/r.h;e[n.index].geometry.setAttribute(eW.i,a),e[n.index].geometry.getAttribute(eW.i).needsUpdate=!0})}update(e,t=100,r=!0){if(null==this.blurringPlane)return;let n=this.renderer.getRenderTarget();this.blurringPlane.visible=r;for(let e=0;e<this.lightMapContainers.length;e++)this.lightMapContainers[e].object.oldScene=this.lightMapContainers[e].object.parent,this.scene.attach(this.lightMapContainers[e].object);this.firstUpdate&&(this.renderer.setRenderTarget(this.tinyTarget),this.renderer.render(this.scene,e),this.firstUpdate=!1);for(let e=0;e<this.lightMapContainers.length;e++)this.uvMat.uniforms.averagingWindow={value:t},this.lightMapContainers[e].object.material=this.uvMat,this.lightMapContainers[e].object.oldFrustumCulled=this.lightMapContainers[e].object.frustumCulled,this.lightMapContainers[e].object.frustumCulled=!1;let a=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,s=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1;this.renderer.setRenderTarget(a),this.uvMat.uniforms.previousShadowMap={value:s.texture},this.blurringPlane.material.uniforms.previousShadowMap={value:s.texture},this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e);for(let e=0;e<this.lightMapContainers.length;e++)this.lightMapContainers[e].object.frustumCulled=this.lightMapContainers[e].object.oldFrustumCulled,this.lightMapContainers[e].object.material=this.lightMapContainers[e].basicMat,this.lightMapContainers[e].object.oldScene.attach(this.lightMapContainers[e].object);this.renderer.setRenderTarget(n)}showDebugLightmap(e,t){if(0==this.lightMapContainers.length){this.warned||(console.warn("Call this after adding the objects!"),this.warned=!0);return}null==this.labelMesh&&(this.labelMaterial=new ee.vBJ({map:this.progressiveLightMap1.texture,side:ee.ehD}),this.labelPlane=new ee._12(100,100),this.labelMesh=new ee.Kj0(this.labelPlane,this.labelMaterial),this.labelMesh.position.y=250,this.lightMapContainers[0].object.parent.add(this.labelMesh)),void 0!=t&&this.labelMesh.position.copy(t),this.labelMesh.visible=e}_initializeBlurPlane(e,t=null){let r=new ee.vBJ;r.uniforms={previousShadowMap:{value:null},pixelOffset:{value:1/e},polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:3},r.onBeforeCompile=n=>{n.vertexShader="#define USE_UV\n"+n.vertexShader.slice(0,-1)+"	gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";let a=n.fragmentShader.indexOf("void main() {");n.fragmentShader="#define USE_UV\n"+n.fragmentShader.slice(0,a)+"	uniform sampler2D previousShadowMap;\n	uniform float pixelOffset;\n"+n.fragmentShader.slice(a-1,-1)+`	gl_FragColor.rgb = (
			  texture2D(previousShadowMap, vUv + vec2( pixelOffset,  0.0        )).rgb +
			  texture2D(previousShadowMap, vUv + vec2( 0.0        ,  pixelOffset)).rgb +
			  texture2D(previousShadowMap, vUv + vec2( 0.0        , -pixelOffset)).rgb +
			  texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  0.0        )).rgb +
			  texture2D(previousShadowMap, vUv + vec2( pixelOffset,  pixelOffset)).rgb +
			  texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  pixelOffset)).rgb +
			  texture2D(previousShadowMap, vUv + vec2( pixelOffset, -pixelOffset)).rgb +
			  texture2D(previousShadowMap, vUv + vec2(-pixelOffset, -pixelOffset)).rgb)/8.0;
		}`,n.uniforms.previousShadowMap={value:t.texture},n.uniforms.pixelOffset={value:.5/e},r.uniforms=n.uniforms,r.userData.shader=n,this.compiled=!0},this.blurringPlane=new ee.Kj0(new ee._12(1,1),r),this.blurringPlane.name="Blurring Plane",this.blurringPlane.frustumCulled=!1,this.blurringPlane.renderOrder=0,this.blurringPlane.material.depthWrite=!1,this.scene.add(this.blurringPlane)}}class eY extends ee.Tme{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new ee.FM8(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}let eK=new ee.Pa4,eJ=new ee.yGw,eq=new ee.yGw,eZ=new ee.Pa4,e$=new ee.Pa4;class e0{constructor(e={}){let t,r,n,a;let s=this,o={objects:new WeakMap},l=void 0!==e.element?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:t,height:r}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),eJ.copy(t.matrixWorldInverse),eq.multiplyMatrices(t.projectionMatrix,eJ),function e(t,r,h){if(t.isCSS2DObject){eK.setFromMatrixPosition(t.matrixWorld),eK.applyMatrix4(eq);let e=!0===t.visible&&eK.z>=-1&&eK.z<=1&&!0===t.layers.test(h.layers);if(t.element.style.display=!0===e?"":"none",!0===e){t.onBeforeRender(s,r,h);let e=t.element;e.style.transform="translate("+-100*t.center.x+"%,"+-100*t.center.y+"%)translate("+(eK.x*n+n)+"px,"+(-eK.y*a+a)+"px)",e.parentNode!==l&&l.appendChild(e),t.onAfterRender(s,r,h)}let c={distanceToCameraSquared:(eZ.setFromMatrixPosition(h.matrixWorld),e$.setFromMatrixPosition(t.matrixWorld),eZ.distanceToSquared(e$))};o.objects.set(t,c)}for(let n=0,a=t.children.length;n<a;n++)e(t.children[n],r,h)}(e,e,t),function(e){let t=(function(e){let t=[];return e.traverse(function(e){e.isCSS2DObject&&t.push(e)}),t})(e).sort(function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),r=t.length;for(let e=0,n=t.length;e<n;e++)t[e].element.style.zIndex=r-e}(e)},this.setSize=function(e,s){t=e,r=s,n=t/2,a=r/2,l.style.width=e+"px",l.style.height=s+"px"}}}let e1=new ee.Pa4,e2=new ee._fP,e3=new ee.Pa4;class e4 extends ee.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}class e5 extends e4{constructor(e){super(e),this.isCSS3DSprite=!0,this.rotation2D=0}copy(e,t){return super.copy(e,t),this.rotation2D=e.rotation2D,this}}let e8=new ee.yGw,e6=new ee.yGw;class e9{constructor(e={}){let t,r,n,a;let s=this,o={camera:{style:""},objects:new WeakMap},l=void 0!==e.element?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l;let h=document.createElement("div");h.style.transformOrigin="0 0",h.style.pointerEvents="none",l.appendChild(h);let c=document.createElement("div");function u(e){return 1e-10>Math.abs(e)?0:e}function d(e){let t=e.elements;return"matrix3d("+u(t[0])+","+u(-t[1])+","+u(t[2])+","+u(t[3])+","+u(t[4])+","+u(-t[5])+","+u(t[6])+","+u(t[7])+","+u(t[8])+","+u(-t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(-t[13])+","+u(t[14])+","+u(t[15])+")"}function m(e){let t=e.elements;return"translate(-50%,-50%)"+("matrix3d("+u(t[0])+","+u(t[1])+","+u(t[2])+","+u(t[3])+","+u(-t[4])+","+u(-t[5])+","+u(-t[6])+","+u(-t[7])+","+u(t[8])+","+u(t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(t[13])+","+u(t[14])+",")+u(t[15])+")"}c.style.transformStyle="preserve-3d",h.appendChild(c),this.getSize=function(){return{width:t,height:r}},this.render=function(e,l){let p,A;let f=l.projectionMatrix.elements[5]*a;l.view&&l.view.enabled?(h.style.transform=`translate( ${-l.view.offsetX*(t/l.view.width)}px, ${-l.view.offsetY*(r/l.view.height)}px )`,h.style.transform+=`scale( ${l.view.fullWidth/l.view.width}, ${l.view.fullHeight/l.view.height} )`):h.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===l.parent&&!0===l.matrixWorldAutoUpdate&&l.updateMatrixWorld(),l.isOrthographicCamera&&(p=-(l.right+l.left)/2,A=(l.top+l.bottom)/2);let g=l.view&&l.view.enabled?l.view.height/l.view.fullHeight:1,v=l.isOrthographicCamera?`scale( ${g} )scale(`+f+")translate("+u(p)+"px,"+u(A)+"px)"+d(l.matrixWorldInverse):`scale( ${g} )translateZ(`+f+"px)"+d(l.matrixWorldInverse),y=(l.isPerspectiveCamera?"perspective("+f+"px) ":"")+v+"translate("+n+"px,"+a+"px)";o.camera.style!==y&&(c.style.transform=y,o.camera.style=y),function e(t,r,n,a){if(t.isCSS3DObject){let e=!0===t.visible&&!0===t.layers.test(n.layers);if(t.element.style.display=!0===e?"":"none",!0===e){let e;t.onBeforeRender(s,r,n),t.isCSS3DSprite?(e8.copy(n.matrixWorldInverse),e8.transpose(),0!==t.rotation2D&&e8.multiply(e6.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(e1,e2,e3),e8.setPosition(e1),e8.scale(e3),e8.elements[3]=0,e8.elements[7]=0,e8.elements[11]=0,e8.elements[15]=1,e=m(e8)):e=m(t.matrixWorld);let a=t.element,l=o.objects.get(t);if(void 0===l||l.style!==e){a.style.transform=e;let r={style:e};o.objects.set(t,r)}a.parentNode!==c&&c.appendChild(a),t.onAfterRender(s,r,n)}}for(let a=0,s=t.children.length;a<s;a++)e(t.children[a],r,n)}(e,e,l)},this.setSize=function(e,s){t=e,r=s,n=t/2,a=r/2,l.style.width=e+"px",l.style.height=s+"px",h.style.width=e+"px",h.style.height=s+"px",c.style.width=e+"px",c.style.height=s+"px"}}}class e7{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class te{constructor(){this.id=0,this.v1=new tt,this.v2=new tt,this.v3=new tt,this.normalModel=new ee.Pa4,this.vertexNormalsModel=[new ee.Pa4,new ee.Pa4,new ee.Pa4],this.vertexNormalsLength=0,this.color=new ee.Ilk,this.material=null,this.uvs=[new ee.FM8,new ee.FM8,new ee.FM8],this.z=0,this.renderOrder=0}}class tt{constructor(){this.position=new ee.Pa4,this.positionWorld=new ee.Pa4,this.positionScreen=new ee.Ltg,this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class ti{constructor(){this.id=0,this.v1=new tt,this.v2=new tt,this.vertexColors=[new ee.Ilk,new ee.Ilk],this.material=null,this.z=0,this.renderOrder=0}}class tr{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new ee.FM8,this.material=null,this.renderOrder=0}}class tn{constructor(){let e,t,r=0,n,a,s=0,o,l,h=0,c,u,d=0,m,p,A=0,f,g={objects:[],lights:[],elements:[]},v=new ee.Pa4,y=new ee.Ltg,x=new ee.ZzF(new ee.Pa4(-1,-1,-1),new ee.Pa4(1,1,1)),b=new ee.ZzF,w=[,,,],C=new ee.yGw,E=new ee.yGw,I=new ee.yGw,M=new ee.iWj,B=[],S=[],T=[],F=[],P=[],_=new function(){let e=[],t=[],r=[],m=null,p=new ee.Vkp;function A(e){let t=e.position,r=e.positionWorld,n=e.positionScreen;r.copy(t).applyMatrix4(f),n.copy(r).applyMatrix4(E);let a=1/n.w;n.x*=a,n.y*=a,n.z*=a,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1}function C(e,t,r){return!0===e.visible||!0===t.visible||!0===r.visible||(w[0]=e.positionScreen,w[1]=t.positionScreen,w[2]=r.positionScreen,x.intersectsBox(b.setFromPoints(w)))}function M(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(n){m=n,p.getNormalMatrix(m.matrixWorld),e.length=0,t.length=0,r.length=0},projectVertex:A,checkTriangleVisibility:C,checkBackfaceCulling:M,pushVertex:function(e,t,r){(n=function(){if(a===s){let e=new tt;return S.push(e),s++,a++,e}return S[a++]}()).position.set(e,t,r),A(n)},pushNormal:function(t,r,n){e.push(t,r,n)},pushColor:function(e,r,n){t.push(e,r,n)},pushUv:function(e,t){r.push(e,t)},pushLine:function(e,r){let n=S[e],a=S[r];n.positionScreen.copy(n.position).applyMatrix4(I),a.positionScreen.copy(a.position).applyMatrix4(I),!0===function(e,t){let r=0,n=1,a=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,l=-t.z+t.w;return a>=0&&s>=0&&o>=0&&l>=0||(!(a<0)||!(s<0))&&(!(o<0)||!(l<0))&&(a<0?r=Math.max(r,a/(a-s)):s<0&&(n=Math.min(n,a/(a-s))),o<0?r=Math.max(r,o/(o-l)):l<0&&(n=Math.min(n,o/(o-l))),!(n<r)&&(e.lerp(t,r),t.lerp(e,1-n),!0))}(n.positionScreen,a.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),a.positionScreen.multiplyScalar(1/a.positionScreen.w),(c=function(){if(u===d){let e=new ti;return F.push(e),d++,u++,e}return F[u++]}()).id=m.id,c.v1.copy(n),c.v2.copy(a),c.z=Math.max(n.positionScreen.z,a.positionScreen.z),c.renderOrder=m.renderOrder,c.material=m.material,m.material.vertexColors&&(c.vertexColors[0].fromArray(t,3*e),c.vertexColors[1].fromArray(t,3*r)),g.elements.push(c))},pushTriangle:function(n,a,s,c){let u=S[n],d=S[a],A=S[s];if(!1!==C(u,d,A)&&(c.side===ee.ehD||!0===M(u,d,A))){(o=function(){if(l===h){let e=new te;return T.push(e),h++,l++,e}return T[l++]}()).id=m.id,o.v1.copy(u),o.v2.copy(d),o.v3.copy(A),o.z=(u.positionScreen.z+d.positionScreen.z+A.positionScreen.z)/3,o.renderOrder=m.renderOrder,v.subVectors(A.position,d.position),y.subVectors(u.position,d.position),v.cross(y),o.normalModel.copy(v),o.normalModel.applyMatrix3(p).normalize();for(let t=0;t<3;t++){let n=o.vertexNormalsModel[t];n.fromArray(e,3*arguments[t]),n.applyMatrix3(p).normalize(),o.uvs[t].fromArray(r,2*arguments[t])}o.vertexNormalsLength=3,o.material=c,c.vertexColors&&o.color.fromArray(t,3*n),g.elements.push(o)}}}};function D(n){(e=function(){if(t===r){let e=new e7;return B.push(e),r++,t++,e}return B[t++]}()).id=n.id,e.object=n,v.setFromMatrixPosition(n.matrixWorld),v.applyMatrix4(E),e.z=v.z,e.renderOrder=n.renderOrder,g.objects.push(e)}function R(e,t,r){let n=1/e.w;e.z*=n,e.z>=-1&&e.z<=1&&((m=function(){if(p===A){let e=new tr;return P.push(e),A++,p++,e}return P[p++]}()).id=t.id,m.x=e.x*n,m.y=e.y*n,m.z=e.z,m.renderOrder=t.renderOrder,m.object=t,m.rotation=t.rotation,m.scale.x=t.scale.x*Math.abs(m.x-(e.x+r.projectionMatrix.elements[0])/(e.w+r.projectionMatrix.elements[12])),m.scale.y=t.scale.y*Math.abs(m.y-(e.y+r.projectionMatrix.elements[5])/(e.w+r.projectionMatrix.elements[13])),m.material=t.material,g.elements.push(m))}function L(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,r,n,s){l=0,u=0,p=0,g.elements.length=0,!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===r.parent&&!0===r.matrixWorldAutoUpdate&&r.updateMatrixWorld(),C.copy(r.matrixWorldInverse),E.multiplyMatrices(r.projectionMatrix,C),M.setFromProjectionMatrix(E),t=0,g.objects.length=0,g.lights.length=0,function e(t){if(!1===t.visible)return;if(t.isLight)g.lights.push(t);else if(t.isMesh||t.isLine||t.isPoints){if(!1===t.material.visible||!0===t.frustumCulled&&!1===M.intersectsObject(t))return;D(t)}else if(t.isSprite){if(!1===t.material.visible||!0===t.frustumCulled&&!1===M.intersectsSprite(t))return;D(t)}let r=t.children;for(let t=0,n=r.length;t<n;t++)e(r[t])}(e),!0===n&&g.objects.sort(L);let o=g.objects;for(let e=0,t=o.length;e<t;e++){let t=o[e].object,n=t.geometry;if(_.setObject(t),f=t.matrixWorld,a=0,t.isMesh){let e=t.material,r=Array.isArray(e),a=n.attributes,s=n.groups;if(void 0===a.position)continue;let o=a.position.array;for(let e=0,r=o.length;e<r;e+=3){let r=o[e],a=o[e+1],s=o[e+2],l=n.morphAttributes.position;if(void 0!==l){let h=n.morphTargetsRelative,c=t.morphTargetInfluences;for(let t=0,n=l.length;t<n;t++){let n=c[t];if(0===n)continue;let u=l[t];h?(r+=u.getX(e/3)*n,a+=u.getY(e/3)*n,s+=u.getZ(e/3)*n):(r+=(u.getX(e/3)-o[e])*n,a+=(u.getY(e/3)-o[e+1])*n,s+=(u.getZ(e/3)-o[e+2])*n)}}_.pushVertex(r,a,s)}if(void 0!==a.normal){let e=a.normal.array;for(let t=0,r=e.length;t<r;t+=3)_.pushNormal(e[t],e[t+1],e[t+2])}if(void 0!==a.color){let e=a.color.array;for(let t=0,r=e.length;t<r;t+=3)_.pushColor(e[t],e[t+1],e[t+2])}if(void 0!==a.uv){let e=a.uv.array;for(let t=0,r=e.length;t<r;t+=2)_.pushUv(e[t],e[t+1])}if(null!==n.index){let a=n.index.array;if(s.length>0)for(let n=0;n<s.length;n++){let o=s[n];if(void 0!==(e=!0===r?t.material[o.materialIndex]:t.material))for(let t=o.start,r=o.start+o.count;t<r;t+=3)_.pushTriangle(a[t],a[t+1],a[t+2],e)}else for(let t=0,r=a.length;t<r;t+=3)_.pushTriangle(a[t],a[t+1],a[t+2],e)}else if(s.length>0)for(let n=0;n<s.length;n++){let a=s[n];if(void 0!==(e=!0===r?t.material[a.materialIndex]:t.material))for(let t=a.start,r=a.start+a.count;t<r;t+=3)_.pushTriangle(t,t+1,t+2,e)}else for(let t=0,r=o.length/3;t<r;t+=3)_.pushTriangle(t,t+1,t+2,e)}else if(t.isLine){I.multiplyMatrices(E,f);let e=n.attributes;if(void 0!==e.position){let r=e.position.array;for(let e=0,t=r.length;e<t;e+=3)_.pushVertex(r[e],r[e+1],r[e+2]);if(void 0!==e.color){let t=e.color.array;for(let e=0,r=t.length;e<r;e+=3)_.pushColor(t[e],t[e+1],t[e+2])}if(null!==n.index){let e=n.index.array;for(let t=0,r=e.length;t<r;t+=2)_.pushLine(e[t],e[t+1])}else{let e=t.isLineSegments?2:1;for(let t=0,n=r.length/3-1;t<n;t+=e)_.pushLine(t,t+1)}}}else if(t.isPoints){I.multiplyMatrices(E,f);let e=n.attributes;if(void 0!==e.position){let n=e.position.array;for(let e=0,a=n.length;e<a;e+=3)y.set(n[e],n[e+1],n[e+2],1),y.applyMatrix4(I),R(y,t,r)}}else t.isSprite&&(t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),y.set(f.elements[12],f.elements[13],f.elements[14],1),y.applyMatrix4(E),R(y,t,r))}return!0===s&&g.elements.sort(L),g}}}class ta extends ee.Tme{constructor(e){super(),this.isSVGObject=!0,this.node=e}}class ts{constructor(){let e,t,r,n,a,s,o,l,h,c,u,d=0,m=null,p=1,A,f,g=this,v=new ee.TUj,y=new ee.TUj,x=new ee.Ilk,b=new ee.Ilk,w=new ee.Ilk,C=new ee.Ilk,E=new ee.Ilk,I=new ee.Ilk,M=new ee.Pa4,B=new ee.Pa4,S=new ee.Pa4,T=new ee.Vkp,F=new ee.yGw,P=new ee.yGw,_=[],D=new tn,R=document.createElementNS("http://www.w3.org/2000/svg","svg");function L(){for(d=0;R.childNodes.length>0;)R.removeChild(R.childNodes[0])}function N(e){return null!==m?e.toFixed(m):e}function k(e,t,r){let n=t.x-e.x,a=t.y-e.y,s=n*n+a*a;if(0===s)return;let o=r/Math.sqrt(s);n*=o,a*=o,t.x+=n,t.y+=a,e.x-=n,e.y-=a}function U(e,t){f===e?A+=t:(Q(),f=e,A=t)}function Q(){var e;A&&((null==_[e=d++]&&(_[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==p&&_[e].setAttribute("shape-rendering","crispEdges")),u=_[e]).setAttribute("d",A),u.setAttribute("style",f),R.appendChild(u)),A="",f=""}this.domElement=R,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":p=1;break;case"low":p=0}},this.setClearColor=function(e){I.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){n=e,a=t,s=n/2,o=a/2,R.setAttribute("viewBox",-s+" "+-o+" "+n+" "+a),R.setAttribute("width",n),R.setAttribute("height",a),v.min.set(-s,-o),v.max.set(s,o)},this.getSize=function(){return{width:n,height:a}},this.setPrecision=function(e){m=e},this.clear=function(){L(),R.style.backgroundColor=I.getStyle()},this.render=function(n,a){if(a instanceof ee.V1s==!1){console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");return}let u=n.background;u&&u.isColor?(L(),R.style.backgroundColor=u.getStyle()):!0===this.autoClear&&this.clear(),g.info.render.vertices=0,g.info.render.faces=0,F.copy(a.matrixWorldInverse),P.multiplyMatrices(a.projectionMatrix,F),t=(e=D.projectScene(n,a,this.sortObjects,this.sortElements)).elements,r=e.lights,T.getNormalMatrix(a.matrixWorldInverse),function(e){w.setRGB(0,0,0),C.setRGB(0,0,0),E.setRGB(0,0,0);for(let t=0,r=e.length;t<r;t++){let r=e[t],n=r.color;r.isAmbientLight?(w.r+=n.r,w.g+=n.g,w.b+=n.b):r.isDirectionalLight?(C.r+=n.r,C.g+=n.g,C.b+=n.b):r.isPointLight&&(E.r+=n.r,E.g+=n.g,E.b+=n.b)}}(r),A="",f="";for(let e=0,n=t.length;e<n;e++){let n=t[e],a=n.material;if(void 0!==a&&0!==a.opacity){if(y.makeEmpty(),n instanceof tr)l=n,l.x*=s,l.y*=-o,function(e,t,r){let n=t.scale.x*s,a=t.scale.y*o;r.isPointsMaterial&&(n*=r.size,a*=r.size);let l="M"+N(e.x-.5*n)+","+N(e.y-.5*a)+"h"+N(n)+"v"+N(a)+"h"+N(-n)+"z",h="";(r.isSpriteMaterial||r.isPointsMaterial)&&(h="fill:"+r.color.getStyle()+";fill-opacity:"+r.opacity),U(h,l)}(l,n,a);else if(n instanceof ti)l=n.v1,h=n.v2,l.positionScreen.x*=s,l.positionScreen.y*=-o,h.positionScreen.x*=s,h.positionScreen.y*=-o,y.setFromPoints([l.positionScreen,h.positionScreen]),!0===v.intersectsBox(y)&&function(e,t,r){let n="M"+N(e.positionScreen.x)+","+N(e.positionScreen.y)+"L"+N(t.positionScreen.x)+","+N(t.positionScreen.y);if(r.isLineBasicMaterial){let e="fill:none;stroke:"+r.color.getStyle()+";stroke-opacity:"+r.opacity+";stroke-width:"+r.linewidth+";stroke-linecap:"+r.linecap;r.isLineDashedMaterial&&(e=e+";stroke-dasharray:"+r.dashSize+","+r.gapSize),U(e,n)}}(l,h,a);else if(n instanceof te){if(l=n.v1,h=n.v2,c=n.v3,l.positionScreen.z<-1||l.positionScreen.z>1||h.positionScreen.z<-1||h.positionScreen.z>1||c.positionScreen.z<-1||c.positionScreen.z>1)continue;l.positionScreen.x*=s,l.positionScreen.y*=-o,h.positionScreen.x*=s,h.positionScreen.y*=-o,c.positionScreen.x*=s,c.positionScreen.y*=-o,this.overdraw>0&&(k(l.positionScreen,h.positionScreen,this.overdraw),k(h.positionScreen,c.positionScreen,this.overdraw),k(c.positionScreen,l.positionScreen,this.overdraw)),y.setFromPoints([l.positionScreen,h.positionScreen,c.positionScreen]),!0===v.intersectsBox(y)&&function(e,t,n,a,s){g.info.render.vertices+=3,g.info.render.faces++;let o="M"+N(e.positionScreen.x)+","+N(e.positionScreen.y)+"L"+N(t.positionScreen.x)+","+N(t.positionScreen.y)+"L"+N(n.positionScreen.x)+","+N(n.positionScreen.y)+"z";s.isMeshBasicMaterial?(x.copy(s.color),s.vertexColors&&x.multiply(a.color)):s.isMeshLambertMaterial||s.isMeshPhongMaterial||s.isMeshStandardMaterial?(b.copy(s.color),s.vertexColors&&b.multiply(a.color),x.copy(w),B.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),function(e,t,r,n){for(let a=0,s=e.length;a<s;a++){let s=e[a],o=s.color;if(s.isDirectionalLight){let e=M.setFromMatrixPosition(s.matrixWorld).normalize(),t=r.dot(e);if(t<=0)continue;t*=s.intensity,n.r+=o.r*t,n.g+=o.g*t,n.b+=o.b*t}else if(s.isPointLight){let e=M.setFromMatrixPosition(s.matrixWorld),a=r.dot(M.subVectors(e,t).normalize());if(a<=0||0==(a*=0==s.distance?1:1-Math.min(t.distanceTo(e)/s.distance,1)))continue;a*=s.intensity,n.r+=o.r*a,n.g+=o.g*a,n.b+=o.b*a}}}(r,B,a.normalModel,x),x.multiply(b).add(s.emissive)):s.isMeshNormalMaterial&&(S.copy(a.normalModel).applyMatrix3(T).normalize(),x.setRGB(S.x,S.y,S.z).multiplyScalar(.5).addScalar(.5)),U(s.wireframe?"fill:none;stroke:"+x.getStyle()+";stroke-opacity:"+s.opacity+";stroke-width:"+s.wireframeLinewidth+";stroke-linecap:"+s.wireframeLinecap+";stroke-linejoin:"+s.wireframeLinejoin:"fill:"+x.getStyle()+";fill-opacity:"+s.opacity,o)}(l,h,c,n,a)}}}Q(),n.traverseVisible(function(e){if(e.isSVGObject){if(M.setFromMatrixPosition(e.matrixWorld),M.applyMatrix4(P),M.z<-1||M.z>1)return;let t=M.x*s,r=-M.y*o,n=e.node;n.setAttribute("transform","translate("+t+","+r+")"),R.appendChild(n)}})}}}class to{constructor(e=512,t=512){let r=document.createElement("canvas");r.width=e,r.height=t;let n=r.getContext("2d");n.fillStyle="rgb(127,127,255)",n.fillRect(0,0,e,t);for(let r=0;r<4e3;r++){let r=Math.random()*e,a=Math.random()*t,s=3*Math.random()+3,o=2*Math.random()-1,l=2*Math.random()-1,h=1.5,c=Math.sqrt(o*o+l*l+2.25);o/=c,l/=c,h/=c,n.fillStyle="rgb("+(127*o+127)+","+(127*l+127)+","+255*h+")",n.beginPath(),n.arc(r,a,s,0,2*Math.PI),n.fill()}return r}}var tl=Object.defineProperty,th=(e,t,r)=>t in e?tl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tc=(e,t,r)=>(th(e,"symbol"!=typeof t?t+"":t,r),r);let tu=(e=1)=>{let t=new Float32Array(4096*e*4),r=new ee.IEO(t,1024,4*e,ee.wk1,ee.VzW);return r.wrapS=ee.rpg,r.wrapT=ee.rpg,r.magFilter=ee.TyD,r.needsUpdate=!0,r},td=(e,t,r=0)=>{let n=Math.floor(1024);t.arcLengthDivisions=n/2,t.updateArcLengths();let a=t.getSpacedPoints(n),s=t.computeFrenetFrames(n,!0);for(let t=0;t<n;t++){let n=Math.floor(t/1024),o=t%1024,l=a[t];tm(e,o,l.x,l.y,l.z,0+n+4*r),tm(e,o,(l=s.tangents[t]).x,l.y,l.z,1+n+4*r),tm(e,o,(l=s.normals[t]).x,l.y,l.z,2+n+4*r),tm(e,o,(l=s.binormals[t]).x,l.y,l.z,3+n+4*r)}e.needsUpdate=!0},tm=(e,t,r,n,a,s)=>{let{data:o}=e.image,l=4096*s;o[4*t+l+0]=r,o[4*t+l+1]=n,o[4*t+l+2]=a,o[4*t+l+3]=1},tp=e=>({spineTexture:{value:e},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});function tA(e,t,r=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);let n=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${4*r}.;
		float textureStacks = 1.;

		${e.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * 4.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);e.vertexShader=n})}class tf{constructor(e,t=1){tc(this,"curveArray"),tc(this,"curveLengthArray"),tc(this,"object3D"),tc(this,"splineTexure"),tc(this,"uniforms");let r=e.clone(),n=tu(t),a=tp(n);r.traverse(e=>{(e instanceof ee.Kj0||e instanceof ee.SPe)&&(e.material=e.material.clone(),tA(e.material,a,t))}),this.curveArray=Array(t),this.curveLengthArray=Array(t),this.object3D=r,this.splineTexure=n,this.uniforms=a}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");let r=t.getLength();this.uniforms.spineLength.value=r,this.curveLengthArray[e]=r,this.curveArray[e]=t,td(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}let tg=new ee.yGw;class tv extends tf{constructor(e,t,r,n){let a=new ee.SPe(r,n,e);a.instanceMatrix.setUsage(ee.dj0),a.frustumCulled=!1,super(a,t),tc(this,"offsets"),tc(this,"whichCurve"),this.offsets=Array(e).fill(0),this.whichCurve=Array(e).fill(0)}writeChanges(e){tg.makeTranslation(this.curveLengthArray[this.whichCurve[e]],this.whichCurve[e],this.offsets[e]),this.object3D.setMatrixAt(e,tg),this.object3D.instanceMatrix.needsUpdate=!0}moveIndividualAlongCurve(e,t){this.offsets[e]+=t,this.writeChanges(e)}setCurve(e,t){if(isNaN(t))throw Error("curve index being set is Not a Number (NaN)");this.whichCurve[e]=t,this.writeChanges(e)}}var ty=r(43224),tx=Object.defineProperty,tb=(e,t,r)=>t in e?tx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tw=(e,t,r)=>(tb(e,"symbol"!=typeof t?t+"":t,r),r);let tC=new ee.Pa4,tE=new ee.Pa4;function tI(e,t){let r=e.indexOf(t);r>-1&&e.splice(r,1)}class tM{constructor(e,t){tw(this,"position"),tw(this,"id"),tw(this,"faces"),tw(this,"neighbors"),tw(this,"collapseCost"),tw(this,"collapseNeighbor"),tw(this,"minCost",0),tw(this,"totalCost",0),tw(this,"costCount",0),this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(e){var t;-1===(t=this.neighbors).indexOf(e)&&t.push(e)}removeIfNonNeighbor(e){let t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(let t=0;t<r.length;t++)if(r[t].hasVertex(e))return;t.splice(n,1)}}}class tB{constructor(e,t,r,n,a,s){tw(this,"a"),tw(this,"b"),tw(this,"c"),tw(this,"v1"),tw(this,"v2"),tw(this,"v3"),tw(this,"normal",new ee.Pa4),this.a=n,this.b=a,this.c=s,this.v1=e,this.v2=t,this.v3=r,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}computeNormal(){let e=this.v1.position,t=this.v2.position,r=this.v3.position;tC.subVectors(r,t),tE.subVectors(e,t),tC.cross(tE).normalize(),this.normal.copy(tC)}hasVertex(e){return e===this.v1||e===this.v2||e===this.v3}replaceVertex(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),tI(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}}class tS{constructor(){tw(this,"computeEdgeCollapseCost",(e,t)=>{let r=t.position.distanceTo(e.position),n=0,a=[],s,o=e.faces.length,l,h;for(s=0;s<o;s++)(l=e.faces[s]).hasVertex(t)&&a.push(l);for(s=0;s<o;s++){let t=1;l=e.faces[s];for(let e=0;e<a.length;e++)h=a[e],t=Math.min(t,(1.001-l.normal.dot(h.normal))/2);n=Math.max(n,t)}return a.length<2&&(n=1),r*n+0}),tw(this,"computeEdgeCostAtVertex",e=>{if(0===e.neighbors.length){e.collapseNeighbor=null,e.collapseCost=-.01;return}e.collapseCost=1e5,e.collapseNeighbor=null;for(let t=0;t<e.neighbors.length;t++){let r=this.computeEdgeCollapseCost(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}),tw(this,"removeFace",(e,t)=>{let r,n;tI(t,e),e.v1&&tI(e.v1.faces,e),e.v2&&tI(e.v2.faces,e),e.v3&&tI(e.v3.faces,e);let a=[e.v1,e.v2,e.v3];for(let e=0;e<3;e++)r=a[e],n=a[(e+1)%3],r&&n&&(r.removeIfNonNeighbor(n),n.removeIfNonNeighbor(r))}),tw(this,"collapse",(e,t,r,n)=>{let a;if(!n){this.removeVertex(r,e);return}let s=[];for(a=0;a<r.neighbors.length;a++)s.push(r.neighbors[a]);for(a=r.faces.length-1;a>=0;a--)r.faces[a].hasVertex(n)&&this.removeFace(r.faces[a],t);for(a=r.faces.length-1;a>=0;a--)r.faces[a].replaceVertex(r,n);for(this.removeVertex(r,e),a=0;a<s.length;a++)this.computeEdgeCostAtVertex(s[a])}),tw(this,"minimumCostEdge",e=>{let t=e[0];for(let r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}),tw(this,"modify",(e,t)=>{let r;let n=(e=e.clone()).attributes;for(let t in n)"position"!==t&&e.deleteAttribute(t);e=(0,ty.mergeVertices)(e);let a=[],s=[],o=e.getAttribute("position");for(let e=0;e<o.count;e++){let t=new tM(new ee.Pa4().fromBufferAttribute(o,e),e);a.push(t)}let l=e.getIndex();if(null!==l)for(let e=0;e<l.count;e+=3){let t=l.getX(e),r=l.getX(e+1),n=l.getX(e+2),o=new tB(a[t],a[r],a[n],t,r,n);s.push(o)}else for(let e=0;e<o.count;e+=3){let t=e,r=e+1,n=e+2,o=new tB(a[t],a[r],a[n],t,r,n);s.push(o)}for(let e=0,t=a.length;e<t;e++)this.computeEdgeCostAtVertex(a[e]);let h=t;for(;h--;)if(r=this.minimumCostEdge(a))this.collapse(a,s,r,r.collapseNeighbor);else{console.log("THREE.SimplifyModifier: No next vertex");break}let c=new ee.u9r,u=[],d=[];for(let e=0;e<a.length;e++){let t=a[e].position;u.push(t.x,t.y,t.z)}for(let e=0;e<s.length;e++){let t=s[e],r=a.indexOf(t.v1),n=a.indexOf(t.v2),o=a.indexOf(t.v3);d.push(r,n,o)}return c.setAttribute("position",new ee.a$l(u,3)),c.setIndex(d),c})}removeVertex(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;)tI(e.neighbors.pop().neighbors,e);tI(t,e)}}var tT=Object.defineProperty,tF=(e,t,r)=>t in e?tT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tP=(e,t,r)=>(tF(e,"symbol"!=typeof t?t+"":t,r),r);class t_{constructor(){tP(this,"A",new ee.Pa4),tP(this,"B",new ee.Pa4),tP(this,"C",new ee.Pa4),tP(this,"positions",[]),tP(this,"normals",new Float32Array),tP(this,"indexes",[]),tP(this,"pointToIndexMap",[]),tP(this,"splitIndexes",[]),tP(this,"oldNormals",[]),tP(this,"computeNormals",()=>{this.normals=new Float32Array(3*this.indexes.length);for(let e=0;e<this.indexes.length;e+=3){let t=this.indexes[e];this.A.set(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]),t=this.indexes[e+1],this.B.set(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]),t=this.indexes[e+2],this.C.set(this.positions[3*t],this.positions[3*t+1],this.positions[3*t+2]),this.C.sub(this.B),this.A.sub(this.B);let r=this.C.cross(this.A).normalize();for(let t=0;t<3;t++)this.normals[3*(e+t)]=r.x,this.normals[3*(e+t)+1]=r.y,this.normals[3*(e+t)+2]=r.z}}),tP(this,"mapPositionsToIndexes",()=>{this.pointToIndexMap=Array(this.positions.length/3);for(let e=0;e<this.indexes.length;e++){let t=this.indexes[e];null==this.pointToIndexMap[t]&&(this.pointToIndexMap[t]=[]),this.pointToIndexMap[t].push(e)}}),tP(this,"edgeSplitToGroups",(e,t,r)=>{this.A.set(this.normals[3*r],this.normals[3*r+1],this.normals[3*r+2]).normalize();let n={splitGroup:[],currentGroup:[r]};for(let a of e)a!==r&&(this.B.set(this.normals[3*a],this.normals[3*a+1],this.normals[3*a+2]).normalize(),this.B.dot(this.A)<t?n.splitGroup.push(a):n.currentGroup.push(a));return n}),tP(this,"edgeSplit",(e,t,r=null)=>{if(0===e.length)return;let n=[];for(let r of e)n.push(this.edgeSplitToGroups(e,t,r));let a=n[0];for(let e of n)e.currentGroup.length>a.currentGroup.length&&(a=e);null!=r&&this.splitIndexes.push({original:r,indexes:a.currentGroup}),a.splitGroup.length&&this.edgeSplit(a.splitGroup,t,r||a.currentGroup[0])}),tP(this,"modify",(e,t,r=!0)=>{let n=!1;if(e.attributes.normal&&(n=!0,e=e.clone(),!0===r&&null!==e.index&&(this.oldNormals=e.attributes.normal.array),e.deleteAttribute("normal")),null==e.index){if(void 0===ty)throw"THREE.EdgeSplitModifier relies on BufferGeometryUtils";e=(0,ty.mergeVertices)(e)}for(let r of(this.indexes=e.index.array,this.positions=e.getAttribute("position").array,this.computeNormals(),this.mapPositionsToIndexes(),this.splitIndexes=[],this.pointToIndexMap))this.edgeSplit(r,Math.cos(t)-.001);let a={};for(let t of Object.keys(e.attributes)){let r=e.attributes[t],n=new r.array.constructor((this.indexes.length+this.splitIndexes.length)*r.itemSize);n.set(r.array),a[t]=new ee.TlE(n,r.itemSize,r.normalized)}let s=new Uint32Array(this.indexes.length);s.set(this.indexes);for(let e=0;e<this.splitIndexes.length;e++){let t=this.splitIndexes[e],r=this.indexes[t.original];for(let t of Object.values(a))for(let n=0;n<t.itemSize;n++)t.array[(this.indexes.length+e)*t.itemSize+n]=t.array[r*t.itemSize+n];for(let r of t.indexes)s[r]=this.indexes.length+e}for(let t of((e=new ee.u9r).setIndex(new ee.TlE(s,1)),Object.keys(a)))e.setAttribute(t,a[t]);if(n&&(e.computeVertexNormals(),null!==this.oldNormals)){let t=Array(this.oldNormals.length/3).fill(!1);for(let e of this.splitIndexes)t[e.original]=!0;for(let r=0;r<t.length;r++)if(!1===t[r])for(let t=0;t<3;t++)e.attributes.normal.array[3*r+t]=this.oldNormals[3*r+t]}return e})}}var tD=Object.defineProperty,tR=(e,t,r)=>t in e?tD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tL=(e,t,r)=>(tR(e,"symbol"!=typeof t?t+"":t,r),r);class tN{constructor(e=.1,t=6){tL(this,"maxEdgeLength"),tL(this,"maxIterations"),tL(this,"modify",e=>{null!==e.index&&(e=e.toNonIndexed());let t=this.maxIterations,r=this.maxEdgeLength*this.maxEdgeLength,n=new ee.Pa4,a=new ee.Pa4,s=new ee.Pa4,o=new ee.Pa4,l=[n,a,s,o],h=new ee.Pa4,c=new ee.Pa4,u=new ee.Pa4,d=new ee.Pa4,m=[h,c,u,d],p=new ee.Ilk,A=new ee.Ilk,f=new ee.Ilk,g=new ee.Ilk,v=[p,A,f,g],y=new ee.FM8,x=new ee.FM8,b=new ee.FM8,w=new ee.FM8,C=[y,x,b,w],E=new ee.FM8,I=new ee.FM8,M=new ee.FM8,B=new ee.FM8,S=[E,I,M,B],T=e.attributes,F=void 0!==T.normal,P=void 0!==T.color,_=void 0!==T.uv,D=void 0!==T[eW.i],R=T.position.array,L=F?T.normal.array:null,N=P?T.color.array:null,k=_?T.uv.array:null,U=D?T.uv1.array:null,Q=R,O=L,G=N,H=k,z=U,V=0,j=!0;function W(e,t,r){let n=l[e],a=l[t],s=l[r];if(Q.push(n.x,n.y,n.z),Q.push(a.x,a.y,a.z),Q.push(s.x,s.y,s.z),F){let n=m[e],a=m[t],s=m[r];O.push(n.x,n.y,n.z),O.push(a.x,a.y,a.z),O.push(s.x,s.y,s.z)}if(P){let n=v[e],a=v[t],s=v[r];G.push(n.r,n.g,n.b),G.push(a.r,a.g,a.b),G.push(s.r,s.g,s.b)}if(_){let n=C[e],a=C[t],s=C[r];H.push(n.x,n.y),H.push(a.x,a.y),H.push(s.x,s.y)}if(D){let n=S[e],a=S[t],s=S[r];z.push(n.x,n.y),z.push(a.x,a.y),z.push(s.x,s.y)}}for(;j&&V<t;){V++,j=!1,R=Q,Q=[],F&&(L=O,O=[]),P&&(N=G,G=[]),_&&(k=H,H=[]),D&&(U=z,z=[]);for(let e=0,t=0,l=R.length;e<l;e+=9,t+=6){n.fromArray(R,e+0),a.fromArray(R,e+3),s.fromArray(R,e+6),F&&L&&(h.fromArray(L,e+0),c.fromArray(L,e+3),u.fromArray(L,e+6)),P&&N&&(p.fromArray(N,e+0),A.fromArray(N,e+3),f.fromArray(N,e+6)),_&&k&&(y.fromArray(k,t+0),x.fromArray(k,t+2),b.fromArray(k,t+4)),D&&U&&(E.fromArray(U,t+0),I.fromArray(U,t+2),M.fromArray(U,t+4));let l=n.distanceToSquared(a),m=a.distanceToSquared(s),v=n.distanceToSquared(s);l>r||m>r||v>r?(j=!0,l>=m&&l>=v?(o.lerpVectors(n,a,.5),F&&d.lerpVectors(h,c,.5),P&&g.lerpColors(p,A,.5),_&&w.lerpVectors(y,x,.5),D&&B.lerpVectors(E,I,.5),W(0,3,2),W(3,1,2)):m>=l&&m>=v?(o.lerpVectors(a,s,.5),F&&d.lerpVectors(c,u,.5),P&&g.lerpColors(A,f,.5),_&&w.lerpVectors(x,b,.5),D&&B.lerpVectors(I,M,.5),W(0,1,3),W(3,2,0)):(o.lerpVectors(n,s,.5),F&&d.lerpVectors(h,u,.5),P&&g.lerpColors(p,f,.5),_&&w.lerpVectors(y,b,.5),D&&B.lerpVectors(E,M,.5),W(0,1,3),W(3,1,2))):W(0,1,2)}}let X=new ee.u9r;return X.setAttribute("position",new ee.a$l(Q,3)),F&&X.setAttribute("normal",new ee.a$l(O,3)),P&&X.setAttribute("color",new ee.a$l(G,3)),_&&X.setAttribute("uv",new ee.a$l(H,2)),D&&X.setAttribute(eW.i,new ee.a$l(z,2)),X}),this.maxEdgeLength=e,this.maxIterations=t}}var tk=r(93683),tU=Object.defineProperty;async function tQ(e){let t=btoa(String.fromCharCode(...new Uint8Array(await e.arrayBuffer())));return`data:${e.type||""};base64,${t}`}function tO(e,t=1/0,r=null){o||(o=new ee._12(2,2,1,1)),l||(l=new ee.jyz({uniforms:{blitTexture:new ee.xWb(e)},vertexShader:`
        varying vec2 vUv;
        void main(){
            vUv = uv;
            gl_Position = vec4(position.xy * 1.0,0.,.999999);
        }
      `,fragmentShader:`
          uniform sampler2D blitTexture; 
          varying vec2 vUv;

          void main(){ 
              gl_FragColor = vec4(vUv.xy, 0, 1);
              
              #ifdef IS_SRGB
              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
              #else
              gl_FragColor = texture2D( blitTexture, vUv);
              #endif
          }
      `})),l.uniforms.blitTexture.value=e,l.defines.IS_SRGB="colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding,l.needsUpdate=!0,h||((h=new ee.Kj0(o,l)).frustrumCulled=!1);let n=new ee.cPb,a=new ee.xsS;a.add(h),r||(r=s=new ee.CP7({antialias:!1})),r.setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),r.clear(),r.render(a,n);let c=new ee.xEZ(r.domElement);return c.minFilter=e.minFilter,c.magFilter=e.magFilter,c.wrapS=e.wrapS,c.wrapT=e.wrapT,c.name=e.name,s&&(s.dispose(),s=null),c}let tG={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class tH{constructor(){this.pluginCallbacks=[],this.register(function(e){return new t0(e)}),this.register(function(e){return new t1(e)}),this.register(function(e){return new t4(e)}),this.register(function(e){return new t5(e)}),this.register(function(e){return new t8(e)}),this.register(function(e){return new t6(e)}),this.register(function(e){return new t2(e)}),this.register(function(e){return new t3(e)}),this.register(function(e){return new t9(e)}),this.register(function(e){return new t7(e)}),this.register(function(e){return new ie(e)})}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let a=new t$,s=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)s.push(this.pluginCallbacks[e](a));a.setPlugins(s),a.write(e,t,n).catch(r)}parseAsync(e,t){let r=this;return new Promise(function(n,a){r.parse(e,n,a,t)})}}b="symbol"!=typeof(Q="Utils")?Q+"":Q,w={insertKeyframe:function(e,t){let r;let n=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+n),o=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){a[0]=t;for(let e=0;e<n;e++)s[e]=0;r=0}else if(t<e.times[0]){if(.001>Math.abs(e.times[0]-t))return 0;a[0]=t,a.set(e.times,1),s.set(o.evaluate(t),0),s.set(e.values,n),r=0}else if(t>e.times[e.times.length-1]){if(.001>Math.abs(e.times[e.times.length-1]-t))return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),s.set(e.values,0),s.set(o.evaluate(t),e.values.length),r=a.length-1}else for(let l=0;l<e.times.length;l++){if(.001>Math.abs(e.times[l]-t))return l;if(e.times[l]<t&&e.times[l+1]>t){a.set(e.times.slice(0,l+1),0),a[l+1]=t,a.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*n),0),s.set(o.evaluate(t),(l+1)*n),s.set(e.values.slice((l+1)*n),(l+2)*n),r=l+1;break}}return e.times=a,e.values=s,r},mergeMorphTargetTracks:function(e,t){let r=[],n={},a=e.tracks;for(let e=0;e<a.length;++e){let s,o=a[e],l=ee.iUV.parseTrackName(o.name),h=ee.iUV.findNode(t,l.nodeName);if("morphTargetInfluences"!==l.propertyName||void 0===l.propertyIndex){r.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(ee.NMF)}let c=h.morphTargetInfluences.length,u=h.morphTargetDictionary[l.propertyIndex];if(void 0===u)throw Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);if(void 0===n[h.uuid]){let e=new(s=o.clone()).ValueBufferType(c*s.times.length);for(let t=0;t<s.times.length;t++)e[t*c+u]=s.values[t];s.name=(l.nodeName||"")+".morphTargetInfluences",s.values=e,n[h.uuid]=s,r.push(s);continue}let d=o.createInterpolant(new o.ValueBufferType(1));s=n[h.uuid];for(let e=0;e<s.times.length;e++)s.values[e*c+u]=d.evaluate(s.times[e]);for(let e=0;e<o.times.length;e++){let t=this.insertKeyframe(s,o.times[e]);s.values[t*c+u]=o.values[e]}}return e.tracks=r,e}},b in tH?tU(tH,b,{enumerable:!0,configurable:!0,writable:!0,value:w}):tH[b]=w;let tz={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},tV="KHR_mesh_quantization",tj={};tj[ee.TyD]=tz.NEAREST,tj[ee.YLQ]=tz.NEAREST_MIPMAP_NEAREST,tj[ee.aH4]=tz.NEAREST_MIPMAP_LINEAR,tj[ee.wem]=tz.LINEAR,tj[ee.qyh]=tz.LINEAR_MIPMAP_NEAREST,tj[ee.D1R]=tz.LINEAR_MIPMAP_LINEAR,tj[ee.uWy]=tz.CLAMP_TO_EDGE,tj[ee.rpg]=tz.REPEAT,tj[ee.OoA]=tz.MIRRORED_REPEAT;let tW={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},tX=new ee.Ilk;function tY(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function tK(e){return 4*Math.ceil(e/4)}function tJ(e,t=0){let r=tK(e.byteLength);if(r!==e.byteLength){let n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(let a=e.byteLength;a<r;a++)n[a]=t;return n.buffer}return e}function tq(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function tZ(e,t){let r;return void 0!==e.toBlob?new Promise(r=>e.toBlob(r,t)):("image/jpeg"===t?r=.92:"image/webp"===t&&(r=.8),e.convertToBlob({type:t,quality:r}))}class t${constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,r={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);let n=this.buffers,a=this.json;r=this.options;let s=this.extensionsUsed,o=this.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),h=Object.keys(s),c=Object.keys(o);h.length>0&&(a.extensionsUsed=h),c.length>0&&(a.extensionsRequired=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===r.binary?l.arrayBuffer().then(e=>{var r;let n=tJ(e),s=new DataView(new ArrayBuffer(8));s.setUint32(0,n.byteLength,!0),s.setUint32(4,5130562,!0);let o=tJ((r=JSON.stringify(a),new TextEncoder().encode(r).buffer),32),l=new DataView(new ArrayBuffer(8));l.setUint32(0,o.byteLength,!0),l.setUint32(4,1313821514,!0);let h=new ArrayBuffer(12),c=new DataView(h);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);let u=12+l.byteLength+o.byteLength+s.byteLength+n.byteLength;c.setUint32(8,u,!0),new Blob([h,l,o,s,n],{type:"application/octet-stream"}).arrayBuffer().then(t)}):a.buffers&&a.buffers.length>0?tQ(l).then(e=>{a.buffers[0].uri=e,t(a)}):t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let r=this.options,n=this.extensionsUsed;try{let a=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&a.gltfExtensions){for(let e in void 0===t.extensions&&(t.extensions={}),a.gltfExtensions)t.extensions[e]=a.gltfExtensions[e],n[e]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(t.extras=a)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;let t=new ee.Pa4;for(let r=0,n=e.count;r<n;r++)if(Math.abs(t.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let r=e.clone(),n=new ee.Pa4;for(let e=0,t=r.count;e<t;e++)n.fromBufferAttribute(r,e),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),r.setXYZ(e,n.x,n.y,n.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1,n={};(0!==t.offset.x||0!==t.offset.y)&&(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return("colorSpace"in e?"srgb"===e.colorSpace:3001===e.encoding)?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof ee.EB7&&(e=tO(e)),t instanceof ee.EB7&&(t=tO(t));let n=e?e.image:null,a=t?t.image:null,s=Math.max(n?n.width:0,a?a.width:0),o=Math.max(n?n.height:0,a?a.height:0),l=tq();l.width=s,l.height=o;let h=l.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,s,o);let c=h.getImageData(0,0,s,o);if(n){h.drawImage(n,0,0,s,o);let t=r(e),a=h.getImageData(0,0,s,o).data;for(let e=2;e<a.length;e+=4)c.data[e]=256*t(a[e]/256)}if(a){h.drawImage(a,0,0,s,o);let e=r(t),n=h.getImageData(0,0,s,o).data;for(let t=1;t<n.length;t+=4)c.data[t]=256*e(n[t]/256)}h.putImageData(c,0,0);let u=(e||t).clone();return u.source=new ee.xEZ(l).source,"colorSpace"in u?u.colorSpace="":u.encoding=3e3,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){let t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,n,a){let s;let o=this.json;switch(o.bufferViews||(o.bufferViews=[]),t){case tz.BYTE:case tz.UNSIGNED_BYTE:s=1;break;case tz.SHORT:case tz.UNSIGNED_SHORT:s=2;break;default:s=4}let l=tK(n*e.itemSize*s),h=new DataView(new ArrayBuffer(l)),c=0;for(let a=r;a<r+n;a++)for(let r=0;r<e.itemSize;r++){let n;e.itemSize>4?n=e.array[a*e.itemSize+r]:(0===r?n=e.getX(a):1===r?n=e.getY(a):2===r?n=e.getZ(a):3===r&&(n=e.getW(a)),!0===e.normalized&&(n=ee.M8C.normalize(n,e.array))),t===tz.FLOAT?h.setFloat32(c,n,!0):t===tz.INT?h.setInt32(c,n,!0):t===tz.UNSIGNED_INT?h.setUint32(c,n,!0):t===tz.SHORT?h.setInt16(c,n,!0):t===tz.UNSIGNED_SHORT?h.setUint16(c,n,!0):t===tz.BYTE?h.setInt8(c,n):t===tz.UNSIGNED_BYTE&&h.setUint8(c,n),c+=s}let u={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};return void 0!==a&&(u.target=a),a===tz.ARRAY_BUFFER&&(u.byteStride=e.itemSize*s),this.byteOffset+=l,o.bufferViews.push(u),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){let t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),e.arrayBuffer().then(e=>{let n=tJ(e),a={buffer:t.processBuffer(n),byteOffset:t.byteOffset,byteLength:n.byteLength};return t.byteOffset+=n.byteLength,r.bufferViews.push(a)-1})}processAccessor(e,t,r,n){let a,s;let o=this.json;if(e.array.constructor===Float32Array)a=tz.FLOAT;else if(e.array.constructor===Int32Array)a=tz.INT;else if(e.array.constructor===Uint32Array)a=tz.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=tz.SHORT;else if(e.array.constructor===Uint16Array)a=tz.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=tz.BYTE;else if(e.array.constructor===Uint8Array)a=tz.UNSIGNED_BYTE;else throw Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(void 0===r&&(r=0),void 0===n&&(n=e.count),0===n)return null;let l=function(e,t,r){let n={min:Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let a=t;a<t+r;a++)for(let t=0;t<e.itemSize;t++){let r;e.itemSize>4?r=e.array[a*e.itemSize+t]:(0===t?r=e.getX(a):1===t?r=e.getY(a):2===t?r=e.getZ(a):3===t&&(r=e.getW(a)),!0===e.normalized&&(r=ee.M8C.normalize(r,e.array))),n.min[t]=Math.min(n.min[t],r),n.max[t]=Math.max(n.max[t],r)}return n}(e,r,n);void 0!==t&&(s=e===t.index?tz.ELEMENT_ARRAY_BUFFER:tz.ARRAY_BUFFER);let h=this.processBufferView(e,a,r,n,s),c={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:n,max:l.max,min:l.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(c)-1}processImage(e,t,r,n="image/png"){if(null!==e){let a=this,s=a.cache,o=a.json,l=a.options,h=a.pending;s.images.has(e)||s.images.set(e,{});let c=s.images.get(e),u=n+":flipY/"+r.toString();if(void 0!==c[u])return c[u];o.images||(o.images=[]);let d={mimeType:n},m=tq();m.width=Math.min(e.width,l.maxTextureSize),m.height=Math.min(e.height,l.maxTextureSize);let p=m.getContext("2d");if(!0===r&&(p.translate(0,m.height),p.scale(1,-1)),void 0!==e.data){t!==ee.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let r=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];p.putImageData(new ImageData(r,e.width,e.height),0,0)}else p.drawImage(e,0,0,m.width,m.height);!0===l.binary?h.push(tZ(m,n).then(e=>a.processBufferViewImage(e)).then(e=>{d.bufferView=e})):void 0!==m.toDataURL?d.uri=m.toDataURL(n):h.push(tZ(m,n).then(tQ).then(e=>{d.uri=e}));let A=o.images.push(d)-1;return c[u]=A,A}throw Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let r={magFilter:tj[e.magFilter],minFilter:tj[e.minFilter],wrapS:tj[e.wrapS],wrapT:tj[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){let t=this.options,r=this.cache,n=this.json;if(r.textures.has(e))return r.textures.get(e);n.textures||(n.textures=[]),e instanceof ee.EB7&&(e=tO(e,t.maxTextureSize));let a=e.userData.mimeType;"image/webp"===a&&(a="image/png");let s={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(s.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,s)});let o=n.textures.push(s)-1;return r.textures.set(e,o),o}processMaterial(e){let t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);let n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let a=e.color.toArray().concat([e.opacity]);if(tY(a,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=a),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),r={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(r,t),n.pbrMetallicRoughness.metallicRoughnessTexture=r}if(e.map){let t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){let t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){let t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){let t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===ee.ehD&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,n)});let s=r.materials.push(n)-1;return t.materials.set(e,s),s}processMesh(e){let t;let r=this.cache,n=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)a.push(e.material[t].uuid);else a.push(e.material.uuid);let s=a.join(":");if(r.meshes.has(s))return r.meshes.get(s);let o=e.geometry;t=e.isLineSegments?tz.LINES:e.isLineLoop?tz.LINE_LOOP:e.isLine?tz.LINE_STRIP:e.isPoints?tz.POINTS:e.material.wireframe?tz.LINES:tz.TRIANGLES;let l={},h={},c=[],u=[],d={...tk.i>=152?{uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3"}:{uv:"TEXCOORD_0",uv2:"TEXCOORD_1"},color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=o.getAttribute("normal");void 0===m||this.isNormalizedNormalAttribute(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let p=null;for(let e in o.attributes){if("morph"===e.slice(0,5))continue;let t=o.attributes[e];if(e=d[e]||e.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),r.attributes.has(this.getUID(t))){h[e]=r.attributes.get(this.getUID(t));continue}p=null;let n=t.array;"JOINTS_0"!==e||n instanceof Uint16Array||n instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new ee.TlE(new Uint16Array(n),t.itemSize,t.normalized));let a=this.processAccessor(p||t,o);null!==a&&(e.startsWith("_")||this.detectMeshQuantization(e,t),h[e]=a,r.attributes.set(this.getUID(t),a))}if(void 0!==m&&o.setAttribute("normal",m),0===Object.keys(h).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let t=[],n=[],a={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)a[e.morphTargetDictionary[t]]=t;for(let s=0;s<e.morphTargetInfluences.length;++s){let l={},h=!1;for(let e in o.morphAttributes){if("position"!==e&&"normal"!==e){h||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),h=!0);continue}let t=o.morphAttributes[e][s],n=e.toUpperCase(),a=o.attributes[e];if(r.attributes.has(this.getUID(t,!0))){l[n]=r.attributes.get(this.getUID(t,!0));continue}let c=t.clone();if(!o.morphTargetsRelative)for(let e=0,r=t.count;e<r;e++)for(let r=0;r<t.itemSize;r++)0===r&&c.setX(e,t.getX(e)-a.getX(e)),1===r&&c.setY(e,t.getY(e)-a.getY(e)),2===r&&c.setZ(e,t.getZ(e)-a.getZ(e)),3===r&&c.setW(e,t.getW(e)-a.getW(e));l[n]=this.processAccessor(c,o),r.attributes.set(this.getUID(a,!0),l[n])}u.push(l),t.push(e.morphTargetInfluences[s]),void 0!==e.morphTargetDictionary&&n.push(a[s])}l.weights=t,n.length>0&&(l.extras={},l.extras.targetNames=n)}let A=Array.isArray(e.material);if(A&&0===o.groups.length)return null;let f=A?e.material:[e.material],g=A?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,n=g.length;e<n;e++){let n={mode:t,attributes:h};if(this.serializeUserData(o,n),u.length>0&&(n.targets=u),null!==o.index){let t=this.getUID(o.index);(void 0!==g[e].start||void 0!==g[e].count)&&(t+=":"+g[e].start+":"+g[e].count),r.attributes.has(t)?n.indices=r.attributes.get(t):(n.indices=this.processAccessor(o.index,o,g[e].start,g[e].count),r.attributes.set(t,n.indices)),null===n.indices&&delete n.indices}let a=this.processMaterial(f[g[e].materialIndex]);null!==a&&(n.material=a),c.push(n)}l.primitives=c,n.meshes||(n.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,l)});let v=n.meshes.push(l)-1;return r.meshes.set(s,v),v}detectMeshQuantization(e,t){let r;if(this.extensionsUsed[tV])return;switch(t.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}t.normalized&&(r+=" normalized");let n=e.split("_",1)[0];tG[n]&&tG[n].includes(r)&&(this.extensionsUsed[tV]=!0,this.extensionsRequired[tV]=!0)}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let r=e.isOrthographicCamera,n={type:r?"orthographic":"perspective"};return r?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:ee.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){let r=this.json,n=this.nodeMap;r.animations||(r.animations=[]);let a=(e=tH.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,s=[],o=[];for(let e=0;e<a.length;++e){let r;let l=a[e],h=ee.iUV.parseTrackName(l.name),c=ee.iUV.findNode(t,h.nodeName),u=tW[h.propertyName];if("bones"===h.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(h.objectIndex):void 0),!c||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;let d=l.values.length/l.times.length;u===tW.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(r="CUBICSPLINE",d/=3):r=l.getInterpolation()===ee.Syv?"STEP":"LINEAR",o.push({input:this.processAccessor(new ee.TlE(l.times,1)),output:this.processAccessor(new ee.TlE(l.values,d)),interpolation:r}),s.push({sampler:o.length-1,target:{node:n.get(c),path:u}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:o,channels:s}),r.animations.length-1}processSkin(e){let t=this.json,r=this.nodeMap,n=t.nodes[r.get(e)],a=e.skeleton;if(void 0===a)return null;let s=e.skeleton.bones[0];if(void 0===s)return null;let o=[],l=new Float32Array(16*a.bones.length),h=new ee.yGw;for(let t=0;t<a.bones.length;++t)o.push(r.get(a.bones[t])),h.copy(a.boneInverses[t]),h.multiply(e.bindMatrix).toArray(l,16*t);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new ee.TlE(l,16)),joints:o,skeleton:r.get(s)}),n.skin=t.skins.length-1}processNode(e){let t=this.json,r=this.options,n=this.nodeMap;t.nodes||(t.nodes=[]);let a={};if(r.trs){let t=e.quaternion.toArray(),r=e.position.toArray(),n=e.scale.toArray();tY(t,[0,0,0,1])||(a.rotation=t),tY(r,[0,0,0])||(a.translation=r),tY(n,[1,1,1])||(a.scale=n)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===tY(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(a.matrix=e.matrix.elements);if(""!==e.name&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){let t=this.processMesh(e);null!==t&&(a.mesh=t)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let n=0,a=e.children.length;n<a;n++){let a=e.children[n];if(a.visible||!1===r.onlyVisible){let e=this.processNode(a);null!==e&&t.push(e)}}t.length>0&&(a.children=t)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,a)});let s=t.nodes.push(a)-1;return n.set(e,s),s}processScene(e){let t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);let n={};""!==e.name&&(n.name=e.name),t.scenes.push(n);let a=[];for(let t=0,n=e.children.length;t<n;t++){let n=e.children[t];if(n.visible||!1===r.onlyVisible){let e=this.processNode(n);null!==e&&a.push(e)}}a.length>0&&(n.nodes=a),this.serializeUserData(e,n)}processObjects(e){let t=new ee.xsS;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});let r=[];for(let t=0;t<e.length;t++)e[t]instanceof ee.xsS?this.processScene(e[t]):r.push(e[t]);r.length>0&&this.processObjects(r);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}}class t0{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let r=this.writer,n=r.json,a=r.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=-((e.penumbra-1)*e.angle*1),s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),a[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},a[this.name]=!0);let o=n.extensions[this.name].lights;o.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class t1{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class t2{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;let r=this.writer,n=r.extensionsUsed,a={};if(a.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(t,e.clearcoatMap),a.clearcoatTexture=t}if(a.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(t,e.clearcoatRoughnessMap),a.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};r.applyTextureTransform(t,e.clearcoatNormalMap),a.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class t3{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;let r=this.writer,n=r.extensionsUsed,a={};if(a.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(t,e.iridescenceMap),a.iridescenceTexture=t}if(a.iridescenceIor=e.iridescenceIOR,a.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],a.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(t,e.iridescenceThicknessMap),a.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class t4{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let r=this.writer,n=r.extensionsUsed,a={};if(a.transmissionFactor=e.transmission,e.transmissionMap){let t={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(t,e.transmissionMap),a.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class t5{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let r=this.writer,n=r.extensionsUsed,a={};if(a.thicknessFactor=e.thickness,e.thicknessMap){let t={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(t,e.thicknessMap),a.thicknessTexture=t}a.attenuationDistance=e.attenuationDistance,a.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class t8{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;let r=this.writer.extensionsUsed,n={};n.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}class t6{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(tX)&&!e.specularIntensityMap&&!e.specularColorTexture)return;let r=this.writer,n=r.extensionsUsed,a={};if(e.specularIntensityMap){let t={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(t,e.specularIntensityMap),a.specularTexture=t}if(e.specularColorMap){let t={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(t,e.specularColorMap),a.specularColorTexture=t}a.specularFactor=e.specularIntensity,a.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class t9{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;let r=this.writer,n=r.extensionsUsed,a={};if(e.sheenRoughnessMap){let t={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(t,e.sheenRoughnessMap),a.sheenRoughnessTexture=t}if(e.sheenColorMap){let t={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(t,e.sheenColorMap),a.sheenColorTexture=t}a.sheenRoughnessFactor=e.sheenRoughness,a.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class t7{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;let r=this.writer,n=r.extensionsUsed,a={};if(e.anisotropyMap){let t={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(t,e.anisotropyMap),a.anisotropyTexture=t}a.anisotropyStrength=e.anisotropy,a.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=a,n[this.name]=!0}}class ie{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;let r=this.writer.extensionsUsed,n={};n.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=n,r[this.name]=!0}}var it={},ii=Uint8Array,ir=Uint16Array,ia=Uint32Array,is=new ii([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),io=new ii([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),il=new ii([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ih=function(e,t){for(var r=new ir(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new ia(r[30]),n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)a[s]=s-r[n]<<5|n;return[r,a]},ic=ih(is,2),iu=ic[0],id=ic[1];iu[28]=258,id[258]=28;for(var im=ih(io,0),ip=im[0],iA=im[1],ig=new ir(32768),iv=0;iv<32768;++iv){var iy=(43690&iv)>>>1|(21845&iv)<<1;iy=(61680&(iy=(52428&iy)>>>2|(13107&iy)<<2))>>>4|(3855&iy)<<4,ig[iv]=((65280&iy)>>>8|(255&iy)<<8)>>>1}for(var ix=function(e,t,r){for(var n,a=e.length,s=0,o=new ir(t);s<a;++s)++o[e[s]-1];var l=new ir(t);for(s=0;s<t;++s)l[s]=l[s-1]+o[s-1]<<1;if(r){n=new ir(1<<t);var h=15-t;for(s=0;s<a;++s)if(e[s])for(var c=s<<4|e[s],u=t-e[s],d=l[e[s]-1]++<<u,m=d|(1<<u)-1;d<=m;++d)n[ig[d]>>>h]=c}else for(s=0,n=new ir(a);s<a;++s)e[s]&&(n[s]=ig[l[e[s]-1]++]>>>15-e[s]);return n},ib=new ii(288),iv=0;iv<144;++iv)ib[iv]=8;for(var iv=144;iv<256;++iv)ib[iv]=9;for(var iv=256;iv<280;++iv)ib[iv]=7;for(var iv=280;iv<288;++iv)ib[iv]=8;for(var iw=new ii(32),iv=0;iv<32;++iv)iw[iv]=5;var iC=ix(ib,9,0),iE=ix(ib,9,1),iI=ix(iw,5,0),iM=ix(iw,5,1),iB=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},iS=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},iT=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},iF=function(e){return(e/8|0)+(7&e&&1)},iP=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof ir?ir:e instanceof ia?ia:ii)(r-t);return n.set(e.subarray(t,r)),n},i_=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new ii(0);var a=!t||r,s=!r||r.i;r||(r={}),t||(t=new ii(3*n));var o=function(e){var r=t.length;if(e>r){var n=new ii(Math.max(2*r,e));n.set(t),t=n}},l=r.f||0,h=r.p||0,c=r.b||0,u=r.l,d=r.d,m=r.m,p=r.n,A=8*n;do{if(!u){r.f=l=iS(e,h,1);var f=iS(e,h+1,3);if(h+=3,f){if(1==f)u=iE,d=iM,m=9,p=5;else if(2==f){var g=iS(e,h,31)+257,v=iS(e,h+10,15)+4,y=g+iS(e,h+5,31)+1;h+=14;for(var x=new ii(y),b=new ii(19),w=0;w<v;++w)b[il[w]]=iS(e,h+3*w,7);h+=3*v;for(var C=iB(b),E=(1<<C)-1,I=ix(b,C,1),w=0;w<y;){var M=I[iS(e,h,E)];h+=15&M;var B=M>>>4;if(B<16)x[w++]=B;else{var S=0,T=0;for(16==B?(T=3+iS(e,h,3),h+=2,S=x[w-1]):17==B?(T=3+iS(e,h,7),h+=3):18==B&&(T=11+iS(e,h,127),h+=7);T--;)x[w++]=S}}var F=x.subarray(0,g),P=x.subarray(g);m=iB(F),p=iB(P),u=ix(F,m,1),d=ix(P,p,1)}else throw"invalid block type"}else{var B=iF(h)+4,_=e[B-4]|e[B-3]<<8,D=B+_;if(D>n){if(s)throw"unexpected EOF";break}a&&o(c+_),t.set(e.subarray(B,D),c),r.b=c+=_,r.p=h=8*D;continue}if(h>A){if(s)throw"unexpected EOF";break}}a&&o(c+131072);for(var R=(1<<m)-1,L=(1<<p)-1,N=h;;N=h){var S=u[iT(e,h)&R],k=S>>>4;if((h+=15&S)>A){if(s)throw"unexpected EOF";break}if(!S)throw"invalid length/literal";if(k<256)t[c++]=k;else if(256==k){N=h,u=null;break}else{var U=k-254;if(k>264){var w=k-257,Q=is[w];U=iS(e,h,(1<<Q)-1)+iu[w],h+=Q}var O=d[iT(e,h)&L],G=O>>>4;if(!O)throw"invalid distance";h+=15&O;var P=ip[G];if(G>3){var Q=io[G];P+=iT(e,h)&(1<<Q)-1,h+=Q}if(h>A){if(s)throw"unexpected EOF";break}a&&o(c+131072);for(var H=c+U;c<H;c+=4)t[c]=t[c-P],t[c+1]=t[c+1-P],t[c+2]=t[c+2-P],t[c+3]=t[c+3-P];c=H}}r.l=u,r.p=N,r.b=c,u&&(l=1,r.m=m,r.d=d,r.n=p)}while(!l);return c==t.length?t:iP(t,0,c)},iD=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},iR=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},iL=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,s=r.slice();if(!a)return[iH,0];if(1==a){var o=new ii(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var l=r[0],h=r[1],c=0,u=1,d=2;for(r[0]={s:-1,f:l.f+h.f,l:l,r:h};u!=a-1;)l=r[r[c].f<r[d].f?c++:d++],h=r[c!=u&&r[c].f<r[d].f?c++:d++],r[u++]={s:-1,f:l.f+h.f,l:l,r:h};for(var m=s[0].s,n=1;n<a;++n)s[n].s>m&&(m=s[n].s);var p=new ir(m+1),A=iN(r[u-1],p,0);if(A>t){var n=0,f=0,g=A-t,v=1<<g;for(s.sort(function(e,t){return p[t.s]-p[e.s]||e.f-t.f});n<a;++n){var y=s[n].s;if(p[y]>t)f+=v-(1<<A-p[y]),p[y]=t;else break}for(f>>>=g;f>0;){var x=s[n].s;p[x]<t?f-=1<<t-p[x]++-1:++n}for(;n>=0&&f;--n){var b=s[n].s;p[b]==t&&(--p[b],++f)}A=t}return[new ii(p),A]},iN=function(e,t,r){return -1==e.s?Math.max(iN(e.l,t,r+1),iN(e.r,t,r+1)):t[e.s]=r},ik=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new ir(++t),n=0,a=e[0],s=1,o=function(e){r[n++]=e},l=1;l<=t;++l)if(e[l]==a&&l!=t)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=e[l]}return[r.subarray(0,n),t]},iU=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},iQ=function(e,t,r){var n=r.length,a=iF(t+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var s=0;s<n;++s)e[a+s+4]=r[s];return(a+4+n)*8},iO=function(e,t,r,n,a,s,o,l,h,c,u){iD(t,u++,r),++a[256];for(var d,m,p,A,f=iL(a,15),g=f[0],v=f[1],y=iL(s,15),x=y[0],b=y[1],w=ik(g),C=w[0],E=w[1],I=ik(x),M=I[0],B=I[1],S=new ir(19),T=0;T<C.length;++T)S[31&C[T]]++;for(var T=0;T<M.length;++T)S[31&M[T]]++;for(var F=iL(S,7),P=F[0],_=F[1],D=19;D>4&&!P[il[D-1]];--D);var R=c+5<<3,L=iU(a,ib)+iU(s,iw)+o,N=iU(a,g)+iU(s,x)+o+14+3*D+iU(S,P)+(2*S[16]+3*S[17]+7*S[18]);if(R<=L&&R<=N)return iQ(t,u,e.subarray(h,h+c));if(iD(t,u,1+(N<L)),u+=2,N<L){d=ix(g,v,0),m=g,p=ix(x,b,0),A=x;var k=ix(P,_,0);iD(t,u,E-257),iD(t,u+5,B-1),iD(t,u+10,D-4),u+=14;for(var T=0;T<D;++T)iD(t,u+3*T,P[il[T]]);u+=3*D;for(var U=[C,M],Q=0;Q<2;++Q)for(var O=U[Q],T=0;T<O.length;++T){var G=31&O[T];iD(t,u,k[G]),u+=P[G],G>15&&(iD(t,u,O[T]>>>5&127),u+=O[T]>>>12)}}else d=iC,m=ib,p=iI,A=iw;for(var T=0;T<l;++T)if(n[T]>255){var G=n[T]>>>18&31;iR(t,u,d[G+257]),u+=m[G+257],G>7&&(iD(t,u,n[T]>>>23&31),u+=is[G]);var H=31&n[T];iR(t,u,p[H]),u+=A[H],H>3&&(iR(t,u,n[T]>>>5&8191),u+=io[H])}else iR(t,u,d[n[T]]),u+=m[n[T]];return iR(t,u,d[256]),u+m[256]},iG=new ia([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),iH=new ii(0),iz=function(e,t,r,n,a,s){var o=e.length,l=new ii(n+o+5*(1+Math.ceil(o/7e3))+a),h=l.subarray(n,l.length-a),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?c=iQ(h,c,e.subarray(u,d)):(h[u]=s,c=iQ(h,c,e.subarray(u,o)))}else{for(var m=iG[t-1],p=m>>>13,A=8191&m,f=(1<<r)-1,g=new ir(32768),v=new ir(f+1),y=Math.ceil(r/3),x=2*y,b=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<x)&f},w=new ia(25e3),C=new ir(288),E=new ir(32),I=0,M=0,u=0,B=0,S=0,T=0;u<o;++u){var F=b(u),P=32767&u,_=v[F];if(g[P]=_,v[F]=P,S<=u){var D=o-u;if((I>7e3||B>24576)&&D>423){c=iO(e,h,0,w,C,E,M,B,T,u-T,c),B=I=M=0,T=u;for(var R=0;R<286;++R)C[R]=0;for(var R=0;R<30;++R)E[R]=0}var L=2,N=0,k=A,U=P-_&32767;if(D>2&&F==b(u-U))for(var Q=Math.min(p,D)-1,O=Math.min(32767,u),G=Math.min(258,D);U<=O&&--k&&P!=_;){if(e[u+L]==e[u+L-U]){for(var H=0;H<G&&e[u+H]==e[u+H-U];++H);if(H>L){if(L=H,N=U,H>Q)break;for(var z=Math.min(U,H-2),V=0,R=0;R<z;++R){var j=u-U+R+32768&32767,W=g[j],X=j-W+32768&32767;X>V&&(V=X,_=j)}}}_=g[P=_],U+=P-_+32768&32767}if(N){w[B++]=268435456|id[L]<<18|iA[N];var Y=31&id[L],K=31&iA[N];M+=is[Y]+io[K],++C[257+Y],++E[K],S=u+L,++I}else w[B++]=e[u],++C[e[u]]}}c=iO(e,h,s,w,C,E,M,B,T,u-T,c),!s&&7&c&&(c=iQ(h,c+1,iH))}return iP(l,0,n+iF(c)+a)},iV=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&-306674912)^r>>>1;e[t]=r}return e}(),ij=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=iV[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},iW=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},iX=function(e,t){return e[t]|e[t+1]<<8},iY=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},iK=function(e,t){return iY(e,t)+4294967296*iY(e,t+4)},iJ=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},iq=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|(e[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},iZ=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},i$=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function i0(e,t){return i_((i$(e),e.subarray(2,-4)),t)}var i1=function(e,t,r,n){for(var a in e){var s=e[a],o=t+a;s instanceof ii?r[o]=[s,n]:Array.isArray(s)?r[o]=[s[0],iW(n,s[1])]:i1(s,o+"/",r,n)}},i2="undefined"!=typeof TextEncoder&&new TextEncoder,i3="undefined"!=typeof TextDecoder&&new TextDecoder;try{i3.decode(iH,{stream:!0})}catch(e){}var i4=function(e){for(var t="",r=0;;){var n=e[r++],a=(n>127)+(n>223)+(n>239);if(r+a>e.length)return[t,iP(e,r-1)];a?3==a?t+=String.fromCharCode(55296|(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536)>>10,56320|1023&n):1&a?t+=String.fromCharCode((31&n)<<6|63&e[r++]):t+=String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}};function i5(e,t){if(t){for(var r=new ii(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(i2)return i2.encode(e);for(var a=e.length,s=new ii(e.length+(e.length>>1)),o=0,l=function(e){s[o++]=e},n=0;n<a;++n){if(o+5>s.length){var h=new ii(o+8+(a-n<<1));h.set(s),s=h}var c=e.charCodeAt(n);c<128||t?l(c):(c<2048?l(192|c>>6):(c>55295&&c<57344?(l(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++n))>>18),l(128|c>>12&63)):l(224|c>>12),l(128|c>>6&63)),l(128|63&c))}return iP(s,0,o)}function i8(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(i3)return i3.decode(e);var a=i4(e),s=a[0];if(a[1].length)throw"invalid utf-8 data";return s}var i6=function(e,t,r){var n=iX(e,t+28),a=i8(e.subarray(t+46,t+46+n),!(2048&iX(e,t+8))),s=t+46+n,o=iY(e,t+20),l=r&&4294967295==o?i9(e,s):[o,iY(e,t+24),iY(e,t+42)],h=l[0],c=l[1],u=l[2];return[iX(e,t+10),h,c,a,s+iX(e,t+30)+iX(e,t+32),u]},i9=function(e,t){for(;1!=iX(e,t);t+=4+iX(e,t+2));return[iK(e,t+12),iK(e,t+4),iK(e,t+20)]},i7=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;if(n>65535)throw"extra field too long";t+=n+4}return t},re=function(e,t,r,n,a,s,o,l){var h=n.length,c=r.extra,u=l&&l.length,d=i7(c);iJ(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==s&&8),e[t++]=a&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var m=new Date(null==r.mtime?Date.now():r.mtime),p=m.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(iJ(e,t,p<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),t+=4,null!=s&&(iJ(e,t,r.crc),iJ(e,t+4,s),iJ(e,t+8,r.size)),iJ(e,t+12,h),iJ(e,t+14,d),t+=16,null!=o&&(iJ(e,t,u),iJ(e,t+6,r.attrs),iJ(e,t+10,o),t+=14),e.set(n,t),t+=h,d)for(var A in c){var f=c[A],g=f.length;iJ(e,t,+A),iJ(e,t+2,g),e.set(f,t+4),t+=4+g}return u&&(e.set(l,t),t+=u),t},rt=function(e,t,r,n,a){iJ(e,t,101010256),iJ(e,t+8,r),iJ(e,t+10,r),iJ(e,t+12,n),iJ(e,t+16,a)};function ri(e){for(var t={},r=e.length-22;101010256!=iY(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var n=iX(e,r+8);if(!n)return{};var a=iY(e,r+16),s=4294967295==a;if(s){if(r=iY(e,r-12),101075792!=iY(e,r))throw"invalid zip file";n=iY(e,r+32),a=iY(e,r+48)}for(var o=0;o<n;++o){var l=i6(e,a,s),h=l[0],c=l[1],u=l[2],d=l[3],m=l[4],p=l[5],A=p+30+iX(e,p+26)+iX(e,p+28);if(a=m,h){if(8==h)t[d]=i_(e.subarray(A,A+c),new ii(u));else throw"unknown compression type "+h}else t[d]=iP(e,A,A+c)}return t}var rr=Object.defineProperty,rn=(e,t,r)=>t in e?rr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ra=(e,t,r)=>(rn(e,"symbol"!=typeof t?t+"":t,r),r);class rs{constructor(){ra(this,"PRECISION",7),ra(this,"materials"),ra(this,"textures"),ra(this,"files"),this.materials={},this.textures={},this.files={}}async parse(e){let t="model.usda";this.files[t]=null;let r=this.buildHeader();for(let n in e.traverseVisible(e=>{if(e instanceof ee.Kj0&&e.isMesh&&e.material.isMeshStandardMaterial){let t=e.geometry,n=e.material,a="geometries/Geometry_"+t.id+".usd";if(!(a in this.files)){let e=this.buildMeshObject(t);this.files[a]=this.buildUSDFileAsString(e)}n.uuid in this.materials||(this.materials[n.uuid]=n),r+=this.buildXform(e,t,n)}}),r+=this.buildMaterials(this.materials),this.files[t]=i5(r),r=null,this.textures){let e=this.textures[n],t=n.split("_")[1],r=1023===e.format,a=this.imageToCanvas(e.image,t),s=await new Promise(e=>null==a?void 0:a.toBlob(e,r?"image/png":"image/jpeg",1));s&&(this.files[`textures/Texture_${n}.${r?"png":"jpg"}`]=new Uint8Array(await s.arrayBuffer()))}let n=0;for(let e in this.files){let t=this.files[e],r=63&(n+=34+e.length);if(4!==r&&null!==t&&t instanceof Uint8Array){let n=new Uint8Array(64-r);this.files[e]=[t,{extra:{12345:n}}]}t&&"number"==typeof t.length&&(n=t.length)}return function(e,t){t||(t={});var r={},n=[];i1(e,"",r,t);var a=0,s=0;for(var o in r){var l=r[o],h=l[0],c=l[1],u=0==c.level?0:8,d=i5(o),m=d.length,p=c.comment,A=p&&i5(p),f=A&&A.length,g=i7(c.extra);if(m>65535)throw"filename too long";var v=u?function(e,t){var r;return iz(e,null==(r=t||{}).level?6:r.level,null==r.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+r.mem,0,0,!0)}(h,c):h,y=v.length,x=ij();x.p(h),n.push(iW(c,{size:h.length,crc:x.d(),c:v,f:d,m:A,u:m!=o.length||A&&p.length!=f,o:a,compression:u})),a+=30+m+g+y,s+=76+2*(m+g)+(f||0)+y}for(var b=new ii(s+22),w=a,C=s-a,E=0;E<n.length;++E){var d=n[E];re(b,d.o,d,d.f,d.u,d.c.length);var I=30+d.f.length+i7(d.extra);b.set(d.c,d.o+I),re(b,a,d,d.f,d.u,d.c.length,d.o,d.m),a+=16+I+(d.m?d.m.length:0)}return rt(b,a,n.length,C,w),b}(this.files,{level:0})}imageToCanvas(e,t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let r=1024/Math.max(e.width,e.height),n=document.createElement("canvas");n.width=e.width*Math.min(1,r),n.height=e.height*Math.min(1,r);let a=n.getContext("2d");if(null==a||a.drawImage(e,0,0,n.width,n.height),void 0!==t){let e=parseInt(t,16),r=(e>>16&255)/255,s=(e>>8&255)/255,o=(255&e)/255,l=null==a?void 0:a.getImageData(0,0,n.width,n.height);if(l){let e=null==l?void 0:l.data;for(let t=0;t<e.length;t+=4)e[t+0]=e[t+0]*r,e[t+1]=e[t+1]*s,e[t+2]=e[t+2]*o;null==a||a.putImageData(l,0,0)}}return n}}buildHeader(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Three.js USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}buildUSDFileAsString(e){let t=this.buildHeader();return i5(t+=e)}buildXform(e,t,r){let n="Object_"+e.id,a=this.buildMatrix(e.matrixWorld);return 0>e.matrixWorld.determinant()&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),`def Xform "${n}" (
    prepend references = @./geometries/Geometry_${t.id}.usd@</Geometry>
)
{
    matrix4d xformOp:transform = ${a}
    uniform token[] xformOpOrder = ["xformOp:transform"]
    rel material:binding = </Materials/Material_${r.id}>
}
`}buildMatrix(e){let t=e.elements;return`( ${this.buildMatrixRow(t,0)}, ${this.buildMatrixRow(t,4)}, ${this.buildMatrixRow(t,8)}, ${this.buildMatrixRow(t,12)} )`}buildMatrixRow(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}buildMeshObject(e){let t=this.buildMesh(e);return`
def "Geometry"
{
  ${t}
}
`}buildMesh(e){let t=e.attributes,r=t.position.count;return`
    def Mesh "Geometry"
    {
        int[] faceVertexCounts = [${this.buildMeshVertexCount(e)}]
        int[] faceVertexIndices = [${this.buildMeshVertexIndices(e)}]
        normal3f[] normals = [${this.buildVector3Array(t.normal,r)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${this.buildVector3Array(t.position,r)}]
        float2[] primvars:st = [${this.buildVector2Array(t.uv,r)}] (
            interpolation = "vertex"
        )
        uniform token subdivisionScheme = "none"
    }
`}buildMeshVertexCount(e){return Array((null!==e.index?e.index.array.length:e.attributes.position.count)/3).fill(3).join(", ")}buildMeshVertexIndices(e){if(null!==e.index)return e.index.array.join(", ");let t=[],r=e.attributes.position.count;for(let e=0;e<r;e++)t.push(e);return t.join(", ")}buildVector3Array(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");let r=[],n=e.array;for(let e=0;e<n.length;e+=3)r.push(`(${n[e+0].toPrecision(this.PRECISION)}, ${n[e+1].toPrecision(this.PRECISION)}, ${n[e+2].toPrecision(this.PRECISION)})`);return r.join(", ")}buildVector2Array(e,t){if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");let r=[],n=e.array;for(let e=0;e<n.length;e+=2)r.push(`(${n[e+0].toPrecision(this.PRECISION)}, ${1-n[e+1].toPrecision(this.PRECISION)})`);return r.join(", ")}buildMaterials(e){let t=[];for(let r in e){let n=e[r];t.push(this.buildMaterial(n))}return`def "Materials"
{
${t.join("")}
}
`}buildMaterial(e){let t="            ",r=[],n=[];return null!==e.map?(r.push(`${t}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),(e.transparent||e.alphaTest>0)&&r.push(`${t}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`),e.alphaTest>.01?r.push(`${t}float inputs:opacityThreshold = ${e.alphaTest}`):(e.transparent||e.alphaTest>0)&&r.push(`${t}float inputs:opacityThreshold = 0.01`),n.push(this.buildTexture(e,e.map,"diffuse",e.color))):r.push(`${t}color3f inputs:diffuseColor = ${this.buildColor(e.color)}`),null!==e.emissiveMap?(r.push(`${t}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),n.push(this.buildTexture(e,e.emissiveMap,"emissive"))):e.emissive.getHex()>0&&r.push(`${t}color3f inputs:emissiveColor = ${this.buildColor(e.emissive)}`),null!==e.normalMap&&(r.push(`${t}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),n.push(this.buildTexture(e,e.normalMap,"normal"))),null!==e.aoMap&&(r.push(`${t}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),n.push(this.buildTexture(e,e.aoMap,"occlusion"))),null!==e.roughnessMap&&1===e.roughness?(r.push(`${t}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),n.push(this.buildTexture(e,e.roughnessMap,"roughness"))):r.push(`${t}float inputs:roughness = ${e.roughness}`),null!==e.metalnessMap&&1===e.metalness?(r.push(`${t}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),n.push(this.buildTexture(e,e.metalnessMap,"metallic"))):r.push(`${t}float inputs:metallic = ${e.metalness}`),r.push(`${t}float inputs:opacity = ${e.opacity}`),e instanceof ee.EJi&&(r.push(`${t}float inputs:clearcoat = ${e.clearcoat}`),r.push(`${t}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),r.push(`${t}float inputs:ior = ${e.ior}`)),`
    def Material "Material_${e.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${r.join("\n")}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }
        token outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>
        token inputs:frame:stPrimvarName = "st"
        def Shader "uvReader_st"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            token inputs:varname.connect = </Materials/Material_${e.id}.inputs:frame:stPrimvarName>
            float2 inputs:fallback = (0.0, 0.0)
            float2 outputs:result
        }
${n.join("\n")}
    }
`}buildTexture(e,t,r,n){let a=t.id+(n?"_"+n.getHexString():""),s=1023===t.format;return this.textures[a]=t,`
      def Shader "Transform2d_${r}" (
          sdrMetadata = {
              string role = "math"
          }
      )
      {
          uniform token info:id = "UsdTransform2d"
          float2 inputs:in.connect = </Materials/Material_${e.id}/uvReader_st.outputs:result>
          float2 inputs:scale = ${this.buildVector2(t.repeat)}
          float2 inputs:translation = ${this.buildVector2(t.offset)}
          float2 outputs:result
      }
      def Shader "Texture_${t.id}_${r}"
      {
          uniform token info:id = "UsdUVTexture"
          asset inputs:file = @textures/Texture_${a}.${s?"png":"jpg"}@
          float2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${r}.outputs:result>
          token inputs:wrapS = "repeat"
          token inputs:wrapT = "repeat"
          float outputs:r
          float outputs:g
          float outputs:b
          float3 outputs:rgb
          ${e.transparent||e.alphaTest>0?"float outputs:a":""}
      }`}buildColor(e){return`(${e.r}, ${e.g}, ${e.b})`}buildVector2(e){return`(${e.x}, ${e.y})`}}class ro{parse(e,t,r){t&&"object"==typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=t,t=void 0);let n=(r=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},r)).excludeAttributes,a=!1,s=!1,o=!1,l=0,h=0;e.traverse(function(e){if(e instanceof ee.Kj0&&e.isMesh){let t=e.geometry;if(!t.isBufferGeometry)throw Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");let r=t.getAttribute("position"),n=t.getAttribute("normal"),c=t.getAttribute("uv"),u=t.getAttribute("color"),d=t.getIndex();void 0!==r&&(l+=r.count,h+=d?d.count/3:r.count/3,void 0!==n&&(a=!0),void 0!==c&&(o=!0),void 0!==u&&(s=!0))}});let c=(null==n?void 0:n.indexOf("index"))===-1;if(a=a&&(null==n?void 0:n.indexOf("normal"))===-1,s=s&&(null==n?void 0:n.indexOf("color"))===-1,o=o&&(null==n?void 0:n.indexOf("uv"))===-1,c&&h!==Math.floor(h))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;let u=`ply
format ${r.binary?r.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0
element vertex ${l}
property float x
property float y
property float z
`;a&&(u+="property float nx\nproperty float ny\nproperty float nz\n"),o&&(u+="property float s\nproperty float t\n"),s&&(u+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),c&&(u+=`element face ${h}
property list uchar int vertex_index
`),u+="end_header\n";let d=new ee.Pa4,m=new ee.Vkp,p=null;if(r.binary){let t=new TextEncoder().encode(u),n=l*(12+(a?12:0)+(s?3:0)+(o?8:0)),A=c?13*h:0,f=new DataView(new ArrayBuffer(t.length+n+A));new Uint8Array(f.buffer).set(t,0);let g=t.length,v=t.length+n,y=0;this.traverseMeshes(e,function(e,t){let n=t.getAttribute("position"),l=t.getAttribute("normal"),h=t.getAttribute("uv"),u=t.getAttribute("color"),p=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(let t=0,c=n.count;t<c;t++)d.x=n.getX(t),d.y=n.getY(t),d.z=n.getZ(t),d.applyMatrix4(e.matrixWorld),f.setFloat32(g,d.x,r.littleEndian),g+=4,f.setFloat32(g,d.y,r.littleEndian),g+=4,f.setFloat32(g,d.z,r.littleEndian),g+=4,a&&(null!=l?(d.x=l.getX(t),d.y=l.getY(t),d.z=l.getZ(t),d.applyMatrix3(m).normalize(),f.setFloat32(g,d.x,r.littleEndian),g+=4,f.setFloat32(g,d.y,r.littleEndian),g+=4,f.setFloat32(g,d.z,r.littleEndian)):(f.setFloat32(g,0,r.littleEndian),g+=4,f.setFloat32(g,0,r.littleEndian),g+=4,f.setFloat32(g,0,r.littleEndian)),g+=4),o&&(null!=h?(f.setFloat32(g,h.getX(t),r.littleEndian),g+=4,f.setFloat32(g,h.getY(t),r.littleEndian),g+=4):o||(f.setFloat32(g,0,r.littleEndian),g+=4,f.setFloat32(g,0,r.littleEndian),g+=4)),s&&(null!=u?(f.setUint8(g,Math.floor(255*u.getX(t))),g+=1,f.setUint8(g,Math.floor(255*u.getY(t))),g+=1,f.setUint8(g,Math.floor(255*u.getZ(t)))):(f.setUint8(g,255),g+=1,f.setUint8(g,255),g+=1,f.setUint8(g,255)),g+=1);if(c){if(null!==p)for(let e=0,t=p.count;e<t;e+=3)f.setUint8(v,3),v+=1,f.setUint32(v,p.getX(e+0)+y,r.littleEndian),v+=4,f.setUint32(v,p.getX(e+1)+y,r.littleEndian),v+=4,f.setUint32(v,p.getX(e+2)+y,r.littleEndian),v+=4;else for(let e=0,t=n.count;e<t;e+=3)f.setUint8(v,3),v+=1,f.setUint32(v,y+e,r.littleEndian),v+=4,f.setUint32(v,y+e+1,r.littleEndian),v+=4,f.setUint32(v,y+e+2,r.littleEndian),v+=4}y+=n.count}),p=f.buffer}else{let t=0,r="",n="";this.traverseMeshes(e,function(e,l){let u=l.getAttribute("position"),p=l.getAttribute("normal"),A=l.getAttribute("uv"),f=l.getAttribute("color"),g=l.getIndex();m.getNormalMatrix(e.matrixWorld);for(let t=0,n=u.count;t<n;t++){d.x=u.getX(t),d.y=u.getY(t),d.z=u.getZ(t),d.applyMatrix4(e.matrixWorld);let n=d.x+" "+d.y+" "+d.z;a&&(null!=p?(d.x=p.getX(t),d.y=p.getY(t),d.z=p.getZ(t),d.applyMatrix3(m).normalize(),n+=" "+d.x+" "+d.y+" "+d.z):n+=" 0 0 0"),o&&(null!=A?n+=" "+A.getX(t)+" "+A.getY(t):o&&(n+=" 0 0")),s&&(null!=f?n+=" "+Math.floor(255*f.getX(t))+" "+Math.floor(255*f.getY(t))+" "+Math.floor(255*f.getZ(t)):n+=" 255 255 255"),r+=n+"\n"}if(c){if(null!==g)for(let e=0,r=g.count;e<r;e+=3)n+=`3 ${g.getX(e+0)+t} ${g.getX(e+1)+t} ${g.getX(e+2)+t}
`;else for(let e=0,r=u.count;e<r;e+=3)n+=`3 ${t+e} ${t+e+1} ${t+e+2}
`;h+=g?g.count/3:u.count/3}t+=u.count}),p=`${u}${r}${c?`${n}
`:"\n"}`}return"function"==typeof t&&requestAnimationFrame(()=>t&&t("string"==typeof p?p:"")),p}traverseMeshes(e,t){e.traverse(function(e){if(e instanceof ee.Kj0&&e.isMesh){let r=e.geometry;if(!r.isBufferGeometry)throw Error("THREE.PLYExporter: Geometry is not of type THREE.BufferGeometry.");r.hasAttribute("position")&&t(e,r)}})}}var rl=Object.defineProperty,rh=(e,t,r)=>t in e?rl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rc=(e,t,r)=>(rh(e,"symbol"!=typeof t?t+"":t,r),r);let ru=class{parse(e,t={decodeSpeed:5,encodeSpeed:5,encoderMethod:ru.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1}){let r,n,a;if(e instanceof ee.u9r&&e.isBufferGeometry)throw Error("DRACOExporter: The first parameter of parse() is now an instance of Mesh or Points.");if(void 0===DracoEncoderModule)throw Error("THREE.DRACOExporter: required the draco_encoder to work.");let s=e.geometry,o=DracoEncoderModule(),l=new o.Encoder;if(!s.isBufferGeometry)throw Error("THREE.DRACOExporter.parse(geometry, options): geometry is not a THREE.BufferGeometry instance.");if(e instanceof ee.Kj0&&e.isMesh){r=new o.MeshBuilder,n=new o.Mesh;let e=s.getAttribute("position");r.AddFloatAttributeToMesh(n,o.POSITION,e.count,e.itemSize,e.array);let a=s.getIndex();if(null!==a)r.AddFacesToMesh(n,a.count/3,a.array);else{let t=new(e.count>65535?Uint32Array:Uint16Array)(e.count);for(let e=0;e<t.length;e++)t[e]=e;r.AddFacesToMesh(n,e.count,t)}if(t.exportNormals){let e=s.getAttribute("normal");void 0!==e&&r.AddFloatAttributeToMesh(n,o.NORMAL,e.count,e.itemSize,e.array)}if(t.exportUvs){let e=s.getAttribute("uv");void 0!==e&&r.AddFloatAttributeToMesh(n,o.TEX_COORD,e.count,e.itemSize,e.array)}if(t.exportColor){let e=s.getAttribute("color");void 0!==e&&r.AddFloatAttributeToMesh(n,o.COLOR,e.count,e.itemSize,e.array)}}else if(e instanceof ee.woe&&e.isPoints){r=new o.PointCloudBuilder,n=new o.PointCloud;let e=s.getAttribute("position");if(r.AddFloatAttribute(n,o.POSITION,e.count,e.itemSize,e.array),t.exportColor){let e=s.getAttribute("color");void 0!==e&&r.AddFloatAttribute(n,o.COLOR,e.count,e.itemSize,e.array)}}else throw Error("DRACOExporter: Unsupported object type.");let h=new o.DracoInt8Array,c=void 0!==t.encodeSpeed?t.encodeSpeed:5,u=void 0!==t.decodeSpeed?t.decodeSpeed:5;if(l.SetSpeedOptions(c,u),void 0!==t.encoderMethod&&l.SetEncodingMethod(t.encoderMethod),void 0!==t.quantization)for(let e=0;e<5;e++)void 0!==t.quantization[e]&&l.SetAttributeQuantization(e,t.quantization[e]);if(a=e instanceof ee.Kj0&&e.isMesh?l.EncodeMeshToDracoBuffer(n,h):l.EncodePointCloudToDracoBuffer(n,!0,h),o.destroy(n),0===a)throw Error("THREE.DRACOExporter: Draco encoding failed.");let d=new Int8Array(new ArrayBuffer(a));for(let e=0;e<a;e++)d[e]=h.GetValue(e);return o.destroy(h),o.destroy(l),o.destroy(r),d}},rd=ru;rc(rd,"MESH_EDGEBREAKER_ENCODING",1),rc(rd,"MESH_SEQUENTIAL_ENCODING",0),rc(rd,"POINT_CLOUD",0),rc(rd,"TRIANGULAR_MESH",1),rc(rd,"INVALID",-1),rc(rd,"POSITION",0),rc(rd,"NORMAL",1),rc(rd,"COLOR",2),rc(rd,"TEX_COORD",3),rc(rd,"GENERIC",4);var rm=Object.defineProperty,rp=(e,t,r)=>t in e?rm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rA=(e,t,r)=>(rp(e,"symbol"!=typeof t?t+"":t,r),r);class rf{constructor(){rA(this,"options"),rA(this,"geometryInfo"),rA(this,"materialMap"),rA(this,"imageMap"),rA(this,"textures"),rA(this,"libraryImages"),rA(this,"libraryGeometries"),rA(this,"libraryEffects"),rA(this,"libraryMaterials"),rA(this,"canvas"),rA(this,"ctx"),rA(this,"transMat"),rA(this,"getFuncs",["getX","getY","getZ","getW"]),this.options={version:"1.4.1",author:null,textureDirectory:"",upAxis:"Y_UP",unitName:null,unitMeter:null},this.geometryInfo=new WeakMap,this.materialMap=new WeakMap,this.imageMap=new WeakMap,this.textures=[],this.libraryImages=[],this.libraryGeometries=[],this.libraryEffects=[],this.libraryMaterials=[],this.canvas=null,this.ctx=null,this.transMat=null}parse(e,t,r={}){if(this.options={...this.options,...r},null===this.options.upAxis.match(/^[XYZ]_UP$/))return console.error("ColladaExporter: Invalid upAxis: valid values are X_UP, Y_UP or Z_UP."),null;if(null!==this.options.unitName&&null===this.options.unitMeter)return console.error("ColladaExporter: unitMeter needs to be specified if unitName is specified."),null;if(null!==this.options.unitMeter&&null===this.options.unitName)return console.error("ColladaExporter: unitName needs to be specified if unitMeter is specified."),null;if(""!==this.options.textureDirectory&&(this.options.textureDirectory=`${this.options.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/")),"1.4.1"!==this.options.version&&"1.5.0"!==this.options.version)return console.warn(`ColladaExporter : Version ${this.options.version} not supported for export. Only 1.4.1 and 1.5.0.`),null;let n=this.processObject(e),a="1.4.1"===this.options.version?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/",s=`<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="${a}" version="${this.options.version}"><asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>${null!==this.options.author?`<author>${this.options.author}</author>`:""}</contributor><created>${new Date().toISOString()}</created><modified>${new Date().toISOString()}</modified><up_axis>Y_UP</up_axis></asset>`;s+=`<library_images>${this.libraryImages.join("")}</library_images><library_effects>${this.libraryEffects.join("")}</library_effects><library_materials>${this.libraryMaterials.join("")}</library_materials><library_geometries>${this.libraryGeometries.join("")}</library_geometries><library_visual_scenes><visual_scene id="Scene" name="scene">${n}</visual_scene></library_visual_scenes><scene><instance_visual_scene url="#Scene"/></scene></COLLADA>`;let o={data:this.format(s),textures:this.textures};return"function"==typeof t&&requestAnimationFrame(()=>t(o)),o}format(e){var t,r;let n=/^<\//,a=/(\?>$)|(\/>$)/,s=/<[^>]+>[^<]*<\/[^<]+>/,o=(e,t)=>t>0?e+o(e,t-1):"",l=0;return null!=(r=null==(t=e.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g))?void 0:t.map(e=>{!s.test(e)&&!a.test(e)&&n.test(e)&&l--;let t=`${o("  ",l)}${e}`;return!s.test(e)&&!a.test(e)&&!n.test(e)&&l++,t}).join("\n"))?r:""}base64ToBuffer(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0,n=r.length;e<n;e++)r[e]=t.charCodeAt(e);return r}imageToData(e,t){var r;this.canvas=this.canvas||document.createElement("canvas"),this.ctx=this.ctx||this.canvas.getContext("2d"),this.canvas.width=e.width instanceof SVGAnimatedLength?0:e.width,this.canvas.height=e.height instanceof SVGAnimatedLength?0:e.height,null==(r=this.ctx)||r.drawImage(e,0,0);let n=this.canvas.toDataURL(`image/${t}`,1).replace(/^data:image\/(png|jpg);base64,/,"");return this.base64ToBuffer(n)}attrBufferToArray(e){if(!(e instanceof ee.kB5)||!e.isInterleavedBufferAttribute)return e.array;{let t=new e.array.constructor(e.count*e.itemSize),r=e.itemSize;for(let n=0,a=e.count;n<a;n++)for(let a=0;a<r;a++)t[n*r+a]=e[this.getFuncs[a]](n);return t}}subArray(e,t,r){return Array.isArray(e)?e.slice(t,t+r):new e.constructor(e.buffer,t*e.BYTES_PER_ELEMENT,r)}getAttribute(e,t,r,n){let a=this.attrBufferToArray(e);return Array.isArray(a)?`${`<source id="${t}"><float_array id="${t}-array" count="${a.length}">`+a.join(" ")}</float_array><technique_common><accessor source="#${t}-array" count="${Math.floor(a.length/e.itemSize)}" stride="${e.itemSize}">${r.map(e=>`<param name="${e}" type="${n}" />`).join("")}</accessor></technique_common></source>`:""}getTransform(e){return e.updateMatrix(),this.transMat=this.transMat||new ee.yGw,this.transMat.copy(e.matrix),this.transMat.transpose(),`<matrix>${this.transMat.toArray().join(" ")}</matrix>`}processGeometry(e){let t=this.geometryInfo.get(e);if(!t){if(!e.isBufferGeometry)throw Error("THREE.ColladaExporter: Geometry is not of type THREE.BufferGeometry.");let r=`Mesh${this.libraryGeometries.length+1}`,n=e.index?e.index.count*e.index.itemSize:e.attributes.position.count,a=null!=e.groups&&0!==e.groups.length?e.groups:[{start:0,count:n,materialIndex:0}],s=e.name?` name="${e.name}"`:"",o=`<geometry id="${r}"${s}><mesh>`,l=`${r}-position`,h=`${r}-vertices`;o+=this.getAttribute(e.attributes.position,l,["X","Y","Z"],"float")+`<vertices id="${h}"><input semantic="POSITION" source="#${l}" /></vertices>`;let c=`<input semantic="VERTEX" source="#${h}" offset="0" />`;if("normal"in e.attributes){let t=`${r}-normal`;o+=this.getAttribute(e.attributes.normal,t,["X","Y","Z"],"float"),c+=`<input semantic="NORMAL" source="#${t}" offset="0" />`}if("uv"in e.attributes){let t=`${r}-texcoord`;o+=this.getAttribute(e.attributes.uv,t,["S","T"],"float"),c+=`<input semantic="TEXCOORD" source="#${t}" offset="0" set="0" />`}if(eW.i in e.attributes){let t=`${r}-texcoord2`;o+=this.getAttribute(e.attributes[eW.i],t,["S","T"],"float"),c+=`<input semantic="TEXCOORD" source="#${t}" offset="0" set="1" />`}if("color"in e.attributes){let t=`${r}-color`;o+=this.getAttribute(e.attributes.color,t,["X","Y","Z"],"uint8"),c+=`<input semantic="COLOR" source="#${t}" offset="0" />`}let u=null;if(e.index)u=this.attrBufferToArray(e.index);else{u=Array(n);for(let e=0,t=u.length;e<t&&Array.isArray(u);e++)u[e]=e}for(let e=0,t=a.length;e<t;e++){let t=a[e],r=this.subArray(u,t.start,t.count),n=r.length/3;o+=`<triangles material="MESH_MATERIAL_${t.materialIndex}" count="${n}">`+c+`<p>${r.join(" ")}</p>`+"</triangles>"}o+="</mesh></geometry>",this.libraryGeometries.push(o),t={meshid:r,bufferGeometry:e},this.geometryInfo.set(e,t)}return t}processTexture(e){let t=this.imageMap.get(e);if(null==t){t=`image-${this.libraryImages.length+1}`;let r=e.name||t,n=`<image id="${t}" name="${r}">`;"1.5.0"===this.options.version?n+=`<init_from><ref>${this.options.textureDirectory}${r}.png</ref></init_from>`:n+=`<init_from>${this.options.textureDirectory}${r}.png</init_from>`,n+="</image>",this.libraryImages.push(n),this.imageMap.set(e,t),this.textures.push({directory:this.options.textureDirectory,name:r,ext:"png",data:this.imageToData(e.image,"png"),original:e})}return t}processMaterial(e){let t=this.materialMap.get(e);if(null==t){t=`Mat${this.libraryEffects.length+1}`;let r="phong";if(e instanceof ee.YBo?r="lambert":e instanceof ee.vBJ&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial.")),e instanceof ee.xoR){let n=e.emissive?e.emissive:new ee.Ilk(0,0,0),a=e.color?e.color:new ee.Ilk(0,0,0),s=e.specular?e.specular:new ee.Ilk(1,1,1),o=e.shininess||0,l=e.reflectivity||0,h="";e.transparent&&(h+=`<transparent>${e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>"}</transparent>`,e.opacity<1&&(h+=`<transparency><float>${e.opacity}</float></transparency>`));let c=`<technique sid="common"><${r}><emission>${e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${n.r} ${n.g} ${n.b} 1</color>`}</emission>${"constant"!==r?`<diffuse>${e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${a.r} ${a.g} ${a.b} 1</color>`}</diffuse>`:""}${"constant"!==r?`<bump>${e.normalMap?'<texture texture="bump-sampler" texcoord="TEXCOORD" />':""}</bump>`:""}${"phong"===r?`<specular><color sid="specular">${s.r} ${s.g} ${s.b} 1</color></specular><shininess>${e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`}</shininess>`:""}<reflective><color>${a.r} ${a.g} ${a.b} 1</color></reflective><reflectivity><float>${l}</float></reflectivity>${h}</${r}></technique>`,u=`<effect id="${t}-effect"><profile_COMMON>${e.map?`<newparam sid="diffuse-surface"><surface type="2D"><init_from>${this.processTexture(e.map)}</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>`:""}${e.specularMap?`<newparam sid="specular-surface"><surface type="2D"><init_from>${this.processTexture(e.specularMap)}</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>`:""}${e.emissiveMap?`<newparam sid="emissive-surface"><surface type="2D"><init_from>${this.processTexture(e.emissiveMap)}</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>`:""}${e.normalMap?`<newparam sid="bump-surface"><surface type="2D"><init_from>${this.processTexture(e.normalMap)}</init_from></surface></newparam><newparam sid="bump-sampler"><sampler2D><source>bump-surface</source></sampler2D></newparam>`:""}${c}${e.side===ee.ehD?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':""}</profile_COMMON></effect>`,d=e.name?` name="${e.name}"`:"",m=`<material id="${t}"${d}><instance_effect url="#${t}-effect" /></material>`;this.libraryMaterials.push(m),this.libraryEffects.push(u),this.materialMap.set(e,t)}}return t}processObject(e){let t=`<node name="${e.name}">`;if(t+=this.getTransform(e),new ee.Kj0().geometry,e instanceof ee.Kj0&&e.isMesh&&null!==e.geometry){let r=this.processGeometry(e.geometry),n=r.meshid,a=r.bufferGeometry,s=null,o=e.material||new ee.vBJ,l=Array.isArray(o)?o:[o];s=(a.groups.length>l.length?Array(a.groups.length):Array(l.length)).fill(null).map((e,t)=>this.processMaterial(l[t%l.length])),t+=`${`<instance_geometry url="#${n}">`+(null!=s?`<bind_material><technique_common>${s.map((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>`).join("")}</technique_common></bind_material>`:"")}</instance_geometry>`}return e.children.forEach(e=>t+=this.processObject(e)),t+="</node>"}}var rg=r(80411),rv=Object.defineProperty,ry=(e,t,r)=>t in e?rv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rx=(e,t,r)=>(ry(e,"symbol"!=typeof t?t+"":t,r),r);class rb{constructor(){rx(this,"u2sTable")}parseVpd(e,t,r){if(!0!==e.isSkinnedMesh)return console.warn("THREE.MMDExporter: parseVpd() requires SkinnedMesh instance."),null;function n(e){let t=[];for(let r=0,n=e.length;r<n;r++)t.push(function(e){1e-6>Math.abs(e)&&(e=0);let t=e.toString();-1===t.indexOf(".")&&(t+=".");let r=(t+="000000").indexOf(".");return t.slice(0,r)+"."+t.slice(r+1,r+7)}(e[r]));return t.join(",")}e.updateMatrixWorld(!0);let a=e.skeleton.bones,s=this.getBindBones(e),o=new ee.Pa4,l=new ee._fP,h=new ee._fP,c=new ee.yGw,u=[];u.push("Vocaloid Pose Data file"),u.push(""),u.push((""!==e.name?e.name.replace(/\s/g,"_"):"skin")+".osm;"),u.push(a.length+";"),u.push("");for(let e=0,t=a.length;e<t;e++){let t=a[e],d=s[e];!0===r&&void 0!==t.userData.ik&&void 0!==t.userData.ik.originalMatrix?c.fromArray(t.userData.ik.originalMatrix):c.copy(t.matrix),o.setFromMatrixPosition(c),l.setFromRotationMatrix(c);let m=o.sub(d.position).toArray(),p=h.copy(d.quaternion).conjugate().multiply(l).toArray();m[2]=-m[2],p[0]=-p[0],p[1]=-p[1],u.push("Bone"+e+"{"+t.name),u.push("  "+n(m)+";"),u.push("  "+n(p)+";"),u.push("}"),u.push("")}u.push("");let d=u.join("\n");return!0===t?this.unicodeToShiftjis(d):d}unicodeToShiftjis(e){if(void 0===this.u2sTable){let e=new rg.X().s2uTable;this.u2sTable={};let t=Object.keys(e);for(let r=0,n=t.length;r<n;r++){let n=t[r],a=e[n];this.u2sTable[a]=parseInt(n)}}let t=[];for(let r=0,n=e.length;r<n;r++){let n=e.charCodeAt(r),a=this.u2sTable[n];if(void 0===a)throw"cannot convert charcode 0x"+n.toString(16);a>255&&t.push(a>>8&255),t.push(255&a)}return new Uint8Array(t)}getBindBones(e){let t=e.clone();return t.pose(),t.skeleton.bones}}var rw=Object.defineProperty,rC=(e,t,r)=>t in e?rw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rE=(e,t,r)=>(rC(e,"symbol"!=typeof t?t+"":t,r),r);let rI=e=>e.isMesh;class rM{constructor(){rE(this,"binary",!1),rE(this,"output",""),rE(this,"offset",80),rE(this,"objects",[]),rE(this,"triangles",0),rE(this,"vA",new ee.Pa4),rE(this,"vB",new ee.Pa4),rE(this,"vC",new ee.Pa4),rE(this,"cb",new ee.Pa4),rE(this,"ab",new ee.Pa4),rE(this,"normal",new ee.Pa4)}parse(e,t){if(this.binary=(null==t?void 0:t.binary)!==void 0&&(null==t?void 0:t.binary),e.traverse(e=>{if(rI(e)){let t=e.geometry;if(!t.isBufferGeometry)throw Error("THREE.STLExporter: Geometry is not of type THREE.BufferGeometry.");let r=t.index,n=t.getAttribute("position")||null;n&&(this.triangles+=null!==r?r.count/3:n.count/3,this.objects.push({object3d:e,geometry:t}))}}),this.binary){let e=new ArrayBuffer(2*this.triangles+48*this.triangles+80+4);this.output=new DataView(e),this.output.setUint32(this.offset,this.triangles,!0),this.offset+=4}else this.output="",this.output+="solid exported\n";for(let e=0,t=this.objects.length;e<t;e++){let t=this.objects[e].object3d,r=this.objects[e].geometry,n=r.index,a=r.getAttribute("position");if(null!==n)for(let e=0;e<n.count;e+=3){let r=n.getX(e+0),s=n.getX(e+1),o=n.getX(e+2);this.writeFace(r,s,o,a,t)}else for(let e=0;e<a.count;e+=3){let r=e+0,n=e+1,s=e+2;this.writeFace(r,n,s,a,t)}}return this.binary||(this.output+="endsolid exported\n"),this.output}writeFace(e,t,r,n,a){this.vA.fromBufferAttribute(n,e),this.vB.fromBufferAttribute(n,t),this.vC.fromBufferAttribute(n,r),a.isSkinnedMesh&&("applyBoneTransform"in a?(a.applyBoneTransform(e,this.vA),a.applyBoneTransform(t,this.vB),a.applyBoneTransform(r,this.vC)):(a.boneTransform(e,this.vA),a.boneTransform(t,this.vB),a.boneTransform(r,this.vC))),this.vA.applyMatrix4(a.matrixWorld),this.vB.applyMatrix4(a.matrixWorld),this.vC.applyMatrix4(a.matrixWorld),this.writeNormal(this.vA,this.vB,this.vC),this.writeVertex(this.vA),this.writeVertex(this.vB),this.writeVertex(this.vC),this.binary&&this.output instanceof DataView?(this.output.setUint16(this.offset,0,!0),this.offset+=2):(this.output+="		endloop\n",this.output+="	endfacet\n")}writeNormal(e,t,r){this.cb.subVectors(r,t),this.ab.subVectors(e,t),this.cb.cross(this.ab).normalize(),this.normal.copy(this.cb).normalize(),this.binary&&this.output instanceof DataView?(this.output.setFloat32(this.offset,this.normal.x,!0),this.offset+=4,this.output.setFloat32(this.offset,this.normal.y,!0),this.offset+=4,this.output.setFloat32(this.offset,this.normal.z,!0),this.offset+=4):(this.output+=`	facet normal ${this.normal.x} ${this.normal.y} ${this.normal.z}
`,this.output+="		outer loop\n")}writeVertex(e){this.binary&&this.output instanceof DataView?(this.output.setFloat32(this.offset,e.x,!0),this.offset+=4,this.output.setFloat32(this.offset,e.y,!0),this.offset+=4,this.output.setFloat32(this.offset,e.z,!0),this.offset+=4):this.output+=`			vertex ${e.x} ${e.y} ${e.z}
`}}var rB=Object.defineProperty,rS=(e,t,r)=>t in e?rB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rT=(e,t,r)=>(rS(e,"symbol"!=typeof t?t+"":t,r),r);class rF{constructor(){rT(this,"output"),rT(this,"indexVertex"),rT(this,"indexVertexUvs"),rT(this,"indexNormals"),rT(this,"vertex"),rT(this,"color"),rT(this,"normal"),rT(this,"uv"),rT(this,"face"),this.output="",this.indexVertex=0,this.indexVertexUvs=0,this.indexNormals=0,this.vertex=new ee.Pa4,this.color=new ee.Ilk,this.normal=new ee.Pa4,this.uv=new ee.FM8,this.face=[]}parse(e){return e.traverse(e=>{e instanceof ee.Kj0&&e.isMesh&&this.parseMesh(e),e instanceof ee.x12&&e.isLine&&this.parseLine(e),e instanceof ee.woe&&e.isPoints&&this.parsePoints(e)}),this.output}parseMesh(e){let t=0,r=0,n=0,a=e.geometry,s=new ee.Vkp;if(!a.isBufferGeometry)throw Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");let o=a.getAttribute("position"),l=a.getAttribute("normal"),h=a.getAttribute("uv"),c=a.getIndex();if(this.output+=`o ${e.name}
`,e.material&&!Array.isArray(e.material)&&e.material.name&&(this.output+=`usemtl ${e.material.name}
`),void 0!==o)for(let r=0,n=o.count;r<n;r++,t++)this.vertex.x=o.getX(r),this.vertex.y=o.getY(r),this.vertex.z=o.getZ(r),this.vertex.applyMatrix4(e.matrixWorld),this.output+=`v ${this.vertex.x} ${this.vertex.y} ${this.vertex.z}
`;if(void 0!==h)for(let e=0,t=h.count;e<t;e++,n++)this.uv.x=h.getX(e),this.uv.y=h.getY(e),this.output+=`vt ${this.uv.x} ${this.uv.y}
`;if(void 0!==l){s.getNormalMatrix(e.matrixWorld);for(let e=0,t=l.count;e<t;e++,r++)this.normal.x=l.getX(e),this.normal.y=l.getY(e),this.normal.z=l.getZ(e),this.normal.applyMatrix3(s).normalize(),this.output+=`vn ${this.normal.x} ${this.normal.y} ${this.normal.z}
`}if(null!==c)for(let e=0,t=c.count;e<t;e+=3){for(let t=0;t<3;t++){let r=c.getX(e+t)+1;this.face[t]=this.indexVertex+r+(l||h?`/${h?this.indexVertexUvs+r:""}${l?`/${this.indexNormals+r}`:""}`:"")}this.output+=`f ${this.face.join(" ")}
`}else for(let e=0,t=o.count;e<t;e+=3){for(let t=0;t<3;t++){let r=e+t+1;this.face[t]=this.indexVertex+r+(l||h?`/${h?this.indexVertexUvs+r:""}${l?`/${this.indexNormals+r}`:""}`:"")}this.output+=`f ${this.face.join(" ")}
`}this.indexVertex+=t,this.indexVertexUvs+=n,this.indexNormals+=r}parseLine(e){let t=0,r=e.geometry,n=e.type;if(r.isBufferGeometry)throw Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");let a=r.getAttribute("position");if(this.output+=`o ${e.name}
`,void 0!==a)for(let r=0,n=a.count;r<n;r++,t++)this.vertex.x=a.getX(r),this.vertex.y=a.getY(r),this.vertex.z=a.getZ(r),this.vertex.applyMatrix4(e.matrixWorld),this.output+=`v ${this.vertex.x} ${this.vertex.y} ${this.vertex.z}
`;if("Line"===n){this.output+="l ";for(let e=1,t=a.count;e<=t;e++)this.output+=`${this.indexVertex+e} `;this.output+="\n"}if("LineSegments"===n)for(let e=1,t=e+1,r=a.count;e<r;e+=2,t=e+1)this.output+=`l ${this.indexVertex+e} ${this.indexVertex+t}
`;this.indexVertex+=t}parsePoints(e){let t=0,r=e.geometry;if(!r.isBufferGeometry)throw Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.");let n=r.getAttribute("position"),a=r.getAttribute("color");if(this.output+=`o ${e.name}
`,void 0!==n)for(let r=0,s=n.count;r<s;r++,t++)this.vertex.fromBufferAttribute(n,r),this.vertex.applyMatrix4(e.matrixWorld),this.output+=`v ${this.vertex.x} ${this.vertex.y} ${this.vertex.z}`,void 0!==a&&a instanceof ee.TlE&&(this.color.fromBufferAttribute(a,r),this.output+=` ${this.color.r} ${this.color.g} ${this.color.b}`),this.output+="\n";this.output+="p ";for(let e=1,t=n.count;e<=t;e++)this.output+=`${this.indexVertex+e} `;this.output+="\n",this.indexVertex+=t}}function rP(){let e=new ee.xsS,t=new ee.DvJ;t.deleteAttribute("uv");let r=new ee.Wid({side:ee._Li}),n=new ee.Wid,a=new ee.cek(16777215,5,28,2);a.position.set(.418,16.199,.3),e.add(a);let s=new ee.Kj0(t,r);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),e.add(s);let o=new ee.Kj0(t,n);o.position.set(-10.906,2.009,1.846),o.rotation.set(0,-.195,0),o.scale.set(2.328,7.905,4.651),e.add(o);let l=new ee.Kj0(t,n);l.position.set(-5.607,-.754,-.758),l.rotation.set(0,.994,0),l.scale.set(1.97,1.534,3.955),e.add(l);let h=new ee.Kj0(t,n);h.position.set(6.167,.857,7.803),h.rotation.set(0,.561,0),h.scale.set(3.927,6.285,3.687),e.add(h);let c=new ee.Kj0(t,n);c.position.set(-2.017,.018,6.124),c.rotation.set(0,.333,0),c.scale.set(2.002,4.566,2.064),e.add(c);let u=new ee.Kj0(t,n);u.position.set(2.291,-.756,-2.621),u.rotation.set(0,-.286,0),u.scale.set(1.546,1.552,1.496),e.add(u);let d=new ee.Kj0(t,n);d.position.set(-2.193,-.369,-5.547),d.rotation.set(0,.516,0),d.scale.set(3.875,3.487,2.986),e.add(d);let m=new ee.Kj0(t,y(50));m.position.set(-16.116,14.37,8.208),m.scale.set(.1,2.428,2.739),e.add(m);let p=new ee.Kj0(t,y(50));p.position.set(-16.109,18.021,-8.207),p.scale.set(.1,2.425,2.751),e.add(p);let A=new ee.Kj0(t,y(17));A.position.set(14.904,12.198,-1.832),A.scale.set(.15,4.265,6.331),e.add(A);let f=new ee.Kj0(t,y(43));f.position.set(-.462,8.89,14.52),f.scale.set(4.38,5.441,.088),e.add(f);let g=new ee.Kj0(t,y(20));g.position.set(3.235,11.486,-12.541),g.scale.set(2.5,2,.1),e.add(g);let v=new ee.Kj0(t,y(100));function y(e){let t=new ee.vBJ;return t.color.setScalar(e),t}return v.position.set(0,20,0),v.scale.set(1,.1,1),e.add(v),e}class r_{static CreateRotationAnimation(e,t="x"){let r=new ee.dUE(".rotation["+t+"]",[0,e],[0,360]);return new ee.m7l(null,e,[r])}static CreateScaleAxisAnimation(e,t="x"){let r=new ee.dUE(".scale["+t+"]",[0,e],[0,1]);return new ee.m7l(null,e,[r])}static CreateShakeAnimation(e,t){let r=[],n=[],a=new ee.Pa4;for(let s=0;s<10*e;s++)r.push(s/10),a.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(t).toArray(n,n.length);let s=new ee.yC1(".position",r,n);return new ee.m7l(null,e,[s])}static CreatePulsationAnimation(e,t){let r=[],n=[],a=new ee.Pa4;for(let s=0;s<10*e;s++){r.push(s/10);let e=Math.random()*t;a.set(e,e,e).toArray(n,n.length)}let s=new ee.yC1(".scale",r,n);return new ee.m7l(null,e,[s])}static CreateVisibilityAnimation(e){let t=new ee._YM(".visible",[0,e/2,e],[!0,!1,!0]);return new ee.m7l(null,e,[t])}static CreateMaterialColorAnimation(e,t){let r=[],n=[],a=e/t.length;for(let e=0;e<t.length;e++){r.push(e*a);let s=t[e];n.push(s.r,s.g,s.b)}let s=new ee.R2R(".material.color",r,n);return new ee.m7l(null,e,[s])}}let rD=new ee._fP,rR=new ee.Pa4,rL=new ee.Pa4,rN=new ee.Pa4,rk=new ee.Pa4,rU=new ee.Pa4,rQ=new ee._fP,rO=new ee.Pa4,rG=new ee.Pa4,rH=new ee.Pa4,rz=new ee.yGw;class rV{constructor(e,t=[]){this.mesh=e,this.iks=t,this._valid()}update(){let e=this.iks;for(let t=0,r=e.length;t<r;t++)this.updateOne(e[t]);return this}updateOne(e){let t=this.mesh.skeleton.bones,r=Math,n=t[e.effector],a=t[e.target];rR.setFromMatrixPosition(a.matrixWorld);let s=e.links,o=void 0!==e.iteration?e.iteration:1;for(let a=0;a<o;a++){let a=!1;for(let o=0,l=s.length;o<l;o++){let l=t[s[o].index];if(!1===s[o].enabled)break;let h=s[o].limitation,c=s[o].rotationMin,u=s[o].rotationMax;l.matrixWorld.decompose(rU,rQ,rO),rQ.invert(),rN.setFromMatrixPosition(n.matrixWorld),rk.subVectors(rN,rU),rk.applyQuaternion(rQ),rk.normalize(),rL.subVectors(rR,rU),rL.applyQuaternion(rQ),rL.normalize();let d=rL.dot(rk);if(d>1?d=1:d<-1&&(d=-1),!((d=r.acos(d))<1e-5)){if(void 0!==e.minAngle&&d<e.minAngle&&(d=e.minAngle),void 0!==e.maxAngle&&d>e.maxAngle&&(d=e.maxAngle),rG.crossVectors(rk,rL),rG.normalize(),rD.setFromAxisAngle(rG,d),l.quaternion.multiply(rD),void 0!==h){let e=l.quaternion.w;e>1&&(e=1);let t=r.sqrt(1-e*e);l.quaternion.set(h.x*t,h.y*t,h.z*t,e)}void 0!==c&&l.rotation.setFromVector3(rH.setFromEuler(l.rotation).max(c)),void 0!==u&&l.rotation.setFromVector3(rH.setFromEuler(l.rotation).min(u)),l.updateMatrixWorld(!0),a=!0}}if(!a)break}return this}createHelper(){return new rX(this.mesh,this.iks)}_valid(){let e=this.iks,t=this.mesh.skeleton.bones;for(let r=0,n=e.length;r<n;r++){let n,a;let s=e[r],o=t[s.effector],l=s.links;n=o;for(let e=0,r=l.length;e<r;e++)a=t[l[e].index],n.parent!==a&&console.warn("THREE.CCDIKSolver: bone "+n.name+" is not the child of bone "+a.name),n=a}}}function rj(e,t){return rH.setFromMatrixPosition(e.matrixWorld).applyMatrix4(t)}function rW(e,t,r,n){let a=rj(r,n);e[3*t+0]=a.x,e[3*t+1]=a.y,e[3*t+2]=a.z}class rX extends ee.Tme{constructor(e,t=[],r=.25){super(),this.root=e,this.iks=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new ee.xo$(r,16,8),this.targetSphereMaterial=new ee.vBJ({color:new ee.Ilk(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new ee.vBJ({color:new ee.Ilk(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new ee.vBJ({color:new ee.Ilk(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new ee.nls({color:new ee.Ilk(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}updateMatrixWorld(e){let t=this.root;if(this.visible){let e=0,r=this.iks,n=t.skeleton.bones;rz.copy(t.matrixWorld).invert();for(let t=0,a=r.length;t<a;t++){let a=r[t],s=n[a.target],o=n[a.effector],l=this.children[e++],h=this.children[e++];l.position.copy(rj(s,rz)),h.position.copy(rj(o,rz));for(let t=0,r=a.links.length;t<r;t++){let r=n[a.links[t].index];this.children[e++].position.copy(rj(r,rz))}let c=this.children[e++],u=c.geometry.attributes.position.array;rW(u,0,s,rz),rW(u,1,o,rz);for(let e=0,t=a.links.length;e<t;e++){let t=n[a.links[e].index];rW(u,e+2,t,rz)}c.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(t.matrixWorld),super.updateMatrixWorld(e)}dispose(){this.sphereGeometry.dispose(),this.targetSphereMaterial.dispose(),this.effectorSphereMaterial.dispose(),this.linkSphereMaterial.dispose(),this.lineMaterial.dispose();let e=this.children;for(let t=0;t<e.length;t++){let r=e[t];r.isLine&&r.geometry.dispose()}}_init(){let e=this.iks;for(let t=0,r=e.length;t<r;t++){let r=e[t];this.add(new ee.Kj0(this.sphereGeometry,this.targetSphereMaterial)),this.add(new ee.Kj0(this.sphereGeometry,this.effectorSphereMaterial));for(let e=0,t=r.links.length;e<t;e++)this.add(new ee.Kj0(this.sphereGeometry,this.linkSphereMaterial));this.add(new ee.x12(function(e){let t=new ee.u9r,r=new Float32Array((2+e.links.length)*3);return t.setAttribute("position",new ee.TlE(r,3)),t}(r),this.lineMaterial))}}}class rY extends ee.p7y{constructor(e=1,t=1,r=4,n=8){let a=new ee.y$t;a.absarc(0,-t/2,e,1.5*Math.PI,0),a.absarc(0,t/2,e,0,.5*Math.PI),super(a.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:r,radialSegments:n}}static fromJSON(e){return new rY(e.radius,e.length,e.capSegments,e.radialSegments)}}class rK{constructor(e,t,r=[],n={}){if("undefined"==typeof Ammo)throw Error("THREE.MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");this.manager=new rJ,this.mesh=e,this.unitStep=void 0!==n.unitStep?n.unitStep:1/65,this.maxStepNum=void 0!==n.maxStepNum?n.maxStepNum:3,this.gravity=new ee.Pa4(0,-98,0),void 0!==n.gravity&&this.gravity.copy(n.gravity),this.world=void 0!==n.world?n.world:null,this.bodies=[],this.constraints=[],this._init(e,t,r)}update(e){let t;let r=this.manager,n=this.mesh,a=!1,s=r.allocThreeVector3(),o=r.allocThreeQuaternion(),l=r.allocThreeVector3();return n.matrixWorld.decompose(s,o,l),(1!==l.x||1!==l.y||1!==l.z)&&(a=!0),a&&(null!==(t=n.parent)&&(n.parent=null),l.copy(this.mesh.scale),n.scale.set(1,1,1),n.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(e),this._updateBones(),a&&(null!==t&&(n.parent=t),n.scale.copy(l)),r.freeThreeVector3(l),r.freeThreeQuaternion(o),r.freeThreeVector3(s),this}reset(){for(let e=0,t=this.bodies.length;e<t;e++)this.bodies[e].reset();return this}warmup(e){for(let t=0;t<e;t++)this.update(1/60);return this}setGravity(e){return this.world.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),this.gravity.copy(e),this}createHelper(){return new r3(this.mesh,this)}_init(e,t,r){let n=this.manager,a=e.parent;null!==a&&(e.parent=null);let s=n.allocThreeVector3(),o=n.allocThreeQuaternion(),l=n.allocThreeVector3();s.copy(e.position),o.copy(e.quaternion),l.copy(e.scale),e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrixWorld(!0),null===this.world&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(t),this._initConstraints(r),null!==a&&(e.parent=a),e.position.copy(s),e.quaternion.copy(o),e.scale.copy(l),e.updateMatrixWorld(!0),this.reset(),n.freeThreeVector3(s),n.freeThreeQuaternion(o),n.freeThreeVector3(l)}_createWorld(){let e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(t,r,n,e)}_initRigidBodies(e){for(let t=0,r=e.length;t<r;t++)this.bodies.push(new rq(this.mesh,this.world,e[t],this.manager))}_initConstraints(e){for(let t=0,r=e.length;t<r;t++){let r=e[t],n=this.bodies[r.rigidBodyIndex1],a=this.bodies[r.rigidBodyIndex2];this.constraints.push(new rZ(this.mesh,this.world,n,a,r,this.manager))}}_stepSimulation(e){let t=this.unitStep,r=e,n=(e/t|0)+1;r<t&&(r=t,n=1),n>this.maxStepNum&&(n=this.maxStepNum),this.world.stepSimulation(r,n,t)}_updateRigidBodies(){for(let e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateFromBone()}_updateBones(){for(let e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateBone()}}class rJ{constructor(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}allocThreeVector3(){return this.threeVector3s.length>0?this.threeVector3s.pop():new ee.Pa4}freeThreeVector3(e){this.threeVector3s.push(e)}allocThreeMatrix4(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new ee.yGw}freeThreeMatrix4(e){this.threeMatrix4s.push(e)}allocThreeQuaternion(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new ee._fP}freeThreeQuaternion(e){this.threeQuaternions.push(e)}allocThreeEuler(){return this.threeEulers.length>0?this.threeEulers.pop():new ee.USm}freeThreeEuler(e){this.threeEulers.push(e)}allocTransform(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform}freeTransform(e){this.transforms.push(e)}allocQuaternion(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion}freeQuaternion(e){this.quaternions.push(e)}allocVector3(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3}freeVector3(e){this.vector3s.push(e)}setIdentity(e){e.setIdentity()}getBasis(e){var t=this.allocQuaternion();return e.getBasis().getRotation(t),t}getBasisAsMatrix3(e){var t=this.getBasis(e),r=this.quaternionToMatrix3(t);return this.freeQuaternion(t),r}getOrigin(e){return e.getOrigin()}setOrigin(e,t){e.getOrigin().setValue(t.x(),t.y(),t.z())}copyOrigin(e,t){var r=t.getOrigin();this.setOrigin(e,r)}setBasis(e,t){e.setRotation(t)}setBasisFromMatrix3(e,t){var r=this.matrix3ToQuaternion(t);this.setBasis(e,r),this.freeQuaternion(r)}setOriginFromArray3(e,t){e.getOrigin().setValue(t[0],t[1],t[2])}setOriginFromThreeVector3(e,t){e.getOrigin().setValue(t.x,t.y,t.z)}setBasisFromArray3(e,t){var r=this.allocThreeQuaternion(),n=this.allocThreeEuler();n.set(t[0],t[1],t[2]),this.setBasisFromThreeQuaternion(e,r.setFromEuler(n)),this.freeThreeEuler(n),this.freeThreeQuaternion(r)}setBasisFromThreeQuaternion(e,t){var r=this.allocQuaternion();r.setX(t.x),r.setY(t.y),r.setZ(t.z),r.setW(t.w),this.setBasis(e,r),this.freeQuaternion(r)}multiplyTransforms(e,t){var r=this.allocTransform();this.setIdentity(r);var n=this.getBasisAsMatrix3(e),a=this.getBasisAsMatrix3(t),s=this.getOrigin(e),o=this.getOrigin(t),l=this.multiplyMatrix3ByVector3(n,o),h=this.addVector3(l,s);this.setOrigin(r,h);var c=this.multiplyMatrices3(n,a);return this.setBasisFromMatrix3(r,c),this.freeVector3(l),this.freeVector3(h),r}inverseTransform(e){var t=this.allocTransform(),r=this.getBasisAsMatrix3(e),n=this.getOrigin(e),a=this.transposeMatrix3(r),s=this.negativeVector3(n),o=this.multiplyMatrix3ByVector3(a,s);return this.setOrigin(t,o),this.setBasisFromMatrix3(t,a),this.freeVector3(s),this.freeVector3(o),t}multiplyMatrices3(e,t){var r=[],n=this.rowOfMatrix3(e,0),a=this.rowOfMatrix3(e,1),s=this.rowOfMatrix3(e,2),o=this.columnOfMatrix3(t,0),l=this.columnOfMatrix3(t,1),h=this.columnOfMatrix3(t,2);return r[0]=this.dotVectors3(n,o),r[1]=this.dotVectors3(n,l),r[2]=this.dotVectors3(n,h),r[3]=this.dotVectors3(a,o),r[4]=this.dotVectors3(a,l),r[5]=this.dotVectors3(a,h),r[6]=this.dotVectors3(s,o),r[7]=this.dotVectors3(s,l),r[8]=this.dotVectors3(s,h),this.freeVector3(n),this.freeVector3(a),this.freeVector3(s),this.freeVector3(o),this.freeVector3(l),this.freeVector3(h),r}addVector3(e,t){var r=this.allocVector3();return r.setValue(e.x()+t.x(),e.y()+t.y(),e.z()+t.z()),r}dotVectors3(e,t){return e.x()*t.x()+e.y()*t.y()+e.z()*t.z()}rowOfMatrix3(e,t){var r=this.allocVector3();return r.setValue(e[3*t+0],e[3*t+1],e[3*t+2]),r}columnOfMatrix3(e,t){var r=this.allocVector3();return r.setValue(e[t+0],e[t+3],e[t+6]),r}negativeVector3(e){var t=this.allocVector3();return t.setValue(-e.x(),-e.y(),-e.z()),t}multiplyMatrix3ByVector3(e,t){var r=this.allocVector3(),n=this.rowOfMatrix3(e,0),a=this.rowOfMatrix3(e,1),s=this.rowOfMatrix3(e,2),o=this.dotVectors3(n,t),l=this.dotVectors3(a,t),h=this.dotVectors3(s,t);return r.setValue(o,l,h),this.freeVector3(n),this.freeVector3(a),this.freeVector3(s),r}transposeMatrix3(e){var t=[];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t}quaternionToMatrix3(e){var t=[],r=e.x(),n=e.y(),a=e.z(),s=e.w(),o=r*r,l=n*n,h=a*a,c=r*n,u=n*a,d=a*r,m=r*s,p=n*s,A=a*s;return t[0]=1-2*(l+h),t[1]=2*(c-A),t[2]=2*(d+p),t[3]=2*(c+A),t[4]=1-2*(h+o),t[5]=2*(u-m),t[6]=2*(d-p),t[7]=2*(u+m),t[8]=1-2*(o+l),t}matrix3ToQuaternion(e){var t,r,n,a,s,o=e[0]+e[4]+e[8];o>0?(s=.25*(t=2*Math.sqrt(o+1)),r=(e[7]-e[5])/t,n=(e[2]-e[6])/t,a=(e[3]-e[1])/t):e[0]>e[4]&&e[0]>e[8]?(t=2*Math.sqrt(1+e[0]-e[4]-e[8]),s=(e[7]-e[5])/t,r=.25*t,n=(e[1]+e[3])/t,a=(e[2]+e[6])/t):e[4]>e[8]?(t=2*Math.sqrt(1+e[4]-e[0]-e[8]),s=(e[2]-e[6])/t,r=(e[1]+e[3])/t,n=.25*t,a=(e[5]+e[7])/t):(t=2*Math.sqrt(1+e[8]-e[0]-e[4]),s=(e[3]-e[1])/t,r=(e[2]+e[6])/t,n=(e[5]+e[7])/t,a=.25*t);var l=this.allocQuaternion();return l.setX(r),l.setY(n),l.setZ(a),l.setW(s),l}}class rq{constructor(e,t,r,n){this.mesh=e,this.world=t,this.params=r,this.manager=n,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}reset(){return this._setTransformFromBone(),this}updateFromBone(){return -1!==this.params.boneIndex&&0===this.params.type&&this._setTransformFromBone(),this}updateBone(){return 0===this.params.type||-1===this.params.boneIndex||(this._updateBoneRotation(),1===this.params.type&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this._setPositionFromBone()),this}_init(){let e=this.manager,t=this.params,r=this.mesh.skeleton.bones,n=-1===t.boneIndex?new ee.N$j:r[t.boneIndex],a=function(e){switch(e.shapeType){case 0:return new Ammo.btSphereShape(e.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(e.width,e.height,e.depth));case 2:return new Ammo.btCapsuleShape(e.width,e.height);default:throw Error("unknown shape type "+e.shapeType)}}(t),s=0===t.type?0:t.weight,o=e.allocVector3();o.setValue(0,0,0),0!==s&&a.calculateLocalInertia(s,o);let l=e.allocTransform();e.setIdentity(l),e.setOriginFromArray3(l,t.position),e.setBasisFromArray3(l,t.rotation);let h=e.allocThreeVector3(),c=e.allocTransform();e.setIdentity(c),e.setOriginFromThreeVector3(c,n.getWorldPosition(h));let u=e.multiplyTransforms(c,l),d=new Ammo.btDefaultMotionState(u),m=new Ammo.btRigidBodyConstructionInfo(s,d,a,o);m.set_m_friction(t.friction),m.set_m_restitution(t.restitution);let p=new Ammo.btRigidBody(m);0===t.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(t.positionDamping,t.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<t.groupIndex,t.groupTarget),this.body=p,this.bone=n,this.boneOffsetForm=l,this.boneOffsetFormInverse=e.inverseTransform(l),e.freeVector3(o),e.freeTransform(u),e.freeTransform(c),e.freeThreeVector3(h)}_getBoneTransform(){let e=this.manager,t=e.allocThreeVector3(),r=e.allocThreeQuaternion(),n=e.allocThreeVector3();this.bone.matrixWorld.decompose(t,r,n);let a=e.allocTransform();e.setOriginFromThreeVector3(a,t),e.setBasisFromThreeQuaternion(a,r);let s=e.multiplyTransforms(a,this.boneOffsetForm);return e.freeTransform(a),e.freeThreeVector3(n),e.freeThreeQuaternion(r),e.freeThreeVector3(t),s}_getWorldTransformForBone(){let e=this.manager,t=this.body.getCenterOfMassTransform();return e.multiplyTransforms(t,this.boneOffsetFormInverse)}_setTransformFromBone(){let e=this.manager,t=this._getBoneTransform();this.body.setCenterOfMassTransform(t),this.body.getMotionState().setWorldTransform(t),e.freeTransform(t)}_setPositionFromBone(){let e=this.manager,t=this._getBoneTransform(),r=e.allocTransform();this.body.getMotionState().getWorldTransform(r),e.copyOrigin(r,t),this.body.setCenterOfMassTransform(r),this.body.getMotionState().setWorldTransform(r),e.freeTransform(r),e.freeTransform(t)}_updateBoneRotation(){let e=this.manager,t=this._getWorldTransformForBone(),r=e.getBasis(t),n=e.allocThreeQuaternion(),a=e.allocThreeQuaternion(),s=e.allocThreeQuaternion();n.set(r.x(),r.y(),r.z(),r.w()),a.setFromRotationMatrix(this.bone.matrixWorld),a.conjugate(),a.multiply(n),s.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(a.multiply(s).normalize()),e.freeThreeQuaternion(n),e.freeThreeQuaternion(a),e.freeThreeQuaternion(s),e.freeQuaternion(r),e.freeTransform(t)}_updateBonePosition(){let e=this.manager,t=this._getWorldTransformForBone(),r=e.allocThreeVector3(),n=e.getOrigin(t);r.set(n.x(),n.y(),n.z()),this.bone.parent&&this.bone.parent.worldToLocal(r),this.bone.position.copy(r),e.freeThreeVector3(r),e.freeTransform(t)}}class rZ{constructor(e,t,r,n,a,s){this.mesh=e,this.world=t,this.bodyA=r,this.bodyB=n,this.params=a,this.manager=s,this.constraint=null,this._init()}_init(){let e=this.manager,t=this.params,r=this.bodyA,n=this.bodyB,a=e.allocTransform();e.setIdentity(a),e.setOriginFromArray3(a,t.position),e.setBasisFromArray3(a,t.rotation);let s=e.allocTransform(),o=e.allocTransform();r.body.getMotionState().getWorldTransform(s),n.body.getMotionState().getWorldTransform(o);let l=e.inverseTransform(s),h=e.inverseTransform(o),c=e.multiplyTransforms(l,a),u=e.multiplyTransforms(h,a),d=new Ammo.btGeneric6DofSpringConstraint(r.body,n.body,c,u,!0),m=e.allocVector3(),p=e.allocVector3(),A=e.allocVector3(),f=e.allocVector3();m.setValue(t.translationLimitation1[0],t.translationLimitation1[1],t.translationLimitation1[2]),p.setValue(t.translationLimitation2[0],t.translationLimitation2[1],t.translationLimitation2[2]),A.setValue(t.rotationLimitation1[0],t.rotationLimitation1[1],t.rotationLimitation1[2]),f.setValue(t.rotationLimitation2[0],t.rotationLimitation2[1],t.rotationLimitation2[2]),d.setLinearLowerLimit(m),d.setLinearUpperLimit(p),d.setAngularLowerLimit(A),d.setAngularUpperLimit(f);for(let e=0;e<3;e++)0!==t.springPosition[e]&&(d.enableSpring(e,!0),d.setStiffness(e,t.springPosition[e]));for(let e=0;e<3;e++)0!==t.springRotation[e]&&(d.enableSpring(e+3,!0),d.setStiffness(e+3,t.springRotation[e]));if(void 0!==d.setParam)for(let e=0;e<6;e++)d.setParam(2,.475,e);this.world.addConstraint(d,!0),this.constraint=d,e.freeTransform(a),e.freeTransform(s),e.freeTransform(o),e.freeTransform(l),e.freeTransform(h),e.freeTransform(c),e.freeTransform(u),e.freeVector3(m),e.freeVector3(p),e.freeVector3(A),e.freeVector3(f)}}let r$=new ee.Pa4,r0=new ee._fP,r1=new ee.Pa4,r2=new ee.yGw;class r3 extends ee.Tme{constructor(e,t){super(),this.root=e,this.physics=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new ee.vBJ({color:new ee.Ilk(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new ee.vBJ({color:new ee.Ilk(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new ee.vBJ({color:new ee.Ilk(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}dispose(){let e=this.materials,t=this.children;for(let t=0;t<e.length;t++)e[t].dispose();for(let e=0;e<t.length;e++){let r=t[e];r.isMesh&&r.geometry.dispose()}}updateMatrixWorld(e){var t=this.root;if(this.visible){var r=this.physics.bodies;r2.copy(t.matrixWorld).decompose(r$,r0,r1).compose(r$,r0,r1.set(1,1,1)).invert();for(var n=0,a=r.length;n<a;n++){var s=r[n].body,o=this.children[n],l=s.getCenterOfMassTransform(),h=l.getOrigin(),c=l.getRotation();o.position.set(h.x(),h.y(),h.z()).applyMatrix4(r2),o.quaternion.setFromRotationMatrix(r2).multiply(r0.set(c.x(),c.y(),c.z(),c.w()))}}this.matrix.copy(t.matrixWorld).decompose(r$,r0,r1).compose(r$,r0,r1.set(1,1,1)),super.updateMatrixWorld(e)}_init(){for(var e=this.physics.bodies,t=0,r=e.length;t<r;t++){var n=e[t].params;this.add(new ee.Kj0(function(e){switch(e.shapeType){case 0:return new ee.xo$(e.width,16,8);case 1:return new ee.DvJ(2*e.width,2*e.height,2*e.depth,8,8,8);case 2:return new rY(e.width,e.height,8,16);default:return null}}(n),this.materials[n.type]))}}}class r4{constructor(e={}){this.meshes=[],this.camera=null,this.cameraTarget=new ee.Tme,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:void 0===e.sync||e.sync,afterglow:void 0!==e.afterglow?e.afterglow:0,resetPhysicsOnLoop:void 0===e.resetPhysicsOnLoop||e.resetPhysicsOnLoop,pmxAnimation:void 0!==e.pmxAnimation&&e.pmxAnimation},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(){},this.sharedPhysics=!1,this.masterPhysics=null}add(e,t={}){if(e.isSkinnedMesh)this._addMesh(e,t);else if(e.isCamera)this._setupCamera(e,t);else if("Audio"===e.type)this._setupAudio(e,t);else throw Error("THREE.MMDAnimationHelper.add: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");return this.configuration.sync&&this._syncDuration(),this}remove(e){if(e.isSkinnedMesh)this._removeMesh(e);else if(e.isCamera)this._clearCamera(e);else if("Audio"===e.type)this._clearAudio(e);else throw Error("THREE.MMDAnimationHelper.remove: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");return this.configuration.sync&&this._syncDuration(),this}update(e){null!==this.audioManager&&this.audioManager.control(e);for(let t=0;t<this.meshes.length;t++)this._animateMesh(this.meshes[t],e);return this.sharedPhysics&&this._updateSharedPhysics(e),null!==this.camera&&this._animateCamera(this.camera,e),this}pose(e,t,r={}){!1!==r.resetPose&&e.pose();let n=e.skeleton.bones,a=t.bones,s={};for(let e=0,t=n.length;e<t;e++)s[n[e].name]=e;let o=new ee.Pa4,l=new ee._fP;for(let e=0,t=a.length;e<t;e++){let t=a[e],r=s[t.name];if(void 0===r)continue;let h=n[r];h.position.add(o.fromArray(t.translation)),h.quaternion.multiply(l.fromArray(t.quaternion))}if(e.updateMatrixWorld(!0),this.configuration.pmxAnimation&&e.geometry.userData.MMD&&"pmx"===e.geometry.userData.MMD.format){let t=this._sortBoneDataArray(e.geometry.userData.MMD.bones.slice()),n=!1!==r.ik?this._createCCDIKSolver(e):null,a=!1!==r.grant?this.createGrantSolver(e):null;this._animatePMXMesh(e,t,n,a)}else!1!==r.ik&&this._createCCDIKSolver(e).update(),!1!==r.grant&&this.createGrantSolver(e).update();return this}enable(e,t){if(void 0===this.enabled[e])throw Error("THREE.MMDAnimationHelper.enable: unknown key "+e);if(this.enabled[e]=t,"physics"===e)for(let e=0,r=this.meshes.length;e<r;e++)this._optimizeIK(this.meshes[e],t);return this}createGrantSolver(e){return new ne(e,e.geometry.userData.MMD.grants)}_addMesh(e,t){if(this.meshes.indexOf(e)>=0)throw Error("THREE.MMDAnimationHelper._addMesh: SkinnedMesh '"+e.name+"' has already been added.");return this.meshes.push(e),this.objects.set(e,{looped:!1}),this._setupMeshAnimation(e,t.animation),!1!==t.physics&&this._setupMeshPhysics(e,t),this}_setupCamera(e,t){if(this.camera===e)throw Error("THREE.MMDAnimationHelper._setupCamera: Camera '"+e.name+"' has already been set.");return this.camera&&this.clearCamera(this.camera),this.camera=e,e.add(this.cameraTarget),this.objects.set(e,{}),void 0!==t.animation&&this._setupCameraAnimation(e,t.animation),this}_setupAudio(e,t){if(this.audio===e)throw Error("THREE.MMDAnimationHelper._setupAudio: Audio '"+e.name+"' has already been set.");return this.audio&&this.clearAudio(this.audio),this.audio=e,this.audioManager=new r9(e,t),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this}_removeMesh(e){let t=!1,r=0;for(let n=0,a=this.meshes.length;n<a;n++){if(this.meshes[n]===e){this.objects.delete(e),t=!0;continue}this.meshes[r++]=this.meshes[n]}if(!t)throw Error("THREE.MMDAnimationHelper._removeMesh: SkinnedMesh '"+e.name+"' has not been added yet.");return this.meshes.length=r,this}_clearCamera(e){if(e!==this.camera)throw Error("THREE.MMDAnimationHelper._clearCamera: Camera '"+e.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this}_clearAudio(e){if(e!==this.audio)throw Error("THREE.MMDAnimationHelper._clearAudio: Audio '"+e.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this}_setupMeshAnimation(e,t){let r=this.objects.get(e);if(void 0!==t){let n=Array.isArray(t)?t:[t];r.mixer=new ee.Xcj(e);for(let e=0,t=n.length;e<t;e++)r.mixer.clipAction(n[e]).play();r.mixer.addEventListener("loop",function(e){let t=e.action._clip.tracks;t.length>0&&".bones"!==t[0].name.slice(0,6)||(r.looped=!0)})}return r.ikSolver=this._createCCDIKSolver(e),r.grantSolver=this.createGrantSolver(e),this}_setupCameraAnimation(e,t){let r=Array.isArray(t)?t:[t],n=this.objects.get(e);n.mixer=new ee.Xcj(e);for(let e=0,t=r.length;e<t;e++)n.mixer.clipAction(r[e]).play()}_setupMeshPhysics(e,t){let r=this.objects.get(e);if(void 0===t.world&&this.sharedPhysics){let e=this._getMasterPhysics();null!==e&&(world=e.world)}r.physics=this._createMMDPhysics(e,t),r.mixer&&!1!==t.animationWarmup&&(this._animateMesh(e,0),r.physics.reset()),r.physics.warmup(void 0!==t.warmup?t.warmup:60),this._optimizeIK(e,!0)}_animateMesh(e,t){let r=this.objects.get(e),n=r.mixer,a=r.ikSolver,s=r.grantSolver,o=r.physics,l=r.looped;n&&this.enabled.animation&&(this._restoreBones(e),n.update(t),this._saveBones(e),this.configuration.pmxAnimation&&e.geometry.userData.MMD&&"pmx"===e.geometry.userData.MMD.format?(r.sortedBonesData||(r.sortedBonesData=this._sortBoneDataArray(e.geometry.userData.MMD.bones.slice())),this._animatePMXMesh(e,r.sortedBonesData,a&&this.enabled.ik?a:null,s&&this.enabled.grant?s:null)):(a&&this.enabled.ik&&(e.updateMatrixWorld(!0),a.update()),s&&this.enabled.grant&&s.update())),!0===l&&this.enabled.physics&&(o&&this.configuration.resetPhysicsOnLoop&&o.reset(),r.looped=!1),o&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(e),o.update(t))}_sortBoneDataArray(e){return e.sort(function(e,t){return e.transformationClass!==t.transformationClass?e.transformationClass-t.transformationClass:e.index-t.index})}_animatePMXMesh(e,t,r,n){r8=0,r6.clear();for(let a=0,s=t.length;a<s;a++)!function e(t,r,n,a){let s=t.skeleton.bones,o=t.geometry.userData.MMD.bones[r],l=s[r];if(r6.has(r))return;let h=(r8>=r5.length&&r5.push(new ee._fP),r5[r8++]);if(r6.set(r,h.copy(l.quaternion)),a&&o.grant&&!o.grant.isLocal&&o.grant.affectRotation){let r=o.grant.parentIndex,s=o.grant.ratio;r6.has(r)||e(t,r,n,a),a.addGrantRotation(l,r6.get(r),s)}if(n&&o.ik){t.updateMatrixWorld(!0),n.updateOne(o.ik);let e=o.ik.links;for(let t=0,r=e.length;t<r;t++){let r=e[t];if(!1===r.enabled)continue;let n=r.index;r6.has(n)&&r6.set(n,r6.get(n).copy(s[n].quaternion))}}h.copy(l.quaternion)}(e,t[a].index,r,n);return e.updateMatrixWorld(!0),this}_animateCamera(e,t){let r=this.objects.get(e).mixer;r&&this.enabled.cameraAnimation&&(r.update(t),e.updateProjectionMatrix(),e.up.set(0,1,0),e.up.applyQuaternion(e.quaternion),e.lookAt(this.cameraTarget.position))}_optimizeIK(e,t){let r=e.geometry.userData.MMD.iks,n=e.geometry.userData.MMD.bones;for(let e=0,a=r.length;e<a;e++){let a=r[e].links;for(let e=0,r=a.length;e<r;e++){let r=a[e];!0===t?r.enabled=!(n[r.index].rigidBodyType>0):r.enabled=!0}}}_createCCDIKSolver(e){if(void 0===rV)throw Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new rV(e,e.geometry.userData.MMD.iks)}_createMMDPhysics(e,t){if(void 0===rK)throw Error("THREE.MMDPhysics: Import MMDPhysics.");return new rK(e,e.geometry.userData.MMD.rigidBodies,e.geometry.userData.MMD.constraints,t)}_syncDuration(){let e=0,t=this.objects,r=this.meshes,n=this.camera,a=this.audioManager;for(let n=0,a=r.length;n<a;n++){let a=this.objects.get(r[n]).mixer;if(void 0!==a)for(let r=0;r<a._actions.length;r++){let n=a._actions[r]._clip;t.has(n)||t.set(n,{duration:n.duration}),e=Math.max(e,t.get(n).duration)}}if(null!==n){let r=this.objects.get(n).mixer;if(void 0!==r)for(let n=0,a=r._actions.length;n<a;n++){let a=r._actions[n]._clip;t.has(a)||t.set(a,{duration:a.duration}),e=Math.max(e,t.get(a).duration)}}null!==a&&(e=Math.max(e,t.get(a).duration)),e+=this.configuration.afterglow;for(let t=0,r=this.meshes.length;t<r;t++){let r=this.objects.get(this.meshes[t]).mixer;if(void 0!==r)for(let t=0,n=r._actions.length;t<n;t++)r._actions[t]._clip.duration=e}if(null!==n){let t=this.objects.get(n).mixer;if(void 0!==t)for(let r=0,n=t._actions.length;r<n;r++)t._actions[r]._clip.duration=e}null!==a&&(a.duration=e)}_updatePropertyMixersBuffer(e){let t=this.objects.get(e).mixer,r=t._bindings,n=t._accuIndex;for(let e=0,t=r.length;e<t;e++){let t=r[e],a=t.buffer,s=(n+1)*t.valueSize;t.binding.getValue(a,s)}}_saveBones(e){let t=this.objects.get(e),r=e.skeleton.bones,n=t.backupBones;void 0===n&&(n=new Float32Array(7*r.length),t.backupBones=n);for(let e=0,t=r.length;e<t;e++){let t=r[e];t.position.toArray(n,7*e),t.quaternion.toArray(n,7*e+3)}}_restoreBones(e){let t=this.objects.get(e).backupBones;if(void 0===t)return;let r=e.skeleton.bones;for(let e=0,n=r.length;e<n;e++){let n=r[e];n.position.fromArray(t,7*e),n.quaternion.fromArray(t,7*e+3)}}_getMasterPhysics(){if(null!==this.masterPhysics)return this.masterPhysics;for(let e=0,t=this.meshes.length;e<t;e++){let t=this.meshes[e].physics;if(null!=t)return this.masterPhysics=t,this.masterPhysics}return null}_updateSharedPhysics(e){if(0===this.meshes.length||!this.enabled.physics||!this.sharedPhysics)return;let t=this._getMasterPhysics();if(null!==t){for(let e=0,t=this.meshes.length;e<t;e++){let t=this.meshes[e].physics;null!=t&&t.updateRigidBodies()}t.stepSimulation(e);for(let e=0,t=this.meshes.length;e<t;e++){let t=this.meshes[e].physics;null!=t&&t.updateBones()}}}}let r5=[],r8=0,r6=new Map;class r9{constructor(e,t={}){this.audio=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==t.delayTime?t.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}control(e){return this.elapsed+=e,this.currentTime+=e,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this}_shouldStartAudio(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&!(this.currentTime-this.delayTime>this.audioDuration)}_shouldStopAudio(){return this.audio.isPlaying&&this.currentTime>=this.duration}}let r7=new ee._fP;class ne{constructor(e,t=[]){this.mesh=e,this.grants=t}update(){let e=this.grants;for(let t=0,r=e.length;t<r;t++)this.updateOne(e[t]);return this}updateOne(e){let t=this.mesh.skeleton.bones,r=t[e.index],n=t[e.parentIndex];return e.isLocal?(e.affectPosition,e.affectRotation):(e.affectPosition,e.affectRotation&&this.addGrantRotation(r,n.quaternion,e.ratio)),this}addGrantRotation(e,t,r){return r7.set(0,0,0,1),r7.slerp(t,r),e.quaternion.multiply(r7),this}}var nt=Object.defineProperty,ni=(e,t,r)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,nr=(e,t,r)=>(ni(e,"symbol"!=typeof t?t+"":t,r),r);let nn="_batch_id_",na=new ee.yGw,ns=new ee.yGw().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),no=`
#ifdef BATCHING
	attribute float ${nn};
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {

		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );

	}
#endif
`,nl=`
#ifdef BATCHING
	mat4 batchingMatrix = getBatchingMatrix( ${nn} );
#endif
`,nh=`
#ifdef BATCHING
	objectNormal = vec4( batchingMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( batchingMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif
`,nc=`
#ifdef BATCHING
	transformed = ( batchingMatrix * vec4( transformed, 1.0 ) ).xyz;
#endif
`;class nu extends ee.Kj0{constructor(e,t,r=2*t,n){super(new ee.u9r,n),nr(this,"_vertexStarts"),nr(this,"_vertexCounts"),nr(this,"_indexStarts"),nr(this,"_indexCounts"),nr(this,"_reservedRanges"),nr(this,"_visible"),nr(this,"_active"),nr(this,"_maxGeometryCount"),nr(this,"_maxVertexCount"),nr(this,"_maxIndexCount"),nr(this,"_geometryInitialized"),nr(this,"_geometryCount"),nr(this,"_matrices"),nr(this,"_matricesTexture"),nr(this,"_customUniforms"),this._vertexStarts=[],this._vertexCounts=[],this._indexStarts=[],this._indexCounts=[],this._reservedRanges=[],this._visible=[],this._active=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._matrices=[],this._matricesTexture=null,this.frustumCulled=!1,this._customUniforms={batchingTexture:{value:null}},this._initMatricesTexture(),this._initShader(),this.onBeforeRender=function(){this.material.defines&&(this.material.defines.BATCHING=!0)},this.onAfterRender=function(){this.material.defines&&(this.material.defines.BATCHING=!1)}}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount),t=new Float32Array((e=Math.max(e=ee.M8C.ceilPowerOfTwo(e),4))*e*4),r=new ee.IEO(t,e,e,ee.wk1,ee.VzW);this._matricesTexture=r,this._customUniforms.batchingTexture.value=this._matricesTexture}_initShader(){let e=this.material,t=e.onBeforeCompile,r=this._customUniforms;e.onBeforeCompile=function(e,n){for(let t in e.vertexShader=e.vertexShader.replace("#include <skinning_pars_vertex>","#include <skinning_pars_vertex>\n"+no).replace("#include <uv_vertex>","#include <uv_vertex>\n"+nl).replace("#include <skinnormal_vertex>","#include <skinnormal_vertex>\n"+nh).replace("#include <skinning_vertex>","#include <skinning_vertex>\n"+nc),r)e.uniforms[t]=r[t];t.call(this,e,n)},e.defines=e.defines||{},e.defines.BATCHING=!1}_initializeGeometry(e){let t=this.geometry,r=this._maxVertexCount,n=this._maxGeometryCount,a=this._maxIndexCount;if(!1===this._geometryInitialized){for(let n in e.attributes){let a=e.getAttribute(n),{array:s,itemSize:o,normalized:l}=a,h=new s.constructor(r*o),c=new a.constructor(h,o,l);c.setUsage(a.usage),t.setAttribute(n,c)}if(null!==e.getIndex()){let e=r>65536?new Uint32Array(a):new Uint16Array(a);t.setIndex(new ee.TlE(e,1))}let s=n>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute(nn,new ee.TlE(s,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(nn))throw Error(`BatchedMesh: Geometry cannot use attribute "${nn}"`);let t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw Error('BatchedMesh: All geometries must consistently have "index".');for(let r in t.attributes){if(r===nn)continue;if(!e.hasAttribute(r))throw Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);let n=e.getAttribute(r),a=t.getAttribute(r);if(n.itemSize!==a.itemSize||n.normalized!==a.normalized)throw Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}getGeometryCount(){return this._geometryCount}getVertexCount(){let e=this._reservedRanges;if(0===e.length)return 0;{let t=e[e.length-1];return t.vertexStart+t.vertexCount}}getIndexCount(){let e=this._reservedRanges;if(null===this.geometry.getIndex()||0===e.length)return 0;{let t=e[e.length-1];return t.indexStart+t.indexCount}}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw Error("BatchedMesh: Maximum geometry count reached.");let n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1},a=null,s=this._reservedRanges;if(0!==this._geometryCount&&(a=s[s.length-1]),-1===t?n.vertexCount=e.getAttribute("position").count:n.vertexCount=t,null===a?n.vertexStart=0:n.vertexStart=a.vertexStart+a.vertexCount,null!==e.getIndex()&&(-1===r?n.indexCount=e.getIndex().count:n.indexCount=r,null===a?n.indexStart=0:n.indexStart=a.indexStart+a.indexCount),-1!==n.indexStart&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o=this._indexCounts,l=this._indexStarts,h=this._vertexCounts,c=this._vertexStarts,u=this._visible,d=this._active,m=this._matricesTexture,p=this._matrices,A=this._matricesTexture.image.data;u.push(!0),d.push(!0);let f=this._geometryCount;this._geometryCount++,p.push(new ee.yGw),na.toArray(A,16*f),m.needsUpdate=!0,s.push(n),c.push(n.vertexStart),h.push(n.vertexCount),null!==e.getIndex()&&(l.push(n.indexCount),o.push(n.indexCount));let g=this.geometry.getAttribute(nn);for(let e=0;e<n.vertexCount;e++)g.setX(n.vertexStart+e,f);return g.needsUpdate=!0,this.setGeometryAt(f,e),f}applyGeometry(e){return this.addGeometry(e)}setGeometryAt(e,t){if(e>=this._geometryCount)throw Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);let r=this._reservedRanges[e];if(null!==t.getIndex()&&t.getIndex().count>r.indexCount||t.attributes.position.count>r.vertexCount)throw Error("BatchedMesh: Reserved space not large enough for provided geometry.");let n=this.geometry,a=t.getAttribute("position"),s=null!==n.getIndex(),o=n.getIndex(),l=t.getIndex(),h=r.vertexStart,c=r.vertexCount;for(let e in n.attributes){if(e===nn)continue;let r=t.getAttribute(e),a=n.getAttribute(e);!function(e,t,r=0){let n=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){let a=e.count;for(let s=0;s<a;s++)for(let a=0;a<n;a++)t.setComponent(s+r,a,e.getComponent(s,a))}else t.array.set(e.array,r*n);t.needsUpdate=!0}(r,a,h);let s=r.itemSize;for(let e=r.count;e<c;e++){let t=h+e;for(let e=0;e<s;e++)a.setComponent(t,e,0)}a.needsUpdate=!0}if(this._vertexCounts[e]=a.count,s){let t=r.indexStart;for(let e=0;e<l.count;e++)o.setX(t+e,h+l.getX(e));for(let e=l.count,n=r.indexCount;e<n;e++)o.setX(t+e,h);o.needsUpdate=!0,this._indexCounts[e]=l.count}return e}deleteGeometry(e){let t=this._active,r=this._matricesTexture,n=r.image.data;return e>=t.length||!1===t[e]||(t[e]=!1,ns.toArray(n,16*e),r.needsUpdate=!0),this}optimize(){throw Error("BatchedMesh: Optimize function not implemented.")}setMatrixAt(e,t){let r=this._visible,n=this._active,a=this._matricesTexture,s=this._matrices,o=a.image.data;return e>=s.length||!1===n[e]||(!0===r[e]&&(t.toArray(o,16*e),a.needsUpdate=!0),s[e].copy(t)),this}getMatrixAt(e,t){let r=this._matrices,n=this._active;return e>=r.length||!1===n[e]?t:t.copy(r[e])}setVisibleAt(e,t){let r=this._visible,n=this._active,a=this._matricesTexture,s=this._matrices,o=a.image.data;return e>=r.length||!1===n[e]||r[e]===t||(!0===t?s[e].toArray(o,16*e):ns.toArray(o,16*e),a.needsUpdate=!0,r[e]=t),this}getVisibleAt(e){let t=this._visible,r=this._active;return!(e>=t.length)&&!1!==r[e]&&t[e]}raycast(){console.warn("BatchedMesh: Raycast function not implemented.")}copy(){throw Error("BatchedMesh: Copy function not implemented.")}toJSON(){throw Error("BatchedMesh: toJSON function not implemented.")}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}}var nd=Object.defineProperty;let nm=class extends ee.Kj0{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new ee.cPb;let r=this,n=new ee.Ilk(void 0!==t.color?t.color:8355711),a=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.shader||nm.ReflectorShader,h=void 0!==t.multisample?t.multisample:4,c=new ee.JOQ,u=new ee.Pa4,d=new ee.Pa4,m=new ee.Pa4,p=new ee.yGw,A=new ee.Pa4(0,0,-1),f=new ee.Ltg,g=new ee.Pa4,v=new ee.Pa4,y=new ee.Ltg,x=new ee.yGw,b=this.camera,w=new ee.dd2(a,s,{samples:h,type:ee.cLu}),C=new ee.jyz({uniforms:ee.rDY.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});C.uniforms.tDiffuse.value=w.texture,C.uniforms.color.value=n,C.uniforms.textureMatrix.value=x,this.material=C,this.onBeforeRender=function(e,t,n){if(d.setFromMatrixPosition(r.matrixWorld),m.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),g.subVectors(d,m),g.dot(u)>0)return;g.reflect(u).negate(),g.add(d),p.extractRotation(n.matrixWorld),A.set(0,0,-1),A.applyMatrix4(p),A.add(m),v.subVectors(d,A),v.reflect(u).negate(),v.add(d),b.position.copy(g),b.up.set(0,1,0),b.up.applyMatrix4(p),b.up.reflect(u),b.lookAt(v),b.far=n.far,b.updateMatrixWorld(),b.projectionMatrix.copy(n.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,d),c.applyMatrix4(b.matrixWorldInverse),f.set(c.normal.x,c.normal.y,c.normal.z,c.constant);let a=b.projectionMatrix;y.x=(Math.sign(f.x)+a.elements[8])/a.elements[0],y.y=(Math.sign(f.y)+a.elements[9])/a.elements[5],y.z=-1,y.w=(1+a.elements[10])/a.elements[14],f.multiplyScalar(2/f.dot(y)),a.elements[2]=f.x,a.elements[6]=f.y,a.elements[10]=f.z+1-o,a.elements[14]=f.w,r.visible=!1;let s=e.getRenderTarget(),l=e.xr.enabled,h=e.shadowMap.autoUpdate,C=e.toneMapping,E=!1;E="outputColorSpace"in e?"srgb"===e.outputColorSpace:3001===e.outputEncoding,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,"outputColorSpace"in e?e.outputColorSpace="srgb-linear":e.outputEncoding=3e3,e.toneMapping=ee.uL9,e.setRenderTarget(w),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,b),e.xr.enabled=l,e.shadowMap.autoUpdate=h,e.toneMapping=C,"outputColorSpace"in e?e.outputColorSpace=E?"srgb":"srgb-linear":e.outputEncoding=E?3001:3e3,e.setRenderTarget(s);let I=n.viewport;void 0!==I&&e.state.viewport(I),r.visible=!0},this.getRenderTarget=function(){return w},this.dispose=function(){w.dispose(),r.material.dispose()}}},np=nm;C="symbol"!=typeof(O="ReflectorShader")?O+"":O,E={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${tk.i>=154?"colorspace_fragment":"encodings_fragment"}>

		}`},C in np?nd(np,C,{enumerable:!0,configurable:!0,writable:!0,value:E}):np[C]=E;var nA=Object.defineProperty;let nf=class extends ee.Kj0{constructor(e,t={}){super(e),this.isRefractor=!0,this.type="Refractor",this.camera=new ee.cPb;let r=this,n=new ee.Ilk(void 0!==t.color?t.color:8355711),a=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.shader||nf.RefractorShader,h=void 0!==t.multisample?t.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;let u=new ee.JOQ,d=new ee.yGw,m=new ee.dd2(a,s,{samples:h,type:ee.cLu});this.material=new ee.jyz({uniforms:ee.rDY.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=m.texture,this.material.uniforms.textureMatrix.value=d;let p=function(){let e=new ee.Pa4,t=new ee.Pa4,n=new ee.yGw,a=new ee.Pa4,s=new ee.Pa4;return function(o){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(o.matrixWorld),a.subVectors(e,t),n.extractRotation(r.matrixWorld),s.set(0,0,1),s.applyMatrix4(n),0>a.dot(s)}}(),A=function(){let e=new ee.Pa4,t=new ee.Pa4,n=new ee._fP,a=new ee.Pa4;return function(){r.matrixWorld.decompose(t,n,a),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),f=function(){let e=new ee.JOQ,t=new ee.Ltg,r=new ee.Ltg;return function(n){c.matrixWorld.copy(n.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(n.projectionMatrix),c.far=n.far,e.copy(u),e.applyMatrix4(c.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);let a=c.projectionMatrix;r.x=(Math.sign(t.x)+a.elements[8])/a.elements[0],r.y=(Math.sign(t.y)+a.elements[9])/a.elements[5],r.z=-1,r.w=(1+a.elements[10])/a.elements[14],t.multiplyScalar(2/t.dot(r)),a.elements[2]=t.x,a.elements[6]=t.y,a.elements[10]=t.z+1-o,a.elements[14]=t.w}}();this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&!0!=!p(n)&&(A(),d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),d.multiply(n.projectionMatrix),d.multiply(n.matrixWorldInverse),d.multiply(r.matrixWorld),f(n),function(e,t,n){r.visible=!1;let a=e.getRenderTarget(),s=e.xr.enabled,o=e.shadowMap.autoUpdate,l=e.toneMapping,h=!1;h="outputColorSpace"in e?"srgb"===e.outputColorSpace:3001===e.outputEncoding,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,"outputColorSpace"in e?e.outputColorSpace="srgb-linear":e.outputEncoding=3e3,e.toneMapping=ee.uL9,e.setRenderTarget(m),!1===e.autoClear&&e.clear(),e.render(t,c),e.xr.enabled=s,e.shadowMap.autoUpdate=o,e.toneMapping=l,e.setRenderTarget(a),"outputColorSpace"in e?e.outputColorSpace=h?"srgb":"srgb-linear":e.outputEncoding=h?3001:3e3;let u=n.viewport;void 0!==u&&e.state.viewport(u),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return m},this.dispose=function(){m.dispose(),r.material.dispose()}}},ng=nf;I="symbol"!=typeof(G="RefractorShader")?G+"":G,M={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${tk.i>=154?"colorspace_fragment":"encodings_fragment"}>

		}`},I in ng?nA(ng,I,{enumerable:!0,configurable:!0,writable:!0,value:M}):ng[I]=M;let nv=new ee.yGw;class ny extends ee.Kj0{constructor(e){super(e.geometry,new ee.vBJ({color:0,transparent:!0,opacity:.6,depthWrite:!1,stencilWrite:!0,stencilFunc:ee.jwo,stencilRef:0,stencilZPass:ee.ZRs})),this.isShadowMesh=!0,this.meshMatrix=e.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1}update(e,t){let r=e.normal.x*t.x+e.normal.y*t.y+e.normal.z*t.z+-e.constant*t.w,n=nv.elements;n[0]=r-t.x*e.normal.x,n[4]=-t.x*e.normal.y,n[8]=-t.x*e.normal.z,n[12]=-(-t.x*e.constant),n[1]=-t.y*e.normal.x,n[5]=r-t.y*e.normal.y,n[9]=-t.y*e.normal.z,n[13]=-(-t.y*e.constant),n[2]=-t.z*e.normal.x,n[6]=-t.z*e.normal.y,n[10]=r-t.z*e.normal.z,n[14]=-(-t.z*e.constant),n[3]=-t.w*e.normal.x,n[7]=-t.w*e.normal.y,n[11]=-t.w*e.normal.z,n[15]=r- -(t.w*e.constant),this.matrix.multiplyMatrices(nv,this.meshMatrix)}}var nx=Object.defineProperty,nb=(e,t,r)=>t in e?nx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,nw=(e,t,r)=>(nb(e,"symbol"!=typeof t?t+"":t,r),r);let nC=new ee.u9r,nE=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),nI=new ee.vpT(nE,5);nC.setIndex([0,1,2,0,2,3]),nC.setAttribute("position",new ee.kB5(nI,3,0,!1)),nC.setAttribute("uv",new ee.kB5(nI,2,3,!1));let nM=class extends ee.Kj0{constructor(){super(nM.Geometry,new ee.vBJ({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;let e=new ee.Pa4,t=new ee.Pa4,r=new ee.IEO(new Uint8Array(768),16,16,ee.wk1);r.minFilter=ee.TyD,r.magFilter=ee.TyD,r.wrapS=ee.uWy,r.wrapT=ee.uWy;let n=new ee.IEO(new Uint8Array(768),16,16,ee.wk1);n.minFilter=ee.TyD,n.magFilter=ee.TyD,n.wrapS=ee.uWy,n.wrapT=ee.uWy;let a=nM.Geometry,s=new ee.FIo({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),o=new ee.FIo({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),l=new ee.Kj0(a,s),h=[],c=nS.Shader,u=new ee.FIo({uniforms:{map:{value:null},occlusionMap:{value:n},color:{value:new ee.Ilk(16777215)},scale:{value:new ee.FM8},screenPosition:{value:new ee.Pa4}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:ee.WMw,transparent:!0,depthWrite:!1}),d=new ee.Kj0(a,u);this.addElement=function(e){h.push(e)};let m=new ee.FM8,p=new ee.FM8,A=new ee.TUj,f=new ee.Ltg;this.onBeforeRender=function(c,g,v){c.getCurrentViewport(f);let y=f.w/f.z,x=f.z/2,b=f.w/2,w=16/f.w;if(m.set(w*y,w),A.min.set(f.x,f.y),A.max.set(f.x+(f.z-16),f.y+(f.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(v.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(v.projectionMatrix),p.x=f.x+e.x*x+x-8,p.y=f.y+e.y*b+b-8,A.containsPoint(p))){c.copyFramebufferToTexture(p,r);let t=s.uniforms;t.scale.value=m,t.screenPosition.value=e,c.renderBufferDirect(v,null,a,s,l,null),c.copyFramebufferToTexture(p,n),(t=o.uniforms).scale.value=m,t.screenPosition.value=e,c.renderBufferDirect(v,null,a,o,l,null);let A=-(2*e.x),g=-(2*e.y);for(let t=0,r=h.length;t<r;t++){let r=h[t],n=u.uniforms;n.color.value.copy(r.color),n.map.value=r.texture,n.screenPosition.value.x=e.x+A*r.distance,n.screenPosition.value.y=e.y+g*r.distance,w=r.size/f.w;let s=f.w/f.z;n.scale.value.set(w*s,w),u.uniformsNeedUpdate=!0,c.renderBufferDirect(v,null,a,u,d,null)}}},this.dispose=function(){s.dispose(),o.dispose(),u.dispose(),r.dispose(),n.dispose();for(let e=0,t=h.length;e<t;e++)h[e].texture.dispose()}}},nB=nM;nw(nB,"Geometry",nC);class nS{constructor(e,t=1,r=0,n=new ee.Ilk(16777215)){this.texture=e,this.size=t,this.distance=r,this.color=n}}nw(nS,"Shader",{uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`});var nT=r(80130);class nF extends ee.Kj0{constructor(e,t,r=!1,n=!1,a=1e4){let s=new ee.u9r;super(s,t),this.isMarchingCubes=!0;let o=this,l=new Float32Array(36),h=new Float32Array(36),c=new Float32Array(36);function u(e,t,r,n,a,s,u,d,m,p){var A,f,g,v,y,x;let b=(r-u)/(d-u),w=o.normal_cache;l[t+0]=n+b*o.delta,l[t+1]=a,l[t+2]=s,h[t+0]=(A=w[e+0])+(w[e+3]-A)*b,h[t+1]=(f=w[e+1])+(w[e+4]-f)*b,h[t+2]=(g=w[e+2])+(w[e+5]-g)*b,c[t+0]=(v=o.palette[3*m+0])+(o.palette[3*p+0]-v)*b,c[t+1]=(y=o.palette[3*m+1])+(o.palette[3*p+1]-y)*b,c[t+2]=(x=o.palette[3*m+2])+(o.palette[3*p+2]-x)*b}function d(e,t,r,n,a,s,u,d,m,p){var A,f,g,v,y,x;let b=(r-u)/(d-u),w=o.normal_cache;l[t+0]=n,l[t+1]=a+b*o.delta,l[t+2]=s;let C=e+3*o.yd;h[t+0]=(A=w[e+0])+(w[C+0]-A)*b,h[t+1]=(f=w[e+1])+(w[C+1]-f)*b,h[t+2]=(g=w[e+2])+(w[C+2]-g)*b,c[t+0]=(v=o.palette[3*m+0])+(o.palette[3*p+0]-v)*b,c[t+1]=(y=o.palette[3*m+1])+(o.palette[3*p+1]-y)*b,c[t+2]=(x=o.palette[3*m+2])+(o.palette[3*p+2]-x)*b}function m(e,t,r,n,a,s,u,d,m,p){var A,f,g,v,y,x;let b=(r-u)/(d-u),w=o.normal_cache;l[t+0]=n,l[t+1]=a,l[t+2]=s+b*o.delta;let C=e+3*o.zd;h[t+0]=(A=w[e+0])+(w[C+0]-A)*b,h[t+1]=(f=w[e+1])+(w[C+1]-f)*b,h[t+2]=(g=w[e+2])+(w[C+2]-g)*b,c[t+0]=(v=o.palette[3*m+0])+(o.palette[3*p+0]-v)*b,c[t+1]=(y=o.palette[3*m+1])+(o.palette[3*p+1]-y)*b,c[t+2]=(x=o.palette[3*m+2])+(o.palette[3*p+2]-x)*b}function p(e){let t=3*e;0===o.normal_cache[t]&&(o.normal_cache[t+0]=o.field[e-1]-o.field[e+1],o.normal_cache[t+1]=o.field[e-o.yd]-o.field[e+o.yd],o.normal_cache[t+2]=o.field[e-o.zd]-o.field[e+o.zd])}this.enableUvs=r,this.enableColors=n,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.count=0;let t=3*a;this.positionArray=new Float32Array(3*t);let r=new ee.TlE(this.positionArray,3);r.setUsage(ee.dj0),s.setAttribute("position",r),this.normalArray=new Float32Array(3*t);let n=new ee.TlE(this.normalArray,3);if(n.setUsage(ee.dj0),s.setAttribute("normal",n),this.enableUvs){this.uvArray=new Float32Array(2*t);let e=new ee.TlE(this.uvArray,2);e.setUsage(ee.dj0),s.setAttribute("uv",e)}if(this.enableColors){this.colorArray=new Float32Array(3*t);let e=new ee.TlE(this.colorArray,3);e.setUsage(ee.dj0),s.setAttribute("color",e)}s.boundingSphere=new ee.aLr(new ee.Pa4,1)},this.addBall=function(e,t,r,n,a,s){let o,l,h,c,u,d,m,p,A,f,g;let v=Math.sign(n);n=Math.abs(n);let y=null!=s,x=new ee.Ilk(e,t,r);if(y)try{x=s instanceof ee.Ilk?s:Array.isArray(s)?new ee.Ilk(Math.min(Math.abs(s[0]),1),Math.min(Math.abs(s[1]),1),Math.min(Math.abs(s[2]),1)):new ee.Ilk(s)}catch(n){x=new ee.Ilk(e,t,r)}let b=this.size*Math.sqrt(n/a),w=r*this.size,C=t*this.size,E=e*this.size,I=Math.floor(w-b);I<1&&(I=1);let M=Math.floor(w+b);M>this.size-1&&(M=this.size-1);let B=Math.floor(C-b);B<1&&(B=1);let S=Math.floor(C+b);S>this.size-1&&(S=this.size-1);let T=Math.floor(E-b);T<1&&(T=1);let F=Math.floor(E+b);for(F>this.size-1&&(F=this.size-1),h=I;h<M;h++)for(u=this.size2*h,A=(p=h/this.size-r)*p,l=B;l<S;l++)for(c=u+this.size*l,f=(m=l/this.size-t)*m,o=T;o<F;o++)if((g=n/(1e-6+(d=o/this.size-e)*d+f+A)-a)>0){this.field[c+o]+=g*v;let e=Math.sqrt((o-E)*(o-E)+(l-C)*(l-C)+(h-w)*(h-w))/b,t=1-e*e*e*(e*(6*e-15)+10);this.palette[(c+o)*3+0]+=x.r*t,this.palette[(c+o)*3+1]+=x.g*t,this.palette[(c+o)*3+2]+=x.b*t}},this.addPlaneX=function(e,t){let r=this.size,n=this.yd,a=this.zd,s=this.field,o,l,h,c,u,d,m=r*Math.sqrt(e/t);for(m>r&&(m=r),o=0;o<m;o++)if((c=e/(1e-4+(u=o/r)*u)-t)>0)for(l=0;l<r;l++)for(h=0,d=o+l*n;h<r;h++)s[a*h+d]+=c},this.addPlaneY=function(e,t){let r=this.size,n=this.yd,a=this.zd,s=this.field,o,l,h,c,u,d,m,p=r*Math.sqrt(e/t);for(p>r&&(p=r),l=0;l<p;l++)if((c=e/(1e-4+(u=l/r)*u)-t)>0)for(o=0,d=l*n;o<r;o++)for(h=0,m=d+o;h<r;h++)s[a*h+m]+=c},this.addPlaneZ=function(e,t){let r=this.size,n=this.yd,a=this.zd,s=this.field,o,l,h,c,u,d,m,p=r*Math.sqrt(e/t);for(p>r&&(p=r),h=0;h<p;h++)if((c=e/(1e-4+(u=h/r)*u)-t)>0)for(l=0,d=a*h;l<r;l++)for(o=0,m=d+l*n;o<r;o++)s[m+o]+=c},this.setCell=function(e,t,r,n){let a=this.size2*r+this.size*t+e;this.field[a]=n},this.getCell=function(e,t,r){let n=this.size2*r+this.size*t+e;return this.field[n]},this.blur=function(e=1){let t=this.field,r=t.slice(),n=this.size,a=this.size2;for(let s=0;s<n;s++)for(let o=0;o<n;o++)for(let l=0;l<n;l++){let h=a*l+n*o+s,c=r[h],u=1;for(let t=-1;t<=1;t+=2){let h=t+s;if(!(h<0)&&!(h>=n))for(let t=-1;t<=1;t+=2){let s=t+o;if(!(s<0)&&!(s>=n))for(let t=-1;t<=1;t+=2){let o=t+l;if(o<0||o>=n)continue;let d=r[a*o+n*s+h];u++,c+=e*(d-c)/u}}}t[h]=c}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.update=function(){this.count=0;let e=this.size-2;for(let t=1;t<e;t++){let r=this.size2*t,n=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){let a=r+this.size*t,s=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++)!function(e,t,r,n,a){let s=n+1,A=n+o.yd,f=n+o.zd,g=s+o.yd,v=s+o.zd,y=n+o.yd+o.zd,x=s+o.yd+o.zd,b=0,w=o.field[n],C=o.field[s],E=o.field[A],I=o.field[g],M=o.field[f],B=o.field[v],S=o.field[y],T=o.field[x];w<a&&(b|=1),C<a&&(b|=2),E<a&&(b|=8),I<a&&(b|=4),M<a&&(b|=16),B<a&&(b|=32),S<a&&(b|=128),T<a&&(b|=64);let F=nP[b];if(0===F)return;let P=o.delta,_=e+P,D=t+P,R=r+P;1&F&&(p(n),p(s),u(3*n,0,a,e,t,r,w,C,n,s)),2&F&&(p(s),p(g),d(3*s,3,a,_,t,r,C,I,s,g)),4&F&&(p(A),p(g),u(3*A,6,a,e,D,r,E,I,A,g)),8&F&&(p(n),p(A),d(3*n,9,a,e,t,r,w,E,n,A)),16&F&&(p(f),p(v),u(3*f,12,a,e,t,R,M,B,f,v)),32&F&&(p(v),p(x),d(3*v,15,a,_,t,R,B,T,v,x)),64&F&&(p(y),p(x),u(3*y,18,a,e,D,R,S,T,y,x)),128&F&&(p(f),p(y),d(3*f,21,a,e,t,R,M,S,f,y)),256&F&&(p(n),p(f),m(3*n,24,a,e,t,r,w,M,n,f)),512&F&&(p(s),p(v),m(3*s,27,a,_,t,r,C,B,s,v)),1024&F&&(p(g),p(x),m(3*g,30,a,_,D,r,I,T,g,x)),2048&F&&(p(A),p(y),m(3*A,33,a,e,D,r,E,S,A,y)),b<<=4;let L,N,k,U=0;for(;-1!=n_[b+U];)N=(L=b+U)+1,k=L+2,function(e,t,r,n,a,s){let l=3*o.count;if(o.positionArray[l+0]=e[n],o.positionArray[l+1]=e[n+1],o.positionArray[l+2]=e[n+2],o.positionArray[l+3]=e[a],o.positionArray[l+4]=e[a+1],o.positionArray[l+5]=e[a+2],o.positionArray[l+6]=e[s],o.positionArray[l+7]=e[s+1],o.positionArray[l+8]=e[s+2],!0===o.material.flatShading){let e=(t[n+0]+t[a+0]+t[s+0])/3,r=(t[n+1]+t[a+1]+t[s+1])/3,h=(t[n+2]+t[a+2]+t[s+2])/3;o.normalArray[l+0]=e,o.normalArray[l+1]=r,o.normalArray[l+2]=h,o.normalArray[l+3]=e,o.normalArray[l+4]=r,o.normalArray[l+5]=h,o.normalArray[l+6]=e,o.normalArray[l+7]=r,o.normalArray[l+8]=h}else o.normalArray[l+0]=t[n+0],o.normalArray[l+1]=t[n+1],o.normalArray[l+2]=t[n+2],o.normalArray[l+3]=t[a+0],o.normalArray[l+4]=t[a+1],o.normalArray[l+5]=t[a+2],o.normalArray[l+6]=t[s+0],o.normalArray[l+7]=t[s+1],o.normalArray[l+8]=t[s+2];if(o.enableUvs){let t=2*o.count;o.uvArray[t+0]=e[n+0],o.uvArray[t+1]=e[n+2],o.uvArray[t+2]=e[a+0],o.uvArray[t+3]=e[a+2],o.uvArray[t+4]=e[s+0],o.uvArray[t+5]=e[s+2]}o.enableColors&&(o.colorArray[l+0]=r[n+0],o.colorArray[l+1]=r[n+1],o.colorArray[l+2]=r[n+2],o.colorArray[l+3]=r[a+0],o.colorArray[l+4]=r[a+1],o.colorArray[l+5]=r[a+2],o.colorArray[l+6]=r[s+0],o.colorArray[l+7]=r[s+1],o.colorArray[l+8]=r[s+2]),o.count+=3}(l,h,c,3*n_[L],3*n_[N],3*n_[k]),U+=3}((t-this.halfsize)/this.halfsize,s,n,a+t,this.isolation)}}this.geometry.setDrawRange(0,this.count),s.getAttribute("position").needsUpdate=!0,s.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(s.getAttribute("uv").needsUpdate=!0),this.enableColors&&(s.getAttribute("color").needsUpdate=!0),this.count/3>a&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}}let nP=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),n_=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var nD=Object.defineProperty,nR=(e,t,r)=>t in e?nD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,nL=(e,t,r)=>(nR(e,"symbol"!=typeof t?t+"":t,r),r);class nN{constructor(e=Math){nL(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),nL(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),nL(this,"p",[]),nL(this,"perm",[]),nL(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),nL(this,"dot",(e,t,r)=>e[0]*t+e[1]*r),nL(this,"dot3",(e,t,r,n)=>e[0]*t+e[1]*r+e[2]*n),nL(this,"dot4",(e,t,r,n,a)=>e[0]*t+e[1]*r+e[2]*n+e[3]*a),nL(this,"noise",(e,t)=>{let r,n,a;let s=.5*(Math.sqrt(3)-1)*(e+t),o=Math.floor(e+s),l=Math.floor(t+s),h=(3-Math.sqrt(3))/6,c=(o+l)*h,u=e-(o-c),d=t-(l-c),m=0,p=1;u>d&&(m=1,p=0);let A=u-m+h,f=d-p+h,g=u-1+2*h,v=d-1+2*h,y=255&o,x=255&l,b=this.perm[y+this.perm[x]]%12,w=this.perm[y+m+this.perm[x+p]]%12,C=this.perm[y+1+this.perm[x+1]]%12,E=.5-u*u-d*d;E<0?r=0:(E*=E,r=E*E*this.dot(this.grad3[b],u,d));let I=.5-A*A-f*f;I<0?n=0:(I*=I,n=I*I*this.dot(this.grad3[w],A,f));let M=.5-g*g-v*v;return M<0?a=0:(M*=M,a=M*M*this.dot(this.grad3[C],g,v)),70*(r+n+a)}),nL(this,"noise3d",(e,t,r)=>{let n,a,s,o,l,h,c,u,d,m;let p=1/3*(e+t+r),A=Math.floor(e+p),f=Math.floor(t+p),g=Math.floor(r+p),v=1/6*(A+f+g),y=e-(A-v),x=t-(f-v),b=r-(g-v);y>=x?x>=b?(l=1,h=0,c=0,u=1,d=1,m=0):(y>=b?(l=1,h=0,c=0):(l=0,h=0,c=1),u=1,d=0,m=1):x<b?(l=0,h=0,c=1,u=0,d=1,m=1):y<b?(l=0,h=1,c=0,u=0,d=1,m=1):(l=0,h=1,c=0,u=1,d=1,m=0);let w=y-l+1/6,C=x-h+1/6,E=b-c+1/6,I=y-u+1/6*2,M=x-d+1/6*2,B=b-m+1/6*2,S=y-1+1/6*3,T=x-1+1/6*3,F=b-1+1/6*3,P=255&A,_=255&f,D=255&g,R=this.perm[P+this.perm[_+this.perm[D]]]%12,L=this.perm[P+l+this.perm[_+h+this.perm[D+c]]]%12,N=this.perm[P+u+this.perm[_+d+this.perm[D+m]]]%12,k=this.perm[P+1+this.perm[_+1+this.perm[D+1]]]%12,U=.6-y*y-x*x-b*b;U<0?n=0:(U*=U,n=U*U*this.dot3(this.grad3[R],y,x,b));let Q=.6-w*w-C*C-E*E;Q<0?a=0:(Q*=Q,a=Q*Q*this.dot3(this.grad3[L],w,C,E));let O=.6-I*I-M*M-B*B;O<0?s=0:(O*=O,s=O*O*this.dot3(this.grad3[N],I,M,B));let G=.6-S*S-T*T-F*F;return G<0?o=0:(G*=G,o=G*G*this.dot3(this.grad3[k],S,T,F)),32*(n+a+s+o)}),nL(this,"noise4d",(e,t,r,n)=>{let a,s,o,l,h,c,u,d,m,p,A,f,g,v,y,x,b;let w=this.grad4,C=this.simplex,E=this.perm,I=(5-Math.sqrt(5))/20,M=(Math.sqrt(5)-1)/4*(e+t+r+n),B=Math.floor(e+M),S=Math.floor(t+M),T=Math.floor(r+M),F=Math.floor(n+M),P=(B+S+T+F)*I,_=e-(B-P),D=t-(S-P),R=r-(T-P),L=n-(F-P),N=(_>D?32:0)+(_>R?16:0)+(D>R?8:0)+(_>L?4:0)+(D>L?2:0)+(R>L?1:0);c=C[N][0]>=3?1:0,u=C[N][1]>=3?1:0,d=C[N][2]>=3?1:0,m=C[N][3]>=3?1:0,p=C[N][0]>=2?1:0,A=C[N][1]>=2?1:0,f=C[N][2]>=2?1:0,g=C[N][3]>=2?1:0,v=C[N][0]>=1?1:0,y=C[N][1]>=1?1:0,x=C[N][2]>=1?1:0,b=C[N][3]>=1?1:0;let k=_-c+I,U=D-u+I,Q=R-d+I,O=L-m+I,G=_-p+2*I,H=D-A+2*I,z=R-f+2*I,V=L-g+2*I,j=_-v+3*I,W=D-y+3*I,X=R-x+3*I,Y=L-b+3*I,K=_-1+4*I,J=D-1+4*I,q=R-1+4*I,Z=L-1+4*I,$=255&B,ee=255&S,et=255&T,ei=255&F,er=E[$+E[ee+E[et+E[ei]]]]%32,en=E[$+c+E[ee+u+E[et+d+E[ei+m]]]]%32,ea=E[$+p+E[ee+A+E[et+f+E[ei+g]]]]%32,es=E[$+v+E[ee+y+E[et+x+E[ei+b]]]]%32,eo=E[$+1+E[ee+1+E[et+1+E[ei+1]]]]%32,el=.6-_*_-D*D-R*R-L*L;el<0?a=0:(el*=el,a=el*el*this.dot4(w[er],_,D,R,L));let eh=.6-k*k-U*U-Q*Q-O*O;eh<0?s=0:(eh*=eh,s=eh*eh*this.dot4(w[en],k,U,Q,O));let ec=.6-G*G-H*H-z*z-V*V;ec<0?o=0:(ec*=ec,o=ec*ec*this.dot4(w[ea],G,H,z,V));let eu=.6-j*j-W*W-X*X-Y*Y;eu<0?l=0:(eu*=eu,l=eu*eu*this.dot4(w[es],j,W,X,Y));let ed=.6-K*K-J*J-q*q-Z*Z;return ed<0?h=0:(ed*=ed,h=ed*ed*this.dot4(w[eo],K,J,q,Z)),27*(a+s+o+l+h)});for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let e=0;e<512;e++)this.perm[e]=this.p[255&e]}}var nk=Object.defineProperty,nU=(e,t,r)=>t in e?nk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,nQ=(e,t,r)=>(nU(e,"symbol"!=typeof t?t+"":t,r),r);let nO=class extends ee.u9r{constructor(e={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(nO.copyParameters(e,e)),this.createMesh()}static createRandomGenerator(){let e=[];for(let t=0;t<2053;t++)e.push(Math.random());let t={currentSeed:0,random:function(){let r=e[t.currentSeed];return t.currentSeed=(t.currentSeed+1)%2053,r},getSeed:function(){return t.currentSeed/2053},setSeed:function(e){t.currentSeed=Math.floor(2053*e)%2053}};return t}static copyParameters(e={},t={}){let r=function(r){return t===e?r:r.clone()};return e.sourceOffset=void 0!==t.sourceOffset?r(t.sourceOffset):new ee.Pa4(0,100,0),e.destOffset=void 0!==t.destOffset?r(t.destOffset):new ee.Pa4(0,0,0),e.timeScale=void 0!==t.timeScale?t.timeScale:1,e.roughness=void 0!==t.roughness?t.roughness:.9,e.straightness=void 0!==t.straightness?t.straightness:.7,e.up0=void 0!==t.up0?r(t.up0):new ee.Pa4(0,0,1),e.up1=void 0!==t.up1?r(t.up1):new ee.Pa4(0,0,1),e.radius0=void 0!==t.radius0?t.radius0:1,e.radius1=void 0!==t.radius1?t.radius1:1,e.radius0Factor=void 0!==t.radius0Factor?t.radius0Factor:.5,e.radius1Factor=void 0!==t.radius1Factor?t.radius1Factor:.2,e.minRadius=void 0!==t.minRadius?t.minRadius:.2,e.isEternal=void 0!==t.isEternal?t.isEternal:void 0===t.birthTime||void 0===t.deathTime,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.propagationTimeFactor=void 0!==t.propagationTimeFactor?t.propagationTimeFactor:.1,e.vanishingTimeFactor=void 0!==t.vanishingTimeFactor?t.vanishingTimeFactor:.9,e.subrayPeriod=void 0!==t.subrayPeriod?t.subrayPeriod:4,e.subrayDutyCycle=void 0!==t.subrayDutyCycle?t.subrayDutyCycle:.6,e.maxIterations=void 0!==t.maxIterations?t.maxIterations:9,e.isStatic=void 0!==t.isStatic&&t.isStatic,e.ramification=void 0!==t.ramification?t.ramification:5,e.maxSubrayRecursion=void 0!==t.maxSubrayRecursion?t.maxSubrayRecursion:3,e.recursionProbability=void 0!==t.recursionProbability?t.recursionProbability:.6,e.generateUVs=void 0!==t.generateUVs&&t.generateUVs,e.randomGenerator=t.randomGenerator,e.noiseSeed=t.noiseSeed,e.onDecideSubrayCreation=t.onDecideSubrayCreation,e.onSubrayCreation=t.onSubrayCreation,e}update(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=nO.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=nO.RAY_VANISHING:this.state=nO.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=nO.RAY_UNBORN:this.state=nO.RAY_EXTINGUISHED))}init(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=nO.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=nO.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new nN(this.seedGenerator),this.simplexY=new nN(this.seedGenerator),this.simplexZ=new nN(this.seedGenerator),this.forwards=new ee.Pa4,this.forwardsFill=new ee.Pa4,this.side=new ee.Pa4,this.down=new ee.Pa4,this.middlePos=new ee.Pa4,this.middleLinPos=new ee.Pa4,this.newPos=new ee.Pa4,this.vPos=new ee.Pa4,this.cross1=new ee.Pa4}createMesh(){let e=1<<this.maxIterations,t=3*(e+1)*this.maxSubrays,r=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(r),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new ee.lCJ(this.indices,1)),this.positionAttribute=new ee.a$l(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new ee.a$l(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),!this.isStatic&&(this.index.usage=ee.dj0,this.positionAttribute.usage=ee.dj0,this.generateUVs&&(this.uvsAttribute.usage=ee.dj0)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(e){let t=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(e,function(r){let n=t.currentSubray;!(e<n.birthTime)&&(this.rayParameters.isEternal&&0==t.currentSubray.recursion?(t.createPrism(r),t.onDecideSubrayCreation(r,t)):e<n.endPropagationTime?t.timeFraction>=r.fraction0*n.propagationTimeFactor&&(t.createPrism(r),t.onDecideSubrayCreation(r,t)):(e<n.beginVanishingTime?t.createPrism(r):t.timeFraction<=n.vanishingTimeFactor+r.fraction1*(1-n.vanishingTimeFactor)&&t.createPrism(r),t.onDecideSubrayCreation(r,t)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0}fractalRay(e,t){this.time=e,this.currentSegmentCallback=t,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let t=0;t<this.numSubrays;t++){let r=this.subrays[t];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=ee.M8C.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=ee.M8C.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);let n=this.randomGenerator.random;r.linPos0.set(n(),n(),n()).multiplyScalar(1e3),r.linPos1.set(n(),n(),n()).multiplyScalar(1e3),this.timeFraction=(e-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;let a=this.getNewSegment();a.iteration=0,a.pos0.copy(r.pos0),a.pos1.copy(r.pos1),a.linPos0.copy(r.linPos0),a.linPos1.copy(r.linPos1),a.up0.copy(r.up0),a.up1.copy(r.up1),a.radius0=r.radius0,a.radius1=r.radius1,a.fraction0=0,a.fraction1=1,a.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(a)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(e){if(e.iteration>=this.currentSubray.maxIterations){this.currentSegmentCallback(e);return}this.forwards.subVectors(e.pos1,e.pos0);let t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());let r=(e.radius0+e.radius1)*.5,n=(e.fraction0+e.fraction1)*.5,a=this.time*this.currentSubray.timeScale*Math.pow(2,e.iteration);this.middlePos.lerpVectors(e.pos0,e.pos1,.5),this.middleLinPos.lerpVectors(e.linPos0,e.linPos1,.5);let s=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(s.x,s.y,s.z,a),this.simplexY.noise4d(s.x,s.y,s.z,a),this.simplexZ.noise4d(s.x,s.y,s.z,a)),this.newPos.multiplyScalar(e.positionVariationFactor*t),this.newPos.add(this.middlePos);let o=this.getNewSegment();o.pos0.copy(e.pos0),o.pos1.copy(this.newPos),o.linPos0.copy(e.linPos0),o.linPos1.copy(this.middleLinPos),o.up0.copy(e.up0),o.up1.copy(e.up1),o.radius0=e.radius0,o.radius1=r,o.fraction0=e.fraction0,o.fraction1=n,o.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,o.iteration=e.iteration+1;let l=this.getNewSegment();l.pos0.copy(this.newPos),l.pos1.copy(e.pos1),l.linPos0.copy(this.middleLinPos),l.linPos1.copy(e.linPos1),this.cross1.crossVectors(e.up0,this.forwards.normalize()),l.up0.crossVectors(this.forwards,this.cross1).normalize(),l.up1.copy(e.up1),l.radius0=r,l.radius1=e.radius1,l.fraction0=n,l.fraction1=e.fraction1,l.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,l.iteration=e.iteration+1,this.fractalRayRecursive(o),this.fractalRayRecursive(l)}createPrism(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(e,t,r,n){this.side.crossVectors(t,r).multiplyScalar(n*nO.COS30DEG),this.down.copy(t).multiplyScalar(-n*nO.SIN30DEG);let a=this.vPos,s=this.vertices;a.copy(e).sub(this.side).add(this.down),s[this.currentCoordinate++]=a.x,s[this.currentCoordinate++]=a.y,s[this.currentCoordinate++]=a.z,a.copy(e).add(this.side).add(this.down),s[this.currentCoordinate++]=a.x,s[this.currentCoordinate++]=a.y,s[this.currentCoordinate++]=a.z,a.copy(t).multiplyScalar(n).add(e),s[this.currentCoordinate++]=a.x,s[this.currentCoordinate++]=a.y,s[this.currentCoordinate++]=a.z,this.currentVertex+=3}createTriangleVerticesWithUVs(e,t,r,n,a){this.side.crossVectors(t,r).multiplyScalar(n*nO.COS30DEG),this.down.copy(t).multiplyScalar(-n*nO.SIN30DEG);let s=this.vPos,o=this.vertices,l=this.uvs;s.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,l[this.currentUVCoordinate++]=a,l[this.currentUVCoordinate++]=0,s.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,l[this.currentUVCoordinate++]=a,l[this.currentUVCoordinate++]=.5,s.copy(t).multiplyScalar(n).add(e),o[this.currentCoordinate++]=s.x,o[this.currentCoordinate++]=s.y,o[this.currentCoordinate++]=s.z,l[this.currentUVCoordinate++]=a,l[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(e){let t=this.indices;e=this.currentVertex-6,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+5}createDefaultSubrayCreationCallbacks(){let e=this.randomGenerator.random;this.onDecideSubrayCreation=function(t,r){let n=r.currentSubray,a=r.rayParameters.subrayPeriod,s=r.rayParameters.subrayDutyCycle,o=r.rayParameters.isEternal&&0==n.recursion?-e()*a:ee.M8C.lerp(n.birthTime,n.endPropagationTime,t.fraction0)-e()*a,l=r.time-o,h=Math.floor(l/a),c=e()*(h+1),u=0;if(l%a<=s*a&&(u=r.subrayProbability),n.recursion<r.maxSubrayRecursion&&r.numSubrays<r.maxSubrays&&e()<u){let l=r.addNewSubray(),u=r.randomGenerator.getSeed();l.seed=c,r.randomGenerator.setSeed(c),l.recursion=n.recursion+1,l.maxIterations=Math.max(1,n.maxIterations-1),l.linPos0.set(e(),e(),e()).multiplyScalar(1e3),l.linPos1.set(e(),e(),e()).multiplyScalar(1e3),l.up0.copy(n.up0),l.up1.copy(n.up1),l.radius0=t.radius0*r.rayParameters.radius0Factor,l.radius1=Math.min(r.rayParameters.minRadius,t.radius1*r.rayParameters.radius1Factor),l.birthTime=o+h*a,l.deathTime=l.birthTime+a*s,r.rayParameters.isEternal||0!=n.recursion||(l.birthTime=Math.max(l.birthTime,n.birthTime),l.deathTime=Math.min(l.deathTime,n.deathTime)),l.timeScale=2*n.timeScale,l.roughness=n.roughness,l.straightness=n.straightness,l.propagationTimeFactor=n.propagationTimeFactor,l.vanishingTimeFactor=n.vanishingTimeFactor,r.onSubrayCreation(t,n,l,r),r.randomGenerator.setSeed(u)}};let t=new ee.Pa4,r=new ee.Pa4,n=new ee.Pa4,a=new ee.Pa4;this.onSubrayCreation=function(e,t,r,n){n.subrayCylinderPosition(e,t,r,.5,.6,.2)},this.subrayConePosition=function(s,o,l,h,c,u){l.pos0.copy(s.pos0),t.subVectors(o.pos1,o.pos0),r.copy(t).normalize(),t.multiplyScalar(s.fraction0+(1-s.fraction0)*(e()*h));let d=t.length();n.crossVectors(o.up0,r);let m=2*Math.PI*e();n.multiplyScalar(Math.cos(m)),a.copy(o.up0).multiplyScalar(Math.sin(m)),l.pos1.copy(n).add(a).multiplyScalar(d*c*(u+e()*(1-u))).add(t).add(o.pos0)},this.subrayCylinderPosition=function(s,o,l,h,c,u){l.pos0.copy(s.pos0),t.subVectors(o.pos1,o.pos0),r.copy(t).normalize(),t.multiplyScalar(s.fraction0+(1-s.fraction0)*((2*e()-1)*h));let d=t.length();n.crossVectors(o.up0,r);let m=2*Math.PI*e();n.multiplyScalar(Math.cos(m)),a.copy(o.up0).multiplyScalar(Math.sin(m)),l.pos1.copy(n).add(a).multiplyScalar(d*c*(u+e()*(1-u))).add(t).add(o.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new ee.Pa4,pos1:new ee.Pa4,linPos0:new ee.Pa4,linPos1:new ee.Pa4,up0:new ee.Pa4,up1:new ee.Pa4,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new ee.Pa4,pos1:new ee.Pa4,linPos0:new ee.Pa4,linPos1:new ee.Pa4,up0:new ee.Pa4,up1:new ee.Pa4,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(e){return super.copy(e),this.init(nO.copyParameters({},e.rayParameters)),this}clone(){return new this.constructor(nO.copyParameters({},this.rayParameters))}},nG=nO;nQ(nG,"RAY_INITIALIZED",0),nQ(nG,"RAY_UNBORN",1),nQ(nG,"RAY_PROPAGATING",2),nQ(nG,"RAY_STEADY",3),nQ(nG,"RAY_VANISHING",4),nQ(nG,"RAY_EXTINGUISHED",5),nQ(nG,"COS30DEG",Math.cos(30*Math.PI/180)),nQ(nG,"SIN30DEG",Math.sin(30*Math.PI/180));class nH extends ee.Tme{constructor(e={}){super(),this.isLightningStorm=!0,this.stormParams=e,e.size=void 0!==e.size?e.size:1e3,e.minHeight=void 0!==e.minHeight?e.minHeight:80,e.maxHeight=void 0!==e.maxHeight?e.maxHeight:100,e.maxSlope=void 0!==e.maxSlope?e.maxSlope:1.1,e.maxLightnings=void 0!==e.maxLightnings?e.maxLightnings:3,e.lightningMinPeriod=void 0!==e.lightningMinPeriod?e.lightningMinPeriod:3,e.lightningMaxPeriod=void 0!==e.lightningMaxPeriod?e.lightningMaxPeriod:7,e.lightningMinDuration=void 0!==e.lightningMinDuration?e.lightningMinDuration:1,e.lightningMaxDuration=void 0!==e.lightningMaxDuration?e.lightningMaxDuration:2.5,this.lightningParameters=nG.copyParameters(e.lightningParameters,e.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=void 0!==e.lightningMaterial?e.lightningMaterial:new ee.vBJ({color:11599871}),void 0!==e.onRayPosition?this.onRayPosition=e.onRayPosition:this.onRayPosition=function(t,r){r.set((Math.random()-.5)*e.size,0,(Math.random()-.5)*e.size);let n=ee.M8C.lerp(e.minHeight,e.maxHeight,Math.random());t.set(e.maxSlope*(2*Math.random()-1),1,e.maxSlope*(2*Math.random()-1)).multiplyScalar(n).add(r)},this.onLightningDown=e.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(let e=0;e<this.stormParams.maxLightnings;e++){let e=new nG(nG.copyParameters({},this.lightningParameters)),t=new ee.Kj0(e,this.lightningMaterial);this.deadLightningsMeshes.push(t)}}update(e){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(e)*Math.random(),this.inited=!0),e>=this.nextLightningTime){let t=this.deadLightningsMeshes.pop();if(t){let r=nG.copyParameters(t.geometry.rayParameters,this.lightningParameters);r.birthTime=e,r.deathTime=e+ee.M8C.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(r.sourceOffset,r.destOffset),r.noiseSeed=Math.random(),this.add(t),this.lightningsMeshes.push(t)}this.nextLightningTime=this.getNextLightningTime(e)}let t=0,r=this.lightningsMeshes.length;for(;t<r;){let n=this.lightningsMeshes[t],a=n.geometry,s=a.state;a.update(e),s===nG.RAY_PROPAGATING&&a.state>s&&this.onLightningDown&&this.onLightningDown(a),a.state===nG.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(n),1),this.deadLightningsMeshes.push(n),this.remove(n),r--):t++}}getNextLightningTime(e){return e+ee.M8C.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)}copy(e,t){return super.copy(e,t),this.stormParams.size=e.stormParams.size,this.stormParams.minHeight=e.stormParams.minHeight,this.stormParams.maxHeight=e.stormParams.maxHeight,this.stormParams.maxSlope=e.stormParams.maxSlope,this.stormParams.maxLightnings=e.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=e.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=e.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=e.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=e.stormParams.lightningMaxDuration,this.lightningParameters=nG.copyParameters({},e.lightningParameters),this.lightningMaterial=e.stormParams.lightningMaterial,this.onLightningDown=e.onLightningDown,this}clone(){return new this.constructor(this.stormParams).copy(this)}}class nz extends np{constructor(e,t){super(e,t),this.geometry.setDrawRange(0,0)}}var nV=Object.defineProperty;let nj=class extends ee.Kj0{constructor(e,t={}){let r;super(e),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";let n=this,a=new ee.Ilk(void 0!==t.color?t.color:8355711),s=t.textureWidth||512,o=t.textureHeight||512,l=t.clipBias||0,h=t.shader||nj.ReflectorShader,c=!0===t.useDepthTexture,u=new ee.Pa4(0,1,0),d=new ee.Pa4,m=new ee.Pa4;n.needsUpdate=!1,n.maxDistance=nj.ReflectorShader.uniforms.maxDistance.value,n.opacity=nj.ReflectorShader.uniforms.opacity.value,n.color=a,n.resolution=t.resolution||new ee.FM8(window.innerWidth,window.innerHeight),n._distanceAttenuation=nj.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(n,"distanceAttenuation",{get:()=>n._distanceAttenuation,set(e){n._distanceAttenuation!==e&&(n._distanceAttenuation=e,n.material.defines.DISTANCE_ATTENUATION=e,n.material.needsUpdate=!0)}}),n._fresnel=nj.ReflectorShader.defines.FRESNEL,Object.defineProperty(n,"fresnel",{get:()=>n._fresnel,set(e){n._fresnel!==e&&(n._fresnel=e,n.material.defines.FRESNEL=e,n.material.needsUpdate=!0)}});let p=new ee.Pa4,A=new ee.Pa4,f=new ee.Pa4,g=new ee.yGw,v=new ee.Pa4(0,0,-1),y=new ee.Pa4,x=new ee.Pa4,b=new ee.yGw,w=new ee.cPb;c&&((r=new ee.$YQ).type=ee.LsT,r.minFilter=ee.TyD,r.magFilter=ee.TyD);let C={depthTexture:c?r:null,type:ee.cLu},E=new ee.dd2(s,o,C),I=new ee.jyz({transparent:c,defines:Object.assign({},nj.ReflectorShader.defines,{useDepthTexture:c}),uniforms:ee.rDY.clone(h.uniforms),fragmentShader:h.fragmentShader,vertexShader:h.vertexShader});I.uniforms.tDiffuse.value=E.texture,I.uniforms.color.value=n.color,I.uniforms.textureMatrix.value=b,c&&(I.uniforms.tDepth.value=E.depthTexture),this.material=I;let M=[new ee.JOQ(new ee.Pa4(0,1,0),l)];this.doRender=function(e,t,r){if(I.uniforms.maxDistance.value=n.maxDistance,I.uniforms.color.value=n.color,I.uniforms.opacity.value=n.opacity,d.copy(r.position).normalize(),m.copy(d).reflect(u),I.uniforms.fresnelCoe.value=(d.dot(m)+1)/2,A.setFromMatrixPosition(n.matrixWorld),f.setFromMatrixPosition(r.matrixWorld),g.extractRotation(n.matrixWorld),p.set(0,0,1),p.applyMatrix4(g),y.subVectors(A,f),y.dot(p)>0)return;y.reflect(p).negate(),y.add(A),g.extractRotation(r.matrixWorld),v.set(0,0,-1),v.applyMatrix4(g),v.add(f),x.subVectors(A,v),x.reflect(p).negate(),x.add(A),w.position.copy(y),w.up.set(0,1,0),w.up.applyMatrix4(g),w.up.reflect(p),w.lookAt(x),w.far=r.far,w.updateMatrixWorld(),w.projectionMatrix.copy(r.projectionMatrix),I.uniforms.virtualCameraNear.value=r.near,I.uniforms.virtualCameraFar.value=r.far,I.uniforms.virtualCameraMatrixWorld.value=w.matrixWorld,I.uniforms.virtualCameraProjectionMatrix.value=r.projectionMatrix,I.uniforms.virtualCameraProjectionMatrixInverse.value=r.projectionMatrixInverse,I.uniforms.resolution.value=n.resolution,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(w.projectionMatrix),b.multiply(w.matrixWorldInverse),b.multiply(n.matrixWorld);let a=e.getRenderTarget(),s=e.xr.enabled,o=e.shadowMap.autoUpdate,l=e.clippingPlanes;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.clippingPlanes=M,e.setRenderTarget(E),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,w),e.xr.enabled=s,e.shadowMap.autoUpdate=o,e.clippingPlanes=l,e.setRenderTarget(a);let h=r.viewport;void 0!==h&&e.state.viewport(h)},this.getRenderTarget=function(){return E}}},nW=nj;B="symbol"!=typeof(H="ReflectorShader")?H+"":H,S={defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new ee.yGw},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new ee.yGw},virtualCameraMatrixWorld:{value:new ee.yGw},virtualCameraProjectionMatrixInverse:{value:new ee.yGw},resolution:{value:new ee.FM8}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;
		uniform float maxDistance;
		uniform float opacity;
		uniform float fresnelCoe;
		uniform float virtualCameraNear;
		uniform float virtualCameraFar;
		uniform mat4 virtualCameraProjectionMatrix;
		uniform mat4 virtualCameraProjectionMatrixInverse;
		uniform mat4 virtualCameraMatrixWorld;
		uniform vec2 resolution;
		varying vec4 vUv;
		#include <packing>
		float blendOverlay( float base, float blend ) {
			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );
		}
		vec3 blendOverlay( vec3 base, vec3 blend ) {
			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view
		}
		void main() {
			vec4 base = texture2DProj( tDiffuse, vUv );
			#ifdef useDepthTexture
				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;
				uv.x=1.-uv.x;
				float depth = texture2DProj( tDepth, vUv ).r;
				float viewZ = getViewZ( depth );
				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];
				vec3 viewPosition=getViewPosition( uv, depth, clipW );
				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;
				if(worldPosition.y>maxDistance) discard;
				float op=opacity;
				#ifdef DISTANCE_ATTENUATION
					float ratio=1.-(worldPosition.y/maxDistance);
					float attenuation=ratio*ratio;
					op=opacity*attenuation;
				#endif
				#ifdef FRESNEL
					op*=fresnelCoe;
				#endif
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );
			#else
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );
			#endif
		}
	`},B in nW?nV(nW,B,{enumerable:!0,configurable:!0,writable:!0,value:S}):nW[B]=S;var nX=Object.defineProperty,nY=(e,t,r)=>t in e?nX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,nK=(e,t,r)=>(nY(e,"symbol"!=typeof t?t+"":t,r),r);let nJ={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new ee.Pa4},up:{value:new ee.Pa4(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${tk.i>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},nq=new ee.jyz({name:"SkyShader",fragmentShader:nJ.fragmentShader,vertexShader:nJ.vertexShader,uniforms:ee.rDY.clone(nJ.uniforms),side:ee._Li,depthWrite:!1});class nZ extends ee.Kj0{constructor(){super(new ee.DvJ(1,1,1),nq)}}nK(nZ,"SkyShader",nJ),nK(nZ,"material",nq);var n$=Object.defineProperty;let n0=class extends ee.Kj0{constructor(e,t={}){super(e),this.isWater=!0,this.type="Water";let r=this,n=new ee.Ilk(void 0!==t.color?t.color:16777215),a=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.flowDirection||new ee.FM8(1,0),h=t.flowSpeed||.03,c=t.reflectivity||.02,u=t.scale||1,d=t.shader||n0.WaterShader,m=void 0!==t.encoding?t.encoding:3e3,p=t.flowMap||void 0,A=t.normalMap0,f=t.normalMap1,g=new ee.yGw,v=new ee.SUY;if(void 0===np){console.error("THREE.Water: Required component Reflector not found.");return}if(void 0===ng){console.error("THREE.Water: Required component Refractor not found.");return}let y=new np(e,{textureWidth:a,textureHeight:s,clipBias:o,encoding:m}),x=new ng(e,{textureWidth:a,textureHeight:s,clipBias:o,encoding:m});y.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new ee.jyz({uniforms:ee.rDY.merge([ee.rBU.fog,d.uniforms]),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:p}):this.material.uniforms.flowDirection={type:"v2",value:l},A.wrapS=A.wrapT=ee.rpg,f.wrapS=f.wrapT=ee.rpg,this.material.uniforms.tReflectionMap.value=y.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=A,this.material.uniforms.tNormalMap1.value=f,this.material.uniforms.color.value=n,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=g,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=.075,this.material.uniforms.config.value.z=.075,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(e,t,n){g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiply(n.projectionMatrix),g.multiply(n.matrixWorldInverse),g.multiply(r.matrixWorld),function(){let e=v.getDelta(),t=r.material.uniforms.config;t.value.x+=h*e,t.value.y=t.value.x+.075,t.value.x>=.15?(t.value.x=0,t.value.y=.075):t.value.y>=.15&&(t.value.y=t.value.y-.15)}(),r.visible=!1,y.matrixWorld.copy(r.matrixWorld),x.matrixWorld.copy(r.matrixWorld),y.onBeforeRender(e,t,n),x.onBeforeRender(e,t,n),r.visible=!0}}},n1=n0;T="symbol"!=typeof(z="WaterShader")?z+"":z,F={uniforms:{color:{value:null},reflectivity:{value:0},tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap0:{value:null},tNormalMap1:{value:null},textureMatrix:{value:null},config:{value:new ee.Ltg}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <${tk.i>=154?"colorspace_fragment":"encodings_fragment"}>
			#include <fog_fragment>

		}`},T in n1?n$(n1,T,{enumerable:!0,configurable:!0,writable:!0,value:F}):n1[T]=F;let n2=e=>e&&e.isCubeTexture;class n3 extends ee.Kj0{constructor(e,t){var r,n;let a=n2(e),s=Math.floor(Math.log2((null!=(n=a?null==(r=e.image[0])?void 0:r.width:e.image.width)?n:1024)/4)),o=Math.pow(2,s),l=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,h=[a?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(o,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*o)}`,`#define CUBEUV_MAX_MIP ${s}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(ee.UZH.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `;super(new ee.cJO(1,16),new ee.jyz({uniforms:{map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}},fragmentShader:h,vertexShader:l,side:ee.ehD}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}let n4={createMeshesFromInstancedMesh:function(e){let t=new ee.ZAu,r=e.count,n=e.geometry,a=e.material;for(let s=0;s<r;s++){let r=new ee.Kj0(n,a);e.getMatrixAt(s,r.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale),t.add(r)}return t.copy(e),t.updateMatrixWorld(),t},createMultiMaterialObject:function(e,t){let r=new ee.ZAu;for(let n=0,a=t.length;n<a;n++)r.add(new ee.Kj0(e,t[n]));return r},detach:function(e,t,r){console.warn("THREE.SceneUtils: detach() has been deprecated. Use scene.attach( child ) instead."),r.attach(e)},attach:function(e,t,r){console.warn("THREE.SceneUtils: attach() has been deprecated. Use parent.attach( child ) instead."),r.attach(e)}};function n5(e,t=1024){let r=new ee.FM8,n=new ee.FM8,a=[new ee.FM8,new ee.FM8,new ee.FM8],s=[],o=document.createElement("canvas");o.width=t,o.height=t;let l=o.getContext("2d");l.lineWidth=1,l.strokeStyle="rgb( 63, 63, 63 )",l.textAlign="center",l.fillStyle="rgb( 255, 255, 255 )",l.fillRect(0,0,t,t);let h=e.index,c=e.attributes.uv;if(h)for(let e=0,t=h.count;e<t;e+=3)s[0]=h.getX(e),s[1]=h.getX(e+1),s[2]=h.getX(e+2),a[0].fromBufferAttribute(c,s[0]),a[1].fromBufferAttribute(c,s[1]),a[2].fromBufferAttribute(c,s[2]),u(s,a,e/3);else for(let e=0,t=c.count;e<t;e+=3)s[0]=e,s[1]=e+1,s[2]=e+2,a[0].fromBufferAttribute(c,s[0]),a[1].fromBufferAttribute(c,s[1]),a[2].fromBufferAttribute(c,s[2]),u(s,a,e/3);return o;function u(e,a,s){l.beginPath(),r.set(0,0);for(let e=0,n=a.length;e<n;e++){let n=a[e];r.x+=n.x,r.y+=n.y,0===e?l.moveTo(n.x*(t-2)+.5,(1-n.y)*(t-2)+.5):l.lineTo(n.x*(t-2)+.5,(1-n.y)*(t-2)+.5)}l.closePath(),l.stroke(),r.divideScalar(a.length),l.font="18px Arial",l.fillStyle="rgb( 63, 63, 63 )",l.fillText(s,r.x*t,(1-r.y)*t),r.x>.95&&l.fillText(s,r.x%1*t,(1-r.y)*t),l.font="12px Arial",l.fillStyle="rgb( 191, 191, 191 )";for(let s=0,o=a.length;s<o;s++){let o=a[s];n.addVectors(r,o).divideScalar(2);let h=e[s];l.fillText("abc"[s]+h,n.x*t,(1-n.y)*t),n.x>.95&&l.fillText("abc"[s]+h,n.x%1*t,(1-n.y)*t)}}}let n8=(e=new ee.Pa4(0,0,0),t=10,r=1,n=0,a=1,s=2,o=3)=>{let l=t/2,h=[new ee.Pa4(e.x-l,e.y,e.z-l),new ee.Pa4(e.x-l,e.y,e.z+l),new ee.Pa4(e.x+l,e.y,e.z+l),new ee.Pa4(e.x+l,e.y,e.z-l)],c=[h[n],h[a],h[s],h[o]];if(0<=--r){let e=[];return Array.prototype.push.apply(e,n8(c[0],l,r,n,o,s,a)),Array.prototype.push.apply(e,n8(c[1],l,r,n,a,s,o)),Array.prototype.push.apply(e,n8(c[2],l,r,n,a,s,o)),Array.prototype.push.apply(e,n8(c[3],l,r,s,a,n,o)),e}return c},n6=(e=new ee.Pa4(0,0,0),t=10,r=1,n=0,a=1,s=2,o=3,l=4,h=5,c=6,u=7)=>{let d=t/2,m=[new ee.Pa4(e.x-d,e.y+d,e.z-d),new ee.Pa4(e.x-d,e.y+d,e.z+d),new ee.Pa4(e.x-d,e.y-d,e.z+d),new ee.Pa4(e.x-d,e.y-d,e.z-d),new ee.Pa4(e.x+d,e.y-d,e.z-d),new ee.Pa4(e.x+d,e.y-d,e.z+d),new ee.Pa4(e.x+d,e.y+d,e.z+d),new ee.Pa4(e.x+d,e.y+d,e.z-d)],p=[m[n],m[a],m[s],m[o],m[l],m[h],m[c],m[u]];if(--r>=0){let e=[];return Array.prototype.push.apply(e,n6(p[0],d,r,n,o,l,u,c,h,s,a)),Array.prototype.push.apply(e,n6(p[1],d,r,n,u,c,a,s,h,l,o)),Array.prototype.push.apply(e,n6(p[2],d,r,n,u,c,a,s,h,l,o)),Array.prototype.push.apply(e,n6(p[3],d,r,s,o,n,a,c,u,l,h)),Array.prototype.push.apply(e,n6(p[4],d,r,s,o,n,a,c,u,l,h)),Array.prototype.push.apply(e,n6(p[5],d,r,l,o,s,h,c,a,n,u)),Array.prototype.push.apply(e,n6(p[6],d,r,l,o,s,h,c,a,n,u)),Array.prototype.push.apply(e,n6(p[7],d,r,c,h,s,a,n,o,l,u)),e}return p},n9={hilbert3D:n6,gosper:(e=1)=>(function(e){let t=0,r=0,n=0,a=[0,0,0],s=e.fractal;for(let o=0,l=s.length;o<l;o++){let l=s[o];"+"===l?n+=e.angle:"-"===l?n-=e.angle:"F"===l&&(t+=e.size*Math.cos(n),r+=-e.size*Math.sin(n),a.push(t,r,0))}return a})({fractal:function(e){let t="",r=e.axiom;for(let n=0,a=e.steps;0<=a?n<a:n>a;0<=a?n++:n--){t="";for(let n=0,a=r.length;n<a;n++){let a=r[n];a in e.rules?t+=e.rules[a]:t+=a}r=t}return t}({axiom:"A",steps:4,rules:{A:"A+BF++BF-FA--FAFA-BF+",B:"-FA+BFBF++BF+FA--FA-B"}}),size:e,angle:Math.PI/3}),hilbert2D:n8};var n7=Object.defineProperty,ae=(e,t,r)=>t in e?n7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,at=(e,t,r)=>(ae(e,"symbol"!=typeof t?t+"":t,r),r),ai=((U=new ee.FIo({uniforms:{roughnessMap:{value:null},normalMap:{value:null},texelSize:{value:new ee.FM8(1,1)}},vertexShader:`
			precision mediump float;
			precision mediump int;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {

				vUv = uv;

				gl_Position = vec4( position, 1.0 );

			}
		`,fragmentShader:`
			precision mediump float;
			precision mediump int;

			varying vec2 vUv;

			uniform sampler2D roughnessMap;
			uniform sampler2D normalMap;
			uniform vec2 texelSize;

			#define ENVMAP_TYPE_CUBE_UV

			vec4 envMapTexelToLinear( vec4 a ) { return a; }

			#include <cube_uv_reflection_fragment>

			float roughnessToVariance( float roughness ) {

				float variance = 0.0;

				if ( roughness >= r1 ) {

					variance = ( r0 - roughness ) * ( v1 - v0 ) / ( r0 - r1 ) + v0;

				} else if ( roughness >= r4 ) {

					variance = ( r1 - roughness ) * ( v4 - v1 ) / ( r1 - r4 ) + v1;

				} else if ( roughness >= r5 ) {

					variance = ( r4 - roughness ) * ( v5 - v4 ) / ( r4 - r5 ) + v4;

				} else {

					float roughness2 = roughness * roughness;

					variance = 1.79 * roughness2 * roughness2;

				}

				return variance;

			}

			float varianceToRoughness( float variance ) {

				float roughness = 0.0;

				if ( variance >= v1 ) {

					roughness = ( v0 - variance ) * ( r1 - r0 ) / ( v0 - v1 ) + r0;

				} else if ( variance >= v4 ) {

					roughness = ( v1 - variance ) * ( r4 - r1 ) / ( v1 - v4 ) + r1;

				} else if ( variance >= v5 ) {

					roughness = ( v4 - variance ) * ( r5 - r4 ) / ( v4 - v5 ) + r4;

				} else {

					roughness = pow( 0.559 * variance, 0.25 ); // 0.559 = 1.0 / 1.79

				}

				return roughness;

			}

			void main() {

				gl_FragColor = texture2D( roughnessMap, vUv, - 1.0 );

				if ( texelSize.x == 0.0 ) return;

				float roughness = gl_FragColor.g;

				float variance = roughnessToVariance( roughness );

				vec3 avgNormal;

				for ( float x = - 1.0; x < 2.0; x += 2.0 ) {

					for ( float y = - 1.0; y < 2.0; y += 2.0 ) {

						vec2 uv = vUv + vec2( x, y ) * 0.25 * texelSize;

						avgNormal += normalize( texture2D( normalMap, uv, - 1.0 ).xyz - 0.5 );

					}

				}

				variance += 1.0 - 0.25 * length( avgNormal );

				gl_FragColor.g = varianceToRoughness( variance );

			}
		`,blending:ee.jFi,depthTest:!1,depthWrite:!1})).type="RoughnessMipmapper",U),ar=new ee.Kj0(new ee._12(2,2),ai),an=new ee.iKG(0,1,0,1,0,1),aa=null;class as{constructor(e){at(this,"generateMipmaps",function(e){if("roughnessMap"in e!=!1){var{roughnessMap:t,normalMap:r}=e;if(null!==t&&null!==r&&t.generateMipmaps&&!e.userData.roughnessUpdated){e.userData.roughnessUpdated=!0;var n=Math.max(t.image.width,r.image.width),a=Math.max(t.image.height,r.image.height);if(ee.M8C.isPowerOfTwo(n)&&ee.M8C.isPowerOfTwo(a)){var s=this._renderer.getRenderTarget(),o=this._renderer.autoClear;if(this._renderer.autoClear=!1,(null===aa||aa.width!==n||aa.height!==a)&&(null!==aa&&aa.dispose(),(aa=new ee.dd2(n,a,{depthBuffer:!1})).scissorTest=!0),n!==t.image.width||a!==t.image.height){var l={wrapS:t.wrapS,wrapT:t.wrapT,magFilter:t.magFilter,minFilter:t.minFilter,depthBuffer:!1},h=new ee.dd2(n,a,l);h.texture.generateMipmaps=!0,this._renderer.setRenderTarget(h),e.roughnessMap=h.texture,e.metalnessMap==t&&(e.metalnessMap=e.roughnessMap),e.aoMap==t&&(e.aoMap=e.roughnessMap)}ai.uniforms.roughnessMap.value=t,ai.uniforms.normalMap.value=r;var c=new ee.FM8(0,0),u=ai.uniforms.texelSize.value;for(let t=0;n>=1&&a>=1;++t,n/=2,a/=2)u.set(1/n,1/a),0==t&&u.set(0,0),aa.viewport.set(c.x,c.y,n,a),aa.scissor.set(c.x,c.y,n,a),this._renderer.setRenderTarget(aa),this._renderer.render(ar,an),this._renderer.copyFramebufferToTexture(c,e.roughnessMap,t),ai.uniforms.roughnessMap.value=e.roughnessMap;t!==e.roughnessMap&&t.dispose(),this._renderer.setRenderTarget(s),this._renderer.autoClear=o}}}}),at(this,"dispose",function(){ai.dispose(),ar.geometry.dispose(),null!=aa&&aa.dispose()}),this._renderer=e,this._renderer.compile(ar,an)}}function ao(e,t,r={}){let n,a,s,o,l;let h=new ee.Pa4,c=new ee._fP,u=new ee.Pa4,d=new ee.yGw,m=new ee.yGw,p=new ee.yGw;r.preserveMatrix=void 0===r.preserveMatrix||r.preserveMatrix,r.preservePosition=void 0===r.preservePosition||r.preservePosition,r.preserveHipPosition=void 0!==r.preserveHipPosition&&r.preserveHipPosition,r.useTargetMatrix=void 0!==r.useTargetMatrix&&r.useTargetMatrix,r.hip=void 0!==r.hip?r.hip:"hip",r.names=r.names||{};let A=t.isObject3D?t.skeleton.bones:ah(t),f=e.isObject3D?e.skeleton.bones:ah(e);if(e.isObject3D?e.skeleton.pose():(r.useTargetMatrix=!0,r.preserveMatrix=!1),r.preservePosition){l=[];for(let e=0;e<f.length;e++)l.push(f[e].position.clone())}if(r.preserveMatrix){e.updateMatrixWorld(),e.matrixWorld.identity();for(let t=0;t<e.children.length;++t)e.children[t].updateMatrixWorld(!0)}if(r.offsets){n=[];for(let e=0;e<f.length;++e)a=f[e],s=r.names[a.name]||a.name,r.offsets[s]&&(a.matrix.multiply(r.offsets[s]),a.matrix.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld()),n.push(a.matrixWorld.clone())}for(let t=0;t<f.length;++t){if(a=f[t],o=al(s=r.names[a.name]||a.name,A),p.copy(a.matrixWorld),o){if(o.updateMatrixWorld(),r.useTargetMatrix?m.copy(o.matrixWorld):(m.copy(e.matrixWorld).invert(),m.multiply(o.matrixWorld)),u.setFromMatrixScale(m),m.scale(u.set(1/u.x,1/u.y,1/u.z)),p.makeRotationFromQuaternion(c.setFromRotationMatrix(m)),e.isObject3D){let t=f.indexOf(a),r=n?n[t]:d.copy(e.skeleton.boneInverses[t]).invert();p.multiply(r)}p.copyPosition(m)}a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(p)):a.matrix.copy(p),r.preserveHipPosition&&s===r.hip&&a.matrix.setPosition(h.set(0,a.position.y,0)),a.matrix.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld()}if(r.preservePosition)for(let e=0;e<f.length;++e)a=f[e],(s=r.names[a.name]||a.name)!==r.hip&&a.position.copy(l[e]);r.preserveMatrix&&e.updateMatrixWorld(!0)}function al(e,t){for(let r=0,n=ah(t);r<n.length;r++)if(e===n[r].name)return n[r]}function ah(e){return Array.isArray(e)?e:e.bones}let ac={retarget:ao,retargetClip:function(e,t,r,n={}){let a,s,o,l;n.useFirstFramePosition=void 0!==n.useFirstFramePosition&&n.useFirstFramePosition,n.fps=void 0!==n.fps?n.fps:30,n.names=n.names||[],t.isObject3D||(t=function(e){let t=new ee._YX(e.bones[0]);return t.skeleton=e,t}(t));let h=Math.round(r.duration*(n.fps/1e3)*1e3),c=1/n.fps,u=[],d=new ee.Xcj(t),m=ah(e.skeleton),p=[];d.clipAction(r).play(),d.update(0),t.updateMatrixWorld();for(let r=0;r<h;++r){let u=r*c;ao(e,t,n);for(let e=0;e<m.length;++e)al(l=n.names[m[e].name]||m[e].name,t.skeleton)&&(s=m[e],o=p[e]=p[e]||{bone:s},n.hip===l&&(o.pos||(o.pos={times:new Float32Array(h),values:new Float32Array(3*h)}),n.useFirstFramePosition&&(0===r&&(a=s.position.clone()),s.position.sub(a)),o.pos.times[r]=u,s.position.toArray(o.pos.values,3*r)),o.quat||(o.quat={times:new Float32Array(h),values:new Float32Array(4*h)}),o.quat.times[r]=u,s.quaternion.toArray(o.quat.values,4*r));d.update(c),t.updateMatrixWorld()}for(let e=0;e<p.length;++e)(o=p[e])&&(o.pos&&u.push(new ee.yC1(".bones["+o.bone.name+"].position",o.pos.times,o.pos.values)),u.push(new ee.iLg(".bones["+o.bone.name+"].quaternion",o.quat.times,o.quat.values)));return d.uncacheAction(r),new ee.m7l(r.name,-1,u)},clone:function(e){let t=new Map,r=new Map,n=e.clone();return function e(t,r,n){n(t,r);for(let a=0;a<t.children.length;a++)e(t.children[a],r.children[a],n)}(e,n,function(e,n){t.set(n,e),r.set(e,n)}),n.traverse(function(e){if(!e.isSkinnedMesh)return;let n=t.get(e),a=n.skeleton.bones;e.skeleton=n.skeleton.clone(),e.bindMatrix.copy(n.bindMatrix),e.skeleton.bones=a.map(function(e){return r.get(e)}),e.bind(e.skeleton,e.bindMatrix)}),n}},au={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\n#include <packing>\nvoid main() {\n	float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n	gl_FragColor = vec4( vec3( depth ), opacity );\n}"};class ad{constructor(e){let t,r,n;let a=this,s=void 0!==e.name&&""!==e.name,o=new ee.iKG(-(window.innerWidth/2),window.innerWidth/2,window.innerHeight/2,-(window.innerHeight/2),1,10);o.position.set(0,0,2);let l=new ee.xsS,h=ee.rDY.clone(au.uniforms),c=new ee.jyz({uniforms:h,vertexShader:au.vertexShader,fragmentShader:au.fragmentShader}),u=new ee._12(256,256),d=new ee.Kj0(u,c);if(l.add(d),s){let t=(r=document.createElement("canvas")).getContext("2d");t.font="Bold 20px Arial";let a=t.measureText(e.name).width;r.width=a,r.height=25,t.font="Bold 20px Arial",t.fillStyle="rgba( 255, 0, 0, 1 )",t.fillText(e.name,0,20);let s=new ee.xEZ(r);s.magFilter=ee.wem,s.minFilter=ee.wem,s.needsUpdate=!0;let o=new ee.vBJ({map:s,side:ee.ehD});o.transparent=!0;let h=new ee._12(r.width,r.height);n=new ee.Kj0(h,o),l.add(n)}this.enabled=!0,this.size={width:256,height:256,set:function(e,t){this.width=e,this.height=t,d.scale.set(this.width/256,this.height/256,1),a.position.set(a.position.x,a.position.y)}},this.position={x:10,y:10,set:function(e,t){this.x=e,this.y=t;let o=a.size.width,l=a.size.height;d.position.set(-window.innerWidth/2+o/2+this.x,window.innerHeight/2-l/2-this.y,0),s&&n.position.set(d.position.x,d.position.y-a.size.height/2+r.height/2,0)}},this.render=function(r){this.enabled&&(h.tDiffuse.value=e.shadow.map.texture,t=r.autoClear,r.autoClear=!1,r.clearDepth(),r.render(l,o),r.autoClear=t)},this.updateForWindowResize=function(){this.enabled&&(o.left=-(window.innerWidth/2),o.right=window.innerWidth/2,o.top=window.innerHeight/2,o.bottom=-(window.innerHeight/2),o.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()}}var am={compressNormals:function(e,t){let r;e.geometry||console.error("Mesh must contain geometry. ");let n=e.geometry.attributes.normal;if(n||console.error("Geometry must contain normal attribute. "),n.isPacked)return;3!=n.itemSize&&console.error("normal.itemSize is not 3, which cannot be encoded. ");let a=n.array,s=n.count;if("DEFAULT"==t){r=new Uint8Array(3*s);for(let e=0;e<a.length;e+=3){let t=this.EncodingFuncs.defaultEncode(a[e],a[e+1],a[e+2],1);r[e+0]=t[0],r[e+1]=t[1],r[e+2]=t[2]}e.geometry.setAttribute("normal",new ee.TlE(r,3,!0)),e.geometry.attributes.normal.bytes=1*r.length}else if("OCT1Byte"==t){r=new Int8Array(2*s);for(let e=0;e<a.length;e+=3){let t=this.EncodingFuncs.octEncodeBest(a[e],a[e+1],a[e+2],1);r[e/3*2+0]=t[0],r[e/3*2+1]=t[1]}e.geometry.setAttribute("normal",new ee.TlE(r,2,!0)),e.geometry.attributes.normal.bytes=1*r.length}else if("OCT2Byte"==t){r=new Int16Array(2*s);for(let e=0;e<a.length;e+=3){let t=this.EncodingFuncs.octEncodeBest(a[e],a[e+1],a[e+2],2);r[e/3*2+0]=t[0],r[e/3*2+1]=t[1]}e.geometry.setAttribute("normal",new ee.TlE(r,2,!0)),e.geometry.attributes.normal.bytes=2*r.length}else if("ANGLES"==t){r=new Uint16Array(2*s);for(let e=0;e<a.length;e+=3){let t=this.EncodingFuncs.anglesEncode(a[e],a[e+1],a[e+2]);r[e/3*2+0]=t[0],r[e/3*2+1]=t[1]}e.geometry.setAttribute("normal",new ee.TlE(r,2,!0)),e.geometry.attributes.normal.bytes=2*r.length}else console.error("Unrecognized encoding method, should be `DEFAULT` or `ANGLES` or `OCT`. ");e.geometry.attributes.normal.needsUpdate=!0,e.geometry.attributes.normal.isPacked=!0,e.geometry.attributes.normal.packingMethod=t,e.material instanceof ap||(e.material=new ap().copy(e.material)),"ANGLES"==t&&(e.material.defines.USE_PACKED_NORMAL=0),"OCT1Byte"==t&&(e.material.defines.USE_PACKED_NORMAL=1),"OCT2Byte"==t&&(e.material.defines.USE_PACKED_NORMAL=1),"DEFAULT"==t&&(e.material.defines.USE_PACKED_NORMAL=2)},compressPositions:function(e){e.geometry||console.error("Mesh must contain geometry. ");let t=e.geometry.attributes.position;if(t||console.error("Geometry must contain position attribute. "),t.isPacked)return;3!=t.itemSize&&console.error("position.itemSize is not 3, which cannot be packed. ");let r=t.array,n=this.EncodingFuncs.quantizedEncode(r,2),a=n.quantized,s=n.decodeMat;null==e.geometry.boundingBox&&e.geometry.computeBoundingBox(),null==e.geometry.boundingSphere&&e.geometry.computeBoundingSphere(),e.geometry.setAttribute("position",new ee.TlE(a,3)),e.geometry.attributes.position.isPacked=!0,e.geometry.attributes.position.needsUpdate=!0,e.geometry.attributes.position.bytes=2*a.length,e.material instanceof ap||(e.material=new ap().copy(e.material)),e.material.defines.USE_PACKED_POSITION=0,e.material.uniforms.quantizeMatPos.value=s,e.material.uniforms.quantizeMatPos.needsUpdate=!0},compressUvs:function(e){let t;e.geometry||console.error("Mesh must contain geometry property. ");let r=e.geometry.attributes.uv;if(r||console.error("Geometry must contain uv attribute. "),r.isPacked)return;let n={min:1/0,max:-1/0},a=r.array;for(let e=0;e<a.length;e++)n.min=Math.min(n.min,a[e]),n.max=Math.max(n.max,a[e]);if(n.min>=-1&&n.max<=1){t=new Uint16Array(a.length);for(let e=0;e<a.length;e+=2){let r=this.EncodingFuncs.defaultEncode(a[e],a[e+1],0,2);t[e]=r[0],t[e+1]=r[1]}e.geometry.setAttribute("uv",new ee.TlE(t,2,!0)),e.geometry.attributes.uv.isPacked=!0,e.geometry.attributes.uv.needsUpdate=!0,e.geometry.attributes.uv.bytes=2*t.length,e.material instanceof ap||(e.material=new ap().copy(e.material)),e.material.defines.USE_PACKED_UV=0}else t=this.EncodingFuncs.quantizedEncodeUV(a,2),e.geometry.setAttribute("uv",new ee.TlE(t.quantized,2)),e.geometry.attributes.uv.isPacked=!0,e.geometry.attributes.uv.needsUpdate=!0,e.geometry.attributes.uv.bytes=2*t.quantized.length,e.material instanceof ap||(e.material=new ap().copy(e.material)),e.material.defines.USE_PACKED_UV=1,e.material.uniforms.quantizeMatUV.value=t.decodeMat,e.material.uniforms.quantizeMatUV.needsUpdate=!0},EncodingFuncs:{defaultEncode:function(e,t,r,n){return 1==n?new Uint8Array([Math.round((e+1)*127.5),Math.round((t+1)*127.5),Math.round((r+1)*127.5)]):2==n?new Uint16Array([Math.round((e+1)*32767.5),Math.round((t+1)*32767.5),Math.round((r+1)*32767.5)]):void console.error("number of bytes must be 1 or 2")},defaultDecode:function(e,t){return 1==t?[e[0]/255*2-1,e[1]/255*2-1,e[2]/255*2-1]:2==t?[e[0]/65535*2-1,e[1]/65535*2-1,e[2]/65535*2-1]:void console.error("number of bytes must be 1 or 2")},anglesEncode:function(e,t,r){return new Uint16Array([parseInt(.5*(1+Math.atan2(t,e)/Math.PI)*65535),parseInt(.5*(1+r)*65535)])},octEncodeBest:function(e,t,r,n){var a,s,o,l,h;return o=a=c(e,t,r,"floor","floor"),h=d(e,t,r,s=u(a)),s=u(a=c(e,t,r,"ceil","floor")),(l=d(e,t,r,s))>h&&(o=a,h=l),s=u(a=c(e,t,r,"floor","ceil")),(l=d(e,t,r,s))>h&&(o=a,h=l),s=u(a=c(e,t,r,"ceil","ceil")),(l=d(e,t,r,s))>h&&(o=a),o;function c(e,t,a,s,o){var l=e/(Math.abs(e)+Math.abs(t)+Math.abs(a)),h=t/(Math.abs(e)+Math.abs(t)+Math.abs(a));if(r<0){var c=(1-Math.abs(h))*(l>=0?1:-1),u=(1-Math.abs(l))*(h>=0?1:-1),d=1-Math.abs(l=c)-Math.abs(h=u);d>0&&(d+=.001,l+=l>0?d/2:-d/2,h+=h>0?d/2:-d/2)}return 1==n?new Int8Array([Math[s](127.5*l+(l<0?1:0)),Math[o](127.5*h+(h<0?1:0))]):2==n?new Int16Array([Math[s](32767.5*l+(l<0?1:0)),Math[o](32767.5*h+(h<0?1:0))]):void 0}function u(e){var t=e[0],r=e[1];1==n?(t/=t<0?127:128,r/=r<0?127:128):2==n&&(t/=t<0?32767:32768,r/=r<0?32767:32768);var a=1-Math.abs(t)-Math.abs(r);if(a<0){var s=t;t=(1-Math.abs(r))*(t>=0?1:-1),r=(1-Math.abs(s))*(r>=0?1:-1)}var o=Math.sqrt(t*t+r*r+a*a);return[t/o,r/o,a/o]}function d(e,t,r,n){return e*n[0]+t*n[1]+r*n[2]}},quantizedEncode:function(e,t){let r,n;1==t?(r=new Uint8Array(e.length),n=255):2==t?(r=new Uint16Array(e.length),n=65535):console.error("number of bytes error! ");let a=new ee.yGw,s=new Float32Array(3),o=new Float32Array(3);s[0]=s[1]=s[2]=Number.MAX_VALUE,o[0]=o[1]=o[2]=-Number.MAX_VALUE;for(let t=0;t<e.length;t+=3)s[0]=Math.min(s[0],e[t+0]),s[1]=Math.min(s[1],e[t+1]),s[2]=Math.min(s[2],e[t+2]),o[0]=Math.max(o[0],e[t+0]),o[1]=Math.max(o[1],e[t+1]),o[2]=Math.max(o[2],e[t+2]);a.scale(new ee.Pa4((o[0]-s[0])/n,(o[1]-s[1])/n,(o[2]-s[2])/n)),a.elements[12]=s[0],a.elements[13]=s[1],a.elements[14]=s[2],a.transpose();let l=new Float32Array([o[0]!==s[0]?n/(o[0]-s[0]):0,o[1]!==s[1]?n/(o[1]-s[1]):0,o[2]!==s[2]?n/(o[2]-s[2]):0]);for(let t=0;t<e.length;t+=3)r[t+0]=Math.floor((e[t+0]-s[0])*l[0]),r[t+1]=Math.floor((e[t+1]-s[1])*l[1]),r[t+2]=Math.floor((e[t+2]-s[2])*l[2]);return{quantized:r,decodeMat:a}},quantizedEncodeUV:function(e,t){let r,n;1==t?(r=new Uint8Array(e.length),n=255):2==t?(r=new Uint16Array(e.length),n=65535):console.error("number of bytes error! ");let a=new ee.Vkp,s=new Float32Array(2),o=new Float32Array(2);s[0]=s[1]=Number.MAX_VALUE,o[0]=o[1]=-Number.MAX_VALUE;for(let t=0;t<e.length;t+=2)s[0]=Math.min(s[0],e[t+0]),s[1]=Math.min(s[1],e[t+1]),o[0]=Math.max(o[0],e[t+0]),o[1]=Math.max(o[1],e[t+1]);a.scale((o[0]-s[0])/n,(o[1]-s[1])/n),a.elements[6]=s[0],a.elements[7]=s[1],a.transpose();let l=new Float32Array([o[0]!==s[0]?n/(o[0]-s[0]):0,o[1]!==s[1]?n/(o[1]-s[1]):0]);for(let t=0;t<e.length;t+=2)r[t+0]=Math.floor((e[t+0]-s[0])*l[0]),r[t+1]=Math.floor((e[t+1]-s[1])*l[1]);return{quantized:r,decodeMat:a}}}};class ap extends ee.xoR{constructor(e){super(),this.defines={},this.type="PackedPhongMaterial",this.uniforms=ee.rDY.merge([ee.Vj0.phong.uniforms,{quantizeMatPos:{value:null},quantizeMatUV:{value:null}}]),this.vertexShader=["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif",ee.WdD.common,ee.WdD.uv_pars_vertex,ee.WdD.uv2_pars_vertex,ee.WdD.displacementmap_pars_vertex,ee.WdD.envmap_pars_vertex,ee.WdD.color_pars_vertex,ee.WdD.fog_pars_vertex,ee.WdD.morphtarget_pars_vertex,ee.WdD.skinning_pars_vertex,ee.WdD.shadowmap_pars_vertex,ee.WdD.logdepthbuf_pars_vertex,ee.WdD.clipping_planes_pars_vertex,`#ifdef USE_PACKED_NORMAL
					#if USE_PACKED_NORMAL == 0
						vec3 decodeNormal(vec3 packedNormal)
						{
							float x = packedNormal.x * 2.0 - 1.0;
							float y = packedNormal.y * 2.0 - 1.0;
							vec2 scth = vec2(sin(x * PI), cos(x * PI));
							vec2 scphi = vec2(sqrt(1.0 - y * y), y);
							return normalize( vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y) );
						}
					#endif

					#if USE_PACKED_NORMAL == 1
						vec3 decodeNormal(vec3 packedNormal)
						{
							vec3 v = vec3(packedNormal.xy, 1.0 - abs(packedNormal.x) - abs(packedNormal.y));
							if (v.z < 0.0)
							{
								v.xy = (1.0 - abs(v.yx)) * vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);
							}
							return normalize(v);
						}
					#endif

					#if USE_PACKED_NORMAL == 2
						vec3 decodeNormal(vec3 packedNormal)
						{
							vec3 v = (packedNormal * 2.0) - 1.0;
							return normalize(v);
						}
					#endif
				#endif`,`#ifdef USE_PACKED_POSITION
					#if USE_PACKED_POSITION == 0
						uniform mat4 quantizeMatPos;
					#endif
				#endif`,`#ifdef USE_PACKED_UV
					#if USE_PACKED_UV == 1
						uniform mat3 quantizeMatUV;
					#endif
				#endif`,`#ifdef USE_PACKED_UV
					#if USE_PACKED_UV == 0
						vec2 decodeUV(vec2 packedUV)
						{
							vec2 uv = (packedUV * 2.0) - 1.0;
							return uv;
						}
					#endif

					#if USE_PACKED_UV == 1
						vec2 decodeUV(vec2 packedUV)
						{
							vec2 uv = ( vec3(packedUV, 1.0) * quantizeMatUV ).xy;
							return uv;
						}
					#endif
				#endif`,"void main() {",ee.WdD.uv_vertex,`#ifdef USE_UV
					#ifdef USE_PACKED_UV
						vUv = decodeUV(vUv);
					#endif
				#endif`,ee.WdD.uv2_vertex,ee.WdD.color_vertex,ee.WdD.beginnormal_vertex,`#ifdef USE_PACKED_NORMAL
					objectNormal = decodeNormal(objectNormal);
				#endif

				#ifdef USE_TANGENT
					vec3 objectTangent = vec3( tangent.xyz );
				#endif
				`,ee.WdD.morphnormal_vertex,ee.WdD.skinbase_vertex,ee.WdD.skinnormal_vertex,ee.WdD.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",ee.WdD.begin_vertex,`#ifdef USE_PACKED_POSITION
					#if USE_PACKED_POSITION == 0
						transformed = ( vec4(transformed, 1.0) * quantizeMatPos ).xyz;
					#endif
				#endif`,ee.WdD.morphtarget_vertex,ee.WdD.skinning_vertex,ee.WdD.displacementmap_vertex,ee.WdD.project_vertex,ee.WdD.logdepthbuf_vertex,ee.WdD.clipping_planes_vertex,"vViewPosition = - mvPosition.xyz;",ee.WdD.worldpos_vertex,ee.WdD.envmap_vertex,ee.WdD.shadowmap_vertex,ee.WdD.fog_vertex,"}"].join("\n"),this.fragmentShader=["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",ee.WdD.common,ee.WdD.packing,ee.WdD.dithering_pars_fragment,ee.WdD.color_pars_fragment,ee.WdD.uv_pars_fragment,ee.WdD.uv2_pars_fragment,ee.WdD.map_pars_fragment,ee.WdD.alphamap_pars_fragment,ee.WdD.aomap_pars_fragment,ee.WdD.lightmap_pars_fragment,ee.WdD.emissivemap_pars_fragment,ee.WdD.envmap_common_pars_fragment,ee.WdD.envmap_pars_fragment,ee.WdD.cube_uv_reflection_fragment,ee.WdD.fog_pars_fragment,ee.WdD.bsdfs,ee.WdD.lights_pars_begin,ee.WdD.lights_phong_pars_fragment,ee.WdD.shadowmap_pars_fragment,ee.WdD.bumpmap_pars_fragment,ee.WdD.normalmap_pars_fragment,ee.WdD.specularmap_pars_fragment,ee.WdD.logdepthbuf_pars_fragment,ee.WdD.clipping_planes_pars_fragment,"void main() {",ee.WdD.clipping_planes_fragment,"vec4 diffuseColor = vec4( diffuse, opacity );","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","vec3 totalEmissiveRadiance = emissive;",ee.WdD.logdepthbuf_fragment,ee.WdD.map_fragment,ee.WdD.color_fragment,ee.WdD.alphamap_fragment,ee.WdD.alphatest_fragment,ee.WdD.specularmap_fragment,ee.WdD.normal_fragment_begin,ee.WdD.normal_fragment_maps,ee.WdD.emissivemap_fragment,ee.WdD.lights_phong_fragment,ee.WdD.lights_fragment_begin,ee.WdD.lights_fragment_maps,ee.WdD.lights_fragment_end,ee.WdD.aomap_fragment,"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;",ee.WdD.envmap_fragment,"gl_FragColor = vec4( outgoingLight, diffuseColor.a );",ee.WdD.tonemapping_fragment,parseInt(ee.UZH.replace(/\D+/g,""))>=154?ee.WdD.colorspace_fragment:ee.WdD.encodings_fragment,ee.WdD.fog_fragment,ee.WdD.premultiplied_alpha_fragment,ee.WdD.dithering_fragment,"}"].join("\n"),this.setValues(e)}}let aA={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new ee.FM8}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float textureWidth;\nuniform float textureHeight;\nuniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below\nuniform float focalLength; //focal length in mm\nuniform float fstop; //f-stop value\nuniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)\n/*\nmake sure that these two values are the same for your camera, otherwise distances will be wrong.\n*/\nuniform float znear; // camera clipping start\nuniform float zfar; // camera clipping end\n//------------------------------------------\n//user variables\nconst int samples = SAMPLES; //samples on the first ring\nconst int rings = RINGS; //ring count\nconst int maxringsamples = rings * samples;\nuniform bool manualdof; // manual dof calculation\nfloat ndofstart = 1.0; // near dof blur start\nfloat ndofdist = 2.0; // near dof blur falloff distance\nfloat fdofstart = 1.0; // far dof blur start\nfloat fdofdist = 3.0; // far dof blur falloff distance\nfloat CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)\nuniform bool vignetting; // use optical lens vignetting\nfloat vignout = 1.3; // vignetting outer border\nfloat vignin = 0.0; // vignetting inner border\nfloat vignfade = 22.0; // f-stops till vignete fades\nuniform bool shaderFocus;\n// disable if you use external focalDepth value\nuniform vec2 focusCoords;\n// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)\n// if center of screen use vec2(0.5, 0.5);\nuniform float maxblur;\n//clamp value of max blur (0.0 = no blur, 1.0 default)\nuniform float threshold; // highlight threshold;\nuniform float gain; // highlight gain;\nuniform float bias; // bokeh edge bias\nuniform float fringe; // bokeh chromatic aberration / fringing\nuniform bool noise; //use noise instead of pattern for sample dithering\nuniform float dithering;\nuniform bool depthblur; // blur the depth buffer\nfloat dbsize = 1.25; // depth blur size\n/*\nnext part is experimental\nnot looking good with small sample and ring count\nlooks okay starting from samples = 4, rings = 4\n*/\nuniform bool pentagon; //use pentagon as bokeh shape?\nfloat feather = 0.4; //pentagon shape feather\n//------------------------------------------\nfloat penta(vec2 coords) {\n	//pentagonal shape\n	float scale = float(rings) - 1.3;\n	vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);\n	vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);\n	vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);\n	vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);\n	vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);\n	vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);\n	vec4  one = vec4( 1.0 );\n	vec4 P = vec4((coords),vec2(scale, scale));\n	vec4 dist = vec4(0.0);\n	float inorout = -4.0;\n	dist.x = dot( P, HS0 );\n	dist.y = dot( P, HS1 );\n	dist.z = dot( P, HS2 );\n	dist.w = dot( P, HS3 );\n	dist = smoothstep( -feather, feather, dist );\n	inorout += dot( dist, one );\n	dist.x = dot( P, HS4 );\n	dist.y = HS5.w - abs( P.z );\n	dist = smoothstep( -feather, feather, dist );\n	inorout += dist.x;\n	return clamp( inorout, 0.0, 1.0 );\n}\nfloat bdepth(vec2 coords) {\n	// Depth buffer blur\n	float d = 0.0;\n	float kernel[9];\n	vec2 offset[9];\n	vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;\n	offset[0] = vec2(-wh.x,-wh.y);\n	offset[1] = vec2( 0.0, -wh.y);\n	offset[2] = vec2( wh.x -wh.y);\n	offset[3] = vec2(-wh.x,  0.0);\n	offset[4] = vec2( 0.0,   0.0);\n	offset[5] = vec2( wh.x,  0.0);\n	offset[6] = vec2(-wh.x, wh.y);\n	offset[7] = vec2( 0.0,  wh.y);\n	offset[8] = vec2( wh.x, wh.y);\n	kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;\n	kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;\n	kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;\n	for( int i=0; i<9; i++ ) {\n		float tmp = texture2D(tDepth, coords + offset[i]).r;\n		d += tmp * kernel[i];\n	}\n	return d;\n}\nvec3 color(vec2 coords,float blur) {\n	//processing the sample\n	vec3 col = vec3(0.0);\n	vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);\n	col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;\n	col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;\n	col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;\n	vec3 lumcoeff = vec3(0.299,0.587,0.114);\n	float lum = dot(col.rgb, lumcoeff);\n	float thresh = max((lum-threshold)*gain, 0.0);\n	return col+mix(vec3(0.0),col,thresh*blur);\n}\nvec3 debugFocus(vec3 col, float blur, float depth) {\n	float edge = 0.002*depth; //distance based edge smoothing\n	float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);\n	float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);\n	col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);\n	col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);\n	return col;\n}\nfloat linearize(float depth) {\n	return -zfar * znear / (depth * (zfar - znear) - zfar);\n}\nfloat vignette() {\n	float dist = distance(vUv.xy, vec2(0.5,0.5));\n	dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);\n	return clamp(dist,0.0,1.0);\n}\nfloat gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n	float rings2 = float(rings);\n	float step = PI*2.0 / float(ringsamples);\n	float pw = cos(j*step)*i;\n	float ph = sin(j*step)*i;\n	float p = 1.0;\n	if (pentagon) {\n		p = penta(vec2(pw,ph));\n	}\n	col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;\n	return 1.0 * mix(1.0, i /rings2, bias) * p;\n}\nvoid main() {\n	//scene depth calculation\n	float depth = linearize(texture2D(tDepth,vUv.xy).x);\n	// Blur depth?\n	if ( depthblur ) {\n		depth = linearize(bdepth(vUv.xy));\n	}\n	//focal plane calculation\n	float fDepth = focalDepth;\n	if (shaderFocus) {\n		fDepth = linearize(texture2D(tDepth,focusCoords).x);\n	}\n	// dof blur factor calculation\n	float blur = 0.0;\n	if (manualdof) {\n		float a = depth-fDepth; // Focal plane\n		float b = (a-fdofstart)/fdofdist; // Far DoF\n		float c = (-a-ndofstart)/ndofdist; // Near Dof\n		blur = (a>0.0) ? b : c;\n	} else {\n		float f = focalLength; // focal length in mm\n		float d = fDepth*1000.0; // focal plane in mm\n		float o = depth*1000.0; // depth in mm\n		float a = (o*f)/(o-f);\n		float b = (d*f)/(d-f);\n		float c = (d-f)/(d*fstop*CoC);\n		blur = abs(a-b)*c;\n	}\n	blur = clamp(blur,0.0,1.0);\n	// calculation of pattern for dithering\n	vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;\n	// getting blur x and y step factor\n	float w = (1.0/textureWidth)*blur*maxblur+noise.x;\n	float h = (1.0/textureHeight)*blur*maxblur+noise.y;\n	// calculation of final color\n	vec3 col = vec3(0.0);\n	if(blur < 0.05) {\n		//some optimization thingy\n		col = texture2D(tColor, vUv.xy).rgb;\n	} else {\n		col = texture2D(tColor, vUv.xy).rgb;\n		float s = 1.0;\n		int ringsamples;\n		for (int i = 1; i <= rings; i++) {\n			/*unboxstart*/\n			ringsamples = i * samples;\n			for (int j = 0 ; j < maxringsamples ; j++) {\n				if (j >= ringsamples) break;\n				s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n			}\n			/*unboxend*/\n		}\n		col /= s; //divide by sample count\n	}\n	if (showFocus) {\n		col = debugFocus(col, blur, depth);\n	}\n	if (vignetting) {\n		col *= vignette();\n	}\n	gl_FragColor.rgb = col;\n	gl_FragColor.a = 1.0;\n} "},af={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:"varying float vViewZDepth;\nvoid main() {\n	#include <begin_vertex>\n	#include <project_vertex>\n	vViewZDepth = - mvPosition.z;\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nvarying float vViewZDepth;\nvoid main() {\n	float color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\n	gl_FragColor = vec4( vec3( color ), 1.0 );\n} "};class ag extends ee.cPb{constructor(e,t,r,n){super(e,t,r,n),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4},this.materialDepth=new ee.jyz({uniforms:af.uniforms,vertexShader:af.vertexShader,fragmentShader:af.fragmentShader}),this.materialDepth.uniforms.mNear.value=r,this.materialDepth.uniforms.mFar.value=n,this.setLens(),this.initPostProcessing()}setLens(e,t,r,n){void 0===e&&(e=35),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e),void 0===r&&(r=8),void 0===n&&(n=.019),this.fNumber=r,this.coc=n,this.aperture=e/this.fNumber,this.hyperFocal=e*e/(this.aperture*this.coc)}linearize(e){let t=this.far,r=this.near;return-t*r/(e*(t-r)-t)}smoothstep(e,t,r){let n=this.saturate((r-e)/(t-e));return n*n*(3-2*n)}saturate(e){return Math.max(0,Math.min(1,e))}focusAt(e){void 0===e&&(e=20);let t=this.getFocalLength();this.focus=e,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-t)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-t)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance}initPostProcessing(){this.postprocessing.enabled&&(this.postprocessing.scene=new ee.xsS,this.postprocessing.camera=new ee.iKG(-(window.innerWidth/2),window.innerWidth/2,window.innerHeight/2,-(window.innerHeight/2),-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera),this.postprocessing.rtTextureDepth=new ee.dd2(window.innerWidth,window.innerHeight),this.postprocessing.rtTextureColor=new ee.dd2(window.innerWidth,window.innerHeight),this.postprocessing.bokeh_uniforms=ee.rDY.clone(aA.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new ee.jyz({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:aA.vertexShader,fragmentShader:aA.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples,DEPTH_PACKING:1}}),this.postprocessing.quad=new ee.Kj0(new ee._12(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad))}renderCinematic(e,t){if(this.postprocessing.enabled){let r=t.getRenderTarget();t.clear(),e.overrideMaterial=null,t.setRenderTarget(this.postprocessing.rtTextureColor),t.clear(),t.render(e,this),e.overrideMaterial=this.materialDepth,t.setRenderTarget(this.postprocessing.rtTextureDepth),t.clear(),t.render(e,this),t.setRenderTarget(null),t.render(this.postprocessing.scene,this.postprocessing.camera),t.setRenderTarget(r)}}}let av=new ee.CJI,ay=new ee.Pa4;class ax{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,r=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let a=1;t&&(a=t.getX(n)+t.getX(n+1)+t.getX(n+2)),av.a.fromBufferAttribute(e,n),av.b.fromBufferAttribute(e,n+1),av.c.fromBufferAttribute(e,n+2),a*=av.getArea(),r[n/3]=a}this.distribution=new Float32Array(e.count/3);let n=0;for(let e=0;e<r.length;e++)n+=r[e],this.distribution[e]=n;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,r){let n=this.sampleFaceIndex();return this.sampleFace(n,e,t,r)}sampleFaceIndex(){let e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){let t=this.distribution,r=0,n=t.length-1,a=-1;for(;r<=n;){let s=Math.ceil((r+n)/2);if(0===s||t[s-1]<=e&&t[s]>e){a=s;break}e<t[s]?n=s-1:r=s+1}return a}sampleFace(e,t,r,n){let a=this.randomFunction(),s=this.randomFunction();return a+s>1&&(a=1-a,s=1-s),av.a.fromBufferAttribute(this.positionAttribute,3*e),av.b.fromBufferAttribute(this.positionAttribute,3*e+1),av.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(av.a,a).addScaledVector(av.b,s).addScaledVector(av.c,1-(a+s)),void 0!==r&&av.getNormal(r),void 0!==n&&void 0!==this.colorAttribute&&(av.a.fromBufferAttribute(this.colorAttribute,3*e),av.b.fromBufferAttribute(this.colorAttribute,3*e+1),av.c.fromBufferAttribute(this.colorAttribute,3*e+2),ay.set(0,0,0).addScaledVector(av.a,a).addScaledVector(av.b,s).addScaledVector(av.c,1-(a+s)),n.r=ay.x,n.g=ay.y,n.b=ay.z),this}}let ab={c:null,u:[new ee.Pa4,new ee.Pa4,new ee.Pa4],e:[]},aw={c:null,u:[new ee.Pa4,new ee.Pa4,new ee.Pa4],e:[]},aC=[[],[],[]],aE=[[],[],[]],aI=[],aM=new ee.Pa4,aB=new ee.Pa4,aS=new ee.Pa4,aT=new ee.Pa4,aF=new ee.Pa4,aP=new ee.Pa4,a_=new ee.Vkp,aD=new ee.ZzF,aR=new ee.yGw,aL=new ee.yGw,aN=new ee.zHn;class ak{constructor(e=new ee.Pa4,t=new ee.Pa4,r=new ee.Vkp){this.center=e,this.halfSize=t,this.rotation=r}set(e,t,r){return this.center=e,this.halfSize=t,this.rotation=r,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){let r=this.halfSize;aT.subVectors(e,this.center),this.rotation.extractBasis(aM,aB,aS),t.copy(this.center);let n=ee.M8C.clamp(aT.dot(aM),-r.x,r.x);t.add(aM.multiplyScalar(n));let a=ee.M8C.clamp(aT.dot(aB),-r.y,r.y);t.add(aB.multiplyScalar(a));let s=ee.M8C.clamp(aT.dot(aS),-r.z,r.z);return t.add(aS.multiplyScalar(s)),t}containsPoint(e){return aT.subVectors(e,this.center),this.rotation.extractBasis(aM,aB,aS),Math.abs(aT.dot(aM))<=this.halfSize.x&&Math.abs(aT.dot(aB))<=this.halfSize.y&&Math.abs(aT.dot(aS))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(aU.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,aP),aP.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){let r,n;ab.c=this.center,ab.e[0]=this.halfSize.x,ab.e[1]=this.halfSize.y,ab.e[2]=this.halfSize.z,this.rotation.extractBasis(ab.u[0],ab.u[1],ab.u[2]),aw.c=e.center,aw.e[0]=e.halfSize.x,aw.e[1]=e.halfSize.y,aw.e[2]=e.halfSize.z,e.rotation.extractBasis(aw.u[0],aw.u[1],aw.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)aC[e][t]=ab.u[e].dot(aw.u[t]);aT.subVectors(aw.c,ab.c),aI[0]=aT.dot(ab.u[0]),aI[1]=aT.dot(ab.u[1]),aI[2]=aT.dot(ab.u[2]);for(let e=0;e<3;e++)for(let r=0;r<3;r++)aE[e][r]=Math.abs(aC[e][r])+t;for(let e=0;e<3;e++)if(r=ab.e[e],n=aw.e[0]*aE[e][0]+aw.e[1]*aE[e][1]+aw.e[2]*aE[e][2],Math.abs(aI[e])>r+n)return!1;for(let e=0;e<3;e++)if(r=ab.e[0]*aE[0][e]+ab.e[1]*aE[1][e]+ab.e[2]*aE[2][e],n=aw.e[e],Math.abs(aI[0]*aC[0][e]+aI[1]*aC[1][e]+aI[2]*aC[2][e])>r+n)return!1;return r=ab.e[1]*aE[2][0]+ab.e[2]*aE[1][0],n=aw.e[1]*aE[0][2]+aw.e[2]*aE[0][1],!(Math.abs(aI[2]*aC[1][0]-aI[1]*aC[2][0])>r+n)&&(r=ab.e[1]*aE[2][1]+ab.e[2]*aE[1][1],n=aw.e[0]*aE[0][2]+aw.e[2]*aE[0][0],!(Math.abs(aI[2]*aC[1][1]-aI[1]*aC[2][1])>r+n)&&(r=ab.e[1]*aE[2][2]+ab.e[2]*aE[1][2],n=aw.e[0]*aE[0][1]+aw.e[1]*aE[0][0],!(Math.abs(aI[2]*aC[1][2]-aI[1]*aC[2][2])>r+n)&&(r=ab.e[0]*aE[2][0]+ab.e[2]*aE[0][0],n=aw.e[1]*aE[1][2]+aw.e[2]*aE[1][1],!(Math.abs(aI[0]*aC[2][0]-aI[2]*aC[0][0])>r+n)&&(r=ab.e[0]*aE[2][1]+ab.e[2]*aE[0][1],n=aw.e[0]*aE[1][2]+aw.e[2]*aE[1][0],!(Math.abs(aI[0]*aC[2][1]-aI[2]*aC[0][1])>r+n)&&(r=ab.e[0]*aE[2][2]+ab.e[2]*aE[0][2],n=aw.e[0]*aE[1][1]+aw.e[1]*aE[1][0],!(Math.abs(aI[0]*aC[2][2]-aI[2]*aC[0][2])>r+n)&&(r=ab.e[0]*aE[1][0]+ab.e[1]*aE[0][0],n=aw.e[1]*aE[2][2]+aw.e[2]*aE[2][1],!(Math.abs(aI[1]*aC[0][0]-aI[0]*aC[1][0])>r+n)&&(r=ab.e[0]*aE[1][1]+ab.e[1]*aE[0][1],n=aw.e[0]*aE[2][2]+aw.e[2]*aE[2][0],!(Math.abs(aI[1]*aC[0][1]-aI[0]*aC[1][1])>r+n)&&(r=ab.e[0]*aE[1][2]+ab.e[1]*aE[0][2],n=aw.e[0]*aE[2][1]+aw.e[1]*aE[2][0],!(Math.abs(aI[1]*aC[0][2]-aI[0]*aC[1][2])>r+n)))))))))}intersectsPlane(e){this.rotation.extractBasis(aM,aB,aS);let t=this.halfSize.x*Math.abs(e.normal.dot(aM))+this.halfSize.y*Math.abs(e.normal.dot(aB))+this.halfSize.z*Math.abs(e.normal.dot(aS));return Math.abs(e.normal.dot(this.center)-e.constant)<=t}intersectRay(e,t){return(this.getSize(aF),aD.setFromCenterAndSize(aT.set(0,0,0),aF),aR.setFromMatrix3(this.rotation),aR.setPosition(this.center),aL.copy(aR).invert(),aN.copy(e).applyMatrix4(aL),aN.intersectBox(aD,t))?t.applyMatrix4(aR):null}intersectsRay(e){return null!==this.intersectRay(e,aT)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){let t=e.elements,r=aT.set(t[0],t[1],t[2]).length(),n=aT.set(t[4],t[5],t[6]).length(),a=aT.set(t[8],t[9],t[10]).length();0>e.determinant()&&(r=-r),a_.setFromMatrix4(e);let s=1/r,o=1/n,l=1/a;return a_.elements[0]*=s,a_.elements[1]*=s,a_.elements[2]*=s,a_.elements[3]*=o,a_.elements[4]*=o,a_.elements[5]*=o,a_.elements[6]*=l,a_.elements[7]*=l,a_.elements[8]*=l,this.rotation.multiply(a_),this.halfSize.x*=r,this.halfSize.y*=n,this.halfSize.z*=a,aT.setFromMatrixPosition(e),this.center.add(aT),this}}let aU=new ak,aQ=new ee.Pa4,aO=new ee.Pa4,aG=new ee.Pa4;class aH{constructor(e=new ee.Pa4(0,0,0),t=new ee.Pa4(0,1,0),r=1){this.start=e,this.end=t,this.radius=r}clone(){return new aH(this.start.clone(),this.end.clone(),this.radius)}set(e,t,r){this.start.copy(e),this.end.copy(t),this.radius=r}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,r,n,a,s,o,l,h){return(a-e<h||a-r<h)&&(e-s<h||r-s<h)&&(o-t<h||o-n<h)&&(t-l<h||n-l<h)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}lineLineMinimumPoints(e,t){let r,n;let a=aQ.copy(e.end).sub(e.start),s=aO.copy(t.end).sub(t.start),o=aG.copy(t.start).sub(e.start),l=a.dot(s),h=a.dot(a),c=s.dot(s),u=s.dot(o),d=a.dot(o),m=h*c-l*l;if(1e-10>Math.abs(m)){let e=-u/c,t=(l-u)/c;Math.abs(e-.5)<Math.abs(t-.5)?(r=0,n=e):(r=1,n=t)}else n=((r=(u*l+d*c)/m)*l-u)/c;return n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r)),[a.multiplyScalar(r).add(e.start),s.multiplyScalar(n).add(t.start)]}}let az={};class aV{static setHSV(e,t,r,n){return t=ee.M8C.euclideanModulo(t,1),r=ee.M8C.clamp(r,0,1),n=ee.M8C.clamp(n,0,1),e.setHSL(t,r*n/((t=(2-r)*n)<1?t:2-t),.5*t)}static getHSV(e,t){return e.getHSL(az),az.s*=az.l<.5?az.l:1-az.l,t.h=az.h,t.s=2*az.s/(az.l+az.s),t.v=az.l+az.s,t}static setCMYK(e,t,r,n,a){return e.setRGB((1-t)*(1-a),(1-r)*(1-a),(1-n)*(1-a))}static getCMYK(e,t){let r=e.r,n=e.g,a=e.b,s=1-Math.max(r,n,a);return t.c=(1-r-s)/(1-s),t.m=(1-n-s)/(1-s),t.y=(1-a-s)/(1-s),t.k=s,t}}let aj=function(){let e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let t=0;t<256;t++)e[256+t]=e[t];return e}();function aW(e){return e*e*e*(e*(6*e-15)+10)}function aX(e,t,r,n){let a=15&e,s=a<8?t:r,o=a<4?r:12==a||14==a?t:n;return((1&a)==0?s:-s)+((2&a)==0?o:-o)}class aY{noise(e,t,r){var n,a,s,o,l,h,c;let u=Math.floor(e),d=Math.floor(t),m=Math.floor(r),p=255&u,A=255&d,f=255&m;e-=u,t-=d,r-=m;let g=e-1,v=t-1,y=r-1,x=aW(e),b=aW(t),w=aW(r),C=aj[p]+A,E=aj[C]+f,I=aj[C+1]+f,M=aj[p+1]+A,B=aj[M]+f,S=aj[M+1]+f;return(c=(s=(n=aX(aj[E],e,t,r))+x*(aX(aj[B],g,t,r)-n))+b*((a=aX(aj[I],e,v,r))+x*(aX(aj[S],g,v,r)-a)-s))+w*((h=(o=aX(aj[E+1],e,t,y))+x*(aX(aj[B+1],g,t,y)-o))+b*((l=aX(aj[I+1],e,v,y))+x*(aX(aj[S+1],g,v,y)-l)-h)-c)}}let aK=new ee.Pa4,aJ=new ee.Pa4,aq=new ee.JOQ,aZ=new ee.Zzh,a$=new ee.Zzh,a0=new ee.aLr,a1=new aH;class a2{constructor(e){this.triangles=[],this.box=e,this.subTrees=[]}addTriangle(e){return this.bounds||(this.bounds=new ee.ZzF),this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(e){let t;if(!this.box)return;let r=[],n=aJ.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let e=0;e<2;e++)for(let t=0;t<2;t++)for(let a=0;a<2;a++){let s=new ee.ZzF,o=aK.set(e,t,a);s.min.copy(this.box.min).add(o.multiply(n)),s.max.copy(s.min).add(n),r.push(new a2(s))}for(;t=this.triangles.pop();)for(let e=0;e<r.length;e++)r[e].box.intersectsTriangle(t)&&r[e].triangles.push(t);for(let t=0;t<r.length;t++){let n=r[t].triangles.length;n>8&&e<16&&r[t].split(e+1),0!==n&&this.subTrees.push(r[t])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(e,t){for(let r=0;r<this.subTrees.length;r++){let n=this.subTrees[r];if(e.intersectsBox(n.box)){if(n.triangles.length>0)for(let e=0;e<n.triangles.length;e++)-1===t.indexOf(n.triangles[e])&&t.push(n.triangles[e]);else n.getRayTriangles(e,t)}}return t}triangleCapsuleIntersect(e,t){t.getPlane(aq);let r=aq.distanceToPoint(e.start)-e.radius,n=aq.distanceToPoint(e.end)-e.radius;if(r>0&&n>0||r<-e.radius&&n<-e.radius)return!1;let a=aK.copy(e.start).lerp(e.end,Math.abs(r/(Math.abs(r)+Math.abs(n))));if(t.containsPoint(a))return{normal:aq.normal.clone(),point:a.clone(),depth:Math.abs(Math.min(r,n))};let s=e.radius*e.radius,o=aZ.set(e.start,e.end),l=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let t=0;t<l.length;t++){let r=a$.set(l[t][0],l[t][1]),[n,a]=e.lineLineMinimumPoints(o,r);if(n.distanceToSquared(a)<s)return{normal:n.clone().sub(a).normalize(),point:a.clone(),depth:e.radius-n.distanceTo(a)}}return!1}triangleSphereIntersect(e,t){if(t.getPlane(aq),!e.intersectsPlane(aq))return!1;let r=Math.abs(aq.distanceToSphere(e)),n=e.radius*e.radius-r*r,a=aq.projectPoint(e.center,aK);if(t.containsPoint(e.center))return{normal:aq.normal.clone(),point:a.clone(),depth:Math.abs(aq.distanceToSphere(e))};let s=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let t=0;t<s.length;t++){aZ.set(s[t][0],s[t][1]),aZ.closestPointToPoint(a,!0,aJ);let r=aJ.distanceToSquared(e.center);if(r<n)return{normal:e.center.clone().sub(aJ).normalize(),point:aJ.clone(),depth:e.radius-Math.sqrt(r)}}return!1}getSphereTriangles(e,t){for(let r=0;r<this.subTrees.length;r++){let n=this.subTrees[r];if(e.intersectsBox(n.box)){if(n.triangles.length>0)for(let e=0;e<n.triangles.length;e++)-1===t.indexOf(n.triangles[e])&&t.push(n.triangles[e]);else n.getSphereTriangles(e,t)}}}getCapsuleTriangles(e,t){for(let r=0;r<this.subTrees.length;r++){let n=this.subTrees[r];if(e.intersectsBox(n.box)){if(n.triangles.length>0)for(let e=0;e<n.triangles.length;e++)-1===t.indexOf(n.triangles[e])&&t.push(n.triangles[e]);else n.getCapsuleTriangles(e,t)}}}sphereIntersect(e){a0.copy(e);let t=[],r,n=!1;this.getSphereTriangles(e,t);for(let e=0;e<t.length;e++)(r=this.triangleSphereIntersect(a0,t[e]))&&(n=!0,a0.center.add(r.normal.multiplyScalar(r.depth)));if(n){let t=a0.center.clone().sub(e.center),r=t.length();return{normal:t.normalize(),depth:r}}return!1}capsuleIntersect(e){a1.copy(e);let t=[],r,n=!1;this.getCapsuleTriangles(a1,t);for(let e=0;e<t.length;e++)(r=this.triangleCapsuleIntersect(a1,t[e]))&&(n=!0,a1.translate(r.normal.multiplyScalar(r.depth)));if(n){let t=a1.getCenter(new ee.Pa4).sub(e.getCenter(aK)),r=t.length();return{normal:t.normalize(),depth:r}}return!1}rayIntersect(e){if(0===e.direction.length())return;let t=[],r,n,a=1e100;this.getRayTriangles(e,t);for(let s=0;s<t.length;s++){let o=e.intersectTriangle(t[s].a,t[s].b,t[s].c,!0,aK);if(o){let l=o.sub(e.origin).length();a>l&&(n=o.clone().add(e.origin),a=l,r=t[s])}}return a<1e100&&{distance:a,triangle:r,position:n}}fromGraphNode(e){return e.updateWorldMatrix(!0,!0),e.traverse(e=>{if(!0===e.isMesh){let t,r=!1;null!==e.geometry.index?(r=!0,t=e.geometry.toNonIndexed()):t=e.geometry;let n=t.getAttribute("position");for(let t=0;t<n.count;t+=3){let r=new ee.Pa4().fromBufferAttribute(n,t),a=new ee.Pa4().fromBufferAttribute(n,t+1),s=new ee.Pa4().fromBufferAttribute(n,t+2);r.applyMatrix4(e.matrixWorld),a.applyMatrix4(e.matrixWorld),s.applyMatrix4(e.matrixWorld),this.addTriangle(new ee.CJI(r,a,s))}r&&t.dispose()}}),this.build(),this}}class a3{constructor(e,t=32){this.isLut=!0,this.lut=[],this.map=[],this.n=0,this.minV=0,this.maxV=1,this.setColorMap(e,t)}set(e){return!0===e.isLut&&this.copy(e),this}setMin(e){return this.minV=e,this}setMax(e){return this.maxV=e,this}setColorMap(e,t=32){this.map=a4[e]||a4.rainbow,this.n=t;let r=1/this.n,n=new ee.Ilk,a=new ee.Ilk;this.lut.length=0,this.lut.push(new ee.Ilk(this.map[0][1]));for(let e=1;e<t;e++){let t=e*r;for(let e=0;e<this.map.length-1;e++)if(t>this.map[e][0]&&t<=this.map[e+1][0]){let r=this.map[e][0],s=this.map[e+1][0];n.setHex(this.map[e][1],"srgb-linear"),a.setHex(this.map[e+1][1],"srgb-linear");let o=new ee.Ilk().lerpColors(n,a,(t-r)/(s-r));this.lut.push(o)}}return this.lut.push(new ee.Ilk(this.map[this.map.length-1][1])),this}copy(e){return this.lut=e.lut,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this}getColor(e){let t=Math.round((e=((e=ee.M8C.clamp(e,this.minV,this.maxV))-this.minV)/(this.maxV-this.minV))*this.n);return this.lut[t]}addColorMap(e,t){return a4[e]=t,this}createCanvas(){let e=document.createElement("canvas");return e.width=1,e.height=this.n,this.updateCanvas(e),e}updateCanvas(e){let t=e.getContext("2d",{alpha:!1}),r=t.getImageData(0,0,1,this.n),n=r.data,a=0,s=1/this.n,o=new ee.Ilk,l=new ee.Ilk,h=new ee.Ilk;for(let e=1;e>=0;e-=s)for(let t=this.map.length-1;t>=0;t--)if(e<this.map[t][0]&&e>=this.map[t-1][0]){let r=this.map[t-1][0],s=this.map[t][0];o.setHex(this.map[t-1][1],"srgb-linear"),l.setHex(this.map[t][1],"srgb-linear"),h.lerpColors(o,l,(e-r)/(s-r)),n[4*a]=Math.round(255*h.r),n[4*a+1]=Math.round(255*h.g),n[4*a+2]=Math.round(255*h.b),n[4*a+3]=255,a+=1}return t.putImageData(r,0,0),e}}let a4={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]};var a5=Object.defineProperty,a8=(e,t,r)=>t in e?a5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a6=(e,t,r)=>(a8(e,"symbol"!=typeof t?t+"":t,r),r);let a9={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};class a7 extends ee.pBf{constructor(e,t){super(),a6(this,"object"),a6(this,"domElement"),a6(this,"enabled",!0),a6(this,"target",new ee.Pa4),a6(this,"trackball",!1),a6(this,"minDistance",0),a6(this,"maxDistance",1/0),a6(this,"minZoom",0),a6(this,"maxZoom",1/0),a6(this,"minPolarAngle",0),a6(this,"maxPolarAngle",Math.PI),a6(this,"minAzimuthAngle",-1/0),a6(this,"maxAzimuthAngle",1/0),a6(this,"enableDamping",!1),a6(this,"dampingFactor",.05),a6(this,"enableZoom",!0),a6(this,"zoomSpeed",1),a6(this,"enableRotate",!0),a6(this,"rotateSpeed",1),a6(this,"enablePan",!0),a6(this,"panSpeed",1),a6(this,"screenSpacePanning",!1),a6(this,"keyPanSpeed",7),a6(this,"autoRotate",!1),a6(this,"autoRotateSpeed",2),a6(this,"enableKeys",!0),a6(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),a6(this,"mouseButtons"),a6(this,"touches",{ONE:ee.QmN.ROTATE,TWO:ee.QmN.DOLLY_PAN}),a6(this,"target0"),a6(this,"position0"),a6(this,"quaternion0"),a6(this,"zoom0"),a6(this,"spherical",new ee.$V),a6(this,"sphericalDelta",new ee.$V),a6(this,"changeEvent",{type:"change"}),a6(this,"startEvent",{type:"start"}),a6(this,"endEvent",{type:"end"}),a6(this,"state",a9.NONE),a6(this,"EPS",1e-6),a6(this,"scale",1),a6(this,"panOffset",new ee.Pa4),a6(this,"zoomChanged",!1),a6(this,"rotateStart",new ee.FM8),a6(this,"rotateEnd",new ee.FM8),a6(this,"rotateDelta",new ee.FM8),a6(this,"panStart",new ee.FM8),a6(this,"panEnd",new ee.FM8),a6(this,"panDelta",new ee.FM8),a6(this,"dollyStart",new ee.FM8),a6(this,"dollyEnd",new ee.FM8),a6(this,"dollyDelta",new ee.FM8),a6(this,"offset",new ee.Pa4),a6(this,"lastPosition",new ee.Pa4),a6(this,"lastQuaternion",new ee._fP),a6(this,"q",new ee._fP),a6(this,"v",new ee.Pa4),a6(this,"vec",new ee.Pa4),a6(this,"quat"),a6(this,"quatInverse"),a6(this,"getPolarAngle",()=>this.spherical.phi),a6(this,"getAzimuthalAngle",()=>this.spherical.theta),a6(this,"saveState",()=>{this.target0.copy(this.target),this.position0.copy(this.object.position),this.quaternion0.copy(this.object.quaternion),this.zoom0=this.object.zoom}),a6(this,"reset",()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.quaternion.copy(this.quaternion0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(this.changeEvent),this.update(),this.state=a9.NONE}),a6(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",this.onContextMenu,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("wheel",this.onMouseWheel,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this.onTouchEnd,!1),this.domElement.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.domElement.removeEventListener("keydown",this.onKeyDown,!1)}),a6(this,"update",()=>{let e=this.object.position;if(this.offset.copy(e).sub(this.target),this.trackball){if(this.sphericalDelta.theta){this.vec.set(0,1,0).applyQuaternion(this.object.quaternion);let e=this.enableDamping?this.dampingFactor:1;this.q.setFromAxisAngle(this.vec,this.sphericalDelta.theta*e),this.object.quaternion.premultiply(this.q),this.offset.applyQuaternion(this.q)}if(this.sphericalDelta.phi){this.vec.set(1,0,0).applyQuaternion(this.object.quaternion);let e=this.enableDamping?this.dampingFactor:1;this.q.setFromAxisAngle(this.vec,this.sphericalDelta.phi*e),this.object.quaternion.premultiply(this.q),this.offset.applyQuaternion(this.q)}this.offset.multiplyScalar(this.scale),this.offset.clampLength(this.minDistance,this.maxDistance)}else this.offset.applyQuaternion(this.quat),this.autoRotate&&this.state===a9.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.setFromVector3(this.offset),this.enableDamping?(this.spherical.theta+=this.sphericalDelta.theta*this.dampingFactor,this.spherical.phi+=this.sphericalDelta.phi*this.dampingFactor):(this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi),this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.offset.setFromSpherical(this.spherical),this.offset.applyQuaternion(this.quatInverse);return!0===this.enableDamping?this.target.addScaledVector(this.panOffset,this.dampingFactor):this.target.add(this.panOffset),e.copy(this.target).add(this.offset),!1===this.trackball&&this.object.lookAt(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor,this.panOffset.multiplyScalar(1-this.dampingFactor)):(this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0)),this.scale=1,!!(this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}),a6(this,"getAutoRotationAngle",()=>2*Math.PI/60/60*this.autoRotateSpeed),a6(this,"getZoomScale",()=>Math.pow(.95,this.zoomSpeed)),a6(this,"rotateLeft",e=>{this.sphericalDelta.theta-=e}),a6(this,"rotateUp",e=>{this.sphericalDelta.phi-=e}),a6(this,"panLeft",(e,t)=>{this.v.setFromMatrixColumn(t,0),this.v.multiplyScalar(-e),this.panOffset.add(this.v)}),a6(this,"panUp",(e,t)=>{!0===this.screenSpacePanning?this.v.setFromMatrixColumn(t,1):(this.v.setFromMatrixColumn(t,0),this.v.crossVectors(this.object.up,this.v)),this.v.multiplyScalar(e),this.panOffset.add(this.v)}),a6(this,"pan",(e,t)=>{let r=this.domElement;if(this.object instanceof ee.cPb){let n=this.object.position;this.offset.copy(n).sub(this.target);let a=this.offset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/r.clientHeight,this.object.matrix),this.panUp(2*t*a/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: CameraControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}),a6(this,"dollyIn",e=>{this.object instanceof ee.cPb?this.scale/=e:this.object instanceof ee.iKG?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: CameraControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}),a6(this,"dollyOut",e=>{this.object instanceof ee.cPb?this.scale*=e:this.object instanceof ee.iKG?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: CameraControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}),a6(this,"handleMouseDownRotate",e=>{this.rotateStart.set(e.clientX,e.clientY)}),a6(this,"handleMouseDownDolly",e=>{this.dollyStart.set(e.clientX,e.clientY)}),a6(this,"handleMouseDownPan",e=>{this.panStart.set(e.clientX,e.clientY)}),a6(this,"handleMouseMoveRotate",e=>{this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight),this.rotateStart.copy(this.rotateEnd),this.update()}),a6(this,"handleMouseMoveDolly",e=>{this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyOut(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}),a6(this,"handleMouseMovePan",e=>{this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.update()}),a6(this,"handleMouseWheel",e=>{e.deltaY<0?this.dollyOut(this.getZoomScale()):e.deltaY>0&&this.dollyIn(this.getZoomScale()),this.update()}),a6(this,"handleKeyDown",e=>{let t=!1;switch(e.code){case this.keys.UP:this.pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}),a6(this,"handleTouchStartRotate",e=>{if(1==e.touches.length)this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY);else{let t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.rotateStart.set(t,r)}}),a6(this,"handleTouchStartPan",e=>{if(1==e.touches.length)this.panStart.set(e.touches[0].pageX,e.touches[0].pageY);else{let t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.panStart.set(t,r)}}),a6(this,"handleTouchStartDolly",e=>{let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this.dollyStart.set(0,Math.sqrt(t*t+r*r))}),a6(this,"handleTouchStartDollyPan",e=>{this.enableZoom&&this.handleTouchStartDolly(e),this.enablePan&&this.handleTouchStartPan(e)}),a6(this,"handleTouchStartDollyRotate",e=>{this.enableZoom&&this.handleTouchStartDolly(e),this.enableRotate&&this.handleTouchStartRotate(e)}),a6(this,"handleTouchMoveRotate",e=>{if(1==e.touches.length)this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY);else{let t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.rotateEnd.set(t,r)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight),this.rotateStart.copy(this.rotateEnd)}),a6(this,"handleTouchMovePan",e=>{if(1==e.touches.length)this.panEnd.set(e.touches[0].pageX,e.touches[0].pageY);else{let t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);this.panEnd.set(t,r)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}),a6(this,"handleTouchMoveDolly",e=>{let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this.dollyEnd.set(0,Math.sqrt(t*t+r*r)),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyIn(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}),a6(this,"handleTouchMoveDollyPan",e=>{this.enableZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}),a6(this,"handleTouchMoveDollyRotate",e=>{this.enableZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}),a6(this,"onMouseDown",e=>{let t;if(!1!==this.enabled){switch(e.preventDefault(),this.domElement.focus?this.domElement.focus():window.focus(),e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case ee.RsA.DOLLY:if(!1===this.enableZoom)return;this.handleMouseDownDolly(e),this.state=a9.DOLLY;break;case ee.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=a9.PAN}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=a9.ROTATE}break;case ee.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=a9.ROTATE}else{if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=a9.PAN}break;default:this.state=a9.NONE}this.state!==a9.NONE&&(document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(this.startEvent))}}),a6(this,"onMouseMove",e=>{if(!1!==this.enabled)switch(e.preventDefault(),this.state){case a9.ROTATE:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case a9.DOLLY:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e);break;case a9.PAN:if(!1===this.enablePan)return;this.handleMouseMovePan(e)}}),a6(this,"onMouseUp",()=>{!1!==this.enabled&&(document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.dispatchEvent(this.endEvent),this.state=a9.NONE)}),a6(this,"onMouseWheel",e=>{!1!==this.enabled&&!1!==this.enableZoom&&(this.state===a9.NONE||this.state===a9.ROTATE)&&(e.preventDefault(),this.dispatchEvent(this.startEvent),this.handleMouseWheel(e),this.dispatchEvent(this.endEvent))}),a6(this,"onKeyDown",e=>{!1!==this.enabled&&!1!==this.enableKeys&&!1!==this.enablePan&&this.handleKeyDown(e)}),a6(this,"onTouchStart",e=>{if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(this.touches.ONE){case ee.QmN.ROTATE:if(!1===this.enableRotate)return;this.handleTouchStartRotate(e),this.state=a9.TOUCH_ROTATE;break;case ee.QmN.PAN:if(!1===this.enablePan)return;this.handleTouchStartPan(e),this.state=a9.TOUCH_PAN;break;default:this.state=a9.NONE}break;case 2:switch(this.touches.TWO){case ee.QmN.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(e),this.state=a9.TOUCH_DOLLY_PAN;break;case ee.QmN.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(e),this.state=a9.TOUCH_DOLLY_ROTATE;break;default:this.state=a9.NONE}break;default:this.state=a9.NONE}this.state!==a9.NONE&&this.dispatchEvent(this.startEvent)}}),a6(this,"onTouchMove",e=>{if(!1!==this.enabled)switch(e.preventDefault(),this.state){case a9.TOUCH_ROTATE:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(e),this.update();break;case a9.TOUCH_PAN:if(!1===this.enablePan)return;this.handleTouchMovePan(e),this.update();break;case a9.TOUCH_DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(e),this.update();break;case a9.TOUCH_DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(e),this.update();break;default:this.state=a9.NONE}}),a6(this,"onTouchEnd",()=>{!1!==this.enabled&&(this.dispatchEvent(this.endEvent),this.state=a9.NONE)}),a6(this,"onContextMenu",e=>{!1!==this.enabled&&e.preventDefault()}),void 0===t&&console.warn('THREE.CameraControls: The second parameter "domElement" is now mandatory.'),t instanceof Document&&console.error('THREE.CameraControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.mouseButtons={LEFT:ee.RsA.ROTATE,MIDDLE:ee.RsA.DOLLY,RIGHT:ee.RsA.PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.quaternion0=this.object.quaternion.clone(),this.zoom0=this.object.zoom,this.quat=new ee._fP().setFromUnitVectors(this.object.up,new ee.Pa4(0,1,0)),this.quatInverse=this.quat.clone().invert(),this.lastPosition=new ee.Pa4,this.lastQuaternion=new ee._fP,this.domElement.addEventListener("contextmenu",this.onContextMenu,!1),this.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.domElement.addEventListener("wheel",this.onMouseWheel,!1),this.domElement.addEventListener("touchstart",this.onTouchStart,!1),this.domElement.addEventListener("touchend",this.onTouchEnd,!1),this.domElement.addEventListener("touchmove",this.onTouchMove,!1),this.domElement.addEventListener("keydown",this.onKeyDown,!1),-1===this.domElement.tabIndex&&(this.domElement.tabIndex=0),this.object.lookAt(this.target),this.update(),this.saveState()}handleMouseUp(){}handleTouchEnd(){}}class se extends a7{constructor(e,t){super(e,t),a6(this,"mouseButtons"),a6(this,"touches"),this.mouseButtons={LEFT:ee.RsA.ROTATE,RIGHT:ee.RsA.PAN},this.touches={ONE:ee.QmN.ROTATE,TWO:ee.QmN.DOLLY_PAN}}}class st extends a7{constructor(e,t){super(e,t),a6(this,"mouseButtons"),a6(this,"touches"),this.mouseButtons={LEFT:ee.RsA.PAN,RIGHT:ee.RsA.ROTATE},this.touches={ONE:ee.QmN.PAN,TWO:ee.QmN.DOLLY_ROTATE}}}class si extends a7{constructor(e,t){super(e,t),a6(this,"trackball"),a6(this,"screenSpacePanning"),a6(this,"autoRotate"),a6(this,"mouseButtons"),a6(this,"touches"),this.trackball=!0,this.screenSpacePanning=!0,this.autoRotate=!1,this.mouseButtons={LEFT:ee.RsA.ROTATE,RIGHT:ee.RsA.PAN},this.touches={ONE:ee.QmN.ROTATE,TWO:ee.QmN.DOLLY_PAN}}}var sr=Object.defineProperty,sn=(e,t,r)=>t in e?sr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sa=(e,t,r)=>(sn(e,"symbol"!=typeof t?t+"":t,r),r);let ss=new ee.Pa4;class so extends ee.pBf{constructor(e,t){super(),sa(this,"object"),sa(this,"domElement"),sa(this,"enabled",!0),sa(this,"movementSpeed",1),sa(this,"lookSpeed",.005),sa(this,"lookVertical",!0),sa(this,"autoForward",!1),sa(this,"activeLook",!0),sa(this,"heightSpeed",!1),sa(this,"heightCoef",1),sa(this,"heightMin",0),sa(this,"heightMax",1),sa(this,"constrainVertical",!1),sa(this,"verticalMin",0),sa(this,"verticalMax",Math.PI),sa(this,"mouseDragOn",!1),sa(this,"autoSpeedFactor",0),sa(this,"mouseX",0),sa(this,"mouseY",0),sa(this,"moveForward",!1),sa(this,"moveBackward",!1),sa(this,"moveLeft",!1),sa(this,"moveRight",!1),sa(this,"moveUp",!1),sa(this,"moveDown",!1),sa(this,"viewHalfX",0),sa(this,"viewHalfY",0),sa(this,"lat",0),sa(this,"lon",0),sa(this,"lookDirection",new ee.Pa4),sa(this,"spherical",new ee.$V),sa(this,"target",new ee.Pa4),sa(this,"connect",e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),sa(this,"dispose",()=>{var e,t,r,n;null==(e=this.domElement)||e.removeEventListener("contextmenu",this.contextmenu),null==(t=this.domElement)||t.removeEventListener("mousedown",this.onMouseDown),null==(r=this.domElement)||r.removeEventListener("mousemove",this.onMouseMove),null==(n=this.domElement)||n.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),sa(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),sa(this,"onMouseDown",e=>{var t;if(null==(t=this.domElement)||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}),sa(this,"onMouseUp",e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}),sa(this,"onMouseMove",e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}),sa(this,"onKeyDown",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}),sa(this,"onKeyUp",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}),sa(this,"lookAt",(e,t,r)=>(e instanceof ee.Pa4?this.target.copy(e):t&&r&&this.target.set(e,t,r),this.object.lookAt(this.target),this.setOrientation(),this)),sa(this,"update",e=>{if(!this.enabled)return;if(this.heightSpeed){let t=ee.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*this.heightCoef*e}else this.autoSpeedFactor=0;let t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let r=e*this.lookSpeed;this.activeLook||(r=0);let n=1;this.constrainVertical&&(n=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*n),this.lat=Math.max(-85,Math.min(85,this.lat));let a=ee.M8C.degToRad(90-this.lat),s=ee.M8C.degToRad(this.lon);this.constrainVertical&&(a=ee.M8C.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));let o=this.object.position;ss.setFromSphericalCoords(1,a,s).add(o),this.object.lookAt(ss)}),sa(this,"contextmenu",e=>e.preventDefault()),sa(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-ee.M8C.radToDeg(this.spherical.phi),this.lon=ee.M8C.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}var sl=Object.defineProperty,sh=(e,t,r)=>t in e?sl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sc=(e,t,r)=>(sh(e,"symbol"!=typeof t?t+"":t,r),r);class su extends ee.Tme{constructor(e,t){super(),sc(this,"isTransformControls",!0),sc(this,"visible",!1),sc(this,"domElement"),sc(this,"raycaster",new ee.iMs),sc(this,"gizmo"),sc(this,"plane"),sc(this,"tempVector",new ee.Pa4),sc(this,"tempVector2",new ee.Pa4),sc(this,"tempQuaternion",new ee._fP),sc(this,"unit",{X:new ee.Pa4(1,0,0),Y:new ee.Pa4(0,1,0),Z:new ee.Pa4(0,0,1)}),sc(this,"pointStart",new ee.Pa4),sc(this,"pointEnd",new ee.Pa4),sc(this,"offset",new ee.Pa4),sc(this,"rotationAxis",new ee.Pa4),sc(this,"startNorm",new ee.Pa4),sc(this,"endNorm",new ee.Pa4),sc(this,"rotationAngle",0),sc(this,"cameraPosition",new ee.Pa4),sc(this,"cameraQuaternion",new ee._fP),sc(this,"cameraScale",new ee.Pa4),sc(this,"parentPosition",new ee.Pa4),sc(this,"parentQuaternion",new ee._fP),sc(this,"parentQuaternionInv",new ee._fP),sc(this,"parentScale",new ee.Pa4),sc(this,"worldPositionStart",new ee.Pa4),sc(this,"worldQuaternionStart",new ee._fP),sc(this,"worldScaleStart",new ee.Pa4),sc(this,"worldPosition",new ee.Pa4),sc(this,"worldQuaternion",new ee._fP),sc(this,"worldQuaternionInv",new ee._fP),sc(this,"worldScale",new ee.Pa4),sc(this,"eye",new ee.Pa4),sc(this,"positionStart",new ee.Pa4),sc(this,"quaternionStart",new ee._fP),sc(this,"scaleStart",new ee.Pa4),sc(this,"camera"),sc(this,"object"),sc(this,"enabled",!0),sc(this,"axis",null),sc(this,"mode","translate"),sc(this,"translationSnap",null),sc(this,"rotationSnap",null),sc(this,"scaleSnap",null),sc(this,"space","world"),sc(this,"size",1),sc(this,"dragging",!1),sc(this,"showX",!0),sc(this,"showY",!0),sc(this,"showZ",!0),sc(this,"changeEvent",{type:"change"}),sc(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),sc(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),sc(this,"objectChangeEvent",{type:"objectChange"}),sc(this,"intersectObjectWithRay",(e,t,r)=>{let n=t.intersectObject(e,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||r)return n[e];return!1}),sc(this,"attach",e=>(this.object=e,this.visible=!0,this)),sc(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),sc(this,"reset",()=>(this.enabled&&this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this)),sc(this,"updateMatrixWorld",()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),sc(this,"pointerHover",e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);t?this.axis=t.object.name:this.axis=null}),sc(this,"pointerDown",e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":("E"===this.axis||"XYZE"===this.axis||"XYZ"===this.axis)&&(e="world"),"local"===e&&"rotate"===this.mode){let e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),sc(this,"pointerMove",e=>{let t=this.axis,r=this.mode,n=this.object,a=this.space;if("scale"===r?a="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(a="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);let s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===r)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===a&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===a&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),n.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===a&&(n.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this.quaternionStart)),"world"===a&&(n.parent&&n.position.add(this.tempVector.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(this.tempVector.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);n.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this.offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this.endNorm.cross(this.startNorm).dot(this.eye)?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===a&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===a&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this.quaternionStart),n.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),n.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),sc(this,"pointerUp",e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),sc(this,"getPointer",e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{let t=e.changedTouches?e.changedTouches[0]:e,r=this.domElement.getBoundingClientRect();return{x:(t.clientX-r.left)/r.width*2-1,y:-(t.clientY-r.top)/r.height*2+1,button:e.button}}}),sc(this,"onPointerHover",e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}}),sc(this,"onPointerDown",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))}),sc(this,"onPointerMove",e=>{this.enabled&&this.pointerMove(this.getPointer(e))}),sc(this,"onPointerUp",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))}),sc(this,"getMode",()=>this.mode),sc(this,"setMode",e=>{this.mode=e}),sc(this,"setTranslationSnap",e=>{this.translationSnap=e}),sc(this,"setRotationSnap",e=>{this.rotationSnap=e}),sc(this,"setScaleSnap",e=>{this.scaleSnap=e}),sc(this,"setSize",e=>{this.size=e}),sc(this,"setSpace",e=>{this.space=e}),sc(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),sc(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),sc(this,"dispose",()=>{var e,t,r,n,a,s;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(n=null==(r=this.domElement)?void 0:r.ownerDocument)||n.removeEventListener("pointermove",this.onPointerMove),null==(s=null==(a=this.domElement)?void 0:a.ownerDocument)||s.removeEventListener("pointerup",this.onPointerUp),this.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new sd,this.add(this.gizmo),this.plane=new sm,this.add(this.plane);let r=(e,t)=>{let r=t;Object.defineProperty(this,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};r("camera",this.camera),r("object",this.object),r("enabled",this.enabled),r("axis",this.axis),r("mode",this.mode),r("translationSnap",this.translationSnap),r("rotationSnap",this.rotationSnap),r("scaleSnap",this.scaleSnap),r("space",this.space),r("size",this.size),r("dragging",this.dragging),r("showX",this.showX),r("showY",this.showY),r("showZ",this.showZ),r("worldPosition",this.worldPosition),r("worldPositionStart",this.worldPositionStart),r("worldQuaternion",this.worldQuaternion),r("worldQuaternionStart",this.worldQuaternionStart),r("cameraPosition",this.cameraPosition),r("cameraQuaternion",this.cameraQuaternion),r("pointStart",this.pointStart),r("pointEnd",this.pointEnd),r("rotationAxis",this.rotationAxis),r("rotationAngle",this.rotationAngle),r("eye",this.eye),void 0!==t&&this.connect(t)}}class sd extends ee.Tme{constructor(){super(),sc(this,"isTransformControlsGizmo",!0),sc(this,"type","TransformControlsGizmo"),sc(this,"tempVector",new ee.Pa4(0,0,0)),sc(this,"tempEuler",new ee.USm),sc(this,"alignVector",new ee.Pa4(0,1,0)),sc(this,"zeroVector",new ee.Pa4(0,0,0)),sc(this,"lookAtMatrix",new ee.yGw),sc(this,"tempQuaternion",new ee._fP),sc(this,"tempQuaternion2",new ee._fP),sc(this,"identityQuaternion",new ee._fP),sc(this,"unitX",new ee.Pa4(1,0,0)),sc(this,"unitY",new ee.Pa4(0,1,0)),sc(this,"unitZ",new ee.Pa4(0,0,1)),sc(this,"gizmo"),sc(this,"picker"),sc(this,"helper"),sc(this,"rotationAxis",new ee.Pa4),sc(this,"cameraPosition",new ee.Pa4),sc(this,"worldPositionStart",new ee.Pa4),sc(this,"worldQuaternionStart",new ee._fP),sc(this,"worldPosition",new ee.Pa4),sc(this,"worldQuaternion",new ee._fP),sc(this,"eye",new ee.Pa4),sc(this,"camera",null),sc(this,"enabled",!0),sc(this,"axis",null),sc(this,"mode","translate"),sc(this,"space","world"),sc(this,"size",1),sc(this,"dragging",!1),sc(this,"showX",!0),sc(this,"showY",!0),sc(this,"showZ",!0),sc(this,"updateMatrixWorld",()=>{let e=this.space;"scale"===this.mode&&(e="local");let t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){let n;let a=r[e];if(a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(n*this.size/7),"helper"===a.tag){a.visible=!1,"AXIS"===a.name?(a.position.copy(this.worldPositionStart),a.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),a.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),a.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),a.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),a.quaternion.multiply(this.tempQuaternion),a.visible=this.dragging),"E"===this.axis&&(a.visible=!1)):"START"===a.name?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):"END"===a.name?(a.position.copy(this.worldPosition),a.visible=this.dragging):"DELTA"===a.name?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(this.tempVector),a.visible=this.dragging):(a.quaternion.copy(t),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=-1!==this.axis.search(a.name)));continue}a.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode?(("X"===a.name||"XYZX"===a.name)&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),("Y"===a.name||"XYZY"===a.name)&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),("Z"===a.name||"XYZZ"===a.name)&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XY"===a.name&&.2>Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"YZ"===a.name&&.2>Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XZ"===a.name&&.2>Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),-1!==a.name.search("X")&&(0>this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)?"fwd"===a.tag?a.visible=!1:a.scale.x*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Y")&&(0>this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)?"fwd"===a.tag?a.visible=!1:a.scale.y*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Z")&&(0>this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)?"fwd"===a.tag?a.visible=!1:a.scale.z*=-1:"bwd"===a.tag&&(a.visible=!1))):"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==a.name.search("E")&&a.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===a.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),a.quaternion.copy(this.tempQuaternion)),"Y"===a.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),a.quaternion.copy(this.tempQuaternion)),"Z"===a.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),a.quaternion.copy(this.tempQuaternion))),a.visible=a.visible&&(-1===a.name.indexOf("X")||this.showX),a.visible=a.visible&&(-1===a.name.indexOf("Y")||this.showY),a.visible=a.visible&&(-1===a.name.indexOf("Z")||this.showZ),a.visible=a.visible&&(-1===a.name.indexOf("E")||this.showX&&this.showY&&this.showZ),a.material.tempOpacity=a.material.tempOpacity||a.material.opacity,a.material.tempColor=a.material.tempColor||a.material.color.clone(),a.material.color.copy(a.material.tempColor),a.material.opacity=a.material.tempOpacity,this.enabled?this.axis&&(a.name===this.axis?a.material.opacity=1:this.axis.split("").some(function(e){return a.name===e})?a.material.opacity=1:a.material.opacity*=.25,a.material.color.lerp(new ee.Ilk(1,1,1),.5)):(a.material.opacity*=.5,a.material.color.lerp(new ee.Ilk(1,1,1),.5))}super.updateMatrixWorld()});let e=new ee.vBJ({depthTest:!1,depthWrite:!1,transparent:!0,side:ee.ehD,fog:!1,toneMapped:!1}),t=new ee.nls({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),r=e.clone();r.opacity=.15;let n=e.clone();n.opacity=.33;let a=e.clone();a.color.set(16711680);let s=e.clone();s.color.set(65280);let o=e.clone();o.color.set(255);let l=e.clone();l.opacity=.25;let h=l.clone();h.color.set(16776960);let c=l.clone();c.color.set(65535);let u=l.clone();u.color.set(16711935),e.clone().color.set(16776960);let d=t.clone();d.color.set(16711680);let m=t.clone();m.color.set(65280);let p=t.clone();p.color.set(255);let A=t.clone();A.color.set(65535);let f=t.clone();f.color.set(16711935);let g=t.clone();g.color.set(16776960);let v=t.clone();v.color.set(7895160);let y=g.clone();y.opacity=.25;let x=new ee.fHI(0,.05,.2,12,1,!1),b=new ee.DvJ(.125,.125,.125),w=new ee.u9r;w.setAttribute("position",new ee.a$l([0,0,0,1,0,0],3));let C=(e,t)=>{let r=new ee.u9r,n=[];for(let r=0;r<=64*t;++r)n.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return r.setAttribute("position",new ee.a$l(n,3)),r},E={X:[[new ee.Kj0(x,a),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new ee.Kj0(x,a),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new ee.x12(w,d)]],Y:[[new ee.Kj0(x,s),[0,1,0],null,null,"fwd"],[new ee.Kj0(x,s),[0,1,0],[Math.PI,0,0],null,"bwd"],[new ee.x12(w,m),null,[0,0,Math.PI/2]]],Z:[[new ee.Kj0(x,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new ee.Kj0(x,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new ee.x12(w,p),null,[0,-Math.PI/2,0]]],XYZ:[[new ee.Kj0(new ee.pQR(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new ee.Kj0(new ee._12(.295,.295),h.clone()),[.15,.15,0]],[new ee.x12(w,g),[.18,.3,0],null,[.125,1,1]],[new ee.x12(w,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new ee.Kj0(new ee._12(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new ee.x12(w,A),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new ee.x12(w,A),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new ee.Kj0(new ee._12(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new ee.x12(w,f),[.18,0,.3],null,[.125,1,1]],[new ee.x12(w,f),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},I={X:[[new ee.Kj0(new ee.fHI(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new ee.Kj0(new ee.fHI(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new ee.Kj0(new ee.fHI(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new ee.Kj0(new ee.pQR(.2,0),r)]],XY:[[new ee.Kj0(new ee._12(.4,.4),r),[.2,.2,0]]],YZ:[[new ee.Kj0(new ee._12(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new ee.Kj0(new ee._12(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new ee.Kj0(new ee.pQR(.01,2),n),null,null,null,"helper"]],END:[[new ee.Kj0(new ee.pQR(.01,2),n),null,null,null,"helper"]],DELTA:[[new ee.x12((()=>{let e=new ee.u9r;return e.setAttribute("position",new ee.a$l([0,0,0,1,1,1],3)),e})(),n),null,null,null,"helper"]],X:[[new ee.x12(w,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ee.x12(w,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ee.x12(w,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},B={X:[[new ee.x12(C(1,.5),d)],[new ee.Kj0(new ee.pQR(.04,0),a),[0,0,.99],null,[1,3,1]]],Y:[[new ee.x12(C(1,.5),m),null,[0,0,-Math.PI/2]],[new ee.Kj0(new ee.pQR(.04,0),s),[0,0,.99],null,[3,1,1]]],Z:[[new ee.x12(C(1,.5),p),null,[0,Math.PI/2,0]],[new ee.Kj0(new ee.pQR(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new ee.x12(C(1.25,1),y),null,[0,Math.PI/2,0]],[new ee.Kj0(new ee.fHI(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new ee.Kj0(new ee.fHI(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new ee.Kj0(new ee.fHI(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new ee.Kj0(new ee.fHI(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new ee.x12(C(1,1),v),null,[0,Math.PI/2,0]]]},S={AXIS:[[new ee.x12(w,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},T={X:[[new ee.Kj0(new ee.XvJ(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ee.Kj0(new ee.XvJ(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ee.Kj0(new ee.XvJ(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ee.Kj0(new ee.XvJ(1.25,.1,2,24),r)]],XYZE:[[new ee.Kj0(new ee.xo$(.7,10,8),r)]]},F={X:[[new ee.Kj0(b,a),[.8,0,0],[0,0,-Math.PI/2]],[new ee.x12(w,d),null,null,[.8,1,1]]],Y:[[new ee.Kj0(b,s),[0,.8,0]],[new ee.x12(w,m),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new ee.Kj0(b,o),[0,0,.8],[Math.PI/2,0,0]],[new ee.x12(w,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new ee.Kj0(b,h),[.85,.85,0],null,[2,2,.2]],[new ee.x12(w,g),[.855,.98,0],null,[.125,1,1]],[new ee.x12(w,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new ee.Kj0(b,c),[0,.85,.85],null,[.2,2,2]],[new ee.x12(w,A),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new ee.x12(w,A),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new ee.Kj0(b,u),[.85,0,.85],null,[2,.2,2]],[new ee.x12(w,f),[.855,0,.98],null,[.125,1,1]],[new ee.x12(w,f),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new ee.Kj0(new ee.DvJ(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new ee.Kj0(new ee.DvJ(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new ee.Kj0(new ee.DvJ(.125,.125,.125),l.clone()),[0,0,1.1]]]},P={X:[[new ee.Kj0(new ee.fHI(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new ee.Kj0(new ee.fHI(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new ee.Kj0(new ee.fHI(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new ee.Kj0(b,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new ee.Kj0(b,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new ee.Kj0(b,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new ee.Kj0(new ee.DvJ(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new ee.Kj0(new ee.DvJ(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new ee.Kj0(new ee.DvJ(.2,.2,.2),r),[0,0,1.1]]]},_={X:[[new ee.x12(w,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ee.x12(w,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ee.x12(w,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D=e=>{let t=new ee.Tme;for(let r in e)for(let n=e[r].length;n--;){let a=e[r][n][0].clone(),s=e[r][n][1],o=e[r][n][2],l=e[r][n][3],h=e[r][n][4];a.name=r,a.tag=h,s&&a.position.set(s[0],s[1],s[2]),o&&a.rotation.set(o[0],o[1],o[2]),l&&a.scale.set(l[0],l[1],l[2]),a.updateMatrix();let c=a.geometry.clone();c.applyMatrix4(a.matrix),a.geometry=c,a.renderOrder=1/0,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1),t.add(a)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=D(E)),this.add(this.gizmo.rotate=D(B)),this.add(this.gizmo.scale=D(F)),this.add(this.picker.translate=D(I)),this.add(this.picker.rotate=D(T)),this.add(this.picker.scale=D(P)),this.add(this.helper.translate=D(M)),this.add(this.helper.rotate=D(S)),this.add(this.helper.scale=D(_)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class sm extends ee.Kj0{constructor(){super(new ee._12(1e5,1e5,2,2),new ee.vBJ({visible:!1,wireframe:!0,side:ee.ehD,transparent:!0,opacity:.1,toneMapped:!1})),sc(this,"isTransformControlsPlane",!0),sc(this,"type","TransformControlsPlane"),sc(this,"unitX",new ee.Pa4(1,0,0)),sc(this,"unitY",new ee.Pa4(0,1,0)),sc(this,"unitZ",new ee.Pa4(0,0,1)),sc(this,"tempVector",new ee.Pa4),sc(this,"dirVector",new ee.Pa4),sc(this,"alignVector",new ee.Pa4),sc(this,"tempMatrix",new ee.yGw),sc(this,"identityQuaternion",new ee._fP),sc(this,"cameraQuaternion",new ee._fP),sc(this,"worldPosition",new ee.Pa4),sc(this,"worldQuaternion",new ee._fP),sc(this,"eye",new ee.Pa4),sc(this,"axis",null),sc(this,"mode","translate"),sc(this,"space","world"),sc(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var sp=Object.defineProperty,sA=(e,t,r)=>t in e?sp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sf=(e,t,r)=>(sA(e,"symbol"!=typeof t?t+"":t,r),r);class sg extends ee.pBf{constructor(e,t,r){super(),sf(this,"enabled",!0),sf(this,"transformGroup",!1),sf(this,"_objects"),sf(this,"_camera"),sf(this,"_domElement"),sf(this,"_plane",new ee.JOQ),sf(this,"_raycaster",new ee.iMs),sf(this,"_mouse",new ee.FM8),sf(this,"_offset",new ee.Pa4),sf(this,"_intersection",new ee.Pa4),sf(this,"_worldPosition",new ee.Pa4),sf(this,"_inverseMatrix",new ee.yGw),sf(this,"_intersections",[]),sf(this,"_selected",null),sf(this,"_hovered",null),sf(this,"activate",()=>{this._domElement.addEventListener("pointermove",this.onPointerMove),this._domElement.addEventListener("pointerdown",this.onPointerDown),this._domElement.addEventListener("pointerup",this.onPointerCancel),this._domElement.addEventListener("pointerleave",this.onPointerCancel),this._domElement.addEventListener("touchmove",this.onTouchMove),this._domElement.addEventListener("touchstart",this.onTouchStart),this._domElement.addEventListener("touchend",this.onTouchEnd)}),sf(this,"deactivate",()=>{this._domElement.removeEventListener("pointermove",this.onPointerMove),this._domElement.removeEventListener("pointerdown",this.onPointerDown),this._domElement.removeEventListener("pointerup",this.onPointerCancel),this._domElement.removeEventListener("pointerleave",this.onPointerCancel),this._domElement.removeEventListener("touchmove",this.onTouchMove),this._domElement.removeEventListener("touchstart",this.onTouchStart),this._domElement.removeEventListener("touchend",this.onTouchEnd),this._domElement.style.cursor=""}),sf(this,"dispose",()=>this.deactivate()),sf(this,"getObjects",()=>this._objects),sf(this,"getRaycaster",()=>this._raycaster),sf(this,"onMouseMove",e=>{let t=this._domElement.getBoundingClientRect();if(this._mouse.x=(e.clientX-t.left)/t.width*2-1,this._mouse.y=-((e.clientY-t.top)/t.height*2)+1,this._raycaster.setFromCamera(this._mouse,this._camera),this._selected&&this.enabled){this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.position.copy(this._intersection.sub(this._offset).applyMatrix4(this._inverseMatrix)),this.dispatchEvent({type:"drag",object:this._selected});return}if(this._intersections.length=0,this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.intersectObjects(this._objects,!0,this._intersections),this._intersections.length>0){let e=this._intersections[0].object;this._plane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._plane.normal),this._worldPosition.setFromMatrixPosition(e.matrixWorld)),this._hovered!==e&&(this.dispatchEvent({type:"hoveron",object:e}),this._domElement.style.cursor="pointer",this._hovered=e)}else null!==this._hovered&&(this.dispatchEvent({type:"hoveroff",object:this._hovered}),this._domElement.style.cursor="auto",this._hovered=null)}),sf(this,"onMouseDown",()=>{this._intersections.length=0,this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.intersectObjects(this._objects,!0,this._intersections),this._intersections.length>0&&(this._selected=!0===this.transformGroup?this._objects[0]:this._intersections[0].object,this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._offset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))),this._domElement.style.cursor="move",this.dispatchEvent({type:"dragstart",object:this._selected}))}),sf(this,"onMouseCancel",()=>{this._selected&&(this.dispatchEvent({type:"dragend",object:this._selected}),this._selected=null),this._domElement.style.cursor=this._hovered?"pointer":"auto"}),sf(this,"onPointerMove",e=>{switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}}),sf(this,"onPointerDown",e=>{switch(e.pointerType){case"mouse":case"pen":this.onMouseDown()}}),sf(this,"onPointerCancel",e=>{switch(e.pointerType){case"mouse":case"pen":this.onMouseCancel()}}),sf(this,"onTouchMove",e=>{e.preventDefault();let t=e.changedTouches[0],r=this._domElement.getBoundingClientRect();if(this._mouse.x=(t.clientX-r.left)/r.width*2-1,this._mouse.y=-((t.clientY-r.top)/r.height*2)+1,this._raycaster.setFromCamera(this._mouse,this._camera),this._selected&&this.enabled){this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.position.copy(this._intersection.sub(this._offset).applyMatrix4(this._inverseMatrix)),this.dispatchEvent({type:"drag",object:this._selected});return}}),sf(this,"onTouchStart",e=>{e.preventDefault();let t=e.changedTouches[0],r=this._domElement.getBoundingClientRect();this._mouse.x=(t.clientX-r.left)/r.width*2-1,this._mouse.y=-((t.clientY-r.top)/r.height*2)+1,this._intersections.length=0,this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.intersectObjects(this._objects,!0,this._intersections),this._intersections.length>0&&(this._selected=!0===this.transformGroup?this._objects[0]:this._intersections[0].object,this._plane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._plane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._plane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._offset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))),this._domElement.style.cursor="move",this.dispatchEvent({type:"dragstart",object:this._selected}))}),sf(this,"onTouchEnd",e=>{e.preventDefault(),this._selected&&(this.dispatchEvent({type:"dragend",object:this._selected}),this._selected=null),this._domElement.style.cursor="auto"}),this._objects=e,this._camera=t,this._domElement=r,this.activate()}}var sv=Object.defineProperty,sy=(e,t,r)=>t in e?sv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sx=(e,t,r)=>(sy(e,"symbol"!=typeof t?t+"":t,r),r);let sb=new ee.USm(0,0,0,"YXZ"),sw=new ee.Pa4,sC={type:"change"},sE={type:"lock"},sI={type:"unlock"},sM=Math.PI/2;class sB extends ee.pBf{constructor(e,t){super(),sx(this,"camera"),sx(this,"domElement"),sx(this,"isLocked"),sx(this,"minPolarAngle"),sx(this,"maxPolarAngle"),sx(this,"pointerSpeed"),sx(this,"onMouseMove",e=>{if(!this.domElement||!1===this.isLocked)return;let t=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;sb.setFromQuaternion(this.camera.quaternion),sb.y-=.002*t*this.pointerSpeed,sb.x-=.002*r*this.pointerSpeed,sb.x=Math.max(sM-this.maxPolarAngle,Math.min(sM-this.minPolarAngle,sb.x)),this.camera.quaternion.setFromEuler(sb),this.dispatchEvent(sC)}),sx(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(sE),this.isLocked=!0):(this.dispatchEvent(sI),this.isLocked=!1))}),sx(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),sx(this,"connect",e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),sx(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),sx(this,"dispose",()=>{this.disconnect()}),sx(this,"getObject",()=>this.camera),sx(this,"direction",new ee.Pa4(0,0,-1)),sx(this,"getDirection",e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion)),sx(this,"moveForward",e=>{sw.setFromMatrixColumn(this.camera.matrix,0),sw.crossVectors(this.camera.up,sw),this.camera.position.addScaledVector(sw,e)}),sx(this,"moveRight",e=>{sw.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(sw,e)}),sx(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),sx(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}var sS=Object.defineProperty,sT=(e,t,r)=>t in e?sS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sF=(e,t,r)=>(sT(e,"symbol"!=typeof t?t+"":t,r),r);class sP extends ee.pBf{constructor(e){super(),sF(this,"object"),sF(this,"changeEvent",{type:"change"}),sF(this,"EPS",1e-6),sF(this,"enabled",!0),sF(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),sF(this,"screenOrientation",0),sF(this,"alphaOffset",0),sF(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),sF(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),sF(this,"zee",new ee.Pa4(0,0,1)),sF(this,"euler",new ee.USm),sF(this,"q0",new ee._fP),sF(this,"q1",new ee._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5))),sF(this,"setObjectQuaternion",(e,t,r,n,a)=>{this.euler.set(r,t,-n,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-a))}),sF(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),sF(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),sF(this,"lastQuaternion",new ee._fP),sF(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?ee.M8C.degToRad(e.alpha)+this.alphaOffset:0,r=e.beta?ee.M8C.degToRad(e.beta):0,n=e.gamma?ee.M8C.degToRad(e.gamma):0,a=this.screenOrientation?ee.M8C.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,r,n,a),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),sF(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}var s_=Object.defineProperty,sD=(e,t,r)=>t in e?s_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sR=(e,t,r)=>(sD(e,"symbol"!=typeof t?t+"":t,r),r);class sL extends ee.pBf{constructor(e,t){super(),sR(this,"enabled",!0),sR(this,"screen",{left:0,top:0,width:0,height:0}),sR(this,"rotateSpeed",1),sR(this,"zoomSpeed",1.2),sR(this,"panSpeed",.3),sR(this,"noRotate",!1),sR(this,"noZoom",!1),sR(this,"noPan",!1),sR(this,"staticMoving",!1),sR(this,"dynamicDampingFactor",.2),sR(this,"minDistance",0),sR(this,"maxDistance",1/0),sR(this,"keys",["KeyA","KeyS","KeyD"]),sR(this,"mouseButtons",{LEFT:ee.RsA.ROTATE,MIDDLE:ee.RsA.DOLLY,RIGHT:ee.RsA.PAN}),sR(this,"object"),sR(this,"domElement"),sR(this,"cursorZoom",!1),sR(this,"target",new ee.Pa4),sR(this,"mousePosition",new ee.FM8),sR(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),sR(this,"EPS",1e-6),sR(this,"lastZoom",1),sR(this,"lastPosition",new ee.Pa4),sR(this,"cursorVector",new ee.Pa4),sR(this,"targetVector",new ee.Pa4),sR(this,"_state",this.STATE.NONE),sR(this,"_keyState",this.STATE.NONE),sR(this,"_eye",new ee.Pa4),sR(this,"_movePrev",new ee.FM8),sR(this,"_moveCurr",new ee.FM8),sR(this,"_lastAxis",new ee.Pa4),sR(this,"_lastAngle",0),sR(this,"_zoomStart",new ee.FM8),sR(this,"_zoomEnd",new ee.FM8),sR(this,"_touchZoomDistanceStart",0),sR(this,"_touchZoomDistanceEnd",0),sR(this,"_panStart",new ee.FM8),sR(this,"_panEnd",new ee.FM8),sR(this,"target0"),sR(this,"position0"),sR(this,"up0"),sR(this,"zoom0"),sR(this,"changeEvent",{type:"change"}),sR(this,"startEvent",{type:"start"}),sR(this,"endEvent",{type:"end"}),sR(this,"onScreenVector",new ee.FM8),sR(this,"getMouseOnScreen",(e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector)),sR(this,"onCircleVector",new ee.FM8),sR(this,"getMouseOnCircle",(e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector)),sR(this,"axis",new ee.Pa4),sR(this,"quaternion",new ee._fP),sR(this,"eyeDirection",new ee.Pa4),sR(this,"objectUpDirection",new ee.Pa4),sR(this,"objectSidewaysDirection",new ee.Pa4),sR(this,"moveDirection",new ee.Pa4),sR(this,"angle",0),sR(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),sR(this,"zoomCamera",()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom/=e,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(Math.abs((e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed)-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera?(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),sR(this,"mouseChange",new ee.FM8),sR(this,"objectUp",new ee.Pa4),sR(this,"pan",new ee.Pa4),sR(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){let e=this.object,t=(e.right-e.left)/this.object.zoom,r=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=r}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),sR(this,"checkDistances",()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),sR(this,"handleResize",()=>{if(!this.domElement)return;let e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}),sR(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),sR(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),sR(this,"keydown",e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))}),sR(this,"onPointerDown",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}}),sR(this,"onPointerMove",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}}),sR(this,"onPointerUp",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}}),sR(this,"keyup",()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),sR(this,"onMouseDown",e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN}let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),sR(this,"onMouseMove",e=>{if(!1===this.enabled)return;let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))}),sR(this,"onMouseUp",()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),sR(this,"mousewheel",e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-(e.offsetY/this.screen.height*2)+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),sR(this,"touchstart",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=this.STATE.TOUCH_ZOOM_PAN;let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+r*r);let n=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(n,a)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}}),sR(this,"touchmove",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);let n=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(n,a))}}}),sR(this,"touchend",e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}}),sR(this,"contextmenu",e=>{!1!==this.enabled&&e.preventDefault()}),sR(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),sR(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}var sN=r(37954),sk=Object.defineProperty,sU=(e,t,r)=>t in e?sk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sQ=(e,t,r)=>(sU(e,"symbol"!=typeof t?t+"":t,r),r);let sO={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},sG={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},sH={x:0,y:0},sz={camera:new ee.yGw,gizmos:new ee.yGw},sV={type:"change"},sj={type:"start"},sW={type:"end"};class sX extends ee.pBf{constructor(e,t=null,r=null){super(),sQ(this,"camera"),sQ(this,"domElement"),sQ(this,"scene"),sQ(this,"mouseActions"),sQ(this,"_mouseOp"),sQ(this,"_v2_1"),sQ(this,"_v3_1"),sQ(this,"_v3_2"),sQ(this,"_m4_1"),sQ(this,"_m4_2"),sQ(this,"_quat"),sQ(this,"_translationMatrix"),sQ(this,"_rotationMatrix"),sQ(this,"_scaleMatrix"),sQ(this,"_rotationAxis"),sQ(this,"_cameraMatrixState"),sQ(this,"_cameraProjectionState"),sQ(this,"_fovState"),sQ(this,"_upState"),sQ(this,"_zoomState"),sQ(this,"_nearPos"),sQ(this,"_farPos"),sQ(this,"_gizmoMatrixState"),sQ(this,"_up0"),sQ(this,"_zoom0"),sQ(this,"_fov0"),sQ(this,"_initialNear"),sQ(this,"_nearPos0"),sQ(this,"_initialFar"),sQ(this,"_farPos0"),sQ(this,"_cameraMatrixState0"),sQ(this,"_gizmoMatrixState0"),sQ(this,"_button"),sQ(this,"_touchStart"),sQ(this,"_touchCurrent"),sQ(this,"_input"),sQ(this,"_switchSensibility"),sQ(this,"_startFingerDistance"),sQ(this,"_currentFingerDistance"),sQ(this,"_startFingerRotation"),sQ(this,"_currentFingerRotation"),sQ(this,"_devPxRatio"),sQ(this,"_downValid"),sQ(this,"_nclicks"),sQ(this,"_downEvents"),sQ(this,"_clickStart"),sQ(this,"_maxDownTime"),sQ(this,"_maxInterval"),sQ(this,"_posThreshold"),sQ(this,"_movementThreshold"),sQ(this,"_currentCursorPosition"),sQ(this,"_startCursorPosition"),sQ(this,"_grid"),sQ(this,"_gridPosition"),sQ(this,"_gizmos"),sQ(this,"_curvePts"),sQ(this,"_timeStart"),sQ(this,"_animationId"),sQ(this,"focusAnimationTime"),sQ(this,"_timePrev"),sQ(this,"_timeCurrent"),sQ(this,"_anglePrev"),sQ(this,"_angleCurrent"),sQ(this,"_cursorPosPrev"),sQ(this,"_cursorPosCurr"),sQ(this,"_wPrev"),sQ(this,"_wCurr"),sQ(this,"adjustNearFar"),sQ(this,"scaleFactor"),sQ(this,"dampingFactor"),sQ(this,"wMax"),sQ(this,"enableAnimations"),sQ(this,"enableGrid"),sQ(this,"cursorZoom"),sQ(this,"minFov"),sQ(this,"maxFov"),sQ(this,"enabled"),sQ(this,"enablePan"),sQ(this,"enableRotate"),sQ(this,"enableZoom"),sQ(this,"minDistance"),sQ(this,"maxDistance"),sQ(this,"minZoom"),sQ(this,"maxZoom"),sQ(this,"target"),sQ(this,"_currentTarget"),sQ(this,"_tbRadius"),sQ(this,"_state"),sQ(this,"onWindowResize",()=>{let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}let t=this._tbRadius/e,r=new ee.Ny0(0,0,t,t).getPoints(this._curvePts),n=new ee.u9r().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=n;this.dispatchEvent(sV)}),sQ(this,"onContextMenu",e=>{if(this.enabled){for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}}),sQ(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=sG.NONE}),sQ(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=sG.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case sG.NONE:this._input=sG.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case sG.ONE_FINGER:case sG.ONE_FINGER_SWITCHED:this._input=sG.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case sG.TWO_FINGER:this._input=sG.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==sG.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=sG.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),sQ(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=sG.CURSOR)switch(this._input){case sG.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,sO.ROTATE);break;case sG.ONE_FINGER_SWITCHED:this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility&&(this._input=sG.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE"));break;case sG.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case sG.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==sG.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");let r=this.getOpStateFromAction(this._button,t);r&&this.onSinglePanMove(e,r)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),sQ(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=sG.CURSOR){let t=this._touchCurrent.length;for(let r=0;r<t;r++)if(this._touchCurrent[r].pointerId==e.pointerId){this._touchCurrent.splice(r,1),this._touchStart.splice(r,1);break}switch(this._input){case sG.ONE_FINGER:case sG.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=sG.NONE,this.onSinglePanEnd();break;case sG.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=sG.ONE_FINGER_SWITCHED;break;case sG.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=sG.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==sG.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=sG.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary){if(this._downValid){if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime){if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{let t=e.timeStamp-this._clickStart,r=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&r<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}}),sQ(this,"onWheel",e=>{var t,r;if(this.enabled&&this.enableZoom&&this.domElement){let n=null;e.ctrlKey||e.metaKey?n="CTRL":e.shiftKey&&(n="SHIFT");let a=this.getOpFromAction("WHEEL",n);if(a){e.preventDefault(),this.dispatchEvent(sj);let n=e.deltaY/125,s=1;switch(n>0?s=1/this.scaleFactor:n<0&&(s=this.scaleFactor),a){case"ZOOM":if(this.updateTbState(sO.SCALE,!0),n>0?s=1/Math.pow(this.scaleFactor,n):n<0&&(s=Math.pow(this.scaleFactor,-n)),this.cursorZoom&&this.enablePan){let n;this.camera instanceof ee.iKG&&(n=null==(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof ee.cPb&&(n=null==(r=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:r.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),void 0!==n&&this.applyTransformMatrix(this.applyScale(s,n))}else this.applyTransformMatrix(this.applyScale(s,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sV),this.dispatchEvent(sW);break;case"FOV":if(this.camera instanceof ee.cPb){this.updateTbState(sO.FOV,!0),0!=e.deltaX&&(n=e.deltaX/125,s=1,n>0?s=1/Math.pow(this.scaleFactor,n):n<0&&(s=Math.pow(this.scaleFactor,-n))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let t=this._v3_1.distanceTo(this._gizmos.position),r=t/s;r=ee.M8C.clamp(r,this.minDistance,this.maxDistance);let a=t*Math.tan(ee.M8C.DEG2RAD*this.camera.fov*.5),o=ee.M8C.RAD2DEG*(2*Math.atan(a/r));o>this.maxFov?o=this.maxFov:o<this.minFov&&(o=this.minFov),s=t/(a/Math.tan(ee.M8C.DEG2RAD*(o/2))),this.setFov(o),this.applyTransformMatrix(this.applyScale(s,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sV),this.dispatchEvent(sW)}}}}),sQ(this,"onSinglePanStart",(e,t)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(sj),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(sV)),this.camera){this.updateTbState(sO.PAN,!0);let e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(sV))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(sO.ROTATE,!0);let e=this.unprojectOnTbSurface(this.camera,sH.x,sH.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(sV);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof ee.cPb&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(sV)),this.updateTbState(sO.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(sV)),this.updateTbState(sO.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),sQ(this,"onSinglePanMove",(e,t)=>{if(this.enabled&&this.domElement){let r=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case sO.PAN:if(this.enablePan&&this.camera){if(r){this.dispatchEvent(sW),this.dispatchEvent(sj),this.updateTbState(t,!0);let e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{let e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}}break;case sO.ROTATE:if(this.enableRotate&&this.camera){if(r){this.dispatchEvent(sW),this.dispatchEvent(sj),this.updateTbState(t,!0);let e=this.unprojectOnTbSurface(this.camera,sH.x,sH.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{let e=this.unprojectOnTbSurface(this.camera,sH.x,sH.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);let t=this._startCursorPosition.distanceTo(this._currentCursorPosition),r=this._startCursorPosition.angleTo(this._currentCursorPosition),n=Math.max(t/this._tbRadius,r);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),n)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=n,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}}break;case sO.SCALE:if(this.enableZoom){if(r)this.dispatchEvent(sW),this.dispatchEvent(sj),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this.applyTransformMatrix(this.applyScale(t,this._gizmos.position))}}break;case sO.FOV:if(this.enableZoom&&this.camera instanceof ee.cPb){if(r)this.dispatchEvent(sW),this.dispatchEvent(sj),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let r=this._v3_1.distanceTo(this._gizmos.position),n=r/t;n=ee.M8C.clamp(n,this.minDistance,this.maxDistance);let a=r*Math.tan(ee.M8C.DEG2RAD*this._fovState*.5),s=ee.M8C.RAD2DEG*(2*Math.atan(a/n));s=ee.M8C.clamp(s,this.minFov,this.maxFov);let o=a/Math.tan(ee.M8C.DEG2RAD*(s/2));t=r/o,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(s),this.applyTransformMatrix(this.applyScale(t,this._v3_2,!1));let l=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(o/r);this._m4_1.makeTranslation(l.x,l.y,l.z)}}}this.dispatchEvent(sV)}}),sQ(this,"onSinglePanEnd",()=>{if(this._state==sO.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){let e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame(function(r){t.updateTbState(sO.ANIMATION_ROTATE,!0);let n=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(r,n,Math.min(e,t.wMax))})}else this.updateTbState(sO.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(sV)}else this.updateTbState(sO.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(sV)}else(this._state==sO.PAN||this._state==sO.IDLE)&&(this.updateTbState(sO.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(sV));this.dispatchEvent(sW)}),sQ(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(sj),this.setCenter(e.clientX,e.clientY);let t=this.unprojectOnObj(this.getCursorNDC(sH.x,sH.y,this.domElement),this.camera);if(t&&this.enableAnimations){let e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(r){e.updateTbState(sO.ANIMATION_FOCUS,!0),e.onFocusAnim(r,t,e._cameraMatrixState,e._gizmoMatrixState)})}else t&&!this.enableAnimations&&(this.updateTbState(sO.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sV))}this.dispatchEvent(sW)}),sQ(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(sj),this.updateTbState(sO.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),sQ(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=sO.PAN&&(this.updateTbState(sO.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));let e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(sV)}}),sQ(this,"onDoublePanEnd",()=>{this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sW)}),sQ(this,"onRotateStart",()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(sj),this.updateTbState(sO.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null==(e=this.camera)||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))}),sQ(this,"onRotateMove",()=>{var e;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=sO.ZROTATE&&(this.updateTbState(sO.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null==(e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=new ee.Pa4().setFromMatrixPosition(this._gizmoMatrixState);let r=ee.M8C.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,r)),this.dispatchEvent(sV)}}),sQ(this,"onRotateEnd",()=>{this.updateTbState(sO.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(sW)}),sQ(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(sj),this.updateTbState(sO.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),sQ(this,"onPinchMove",()=>{var e,t;if(this.enabled&&this.enableZoom&&this.domElement){let r;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=sO.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(sO.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),12*this._devPxRatio);let n=this._currentFingerDistance/this._startFingerDistance;this.enablePan?this.camera instanceof ee.iKG?r=null==(e=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof ee.cPb&&(r=null==(t=this.unprojectOnTbPlane(this.camera,sH.x,sH.y,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):r=this._gizmos.position,void 0!==r&&this.applyTransformMatrix(this.applyScale(n,r)),this.dispatchEvent(sV)}}),sQ(this,"onPinchEnd",()=>{this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sW)}),sQ(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(sj),this.updateTbState(sO.SCALE,!0);let e=0,t=0,r=this._touchCurrent.length;for(let n=0;n<r;n++)e+=this._touchCurrent[n].clientX,t+=this._touchCurrent[n].clientY;this.setCenter(e/r,t/r),this._startCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),sQ(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0,r=this._touchCurrent.length;for(let n=0;n<r;n++)e+=this._touchCurrent[n].clientX,t+=this._touchCurrent[n].clientY;this.setCenter(e/r,t/r),this._currentCursorPosition.setY(.5*this.getCursorNDC(sH.x,sH.y,this.domElement).y);let n=this._currentCursorPosition.y-this._startCursorPosition.y,a=1;n<0?a=1/Math.pow(this.scaleFactor,-(8*n)):n>0&&(a=Math.pow(this.scaleFactor,8*n)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let s=this._v3_1.distanceTo(this._gizmos.position),o=s/a;o=ee.M8C.clamp(o,this.minDistance,this.maxDistance);let l=s*Math.tan(ee.M8C.DEG2RAD*this._fovState*.5),h=ee.M8C.RAD2DEG*(2*Math.atan(l/o));h=ee.M8C.clamp(h,this.minFov,this.maxFov);let c=l/Math.tan(ee.M8C.DEG2RAD*(h/2));a=s/c,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(h),this.applyTransformMatrix(this.applyScale(a,this._v3_2,!1));let u=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(c/s);this._m4_1.makeTranslation(u.x,u.y,u.z),this.dispatchEvent(sV)}}),sQ(this,"onTriplePanEnd",()=>{this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sW)}),sQ(this,"setCenter",(e,t)=>{sH.x=e,sH.y=t}),sQ(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),sQ(this,"setMouseAction",(e,t,r=null)=>{let n;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(r)||"WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":n=sO.PAN;break;case"ROTATE":n=sO.ROTATE;break;case"ZOOM":n=sO.SCALE;break;case"FOV":n=sO.FOV}let a={operation:e,mouse:t,key:r,state:n};for(let e=0;e<this.mouseActions.length;e++)if(this.mouseActions[e].mouse==a.mouse&&this.mouseActions[e].key==a.key)return this.mouseActions.splice(e,1,a),!0;return this.mouseActions.push(a),!0}),sQ(this,"getOpFromAction",(e,t)=>{let r;for(let n=0;n<this.mouseActions.length;n++)if((r=this.mouseActions[n]).mouse==e&&r.key==t)return r.operation;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.operation}return null}),sQ(this,"getOpStateFromAction",(e,t)=>{let r;for(let n=0;n<this.mouseActions.length;n++)if((r=this.mouseActions[n]).mouse==e&&r.key==t)return r.state;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.state}return null}),sQ(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),sQ(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),sQ(this,"calculateAngularSpeed",(e,t,r,n)=>{let a=(n-r)/1e3;return 0==a?0:(t-e)/a}),sQ(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),sQ(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),sQ(this,"calculateTbRadius",e=>{let t=e.position.distanceTo(this._gizmos.position);if(e instanceof ee.cPb){let r=ee.M8C.DEG2RAD*e.fov*.5,n=Math.atan(e.aspect*Math.tan(r));return Math.tan(Math.min(r,n))*t*.67}if(e instanceof ee.iKG)return .67*Math.min(e.top,e.right)}),sQ(this,"focus",(e,t,r=1)=>{if(this.camera){let n=e.clone();n.sub(this._gizmos.position).multiplyScalar(r),this._translationMatrix.makeTranslation(n.x,n.y,n.z);let a=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);let s=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(a),this._cameraMatrixState.copy(s)}}),sQ(this,"drawGrid",()=>{if(this.scene){let e,t,r,n;if(this.camera instanceof ee.iKG)n=(r=Math.max(this.camera.right-this.camera.left,this.camera.bottom-this.camera.top))/20,t=(e=r/this.camera.zoom*3)/n*this.camera.zoom;else if(this.camera instanceof ee.cPb){let a=this.camera.position.distanceTo(this._gizmos.position),s=ee.M8C.DEG2RAD*this.camera.fov*.5,o=Math.atan(this.camera.aspect*Math.tan(s));n=(r=Math.tan(Math.max(s,o))*a*2)/20,t=(e=3*r)/n}null==this._grid&&this.camera&&(this._grid=new ee.VLJ(e,t,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),sQ(this,"connect",e=>{e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),sQ(this,"dispose",()=>{var e,t,r,n,a;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointercancel",this.onPointerCancel),null==(r=this.domElement)||r.removeEventListener("wheel",this.onWheel),null==(n=this.domElement)||n.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null==(a=this.scene)||a.remove(this._gizmos),this.disposeGrid()}),sQ(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),sQ(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),sQ(this,"activateGizmos",e=>{for(let t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})}),sQ(this,"getCursorNDC",(e,t,r)=>{let n=r.getBoundingClientRect();return this._v2_1.setX((e-n.left)/n.width*2-1),this._v2_1.setY((n.bottom-t)/n.height*2-1),this._v2_1.clone()}),sQ(this,"getCursorPosition",(e,t,r)=>(this._v2_1.copy(this.getCursorNDC(e,t,r)),this.camera instanceof ee.iKG&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),sQ(this,"setCamera",e=>{if(e){e.lookAt(this.target),e.updateMatrix(),e instanceof ee.cPb&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();let t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}}),sQ(this,"makeGizmos",(e,t)=>{let r=new ee.Ny0(0,0,t,t).getPoints(this._curvePts),n=new ee.u9r().setFromPoints(r),a=new ee.nls({color:16744576,fog:!1,transparent:!0,opacity:.6}),s=new ee.nls({color:8454016,fog:!1,transparent:!0,opacity:.6}),o=new ee.nls({color:8421631,fog:!1,transparent:!0,opacity:.6}),l=new ee.x12(n,a),h=new ee.x12(n,s),c=new ee.x12(n,o),u=.5*Math.PI;if(l.rotation.x=u,h.rotation.y=u,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){let t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(l),this._gizmos.add(h),this._gizmos.add(c)}),sQ(this,"onFocusAnim",(e,t,r,n)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==sO.ANIMATION_FOCUS){let a=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(n),a>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(sO.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(sV);else{let e=this.easeOutCubic(a),s=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,s,e),this.dispatchEvent(sV);let o=this;this._animationId=window.requestAnimationFrame(function(e){o.onFocusAnim(e,t,r,n.clone())})}}else this._animationId=-1,this._timeStart=-1}),sQ(this,"onRotationAnim",(e,t,r)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==sO.ANIMATION_ROTATE){let n=(e-this._timeStart)/1e3;if(r+-this.dampingFactor*n>0){this._angleCurrent=-(.5*this.dampingFactor)*Math.pow(n,2)+r*n+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(sV);let e=this;this._animationId=window.requestAnimationFrame(function(n){e.onRotationAnim(n,t,r)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(sO.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(sV)}else this._animationId=-1,this._timeStart=-1,this._state!=sO.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(sV))}),sQ(this,"pan",(e,t,r=!1)=>{if(this.camera){let n=e.clone().sub(t);if(this.camera instanceof ee.iKG&&n.multiplyScalar(1/this.camera.zoom),this.camera instanceof ee.cPb&&r){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);let e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);n.multiplyScalar(1/e)}this._v3_1.set(n.x,n.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return sz}),sQ(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof ee.cPb&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sV)}}),sQ(this,"rotate",(e,t)=>{let r=this._gizmos.position;return this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),sz}),sQ(this,"copyState",()=>{if(this.camera){let e=JSON.stringify(this.camera instanceof ee.iKG?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(e)}}),sQ(this,"pasteState",()=>{let e=this;navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})}),sQ(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof ee.cPb&&(this._fov0=this.camera.fov))}),sQ(this,"applyScale",(e,t,r=!0)=>{if(!this.camera)return;let n=t.clone(),a=1/e;if(this.camera instanceof ee.iKG){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,a=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,a=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(a,a,a),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),n.sub(this._v3_1);let t=n.clone().multiplyScalar(a);return n.sub(t),this._m4_1.makeTranslation(n.x,n.y,n.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),sz}if(this.camera instanceof ee.cPb){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(n),t=e-e*a,s=e-t;s<this.minDistance?(a=this.minDistance/e,t=e-e*a):s>this.maxDistance&&(a=this.maxDistance/e,t=e-e*a);let o=n.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(o.x,o.y,o.z),r){let r=this._v3_2;t=(e=r.distanceTo(n))-e*a,o=n.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._scaleMatrix.makeScale(a,a,a),this._m4_2.makeTranslation(o.x,o.y,o.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return sz}}),sQ(this,"setFov",e=>{this.camera instanceof ee.cPb&&(this.camera.fov=ee.M8C.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),sQ(this,"setTarget",(e,t,r)=>{if(this.camera){this.target.set(e,t,r),this._gizmos.position.set(e,t,r);let n=this.calculateTbRadius(this.camera);void 0!==n&&(this._tbRadius=n),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),sQ(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),sz)),sQ(this,"unprojectOnObj",(e,t)=>{if(!this.scene)return null;let r=new ee.iMs;r.near=t.near,r.far=t.far,r.setFromCamera(e,t);let n=r.intersectObjects(this.scene.children,!0);for(let e=0;e<n.length;e++)if(n[e].object.uuid!=this._gizmos.uuid&&n[e].face)return n[e].point.clone();return null}),sQ(this,"unprojectOnTbSurface",(e,t,r,n,a)=>{if(e instanceof ee.iKG){this._v2_1.copy(this.getCursorPosition(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);let e=Math.pow(this._v2_1.x,2),a=Math.pow(this._v2_1.y,2),s=Math.pow(this._tbRadius,2);return e+a<=.5*s?this._v3_1.setZ(Math.sqrt(s-(e+a))):this._v3_1.setZ(.5*s/Math.sqrt(e+a)),this._v3_1}if(e instanceof ee.cPb){this._v2_1.copy(this.getCursorNDC(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let s=this._v3_1.clone().normalize(),o=e.position.distanceTo(this._gizmos.position),l=Math.pow(a,2),h=this._v3_1.z,c=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==c)return s.set(this._v3_1.x,this._v3_1.y,a),s;let u=h/c,d=Math.pow(u,2)+1,m=2*u*o,p=Math.pow(o,2)-l,A=Math.pow(m,2)-4*d*p;if(A>=0&&(this._v2_1.setX((-m-Math.sqrt(A))/(2*d)),this._v2_1.setY(u*this._v2_1.x+o),ee.M8C.RAD2DEG*this._v2_1.angle()>=45)){let e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(o-this._v2_1.y,2));return s.multiplyScalar(e),s.z+=o,s}d=u,A=Math.pow(m=o,2)-4*d*(p=-(.5*l)),this._v2_1.setX((-m-Math.sqrt(A))/(2*d)),this._v2_1.setY(u*this._v2_1.x+o);let f=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(o-this._v2_1.y,2));return s.multiplyScalar(f),s.z+=o,s}}),sQ(this,"unprojectOnTbPlane",(e,t,r,n,a=!1)=>{if(e instanceof ee.iKG)return this._v2_1.copy(this.getCursorPosition(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(e instanceof ee.cPb){let s;this._v2_1.copy(this.getCursorNDC(t,r,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let o=this._v3_1.clone().normalize(),l=this._v3_1.z,h=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));return(s=a?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==h)?o.set(0,0,0):(o.multiplyScalar(Math.sqrt(Math.pow(s,2)+Math.pow(-s/(l/h),2))),o.z=0),o}}),sQ(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof ee.iKG&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof ee.cPb&&(this._fovState=this.camera.fov))}),sQ(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),sQ(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof ee.iKG&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){let e=ee.M8C.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof ee.cPb){let e=this.camera.position.distanceTo(this._gizmos.position);if(e>this.maxDistance+1e-6||e<this.minDistance-1e-6){let t=ee.M8C.clamp(e,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(t/e,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=ee.M8C.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());let t=this._tbRadius,r=this.calculateTbRadius(this.camera);if(void 0!==r&&(this._tbRadius=r),t<this._tbRadius-1e-6||t>this._tbRadius+1e-6){let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,r=new ee.Ny0(0,0,t,t).getPoints(this._curvePts),n=new ee.u9r().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=n}}this.camera.lookAt(this._gizmos.position)}}),sQ(this,"setStateFromJSON",e=>{let t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera instanceof ee.cPb&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);let r=new ee.yGw().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(r),this.camera.lookAt(this._gizmos.position),this.updateTbState(sO.IDLE,!1),this.dispatchEvent(sV)}}),this.camera=null,this.domElement=t,this.scene=r,this.mouseActions=[],this._mouseOp=null,this._v2_1=new ee.FM8,this._v3_1=new ee.Pa4,this._v3_2=new ee.Pa4,this._m4_1=new ee.yGw,this._m4_2=new ee.yGw,this._quat=new ee._fP,this._translationMatrix=new ee.yGw,this._rotationMatrix=new ee.yGw,this._scaleMatrix=new ee.yGw,this._rotationAxis=new ee.Pa4,this._cameraMatrixState=new ee.yGw,this._cameraProjectionState=new ee.yGw,this._fovState=1,this._upState=new ee.Pa4,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new ee.yGw,this._up0=new ee.Pa4,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new ee.yGw,this._gizmoMatrixState0=new ee.yGw,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=sG.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new ee.Pa4,this._startCursorPosition=new ee.Pa4,this._grid=null,this._gridPosition=new ee.Pa4,this._gizmos=new ee.ZAu,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new ee.Pa4,this._cursorPosCurr=new ee.Pa4,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new ee.Pa4(0,0,0),this._currentTarget=new ee.Pa4(0,0,0),this._tbRadius=1,this._state=sO.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if((null==e?void 0:e.camera)&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==sO.ROTATE||this._state==sO.ZROTATE||this._state==sO.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),(null==e?void 0:e.gizmos)&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==sO.SCALE||this._state==sO.FOCUS||this._state==sO.ANIMATION_FOCUS)&&this.camera){let e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){let e=this.camera.position.distanceTo(this._gizmos.position),t=new ee.ZzF;t.setFromObject(this._gizmos);let r=new ee.aLr;t.getBoundingSphere(r);let n=Math.max(this._nearPos0,r.radius+r.center.length()),a=e-this._initialNear;this.camera.near=e-Math.min(n,a);let s=Math.min(this._farPos0,-r.radius+r.center.length()),o=e-this._initialFar;this.camera.far=e-Math.min(s,o),this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(sV)}setTransformationMatrices(e=null,t=null){e?sz.camera?sz.camera.copy(e):sz.camera=e.clone():sz.camera=null,t?sz.gizmos?sz.gizmos.copy(t):sz.gizmos=t.clone():sz.gizmos=null}}var sY=r(84270),sK=r(60371);let sJ={defines:{USE_3DTEXTURE:1},uniforms:{lut3d:{value:null},lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform float lutSize;
		#if USE_3DTEXTURE
		precision highp sampler3D;
		uniform sampler3D lut3d;
		#else
		uniform sampler2D lut;

		vec3 lutLookup( sampler2D tex, float size, vec3 rgb ) {

			float sliceHeight = 1.0 / size;
			float yPixelHeight = 1.0 / ( size * size );

			// Get the slices on either side of the sample
			float slice = rgb.b * size;
			float interp = fract( slice );
			float slice0 = slice - interp;
			float centeredInterp = interp - 0.5;

			float slice1 = slice0 + sign( centeredInterp );

			// Pull y sample in by half a pixel in each direction to avoid color
			// bleeding from adjacent slices.
			float greenOffset = clamp( rgb.g * sliceHeight, yPixelHeight * 0.5, sliceHeight - yPixelHeight * 0.5 );

			vec2 uv0 = vec2(
				rgb.r,
				slice0 * sliceHeight + greenOffset
			);
			vec2 uv1 = vec2(
				rgb.r,
				slice1 * sliceHeight + greenOffset
			);

			vec3 sample0 = texture2D( tex, uv0 ).rgb;
			vec3 sample1 = texture2D( tex, uv1 ).rgb;

			return mix( sample0, sample1, abs( centeredInterp ) );

		}
		#endif

		varying vec2 vUv;
		uniform float intensity;
		uniform sampler2D tDiffuse;
		void main() {

			vec4 val = texture2D( tDiffuse, vUv );
			vec4 lutVal;

			// pull the sample in by half a pixel so the sample begins
			// at the center of the edge pixels.
			float pixelWidth = 1.0 / lutSize;
			float halfPixelWidth = 0.5 / lutSize;
			vec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );

			#if USE_3DTEXTURE

			lutVal = vec4( texture( lut3d, uvw ).rgb, val.a );

			#else

			lutVal = vec4( lutLookup( lut, lutSize, uvw ), val.a );

			#endif

			gl_FragColor = vec4( mix( val, lutVal, intensity ) );

		}

	`};class sq extends sK.T{set lut(e){let t=this.material;if(e!==this.lut&&(t.uniforms.lut3d.value=null,t.uniforms.lut.value=null,e)){let r=e.isData3DTexture?1:0;r!==t.defines.USE_3DTEXTURE&&(t.defines.USE_3DTEXTURE=r,t.needsUpdate=!0),t.uniforms.lutSize.value=e.image.width,e.isData3DTexture?t.uniforms.lut3d.value=e:t.uniforms.lut.value=e}}get lut(){return this.material.uniforms.lut.value||this.material.uniforms.lut3d.value}set intensity(e){this.material.uniforms.intensity.value=e}get intensity(){return this.material.uniforms.intensity.value}constructor(e={}){super(sJ),this.lut=e.lut||null,this.intensity="intensity"in e?e.intensity:1}}var sZ=r(592),s$=Object.defineProperty,s0=(e,t,r)=>t in e?s$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s1=(e,t,r)=>(s0(e,"symbol"!=typeof t?t+"":t,r),r);class s2 extends sZ.w{constructor(e,t){super(),s1(this,"clearColor"),s1(this,"clearAlpha"),s1(this,"_oldClearColor"),this.needsSwap=!1,this.clearColor=void 0!==e?e:0,this.clearAlpha=void 0!==t?t:0,this._oldClearColor=new ee.Ilk}render(e,t,r){let n;this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),this.clearColor&&e.setClearColor(this._oldClearColor,n)}}let s3={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:`varying vec2 vUv;
     void main() {
     	 vUv = uv;
     	 gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
     }`,fragmentShader:`uniform int byp; //should we apply the glitch ?
     uniform sampler2D tDiffuse;
     uniform sampler2D tDisp;
     uniform float amount;
     uniform float angle;
     uniform float seed;
     uniform float seed_x;
     uniform float seed_y;
     uniform float distortion_x;
     uniform float distortion_y;
     uniform float col_s;

     varying vec2 vUv;

     float rand(vec2 co){
     	 return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
     }

     void main() {
     	if(byp<1) {
     		vec2 p = vUv;
     		float xs = floor(gl_FragCoord.x / 0.5);
     		float ys = floor(gl_FragCoord.y / 0.5);
    //based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
     		vec4 normal = texture2D (tDisp, p*seed*seed);
     		if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {
     			if(seed_x>0.){
     				p.y = 1. - (p.y + distortion_y);
     			}
     			else {
     				p.y = distortion_y;
     			}
     		}
     		if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {
     			if(seed_y>0.){
     				p.x=distortion_x;
     			}
     			else {
     				p.x = 1. - (p.x + distortion_x);
     			}
     		}
     		p.x+=normal.x*seed_x*(seed/5.);
     		p.y+=normal.y*seed_y*(seed/5.);
    //base from RGB shift shader
     		vec2 offset = amount * vec2( cos(angle), sin(angle));
     		vec4 cr = texture2D(tDiffuse, p + offset);
     		vec4 cga = texture2D(tDiffuse, p);
     		vec4 cb = texture2D(tDiffuse, p - offset);
     		gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);
    //add noise
     		vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);
     		gl_FragColor = gl_FragColor+ snow;
     	}
     	else {
     		gl_FragColor=texture2D (tDiffuse, vUv);
     	}
    }`};var s4=Object.defineProperty,s5=(e,t,r)=>t in e?s4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s8=(e,t,r)=>(s5(e,"symbol"!=typeof t?t+"":t,r),r);class s6 extends sZ.w{constructor(e=64){super(),s8(this,"material"),s8(this,"fsQuad"),s8(this,"goWild"),s8(this,"curF"),s8(this,"randX"),s8(this,"uniforms"),this.uniforms=ee.rDY.clone(s3.uniforms),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new ee.jyz({uniforms:this.uniforms,vertexShader:s3.vertexShader,fragmentShader:s3.fragmentShader}),this.fsQuad=new sZ.T(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,r){!1===e.capabilities.isWebGL2&&(this.uniforms.tDisp.value.format=ee.Y8D),this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||!0==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=ee.M8C.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=ee.M8C.randFloat(-1,1),this.uniforms.seed_y.value=ee.M8C.randFloat(-1,1),this.uniforms.distortion_x.value=ee.M8C.randFloat(0,1),this.uniforms.distortion_y.value=ee.M8C.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=ee.M8C.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=ee.M8C.randFloat(0,1),this.uniforms.distortion_y.value=ee.M8C.randFloat(0,1),this.uniforms.seed_x.value=ee.M8C.randFloat(-.3,.3),this.uniforms.seed_y.value=ee.M8C.randFloat(-.3,.3)):!1==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}generateTrigger(){this.randX=ee.M8C.randInt(120,240)}generateHeightmap(e){let t=new Float32Array(e*e),r=e*e;for(let e=0;e<r;e++){let r=ee.M8C.randFloat(0,1);t[e]=r}let n=new ee.IEO(t,e,e,ee.hEm,ee.VzW);return n.needsUpdate=!0,n}}let s9={uniforms:{tDiffuse:{value:null},shape:{value:1},radius:{value:4},rotateR:{value:Math.PI/12*1},rotateG:{value:Math.PI/12*2},rotateB:{value:Math.PI/12*3},scatter:{value:0},width:{value:1},height:{value:1},blending:{value:1},blendingMode:{value:1},greyscale:{value:!1},disable:{value:!1}},vertexShader:"varying vec2 vUV;\nvoid main() {\n	vUV = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"#define SQRT2_MINUS_ONE 0.41421356\n#define SQRT2_HALF_MINUS_ONE 0.20710678\n#define PI2 6.28318531\n#define SHAPE_DOT 1\n#define SHAPE_ELLIPSE 2\n#define SHAPE_LINE 3\n#define SHAPE_SQUARE 4\n#define BLENDING_LINEAR 1\n#define BLENDING_MULTIPLY 2\n#define BLENDING_ADD 3\n#define BLENDING_LIGHTER 4\n#define BLENDING_DARKER 5\nuniform sampler2D tDiffuse;\nuniform float radius;\nuniform float rotateR;\nuniform float rotateG;\nuniform float rotateB;\nuniform float scatter;\nuniform float width;\nuniform float height;\nuniform int shape;\nuniform bool disable;\nuniform float blending;\nuniform int blendingMode;\nvarying vec2 vUV;\nuniform bool greyscale;\nconst int samples = 8;\nfloat blend( float a, float b, float t ) {\n	return a * ( 1.0 - t ) + b * t;\n}\nfloat hypot( float x, float y ) {\n	return sqrt( x * x + y * y );\n}\nfloat rand( vec2 seed ){\nreturn fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );\n}\nfloat distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {\n	float dist = hypot( coord.x - p.x, coord.y - p.y );\n	float rad = channel;\n	if ( shape == SHAPE_DOT ) {\n		rad = pow( abs( rad ), 1.125 ) * rad_max;\n	} else if ( shape == SHAPE_ELLIPSE ) {\n		rad = pow( abs( rad ), 1.125 ) * rad_max;\n		if ( dist != 0.0 ) {\n			float dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );\n			dist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;\n		}\n	} else if ( shape == SHAPE_LINE ) {\n		rad = pow( abs( rad ), 1.5) * rad_max;\n		float dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;\n		dist = hypot( normal.x * dot_p, normal.y * dot_p );\n	} else if ( shape == SHAPE_SQUARE ) {\n		float theta = atan( p.y - coord.y, p.x - coord.x ) - angle;\n		float sin_t = abs( sin( theta ) );\n		float cos_t = abs( cos( theta ) );\n		rad = pow( abs( rad ), 1.4 );\n		rad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );\n	}\n	return rad - dist;\n}\nstruct Cell {\n	vec2 normal;\n	vec2 p1;\n	vec2 p2;\n	vec2 p3;\n	vec2 p4;\n	float samp2;\n	float samp1;\n	float samp3;\n	float samp4;\n};\nvec4 getSample( vec2 point ) {\n	vec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );\n	float base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;\n	float step = PI2 / float( samples );\n	float dist = radius * 0.66;\n	for ( int i = 0; i < samples; ++i ) {\n		float r = base + step * float( i );\n		vec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );\n		tex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );\n	}\n	tex /= float( samples ) + 1.0;\n	return tex;\n}\nfloat getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {\n	float dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;\n	if ( channel == 0 ) {\n		c.samp1 = getSample( c.p1 ).r;\n		c.samp2 = getSample( c.p2 ).r;\n		c.samp3 = getSample( c.p3 ).r;\n		c.samp4 = getSample( c.p4 ).r;\n	} else if (channel == 1) {\n		c.samp1 = getSample( c.p1 ).g;\n		c.samp2 = getSample( c.p2 ).g;\n		c.samp3 = getSample( c.p3 ).g;\n		c.samp4 = getSample( c.p4 ).g;\n	} else {\n		c.samp1 = getSample( c.p1 ).b;\n		c.samp3 = getSample( c.p3 ).b;\n		c.samp2 = getSample( c.p2 ).b;\n		c.samp4 = getSample( c.p4 ).b;\n	}\n	dist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );\n	dist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );\n	dist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );\n	dist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );\n	res = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;\n	res += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;\n	res += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;\n	res += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;\n	res = clamp( res, 0.0, 1.0 );\n	return res;\n}\nCell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {\n	Cell c;\n	vec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );\n	float threshold = step * 0.5;\n	float dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );\n	float dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );\n	vec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );\n	float offset_normal = mod( hypot( offset.x, offset.y ), step );\n	float normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;\n	float normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;\n	float offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );\n	float line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;\n	float line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;\n	c.normal = n;\n	c.p1.x = p.x - n.x * normal_scale + n.y * line_scale;\n	c.p1.y = p.y - n.y * normal_scale - n.x * line_scale;\n	if ( scatter != 0.0 ) {\n		float off_mag = scatter * threshold * 0.5;\n		float off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;\n		c.p1.x += cos( off_angle ) * off_mag;\n		c.p1.y += sin( off_angle ) * off_mag;\n	}\n	float normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );\n	float line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );\n	c.p2.x = c.p1.x - n.x * normal_step;\n	c.p2.y = c.p1.y - n.y * normal_step;\n	c.p3.x = c.p1.x + n.y * line_step;\n	c.p3.y = c.p1.y - n.x * line_step;\n	c.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;\n	c.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;\n	return c;\n}\nfloat blendColour( float a, float b, float t ) {\n	if ( blendingMode == BLENDING_LINEAR ) {\n		return blend( a, b, 1.0 - t );\n	} else if ( blendingMode == BLENDING_ADD ) {\n		return blend( a, min( 1.0, a + b ), t );\n	} else if ( blendingMode == BLENDING_MULTIPLY ) {\n		return blend( a, max( 0.0, a * b ), t );\n	} else if ( blendingMode == BLENDING_LIGHTER ) {\n		return blend( a, max( a, b ), t );\n	} else if ( blendingMode == BLENDING_DARKER ) {\n		return blend( a, min( a, b ), t );\n	} else {\n		return blend( a, b, 1.0 - t );\n	}\n}\nvoid main() {\n	if ( ! disable ) {\n		vec2 p = vec2( vUV.x * width, vUV.y * height );\n		vec2 origin = vec2( 0, 0 );\n		float aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;\n		Cell cell_r = getReferenceCell( p, origin, rotateR, radius );\n		Cell cell_g = getReferenceCell( p, origin, rotateG, radius );\n		Cell cell_b = getReferenceCell( p, origin, rotateB, radius );\n		float r = getDotColour( cell_r, p, 0, rotateR, aa );\n		float g = getDotColour( cell_g, p, 1, rotateG, aa );\n		float b = getDotColour( cell_b, p, 2, rotateB, aa );\n		vec4 colour = texture2D( tDiffuse, vUV );\n		r = blendColour( r, colour.r, blending );\n		g = blendColour( g, colour.g, blending );\n		b = blendColour( b, colour.b, blending );\n		if ( greyscale ) {\n			r = g = b = (r + b + g) / 3.0;\n		}\n		gl_FragColor = vec4( r, g, b, 1.0 );\n	} else {\n		gl_FragColor = texture2D( tDiffuse, vUV );\n	}\n}"};var s7=Object.defineProperty,oe=(e,t,r)=>t in e?s7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ot=(e,t,r)=>(oe(e,"symbol"!=typeof t?t+"":t,r),r);class oi extends sZ.w{constructor(e,t,r){for(let n in super(),ot(this,"material"),ot(this,"fsQuad"),ot(this,"uniforms"),void 0===s9&&console.error("THREE.HalftonePass requires HalftoneShader"),this.uniforms=ee.rDY.clone(s9.uniforms),this.material=new ee.jyz({uniforms:this.uniforms,fragmentShader:s9.fragmentShader,vertexShader:s9.vertexShader}),this.uniforms.width.value=e,this.uniforms.height.value=t,r)r.hasOwnProperty(n)&&this.uniforms.hasOwnProperty(n)&&(this.uniforms[n].value=r[n]);this.fsQuad=new sZ.T(this.material)}render(e,t,r){this.material.uniforms.tDiffuse.value=r.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}setSize(e,t){this.uniforms.width.value=e,this.uniforms.height.value=t}}let or={defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new ee.FM8(1/1024,1/512)}},vertexShader:"uniform vec2 resolution;\nvarying vec2 vUv;\nvarying vec4 vOffset[ 3 ];\nvoid SMAAEdgeDetectionVS( vec2 texcoord ) {\n	vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );\n	vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );\n	vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );\n}\nvoid main() {\n	vUv = uv;\n	SMAAEdgeDetectionVS( vUv );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvarying vec4 vOffset[ 3 ];\nvec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n	vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );\n	vec4 delta;\n	vec3 C = texture2D( colorTex, texcoord ).rgb;\n	vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;\n	vec3 t = abs( C - Cleft );\n	delta.x = max( max( t.r, t.g ), t.b );\n	vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;\n	t = abs( C - Ctop );\n	delta.y = max( max( t.r, t.g ), t.b );\n	vec2 edges = step( threshold, delta.xy );\n	if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )\n		discard;\n	vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;\n	t = abs( C - Cright );\n	delta.z = max( max( t.r, t.g ), t.b );\n	vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;\n	t = abs( C - Cbottom );\n	delta.w = max( max( t.r, t.g ), t.b );\n	float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );\n	vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;\n	t = abs( C - Cleftleft );\n	delta.z = max( max( t.r, t.g ), t.b );\n	vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;\n	t = abs( C - Ctoptop );\n	delta.w = max( max( t.r, t.g ), t.b );\n	maxDelta = max( max( maxDelta, delta.z ), delta.w );\n	edges.xy *= step( 0.5 * maxDelta, delta.xy );\n	return vec4( edges, 0.0, 0.0 );\n}\nvoid main() {\n	gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );\n}"},on={defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new ee.FM8(1/1024,1/512)}},vertexShader:"uniform vec2 resolution;\nvarying vec2 vUv;\nvarying vec4 vOffset[ 3 ];\nvarying vec2 vPixcoord;\nvoid SMAABlendingWeightCalculationVS( vec2 texcoord ) {\n	vPixcoord = texcoord / resolution;\n	vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );\n	vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );\n	vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );\n}\nvoid main() {\n	vUv = uv;\n	SMAABlendingWeightCalculationVS( vUv );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )\nuniform sampler2D tDiffuse;\nuniform sampler2D tArea;\nuniform sampler2D tSearch;\nuniform vec2 resolution;\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixcoord;\n#if __VERSION__ == 100\nvec2 round( vec2 x ) {\n	return sign( x ) * floor( abs( x ) + 0.5 );\n}\n#endif\nfloat SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {\n	e.r = bias + e.r * scale;\n	return 255.0 * texture2D( searchTex, e, 0.0 ).r;\n}\nfloat SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n	vec2 e = vec2( 0.0, 1.0 );\n	for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {\n		e = texture2D( edgesTex, texcoord, 0.0 ).rg;\n		texcoord -= vec2( 2.0, 0.0 ) * resolution;\n		if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n	}\n	texcoord.x += 0.25 * resolution.x;\n	texcoord.x += resolution.x;\n	texcoord.x += 2.0 * resolution.x;\n	texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n	return texcoord.x;\n}\nfloat SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n	vec2 e = vec2( 0.0, 1.0 );\n	for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {\n		e = texture2D( edgesTex, texcoord, 0.0 ).rg;\n		texcoord += vec2( 2.0, 0.0 ) * resolution;\n		if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n	}\n	texcoord.x -= 0.25 * resolution.x;\n	texcoord.x -= resolution.x;\n	texcoord.x -= 2.0 * resolution.x;\n	texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n	return texcoord.x;\n}\nfloat SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n	vec2 e = vec2( 1.0, 0.0 );\n	for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {\n		e = texture2D( edgesTex, texcoord, 0.0 ).rg;\n		texcoord += vec2( 0.0, 2.0 ) * resolution;\n		if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n	}\n	texcoord.y -= 0.25 * resolution.y;\n	texcoord.y -= resolution.y;\n	texcoord.y -= 2.0 * resolution.y;\n	texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );\n	return texcoord.y;\n}\nfloat SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n	vec2 e = vec2( 1.0, 0.0 );\n	for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {\n		e = texture2D( edgesTex, texcoord, 0.0 ).rg;\n		texcoord -= vec2( 0.0, 2.0 ) * resolution;\n		if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n	}\n	texcoord.y += 0.25 * resolution.y;\n	texcoord.y += resolution.y;\n	texcoord.y += 2.0 * resolution.y;\n	texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );\n	return texcoord.y;\n}\nvec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {\n	vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;\n	texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );\n	texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n	return texture2D( areaTex, texcoord, 0.0 ).rg;\n}\nvec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {\n	vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );\n	vec2 e = texture2D( edgesTex, texcoord ).rg;\n	if ( e.g > 0.0 ) {\n		vec2 d;\n		vec2 coords;\n		coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );\n		coords.y = offset[ 1 ].y;\n		d.x = coords.x;\n		float e1 = texture2D( edgesTex, coords, 0.0 ).r;\n		coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );\n		d.y = coords.x;\n		d = d / resolution.x - pixcoord.x;\n		vec2 sqrt_d = sqrt( abs( d ) );\n		coords.y -= 1.0 * resolution.y;\n		float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;\n		weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );\n	}\n	if ( e.r > 0.0 ) {\n		vec2 d;\n		vec2 coords;\n		coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );\n		coords.x = offset[ 0 ].x;\n		d.x = coords.y;\n		float e1 = texture2D( edgesTex, coords, 0.0 ).g;\n		coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );\n		d.y = coords.y;\n		d = d / resolution.y - pixcoord.y;\n		vec2 sqrt_d = sqrt( abs( d ) );\n		coords.y -= 1.0 * resolution.y;\n		float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;\n		weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );\n	}\n	return weights;\n}\nvoid main() {\n	gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );\n}"},oa={uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new ee.FM8(1/1024,1/512)}},vertexShader:"uniform vec2 resolution;\nvarying vec2 vUv;\nvarying vec4 vOffset[ 2 ];\nvoid SMAANeighborhoodBlendingVS( vec2 texcoord ) {\n	vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );\n	vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );\n}\nvoid main() {\n	vUv = uv;\n	SMAANeighborhoodBlendingVS( vUv );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tColor;\nuniform vec2 resolution;\nvarying vec2 vUv;\nvarying vec4 vOffset[ 2 ];\nvec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {\n	vec4 a;\n	a.xz = texture2D( blendTex, texcoord ).xz;\n	a.y = texture2D( blendTex, offset[ 1 ].zw ).g;\n	a.w = texture2D( blendTex, offset[ 1 ].xy ).a;\n	if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {\n		return texture2D( colorTex, texcoord, 0.0 );\n	} else {\n		vec2 offset;\n		offset.x = a.a > a.b ? a.a : -a.b;\n		offset.y = a.g > a.r ? -a.g : a.r;\n		if ( abs( offset.x ) > abs( offset.y )) {\n			offset.y = 0.0;\n		} else {\n			offset.x = 0.0;\n		}\n		vec4 C = texture2D( colorTex, texcoord, 0.0 );\n		texcoord += sign( offset ) * resolution;\n		vec4 Cop = texture2D( colorTex, texcoord, 0.0 );\n		float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );\n		C.xyz = pow(C.xyz, vec3(2.2));\n		Cop.xyz = pow(Cop.xyz, vec3(2.2));\n		vec4 mixed = mix(C, Cop, s);\n		mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n		return mixed;\n	}\n}\nvoid main() {\n	gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );\n}"};class os extends sZ.w{constructor(e,t){super(),this.edgesRT=new ee.dd2(e,t,{depthBuffer:!1}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new ee.dd2(e,t,{depthBuffer:!1}),this.weightsRT.texture.name="SMAAPass.weights";let r=this,n=new Image;n.src=this.getAreaTexture(),n.onload=function(){r.areaTexture.needsUpdate=!0},this.areaTexture=new ee.xEZ,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=n,this.areaTexture.minFilter=ee.wem,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;let a=new Image;a.src=this.getSearchTexture(),a.onload=function(){r.searchTexture.needsUpdate=!0},this.searchTexture=new ee.xEZ,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=a,this.searchTexture.magFilter=ee.TyD,this.searchTexture.minFilter=ee.TyD,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,void 0===or&&console.error("THREE.SMAAPass relies on SMAAShader"),this.uniformsEdges=ee.rDY.clone(or.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new ee.jyz({defines:Object.assign({},or.defines),uniforms:this.uniformsEdges,vertexShader:or.vertexShader,fragmentShader:or.fragmentShader}),this.uniformsWeights=ee.rDY.clone(on.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new ee.jyz({defines:Object.assign({},on.defines),uniforms:this.uniformsWeights,vertexShader:on.vertexShader,fragmentShader:on.fragmentShader}),this.uniformsBlend=ee.rDY.clone(oa.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new ee.jyz({uniforms:this.uniformsBlend,vertexShader:oa.vertexShader,fragmentShader:oa.fragmentShader}),this.needsSwap=!1,this.fsQuad=new sZ.T(null)}render(e,t,r){this.uniformsEdges.tDiffuse.value=r.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=r.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}setSize(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)}getAreaTexture(){return"data:image/png;base64,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"}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}}var oo=r(55281),ol=r(46470),oh=Object.defineProperty,oc=(e,t,r)=>t in e?oh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ou=(e,t,r)=>(oc(e,"symbol"!=typeof t?t+"":t,r),r);class od extends sZ.w{constructor(e,t,r,n){super(),ou(this,"renderScene"),ou(this,"renderCamera"),ou(this,"selectedObjects"),ou(this,"visibleEdgeColor"),ou(this,"hiddenEdgeColor"),ou(this,"edgeGlow"),ou(this,"usePatternTexture"),ou(this,"edgeThickness"),ou(this,"edgeStrength"),ou(this,"downSampleRatio"),ou(this,"pulsePeriod"),ou(this,"resolution"),ou(this,"renderTargetMaskBuffer"),ou(this,"depthMaterial"),ou(this,"prepareMaskMaterial"),ou(this,"renderTargetDepthBuffer"),ou(this,"renderTargetMaskDownSampleBuffer"),ou(this,"renderTargetBlurBuffer1"),ou(this,"renderTargetBlurBuffer2"),ou(this,"edgeDetectionMaterial"),ou(this,"renderTargetEdgeBuffer1"),ou(this,"renderTargetEdgeBuffer2"),ou(this,"separableBlurMaterial1"),ou(this,"separableBlurMaterial2"),ou(this,"overlayMaterial"),ou(this,"materialCopy"),ou(this,"oldClearAlpha"),ou(this,"fsQuad"),ou(this,"tempPulseColor1"),ou(this,"tempPulseColor2"),ou(this,"textureMatrix"),ou(this,"patternTexture"),ou(this,"_visibilityCache"),ou(this,"_oldClearColor"),ou(this,"copyUniforms"),ou(this,"BlurDirectionX",new ee.FM8(1,0)),ou(this,"BlurDirectionY",new ee.FM8(0,1)),this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new ee.Ilk(1,1,1),this.hiddenEdgeColor=new ee.Ilk(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==e?new ee.FM8(e.x,e.y):new ee.FM8(256,256);let a=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new ee.dd2(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new ee.lRF,this.depthMaterial.side=ee.ehD,this.depthMaterial.depthPacking=ee.mSO,this.depthMaterial.blending=ee.jFi,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=ee.ehD,this.prepareMaskMaterial.fragmentShader=function(e,t){let r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new ee.dd2(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new ee.dd2(a,s),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new ee.dd2(a,s),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new ee.dd2(Math.round(a/2),Math.round(s/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new ee.dd2(a,s),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new ee.dd2(Math.round(a/2),Math.round(s/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,s),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===ol.C&&console.error("THREE.OutlinePass relies on CopyShader");let o=ol.C;this.copyUniforms=ee.rDY.clone(o.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ee.jyz({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:ee.jFi,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new ee.Ilk,this.oldClearAlpha=1,this.fsQuad=new sZ.T(this.materialCopy),this.tempPulseColor1=new ee.Ilk,this.tempPulseColor2=new ee.Ilk,this.textureMatrix=new ee.yGw}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value.set(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value.set(r,n)}changeVisibilityOfSelectedObjects(e){let t=this._visibilityCache;function r(r){r.isMesh&&(!0===e?r.visible=t.get(r):(t.set(r,r.visible),r.visible=e))}for(let e=0;e<this.selectedObjects.length;e++)this.selectedObjects[e].traverse(r)}changeVisibilityOfNonSelectedObjects(e){let t=this._visibilityCache,r=[];function n(e){e.isMesh&&r.push(e)}for(let e=0;e<this.selectedObjects.length;e++)this.selectedObjects[e].traverse(n);this.renderScene.traverse(function(n){if(n.isMesh||n.isSprite){let a=!1;for(let e=0;e<r.length;e++)if(r[e].id===n.id){a=!0;break}if(!1===a){let r=n.visible;(!1===e||!0===t.get(n))&&(n.visible=e),t.set(n,r)}}else(n.isPoints||n.isLine)&&(!0===e?n.visible=t.get(n):(t.set(n,n.visible),n.visible=e))})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,r,n,a){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let t=e.autoClear;e.autoClear=!1,a&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);let n=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=n,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){let e=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(e),this.tempPulseColor2.multiplyScalar(e)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=this.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=this.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=this.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=this.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=t}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new ee.jyz({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new ee.FM8(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>
				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;
				void main() {
					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>
					vPosition = mvPosition;
					vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
					projTexCoord = textureMatrix * worldPosition;
				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;
				void main() {
					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);
				}`})}getEdgeDetectionMaterial(){return new ee.jyz({uniforms:{maskTexture:{value:null},texSize:{value:new ee.FM8(.5,.5)},visibleEdgeColor:{value:new ee.Pa4(1,1,1)},hiddenEdgeColor:{value:new ee.Pa4(1,1,1)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;
				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new ee.jyz({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new ee.FM8(.5,.5)},direction:{value:new ee.FM8(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;
				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float weightSum = gaussianPdf(0.0, kernelRadius);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float w = gaussianPdf(uvOffset.x, kernelRadius);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new ee.jyz({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;
				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:ee.WMw,depthTest:!1,depthWrite:!1,transparent:!0})}}let om={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new ee.FM8},cameraProjectionMatrix:{value:new ee.yGw},cameraInverseProjectionMatrix:{value:new ee.yGw},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tDepth;\nuniform sampler2D tNoise;\nuniform vec3 kernel[ KERNEL_SIZE ];\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform mat4 cameraProjectionMatrix;\nuniform mat4 cameraInverseProjectionMatrix;\nuniform float kernelRadius;\nuniform float minDistance;\nuniform float maxDistance;\nvarying vec2 vUv;\n#include <packing>\nfloat getDepth( const in vec2 screenPosition ) {\n	return texture2D( tDepth, screenPosition ).x;\n}\nfloat getLinearDepth( const in vec2 screenPosition ) {\n	#if PERSPECTIVE_CAMERA == 1\n		float fragCoordZ = texture2D( tDepth, screenPosition ).x;\n		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n	#else\n		return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n		return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n	#else\n		return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n	#endif\n}\nvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n	clipPosition *= clipW; // unprojection.\n	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n}\nvec3 getViewNormal( const in vec2 screenPosition ) {\n	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n}\nvoid main() {\n	float depth = getDepth( vUv );\n	float viewZ = getViewZ( depth );\n	vec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n	vec3 viewNormal = getViewNormal( vUv );\n vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n	vec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;\n	vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n	vec3 bitangent = cross( viewNormal, tangent );\n	mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n float occlusion = 0.0;\n for ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n		vec3 sampleVector = kernelMatrix * kernel[ i ];\n		vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );\n		vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );\n		samplePointNDC /= samplePointNDC.w;\n		vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;\n		float realDepth = getLinearDepth( samplePointUv );\n		float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );\n		float delta = sampleDepth - realDepth;\n		if ( delta > minDistance && delta < maxDistance ) {\n			occlusion += 1.0;\n		}\n	}\n	occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n	gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n}"},op={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDepth;\nuniform float cameraNear;\nuniform float cameraFar;\nvarying vec2 vUv;\n#include <packing>\nfloat getLinearDepth( const in vec2 screenPosition ) {\n	#if PERSPECTIVE_CAMERA == 1\n		float fragCoordZ = texture2D( tDepth, screenPosition ).x;\n		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n	#else\n		return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nvoid main() {\n	float depth = getLinearDepth( vUv );\n	gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n}"},oA={uniforms:{tDiffuse:{value:null},resolution:{value:new ee.FM8}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\nvoid main() {\n	vec2 texelSize = ( 1.0 / resolution );\n	float result = 0.0;\n	for ( int i = - 2; i <= 2; i ++ ) {\n		for ( int j = - 2; j <= 2; j ++ ) {\n			vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n			result += texture2D( tDiffuse, vUv + offset ).r;\n		}\n	}\n	gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n}"};var of=Object.defineProperty;let og=class extends sZ.w{constructor(e,t,r,n){super(),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();let a=new ee.$YQ;a.format=ee.brP,a.type=ee.wJv,this.beautyRenderTarget=new ee.dd2(this.width,this.height),this.normalRenderTarget=new ee.dd2(this.width,this.height,{minFilter:ee.TyD,magFilter:ee.TyD,depthTexture:a}),this.ssaoRenderTarget=new ee.dd2(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===om&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new ee.jyz({defines:Object.assign({},om.defines),uniforms:ee.rDY.clone(om.uniforms),vertexShader:om.vertexShader,fragmentShader:om.fragmentShader,blending:ee.jFi}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ee.RSm,this.normalMaterial.blending=ee.jFi,this.blurMaterial=new ee.jyz({defines:Object.assign({},oA.defines),uniforms:ee.rDY.clone(oA.uniforms),vertexShader:oA.vertexShader,fragmentShader:oA.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ee.jyz({defines:Object.assign({},op.defines),uniforms:ee.rDY.clone(op.uniforms),vertexShader:op.vertexShader,fragmentShader:op.fragmentShader,blending:ee.jFi}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ee.jyz({uniforms:ee.rDY.clone(ol.C.uniforms),vertexShader:ol.C.vertexShader,fragmentShader:ol.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:ee.Vdb,blendDst:ee.c8b,blendEquation:ee.bGH,blendSrcAlpha:ee.fSK,blendDstAlpha:ee.c8b,blendEquationAlpha:ee.bGH}),this.fsQuad=new sZ.T(null),this.originalClearColor=new ee.Ilk}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(!1===e.capabilities.isWebGL2&&(this.noiseTexture.format=ee.Y8D),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case og.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case og.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case og.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case og.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case og.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case og.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=ee.Xaj,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(e,t,r,n,a){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderOverride(e,t,r,n,a){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,a=t.clearAlpha||a,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}setSize(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(){let e=this.kernelSize,t=this.kernel;for(let r=0;r<e;r++){let n=new ee.Pa4;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();let a=r/e;a=ee.M8C.lerp(.1,1,a*a),n.multiplyScalar(a),t.push(n)}}generateRandomKernelRotations(){void 0===nN&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");let e=new nN,t=new Float32Array(16);for(let r=0;r<16;r++){let n=2*Math.random()-1,a=2*Math.random()-1;t[r]=e.noise3d(n,a,0)}this.noiseTexture=new ee.IEO(t,4,4,ee.hEm,ee.VzW),this.noiseTexture.wrapS=ee.rpg,this.noiseTexture.wrapT=ee.rpg,this.noiseTexture.needsUpdate=!0}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse(function(e){let r=t.get(e);e.visible=r}),t.clear()}},ov=og;_={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5},(P="symbol"!=typeof(V="OUTPUT")?V+"":V)in ov?of(ov,P,{enumerable:!0,configurable:!0,writable:!0,value:_}):ov[P]=_;class oy extends sZ.w{constructor(e){super(),void 0===ol.C&&console.error("THREE.SavePass relies on CopyShader");let t=ol.C;this.textureID="tDiffuse",this.uniforms=ee.rDY.clone(t.uniforms),this.material=new ee.jyz({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:ee.jFi}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new ee.dd2(window.innerWidth,window.innerHeight),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new sZ.T(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),this.fsQuad.render(e)}}var ox=r(33748);class ob extends sZ.w{constructor(e,t){super();let r=ol.C;this.map=e,this.opacity=void 0!==t?t:1,this.uniforms=ee.rDY.clone(r.uniforms),this.material=new ee.jyz({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0}),this.needsSwap=!1,this.fsQuad=new sZ.T(null)}render(e,t,r){let n=e.autoClear;e.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(),this.fsQuad.render(e),e.autoClear=n}dispose(){this.material.dispose(),this.fsQuad.dispose()}}let ow={uniforms:{tDiffuse:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	float l = linearToRelativeLuminance( texel.rgb );\n	gl_FragColor = vec4( l, l, l, texel.w );\n}"},oC={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nuniform float middleGrey;\nuniform float minLuminance;\nuniform float maxLuminance;\n#ifdef ADAPTED_LUMINANCE\n	uniform sampler2D luminanceMap;\n#else\n	uniform float averageLuminance;\n#endif\nvec3 ToneMap( vec3 vColor ) {\n	#ifdef ADAPTED_LUMINANCE\n		float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;\n	#else\n		float fLumAvg = averageLuminance;\n	#endif\n	float fLumPixel = linearToRelativeLuminance( vColor );\n	float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );\n	float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);\n	return fLumCompressed * vColor;\n}\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );\n}"};class oE extends sZ.w{constructor(e,t){super(),this.resolution=void 0!==t?t:256,this.needsInit=!0,this.adaptive=void 0===e||!!e,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null;let r=ol.C;this.copyUniforms=ee.rDY.clone(r.uniforms),this.materialCopy=new ee.jyz({uniforms:this.copyUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,blending:ee.jFi,depthTest:!1}),this.materialLuminance=new ee.jyz({uniforms:ee.rDY.clone(ow.uniforms),vertexShader:ow.vertexShader,fragmentShader:ow.fragmentShader,blending:ee.jFi}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D lastLum;
				uniform sampler2D currentLum;
				uniform float minLuminance;
				uniform float delta;
				uniform float tau;

				void main() {

					vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );
					vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );

					float fLastLum = max( minLuminance, lastLum.r );
					float fCurrentLum = max( minLuminance, currentLum.r );

					//The adaption seems to work better in extreme lighting differences
					//if the input luminance is squared.
					fCurrentLum *= fCurrentLum;

					// Adapt the luminance using Pattanaik's technique
					float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));
					// "fAdaptedLum = sqrt(fAdaptedLum);
					gl_FragColor.r = fAdaptedLum;
				}`},this.materialAdaptiveLum=new ee.jyz({uniforms:ee.rDY.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:ee.jFi}),this.materialToneMap=new ee.jyz({uniforms:ee.rDY.clone(oC.uniforms),vertexShader:oC.vertexShader,fragmentShader:oC.fragmentShader,blending:ee.jFi}),this.fsQuad=new sZ.T(null)}render(e,t,r,n){this.needsInit&&(this.reset(e),this.luminanceRT.texture.type=r.texture.type,this.previousLuminanceRT.texture.type=r.texture.type,this.currentLuminanceRT.texture.type=r.texture.type,this.needsInit=!1),this.adaptive&&(this.fsQuad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=r.texture,e.setRenderTarget(this.currentLuminanceRT),this.fsQuad.render(e),this.fsQuad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=n,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,e.setRenderTarget(this.luminanceRT),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,e.setRenderTarget(this.previousLuminanceRT),this.fsQuad.render(e)),this.fsQuad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=r.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}reset(){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.luminanceRT=new ee.dd2(this.resolution,this.resolution),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new ee.dd2(this.resolution,this.resolution),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1;let e={minFilter:ee.D1R,generateMipmaps:!0};this.currentLuminanceRT=new ee.dd2(this.resolution,this.resolution,e),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.fsQuad.material=new ee.vBJ({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0}setAdaptive(e){e?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0}setAdaptionRate(e){e&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(e))}setMinLuminance(e){e&&(this.materialToneMap.uniforms.minLuminance.value=e,this.materialAdaptiveLum.uniforms.minLuminance.value=e)}setMaxLuminance(e){e&&(this.materialToneMap.uniforms.maxLuminance.value=e)}setAverageLuminance(e){e&&(this.materialToneMap.uniforms.averageLuminance.value=e)}setMiddleGrey(e){e&&(this.materialToneMap.uniforms.middleGrey.value=e)}dispose(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}}var oI=r(83542);class oM extends sZ.w{constructor(e,t,r=1){super(),this.camera=e,this.needsSwap=!1,this.cubeShader=ee.Vj0.cube,this.cubeMesh=new ee.Kj0(new ee.DvJ(10,10,10),new ee.jyz({uniforms:ee.rDY.clone(this.cubeShader.uniforms),vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:ee._Li})),Object.defineProperty(this.cubeMesh.material,"envMap",{get:function(){return this.uniforms.tCube.value}}),this.tCube=t,this.opacity=r,this.cubeScene=new ee.xsS,this.cubeCamera=new ee.cPb,this.cubeScene.add(this.cubeMesh)}render(e,t,r){let n=e.autoClear;e.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.tCube,this.cubeMesh.material.uniforms.tFlip.value=this.tCube.isCubeTexture&&!1===this.tCube.isRenderTargetTexture?-1:1,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(),e.render(this.cubeScene,this.cubeCamera),e.autoClear=n}dispose(){this.cubeMesh.geometry.dispose(),this.cubeMesh.material.dispose()}}let oB={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new ee.FM8(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new ee.yGw},cameraInverseProjectionMatrix:{value:new ee.yGw},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nvarying vec2 vUv;\n#if DIFFUSE_TEXTURE == 1\nuniform sampler2D tDiffuse;\n#endif\nuniform sampler2D tDepth;\n#if NORMAL_TEXTURE == 1\nuniform sampler2D tNormal;\n#endif\nuniform float cameraNear;\nuniform float cameraFar;\nuniform mat4 cameraProjectionMatrix;\nuniform mat4 cameraInverseProjectionMatrix;\nuniform float scale;\nuniform float intensity;\nuniform float bias;\nuniform float kernelRadius;\nuniform float minResolution;\nuniform vec2 size;\nuniform float randomSeed;\n// RGBA depth\n#include <packing>\nvec4 getDefaultColor( const in vec2 screenPosition ) {\n	#if DIFFUSE_TEXTURE == 1\n	return texture2D( tDiffuse, vUv );\n	#else\n	return vec4( 1.0 );\n	#endif\n}\nfloat getDepth( const in vec2 screenPosition ) {\n	#if DEPTH_PACKING == 1\n	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n	#else\n	return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n	#else\n	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n	#endif\n}\nvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n	clipPosition *= clipW; // unprojection.\n	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n}\nvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n	#if NORMAL_TEXTURE == 1\n	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n	#else\n	return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n	#endif\n}\nfloat scaleDividedByCameraFar;\nfloat minResolutionMultipliedByCameraFar;\nfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n	vec3 viewDelta = sampleViewPosition - centerViewPosition;\n	float viewDistance = length( viewDelta );\n	float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n	return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n}\n// moving costly divides into consts\nconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\nconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\nfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n	// precompute some variables require in getOcclusion.\n	scaleDividedByCameraFar = scale / cameraFar;\n	minResolutionMultipliedByCameraFar = minResolution * cameraFar;\n	vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n	// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n	float angle = rand( vUv + randomSeed ) * PI2;\n	vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n	vec2 radiusStep = radius;\n	float occlusionSum = 0.0;\n	float weightSum = 0.0;\n	for( int i = 0; i < NUM_SAMPLES; i ++ ) {\n		vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n		radius += radiusStep;\n		angle += ANGLE_STEP;\n		float sampleDepth = getDepth( sampleUv );\n		if( sampleDepth >= ( 1.0 - EPSILON ) ) {\n			continue;\n		}\n		float sampleViewZ = getViewZ( sampleDepth );\n		vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n		occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n		weightSum += 1.0;\n	}\n	if( weightSum == 0.0 ) discard;\n	return occlusionSum * ( intensity / weightSum );\n}\nvoid main() {\n	float centerDepth = getDepth( vUv );\n	if( centerDepth >= ( 1.0 - EPSILON ) ) {\n		discard;\n	}\n	float centerViewZ = getViewZ( centerDepth );\n	vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n	float ambientOcclusion = getAmbientOcclusion( viewPosition );\n	gl_FragColor = getDefaultColor( vUv );\n	gl_FragColor.xyz *=  1.0 - ambientOcclusion;\n}"},oS={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new ee.FM8(512,512)},sampleUvOffsets:{value:[new ee.FM8(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"#include <common>\nuniform vec2 size;\nvarying vec2 vUv;\nvarying vec2 vInvSize;\nvoid main() {\n	vUv = uv;\n	vInvSize = 1.0 / size;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\n#include <packing>\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float depthCutoff;\nuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\nuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\nvarying vec2 vUv;\nvarying vec2 vInvSize;\nfloat getDepth( const in vec2 screenPosition ) {\n	#if DEPTH_PACKING == 1\n	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n	#else\n	return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n	#else\n	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n	#endif\n}\nvoid main() {\n	float depth = getDepth( vUv );\n	if( depth >= ( 1.0 - EPSILON ) ) {\n		discard;\n	}\n	float centerViewZ = -getViewZ( depth );\n	bool rBreak = false, lBreak = false;\n	float weightSum = sampleWeights[0];\n	vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n	for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n		float sampleWeight = sampleWeights[i];\n		vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n		vec2 sampleUv = vUv + sampleUvOffset;\n		float viewZ = -getViewZ( getDepth( sampleUv ) );\n		if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n		if( ! rBreak ) {\n			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n			weightSum += sampleWeight;\n		}\n		sampleUv = vUv - sampleUvOffset;\n		viewZ = -getViewZ( getDepth( sampleUv ) );\n		if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n		if( ! lBreak ) {\n			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n			weightSum += sampleWeight;\n		}\n	}\n	gl_FragColor = diffuseSum / weightSum;\n}"},oT={createSampleWeights:(e,t)=>{let r=(e,t)=>Math.exp(-(e*e)/(t*t*2))/(Math.sqrt(2*Math.PI)*t),n=[];for(let a=0;a<=e;a++)n.push(r(a,t));return n},createSampleOffsets:(e,t)=>{let r=[];for(let n=0;n<=e;n++)r.push(t.clone().multiplyScalar(n));return r},configure:(e,t,r,n)=>{e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=oT.createSampleOffsets(t,n),e.uniforms.sampleWeights.value=oT.createSampleWeights(t,r),e.needsUpdate=!0}};var oF=Object.defineProperty;class oP extends sZ.w{constructor(e,t,r=!1,n=!1,a=new ee.FM8(256,256)){let s;super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=r,this.supportsNormalTexture=n,this.originalClearColor=new ee.Ilk,this._oldClearColor=new ee.Ilk,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new ee.FM8(a.x,a.y),this.saoRenderTarget=new ee.dd2(this.resolution.x,this.resolution.y,{type:ee.cLu}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new ee.dd2(this.resolution.x,this.resolution.y,{minFilter:ee.TyD,magFilter:ee.TyD,type:ee.cLu}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension&&((s=new ee.$YQ).type=ee.LsT,this.beautyRenderTarget.depthTexture=s,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new ee.lRF,this.depthMaterial.depthPacking=ee.mSO,this.depthMaterial.blending=ee.jFi,this.normalMaterial=new ee.RSm,this.normalMaterial.blending=ee.jFi,this.saoMaterial=new ee.jyz({defines:Object.assign({},oB.defines),fragmentShader:oB.fragmentShader,vertexShader:oB.vertexShader,uniforms:ee.rDY.clone(oB.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?s:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=ee.jFi,this.vBlurMaterial=new ee.jyz({uniforms:ee.rDY.clone(oS.uniforms),defines:Object.assign({},oS.defines),vertexShader:oS.vertexShader,fragmentShader:oS.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?s:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=ee.jFi,this.hBlurMaterial=new ee.jyz({uniforms:ee.rDY.clone(oS.uniforms),defines:Object.assign({},oS.defines),vertexShader:oS.vertexShader,fragmentShader:oS.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?s:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=ee.jFi,this.materialCopy=new ee.jyz({uniforms:ee.rDY.clone(ol.C.uniforms),vertexShader:ol.C.vertexShader,fragmentShader:ol.C.fragmentShader,blending:ee.jFi}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=ee.Xaj,this.materialCopy.blendSrc=ee.Vdb,this.materialCopy.blendDst=ee.c8b,this.materialCopy.blendEquation=ee.bGH,this.materialCopy.blendSrcAlpha=ee.fSK,this.materialCopy.blendDstAlpha=ee.c8b,this.materialCopy.blendEquationAlpha=ee.bGH,this.depthCopy=new ee.jyz({uniforms:ee.rDY.clone(au.uniforms),vertexShader:au.vertexShader,fragmentShader:au.fragmentShader,blending:ee.jFi}),this.fsQuad=new sZ.T(null)}render(e,t,r){if(this.renderToScreen&&(this.materialCopy.blending=ee.jFi,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1===this.params.output)return;e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let n=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;let a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(oT.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new ee.FM8(0,1)),oT.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new ee.FM8(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let s=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,s=this.depthCopy):(4===this.params.output?this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture:this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?s.blending=ee.Xaj:s.blending=ee.jFi,this.renderPass(e,s,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}renderPass(e,t,r,n,a){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderOverride(e,t,r,n,a){e.getClearColor(this.originalClearColor);let s=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,a=t.clearAlpha||a,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}setSize(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.depthRenderTarget.dispose(),this.depthMaterial.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.depthCopy.dispose(),this.fsQuad.dispose()}}R={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},(D="symbol"!=typeof(j="OUTPUT")?j+"":j)in oP?oF(oP,D,{enumerable:!0,configurable:!0,writable:!0,value:R}):oP[D]=R;let o_={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float damp;\nuniform sampler2D tOld;\nuniform sampler2D tNew;\nvarying vec2 vUv;\nvec4 when_gt( vec4 x, float y ) {\n	return max( sign( x - y ), 0.0 );\n}\nvoid main() {\n	vec4 texelOld = texture2D( tOld, vUv );\n	vec4 texelNew = texture2D( tNew, vUv );\n	texelOld *= damp * when_gt( texelOld, 0.1 );\n	gl_FragColor = max(texelNew, texelOld);\n}"};var oD=Object.defineProperty,oR=(e,t,r)=>t in e?oD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oL=(e,t,r)=>(oR(e,"symbol"!=typeof t?t+"":t,r),r);class oN extends sZ.w{constructor(e=.96,t=o_){super(),oL(this,"shader"),oL(this,"uniforms"),oL(this,"textureComp"),oL(this,"textureOld"),oL(this,"shaderMaterial"),oL(this,"compFsQuad"),oL(this,"copyFsQuad"),this.shader=t,this.uniforms=ee.rDY.clone(t.uniforms),this.uniforms.damp.value=e,this.textureComp=new ee.dd2(window.innerWidth,window.innerHeight,{minFilter:ee.wem,magFilter:ee.TyD,format:ee.wk1}),this.textureOld=new ee.dd2(window.innerWidth,window.innerHeight,{minFilter:ee.wem,magFilter:ee.TyD,format:ee.wk1}),this.shaderMaterial=new ee.jyz({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new sZ.T(this.shaderMaterial);let r=new ee.vBJ;this.copyFsQuad=new sZ.T(r)}render(e,t,r){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=r.texture,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureComp.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.copyFsQuad.render(e);let n=this.textureOld;this.textureOld=this.textureComp,this.textureComp=n}setSize(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}}var ok=r(92607),oU=r(86);let oQ={uniforms:{tDiffuse:{value:null},tSize:{value:new ee.FM8(256,256)},center:{value:new ee.FM8(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\n	float s = sin( angle ), c = cos( angle );\n	vec2 tex = vUv * tSize - center;\n	vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n	return ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\n	vec4 color = texture2D( tDiffuse, vUv );\n	float average = ( color.r + color.g + color.b ) / 3.0;\n	gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"};var oO=Object.defineProperty,oG=(e,t,r)=>t in e?oO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oH=(e,t,r)=>(oG(e,"symbol"!=typeof t?t+"":t,r),r);class oz extends sZ.w{constructor(e,t,r){super(),oH(this,"material"),oH(this,"fsQuad"),oH(this,"uniforms"),void 0===oQ&&console.error("THREE.DotScreenPass relies on THREE.DotScreenShader"),this.uniforms=ee.rDY.clone(oQ.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==r&&(this.uniforms.scale.value=r),this.material=new ee.jyz({uniforms:this.uniforms,vertexShader:oQ.vertexShader,fragmentShader:oQ.fragmentShader}),this.fsQuad=new sZ.T(this.material)}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.tSize.value.set(r.width,r.height),this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}}let oV={defines:{MAX_STEP:0,isPerspectiveCamera:!0,isDistanceAttenuation:!0,isFresnel:!0,isInfiniteThick:!1,isSelective:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new ee.FM8},cameraProjectionMatrix:{value:new ee.yGw},cameraInverseProjectionMatrix:{value:new ee.yGw},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},surfDist:{value:.007},thickTolerance:{value:.03}},vertexShader:`

    varying vec2 vUv;

    void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float surfDist;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		uniform float thickTolerance;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef isPerspectiveCamera
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef isSelective
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef isPerspectiveCamera
				vec3 viewIncidenceDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#else
				vec3 viewIncidenceDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidenceDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef isPerspectiveCamera
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<MAX_STEP;i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef isPerspectiveCamera
					// https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
					float sD=surfDist*cW;
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
					float sD=surfDist;
				#endif
				if(viewReflectRayZ-sD>vZ) continue;

				#ifdef isInfiniteThick
					if(viewReflectRayZ+thickTolerance*clipW<vP.z) break;
				#endif
				float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

				float op=opacity;

				if(away<sD){
					vec3 vN=getViewNormal( uv );
					if(dot(viewReflectDir,vN)>=0.) continue;
					float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
					if(distance>maxDistance) break;
					#ifdef isDistanceAttenuation
						float ratio=1.-(distance/maxDistance);
						float attenuation=ratio*ratio;
						op=opacity*attenuation;
					#endif
					#ifdef isFresnel
						float fresnel=(dot(viewIncidenceDir,viewReflectDir)+1.)/2.;
						op*=fresnel;
					#endif
					vec4 reflectColor=texture2D(tDiffuse,uv);
					gl_FragColor.xyz=reflectColor.xyz;
					gl_FragColor.a=op;
					break;
				}
			}
		}
	`},oj={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDepth;

    uniform float cameraNear;
    uniform float cameraFar;

    varying vec2 vUv;

    #include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

    void main() {

    	float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
    	gl_FragColor = vec4( vec3( d ), 1.0 );

    }

  `},oW={uniforms:{tDiffuse:{value:null},resolution:{value:new ee.FM8},opacity:{value:.5}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    varying vec2 vUv;
    void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

    	vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`};var oX=Object.defineProperty;let oY=class extends sZ.w{constructor({renderer:e,scene:t,camera:r,width:n,height:a,selects:s,bouncing:o=!1,groundReflector:l}){super(),this.width=void 0!==n?n:512,this.height=void 0!==a?a:512,this.clear=!0,this.renderer=e,this.scene=t,this.camera=r,this.groundReflector=l,this.opacity=oV.uniforms.opacity.value,this.output=0,this.maxDistance=oV.uniforms.maxDistance.value,this.thickness=oV.uniforms.thickness.value,this.tempColor=new ee.Ilk,this._selects=s,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(e){this._selects!==e&&(this._selects=e,Array.isArray(e)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1),this.ssrMaterial.needsUpdate=!0)}}),this._bouncing=o,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(e){this._bouncing!==e&&(this._bouncing=e,e?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=oV.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(e){this._distanceAttenuation!==e&&(this._distanceAttenuation=e,this.ssrMaterial.defines.DISTANCE_ATTENUATION=e,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=oV.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(e){this._fresnel!==e&&(this._fresnel=e,this.ssrMaterial.defines.FRESNEL=e,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=oV.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(e){this._infiniteThick!==e&&(this._infiniteThick=e,this.ssrMaterial.defines.INFINITE_THICK=e,this.ssrMaterial.needsUpdate=!0)}});let h=new ee.$YQ;h.type=ee.LsT,h.minFilter=ee.TyD,h.magFilter=ee.TyD,this.beautyRenderTarget=new ee.dd2(this.width,this.height,{minFilter:ee.TyD,magFilter:ee.TyD,type:ee.cLu,depthTexture:h,depthBuffer:!0}),this.prevRenderTarget=new ee.dd2(this.width,this.height,{minFilter:ee.TyD,magFilter:ee.TyD}),this.normalRenderTarget=new ee.dd2(this.width,this.height,{minFilter:ee.TyD,magFilter:ee.TyD,type:ee.cLu}),this.metalnessRenderTarget=new ee.dd2(this.width,this.height,{minFilter:ee.TyD,magFilter:ee.TyD,type:ee.cLu}),this.ssrRenderTarget=new ee.dd2(this.width,this.height,{minFilter:ee.TyD,magFilter:ee.TyD}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new ee.jyz({defines:Object.assign({},oV.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:ee.rDY.clone(oV.uniforms),vertexShader:oV.vertexShader,fragmentShader:oV.fragmentShader,blending:ee.jFi}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ee.RSm,this.normalMaterial.blending=ee.jFi,this.metalnessOnMaterial=new ee.vBJ({color:"white"}),this.metalnessOffMaterial=new ee.vBJ({color:"black"}),this.blurMaterial=new ee.jyz({defines:Object.assign({},oW.defines),uniforms:ee.rDY.clone(oW.uniforms),vertexShader:oW.vertexShader,fragmentShader:oW.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new ee.jyz({defines:Object.assign({},oW.defines),uniforms:ee.rDY.clone(oW.uniforms),vertexShader:oW.vertexShader,fragmentShader:oW.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ee.jyz({defines:Object.assign({},oj.defines),uniforms:ee.rDY.clone(oj.uniforms),vertexShader:oj.vertexShader,fragmentShader:oj.fragmentShader,blending:ee.jFi}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ee.jyz({uniforms:ee.rDY.clone(ol.C.uniforms),vertexShader:ol.C.vertexShader,fragmentShader:ol.C.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:ee.k74,blendDst:ee.LgZ,blendEquation:ee.bGH,blendSrcAlpha:ee.k74,blendDstAlpha:ee.LgZ,blendEquationAlpha:ee.bGH}),this.fsQuad=new sZ.T(null),this.originalClearColor=new ee.Ilk}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),e.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(e,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(e,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.renderPass(e,this.blurMaterial2,this.blurRenderTarget2)),this.output){case oY.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=ee.bdR,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=ee.jFi):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=ee.bdR),this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case oY.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=ee.bdR,this.renderPass(e,this.copyMaterial,this.prevRenderTarget));break;case oY.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case oY.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case oY.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case oY.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=ee.jFi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(e,t,r,n,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));let s=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderOverride(e,t,r,n,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));let s=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,a=t.clearAlpha||a,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}renderMetalness(e,t,r,n,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));let s=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,a=t.clearAlpha||a,null!=n&&(e.setClearColor(n),e.setClearAlpha(a||0),e.clear()),this.scene.traverseVisible(e=>{e._SSRPassBackupMaterial=e.material,this._selects.includes(e)?e.material=this.metalnessOnMaterial:e.material=this.metalnessOffMaterial}),e.render(this.scene,this.camera),this.scene.traverseVisible(e=>{e.material=e._SSRPassBackupMaterial}),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(s)}setSize(e,t){this.width=e,this.height=t,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(e*e+t*t),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(e,t),this.prevRenderTarget.setSize(e,t),this.ssrRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.metalnessRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.blurRenderTarget2.setSize(e,t),this.ssrMaterial.uniforms.resolution.value.set(e,t),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t),this.blurMaterial2.uniforms.resolution.value.set(e,t)}},oK=oY;N={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7},(L="symbol"!=typeof(W="OUTPUT")?W+"":W)in oK?oX(oK,L,{enumerable:!0,configurable:!0,writable:!0,value:N}):oK[L]=N;class oJ extends sZ.w{constructor(e,t,r,n){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,this._oldClearColor=new ee.Ilk;let a=ol.C;this.copyUniforms=ee.rDY.clone(a.uniforms),this.copyMaterial=new ee.jyz({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0,blending:ee.WMw}),this.fsQuad=new sZ.T(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null),this.copyMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)}render(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new ee.dd2(r.width,r.height,{type:ee.cLu}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");let n=oq[Math.max(0,Math.min(this.sampleLevel,5))],a=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);let s=e.getClearAlpha(),o=1/n.length,l=1/32;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;let h={fullWidth:r.width,fullHeight:r.height,offsetX:0,offsetY:0,width:r.width,height:r.height},c=Object.assign({},this.camera.view);c.enabled&&Object.assign(h,c);for(let r=0;r<n.length;r++){let a=n[r];this.camera.setViewOffset&&this.camera.setViewOffset(h.fullWidth,h.fullHeight,h.offsetX+.0625*a[0],h.offsetY+.0625*a[1],h.width,h.height);let s=o;this.unbiased&&(s+=l*(-.5+(r+.5)/n.length)),this.copyUniforms.opacity.value=s,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===r&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.setViewOffset&&c.enabled?this.camera.setViewOffset(c.fullWidth,c.fullHeight,c.offsetX,c.offsetY,c.width,c.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=a,e.setClearColor(this._oldClearColor,s)}}let oq=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class oZ extends oJ{constructor(e,t,r,n){super(e,t,r,n),this.sampleLevel=0,this.accumulate=!1,this.accumulateIndex=-1}render(e,t,r,n){if(!1===this.accumulate){super.render(e,t,r,n),this.accumulateIndex=-1;return}let a=o$[5];void 0===this.sampleRenderTarget&&(this.sampleRenderTarget=new ee.dd2(r.width,r.height,{type:ee.cLu}),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),void 0===this.holdRenderTarget&&(this.holdRenderTarget=new ee.dd2(r.width,r.height,{type:ee.cLu}),this.holdRenderTarget.texture.name="TAARenderPass.hold"),-1===this.accumulateIndex&&(super.render(e,this.holdRenderTarget,r,n),this.accumulateIndex=0);let s=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);let o=e.getClearAlpha(),l=1/a.length;if(this.accumulateIndex>=0&&this.accumulateIndex<a.length){this.copyUniforms.opacity.value=l,this.copyUniforms.tDiffuse.value=t.texture;let n=Math.pow(2,this.sampleLevel);for(let s=0;s<n;s++){let n=a[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*n[0],.0625*n[1],r.width,r.height),e.setRenderTarget(t),e.setClearColor(this.clearColor,this.clearAlpha),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e),this.accumulateIndex++,this.accumulateIndex>=a.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}e.setClearColor(this.clearColor,this.clearAlpha);let h=this.accumulateIndex*l;h>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),h<1&&(this.copyUniforms.opacity.value=1-h,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),this.fsQuad.render(e)),e.autoClear=s,e.setClearColor(this._oldClearColor,o)}dispose(){super.dispose(),void 0!==this.sampleRenderTarget&&this.sampleRenderTarget.dispose(),void 0!==this.holdRenderTarget&&this.holdRenderTarget.dispose()}}let o$=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var o0=r(55754);class o1 extends sZ.w{constructor(e,t,r,n,a={}){var s,o;super(),this.pixelSize=t,this.resolution=new ee.FM8,this.renderResolution=new ee.FM8,this.setSize(e.x,e.y),this.fsQuad=new sZ.T(this.material()),this.scene=r,this.camera=n,this.normalEdgeStrength=null!=(s=a.normalEdgeStrength)?s:.3,this.depthEdgeStrength=null!=(o=a.depthEdgeStrength)?o:.4,this.rgbRenderTarget=o2(this.renderResolution,ee.wk1,!0),this.normalRenderTarget=o2(this.renderResolution,ee.wk1,!1),this.normalMaterial=new ee.RSm}dispose(){this.rgbRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.fsQuad.dispose()}setSize(e,t){var r,n,a;this.resolution.set(e,t),this.renderResolution.set(e/this.pixelSize|0,t/this.pixelSize|0);let{x:s,y:o}=this.renderResolution;null==(r=this.rgbRenderTarget)||r.setSize(s,o),null==(n=this.normalRenderTarget)||n.setSize(s,o),null==(a=this.fsQuad)||a.material.uniforms.resolution.value.set(s,o,1/s,1/o)}setPixelSize(e){this.pixelSize=e,this.setSize(this.resolution.x,this.resolution.y)}render(e,t){let r=this.fsQuad.material.uniforms;r.normalEdgeStrength.value=this.normalEdgeStrength,r.depthEdgeStrength.value=this.depthEdgeStrength,e.setRenderTarget(this.rgbRenderTarget),e.render(this.scene,this.camera);let n=this.scene.overrideMaterial;e.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,e.render(this.scene,this.camera),this.scene.overrideMaterial=n,r.tDiffuse.value=this.rgbRenderTarget.texture,r.tDepth.value=this.rgbRenderTarget.depthTexture,r.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}material(){return new ee.jyz({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new ee.Ltg(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:`
				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}
				`,fragmentShader:`
				uniform sampler2D tDiffuse;
				uniform sampler2D tDepth;
				uniform sampler2D tNormal;
				uniform vec4 resolution;
				uniform float normalEdgeStrength;
				uniform float depthEdgeStrength;
				varying vec2 vUv;

				float getDepth(int x, int y) {

					return texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;

				}

				vec3 getNormal(int x, int y) {

					return texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;

				}

				float depthEdgeIndicator(float depth, vec3 normal) {

					float diff = 0.0;
					diff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);
					return floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;

				}

				float neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {

					float depthDiff = getDepth(x, y) - depth;
					vec3 neighborNormal = getNormal(x, y);
					
					// Edge pixels should yield to faces who's normals are closer to the bias normal.
					vec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.
					float normalDiff = dot(normal - neighborNormal, normalEdgeBias);
					float normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);
					
					// Only the shallower pixel should detect the normal edge.
					float depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);

					return (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;

				}

				float normalEdgeIndicator(float depth, vec3 normal) {
					
					float indicator = 0.0;

					indicator += neighborNormalEdgeIndicator(0, -1, depth, normal);
					indicator += neighborNormalEdgeIndicator(0, 1, depth, normal);
					indicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);
					indicator += neighborNormalEdgeIndicator(1, 0, depth, normal);

					return step(0.1, indicator);

				}

				void main() {

					vec4 texel = texture2D( tDiffuse, vUv );

					float depth = 0.0;
					vec3 normal = vec3(0.0);

					if (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {

						depth = getDepth(0, 0);
						normal = getNormal(0, 0);

					}

					float dei = 0.0;
					if (depthEdgeStrength > 0.0) 
						dei = depthEdgeIndicator(depth, normal);

					float nei = 0.0; 
					if (normalEdgeStrength > 0.0) 
						nei = normalEdgeIndicator(depth, normal);

					float Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);

					gl_FragColor = texel * Strength;

				}
				`})}}function o2(e,t,r){let n=new ee.dd2(e.x,e.y,r?{depthTexture:new ee.$YQ(e.x,e.y),depthBuffer:!0}:void 0);return n.texture.format=t,n.texture.minFilter=ee.TyD,n.texture.magFilter=ee.TyD,n.texture.generateMipmaps=!1,n.stencilBuffer=!1,n}let o3={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new ee.FM8(.001953125,0)},cKernel:{value:[]}},vertexShader:"uniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n	vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float cKernel[ KERNEL_SIZE_INT ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n	vec2 imageCoord = vUv;\n	vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\n	for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n		sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n		imageCoord += uImageIncrement;\n	}\n	gl_FragColor = sum;\n}",buildKernel:function(e){let t=Math.min(2*Math.ceil(3*e)+1,25),r=(t-1)*.5,n=Array(t),a=0;for(let o=0;o<t;++o){var s;n[o]=Math.exp(-((s=o-r)*s)/(2*e*e)),a+=n[o]}for(let e=0;e<t;++e)n[e]/=a;return n}};var o4=Object.defineProperty,o5=(e,t,r)=>t in e?o4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o8=(e,t,r)=>(o5(e,"symbol"!=typeof t?t+"":t,r),r);class o6 extends sZ.w{constructor(e=1,t=25,r=4,n=256){super(),o8(this,"renderTargetX"),o8(this,"renderTargetY"),o8(this,"materialCombine"),o8(this,"materialConvolution"),o8(this,"fsQuad"),o8(this,"combineUniforms"),o8(this,"convolutionUniforms"),o8(this,"blurX",new ee.FM8(.001953125,0)),o8(this,"blurY",new ee.FM8(0,.001953125)),this.renderTargetX=new ee.dd2(n,n),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new ee.dd2(n,n),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=ee.rDY.clone(o9.uniforms),this.combineUniforms.strength.value=e,this.materialCombine=new ee.jyz({uniforms:this.combineUniforms,vertexShader:o9.vertexShader,fragmentShader:o9.fragmentShader,blending:ee.WMw,transparent:!0}),void 0===o3&&console.error("BloomPass relies on ConvolutionShader"),this.convolutionUniforms=ee.rDY.clone(o3.uniforms),this.convolutionUniforms.uImageIncrement.value=this.blurX,this.convolutionUniforms.cKernel.value=o3.buildKernel(r),this.materialConvolution=new ee.jyz({uniforms:this.convolutionUniforms,vertexShader:o3.vertexShader,fragmentShader:o3.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new sZ.T(this.materialConvolution)}render(e,t,r,n,a){a&&e.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=this.blurX,e.setRenderTarget(this.renderTargetX),e.clear(),this.fsQuad.render(e),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=this.blurY,e.setRenderTarget(this.renderTargetY),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,a&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.clear&&e.clear(),this.fsQuad.render(e)}}let o9={uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:`
  varying vec2 vUv;
  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }`,fragmentShader:`
  uniform float strength;
  uniform sampler2D tDiffuse;
  varying vec2 vUv;
  void main() {
    vec4 texel = texture2D( tDiffuse, vUv );
    gl_FragColor = strength * texel;
  }`};var o7=Object.defineProperty,le=(e,t,r)=>t in e?o7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lt=(e,t,r)=>(le(e,"symbol"!=typeof t?t+"":t,r),r);class li extends sZ.w{constructor(){super(),lt(this,"material"),lt(this,"fsQuad"),lt(this,"factor"),lt(this,"time"),lt(this,"uniforms"),this.uniforms={tex:{value:null},time:{value:0},factor:{value:0},resolution:{value:new ee.FM8(64,64)}},this.material=new ee.jyz({uniforms:this.uniforms,vertexShader:`
      varying vec2 vUv;
      void main(){  
        vUv = uv; 
        vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * modelViewPosition;
      }`,fragmentShader:`
      uniform float time;
      uniform float factor;
      uniform vec2 resolution;
      uniform sampler2D tex;
      varying vec2 vUv;
      void main() {  
        vec2 uv1 = vUv;
        vec2 uv = gl_FragCoord.xy/resolution.xy;
        float frequency = 6.0 * factor;
        float amplitude = 0.015 * factor;
        float x = uv1.y * frequency + time * .7; 
        float y = uv1.x * frequency + time * .3;
        uv1.x += cos(x+y) * amplitude * cos(y);
        uv1.y += sin(x-y) * amplitude * cos(y);
        vec4 rgba = texture2D(tex, uv1);
        gl_FragColor = rgba;
      }`}),this.fsQuad=new sZ.T(this.material),this.factor=0,this.time=0}render(e,t,r){this.uniforms.tex.value=r.texture,this.uniforms.time.value=this.time,this.uniforms.factor.value=this.factor,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}}class lr{static createButton(e,t={}){let r=document.createElement("button");function n(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="AR NOT SUPPORTED"}function a(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="ARButton",r.style.display="none",a(r),navigator.xr.isSessionSupported("immersive-ar").then(function(a){a?function(){if(void 0===t.domOverlay){let e=document.createElement("div");e.style.display="none",document.body.appendChild(e);let r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width","38px"),r.setAttribute("height","38px"),r.style.position="absolute",r.style.right="20px",r.style.top="20px",r.addEventListener("click",function(){null==n||n.end()}),e.appendChild(r);let a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),a.setAttribute("stroke","#fff"),a.setAttribute("stroke-width","2px"),r.appendChild(a),void 0===t.optionalFeatures&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:e}}let n=null;async function a(a){a.addEventListener("end",s),e.xr.setReferenceSpaceType("local"),await e.xr.setSession(a),r.textContent="STOP AR",t.domOverlay.root.style.display="",n=a}function s(){n.removeEventListener("end",s),r.textContent="START AR",t.domOverlay.root.style.display="none",n=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="START AR",r.onmouseenter=()=>{r.style.opacity="1.0"},r.onmouseleave=()=>{r.style.opacity="0.5"},r.onclick=()=>{null===n?navigator.xr.requestSession("immersive-ar",t).then(a):n.end()}}():n()}).catch(n),r;{let e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",a(e),e}}}var ln=r(77606),la=Object.defineProperty,ls=(e,t,r)=>t in e?la(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lo=(e,t,r)=>(ls(e,"symbol"!=typeof t?t+"":t,r),r);class ll{constructor(e,t,r="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",n,a){lo(this,"controller"),lo(this,"handModel"),lo(this,"bones"),this.controller=t,this.handModel=e,this.bones=[];let s=new ln.E;a||s.setPath(r),s.load(null!=a?a:`${n}.glb`,e=>{let t=e.scene.children[0];this.handModel.add(t);let r=t.getObjectByProperty("type","SkinnedMesh");r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(e=>{let r=t.getObjectByName(e);void 0!==r?r.jointName=e:console.warn(`Couldn't find ${e} in ${n} hand mesh`),this.bones.push(r)})})}updateMesh(){let e=this.controller.joints;for(let t=0;t<this.bones.length;t++){let r=this.bones[t];if(r){let t=e[r.jointName];if(t.visible){let e=t.position;r.position.copy(e),r.quaternion.copy(t.quaternion)}}}}}var lh=Object.defineProperty,lc=(e,t,r)=>t in e?lh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lu=(e,t,r)=>(lc(e,"symbol"!=typeof t?t+"":t,r),r);class ld extends ee.Tme{constructor(e,t,r){super(),lu(this,"controller"),lu(this,"motionController"),lu(this,"envMap"),lu(this,"mesh"),lu(this,"xrInputSource"),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null,this.xrInputSource=null,e.addEventListener("connected",n=>{let a=n.data;a.hand&&!this.motionController&&(this.xrInputSource=a,this.motionController=new ll(this,e,void 0,a.handedness,"left"===a.handedness?t:r))}),e.addEventListener("disconnected",()=>{this.dispose()})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){let e=this.controller.joints["index-finger-tip"];return e?e.position:null}intersectBoxObject(e){let t=this.getPointerPosition();if(!t)return!1;{let r=new ee.aLr(t,.01),n=new ee.ZzF().setFromObject(e);return r.intersectsBox(n)}}checkButton(e){this.intersectBoxObject(e)?e.onPress():e.onClear(),e.isPressed()&&e.whilePressed()}dispose(){this.clear(),this.motionController=null}}let lm=new ee.Pa4(0,1,0),lp=new ee.Pa4(0,0,1);class lA extends ee.Tme{constructor(e,t){super(),this.hand=e,this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null,this.pointerGeometry=null,this.pointerMesh=null,this.pointerObject=null,this.pinched=!1,this.attached=!1,this.cursorObject=null,this.raycaster=null,this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.hand.addEventListener("connected",this._onConnected),this.hand.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){let t=e.data;t.hand&&(this.visible=!0,this.xrInputSource=t,this.createPointer())}_onDisconnected(){var e,t;this.visible=!1,this.xrInputSource=null,null==(e=this.pointerGeometry)||e.dispose(),null==(t=this.pointerMesh)||t.material.dispose(),this.clear()}_drawVerticesRing(e,t,r){let n=t.clone();for(var a=0;a<16;a++){n.applyAxisAngle(lp,2*Math.PI/16);let t=16*r+a;e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z}}_updatePointerVertices(e){let t=this.pointerGeometry.attributes.position.array,r=new ee.Pa4(.002,0,-1*(.035-e));this._drawVerticesRing(t,r,0);let n=new ee.Pa4(Math.sin(110*Math.PI/180)*e,Math.cos(110*Math.PI/180)*e,0);for(var a=0;a<12;a++)this._drawVerticesRing(t,n,a+1),n.applyAxisAngle(lm,-(110*Math.PI/180/24));let s=new ee.Pa4(0,0,-1*(.035-e));t[624]=s.x,t[625]=s.y,t[626]=s.z;let o=new ee.Pa4(0,0,e);t[627]=o.x,t[628]=o.y,t[629]=o.z,this.pointerGeometry.setAttribute("position",new ee.a$l(t,3))}createPointer(){var e,t;let r=Array(630).fill(0),n=[];for(this.pointerGeometry=new ee.u9r,this.pointerGeometry.setAttribute("position",new ee.a$l(r,3)),this._updatePointerVertices(.01),e=0;e<12;e++){for(t=0;t<15;t++)n.push(16*e+t,16*e+t+1,(e+1)*16+t),n.push(16*e+t+1,(e+1)*16+t+1,(e+1)*16+t);n.push((e+1)*16-1,16*e,(e+2)*16-1),n.push(16*e,(e+1)*16,(e+2)*16-1)}for(e=0;e<15;e++)n.push(208,e+1,e),n.push(209,e+192,e+192+1);n.push(208,0,15),n.push(209,207,192);let a=new ee.vBJ;a.transparent=!0,a.opacity=.4,this.pointerGeometry.setIndex(n),this.pointerMesh=new ee.Kj0(this.pointerGeometry,a),this.pointerMesh.position.set(0,0,-.01),this.pointerObject=new ee.Tme,this.pointerObject.add(this.pointerMesh),this.raycaster=new ee.iMs;let s=new ee.xo$(.02,10,10),o=new ee.vBJ;o.transparent=!0,o.opacity=.4,this.cursorObject=new ee.Kj0(s,o),this.pointerObject.add(this.cursorObject),this.add(this.pointerObject)}_updateRaycaster(){if(this.raycaster){let e=this.pointerObject.matrixWorld,t=new ee.yGw;t.identity().extractRotation(e),this.raycaster.ray.origin.setFromMatrixPosition(e),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(t)}}_updatePointer(){this.pointerObject.visible=this.controller.visible;let e=this.hand.joints["index-finger-tip"],t=this.hand.joints["thumb-tip"],r=e.position.distanceTo(t.position),n=e.position.clone().add(t.position).multiplyScalar(.5);this.pointerObject.position.copy(n),this.pointerObject.quaternion.copy(this.controller.quaternion),this.pinched=r<=.02;let a=(r-.01)/.04,s=(r-.01)/.01;if(a>1)this._updatePointerVertices(.01),this.pointerMesh.position.set(0,0,-.01),this.pointerMesh.material.opacity=.4;else if(a>0){let e=.007*a+.003;this._updatePointerVertices(e),s<1?(this.pointerMesh.position.set(0,0,-1*e-(1-s)*.02),this.pointerMesh.material.opacity=.4+(1-s)*.6):(this.pointerMesh.position.set(0,0,-1*e),this.pointerMesh.material.opacity=.4)}else this._updatePointerVertices(.003),this.pointerMesh.position.set(0,0,-.023),this.pointerMesh.material.opacity=1;this.cursorObject.material.opacity=this.pointerMesh.material.opacity}updateMatrixWorld(e){super.updateMatrixWorld(e),this.pointerGeometry&&(this._updatePointer(),this._updateRaycaster())}isPinched(){return this.pinched}setAttached(e){this.attached=e}isAttached(){return this.attached}intersectObject(e,t=!0){if(this.raycaster)return this.raycaster.intersectObject(e,t)}intersectObjects(e,t=!0){if(this.raycaster)return this.raycaster.intersectObjects(e,t)}checkIntersections(e,t=!1){if(this.raycaster&&!this.attached){let r=this.raycaster.intersectObjects(e,t),n=new ee.Pa4(0,0,-1);if(r.length>0){let e=r[0].distance;this.cursorObject.position.copy(n.multiplyScalar(e))}else this.cursorObject.position.copy(n.multiplyScalar(1.5))}}setCursor(e){let t=new ee.Pa4(0,0,-1);this.raycaster&&!this.attached&&this.cursorObject.position.copy(t.multiplyScalar(e))}dispose(){this._onDisconnected(),this.hand.removeEventListener("connected",this._onConnected),this.hand.removeEventListener("disconnected",this._onDisconnected)}}function lf(e,t){let r=document.createElement("canvas"),n=r.getContext("2d");n.font="normal 100px Arial";let a=n.measureText(e).width;r.width=a,r.height=100,n.font="normal 100px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle="#ffffff",n.fillText(e,a/2,50);let s=new ee.xEZ(r);s.needsUpdate=!0;let o=new ee.vBJ({color:16777215,side:ee.ehD,map:s,transparent:!0}),l=new ee._12(t*a/100,t);return new ee.Kj0(l,o)}var lg=Object.defineProperty;let lv=class{static createButton(e,t={}){let r=document.createElement("button");function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n(r),r.id="VRButton",r.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(n=>{n?function(){let n=null;async function a(t){t.addEventListener("end",s),await e.xr.setSession(t),r.textContent="EXIT VR",n=t}function s(){n.removeEventListener("end",s),r.textContent="ENTER VR",n=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=()=>{r.style.opacity="1.0"},r.onmouseleave=()=>{r.style.opacity="0.5"},r.onclick=()=>{var e;if(null===n){let r=[t.optionalFeatures,"local-floor","bounded-floor","hand-tracking"].flat().filter(Boolean);null==(e=navigator.xr)||e.requestSession("immersive-vr",{...t,optionalFeatures:r}).then(a)}else n.end()}}():(r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="VR NOT SUPPORTED"),n&&lv.xrSessionIsGranted&&r.click()}),r;{let e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",n(e),e}}static registerSessionGrantedListener(){"undefined"!=typeof navigator&&"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",()=>{lv.xrSessionIsGranted=!0})}},ly=lv;(k="symbol"!=typeof(X="xrSessionIsGranted")?X+"":X)in ly?lg(ly,k,{enumerable:!0,configurable:!0,writable:!0,value:!1}):ly[k]=!1,ly.registerSessionGrantedListener();var lx=Object.defineProperty,lb=(e,t,r)=>t in e?lx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lw=(e,t,r)=>(lb(e,"symbol"!=typeof t?t+"":t,r),r);let lC={Handedness:{NONE:"none",LEFT:"left",RIGHT:"right"},ComponentState:{DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"},ComponentProperty:{BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"},ComponentType:{TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"},ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:{TRANSFORM:"transform",VISIBILITY:"visibility"}};async function lE(e){let t=await fetch(e);if(t.ok)return t.json();throw Error(t.statusText)}async function lI(e){if(!e)throw Error("No basePath supplied");return await lE(`${e}/profilesList.json`)}async function lM(e,t,r=null,n=!0){let a,s;if(!e)throw Error("No xrInputSource supplied");if(!t)throw Error("No basePath supplied");let o=await lI(t);if(e.profiles.some(e=>{let r=o[e];return r&&(a={profileId:e,profilePath:`${t}/${r.path}`,deprecated:!!r.deprecated}),!!a}),!a){if(!r)throw Error("No matching profile name found");let e=o[r];if(!e)throw Error(`No matching profile name found and default profile "${r}" missing.`);a={profileId:r,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}let l=await lE(a.profilePath);if(n){let t;if(!(t="any"===e.handedness?l.layouts[Object.keys(l.layouts)[0]]:l.layouts[e.handedness]))throw Error(`No matching handedness, ${e.handedness}, in profile ${a.profileId}`);t.assetPath&&(s=a.profilePath.replace("profile.json",t.assetPath))}return{profile:l,assetPath:s}}let lB={xAxis:0,yAxis:0,button:0,state:lC.ComponentState.DEFAULT};class lS{constructor(e){lw(this,"value"),lw(this,"componentProperty"),lw(this,"states"),lw(this,"valueNodeName"),lw(this,"valueNodeProperty"),lw(this,"minNodeName"),lw(this,"maxNodeName"),lw(this,"valueNode"),lw(this,"minNode"),lw(this,"maxNode"),this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===lC.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(lB)}updateFromComponent({xAxis:e,yAxis:t,button:r,state:n}){let{normalizedXAxis:a,normalizedYAxis:s}=function(e=0,t=0){let r=e,n=t;if(Math.sqrt(e*e+t*t)>1){let a=Math.atan2(t,e);r=Math.cos(a),n=Math.sin(a)}return{normalizedXAxis:.5*r+.5,normalizedYAxis:.5*n+.5}}(e,t);switch(this.componentProperty){case lC.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?a:.5;break;case lC.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?s:.5;break;case lC.ComponentProperty.BUTTON:this.value=this.states.includes(n)&&r?r:0;break;case lC.ComponentProperty.STATE:this.valueNodeProperty===lC.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class lT{constructor(e,t){if(lw(this,"id"),lw(this,"values"),lw(this,"type"),lw(this,"gamepadIndices"),lw(this,"rootNodeName"),lw(this,"visualResponses"),lw(this,"touchPointNodeName"),lw(this,"touchPointNode"),!e||!t||!t.visualResponses||!t.gamepadIndices||0===Object.keys(t.gamepadIndices).length)throw Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(e=>{let r=new lS(t.visualResponses[e]);this.visualResponses[e]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:lC.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=lC.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=lC.ComponentState.PRESSED:(t.touched||this.values.button>lC.ButtonTouchThreshold)&&(this.values.state=lC.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===lC.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>lC.AxisTouchThreshold&&(this.values.state=lC.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===lC.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>lC.AxisTouchThreshold&&(this.values.state=lC.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class lF{constructor(e,t,r){if(lw(this,"xrInputSource"),lw(this,"assetUrl"),lw(this,"layoutDescription"),lw(this,"id"),lw(this,"components"),!e)throw Error("No xrInputSource supplied");if(!t)throw Error("No profile supplied");if(!t.layouts[e.handedness])throw Error("No layout for "+e.handedness+" handedness");this.xrInputSource=e,this.assetUrl=r,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(e=>{let t=this.layoutDescription.components[e];this.components[e]=new lT(e,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}var lP=Object.defineProperty,l_=(e,t,r)=>t in e?lP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lD=(e,t,r)=>(l_(e,"symbol"!=typeof t?t+"":t,r),r);let lR=(e,t)=>{t.traverse(t=>{t instanceof ee.Kj0&&"envMap"in t.material&&(t.material.envMap=e,t.material.needsUpdate=!0)})};class lL extends ee.Tme{constructor(){super(),lD(this,"envMap"),lD(this,"motionController"),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,lR(this.envMap,this)),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(e=>{let{valueNode:t,minNode:r,maxNode:n,value:a,valueNodeProperty:s}=e;t&&(s===lC.VisualResponseProperty.VISIBILITY&&"boolean"==typeof a?t.visible=a:s===lC.VisualResponseProperty.TRANSFORM&&r&&n&&"number"==typeof a&&(t.quaternion.slerpQuaternions(r.quaternion,n.quaternion,a),t.position.lerpVectors(r.position,n.position,a)))})}))}}function lN(e,t){!function(e,t){Object.values(e.components).forEach(e=>{let{type:r,touchPointNodeName:n,visualResponses:a}=e;if(r===lC.ComponentType.TOUCHPAD&&n){if(e.touchPointNode=t.getObjectByName(n),e.touchPointNode){let t=new ee.xo$(.001),r=new ee.vBJ({color:255}),n=new ee.Kj0(t,r);e.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`)}Object.values(a).forEach(e=>{let{valueNodeName:r,minNodeName:n,maxNodeName:a,valueNodeProperty:s}=e;if(s===lC.VisualResponseProperty.TRANSFORM&&n&&a){if(e.minNode=t.getObjectByName(n),e.maxNode=t.getObjectByName(a),!e.minNode){console.warn(`Could not find ${n} in the model`);return}if(!e.maxNode){console.warn(`Could not find ${a} in the model`);return}}e.valueNode=t.getObjectByName(r),e.valueNode||console.warn(`Could not find ${r} in the model`)})})}(e.motionController,t),e.envMap&&lR(e.envMap,t),e.add(t)}class lk{constructor(e=null){lD(this,"gltfLoader"),lD(this,"path"),lD(this,"_assetCache"),this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new ln.E)}createControllerModel(e){let t=new lL,r=null,n=e=>{let n=e.data;"tracked-pointer"===n.targetRayMode&&n.gamepad&&lM(n,this.path,"generic-trigger").then(({profile:e,assetPath:a})=>{if(!a)throw Error("no asset path");t.motionController=new lF(n,e,a);let s=t.motionController.assetUrl,o=this._assetCache[s];if(o)lN(t,r=o.scene.clone());else{if(!this.gltfLoader)throw Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,e=>{if(!t.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[s]=e,lN(t,r=e.scene.clone())},()=>{},()=>{throw Error(`Asset ${s} missing or malformed.`)})}}).catch(e=>{console.warn(e)})};e.addEventListener("connected",n);let a=()=>{e.removeEventListener("connected",n),e.removeEventListener("disconnected",a),t.motionController=null,r&&t.remove(r),r=null};return e.addEventListener("disconnected",a),t}}class lU{constructor(e,t,r,n,a){this.xrLight=e,this.renderer=t,this.lightProbe=r,this.xrWebGLBinding=null,this.estimationStartCallback=a,this.frameCallback=this.onXRFrame.bind(this);let s=t.xr.getSession();if(n&&"XRWebGLBinding"in window){let r=new ee.oAp(16);e.environment=r.texture;let n=t.getContext();switch(s.preferredReflectionFormat){case"srgba8":n.getExtension("EXT_sRGB");break;case"rgba16f":n.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(s,n),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}s.requestAnimationFrame(this.frameCallback)}updateReflection(){let e=this.renderer.properties.get(this.xrLight.environment);if(e){let t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);let r=t.getLightEstimate(this.lightProbe);if(r){this.xrLight.lightProbe.sh.fromArray(r.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;let e=Math.max(1,Math.max(r.primaryLightIntensity.x,Math.max(r.primaryLightIntensity.y,r.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(r.primaryLightIntensity.x/e,r.primaryLightIntensity.y/e,r.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(r.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class lQ extends ee.ZAu{constructor(e,t=!0){super(),this.lightProbe=new ee.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new ee.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let r=null,n=!1;e.xr.addEventListener("sessionstart",()=>{let a=e.xr.getSession();"requestLightProbe"in a&&a.requestLightProbe({reflectionFormat:a.preferredReflectionFormat}).then(a=>{r=new lU(this,e,a,t,()=>{n=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{r&&(r.dispose(),r=null),n&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{r&&(r.dispose(),r=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}let lO=new ee.yGw,lG=new ee.Pa4;class lH{constructor(e,t,r,n,a){let s;this.controller=t,this.handModel=e,this.envMap=null,a&&a.primitive&&"sphere"!==a.primitive?"box"===a.primitive&&(s=new ee.DvJ(1,1,1)):s=new ee.xo$(1,10,10);let o=new ee.Wid;this.handMesh=new ee.SPe(s,o,30),this.handMesh.instanceMatrix.setUsage(ee.dj0),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){let e=this.controller.joints,t=0;for(let r=0;r<this.joints.length;r++){let n=e[this.joints[r]];n.visible&&(lG.setScalar(n.jointRadius||.008),lO.compose(n.position,n.quaternion,lG),this.handMesh.setMatrixAt(r,lO),t++)}this.handMesh.count=t,this.handMesh.instanceMatrix.needsUpdate=!0}}class lz extends ee.Tme{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}}class lV{constructor(){this.path=null}setPath(e){return this.path=e,this}createHandModel(e,t){let r=new lz(e);return e.addEventListener("connected",n=>{let a=n.data;a.hand&&!r.motionController&&(r.xrInputSource=a,void 0===t||"spheres"===t?r.motionController=new lH(r,e,this.path,a.handedness,{primitive:"sphere"}):"boxes"===t?r.motionController=new lH(r,e,this.path,a.handedness,{primitive:"box"}):"mesh"===t&&(r.motionController=new ll(r,e,this.path,a.handedness)))}),e.addEventListener("disconnected",()=>{}),r}}class lj extends ee.u9r{constructor(e=(e,t,r)=>r.set(e,t,Math.cos(e)*Math.sin(t)),t=8,r=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};let n=[],a=[],s=[],o=[],l=new ee.Pa4,h=new ee.Pa4,c=new ee.Pa4,u=new ee.Pa4,d=new ee.Pa4,m=t+1;for(let n=0;n<=r;n++){let m=n/r;for(let r=0;r<=t;r++){let n=r/t;e(n,m,h),a.push(h.x,h.y,h.z),n-1e-5>=0?(e(n-1e-5,m,c),u.subVectors(h,c)):(e(n+1e-5,m,c),u.subVectors(c,h)),m-1e-5>=0?(e(n,m-1e-5,c),d.subVectors(h,c)):(e(n,m+1e-5,c),d.subVectors(c,h)),l.crossVectors(u,d).normalize(),s.push(l.x,l.y,l.z),o.push(n,m)}}for(let e=0;e<r;e++)for(let r=0;r<t;r++){let t=e*m+r,a=e*m+r+1,s=(e+1)*m+r+1,o=(e+1)*m+r;n.push(t,a,o),n.push(a,s,o)}this.setIndex(n),this.setAttribute("position",new ee.a$l(a,3)),this.setAttribute("normal",new ee.a$l(s,3)),this.setAttribute("uv",new ee.a$l(o,2))}}class lW extends lj{constructor(e,t=64,r=1,n=8,a=!1){let s=t+1,o=e.computeFrenetFrames(t,a),l=o.tangents,h=o.normals,c=o.binormals,u=new ee.Pa4;super(function(t,n,a){n*=2*Math.PI;let o=Math.floor(t*(s-1));e.getPointAt(t,u);let l=h[o],d=c[o],m=-r*Math.cos(n),p=r*Math.sin(n);u.x+=m*l.x+p*d.x,u.y+=m*l.y+p*d.y,u.z+=m*l.z+p*d.z,a.copy(u)},t,n),this.tangents=l,this.normals=h,this.binormals=c,this.path=e,this.segments=t,this.radius=r,this.segmentsRadius=n,this.closed=a}}let lX={klein:function(e,t,r){let n,a;t*=Math.PI,e*=2*Math.PI,(t*=2)<Math.PI?(n=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(t)*Math.cos(e),a=-8*Math.sin(t)-2*(1-Math.cos(t)/2)*Math.sin(t)*Math.cos(e)):(n=3*Math.cos(t)*(1+Math.sin(t))+2*(1-Math.cos(t)/2)*Math.cos(e+Math.PI),a=-8*Math.sin(t));let s=-2*(1-Math.cos(t)/2)*Math.sin(e);r.set(n,s,a)},plane:function(e,t){return function(r,n,a){a.set(r*e,0,n*t)}},mobius:function(e,t,r){let n=2*Math.PI*t,a=Math.cos(n)*(2+(e-=.5)*Math.cos(n/2)),s=Math.sin(n)*(2+e*Math.cos(n/2)),o=e*Math.sin(n/2);r.set(a,s,o)},mobius3d:function(e,t,r){e*=Math.PI,t*=2*Math.PI;let n=(e*=2)/2,a=.125*Math.cos(t)*Math.cos(n)-.65*Math.sin(t)*Math.sin(n),s=.125*Math.cos(t)*Math.sin(n)+.65*Math.sin(t)*Math.cos(n),o=(2.25+a)*Math.sin(e);a=(2.25+a)*Math.cos(e),r.set(a,o,s)},TubeGeometry:lW,TorusKnotGeometry:class extends lW{constructor(e=200,t=40,r=64,n=8,a=2,s=3){class o extends ee.Hyl{getPoint(t,r=new ee.Pa4){let n=(1+.5*Math.cos(s*(t*=2*Math.PI)))*Math.cos(a*t),o=(1+.5*Math.cos(s*t))*Math.sin(a*t),l=.5*Math.sin(s*t);return r.set(n,o,l).multiplyScalar(e)}}super(new o,r,t,n,!0,!1),this.radius=e,this.tube=t,this.segmentsT=r,this.segmentsR=n,this.p=a,this.q=s}},SphereGeometry:class extends lj{constructor(e,t,r){super(function(t,r,n){let a=e*Math.sin(t*=Math.PI)*Math.cos(r*=2*Math.PI),s=e*Math.sin(t)*Math.sin(r),o=e*Math.cos(t);n.set(a,s,o)},t,r)}},PlaneGeometry:class extends lj{constructor(e,t,r,n){super(function(r,n,a){a.set(r*e,0,n*t)},r,n)}}},lY=new ee.Pa4;function lK(e,t,r,n,a,s){let o=2*Math.PI*a/4,l=Math.max(s-2*a,0);lY.copy(t),lY[n]=0,lY.normalize();let h=.5*o/(o+l),c=1-lY.angleTo(e)/(Math.PI/4);return 1===Math.sign(lY[r])?c*h:l/(o+l)+h+h*(1-c)}class lJ extends ee.DvJ{constructor(e=1,t=1,r=1,n=2,a=.1){if(n=2*n+1,a=Math.min(e/2,t/2,r/2,a),super(1,1,1,n,n,n),1===n)return;let s=this.toNonIndexed();this.index=null,this.attributes.position=s.attributes.position,this.attributes.normal=s.attributes.normal,this.attributes.uv=s.attributes.uv;let o=new ee.Pa4,l=new ee.Pa4,h=new ee.Pa4(e,t,r).divideScalar(2).subScalar(a),c=this.attributes.position.array,u=this.attributes.normal.array,d=this.attributes.uv.array,m=c.length/6,p=new ee.Pa4,A=.5/n;for(let n=0,s=0;n<c.length;n+=3,s+=2)switch(o.fromArray(c,n),l.copy(o),l.x-=Math.sign(l.x)*A,l.y-=Math.sign(l.y)*A,l.z-=Math.sign(l.z)*A,l.normalize(),c[n+0]=h.x*Math.sign(o.x)+l.x*a,c[n+1]=h.y*Math.sign(o.y)+l.y*a,c[n+2]=h.z*Math.sign(o.z)+l.z*a,u[n+0]=l.x,u[n+1]=l.y,u[n+2]=l.z,Math.floor(n/m)){case 0:p.set(1,0,0),d[s+0]=lK(p,l,"z","y",a,r),d[s+1]=1-lK(p,l,"y","z",a,t);break;case 1:p.set(-1,0,0),d[s+0]=1-lK(p,l,"z","y",a,r),d[s+1]=1-lK(p,l,"y","z",a,t);break;case 2:p.set(0,1,0),d[s+0]=1-lK(p,l,"x","z",a,e),d[s+1]=lK(p,l,"z","x",a,r);break;case 3:p.set(0,-1,0),d[s+0]=1-lK(p,l,"x","z",a,e),d[s+1]=1-lK(p,l,"z","x",a,r);break;case 4:p.set(0,0,1),d[s+0]=1-lK(p,l,"x","y",a,e),d[s+1]=1-lK(p,l,"y","x",a,t);break;case 5:p.set(0,0,-1),d[s+0]=lK(p,l,"x","y",a,e),d[s+1]=1-lK(p,l,"y","x",a,t)}}}class lq extends ee.u9r{constructor(e,t,r,n,a,s){super();let o=(e=e||1)/2,l=(t=t||1)/2,h=(r=r||1)/2,c=e/(n=Math.floor(n)||1),u=t/(a=Math.floor(a)||1),d=r/(s=Math.floor(s)||1),m=[],p=-o,A=-l,f=-h;for(let e=0;e<=n;e++)m.push(p,-l,-h,p,l,-h),m.push(p,l,-h,p,l,h),m.push(p,l,h,p,-l,h),m.push(p,-l,h,p,-l,-h),p+=c;for(let e=0;e<=a;e++)m.push(-o,A,-h,o,A,-h),m.push(o,A,-h,o,A,h),m.push(o,A,h,-o,A,h),m.push(-o,A,h,-o,A,-h),A+=u;for(let e=0;e<=s;e++)m.push(-o,-l,f,-o,l,f),m.push(-o,l,f,o,l,f),m.push(o,l,f,o,-l,f),m.push(o,-l,f,-o,-l,f),f+=d;this.setAttribute("position",new ee.a$l(m,3))}}class lZ extends ee.u9r{constructor(e,t,r,n){super();let a=[],s=[],o=[],l=new ee.Pa4,h=new ee.yGw;h.makeRotationFromEuler(r),h.setPosition(t);let c=new ee.yGw;function u(t,r,n){r.applyMatrix4(e.matrixWorld),r.applyMatrix4(c),n.transformDirection(e.matrixWorld),t.push(new l$(r.clone(),n.clone()))}function d(e,t){let r=[],a=.5*Math.abs(n.dot(t));for(let n=0;n<e.length;n+=3){let s,o,l,h,c,u,d;let p=e[n+0].position.dot(t)-a,A=e[n+1].position.dot(t)-a,f=e[n+2].position.dot(t)-a;switch(((c=p>0)?1:0)+((u=A>0)?1:0)+((d=f>0)?1:0)){case 0:r.push(e[n]),r.push(e[n+1]),r.push(e[n+2]);break;case 1:if(c&&(s=e[n+1],o=e[n+2],l=m(e[n],s,t,a),h=m(e[n],o,t,a)),u){s=e[n],o=e[n+2],l=m(e[n+1],s,t,a),h=m(e[n+1],o,t,a),r.push(l),r.push(o.clone()),r.push(s.clone()),r.push(o.clone()),r.push(l.clone()),r.push(h);break}d&&(s=e[n],o=e[n+1],l=m(e[n+2],s,t,a),h=m(e[n+2],o,t,a)),r.push(s.clone()),r.push(o.clone()),r.push(l),r.push(h),r.push(l.clone()),r.push(o.clone());break;case 2:c||(o=m(s=e[n].clone(),e[n+1],t,a),l=m(s,e[n+2],t,a),r.push(s),r.push(o),r.push(l)),u||(o=m(s=e[n+1].clone(),e[n+2],t,a),l=m(s,e[n],t,a),r.push(s),r.push(o),r.push(l)),d||(o=m(s=e[n+2].clone(),e[n],t,a),l=m(s,e[n+1],t,a),r.push(s),r.push(o),r.push(l))}}return r}function m(e,t,r,n){let a=e.position.dot(r)-n,s=a/(a-(t.position.dot(r)-n));return new l$(new ee.Pa4(e.position.x+s*(t.position.x-e.position.x),e.position.y+s*(t.position.y-e.position.y),e.position.z+s*(t.position.z-e.position.z)),new ee.Pa4(e.normal.x+s*(t.normal.x-e.normal.x),e.normal.y+s*(t.normal.y-e.normal.y),e.normal.z+s*(t.normal.z-e.normal.z)))}c.copy(h).invert(),function(){let t;let r=[],c=new ee.Pa4,m=new ee.Pa4;if(!0===e.geometry.isGeometry){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}let p=e.geometry,A=p.attributes.position,f=p.attributes.normal;if(null!==p.index){let e=p.index;for(t=0;t<e.count;t++)c.fromBufferAttribute(A,e.getX(t)),m.fromBufferAttribute(f,e.getX(t)),u(r,c,m)}else for(t=0;t<A.count;t++)c.fromBufferAttribute(A,t),m.fromBufferAttribute(f,t),u(r,c,m);for(t=0,r=d(r,l.set(1,0,0)),r=d(r,l.set(-1,0,0)),r=d(r,l.set(0,1,0)),r=d(r,l.set(0,-1,0)),r=d(r,l.set(0,0,1)),r=d(r,l.set(0,0,-1));t<r.length;t++){let e=r[t];o.push(.5+e.position.x/n.x,.5+e.position.y/n.y),e.position.applyMatrix4(h),a.push(e.position.x,e.position.y,e.position.z),s.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new ee.a$l(a,3)),this.setAttribute("normal",new ee.a$l(s,3)),this.setAttribute("uv",new ee.a$l(o,2))}}class l${constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class l0 extends ee.u9r{constructor(e,t,r,n,a,s,o){let l,h,c,u,d,m,p,A,f,g,v,y,x,b,w,C;let E=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],I=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),e=e||50,t=void 0!==t?Math.max(2,Math.floor(t)||10):10,r=void 0===r||r,n=void 0===n||n,a=void 0===a||a,s=void 0===s||s;let M=3.15*((o=void 0===o||o)?1:1.3)/2,B=e/M,S=r?(8*t-4)*t:0,T=new Uint32Array(3*(S+=(n?(16*t-4)*t:0)+(a?40*t*t:0))),F=r?4:0;F+=(n?8:0)+(a?20:0);let P=new Float32Array(3*(F*=(t+1)*(t+1))),_=new Float32Array(3*F),D=new Float32Array(2*F),R=new ee.yGw;R.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);let L=[],N=[],k=[],U=[],Q=[],O=[],G=[],H=[],z=[],V=new ee.Pa4,j=0,W=0,X=new ee.Pa4,Y=new ee.yGw,K=new ee.yGw,J=new ee.Ltg,q=new ee.Ltg,Z=new ee.Ltg,$=new ee.Ltg,et=new ee.Pa4,ei=new ee.Pa4,er=R.clone();er.transpose();let en=(e,t,r)=>!(P[3*e]===P[3*t]&&P[3*e+1]===P[3*t+1]&&P[3*e+2]===P[3*t+2]||P[3*e]===P[3*r]&&P[3*e+1]===P[3*r+1]&&P[3*e+2]===P[3*r+2]||P[3*t]===P[3*r]&&P[3*t+1]===P[3*r+1]&&P[3*t+2]===P[3*r+2]);for(l=0;l<3;l++)O[l]=new ee.yGw;let ea=a?0:20,es=r?32:28;p=t+1;let eo=0,el=0,eh=0,ec=0,eu=0;for(let e=ea;e<es;e++)if(n||e<20||e>=28){for(l=0;l<3;l++){for(h=0;h<4;h++)for(c=0;c<4;c++)L[4*c+h]=I[3*E[16*e+4*h+c]+l],s&&e>=20&&e<28&&2!==l&&(L[4*c+h]*=1.077),o||2!==l||(L[4*c+h]*=1.3);Y.set(L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15]),K.multiplyMatrices(Y,R),O[l].multiplyMatrices(er,K)}for(d=0;d<=t;d++)for(m=0,A=d/t;m<=t;m++){for(y=4,f=m/t,g=v=1;y--;)N[y]=g,k[y]=v,g*=A,v*=f,3===y?(U[y]=Q[y]=0,j=W=1):(U[y]=j*(3-y),Q[y]=W*(3-y),j*=A,W*=f);for(J.fromArray(N),q.fromArray(k),Z.fromArray(U),$.fromArray(Q),l=0;l<3;l++)(u=J.clone()).applyMatrix4(O[l]),G[l]=u.dot(q),(u=Z.clone()).applyMatrix4(O[l]),H[l]=u.dot(q),(u=J.clone()).applyMatrix4(O[l]),z[l]=u.dot($);et.fromArray(H),ei.fromArray(z),V.crossVectors(ei,et),V.normalize(),0===G[0]&&0===G[1]?X.set(0,G[2]>M?1:-1,0):X.set(V.x,V.z,-V.y),P[el++]=B*G[0],P[el++]=B*(G[2]-M),P[el++]=-B*G[1],_[eh++]=X.x,_[eh++]=X.y,_[eh++]=X.z,D[ec++]=1-f,D[ec++]=1-A}for(d=0;d<t;d++)for(m=0;m<t;m++)w=(b=(x=eo*p*p+d*p+m)+1)+p,C=x+p,en(x,b,w)&&(T[eu++]=x,T[eu++]=b,T[eu++]=w),en(x,w,C)&&(T[eu++]=x,T[eu++]=w,T[eu++]=C);eo++}this.setIndex(new ee.TlE(T,1)),this.setAttribute("position",new ee.TlE(P,3)),this.setAttribute("normal",new ee.TlE(_,3)),this.setAttribute("uv",new ee.TlE(D,2)),this.computeBoundingSphere()}}class l1 extends ee.O7d{constructor(e,t={}){let{bevelEnabled:r=!1,bevelSize:n=8,bevelThickness:a=10,font:s,height:o=50,size:l=100,lineHeight:h=1,letterSpacing:c=0,...u}=t;void 0===s?super():super(s.generateShapes(e,l,{lineHeight:h,letterSpacing:c}),{...u,bevelEnabled:r,bevelSize:n,bevelThickness:a,depth:o}),this.type="TextGeometry"}}let l2=new ee.yGw;class l3{constructor(e){e=e||{},this.vertices={near:[new ee.Pa4,new ee.Pa4,new ee.Pa4,new ee.Pa4],far:[new ee.Pa4,new ee.Pa4,new ee.Pa4,new ee.Pa4]},void 0!==e.projectionMatrix&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}setFromProjectionMatrix(e,t){let r=0===e.elements[11];return l2.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach(function(e){e.applyMatrix4(l2)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(e){e.applyMatrix4(l2);let n=Math.abs(e.z);r?e.z*=Math.min(t/n,1):e.multiplyScalar(Math.min(t/n,1))}),this.vertices}split(e,t){for(;e.length>t.length;)t.push(new l3);t.length=e.length;for(let r=0;r<e.length;r++){let n=t[r];if(0===r)for(let e=0;e<4;e++)n.vertices.near[e].copy(this.vertices.near[e]);else for(let t=0;t<4;t++)n.vertices.near[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[r-1]);if(r===e.length-1)for(let e=0;e<4;e++)n.vertices.far[e].copy(this.vertices.far[e]);else for(let t=0;t<4;t++)n.vertices.far[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[r])}}toSpace(e,t){for(let r=0;r<4;r++)t.vertices.near[r].copy(this.vertices.near[r]).applyMatrix4(e),t.vertices.far[r].copy(this.vertices.far[r]).applyMatrix4(e)}}let l4={lights_fragment_begin:`
GeometricContext geometry;

geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

#ifdef CLEARCOAT

	geometry.clearcoatNormal = clearcoatNormal;

#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	float linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )
	vec2 cascade;
	float cascadeCenter;
	float closestEdge;
	float margin;
	float csmx;
	float csmy;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );

	  	#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
			// NOTE: Depth gets larger away from the camera.
			// cascade.x is closer, cascade.y is further
			cascade = CSM_cascades[ i ];
			cascadeCenter = ( cascade.x + cascade.y ) / 2.0;
			closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
			margin = 0.25 * pow( closestEdge, 2.0 );
			csmx = cascade.x - margin / 2.0;
			csmy = cascade.y + margin / 2.0;
			if( linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {

				float dist = min( linearDepth - csmx, csmy - linearDepth );
				float ratio = clamp( dist / margin, 0.0, 1.0 );

				vec3 prevColor = directLight.color;
				directionalLightShadow = directionalLightShadows[ i ];
				directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

				bool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;
				directLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );

				ReflectedLight prevLight = reflectedLight;
				RE_Direct( directLight, geometry, material, reflectedLight );

				bool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;
				float blendRatio = shouldBlend ? ratio : 1.0;

				reflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );
				reflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );
				reflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );
				reflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );

			}
	  	#endif

	}
	#pragma unroll_loop_end
	#else

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, geometry, directLight );

			#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )

			directionalLightShadow = directionalLightShadows[ i ];
			if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

			if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometry, material, reflectedLight );

			#endif

		}
		#pragma unroll_loop_end

	#endif

	#if ( NUM_DIR_LIGHTS > NUM_DIR_LIGHT_SHADOWS)
		// compute the lights not casting shadows (if any)

		#pragma unroll_loop_start
		for ( int i = NUM_DIR_LIGHT_SHADOWS; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];

			getDirectionalLightInfo( directionalLight, geometry, directLight );

			RE_Direct( directLight, geometry, material, reflectedLight );

		}
		#pragma unroll_loop_end

	#endif

#endif


#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, geometry, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,getlights_pars_begin:()=>`
			#if defined( USE_CSM ) && defined( CSM_CASCADES )
			uniform vec2 CSM_cascades[CSM_CASCADES];
			uniform float cameraNear;
			uniform float shadowFar;
			#endif

			${ee.WdD.lights_pars_begin}
		`},l5=new ee.yGw,l8=new l3,l6=new ee.Pa4,l9=new ee.ZzF,l7=[],he=[];class ht{constructor(e){e=e||{},this.camera=e.camera,this.parent=e.parent,this.cascades=e.cascades||3,this.maxFar=e.maxFar||1e5,this.mode=e.mode||"practical",this.shadowMapSize=e.shadowMapSize||2048,this.shadowBias=e.shadowBias||1e-6,this.lightDirection=e.lightDirection||new ee.Pa4(1,-1,1).normalize(),this.lightIntensity=e.lightIntensity||1,this.lightNear=e.lightNear||1,this.lightFar=e.lightFar||2e3,this.lightMargin=e.lightMargin||200,this.customSplitsCallback=e.customSplitsCallback,this.fade=!1,this.mainFrustum=new l3,this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}createLights(){for(let e=0;e<this.cascades;e++){let e=new ee.Ox3(16777215,this.lightIntensity);e.castShadow=!0,e.shadow.mapSize.width=this.shadowMapSize,e.shadow.mapSize.height=this.shadowMapSize,e.shadow.camera.near=this.lightNear,e.shadow.camera.far=this.lightFar,e.shadow.bias=this.shadowBias,this.parent.add(e),this.parent.add(e.target),this.lights.push(e)}}initCascades(){let e=this.camera;e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}updateShadowBounds(){let e=this.frustums;for(let t=0;t<e.length;t++){let e;let r=this.lights[t].shadow.camera,n=this.frustums[t],a=n.vertices.near,s=n.vertices.far,o=s[0];e=o.distanceTo(s[2])>o.distanceTo(a[2])?s[2]:a[2];let l=o.distanceTo(e);if(this.fade){let e=this.camera,t=Math.max(e.far,this.maxFar);l+=.25*Math.pow(n.vertices.far[0].z/(t-e.near),2)*(t-e.near)}r.left=-l/2,r.right=l/2,r.top=l/2,r.bottom=-l/2,r.updateProjectionMatrix()}}getBreaks(){let e=this.camera,t=Math.min(e.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":r(this.cascades,e.near,t,this.breaks);break;case"logarithmic":n(this.cascades,e.near,t,this.breaks);break;case"practical":!function(e,t,a,s,o){l7.length=0,he.length=0,n(e,t,a,he),r(e,t,a,l7);for(let t=1;t<e;t++)o.push(ee.M8C.lerp(l7[t-1],he[t-1],.5));o.push(1)}(this.cascades,e.near,t,0,this.breaks);break;case"custom":void 0===this.customSplitsCallback&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,e.near,t,this.breaks)}function r(e,t,r,n){for(let a=1;a<e;a++)n.push((t+(r-t)*a/e)/r);n.push(1)}function n(e,t,r,n){for(let a=1;a<e;a++)n.push(t*(r/t)**(a/e)/r);n.push(1)}}update(){let e=this.camera,t=this.frustums;for(let r=0;r<t.length;r++){let n=this.lights[r],a=n.shadow.camera,s=(a.right-a.left)/this.shadowMapSize,o=(a.top-a.bottom)/this.shadowMapSize;n.shadow.camera.updateMatrixWorld(!0),l5.multiplyMatrices(n.shadow.camera.matrixWorldInverse,e.matrixWorld),t[r].toSpace(l5,l8);let l=l8.vertices.near,h=l8.vertices.far;l9.makeEmpty();for(let e=0;e<4;e++)l9.expandByPoint(l[e]),l9.expandByPoint(h[e]);l9.getCenter(l6),l6.z=l9.max.z+this.lightMargin,l6.x=Math.floor(l6.x/s)*s,l6.y=Math.floor(l6.y/o)*o,l6.applyMatrix4(n.shadow.camera.matrixWorld),n.position.copy(l6),n.target.position.copy(l6),n.target.position.x+=this.lightDirection.x,n.target.position.y+=this.lightDirection.y,n.target.position.z+=this.lightDirection.z}}injectInclude(){ee.WdD.lights_fragment_begin=l4.lights_fragment_begin,ee.WdD.lights_pars_begin=l4.lights_pars_begin}setupMaterial(e){e.defines=e.defines||{},e.defines.USE_CSM=1,e.defines.CSM_CASCADES=this.cascades,this.fade&&(e.defines.CSM_FADE="");let t=[],r=this,n=this.shaders;e.onBeforeCompile=function(a){let s=Math.min(r.camera.far,r.maxFar);r.getExtendedBreaks(t),a.uniforms.CSM_cascades={value:t},a.uniforms.cameraNear={value:r.camera.near},a.uniforms.shadowFar={value:s},n.set(e,a)},n.set(e,null)}updateUniforms(){let e=Math.min(this.camera.far,this.maxFar);this.shaders.forEach(function(t,r){if(null!==t){let r=t.uniforms;this.getExtendedBreaks(r.CSM_cascades.value),r.cameraNear.value=this.camera.near,r.shadowFar.value=e}!this.fade&&"CSM_FADE"in r.defines?(delete r.defines.CSM_FADE,r.needsUpdate=!0):!this.fade||"CSM_FADE"in r.defines||(r.defines.CSM_FADE="",r.needsUpdate=!0)},this)}getExtendedBreaks(e){for(;e.length<this.breaks.length;)e.push(new ee.FM8);e.length=this.breaks.length;for(let t=0;t<this.cascades;t++){let r=this.breaks[t],n=this.breaks[t-1]||0;e[t].x=n,e[t].y=r}}updateFrustums(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}remove(){for(let e=0;e<this.lights.length;e++)this.parent.remove(this.lights[e])}dispose(){let e=this.shaders;e.forEach(function(e,t){delete t.onBeforeCompile,delete t.defines.USE_CSM,delete t.defines.CSM_CASCADES,delete t.defines.CSM_FADE,null!==e&&(delete e.uniforms.CSM_cascades,delete e.uniforms.cameraNear,delete e.uniforms.shadowFar),t.needsUpdate=!0}),e.clear()}}class hi extends ee.ZAu{constructor(e){super(),this.csm=e,this.displayFrustum=!0,this.displayPlanes=!0,this.displayShadowBounds=!0;let t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new ee.u9r;n.setIndex(new ee.TlE(t,1)),n.setAttribute("position",new ee.TlE(r,3,!1));let a=new ee.ejS(n,new ee.nls);this.add(a),this.frustumLines=a,this.cascadeLines=[],this.cascadePlanes=[],this.shadowLines=[]}updateVisibility(){let e=this.displayFrustum,t=this.displayPlanes,r=this.displayShadowBounds,n=this.frustumLines,a=this.cascadeLines,s=this.cascadePlanes,o=this.shadowLines;for(let n=0,l=a.length;n<l;n++){let l=a[n],h=s[n],c=o[n];l.visible=e,h.visible=e&&t,c.visible=r}n.visible=e}update(){let e=this.csm,t=e.camera,r=e.cascades,n=e.mainFrustum,a=e.frustums,s=e.lights,o=this.frustumLines.geometry.getAttribute("position"),l=this.cascadeLines,h=this.cascadePlanes,c=this.shadowLines;for(this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.updateMatrixWorld(!0);l.length>r;)this.remove(l.pop()),this.remove(h.pop()),this.remove(c.pop());for(;l.length<r;){let e=new ee.GQ(new ee.ZzF,16777215),t=new ee.vBJ({transparent:!0,opacity:.1,depthWrite:!1,side:ee.ehD}),r=new ee.Kj0(new ee._12,t),n=new ee.ZAu,a=new ee.GQ(new ee.ZzF,16776960);n.add(a),this.add(e),this.add(r),this.add(n),l.push(e),h.push(r),c.push(n)}for(let e=0;e<r;e++){let t=a[e],r=s[e].shadow.camera,n=t.vertices.far,o=l[e],u=h[e],d=c[e],m=d.children[0];o.box.min.copy(n[2]),o.box.max.copy(n[0]),o.box.max.z+=1e-4,u.position.addVectors(n[0],n[2]),u.position.multiplyScalar(.5),u.scale.subVectors(n[0],n[2]),u.scale.z=1e-4,this.remove(d),d.position.copy(r.position),d.quaternion.copy(r.quaternion),d.scale.copy(r.scale),d.updateMatrixWorld(!0),this.attach(d),m.box.min.set(r.bottom,r.left,-r.far),m.box.max.set(r.top,r.right,-r.near)}let u=n.vertices.near,d=n.vertices.far;o.setXYZ(0,d[0].x,d[0].y,d[0].z),o.setXYZ(1,d[3].x,d[3].y,d[3].z),o.setXYZ(2,d[2].x,d[2].y,d[2].z),o.setXYZ(3,d[1].x,d[1].y,d[1].z),o.setXYZ(4,u[0].x,u[0].y,u[0].z),o.setXYZ(5,u[3].x,u[3].y,u[3].z),o.setXYZ(6,u[2].x,u[2].y,u[2].z),o.setXYZ(7,u[1].x,u[1].y,u[1].z),o.needsUpdate=!0}}let hr={uniforms:{tDiffuse:{value:null},exposure:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform sampler2D tDiffuse;\nuniform float exposure;\nvarying vec2 vUv;\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),\n		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),\n		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nvoid main() {\n	vec4 tex = texture2D( tDiffuse, vUv );\n	tex.rgb *= exposure / 0.6;\n	gl_FragColor = vec4( ACESFilmicToneMapping( tex.rgb ), tex.a );\n}"},hn={uniforms:{},vertexShader:"void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"},ha={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 base = texture2D( tDiffuse, vUv );\n	vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\n	float lum = dot( lumCoeff, base.rgb );\n	vec3 blend = vec3( lum );\n	float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\n	vec3 result1 = 2.0 * base.rgb * blend;\n	vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\n	vec3 newColor = mix( result1, result2, L );\n	float A2 = opacity * base.a;\n	vec3 mixRGB = A2 * newColor.rgb;\n	mixRGB += ( ( 1.0 - A2 ) * base.rgb );\n	gl_FragColor = vec4( mixRGB, base.a );\n}"},hs={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel1 = texture2D( tDiffuse1, vUv );\n	vec4 texel2 = texture2D( tDiffuse2, vUv );\n	gl_FragColor = opacity * mix( texel1, texel2, mixRatio );\n}"};var ho=r(81563);let hl={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\n	gl_FragColor = texture2D( tDiffuse, vUv );\n	gl_FragColor.rgb += brightness;\n	if (contrast > 0.0) {\n		gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n	} else {\n		gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n	}\n}"},hh={uniforms:{tDiffuse:{value:null},powRGB:{value:new ee.Pa4(2,2,2)},mulRGB:{value:new ee.Pa4(1,1,1)},addRGB:{value:new ee.Pa4(0,0,0)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 powRGB;\nuniform vec3 mulRGB;\nuniform vec3 addRGB;\nvarying vec2 vUv;\nvoid main() {\n	gl_FragColor = texture2D( tDiffuse, vUv );\n	gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );\n}"},hc={uniforms:{tDiffuse:{value:null},color:{value:new ee.Ilk(16777215)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	vec3 luma = vec3( 0.299, 0.587, 0.114 );\n	float v = dot( texel.xyz, luma );\n	gl_FragColor = vec4( v * color, texel.w );\n}"},hu={uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},maxblur:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float focus;\nuniform float maxblur;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\nvoid main() {\n	vec4 depth = texture2D( tDepth, vUv );\n	float factor = depth.x - focus;\n	vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );\n	gl_FragColor = col;\n	gl_FragColor.a = 1.0;\n}"},hd={uniforms:{tDiffuse:{value:null},resolution:{value:new ee.FM8(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:'precision highp float;\n\nuniform sampler2D tDiffuse;\n\nuniform vec2 resolution;\n\nvarying vec2 vUv;\n\n// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n//----------------------------------------------------------------------------------\n// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n// SDK Version: v3.00\n// Email:       gameworks@nvidia.com\n// Site:        http://developer.nvidia.com/\n//\n// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions\n// are met:\n//  * Redistributions of source code must retain the above copyright\n//    notice, this list of conditions and the following disclaimer.\n//  * Redistributions in binary form must reproduce the above copyright\n//    notice, this list of conditions and the following disclaimer in the\n//    documentation and/or other materials provided with the distribution.\n//  * Neither the name of NVIDIA CORPORATION nor the names of its\n//    contributors may be used to endorse or promote products derived\n//    from this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS\'\' AND ANY\n// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n//\n//----------------------------------------------------------------------------------\n\n#define FXAA_PC 1\n#define FXAA_GLSL_100 1\n#define FXAA_QUALITY_PRESET 12\n\n#define FXAA_GREEN_AS_LUMA 1\n\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_PC_CONSOLE\n    //\n    // The console algorithm for PC is included\n    // for developers targeting really low spec machines.\n    // Likely better to just run FXAA_PC, and use a really low preset.\n    //\n    #define FXAA_PC_CONSOLE 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GLSL_120\n    #define FXAA_GLSL_120 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GLSL_130\n    #define FXAA_GLSL_130 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_3\n    #define FXAA_HLSL_3 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_4\n    #define FXAA_HLSL_4 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_5\n    #define FXAA_HLSL_5 0\n#endif\n/*==========================================================================*/\n#ifndef FXAA_GREEN_AS_LUMA\n    //\n    // For those using non-linear color,\n    // and either not able to get luma in alpha, or not wanting to,\n    // this enables FXAA to run using green as a proxy for luma.\n    // So with this enabled, no need to pack luma in alpha.\n    //\n    // This will turn off AA on anything which lacks some amount of green.\n    // Pure red and blue or combination of only R and B, will get no AA.\n    //\n    // Might want to lower the settings for both,\n    //    fxaaConsoleEdgeThresholdMin\n    //    fxaaQualityEdgeThresholdMin\n    // In order to insure AA does not get turned off on colors\n    // which contain a minor amount of green.\n    //\n    // 1 = On.\n    // 0 = Off.\n    //\n    #define FXAA_GREEN_AS_LUMA 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_EARLY_EXIT\n    //\n    // Controls algorithm\'s early exit path.\n    // On PS3 turning this ON adds 2 cycles to the shader.\n    // On 360 turning this OFF adds 10ths of a millisecond to the shader.\n    // Turning this off on console will result in a more blurry image.\n    // So this defaults to on.\n    //\n    // 1 = On.\n    // 0 = Off.\n    //\n    #define FXAA_EARLY_EXIT 1\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_DISCARD\n    //\n    // Only valid for PC OpenGL currently.\n    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n    //\n    // 1 = Use discard on pixels which don\'t need AA.\n    //     For APIs which enable concurrent TEX+ROP from same surface.\n    // 0 = Return unchanged color on pixels which don\'t need AA.\n    //\n    #define FXAA_DISCARD 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_FAST_PIXEL_OFFSET\n    //\n    // Used for GLSL 120 only.\n    //\n    // 1 = GL API supports fast pixel offsets\n    // 0 = do not use fast pixel offsets\n    //\n    #ifdef GL_EXT_gpu_shader4\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifdef GL_NV_gpu_shader5\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifdef GL_ARB_gpu_shader5\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifndef FXAA_FAST_PIXEL_OFFSET\n        #define FXAA_FAST_PIXEL_OFFSET 0\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GATHER4_ALPHA\n    //\n    // 1 = API supports gather4 on alpha channel.\n    // 0 = API does not support gather4 on alpha channel.\n    //\n    #if (FXAA_HLSL_5 == 1)\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifdef GL_ARB_gpu_shader5\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifdef GL_NV_gpu_shader5\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifndef FXAA_GATHER4_ALPHA\n        #define FXAA_GATHER4_ALPHA 0\n    #endif\n#endif\n\n\n/*============================================================================\n                        FXAA QUALITY - TUNING KNOBS\n------------------------------------------------------------------------------\nNOTE the other tuning knobs are now in the shader function inputs!\n============================================================================*/\n#ifndef FXAA_QUALITY_PRESET\n    //\n    // Choose the quality preset.\n    // This needs to be compiled into the shader as it effects code.\n    // Best option to include multiple presets is to\n    // in each shader define the preset, then include this file.\n    //\n    // OPTIONS\n    // -----------------------------------------------------------------------\n    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n    // 39       - no dither, very expensive\n    //\n    // NOTES\n    // -----------------------------------------------------------------------\n    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n    // 13 = about same speed as FXAA 3.9 and better than 12\n    // 23 = closest to FXAA 3.9 visually and performance wise\n    //  _ = the lowest digit is directly related to performance\n    // _  = the highest digit is directly related to style\n    //\n    #define FXAA_QUALITY_PRESET 12\n#endif\n\n\n/*============================================================================\n\n                           FXAA QUALITY - PRESETS\n\n============================================================================*/\n\n/*============================================================================\n                     FXAA QUALITY - MEDIUM DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - LOW DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - EXTREME QUALITY\n============================================================================*/\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n\n\n/*============================================================================\n\n                                API PORTING\n\n============================================================================*/\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n    #define FxaaBool bool\n    #define FxaaDiscard discard\n    #define FxaaFloat float\n    #define FxaaFloat2 vec2\n    #define FxaaFloat3 vec3\n    #define FxaaFloat4 vec4\n    #define FxaaHalf float\n    #define FxaaHalf2 vec2\n    #define FxaaHalf3 vec3\n    #define FxaaHalf4 vec4\n    #define FxaaInt2 ivec2\n    #define FxaaSat(x) clamp(x, 0.0, 1.0)\n    #define FxaaTex sampler2D\n#else\n    #define FxaaBool bool\n    #define FxaaDiscard clip(-1)\n    #define FxaaFloat float\n    #define FxaaFloat2 float2\n    #define FxaaFloat3 float3\n    #define FxaaFloat4 float4\n    #define FxaaHalf half\n    #define FxaaHalf2 half2\n    #define FxaaHalf3 half3\n    #define FxaaHalf4 half4\n    #define FxaaSat(x) saturate(x)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_100 == 1)\n  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_120 == 1)\n    // Requires,\n    //  #version 120\n    // And at least,\n    //  #extension GL_EXT_gpu_shader4 : enable\n    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n    #if (FXAA_FAST_PIXEL_OFFSET == 1)\n        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n    #else\n        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n    #endif\n    #if (FXAA_GATHER4_ALPHA == 1)\n        // use #extension GL_ARB_gpu_shader5 : enable\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_130 == 1)\n    // Requires "#version 130" or better\n    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n    #if (FXAA_GATHER4_ALPHA == 1)\n        // use #extension GL_ARB_gpu_shader5 : enable\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_3 == 1)\n    #define FxaaInt2 float2\n    #define FxaaTex sampler2D\n    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_4 == 1)\n    #define FxaaInt2 int2\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_5 == 1)\n    #define FxaaInt2 int2\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n#endif\n\n\n/*============================================================================\n                   GREEN AS LUMA OPTION SUPPORT FUNCTION\n============================================================================*/\n#if (FXAA_GREEN_AS_LUMA == 0)\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n#else\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n#endif\n\n\n\n\n/*============================================================================\n\n                             FXAA3 QUALITY - PC\n\n============================================================================*/\n#if (FXAA_PC == 1)\n/*--------------------------------------------------------------------------*/\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Used only for FXAA Console, and not used on the 360 version.\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy_} = upper left of pixel\n    // {_zw} = lower right of pixel\n    FxaaFloat4 fxaaConsolePosPos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {__a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for "tex".\n    // For 360, same texture, just alias with a 2nd sampler.\n    // This sampler needs to have an exponent bias of -1.\n    FxaaTex fxaaConsole360TexExpBiasNegOne,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for "tex".\n    // For 360, same texture, just alias with a 3nd sampler.\n    // This sampler needs to have an exponent bias of -2.\n    FxaaTex fxaaConsole360TexExpBiasNegTwo,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Console.\n    // This must be from a constant/uniform.\n    // This effects sub-pixel AA quality and inversely sharpness.\n    //   Where N ranges between,\n    //     N = 0.50 (default)\n    //     N = 0.33 (sharper)\n    // {x__} = -N/screenWidthInPixels\n    // {_y_} = -N/screenHeightInPixels\n    // {_z_} =  N/screenWidthInPixels\n    // {__w} =  N/screenHeightInPixels\n    FxaaFloat4 fxaaConsoleRcpFrameOpt,\n    //\n    // Only used on FXAA Console.\n    // Not used on 360, but used on PS3 and PC.\n    // This must be from a constant/uniform.\n    // {x__} = -2.0/screenWidthInPixels\n    // {_y_} = -2.0/screenHeightInPixels\n    // {_z_} =  2.0/screenWidthInPixels\n    // {__w} =  2.0/screenHeightInPixels\n    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\n    //\n    // Only used on FXAA Console.\n    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n    // This must be from a constant/uniform.\n    // {x__} =  8.0/screenWidthInPixels\n    // {_y_} =  8.0/screenHeightInPixels\n    // {_z_} = -4.0/screenWidthInPixels\n    // {__w} = -4.0/screenHeightInPixels\n    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_SUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only three safe values here: 2 and 4 and 8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // For all other platforms can be a non-power of two.\n    //   8.0 is sharper (default!!!)\n    //   4.0 is softer\n    //   2.0 is really soft (good only for vector graphics inputs)\n    FxaaFloat fxaaConsoleEdgeSharpness,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only two safe values here: 1/4 and 1/8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // The console setting has a different mapping than the quality setting.\n    // Other platforms can use other values.\n    //   0.125 leaves less aliasing, but is softer (default!!!)\n    //   0.25 leaves more aliasing, and is sharper\n    FxaaFloat fxaaConsoleEdgeThreshold,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    // The console setting has a different mapping than the quality setting.\n    // This only applies when FXAA_EARLY_EXIT is 1.\n    // This does not apply to PS3,\n    // PS3 was simplified to avoid more shader instructions.\n    //   0.06 - faster but more aliasing in darks\n    //   0.05 - default\n    //   0.04 - slower and less aliasing in darks\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaConsoleEdgeThresholdMin,\n    //\n    // Extra constants for 360 FXAA Console only.\n    // Use zeros or anything else for other platforms.\n    // These must be in physical constant registers and NOT immediates.\n    // Immediates will result in compiler un-optimizing.\n    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n    FxaaFloat4 fxaaConsole360ConstDir\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    #if (FXAA_GATHER4_ALPHA == 1)\n        #if (FXAA_DISCARD == 0)\n            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n            #if (FXAA_GREEN_AS_LUMA == 0)\n                #define lumaM rgbyM.w\n            #else\n                #define lumaM rgbyM.y\n            #endif\n        #endif\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n        #else\n            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n        #endif\n        #if (FXAA_DISCARD == 1)\n            #define lumaM luma4A.w\n        #endif\n        #define lumaE luma4A.z\n        #define lumaS luma4A.x\n        #define lumaSE luma4A.y\n        #define lumaNW luma4B.w\n        #define lumaN luma4B.z\n        #define lumaW luma4B.x\n    #else\n        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            #define lumaM rgbyM.w\n        #else\n            #define lumaM rgbyM.y\n        #endif\n        #if (FXAA_GLSL_100 == 1)\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n        #else\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n        #endif\n    #endif\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        #if (FXAA_DISCARD == 1)\n            FxaaDiscard;\n        #else\n            return rgbyM;\n        #endif\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_GATHER4_ALPHA == 0)\n        #if (FXAA_GLSL_100 == 1)\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n        #else\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n        #endif\n    #else\n        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n    #endif\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    #if (FXAA_DISCARD == 1)\n        return FxaaTexTop(tex, posM);\n    #else\n        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n    #endif\n}\n/*==========================================================================*/\n#endif\n\nvoid main() {\n  gl_FragColor = FxaaPixelShader(\n    vUv,\n    vec4(0.0),\n    tDiffuse,\n    tDiffuse,\n    tDiffuse,\n    resolution,\n    vec4(0.0),\n    vec4(0.0),\n    vec4(0.0),\n    0.75,\n    0.166,\n    0.0833,\n    0.0,\n    0.0,\n    0.0,\n    vec4(0.0)\n  );\n\n  // TODO avoid querying texture twice for same texel\n  gl_FragColor.a = texture2D(tDiffuse, vUv).a;\n}'};var hm=r(84493);let hp={uniforms:{tDiffuse:{value:null},screenWidth:{value:1024},screenHeight:{value:1024},sampleDistance:{value:.94},waveFactor:{value:.00125}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float screenWidth;\nuniform float screenHeight;\nuniform float sampleDistance;\nuniform float waveFactor;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 color, org, tmp, add;\n	float sample_dist, f;\n	vec2 vin;\n	vec2 uv = vUv;\n	add = color = org = texture2D( tDiffuse, uv );\n	vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );\n	sample_dist = dot( vin, vin ) * 2.0;\n	f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;\n	vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );\n	add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );\n	if( tmp.b < color.b ) color = tmp;\n	color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );\n	color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );\n	gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );\n}"},hA={uniforms:{tDiffuse:{value:null},aspect:{value:new ee.FM8(512,512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nuniform vec2 aspect;\nvec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main(void)\n{\n	G[0] = g0,\n	G[1] = g1,\n	G[2] = g2,\n	G[3] = g3,\n	G[4] = g4,\n	G[5] = g5,\n	G[6] = g6,\n	G[7] = g7,\n	G[8] = g8;\n	mat3 I;\n	float cnv[9];\n	vec3 sample;\n	for (float i=0.0; i<3.0; i++) {\n		for (float j=0.0; j<3.0; j++) {\n			sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;\n			I[int(i)][int(j)] = length(sample);\n		}\n	}\n	for (int i=0; i<9; i++) {\n		float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n		cnv[i] = dp3 * dp3;\n	}\n	float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\n	float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\n	gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);\n}"},hf={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n	vec3 I = worldPosition.xyz - cameraPosition;\n	vReflect = reflect( I, worldNormal );\n	vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );\n	vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );\n	vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );\n	vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );\n	gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\n	vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n	vec4 refractedColor = vec4( 1.0 );\n	refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\n	refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\n	refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\n	gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}"},hg={uniforms:{tDiffuse:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 tex = texture2D( tDiffuse, vUv );\n	gl_FragColor = LinearTosRGB( tex );\n}"},hv={uniforms:{tInput:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n vUv = uv;\n gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tInput;\nvoid main() {\n	gl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );\n}"},hy={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new ee.Pa4}},vertexShader:"varying vec2 vUv;\nvoid main() {\n vUv = uv;\n gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define TAPS_PER_PASS 6.0\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec3 vSunPositionScreenSpace;\nuniform float fStepSize;\nvoid main() {\n	vec2 delta = vSunPositionScreenSpace.xy - vUv;\n	float dist = length( delta );\n	vec2 stepv = fStepSize * delta / dist;\n	float iters = dist/fStepSize;\n	vec2 uv = vUv.xy;\n	float col = 0.0;\n	float f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) );\n	if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n	uv += stepv;\n	if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n	uv += stepv;\n	if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n	uv += stepv;\n	if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n	uv += stepv;\n	if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n	uv += stepv;\n	if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;\n	uv += stepv;\n	gl_FragColor = vec4( col/TAPS_PER_PASS );\n	gl_FragColor.a = 1.0;\n}"},hx={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tColors;\nuniform sampler2D tGodRays;\nuniform float fGodRayIntensity;\nvoid main() {\n	gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );\n	gl_FragColor.a = 1.0;\n}"},hb={uniforms:{vSunPositionScreenSpace:{value:new ee.Pa4},fAspect:{value:1},sunColor:{value:new ee.Ilk(16772608)},bgColor:{value:new ee.Ilk(0)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform vec3 vSunPositionScreenSpace;\nuniform float fAspect;\nuniform vec3 sunColor;\nuniform vec3 bgColor;\nvoid main() {\n	vec2 diff = vUv - vSunPositionScreenSpace.xy;\n	diff.x *= fAspect;\n	float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );\n	prop = 0.35 * pow( 1.0 - prop, 3.0 );\n	gl_FragColor.xyz = ( vSunPositionScreenSpace.z > 0.0 ) ? mix( sunColor, bgColor, 1.0 - prop ) : bgColor;\n	gl_FragColor.w = 1.0;\n}"},hw={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},hC={uniforms:{tDiffuse:{value:null},h:{value:1/512},r:{value:.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\n	vec4 sum = vec4( 0.0 );\n	float hh = h * abs( r - vUv.y );\n	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\n	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\n	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\n	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\n	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\n	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\n	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\n	gl_FragColor = sum;\n}"},hE={uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float hue;\nuniform float saturation;\nvarying vec2 vUv;\nvoid main() {\n	gl_FragColor = texture2D( tDiffuse, vUv );\n	float angle = hue * 3.14159265;\n	float s = sin(angle), c = cos(angle);\n	vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n	float len = length(gl_FragColor.rgb);\n	gl_FragColor.rgb = vec3(\n		dot(gl_FragColor.rgb, weights.xyz),\n		dot(gl_FragColor.rgb, weights.zxy),\n		dot(gl_FragColor.rgb, weights.yzx)\n	);\n	float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;\n	if (saturation > 0.0) {\n		gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n	} else {\n		gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);\n	}\n}"},hI={uniforms:{tDiffuse:{value:null},sides:{value:6},angle:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float sides;\nuniform float angle;\nvarying vec2 vUv;\nvoid main() {\n	vec2 p = vUv - 0.5;\n	float r = length(p);\n	float a = atan(p.y, p.x) + angle;\n	float tau = 2. * 3.1416 ;\n	a = mod(a, tau/sides);\n	a = abs(a - tau/sides/2.) ;\n	p = r * vec2(cos(a), sin(a));\n	vec4 color = texture2D(tDiffuse, p + 0.5);\n	gl_FragColor = color;\n}"};var hM=r(45165);let hB={uniforms:{tDiffuse:{value:null},side:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform int side;\nvarying vec2 vUv;\nvoid main() {\n	vec2 p = vUv;\n	if (side == 0){\n		if (p.x > 0.5) p.x = 1.0 - p.x;\n	}else if (side == 1){\n		if (p.x < 0.5) p.x = 1.0 - p.x;\n	}else if (side == 2){\n		if (p.y < 0.5) p.y = 1.0 - p.y;\n	}else if (side == 3){\n		if (p.y > 0.5) p.y = 1.0 - p.y;\n	} \n	vec4 color = texture2D(tDiffuse, p);\n	gl_FragColor = color;\n}"},hS={uniforms:{heightMap:{value:null},resolution:{value:new ee.FM8(512,512)},scale:{value:new ee.FM8(1,1)},height:{value:.05}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\n	float val = texture2D( heightMap, vUv ).x;\n	float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\n	float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\n	gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"},hT={modes:{none:"NO_PARALLAX",basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"},uniforms:{bumpMap:{value:null},map:{value:null},parallaxScale:{value:null},parallaxMinLayers:{value:null},parallaxMaxLayers:{value:null}},vertexShader:"varying vec2 vUv;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;\nvoid main() {\n	vUv = uv;\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	vViewPosition = -mvPosition.xyz;\n	vNormal = normalize( normalMatrix * normal );\n	gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform sampler2D bumpMap;\nuniform sampler2D map;\nuniform float parallaxScale;\nuniform float parallaxMinLayers;\nuniform float parallaxMaxLayers;\nvarying vec2 vUv;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;\n#ifdef USE_BASIC_PARALLAX\n	vec2 parallaxMap( in vec3 V ) {\n		float initialHeight = texture2D( bumpMap, vUv ).r;\n		vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;\n		return vUv - texCoordOffset;\n	}\n#else\n	vec2 parallaxMap( in vec3 V ) {\n		float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );\n		float layerHeight = 1.0 / numLayers;\n		float currentLayerHeight = 0.0;\n		vec2 dtex = parallaxScale * V.xy / V.z / numLayers;\n		vec2 currentTextureCoords = vUv;\n		float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;\n		for ( int i = 0; i < 30; i += 1 ) {\n			if ( heightFromTexture <= currentLayerHeight ) {\n				break;\n			}\n			currentLayerHeight += layerHeight;\n			currentTextureCoords -= dtex;\n			heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;\n		}\n		#ifdef USE_STEEP_PARALLAX\n			return currentTextureCoords;\n		#elif defined( USE_RELIEF_PARALLAX )\n			vec2 deltaTexCoord = dtex / 2.0;\n			float deltaHeight = layerHeight / 2.0;\n			currentTextureCoords += deltaTexCoord;\n			currentLayerHeight -= deltaHeight;\n			const int numSearches = 5;\n			for ( int i = 0; i < numSearches; i += 1 ) {\n				deltaTexCoord /= 2.0;\n				deltaHeight /= 2.0;\n				heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;\n				if( heightFromTexture > currentLayerHeight ) {\n					currentTextureCoords -= deltaTexCoord;\n					currentLayerHeight += deltaHeight;\n				} else {\n					currentTextureCoords += deltaTexCoord;\n					currentLayerHeight -= deltaHeight;\n				}\n			}\n			return currentTextureCoords;\n		#elif defined( USE_OCLUSION_PARALLAX )\n			vec2 prevTCoords = currentTextureCoords + dtex;\n			float nextH = heightFromTexture - currentLayerHeight;\n			float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;\n			float weight = nextH / ( nextH - prevH );\n			return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );\n		#else\n			return vUv;\n		#endif\n	}\n#endif\nvec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {\n	vec2 texDx = dFdx( vUv );\n	vec2 texDy = dFdy( vUv );\n	vec3 vSigmaX = dFdx( surfPosition );\n	vec3 vSigmaY = dFdy( surfPosition );\n	vec3 vR1 = cross( vSigmaY, surfNormal );\n	vec3 vR2 = cross( surfNormal, vSigmaX );\n	float fDet = dot( vSigmaX, vR1 );\n	vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );\n	vec3 vProjVtex;\n	vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;\n	vProjVtex.z = dot( surfNormal, viewPosition );\n	return parallaxMap( vProjVtex );\n}\nvoid main() {\n	vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );\n	gl_FragColor = texture2D( map, mapUv );\n}"},hF={uniforms:{tDiffuse:{value:null},resolution:{value:null},pixelSize:{value:1}},vertexShader:"varying highp vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float pixelSize;\nuniform vec2 resolution;\nvarying highp vec2 vUv;\nvoid main(){\nvec2 dxy = pixelSize / resolution;\nvec2 coord = dxy * floor( vUv / dxy );\ngl_FragColor = texture2D(tDiffuse, coord);\n}"},hP={uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float amount;\nuniform float angle;\nvarying vec2 vUv;\nvoid main() {\n	vec2 offset = amount * vec2( cos(angle), sin(angle));\n	vec4 cr = texture2D(tDiffuse, vUv + offset);\n	vec4 cga = texture2D(tDiffuse, vUv);\n	vec4 cb = texture2D(tDiffuse, vUv - offset);\n	gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n}"},h_={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 color = texture2D( tDiffuse, vUv );\n	vec3 c = color.rgb;\n	color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n	color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n	color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n	gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"},hD={uniforms:{tDiffuse:{value:null},resolution:{value:new ee.FM8}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\nvoid main() {\n	vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );\n	const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );\n	const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );\n	float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;\n	float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;\n	float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;\n	float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;\n	float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;\n	float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;\n	float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;\n	float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;\n	float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;\n	float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + \n		Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + \n		Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; \n	float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + \n		Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + \n		Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; \n	float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );\n	gl_FragColor = vec4( vec3( G ), 1 );\n}"};function hR(){if(c)return c;let e=ee.WdD.meshphong_frag.slice(0,ee.WdD.meshphong_frag.indexOf("void main() {")),t=ee.WdD.meshphong_frag.slice(ee.WdD.meshphong_frag.indexOf("void main() {"));return c={uniforms:ee.rDY.merge([ee.Vj0.phong.uniforms,{thicknessMap:{value:null},thicknessColor:{value:new ee.Ilk(16777215)},thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}}]),vertexShader:`
    #define USE_UV
    ${ee.WdD.meshphong_vert}
  `,fragmentShader:`
    #define USE_UV',
    #define SUBSURFACE',

    ${e}

    uniform sampler2D thicknessMap;
    uniform float thicknessPower;
    uniform float thicknessScale;
    uniform float thicknessDistortion;
    uniform float thicknessAmbient;
    uniform float thicknessAttenuation;
    uniform vec3 thicknessColor;

    void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in GeometricContext geometry, inout ReflectedLight reflectedLight) {
    	vec3 thickness = thicknessColor * texture2D(thicknessMap, uv).r;
    	vec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * thicknessDistortion));
    	float scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), thicknessPower) * thicknessScale;
    	vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * thickness;
    	reflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;
    }

    ${t.replace("#include <lights_fragment_begin>",ee.WdD.lights_fragment_begin.replace(/RE_Direct\( directLight, geometry, material, reflectedLight \);/g,`
        RE_Direct( directLight, geometry, material, reflectedLight );

        #if defined( SUBSURFACE ) && defined( USE_UV )
          RE_Direct_Scattering(directLight, vUv, geometry, reflectedLight);
        #endif
      `))}
  `}}let hL={get uniforms(){return hR().uniforms},set uniforms(value){hR().uniforms=value},get vertexShader(){return hR().vertexShader},set vertexShader(value){hR().vertexShader=value},get fragmentShader(){return hR().vertexShader},set fragmentShader(value){hR().vertexShader=value}},hN={uniforms:{tDiffuse:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );\n	vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);\n	gl_FragColor = newTex;\n}"},hk={uniforms:{uDirLightPos:{value:new ee.Pa4},uDirLightColor:{value:new ee.Ilk(15658734)},uAmbientLightColor:{value:new ee.Ilk(328965)},uBaseColor:{value:new ee.Ilk(16777215)}},vertexShader:"varying vec3 vNormal;\nvarying vec3 vRefract;\nvoid main() {\n	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n	vNormal = normalize( normalMatrix * normal );\n	vec3 I = worldPosition.xyz - cameraPosition;\n	vRefract = refract( normalize( I ), worldNormal, 1.02 );\n	gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform vec3 uBaseColor;\nuniform vec3 uDirLightPos;\nuniform vec3 uDirLightColor;\nuniform vec3 uAmbientLightColor;\nvarying vec3 vNormal;\nvarying vec3 vRefract;\nvoid main() {\n	float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);\n	vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;\n	float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );\n	intensity += length(lightWeighting) * 0.2;\n	float cameraWeighting = dot( normalize( vNormal ), vRefract );\n	intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );\n	intensity = intensity * 0.2 + 0.3;\n	if ( intensity < 0.50 ) {\n		gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );\n	} else {\n		gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );\n}\n}"},hU={uniforms:{uDirLightPos:{value:new ee.Pa4},uDirLightColor:{value:new ee.Ilk(15658734)},uAmbientLightColor:{value:new ee.Ilk(328965)},uBaseColor:{value:new ee.Ilk(15658734)},uLineColor1:{value:new ee.Ilk(8421504)},uLineColor2:{value:new ee.Ilk(0)},uLineColor3:{value:new ee.Ilk(0)},uLineColor4:{value:new ee.Ilk(0)}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n	vNormal = normalize( normalMatrix * normal );\n}",fragmentShader:"uniform vec3 uBaseColor;\nuniform vec3 uLineColor1;\nuniform vec3 uLineColor2;\nuniform vec3 uLineColor3;\nuniform vec3 uLineColor4;\nuniform vec3 uDirLightPos;\nuniform vec3 uDirLightColor;\nuniform vec3 uAmbientLightColor;\nvarying vec3 vNormal;\nvoid main() {\n	float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);\n	float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);\n	gl_FragColor = vec4( uBaseColor, 1.0 );\n	if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {\n		gl_FragColor *= vec4( uLineColor1, 1.0 );\n	}\n	if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {\n		gl_FragColor *= vec4( uLineColor2, 1.0 );\n	}\n}"},hQ={uniforms:{uDirLightPos:{value:new ee.Pa4},uDirLightColor:{value:new ee.Ilk(15658734)},uAmbientLightColor:{value:new ee.Ilk(328965)},uBaseColor:{value:new ee.Ilk(16777215)},uLineColor1:{value:new ee.Ilk(0)},uLineColor2:{value:new ee.Ilk(0)},uLineColor3:{value:new ee.Ilk(0)},uLineColor4:{value:new ee.Ilk(0)}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n	vNormal = normalize( normalMatrix * normal );\n}",fragmentShader:"uniform vec3 uBaseColor;\nuniform vec3 uLineColor1;\nuniform vec3 uLineColor2;\nuniform vec3 uLineColor3;\nuniform vec3 uLineColor4;\nuniform vec3 uDirLightPos;\nuniform vec3 uDirLightColor;\nuniform vec3 uAmbientLightColor;\nvarying vec3 vNormal;\nvoid main() {\n	float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);\n	vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;\n	gl_FragColor = vec4( uBaseColor, 1.0 );\n	if ( length(lightWeighting) < 1.00 ) {\n		if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {\n			gl_FragColor = vec4( uLineColor1, 1.0 );\n		}\n	}\n	if ( length(lightWeighting) < 0.75 ) {\n		if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {\n			gl_FragColor = vec4( uLineColor2, 1.0 );\n		}\n	}\n	if ( length(lightWeighting) < 0.50 ) {\n		if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {\n			gl_FragColor = vec4( uLineColor3, 1.0 );\n		}\n	}\n	if ( length(lightWeighting) < 0.3465 ) {\n		if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {\n			gl_FragColor = vec4( uLineColor4, 1.0 );\n	}\n	}\n}"},hO={uniforms:{uDirLightPos:{value:new ee.Pa4},uDirLightColor:{value:new ee.Ilk(15658734)},uAmbientLightColor:{value:new ee.Ilk(328965)},uBaseColor:{value:new ee.Ilk(16777215)},uLineColor1:{value:new ee.Ilk(0)}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n	vNormal = normalize( normalMatrix * normal );\n}",fragmentShader:"uniform vec3 uBaseColor;\nuniform vec3 uLineColor1;\nuniform vec3 uLineColor2;\nuniform vec3 uLineColor3;\nuniform vec3 uLineColor4;\nuniform vec3 uDirLightPos;\nuniform vec3 uDirLightColor;\nuniform vec3 uAmbientLightColor;\nvarying vec3 vNormal;\nvoid main() {\nfloat directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);\nvec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;\ngl_FragColor = vec4( uBaseColor, 1.0 );\nif ( length(lightWeighting) < 1.00 ) {\n		if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {\n			gl_FragColor = vec4( uLineColor1, 1.0 );\n		}\n	}\n	if ( length(lightWeighting) < 0.50 ) {\n		if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {\n			gl_FragColor = vec4( uLineColor1, 1.0 );\n		}\n	}\n}"},hG={uniforms:{texture:{value:null},delta:{value:new ee.FM8(1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\n#define ITERATIONS 10.0\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 vUv;\nvoid main() {\n	vec4 color = vec4( 0.0 );\n	float total = 0.0;\n	float offset = rand( vUv );\n	for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {\n		float percent = ( t + offset - 0.5 ) / ITERATIONS;\n		float weight = 1.0 - abs( percent );\n		color += texture2D( texture, vUv + delta * percent ) * weight;\n		total += weight;\n	}\n	gl_FragColor = color / total;\n}"},hH={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},hz={uniforms:{tDiffuse:{value:null},v:{value:1/512},r:{value:.35}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform float v;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\n	vec4 sum = vec4( 0.0 );\n	float vv = v * abs( r - vUv.y );\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;\n	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;\n	gl_FragColor = sum;\n}"},hV={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n	gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"},hj={uniforms:{u_size:{value:new ee.Pa4(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new ee.FM8(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:"		varying vec4 v_nearpos;\n		varying vec4 v_farpos;\n		varying vec3 v_position;\n		void main() {\n				mat4 viewtransformf = modelViewMatrix;\n				mat4 viewtransformi = inverse(modelViewMatrix);\n				vec4 position4 = vec4(position, 1.0);\n				vec4 pos_in_cam = viewtransformf * position4;\n				pos_in_cam.z = -pos_in_cam.w;\n				v_nearpos = viewtransformi * pos_in_cam;\n				pos_in_cam.z = pos_in_cam.w;\n				v_farpos = viewtransformi * pos_in_cam;\n				v_position = position;\n				gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;\n		}",fragmentShader:"		precision highp float;\n		precision mediump sampler3D;\n		uniform vec3 u_size;\n		uniform int u_renderstyle;\n		uniform float u_renderthreshold;\n		uniform vec2 u_clim;\n		uniform sampler3D u_data;\n		uniform sampler2D u_cmdata;\n		varying vec3 v_position;\n		varying vec4 v_nearpos;\n		varying vec4 v_farpos;\n		const int MAX_STEPS = 887;	// 887 for 512^3, 1774 for 1024^3\n		const int REFINEMENT_STEPS = 4;\n		const float relative_step_size = 1.0;\n		const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);\n		const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);\n		const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);\n		const float shininess = 40.0;\n		void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n		void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n		float sample1(vec3 texcoords);\n		vec4 apply_colormap(float val);\n		vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);\n		void main() {\n				vec3 farpos = v_farpos.xyz / v_farpos.w;\n				vec3 nearpos = v_nearpos.xyz / v_nearpos.w;\n				vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);\n				float distance = dot(nearpos - v_position, view_ray);\n				distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,\n																		(u_size.x - 0.5 - v_position.x) / view_ray.x));\n				distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,\n																		(u_size.y - 0.5 - v_position.y) / view_ray.y));\n				distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,\n																		(u_size.z - 0.5 - v_position.z) / view_ray.z));\n				vec3 front = v_position + view_ray * distance;\n				int nsteps = int(-distance / relative_step_size + 0.5);\n				if ( nsteps < 1 )\n						discard;\n				vec3 step = ((v_position - front) / u_size) / float(nsteps);\n				vec3 start_loc = front / u_size;\n				if (u_renderstyle == 0)\n						cast_mip(start_loc, step, nsteps, view_ray);\n				else if (u_renderstyle == 1)\n						cast_iso(start_loc, step, nsteps, view_ray);\n				if (gl_FragColor.a < 0.05)\n						discard;\n		}\n		float sample1(vec3 texcoords) {\n				/* Sample float value from a 3D texture. Assumes intensity data. */\n				return texture(u_data, texcoords.xyz).r;\n		}\n		vec4 apply_colormap(float val) {\n				val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);\n				return texture2D(u_cmdata, vec2(val, 0.5));\n		}\n		void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n				float max_val = -1e6;\n				int max_i = 100;\n				vec3 loc = start_loc;\n				for (int iter=0; iter<MAX_STEPS; iter++) {\n						if (iter >= nsteps)\n								break;\n						float val = sample1(loc);\n						if (val > max_val) {\n								max_val = val;\n								max_i = iter;\n						}\n						loc += step;\n				}\n				vec3 iloc = start_loc + step * (float(max_i) - 0.5);\n				vec3 istep = step / float(REFINEMENT_STEPS);\n				for (int i=0; i<REFINEMENT_STEPS; i++) {\n						max_val = max(max_val, sample1(iloc));\n						iloc += istep;\n				}\n				gl_FragColor = apply_colormap(max_val);\n		}\n		void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n				gl_FragColor = vec4(0.0);	// init transparent\n				vec4 color3 = vec4(0.0);	// final color\n				vec3 dstep = 1.5 / u_size;	// step to sample derivative\n				vec3 loc = start_loc;\n				float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);\n				for (int iter=0; iter<MAX_STEPS; iter++) {\n						if (iter >= nsteps)\n								break;\n						float val = sample1(loc);\n						if (val > low_threshold) {\n								vec3 iloc = loc - 0.5 * step;\n								vec3 istep = step / float(REFINEMENT_STEPS);\n								for (int i=0; i<REFINEMENT_STEPS; i++) {\n										val = sample1(iloc);\n										if (val > u_renderthreshold) {\n												gl_FragColor = add_lighting(val, iloc, dstep, view_ray);\n												return;\n										}\n										iloc += istep;\n								}\n						}\n						loc += step;\n				}\n		}\n		vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)\n		{\n				vec3 V = normalize(view_ray);\n				vec3 N;\n				float val1, val2;\n				val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));\n				val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));\n				N[0] = val1 - val2;\n				val = max(max(val1, val2), val);\n				val1 = sample1(loc + vec3(0.0, -step[1], 0.0));\n				val2 = sample1(loc + vec3(0.0, +step[1], 0.0));\n				N[1] = val1 - val2;\n				val = max(max(val1, val2), val);\n				val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));\n				val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));\n				N[2] = val1 - val2;\n				val = max(max(val1, val2), val);\n				float gm = length(N); // gradient magnitude\n				N = normalize(N);\n				float Nselect = float(dot(N, V) > 0.0);\n				N = (2.0 * Nselect - 1.0) * N;	// ==	Nselect * N - (1.0-Nselect)*N;\n				vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);\n				vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);\n				vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);\n				for (int i=0; i<1; i++)\n				{\n						vec3 L = normalize(view_ray);	//lightDirs[i];\n						float lightEnabled = float( length(L) > 0.0 );\n						L = normalize(L + (1.0 - lightEnabled));\n						float lambertTerm = clamp(dot(N, L), 0.0, 1.0);\n						vec3 H = normalize(L+V); // Halfway vector\n						float specularTerm = pow(max(dot(H, N), 0.0), shininess);\n						float mask1 = lightEnabled;\n						ambient_color +=	mask1 * ambient_color;	// * gl_LightSource[i].ambient;\n						diffuse_color +=	mask1 * lambertTerm;\n						specular_color += mask1 * specularTerm * specular_color;\n				}\n				vec4 final_color;\n				vec4 color = apply_colormap(val);\n				final_color = color * (ambient_color + diffuse_color) + specular_color;\n				final_color.a = color.a;\n				return final_color;\n		}"},hW={uniforms:{color:{value:null},time:{value:0},tDiffuse:{value:null},tDudv:{value:null},textureMatrix:{value:null}},vertexShader:"uniform mat4 textureMatrix;\nvarying vec2 vUv;\nvarying vec4 vUvRefraction;\nvoid main() {\n	vUv = uv;\n	vUvRefraction = textureMatrix * vec4( position, 1.0 );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 color;\nuniform float time;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDudv;\nvarying vec2 vUv;\nvarying vec4 vUvRefraction;\nfloat blendOverlay( float base, float blend ) {\n	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n}\nvec3 blendOverlay( vec3 base, vec3 blend ) {\n	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );\n}\nvoid main() {\n float waveStrength = 0.1;\n float waveSpeed = 0.03;\n	vec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;\n	distortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );\n	vec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;\n vec4 uv = vec4( vUvRefraction );\n uv.xy += distortion;\n	vec4 base = texture2DProj( tDiffuse, uv );\n	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n}"};class hX extends ee.Kj0{constructor(e){let t=new hY(e),r=new ee._12(.001*t.image.width,.001*t.image.height),n=new ee.vBJ({map:t,toneMapped:!1,transparent:!0});function a(e){n.map.dispatchDOMEvent(e)}super(r,n),this.addEventListener("mousedown",a),this.addEventListener("mousemove",a),this.addEventListener("mouseup",a),this.addEventListener("click",a),this.dispose=function(){r.dispose(),n.dispose(),n.map.dispose(),hK.delete(e),this.removeEventListener("mousedown",a),this.removeEventListener("mousemove",a),this.removeEventListener("mouseup",a),this.removeEventListener("click",a)}}}class hY extends ee.ROQ{constructor(e){super(hJ(e)),this.dom=e,this.anisotropy=16,"colorSpace"in this?this.colorSpace="srgb":this.encoding=3001,this.minFilter=ee.wem,this.magFilter=ee.wem;let t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))});t.observe(e,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.observer=t}dispatchDOMEvent(e){e.data&&function(e,t,r,n){let a={clientX:r*e.offsetWidth+e.offsetLeft,clientY:n*e.offsetHeight+e.offsetTop,view:e.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(t,a));let s=e.getBoundingClientRect();r=r*s.width+s.left,n=n*s.height+s.top,function e(s){if(s.nodeType!==Node.TEXT_NODE&&s.nodeType!==Node.COMMENT_NODE){let o=s.getBoundingClientRect();if(r>o.left&&r<o.right&&n>o.top&&n<o.bottom&&(s.dispatchEvent(new MouseEvent(t,a)),s instanceof HTMLInputElement&&"range"===s.type&&("mousedown"===t||"click"===t))){let[e,t]=["min","max"].map(e=>parseFloat(s[e])),n=o.width,a=r-o.x;s.value=e+a/n*(t-e),s.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let t=0;t<s.childNodes.length;t++)e(s.childNodes[t])}}(e)}(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=hJ(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}let hK=new WeakMap;function hJ(e){let t=document.createRange(),r=new ee.Ilk;function n(e,t,r,n){""!==n&&("uppercase"===e.textTransform&&(n=n.toUpperCase()),h.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,h.textBaseline="top",h.fillStyle=e.color,h.fillText(n,t,r+.1*parseFloat(e.fontSize)))}function a(e,t,r,n,a){r<2*a&&(a=r/2),n<2*a&&(a=n/2),h.beginPath(),h.moveTo(e+a,t),h.arcTo(e+r,t,e+r,t+n,a),h.arcTo(e+r,t+n,e,t+n,a),h.arcTo(e,t+n,e,t,a),h.arcTo(e,t,e+r,t,a),h.closePath()}function s(e,t,r,n,a,s){let o=e[t+"Width"],l=e[t+"Style"],c=e[t+"Color"];"0px"!==o&&"none"!==l&&"transparent"!==c&&"rgba(0, 0, 0, 0)"!==c&&(h.strokeStyle=c,h.lineWidth=parseFloat(o),h.beginPath(),h.moveTo(r,n),h.lineTo(r+a,n+s),h.stroke())}let o=e.getBoundingClientRect(),l=hK.get(e);void 0===l&&((l=document.createElement("canvas")).width=o.width,l.height=o.height,hK.set(e,l));let h=l.getContext("2d"),c=new function(e){let t=[],r=!1;function n(){if(r&&(r=!1,e.restore()),0===t.length)return;let n=-1/0,a=-1/0,s=1/0,o=1/0;for(let e=0;e<t.length;e++){let r=t[e];n=Math.max(n,r.x),a=Math.max(a,r.y),s=Math.min(s,r.x+r.width),o=Math.min(o,r.y+r.height)}e.save(),e.beginPath(),e.rect(n,a,s-n,o-a),e.clip(),r=!0}return{add:function(e){t.push(e),n()},remove:function(){t.pop(),n()}}}(h);return!function e(l,u){let d=0,m=0,p=0,A=0;if(l.nodeType===Node.TEXT_NODE){t.selectNode(l);let e=t.getBoundingClientRect();d=e.left-o.left-.5,m=e.top-o.top-.5,p=e.width,A=e.height,n(u,d,m,l.nodeValue.trim())}else if(l.nodeType===Node.COMMENT_NODE)return;else if(l instanceof HTMLCanvasElement){if("none"===l.style.display)return;h.save();let e=window.devicePixelRatio;h.scale(1/e,1/e),h.drawImage(l,0,0),h.restore()}else{if("none"===l.style.display)return;let e=l.getBoundingClientRect();d=e.left-o.left-.5,m=e.top-o.top-.5,a(d,m,p=e.width,A=e.height,parseFloat((u=window.getComputedStyle(l)).borderRadius));let t=u.backgroundColor;"transparent"!==t&&"rgba(0, 0, 0, 0)"!==t&&(h.fillStyle=t,h.fill());let f=!0,g=null;for(let e of["borderTop","borderLeft","borderBottom","borderRight"]){if(null!==g&&(f=u[e+"Width"]===u[g+"Width"]&&u[e+"Color"]===u[g+"Color"]&&u[e+"Style"]===u[g+"Style"]),!1===f)break;g=e}if(!0===f){let e=parseFloat(u.borderTopWidth);"0px"!==u.borderTopWidth&&"none"!==u.borderTopStyle&&"transparent"!==u.borderTopColor&&"rgba(0, 0, 0, 0)"!==u.borderTopColor&&(h.strokeStyle=u.borderTopColor,h.lineWidth=e,h.stroke())}else s(u,"borderTop",d,m,p,0),s(u,"borderLeft",d,m,0,A),s(u,"borderBottom",d,m+A,p,0),s(u,"borderRight",d+p,m,0,A);if(l instanceof HTMLInputElement){let e=u.accentColor;(void 0===e||"auto"===e)&&(e=u.color),r.set(e);let t=.5>Math.sqrt(.299*r.r**2+.587*r.g**2+.114*r.b**2)?"white":"#111111";if("radio"===l.type&&(a(d,m,p,A,A),h.fillStyle="white",h.strokeStyle=e,h.lineWidth=1,h.fill(),h.stroke(),l.checked&&(a(d+2,m+2,p-4,A-4,A),h.fillStyle=e,h.strokeStyle=t,h.lineWidth=2,h.fill(),h.stroke())),"checkbox"===l.type&&(a(d,m,p,A,2),h.fillStyle=l.checked?e:"white",h.strokeStyle=l.checked?t:e,h.lineWidth=1,h.stroke(),h.fill(),l.checked)){let e=h.textAlign;h.textAlign="center",n({color:t,fontFamily:u.fontFamily,fontSize:A+"px",fontWeight:"bold"},d+p/2,m,"✔"),h.textAlign=e}if("range"===l.type){let[r,n,s]=["min","max","value"].map(e=>parseFloat(l[e])),o=(s-r)/(n-r)*(p-A);a(d,m+A/4,p,A/2,A/4),h.fillStyle=t,h.strokeStyle=e,h.lineWidth=1,h.fill(),h.stroke(),a(d,m+A/4,o+A/2,A/2,A/4),h.fillStyle=e,h.fill(),a(d+o,m,A,A,A/2),h.fillStyle=e,h.fill()}("color"===l.type||"text"===l.type||"number"===l.type)&&(c.add({x:d,y:m,width:p,height:A}),n(u,d+parseInt(u.paddingLeft),m+parseInt(u.paddingTop),l.value),c.remove())}}let f="auto"===u.overflow||"hidden"===u.overflow;f&&c.add({x:d,y:m,width:p,height:A});for(let t=0;t<l.childNodes.length;t++)e(l.childNodes[t],u);f&&c.remove()}(e),l}let hq=new ee.FM8,hZ={type:"",data:hq};class h$ extends ee.ZAu{constructor(e,t){super();let r=this,n=new ee.iMs,a=new ee.yGw,s=e.domElement;function o(e){e.stopPropagation(),hq.x=e.clientX/s.clientWidth*2-1,hq.y=-(e.clientY/s.clientHeight*2)+1,n.setFromCamera(hq,t);let a=n.intersectObjects(r.children,!1);if(a.length>0){let t=a[0],r=t.object,n=t.uv;hZ.type=e.type,hZ.data.set(n.x,1-n.y),r.dispatchEvent(hZ)}}s.addEventListener("pointerdown",o),s.addEventListener("pointerup",o),s.addEventListener("pointermove",o),s.addEventListener("mousedown",o),s.addEventListener("mouseup",o),s.addEventListener("mousemove",o),s.addEventListener("click",o);let l={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function h(e){let t=e.target;a.identity().extractRotation(t.matrixWorld),n.ray.origin.setFromMatrixPosition(t.matrixWorld),n.ray.direction.set(0,0,-1).applyMatrix4(a);let s=n.intersectObjects(r.children,!1);if(s.length>0){let t=s[0],r=t.object,n=t.uv;hZ.type=l[e.type],hZ.data.set(n.x,1-n.y),r.dispatchEvent(hZ)}}let c=e.xr.getController(0);c.addEventListener("move",h),c.addEventListener("select",h),c.addEventListener("selectstart",h),c.addEventListener("selectend",h);let u=e.xr.getController(1);u.addEventListener("move",h),u.addEventListener("select",h),u.addEventListener("selectstart",h),u.addEventListener("selectend",h)}}class h0{constructor(e,t,r){this.element=document.createElement("div"),this.element.classList.add(r),this.element.style.pointerEvents="none",this.renderer=t,this.startPoint=new ee.FM8,this.pointTopLeft=new ee.FM8,this.pointBottomRight=new ee.FM8,this.isDown=!1,this.renderer.domElement.addEventListener("pointerdown",e=>{this.isDown=!0,this.onSelectStart(e)}),this.renderer.domElement.addEventListener("pointermove",e=>{this.isDown&&this.onSelectMove(e)}),this.renderer.domElement.addEventListener("pointerup",e=>{this.isDown=!1,this.onSelectOver(e)})}onSelectStart(e){this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=`${e.clientX}px`,this.element.style.top=`${e.clientY}px`,this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY}onSelectMove(e){this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=`${this.pointTopLeft.x}px`,this.element.style.top=`${this.pointTopLeft.y}px`,this.element.style.width=`${this.pointBottomRight.x-this.pointTopLeft.x}px`,this.element.style.height=`${this.pointBottomRight.y-this.pointTopLeft.y}px`}onSelectOver(){this.element.parentElement.removeChild(this.element)}}let h1=new ee.iWj,h2=new ee.Pa4,h3=new ee.Pa4,h4=new ee.Pa4,h5=new ee.Pa4,h8=new ee.Pa4,h6=new ee.Pa4,h9=new ee.Pa4,h7=new ee.Pa4,ce=new ee.Pa4,ct=new ee.Pa4,ci=new ee.Pa4,cr=new ee.Pa4,cn=new ee.Pa4,ca=new ee.Pa4;class cs{constructor(e,t,r){this.camera=e,this.scene=t,this.startPoint=new ee.Pa4,this.endPoint=new ee.Pa4,this.collection=[],this.deep=r||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(h1,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){h3.copy(e),h3.x=Math.min(e.x,t.x),h3.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),h4.setFromMatrixPosition(this.camera.matrixWorld),h5.copy(h3),h8.set(t.x,h3.y,0),h6.copy(t),h9.set(h3.x,t.y,0),h5.unproject(this.camera),h8.unproject(this.camera),h6.unproject(this.camera),h9.unproject(this.camera),cr.copy(h5).sub(h4),cn.copy(h8).sub(h4),ca.copy(h6).sub(h4),cr.normalize(),cn.normalize(),ca.normalize(),cr.multiplyScalar(this.deep),cn.multiplyScalar(this.deep),ca.multiplyScalar(this.deep),cr.add(h4),cn.add(h4),ca.add(h4);var r=h1.planes;r[0].setFromCoplanarPoints(h4,h5,h8),r[1].setFromCoplanarPoints(h4,h8,h6),r[2].setFromCoplanarPoints(h6,h9,h4),r[3].setFromCoplanarPoints(h9,h5,h4),r[4].setFromCoplanarPoints(h8,h6,h9),r[5].setFromCoplanarPoints(ca,cn,cr),r[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let n=Math.min(e.x,t.x),a=Math.max(e.y,t.y),s=Math.max(e.x,t.x),o=Math.min(e.y,t.y);h5.set(n,a,-1),h8.set(s,a,-1),h6.set(s,o,-1),h9.set(n,o,-1),h7.set(n,a,1),ce.set(s,a,1),ct.set(s,o,1),ci.set(n,o,1),h5.unproject(this.camera),h8.unproject(this.camera),h6.unproject(this.camera),h9.unproject(this.camera),h7.unproject(this.camera),ce.unproject(this.camera),ct.unproject(this.camera),ci.unproject(this.camera);var r=h1.planes;r[0].setFromCoplanarPoints(h5,h7,ce),r[1].setFromCoplanarPoints(h8,ce,ct),r[2].setFromCoplanarPoints(ct,ci,h9),r[3].setFromCoplanarPoints(ci,h7,h5),r[4].setFromCoplanarPoints(h8,h6,h9),r[5].setFromCoplanarPoints(ct,ce,h7),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material&&(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),h2.copy(t.geometry.boundingSphere.center),h2.applyMatrix4(t.matrixWorld),e.containsPoint(h2)&&this.collection.push(t)),t.children.length>0)for(let r=0;r<t.children.length;r++)this.searchChildInFrustum(e,t.children[r])}}async function co(){if("Ammo"in window==!1){console.error("AmmoPhysics: Couldn't find Ammo.js");return}let e=await Ammo(),t=new e.btDefaultCollisionConfiguration,r=new e.btCollisionDispatcher(t),n=new e.btDbvtBroadphase,a=new e.btSequentialImpulseConstraintSolver,s=new e.btDiscreteDynamicsWorld(r,n,a,t);s.setGravity(new e.btVector3(0,-9.8,0));let o=new e.btTransform,l=[],h=new WeakMap,c=0;return setInterval(function(){let e=performance.now();if(c>0){let t=(e-c)/1e3;s.stepSimulation(t,10)}c=e;for(let e=0,t=l.length;e<t;e++){let t=l[e];if(t.isInstancedMesh){let e=t.instanceMatrix.array,r=h.get(t);for(let t=0;t<r.length;t++)r[t].getMotionState().getWorldTransform(o),function(e,t,r,n){let a=t.x(),s=t.y(),o=t.z(),l=t.w(),h=a+a,c=s+s,u=o+o,d=a*h,m=a*c,p=a*u,A=s*c,f=s*u,g=o*u,v=l*h,y=l*c,x=l*u;r[n+0]=1-(A+g),r[n+1]=m+x,r[n+2]=p-y,r[n+3]=0,r[n+4]=m-x,r[n+5]=1-(d+g),r[n+6]=f+v,r[n+7]=0,r[n+8]=p+y,r[n+9]=f-v,r[n+10]=1-(d+A),r[n+11]=0,r[n+12]=e.x(),r[n+13]=e.y(),r[n+14]=e.z(),r[n+15]=1}(o.getOrigin(),o.getRotation(),e,16*t);t.instanceMatrix.needsUpdate=!0}else if(t.isMesh){h.get(t).getMotionState().getWorldTransform(o);let e=o.getOrigin(),r=o.getRotation();t.position.set(e.x(),e.y(),e.z()),t.quaternion.set(r.x(),r.y(),r.z(),r.w())}}},16.666666666666668),{addMesh:function(t,r=0){let n=function(t){let r=t.parameters;if("BoxGeometry"===t.type){let t=void 0!==r.width?r.width/2:.5,n=void 0!==r.height?r.height/2:.5,a=void 0!==r.depth?r.depth/2:.5,s=new e.btBoxShape(new e.btVector3(t,n,a));return s.setMargin(.05),s}if("SphereGeometry"===t.type||"IcosahedronGeometry"===t.type){let t=void 0!==r.radius?r.radius:1,n=new e.btSphereShape(t);return n.setMargin(.05),n}return null}(t.geometry);null!==n&&(t.isInstancedMesh?function(t,r,n){let a=t.instanceMatrix.array,o=[];for(let l=0;l<t.count;l++){let t=16*l,h=new e.btTransform;h.setFromOpenGLMatrix(a.slice(t,t+16));let c=new e.btDefaultMotionState(h),u=new e.btVector3(0,0,0);n.calculateLocalInertia(r,u);let d=new e.btRigidBodyConstructionInfo(r,c,n,u),m=new e.btRigidBody(d);s.addRigidBody(m),o.push(m)}r>0&&(t.instanceMatrix.setUsage(35048),l.push(t),h.set(t,o))}(t,r,n):t.isMesh&&function(t,r,n){let a=t.position,o=t.quaternion,c=new e.btTransform;c.setIdentity(),c.setOrigin(new e.btVector3(a.x,a.y,a.z)),c.setRotation(new e.btQuaternion(o.x,o.y,o.z,o.w));let u=new e.btDefaultMotionState(c),d=new e.btVector3(0,0,0);n.calculateLocalInertia(r,d);let m=new e.btRigidBodyConstructionInfo(r,u,n,d),p=new e.btRigidBody(m);s.addRigidBody(p),r>0&&(l.push(t),h.set(t,p))}(t,r,n))},setMeshPosition:function(t,r,n=0){if(t.isInstancedMesh){let a=h.get(t)[n];a.setAngularVelocity(new e.btVector3(0,0,0)),a.setLinearVelocity(new e.btVector3(0,0,0)),o.setIdentity(),o.setOrigin(new e.btVector3(r.x,r.y,r.z)),a.setWorldTransform(o)}else if(t.isMesh){let n=h.get(t);n.setAngularVelocity(new e.btVector3(0,0,0)),n.setLinearVelocity(new e.btVector3(0,0,0)),o.setIdentity(),o.setOrigin(new e.btVector3(r.x,r.y,r.z)),n.setWorldTransform(o)}}}}class cl{constructor(e){let t=new ee.iKG(-1,1,1,-1,0,1),r=new ee.xsS,n=new ee.u37,a={minFilter:ee.wem,magFilter:ee.TyD,format:ee.wk1},s=new ee.dd2(512,512,a),o=new ee.dd2(512,512,a),l=new ee.jyz({uniforms:{mapLeft:{value:s.texture},mapRight:{value:o.texture}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = vec2( uv.x, uv.y );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:`uniform sampler2D mapLeft;
uniform sampler2D mapRight;
varying vec2 vUv;
void main() {
	vec2 uv = vUv;
	if ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {
		gl_FragColor = texture2D( mapLeft, uv );
	} else {
		gl_FragColor = texture2D( mapRight, uv );
	}
	#include <tonemapping_fragment>
	#include <${parseInt(ee.UZH.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
}`}),h=new ee.Kj0(new ee._12(2,2),l);r.add(h),this.setSize=function(t,r){e.setSize(t,r);let n=e.getPixelRatio();s.setSize(t*n,r*n),o.setSize(t*n,r*n)},this.render=function(a,l){!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),null===l.parent&&!0===l.matrixWorldAutoUpdate&&l.updateMatrixWorld(),n.update(l),e.setRenderTarget(s),e.clear(),e.render(a,n.cameraL),e.setRenderTarget(o),e.clear(),e.render(a,n.cameraR),e.setRenderTarget(null),e.render(r,t)}}}class ch{constructor(e){let t,r,n;let a=this;a.cameraDistance=15,a.reflectFromAbove=!1;let s=new ee.cPb,o=new ee.cPb,l=new ee.cPb,h=new ee.cPb,c=new ee.Pa4,u=new ee._fP,d=new ee.Pa4;e.autoClear=!1,this.setSize=function(a,s){t=a/2,a<s?(r=a/3,n=a/3):(r=s/3,n=s/3),e.setSize(a,s)},this.render=function(m,p){!0===m.matrixWorldAutoUpdate&&m.updateMatrixWorld(),null===p.parent&&!0===p.matrixWorldAutoUpdate&&p.updateMatrixWorld(),p.matrixWorld.decompose(c,u,d),s.position.copy(c),s.quaternion.copy(u),s.translateZ(a.cameraDistance),s.lookAt(m.position),o.position.copy(c),o.quaternion.copy(u),o.translateZ(-a.cameraDistance),o.lookAt(m.position),o.rotation.z+=Math.PI/180*180,l.position.copy(c),l.quaternion.copy(u),l.translateX(-a.cameraDistance),l.lookAt(m.position),l.rotation.x+=Math.PI/180*90,h.position.copy(c),h.quaternion.copy(u),h.translateX(a.cameraDistance),h.lookAt(m.position),h.rotation.x+=Math.PI/180*90,e.clear(),e.setScissorTest(!0),e.setScissor(t-r/2,2*n,r,n),e.setViewport(t-r/2,2*n,r,n),a.reflectFromAbove?e.render(m,o):e.render(m,s),e.setScissor(t-r/2,0,r,n),e.setViewport(t-r/2,0,r,n),a.reflectFromAbove?e.render(m,s):e.render(m,o),e.setScissor(t-r/2-r,n,r,n),e.setViewport(t-r/2-r,n,r,n),a.reflectFromAbove?e.render(m,h):e.render(m,l),e.setScissor(t+r/2,n,r,n),e.setViewport(t+r/2,n,r,n),a.reflectFromAbove?e.render(m,l):e.render(m,h),e.setScissorTest(!1)}}}class cc{constructor(e,t={}){this.enabled=!0;let r=void 0!==t.defaultThickness?t.defaultThickness:.003,n=new ee.Ilk().fromArray(void 0!==t.defaultColor?t.defaultColor:[0,0,0]),a=void 0!==t.defaultAlpha?t.defaultAlpha:1,s=void 0!==t.defaultKeepAlive&&t.defaultKeepAlive,o={},l={},h={},c={outlineThickness:{value:r},outlineColor:{value:n},outlineAlpha:{value:a}},u=`#include <common>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform vec3 outlineColor;
uniform float outlineAlpha;
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( outlineColor, outlineAlpha );
	#include <tonemapping_fragment>
	#include <${parseInt(ee.UZH.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`;function d(e){let t;let r=(void 0===(t=o[e.uuid])&&(t={material:new ee.jyz({type:"OutlineEffect",uniforms:ee.rDY.merge([ee.rBU.fog,ee.rBU.displacementmap,c]),vertexShader:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nuniform float outlineThickness;\nvec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {\n	float thickness = outlineThickness;\n	const float ratio = 1.0;\n	vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );\n	vec4 norm = normalize( pos - pos2 );\n	return pos + norm * thickness * pos.w * ratio;\n}\nvoid main() {\n	#include <uv_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	vec3 outlineNormal = - objectNormal;\n	gl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",fragmentShader:u,side:ee._Li}),used:!0,keepAlive:s,count:0},o[e.uuid]=t),t.used=!0,t.material);return l[r.uuid]=e,function(e,t){if("invisible"===e.name)return;let r=t.userData.outlineParameters;e.fog=t.fog,e.toneMapped=t.toneMapped,e.premultipliedAlpha=t.premultipliedAlpha,e.displacementMap=t.displacementMap,void 0!==r?(!1===t.visible?e.visible=!1:e.visible=void 0===r.visible||r.visible,e.transparent=void 0!==r.alpha&&r.alpha<1||t.transparent,void 0!==r.keepAlive&&(o[t.uuid].keepAlive=r.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible),(!0===t.wireframe||!1===t.depthTest)&&(e.visible=!1),t.clippingPlanes&&(e.clipping=!0,e.clippingPlanes=t.clippingPlanes,e.clipIntersection=t.clipIntersection,e.clipShadows=t.clipShadows),e.version=t.version}(r,e),r}function m(e){let t=e.geometry,r=void 0!==t&&void 0!==t.attributes.normal;return!0===e.isMesh&&void 0!==e.material&&!0===r}function p(e){if(!1!==m(e)){if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t]=d(e.material[t]);else e.material=d(e.material);h[e.uuid]=e.onBeforeRender,e.onBeforeRender=f}}function A(e){if(!1!==m(e)){if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t]=l[e.material[t].uuid];else e.material=l[e.material.uuid];e.onBeforeRender=h[e.uuid]}}function f(e,t,r,n,a){let s=l[a.uuid];void 0!==s&&function(e,t){let r=t.userData.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==r&&(void 0!==r.thickness&&(e.uniforms.outlineThickness.value=r.thickness),void 0!==r.color&&e.uniforms.outlineColor.value.fromArray(r.color),void 0!==r.alpha&&(e.uniforms.outlineAlpha.value=r.alpha)),t.displacementMap&&(e.uniforms.displacementMap.value=t.displacementMap,e.uniforms.displacementScale.value=t.displacementScale,e.uniforms.displacementBias.value=t.displacementBias)}(a,s)}this.render=function(t,r){if(!1===this.enabled){e.render(t,r);return}let n=e.autoClear;e.autoClear=this.autoClear,e.render(t,r),e.autoClear=n,this.renderOutline(t,r)},this.renderOutline=function(t,r){let n=e.autoClear,a=t.matrixWorldAutoUpdate,s=t.background,c=e.shadowMap.enabled;t.matrixWorldAutoUpdate=!1,t.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,t.traverse(p),e.render(t,r),t.traverse(A),function(){let e;e=Object.keys(l);for(let t=0,r=e.length;t<r;t++)l[e[t]]=void 0;e=Object.keys(h);for(let t=0,r=e.length;t<r;t++)h[e[t]]=void 0;e=Object.keys(o);for(let t=0,r=e.length;t<r;t++){let r=e[t];!1===o[r].used?(o[r].count++,!1===o[r].keepAlive&&o[r].count>60&&delete o[r]):(o[r].used=!1,o[r].count=0)}}(),t.matrixWorldAutoUpdate=a,t.background=s,e.autoClear=n,e.shadowMap.enabled=c},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=function(t,r,n){e.clear(t,r,n)},this.getPixelRatio=function(){return e.getPixelRatio()},this.setPixelRatio=function(t){e.setPixelRatio(t)},this.getSize=function(t){return e.getSize(t)},this.setSize=function(t,r,n){e.setSize(t,r,n)},this.setViewport=function(t,r,n,a){e.setViewport(t,r,n,a)},this.setScissor=function(t,r,n,a){e.setScissor(t,r,n,a)},this.setScissorTest=function(t){e.setScissorTest(t)},this.setRenderTarget=function(t){e.setRenderTarget(t)}}}class cu{constructor(e,t=512,r=512){this.colorMatrixLeft=new ee.Vkp().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new ee.Vkp().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);let n=new ee.iKG(-1,1,1,-1,0,1),a=new ee.xsS,s=new ee.u37,o={minFilter:ee.wem,magFilter:ee.TyD,format:ee.wk1},l=new ee.dd2(t,r,o),h=new ee.dd2(t,r,o),c=new ee.jyz({uniforms:{mapLeft:{value:l.texture},mapRight:{value:h.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = vec2( uv.x, uv.y );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:`uniform sampler2D mapLeft;
uniform sampler2D mapRight;
varying vec2 vUv;
uniform mat3 colorMatrixLeft;
uniform mat3 colorMatrixRight;
void main() {
	vec2 uv = vUv;
	vec4 colorL = texture2D( mapLeft, uv );
	vec4 colorR = texture2D( mapRight, uv );
	vec3 color = clamp(
			colorMatrixLeft * colorL.rgb +
			colorMatrixRight * colorR.rgb, 0., 1. );
	gl_FragColor = vec4(
			color.r, color.g, color.b,
			max( colorL.a, colorR.a ) );
	#include <tonemapping_fragment>
	#include <${parseInt(ee.UZH.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
}`}),u=new ee.Kj0(new ee._12(2,2),c);a.add(u),this.setSize=function(t,r){e.setSize(t,r);let n=e.getPixelRatio();l.setSize(t*n,r*n),h.setSize(t*n,r*n)},this.render=function(t,r){let o=e.getRenderTarget();!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===r.parent&&!0===r.matrixWorldAutoUpdate&&r.updateMatrixWorld(),s.update(r),e.setRenderTarget(l),e.clear(),e.render(t,s.cameraL),e.setRenderTarget(h),e.clear(),e.render(t,s.cameraR),e.setRenderTarget(null),e.render(a,n),e.setRenderTarget(o)},this.dispose=function(){l.dispose(),h.dispose(),u.geometry.dispose(),u.material.dispose()}}}class cd{constructor(e,t=" .:-=+*#%@",r={}){let n,a,s,o,l;let h=r.resolution||.15,c=r.scale||1,u=r.color||!1,d=r.alpha||!1,m=r.block||!1,p=r.invert||!1,A=r.strResolution||"low",f=document.createElement("div");f.style.cursor="default";let g=document.createElement("table");f.appendChild(g),this.setSize=function(t,r){n=t,a=r,e.setSize(t,r),function(){s=Math.floor(n*h),o=Math.floor(a*h),x.width=s,x.height=o,(l=e.domElement).style.backgroundColor&&(g.rows[0].cells[0].style.backgroundColor=l.style.backgroundColor,g.rows[0].cells[0].style.color=l.style.color),g.cellSpacing=0,g.cellPadding=0;let t=g.style;t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=I+"px",t.fontFamily=v,t.fontSize=C+"px",t.lineHeight=E+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,r){e.render(t,r),function(e){b.clearRect(0,0,s,o),b.drawImage(y,0,0,s,o);let t=b.getImageData(0,0,s,o).data,r="";for(let e=0;e<o;e+=2){for(let n=0;n<s;n++){let a,o;let l=(e*s+n)*4,h=t[l],c=t[l+1],A=t[l+2],f=t[l+3];o=(.3*h+.59*c+.11*A)/255,0==f&&(o=1),a=Math.floor((1-o)*(w.length-1)),p&&(a=w.length-a-1);let g=w[a];(void 0===g||" "==g)&&(g="&nbsp;"),u?r+="<span style='color:rgb("+h+","+c+","+A+");"+(m?"background-color:rgb("+h+","+c+","+A+");":"")+(d?"opacity:"+f/255+";":"")+"'>"+g+"</span>":r+=g}r+="<br/>"}e.innerHTML=`<tr><td style="display:block;width:${n}px;height:${a}px;overflow:hidden">${r}</td></tr>`}(g)},this.domElement=f;let v="courier new, monospace",y=e.domElement,x=document.createElement("canvas");if(!x.getContext)return;let b=x.getContext("2d");if(!b.getImageData)return;let w=u?" CGO08@".split(""):" .,:;i1tfLCG08@".split("");t&&(w=t);let C=2/h*c,E=2/h*c,I=0;if("low"==A)switch(c){case 1:I=-1;break;case 2:case 3:I=-2.1;break;case 4:I=-3.1;break;case 5:I=-4.15}if("medium"==A)switch(c){case 1:I=0;break;case 2:I=-1;break;case 3:I=-1.04;break;case 4:case 5:I=-2.1}if("high"==A)switch(c){case 1:case 2:I=0;break;case 3:case 4:case 5:I=-1}}}class cm{constructor(e){let t=new ee.u37;t.aspect=.5;let r=new ee.FM8;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,r){e.setSize(t,r)},this.render=function(n,a){!0===n.matrixWorldAutoUpdate&&n.updateMatrixWorld(),null===a.parent&&!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),t.update(a),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}}}function cp(e,t,r){let n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let a=e,s=n,o=Math.floor((a+s)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?s=o:a=o,o=Math.floor((a+s)/2);return o}function cA(e,t,r,n){let a=[],s=[],o=[];a[0]=1;for(let l=1;l<=r;++l){s[l]=t-n[e+1-l],o[l]=n[e+l]-t;let r=0;for(let e=0;e<l;++e){let t=o[e+1],n=s[l-e],h=a[e]/(t+n);a[e]=r+t*h,r=n*h}a[l]=r}return a}function cf(e,t,r,n){let a=cp(e,n,t),s=cA(a,n,e,t),o=new ee.Ltg(0,0,0,0);for(let t=0;t<=e;++t){let n=r[a-e+t],l=s[t],h=n.w*l;o.x+=n.x*h,o.y+=n.y*h,o.z+=n.z*h,o.w+=n.w*l}return o}function cg(e,t,r,n,a){let s=[];for(let e=0;e<=r;++e)s[e]=0;let o=[];for(let e=0;e<=n;++e)o[e]=s.slice(0);let l=[];for(let e=0;e<=r;++e)l[e]=s.slice(0);l[0][0]=1;let h=s.slice(0),c=s.slice(0);for(let n=1;n<=r;++n){h[n]=t-a[e+1-n],c[n]=a[e+n]-t;let r=0;for(let e=0;e<n;++e){let t=c[e+1],a=h[n-e];l[n][e]=t+a;let s=l[e][n-1]/l[n][e];l[e][n]=r+t*s,r=a*s}l[n][n]=r}for(let e=0;e<=r;++e)o[0][e]=l[e][r];for(let e=0;e<=r;++e){let t=0,a=1,h=[];for(let e=0;e<=r;++e)h[e]=s.slice(0);h[0][0]=1;for(let s=1;s<=n;++s){let n=0,c=e-s,u=r-s;e>=s&&(h[a][0]=h[t][0]/l[u+1][c],n=h[a][0]*l[c][u]);let d=c>=-1?1:-c,m=e-1<=u?s-1:r-e;for(let e=d;e<=m;++e)h[a][e]=(h[t][e]-h[t][e-1])/l[u+1][c+e],n+=h[a][e]*l[c+e][u];e<=u&&(h[a][s]=-h[t][s-1]/l[u+1][e],n+=h[a][s]*l[e][u]),o[s][e]=n;let p=t;t=a,a=p}}let u=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)o[e][t]*=u;u*=r-e}return o}function cv(e,t,r,n,a){let s=a<e?a:e,o=[],l=cp(e,n,t),h=cg(l,n,e,s,t),c=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,c[e]=t}for(let t=0;t<=s;++t){let r=c[l-e].clone().multiplyScalar(h[t][0]);for(let n=1;n<=e;++n)r.add(c[l-e+n].clone().multiplyScalar(h[t][n]));o[t]=r}for(let e=s+1;e<=a+1;++e)o[e]=new ee.Ltg(0,0,0);return o}function cy(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}function cx(e){let t=e.length,r=[],n=[];for(let a=0;a<t;++a){let t=e[a];r[a]=new ee.Pa4(t.x,t.y,t.z),n[a]=t.w}let a=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(a[e-r].clone().multiplyScalar(cy(e,r)*n[r]));a[e]=t.divideScalar(n[0])}return a}function cb(e,t,r,n,a){return cx(cv(e,t,r,n,a))}function cw(e,t,r,n,a,s,o,l){let h=cp(e,s,r),c=cp(t,o,n),u=cA(h,s,e,r),d=cA(c,o,t,n),m=[];for(let r=0;r<=t;++r){m[r]=new ee.Ltg(0,0,0,0);for(let n=0;n<=e;++n){let s=a[h-e+n][c-t+r].clone(),o=s.w;s.x*=o,s.y*=o,s.z*=o,m[r].add(s.multiplyScalar(u[n]))}}let p=new ee.Ltg(0,0,0,0);for(let e=0;e<=t;++e)p.add(m[e].multiplyScalar(d[e]));p.divideScalar(p.w),l.set(p.x,p.y,p.z)}class cC extends ee.Hyl{constructor(e,t,r,n,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=a||this.knots.length-1;for(let e=0;e<r.length;++e){let t=r[e];this.controlPoints[e]=new ee.Ltg(t.x,t.y,t.z,t.w)}}getPoint(e,t){let r=t||new ee.Pa4,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=cf(this.degree,this.knots,this.controlPoints,n);return 1!=a.w&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t){let r=t||new ee.Pa4,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=cb(this.degree,this.knots,this.controlPoints,n,1);return r.copy(a[1]).normalize(),r}}var cE=r(9609);class cI extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=""===a.path?ee.Zp0.extractUrlBase(e):a.path,o=new ee.hH6(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(r){try{t(a.parse(r,s))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===cH(e,0,t.length)}(e))u=new cF().parse(e);else{let t=cH(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(let n=0;n<t.length;++n)if(function(t){let n=e[0];return e=e.slice(r+1),r++,n}(0)===t[n])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>cD(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+cD(t));u=new cT().parse(t)}return new cM(new ee.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(u)}}class cM{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){d=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),a=new cB().parse(n);return this.parseScene(n,a,r),m}parseConnections(){let e=new Map;return"Connections"in u&&u.Connections.connections.forEach(function(t){let r=t[0],n=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).parents.push({ID:n,relationship:a}),e.has(n)||e.set(n,{parents:[],children:[]}),e.get(n).children.push({ID:r,relationship:a})}),e}parseImages(){let e={},t={};if("Video"in u.Objects){let r=u.Objects.Video;for(let n in r){let a=r[n];if(e[parseInt(n)]=a.RelativeFilename||a.Filename,"Content"in a){let e=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(e||s){let e=this.parseImage(r[n]);t[a.RelativeFilename||a.Filename]=e}}}}for(let r in e){let n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t;let r=e.Content,n=e.RelativeFilename||e.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+a+'" is not supported.');return}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in u.Objects){let r=u.Objects.Texture;for(let n in r){let a=this.parseTexture(r[n],e);t.set(parseInt(n),a)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let n=e.WrapModeU,a=e.WrapModeV,s=void 0!==n?n.value:0,o=void 0!==a?a.value:0;if(r.wrapS=0===s?ee.rpg:ee.uWy,r.wrapT=0===o?ee.rpg:ee.uWy,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,t){let r,n;let a=this.textureLoader.path,s=d.get(e.id).children;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(0===(r=t[s[0].ID]).indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0);let o=e.FileName.slice(-3).toLowerCase();if("tga"===o){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),n=new ee.xEZ):(t.setPath(this.textureLoader.path),n=t.load(r))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),n=new ee.xEZ):n=this.textureLoader.load(r);return this.textureLoader.setPath(a),n}parseMaterials(e){let t=new Map;if("Material"in u.Objects){let r=u.Objects.Material;for(let n in r){let a=this.parseMaterial(r[n],e);null!==a&&t.set(parseInt(n),a)}}return t}parseMaterial(e,t){let r;let n=e.id,a=e.attrName,s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!d.has(n))return null;let o=this.parseParameters(e,t,n);switch(s.toLowerCase()){case"phong":r=new ee.xoR;break;case"lambert":r=new ee.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),r=new ee.xoR}return r.setValues(o),r.name=a,r}parseParameters(e,t,r){let n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new ee.Ilk().fromArray(e.Diffuse.value):e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(n.color=new ee.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new ee.Ilk().fromArray(e.Emissive.value):e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(n.emissive=new ee.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new ee.Ilk().fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=new ee.Ilk().fromArray(e.SpecularColor.value));let a=this;return d.get(r).children.forEach(function(e){let r=e.relationship;switch(r){case"Bump":n.bumpMap=a.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=a.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=a.getTexture(t,e.ID),void 0!==n.map&&("colorSpace"in n.map?n.map.colorSpace="srgb":n.map.encoding=3001);break;case"DisplacementColor":n.displacementMap=a.getTexture(t,e.ID);break;case"EmissiveColor":n.emissiveMap=a.getTexture(t,e.ID),void 0!==n.emissiveMap&&("colorSpace"in n.emissiveMap?n.emissiveMap.colorSpace="srgb":n.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=a.getTexture(t,e.ID);break;case"ReflectionColor":n.envMap=a.getTexture(t,e.ID),void 0!==n.envMap&&(n.envMap.mapping=ee.dSO,"colorSpace"in n.envMap?n.envMap.colorSpace="srgb":n.envMap.encoding=3001);break;case"SpecularColor":n.specularMap=a.getTexture(t,e.ID),void 0!==n.specularMap&&("colorSpace"in n.specularMap?n.specularMap.colorSpace="srgb":n.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=a.getTexture(t,e.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),n}getTexture(e,t){return"LayeredTexture"in u.Objects&&t in u.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=d.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in u.Objects){let r=u.Objects.Deformer;for(let n in r){let a=r[n],s=d.get(parseInt(n));if("Skin"===a.attrType){let t=this.parseSkeleton(s,r);t.ID=n,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[n]=t}else if("BlendShape"===a.attrType){let e={id:n};e.rawTargets=this.parseMorphTargets(s,r),e.id=n,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach(function(e){let n=t[e.ID];if("Cluster"!==n.attrType)return;let a={ID:e.ID,indices:[],weights:[],transformLink:new ee.yGw().fromArray(n.TransformLink.a)};"Indexes"in n&&(a.indices=n.Indexes.a,a.weights=n.Weights.a),r.push(a)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let n=0;n<e.children.length;n++){let a=e.children[n],s=t[a.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=d.get(parseInt(a.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(o)}return r}parseScene(e,t,r){m=new ee.ZAu;let n=this.parseModels(e.skeletons,t,r),a=u.Objects.Model,s=this;n.forEach(function(e){let t=a[e.ID];s.setLookAtProperties(e,t),d.get(e.ID).parents.forEach(function(t){let r=n.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&m.add(e)}),this.bindSkeleton(e.skeletons,t,n),this.createAmbientLight(),m.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=cQ(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let o=new cS().parse();1===m.children.length&&m.children[0].isGroup&&(m.children[0].animations=o,m=m.children[0]),m.animations=o}parseModels(e,t,r){let n=new Map,a=u.Objects.Model;for(let s in a){let o=parseInt(s),l=a[s],h=d.get(o),c=this.buildSkeleton(h,e,o,l.attrName);if(!c){switch(l.attrType){case"Camera":c=this.createCamera(h);break;case"Light":c=this.createLight(h);break;case"Mesh":c=this.createMesh(h,t,r);break;case"NurbsCurve":c=this.createCurve(h,t);break;case"LimbNode":case"Root":c=new ee.N$j;break;default:c=new ee.ZAu}c.name=l.attrName?ee.iUV.sanitizeNodeName(l.attrName):"",c.ID=o}this.getTransformData(c,l),n.set(o,c)}return n}buildSkeleton(e,t,r,n){let a=null;return e.parents.forEach(function(e){for(let s in t){let o=t[s];o.rawBones.forEach(function(t,s){if(t.ID===e.ID){let e=a;(a=new ee.N$j).matrixWorld.copy(t.transformLink),a.name=n?ee.iUV.sanitizeNodeName(n):"",a.ID=r,o.bones[s]=a,null!==e&&a.add(e)}})}}),a}createCamera(e){let t,r;if(e.children.forEach(function(e){let t=u.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new ee.Tme;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let n=1;void 0!==r.NearPlane&&(n=r.NearPlane.value/1e3);let a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);let s=window.innerWidth,o=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(s=r.AspectWidth.value,o=r.AspectHeight.value);let l=s/o,h=45;void 0!==r.FieldOfView&&(h=r.FieldOfView.value);let c=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new ee.cPb(h,l,n,a),null!==c&&t.setFocalLength(c);break;case 1:t=new ee.iKG(-s/2,s/2,o/2,-o/2,n,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new ee.Tme}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){let t=u.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new ee.Tme;else{let e;e=void 0===r.LightType?0:r.LightType.value;let n=16777215;void 0!==r.Color&&(n=new ee.Ilk().fromArray(r.Color.value));let a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);let s=0;switch(void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new ee.cek(n,a,s,1);break;case 1:t=new ee.Ox3(n,a);break;case 2:let o=Math.PI/3;void 0!==r.InnerAngle&&(o=ee.M8C.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=Math.max(l=ee.M8C.degToRad(r.OuterAngle.value),1)),t=new ee.PMe(n,a,s,o,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new ee.cek(n,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let n;let a=null,s=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(a=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?s=o:o.length>0?s=o[0]:(s=new ee.xoR({color:13421772}),o.push(s)),"color"in a.attributes&&o.forEach(function(e){e.vertexColors=!0}),a.FBX_Deformer?(n=new ee.TUv(a,s)).normalizeSkinWeights():n=new ee.Kj0(a,s),n}createCurve(e,t){let r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new ee.nls({color:3342591,linewidth:1});return new ee.x12(r,n)}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?r.eulerOrder=cO(t.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&d.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let r=u.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),m.add(e.target)):e.lookAt(new ee.Pa4().fromArray(t))}}})}bindSkeleton(e,t,r){let n=this.parsePoseNodes();for(let a in e){let s=e[a];d.get(parseInt(s.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;d.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new ee.OdW(s.bones),n[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in u.Objects){let t=u.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let n=t[r].PoseNode;Array.isArray(n)?n.forEach(function(t){e[t.Node]=new ee.yGw().fromArray(t.Matrix.a)}):e[n.Node]=new ee.yGw().fromArray(n.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in u&&"AmbientColor"in u.GlobalSettings){let e=u.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],n=e[2];if(0!==t||0!==r||0!==n){let e=new ee.Ilk(t,r,n);m.add(new ee.Mig(e,1))}}}}class cB{parse(e){let t=new Map;if("Geometry"in u.Objects){let r=u.Objects.Geometry;for(let n in r){let a=d.get(parseInt(n)),s=this.parseGeometry(a,r[n],e);t.set(parseInt(n),s)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let n=r.skeletons,a=[],s=e.parents.map(function(e){return u.Objects.Model[e.ID]});if(0===s.length)return;let o=e.children.reduce(function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&a.push(r.morphTargets[e.ID])});let l=s[0],h={};"RotationOrder"in l&&(h.eulerOrder=cO(l.RotationOrder.value)),"InheritType"in l&&(h.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(h.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(h.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(h.scale=l.GeometricScaling.value);let c=cQ(h);return this.genGeometry(t,o,a,c)}genGeometry(e,t,r,n){let a=new ee.u9r;e.attrName&&(a.name=e.attrName);let s=this.parseGeoNode(e,t),o=this.genBuffers(s),l=new ee.a$l(o.vertex,3);if(l.applyMatrix4(n),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new ee.a$l(o.colors,3)),t&&(a.setAttribute("skinIndex",new ee.qlB(o.weightsIndices,4)),a.setAttribute("skinWeight",new ee.a$l(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){let e=new ee.Vkp().getNormalMatrix(n),t=new ee.a$l(o.normal,3);t.applyNormalMatrix(e),a.setAttribute("normal",t)}if(o.uvs.forEach(function(e,t){"uv2"===eW.i&&t++;let r=0===t?"uv":`uv${t}`;a.setAttribute(r,new ee.a$l(o.uvs[t],2))}),s.material&&"AllSame"!==s.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach(function(r,n){r!==e&&(a.addGroup(t,n-t,e),e=r,t=n)}),a.groups.length>0){let t=a.groups[a.groups.length-1],r=t.start+t.count;r!==o.materialIndex.length&&a.addGroup(r,o.materialIndex.length-r,e)}0===a.groups.length&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,r,n),a}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,a){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[a]})})})),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,a=!1,s=[],o=[],l=[],h=[],c=[],u=[],d=this;return e.vertexIndices.forEach(function(m,p){let A;let f=!1;m<0&&(m^=-1,f=!0);let g=[],v=[];if(s.push(3*m,3*m+1,3*m+2),e.color){let t=cN(p,r,m,e.color);l.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[m]&&e.weightTable[m].forEach(function(e){v.push(e.weight),g.push(e.id)}),v.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);let e=[0,0,0,0],t=[0,0,0,0];v.forEach(function(r,n){let a=r,s=g[n];t.forEach(function(t,r,n){if(a>t){n[r]=a,a=t;let o=e[r];e[r]=s,s=o}})}),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(g[e])}if(e.normal){let t=cN(p,r,m,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(A=cN(p,r,m,e.material)[0]),e.uv&&e.uv.forEach(function(e,t){let n=cN(p,r,m,e);void 0===h[t]&&(h[t]=[]),h[t].push(n[0]),h[t].push(n[1])}),n++,f&&(d.genFace(t,e,s,A,o,l,h,c,u,n),r++,n=0,s=[],o=[],l=[],h=[],c=[],u=[])}),t}genFace(e,t,r,n,a,s,o,l,h,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[(u-1)*3]]),e.vertex.push(t.vertexPositions[r[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[r[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(u-1)*4]),e.vertexWeights.push(l[(u-1)*4+1]),e.vertexWeights.push(l[(u-1)*4+2]),e.vertexWeights.push(l[(u-1)*4+3]),e.vertexWeights.push(l[4*u]),e.vertexWeights.push(l[4*u+1]),e.vertexWeights.push(l[4*u+2]),e.vertexWeights.push(l[4*u+3]),e.weightsIndices.push(h[0]),e.weightsIndices.push(h[1]),e.weightsIndices.push(h[2]),e.weightsIndices.push(h[3]),e.weightsIndices.push(h[(u-1)*4]),e.weightsIndices.push(h[(u-1)*4+1]),e.weightsIndices.push(h[(u-1)*4+2]),e.weightsIndices.push(h[(u-1)*4+3]),e.weightsIndices.push(h[4*u]),e.weightsIndices.push(h[4*u+1]),e.weightsIndices.push(h[4*u+2]),e.weightsIndices.push(h[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(u-1)*3]),e.colors.push(s[(u-1)*3+1]),e.colors.push(s[(u-1)*3+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[(u-1)*3]),e.normal.push(a[(u-1)*3+1]),e.normal.push(a[(u-1)*3+2]),e.normal.push(a[3*u]),e.normal.push(a[3*u+1]),e.normal.push(a[3*u+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][(u-1)*2]),e.uvs[r].push(o[r][(u-1)*2+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])})}addMorphTargets(e,t,r,n){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let a=this;r.forEach(function(r){r.rawTargets.forEach(function(r){let s=u.Objects.Geometry[r.geoID];void 0!==s&&a.genMorphGeometry(e,t,s,n,r.name)})})}genMorphGeometry(e,t,r,n,a){let s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],h=new Float32Array(3*e.attributes.position.count);for(let e=0;e<l.length;e++){let t=3*l[e];h[t]=o[3*e],h[t+1]=o[3*e+1],h[t+2]=o[3*e+2]}let c=this.genBuffers({vertexIndices:s,vertexPositions:h}),u=new ee.a$l(c.vertex,3);u.name=a||r.attrName,u.applyMatrix4(n),e.morphAttributes.position.push(u)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,a=[];return"IndexToDirect"===r&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,a=[];return"IndexToDirect"===r&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,a=[];return"IndexToDirect"===r&&(a=e.ColorIndex.a),{dataSize:4,buffer:n,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let n=e.Materials.a,a=[];for(let e=0;e<n.length;++e)a.push(e);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t,r;if(void 0===cC)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new ee.u9r;let n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ee.u9r;let a=n-1,s=e.KnotVector.a,o=[],l=e.Points.a;for(let e=0,t=l.length;e<t;e+=4)o.push(new ee.Ltg().fromArray(l,e));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){t=a,r=s.length-1-t;for(let e=0;e<a;++e)o.push(o[e])}let h=new cC(a,s,o,t,r).getPoints(12*o.length);return new ee.u9r().setFromPoints(h)}}class cS{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let n=t[r],a=this.addClip(n);e.push(a)}return e}parseClips(){if(void 0===u.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=u.Objects.AnimationCurveNode,t=new Map;for(let r in e){let n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){let e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=u.Objects.AnimationCurve;for(let r in t){let n={id:t[r].id,times:t[r].KeyTime.a.map(cR),values:t[r].KeyValueFloat.a},a=d.get(n.id);if(void 0!==a){let t=a.parents[0].ID,r=a.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){let t=u.Objects.AnimationLayer,r=new Map;for(let n in t){let t=[],a=d.get(parseInt(n));void 0!==a&&(a.children.forEach(function(r,n){if(e.has(r.ID)){let a=e.get(r.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===t[n]){let e=d.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let a=u.Objects.Model[e.toString()];if(void 0===a){console.warn("THREE.FBXLoader: Encountered a unused curve.",r);return}let s={modelName:a.attrName?ee.iUV.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};m.traverse(function(e){e.ID===a.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))}),s.transform||(s.transform=new ee.yGw),"PreRotation"in a&&(s.preRotation=a.PreRotation.value),"PostRotation"in a&&(s.postRotation=a.PostRotation.value),t[n]=s}}t[n]&&(t[n][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===t[n]){let e=d.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,a=d.get(e).parents[0].ID,s=d.get(a).parents[0].ID,o=d.get(s).parents[0].ID,l=u.Objects.Model[o],h={modelName:l.attrName?ee.iUV.sanitizeNodeName(l.attrName):"",morphName:u.Objects.Deformer[e].attrName};t[n]=h}t[n][a.attr]=a}}}),r.set(parseInt(n),t))}return r}parseAnimStacks(e){let t=u.Objects.AnimationStack,r={};for(let n in t){let a=d.get(parseInt(n)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let s=e.get(a[0].ID);r[n]={name:t[n].attrName,layer:s}}return r}addClip(e){let t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new ee.m7l(e.name,-1,t)}generateTracks(e){let t=[],r=new ee.Pa4,n=new ee._fP,a=new ee.Pa4;if(e.transform&&e.transform.decompose(r,n,a),r=r.toArray(),n=new ee.USm().setFromQuaternion(n,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,n){let a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,r);return new ee.yC1(e+"."+n,a,s)}generateRotationTrack(e,t,r,n,a,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ee.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ee.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ee.M8C.degToRad));let o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(ee.M8C.degToRad)).push(s),n=new ee.USm().fromArray(n),n=new ee._fP().setFromEuler(n)),void 0!==a&&((a=a.map(ee.M8C.degToRad)).push(s),a=new ee.USm().fromArray(a),a=new ee._fP().setFromEuler(a).invert());let h=new ee._fP,c=new ee.USm,u=[];for(let e=0;e<l.length;e+=3)c.set(l[e],l[e+1],l[e+2],s),h.setFromEuler(c),void 0!==n&&h.premultiply(n),void 0!==a&&h.multiply(a),h.toArray(u,e/3*4);return new ee.iLg(e+".quaternion",o,u)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),n=m.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ee.dUE(e.modelName+".morphTargetInfluences["+n+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){let a=t[n];a!==r&&(t[e]=a,r=a,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let n=[],a=-1,s=-1,o=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==a){let e=t.x.values[a];n.push(e),r[0]=e}else n.push(r[0]);if(-1!==s){let e=t.y.values[s];n.push(e),r[1]=e}else n.push(r[1]);if(-1!==o){let e=t.z.values[o];n.push(e),r[2]=e}else n.push(r[2])}),n}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let r=e.values[t-1],n=e.values[t]-r,a=Math.abs(n);if(a>=180){let s=a/180,o=n/s,l=r+o,h=e.times[t-1],c=(e.times[t]-h)/s,u=h+c,d=[],m=[];for(;u<e.times[t];)d.push(u),u+=c,m.push(l),l+=o;e.times=cz(e.times,t,d),e.values=cz(e.values,t,m)}}}}class cT{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new c_,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,n){let a=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(a||s)return;let o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),l=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):l?t.parseNodeProperty(e,l,r[++n]):h?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:r},s=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,a):r in o?("PoseNode"===r?o.PoseNode.push(a):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==s.id&&(o[r][s.id]=a)):"number"==typeof s.id?(o[r]={},o[r][s.id]=a):"Properties70"!==r&&("PoseNode"===r?o[r]=[a]:o[r]=a),"number"==typeof s.id&&(a.id=s.id),""!==s.name&&(a.attrName=s.name),""!==s.type&&(a.attrType=s.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());let s=this.getCurrentNode();if("Properties70"===s.name){this.parseNodeSpecialProperty(e,n,a);return}if("C"===n){let e=a.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),o=a.split(",").slice(3);o=o.map(function(e){return e.trim().replace(/^"/,"")}),n="connections",function(e,t){for(let r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}(a=[t,r],o),void 0===s[n]&&(s[n]=[])}"Node"===n&&(s.id=a),n in s&&Array.isArray(s[n])?s[n].push(a):"a"!==n?s[n]=a:s.a=a,this.setCurrentProp(s,n),"a"===n&&","!==a.slice(-1)&&(s.a=cG(a))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=cG(t.a))}parseNodeSpecialProperty(e,t,r){let n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=n[0],s=n[1],o=n[2],l=n[3],h=n[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=cG(h)}this.getPrevNode()[a]={type:s,type2:o,flag:l,value:h},this.setCurrentProp(this.getPrevNode(),a)}}class cF{parse(e){let t=new cP(e);t.skip(23);let r=t.getUint32();if(r<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let n=new c_;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},n=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let s=e.getUint8(),o=e.getString(s);if(0===n)return null;let l=[];for(let t=0;t<a;t++)l.push(this.parseProperty(e));let h=l.length>0?l[0]:"",c=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(r.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){let n=this.parseNode(e,t);null!==n&&this.parseSubNode(o,r,n)}return r.propertyList=l,"number"==typeof h&&(r.id=h),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e,n=r.propertyList[0],a=r.propertyList[1],s=r.propertyList[2],o=r.propertyList[3];0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),e="Color"===a||"ColorRGB"===a||"Vector"===a||"Vector3D"===a||0===a.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[n]={type:a,type2:s,flag:o,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t;let r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let n=e.getUint32(),a=e.getUint32(),s=e.getUint32();if(0===a)switch(r){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}let o=new cP(i0(new Uint8Array(e.getArrayBuffer(s))).buffer);switch(r){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}default:throw Error("THREE.FBXLoader: Unknown property type "+r)}}}class cP{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t)?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();let r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),(0,cE.r)(new Uint8Array(t))}}class c_{add(e,t){this[e]=t}}function cD(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function cR(e){return e/46186158e3}let cL=[];function cN(e,t,r,n){let a;switch(n.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=r;break;case"AllSame":a=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(a=n.indices[a]);let s=a*n.dataSize,o=s+n.dataSize;return function(e,t,r,n){for(let a=r,s=0;a<n;a++,s++)e[s]=t[a];return e}(cL,n.buffer,s,o)}let ck=new ee.USm,cU=new ee.Pa4;function cQ(e){let t=new ee.yGw,r=new ee.yGw,n=new ee.yGw,a=new ee.yGw,s=new ee.yGw,o=new ee.yGw,l=new ee.yGw,h=new ee.yGw,c=new ee.yGw,u=new ee.yGw,d=new ee.yGw,m=new ee.yGw,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(cU.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(ee.M8C.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(ck.fromArray(t))}if(e.rotation){let t=e.rotation.map(ee.M8C.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(ck.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(ee.M8C.degToRad);t.push(e.eulerOrder),a.makeRotationFromEuler(ck.fromArray(t)),a.invert()}e.scale&&s.scale(cU.fromArray(e.scale)),e.scalingOffset&&l.setPosition(cU.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(cU.fromArray(e.scalingPivot)),e.rotationOffset&&h.setPosition(cU.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(cU.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),u.copy(e.parentMatrixWorld));let A=r.clone().multiply(n).multiply(a),f=new ee.yGw;f.extractRotation(u);let g=new ee.yGw;g.copyPosition(u);let v=g.clone().invert().multiply(u),y=f.clone().invert().multiply(v),x=new ee.yGw;if(0===p)x.copy(f).multiply(A).multiply(y).multiply(s);else if(1===p)x.copy(f).multiply(y).multiply(A).multiply(s);else{let e=new ee.yGw().scale(new ee.Pa4().setFromMatrixScale(d)).clone().invert(),t=y.clone().multiply(e);x.copy(f).multiply(A).multiply(t).multiply(s)}let b=c.clone().invert(),w=o.clone().invert(),C=t.clone().multiply(h).multiply(c).multiply(r).multiply(n).multiply(a).multiply(b).multiply(l).multiply(o).multiply(s).multiply(w),E=new ee.yGw().copyPosition(C),I=u.clone().multiply(E);return m.copyPosition(I),(C=m.clone().multiply(x)).premultiply(u.invert()),C}function cO(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function cG(e){return e.split(",").map(function(e){return parseFloat(e)})}function cH(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),(0,cE.r)(new Uint8Array(e,t,r))}function cz(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}var cV=Object.defineProperty,cj=(e,t,r)=>t in e?cV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cW=(e,t,r)=>(cj(e,"symbol"!=typeof t?t+"":t,r),r);class cX extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=new ee.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,e=>{if("string"!=typeof e)throw Error("unsupported data type");let r=JSON.parse(e),n=this.parse(r);t&&t(n)},r,n)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new cY(e)}}class cY{constructor(e){cW(this,"data"),this.data=e}generateShapes(e,t=100,r){let n=[],a={letterSpacing:0,lineHeight:1,...r},s=function(e,t,r,n){let a=Array.from(e),s=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*s,l=[],h=0,c=0;for(let e=0;e<a.length;e++){let t=a[e];if("\n"===t)h=0,c-=o*n.lineHeight;else{let e=function(e,t,r,n,a){let s,o,l,h,c,u,d,m;let p=a.glyphs[e]||a.glyphs["?"];if(!p){console.error('THREE.Font: character "'+e+'" does not exists in font family '+a.familyName+".");return}let A=new ee.T_1;if(p.o){let e=p._cachedOutline||(p._cachedOutline=p.o.split(" "));for(let a=0,p=e.length;a<p;)switch(e[a++]){case"m":s=parseInt(e[a++])*t+r,o=parseInt(e[a++])*t+n,A.moveTo(s,o);break;case"l":s=parseInt(e[a++])*t+r,o=parseInt(e[a++])*t+n,A.lineTo(s,o);break;case"q":l=parseInt(e[a++])*t+r,h=parseInt(e[a++])*t+n,c=parseInt(e[a++])*t+r,u=parseInt(e[a++])*t+n,A.quadraticCurveTo(c,u,l,h);break;case"b":l=parseInt(e[a++])*t+r,h=parseInt(e[a++])*t+n,c=parseInt(e[a++])*t+r,u=parseInt(e[a++])*t+n,d=parseInt(e[a++])*t+r,m=parseInt(e[a++])*t+n,A.bezierCurveTo(c,u,d,m,l,h)}}return{offsetX:p.ha*t,path:A}}(t,s,h,c,r);e&&(h+=e.offsetX+n.letterSpacing,l.push(e.path))}}return l}(e,t,this.data,a);for(let e=0,t=s.length;e<t;e++)Array.prototype.push.apply(n,s[e].toShapes(!1));return n}}cW(cY,"isFont"),cW(cY,"type");class cK extends ee.yxD{constructor(e){super(e)}parse(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let t=0,r=new Uint8Array(e),n={id_length:r[t++],colormap_type:r[t++],image_type:r[t++],colormap_index:r[t++]|r[t++]<<8,colormap_length:r[t++]|r[t++]<<8,colormap_size:r[t++],origin:[r[t++]|r[t++]<<8,r[t++]|r[t++]<<8],width:r[t++]|r[t++]<<8,height:r[t++]|r[t++]<<8,pixel_size:r[t++],flags:r[t++]};!function(e){switch(e.image_type){case 1:case 9:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(n),n.id_length+t>e.length&&console.error("THREE.TGALoader: No data."),t+=n.id_length;let a=!1,s=!1,o=!1;switch(n.image_type){case 9:a=!0,s=!0;break;case 1:s=!0;break;case 10:a=!0;break;case 2:break;case 11:a=!0,o=!0;break;case 3:o=!0}let l=new Uint8Array(n.width*n.height*4),h=function(e,t,r,n,a){let s,o;let l=r.pixel_size>>3,h=r.width*r.height*l;if(t&&(o=a.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;s=new Uint8Array(h);let o=0,c=new Uint8Array(l);for(;o<h;)if(t=(127&(e=a[n++]))+1,128&e){for(r=0;r<l;++r)c[r]=a[n++];for(r=0;r<t;++r)s.set(c,o+r*l);o+=l*t}else{for(t*=l,r=0;r<t;++r)s[o+r]=a[n++];o+=t}}else s=a.subarray(n,n+=t?r.width*r.height:h);return{pixel_data:s,palettes:o}}(a,s,n,t,r);return!function(e,t,r,a,s){let l,h,c,u,d,m;switch((48&n.flags)>>4){default:case 2:l=0,c=1,d=t,h=0,u=1,m=r;break;case 0:l=0,c=1,d=t,h=r-1,u=-1,m=-1;break;case 3:l=t-1,c=-1,d=-1,h=0,u=1,m=r;break;case 1:l=t-1,c=-1,d=-1,h=r-1,u=-1,m=-1}if(o)switch(n.pixel_size){case 8:!function(e,t,r,a,s,o,l,h){let c,u=0,d,m,p=n.width;for(m=t;m!==a;m+=r)for(d=s;d!==l;d+=o,u++)c=h[u],e[(d+p*m)*4+0]=c,e[(d+p*m)*4+1]=c,e[(d+p*m)*4+2]=c,e[(d+p*m)*4+3]=255}(e,h,u,m,l,c,d,a);break;case 16:!function(e,t,r,a,s,o,l,h){let c=0,u,d,m=n.width;for(d=t;d!==a;d+=r)for(u=s;u!==l;u+=o,c+=2)e[(u+m*d)*4+0]=h[c+0],e[(u+m*d)*4+1]=h[c+0],e[(u+m*d)*4+2]=h[c+0],e[(u+m*d)*4+3]=h[c+1]}(e,h,u,m,l,c,d,a);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(n.pixel_size){case 8:!function(e,t,r,a,s,o,l,h,c){let u,d=0,m,p,A=n.width;for(p=t;p!==a;p+=r)for(m=s;m!==l;m+=o,d++)u=h[d],e[(m+A*p)*4+3]=255,e[(m+A*p)*4+2]=c[3*u+0],e[(m+A*p)*4+1]=c[3*u+1],e[(m+A*p)*4+0]=c[3*u+2]}(e,h,u,m,l,c,d,a,s);break;case 16:!function(e,t,r,a,s,o,l,h){let c,u=0,d,m,p=n.width;for(m=t;m!==a;m+=r)for(d=s;d!==l;d+=o,u+=2)c=h[u+0]+(h[u+1]<<8),e[(d+p*m)*4+0]=(31744&c)>>7,e[(d+p*m)*4+1]=(992&c)>>2,e[(d+p*m)*4+2]=(31&c)>>3,e[(d+p*m)*4+3]=32768&c?0:255}(e,h,u,m,l,c,d,a);break;case 24:!function(e,t,r,a,s,o,l,h){let c=0,u,d,m=n.width;for(d=t;d!==a;d+=r)for(u=s;u!==l;u+=o,c+=3)e[(u+m*d)*4+3]=255,e[(u+m*d)*4+2]=h[c+0],e[(u+m*d)*4+1]=h[c+1],e[(u+m*d)*4+0]=h[c+2]}(e,h,u,m,l,c,d,a);break;case 32:!function(e,t,r,a,s,o,l,h){let c=0,u,d,m=n.width;for(d=t;d!==a;d+=r)for(u=s;u!==l;u+=o,c+=4)e[(u+m*d)*4+2]=h[c+0],e[(u+m*d)*4+1]=h[c+1],e[(u+m*d)*4+0]=h[c+2],e[(u+m*d)*4+3]=h[c+3]}(e,h,u,m,l,c,d,a);break;default:console.error("THREE.TGALoader: Format not supported.")}}(l,n.width,n.height,h.pixel_data,h.palettes),{data:l,width:n.width,height:n.height,flipY:!0,generateMipmaps:!0,minFilter:ee.D1R}}}class cJ extends ee.xEZ{constructor(e=null,t=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:n},this.magFilter=ee.TyD,this.minFilter=ee.TyD,this.wrapR=ee.uWy,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class cq extends ee.aNw{load(e,t,r,n){let a=new ee.hH6(this.manager);a.setPath(this.path),a.setResponseType("text"),a.load(e,r=>{try{t(this.parse(r))}catch(t){n?n(t):console.error(t),this.manager.itemError(e)}},r,n)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,r=null,n=new ee.Pa4(0,0,0),a=new ee.Pa4(1,1,1),s=e.split(/[\n\r]+/g),o=null,l=0;for(let e=0,h=s.length;e<h;e++){let h=s[e].trim(),c=h.split(/\s/g);switch(c[0]){case"TITLE":t=h.substring(7,h.length-1);break;case"LUT_3D_SIZE":o=new Uint8Array((r=parseFloat(c[1]))*r*r*4);break;case"DOMAIN_MIN":n.x=parseFloat(c[1]),n.y=parseFloat(c[2]),n.z=parseFloat(c[3]);break;case"DOMAIN_MAX":a.x=parseFloat(c[1]),a.y=parseFloat(c[2]),a.z=parseFloat(c[3]);break;default:let u=parseFloat(c[0]),d=parseFloat(c[1]),m=parseFloat(c[2]);if(u>1||u<0||d>1||d<0||m>1||m<0)throw Error("LUTCubeLoader : Non normalized values not supported.");o[l+0]=255*u,o[l+1]=255*d,o[l+2]=255*m,o[l+3]=255,l+=4}}let h=new ee.IEO;h.image.data=o,h.image.width=r,h.image.height=r*r,h.type=ee.ywz,h.magFilter=ee.wem,h.minFilter=ee.wem,h.wrapS=ee.uWy,h.wrapT=ee.uWy,h.generateMipmaps=!1,h.needsUpdate=!0;let c=new cJ;return c.image.data=o,c.image.width=r,c.image.height=r,c.image.depth=r,c.type=ee.ywz,c.magFilter=ee.wem,c.minFilter=ee.wem,c.wrapS=ee.uWy,c.wrapT=ee.uWy,c.wrapR=ee.uWy,c.generateMipmaps=!1,c.needsUpdate=!0,{title:t,size:r,domainMin:n,domainMax:a,texture:h,texture3D:c}}}class cZ extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t,r=e,n=0,a=new Int8Array(new Int16Array([1]).buffer)[0]>0,s={},o=function(e,t){null==t&&(t=1);let s=1,o=Uint8Array;switch(e){case"uchar":break;case"schar":o=Int8Array;break;case"ushort":o=Uint16Array,s=2;break;case"sshort":o=Int16Array,s=2;break;case"uint":o=Uint32Array,s=4;break;case"sint":o=Int32Array,s=4;break;case"float":o=Float32Array,s=4;break;case"complex":case"double":o=Float64Array,s=8}let l=new o(r.slice(n,n+=t*s));return(!0!=a&&(l=function(e,t){let r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let n=0;n<e.byteLength;n+=t)for(let e=n+t-1,a=n;e>a;e--,a++){let t=r[a];r[a]=r[e],r[e]=t}return e}(l,s)),1==t)?l[0]:l}("uchar",e.byteLength),l=o.length,h=null,c=0;for(t=1;t<l;t++)if(10==o[t-1]&&10==o[t]){h=this.parseChars(o,0,t-2),c=t+1;break}if(!function(e){let t,r,n,a,o,l,h,c;let u=e.split(/\r?\n/);for(h=0,c=u.length;h<c;h++)(o=u[h]).match(/NRRD\d+/)?s.isNrrd=!0:o.match(/^#/)||(l=o.match(/(.*):(.*)/))&&(r=l[1].trim(),t=l[2].trim(),(n=c$[r])?n.call(s,t):s[r]=t);if(!s.isNrrd)throw Error("Not an NRRD file");if("bz2"===s.encoding||"bzip2"===s.encoding)throw Error("Bzip is not supported");if(!s.vectors&&(s.vectors=[new ee.Pa4(1,0,0),new ee.Pa4(0,1,0),new ee.Pa4(0,0,1)],s.spacings))for(a=0;a<=2;a++)isNaN(s.spacings[a])||s.vectors[a].multiplyScalar(s.spacings[a])}(h),r=o.subarray(c),"gz"===s.encoding.substring(0,2)){var u;r=i_((u=new Uint8Array(r)).subarray(iq(u),-8),new ii(iZ(u)))}else if("ascii"===s.encoding||"text"===s.encoding||"txt"===s.encoding||"hex"===s.encoding)r=function(e,t,r){let n,a="";t=t||0,r=r||e.length;let o=s.sizes.reduce(function(e,t){return e*t},1),l=10;"hex"===s.encoding&&(l=16);let h=new s.__array(o),c=0,u=parseInt;(s.__array===Float32Array||s.__array===Float64Array)&&(u=parseFloat);for(let s=t;s<r;s++)((n=e[s])<9||n>13)&&32!==n?a+=String.fromCharCode(n):(""!==a&&(h[c]=u(a,l),c++),a="");return""!==a&&(h[c]=u(a,l),c++),h}(r);else if("raw"===s.encoding){let e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r[t];r=e}r=r.buffer;let d=new ej;d.header=s,d.data=new s.__array(r);let m=d.computeMinMax(),p=m[0],A=m[1];d.windowLow=p,d.windowHigh=A,d.dimensions=[s.sizes[0],s.sizes[1],s.sizes[2]],d.xLength=d.dimensions[0],d.yLength=d.dimensions[1],d.zLength=d.dimensions[2];let f=new ee.Pa4(s.vectors[0][0],s.vectors[0][1],s.vectors[0][2]).length(),g=new ee.Pa4(s.vectors[1][0],s.vectors[1][1],s.vectors[1][2]).length(),v=new ee.Pa4(s.vectors[2][0],s.vectors[2][1],s.vectors[2][2]).length();d.spacing=[f,g,v],d.matrix=new ee.yGw;let y=1,x=1;if("left-posterior-superior"==s.space?(y=-1,x=-1):"left-anterior-superior"===s.space&&(y=-1),s.vectors){let e=s.vectors;d.matrix.set(y*e[0][0],y*e[1][0],y*e[2][0],0,x*e[0][1],x*e[1][1],x*e[2][1],0,1*e[0][2],1*e[1][2],1*e[2][2],0,0,0,0,1)}else d.matrix.set(y,0,0,0,0,x,0,0,0,0,1,0,0,0,0,1);return d.inverseMatrix=new ee.yGw,d.inverseMatrix.copy(d.matrix).invert(),d.RASDimensions=new ee.Pa4(d.xLength,d.yLength,d.zLength).applyMatrix4(d.matrix).round().toArray().map(Math.abs),d.lowerThreshold===-1/0&&(d.lowerThreshold=p),d.upperThreshold===1/0&&(d.upperThreshold=A),d}parseChars(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);let n="",a=0;for(a=t;a<r;++a)n+=String.fromCharCode(e[a]);return n}}let c$={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){return this.sizes=function(){let t=e.split(/\s+/),r=[];for(let e=0,n=t.length;e<n;e++)r.push(parseInt(t[e],10));return r}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){let t;let r=e.match(/\(.*?\)/g);return this.vectors=function(){let e=[];for(let n=0,a=r.length;n<a;n++)t=r[n],e.push(function(){let e=t.slice(1,-1).split(/,/),r=[];for(let t=0,n=e.length;t<n;t++)r.push(parseFloat(e[t]));return r}());return e}()},spacings:function(e){let t=e.split(/\s+/);return this.spacings=function(){let e=[];for(let r=0,n=t.length;r<n;r++)e.push(parseFloat(t[r]));return e}()}};class c0 extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=function(e){if("string"!=typeof e)return e;{let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}}(e);return!function(e){let t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;let r=[115,111,108,105,100];for(let e=0;e<5;e++)if(function(e,t,r){for(let n=0,a=e.length;n<a;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}(r,t,e))return!1;return!0}(t)?function(e){let t;let r=new ee.u9r,n=/solid([\s\S]*?)endsolid/g,a=/facet([\s\S]*?)endfacet/g,s=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,l=RegExp("vertex"+o+o+o,"g"),h=RegExp("normal"+o+o+o,"g"),c=[],u=[],d=new ee.Pa4,m=0,p=0,A=0;for(;null!==(t=n.exec(e));){p=A;let e=t[0];for(;null!==(t=a.exec(e));){let e=0,r=0,n=t[0];for(;null!==(t=h.exec(n));)d.x=parseFloat(t[1]),d.y=parseFloat(t[2]),d.z=parseFloat(t[3]),r++;for(;null!==(t=l.exec(n));)c.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(d.x,d.y,d.z),e++,A++;1!==r&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}let n=p,o=A-p;r.addGroup(n,o,m),m++}return r.setAttribute("position",new ee.a$l(c,3)),r.setAttribute("normal",new ee.a$l(u,3)),r}("string"!=typeof e?(0,cE.r)(new Uint8Array(e)):e):function(e){let t,r,n,a;let s=new DataView(e),o=s.getUint32(80,!0),l,h,c,u=!1,d;for(let e=0;e<70;e++)1129270351==s.getUint32(e,!1)&&82==s.getUint8(e+4)&&61==s.getUint8(e+5)&&(u=!0,d=new Float32Array(9*o),t=s.getUint8(e+6)/255,r=s.getUint8(e+7)/255,n=s.getUint8(e+8)/255,a=s.getUint8(e+9)/255);let m=new ee.u9r,p=new Float32Array(9*o),A=new Float32Array(9*o);for(let e=0;e<o;e++){let a=84+50*e,o=s.getFloat32(a,!0),m=s.getFloat32(a+4,!0),f=s.getFloat32(a+8,!0);if(u){let e=s.getUint16(a+48,!0);(32768&e)==0?(l=(31&e)/31,h=(e>>5&31)/31,c=(e>>10&31)/31):(l=t,h=r,c=n)}for(let t=1;t<=3;t++){let r=a+12*t,n=9*e+(t-1)*3;p[n]=s.getFloat32(r,!0),p[n+1]=s.getFloat32(r+4,!0),p[n+2]=s.getFloat32(r+8,!0),A[n]=o,A[n+1]=m,A[n+2]=f,u&&(d[n]=l,d[n+1]=h,d[n+2]=c)}}return m.setAttribute("position",new ee.TlE(p,3)),m.setAttribute("normal",new ee.TlE(A,3)),u&&(m.setAttribute("color",new ee.TlE(d,3)),m.hasColors=!0,m.alpha=a),m}(t)}}class c1 extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=""===this.path?ee.Zp0.extractUrlBase(e):this.path,o=new ee.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{t(a.parse(r,s))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){let r=e.split("\n"),n={},a=/\s+/,s={};for(let e=0;e<r.length;e++){let t=r[e];if(0===(t=t.trim()).length||"#"===t.charAt(0))continue;let o=t.indexOf(" "),l=o>=0?t.substring(0,o):t;l=l.toLowerCase();let h=o>=0?t.substring(o+1):"";if(h=h.trim(),"newmtl"===l)n={name:h},s[h]=n;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){let e=h.split(a,3);n[l]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else n[l]=h}let o=new c2(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(s),o}}class c2{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:ee.Wl3,this.wrap=void 0!==this.options.wrap?this.options.wrap:ee.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;let t={};for(let r in e){let n=e[r],a={};for(let e in t[r]=a,n){let t=!0,r=n[e],s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(t=!1)}t&&(a[s]=r)}}return t}preload(){for(let e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(let t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){let t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function a(e,r){var a,s;if(n[e])return;let o=t.getTextureParams(r,n),l=t.loadTexture((a=t.baseUrl,"string"!=typeof(s=o.url)||""===s?"":/^https?:\/\//i.test(s)?s:a+s));l.repeat.copy(o.scale),l.offset.copy(o.offset),l.wrapS=t.wrap,l.wrapT=t.wrap,n[e]=l}for(let e in r){let t;let s=r[e];if(""!==s)switch(e.toLowerCase()){case"kd":n.color=new ee.Ilk().fromArray(s);break;case"ks":n.specular=new ee.Ilk().fromArray(s);break;case"ke":n.emissive=new ee.Ilk().fromArray(s);break;case"map_kd":a("map",s);break;case"map_ks":a("specularMap",s);break;case"map_ke":a("emissiveMap",s);break;case"norm":a("normalMap",s);break;case"map_bump":case"bump":a("bumpMap",s);break;case"map_d":a("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(t=parseFloat(s))<1&&(n.opacity=t,n.transparent=!0);break;case"tr":t=parseFloat(s),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(n.opacity=1-t,n.transparent=!0)}}return this.materials[e]=new ee.xoR(n),this.materials[e]}getTextureParams(e,t){let r;let n={scale:new ee.FM8(1,1),offset:new ee.FM8(0,0)},a=e.split(/\s+/);return(r=a.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(a[r+1]),a.splice(r,2)),(r=a.indexOf("-s"))>=0&&(n.scale.set(parseFloat(a[r+1]),parseFloat(a[r+2])),a.splice(r,4)),(r=a.indexOf("-o"))>=0&&(n.offset.set(parseFloat(a[r+1]),parseFloat(a[r+2])),a.splice(r,4)),n.url=a.join(" ").trim(),n}loadTexture(e,t,r,n,a){let s=void 0!==this.manager?this.manager:ee.tEQ,o=s.getHandler(e);null===o&&(o=new ee.dpR(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);let l=o.load(e,r,n,a);return void 0!==t&&(l.mapping=t),l}}var c3=(Y=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},K=function(){function e(e,t){for(let n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),J=function e(){Y(this,e),this.boneName="",this.BoneIndex=0,this.Indeces=[],this.Weights=[],this.initMatrix=null,this.OffsetMatrix=null},q=function e(){Y(this,e),this.animeName="",this.boneName="",this.targetBone=null,this.keyType=4,this.frameStartLv=0,this.keyFrames=[],this.InverseMx=null},Z=function(){function e(t){Y(this,e),this.fps=30,this.name="xanimation",this.length=0,this.hierarchy=[],this.putFlags=t,void 0===this.putFlags.putPos&&(this.putFlags.putPos=!0),void 0===this.putFlags.putRot&&(this.putFlags.putRot=!0),void 0===this.putFlags.putScl&&(this.putFlags.putScl=!0)}return K(e,[{key:"make",value:function(e){for(let t=0;t<e.length;t++)this.hierarchy.push(this.makeBonekeys(e[t]));this.length=this.hierarchy[0].keys[this.hierarchy[0].keys.length-1].time}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"makeBonekeys",value:function(e){var t={};return t.name=e.boneName,t.parent="",t.keys=this.keyFrameRefactor(e),t.copy=function(){return Object.assign({},this)},t}},{key:"keyFrameRefactor",value:function(e){var t=[];for(let n=0;n<e.keyFrames.length;n++){var r={};r.time=e.keyFrames[n].time*this.fps,e.keyFrames[n].pos&&this.putFlags.putPos&&(r.pos=e.keyFrames[n].pos),e.keyFrames[n].rot&&this.putFlags.putRot&&(r.rot=e.keyFrames[n].rot),e.keyFrames[n].scl&&this.putFlags.putScl&&(r.scl=e.keyFrames[n].scl),e.keyFrames[n].matrix&&(r.matrix=e.keyFrames[n].matrix,this.putFlags.putPos&&(r.pos=new ee.Pa4().setFromMatrixPosition(r.matrix)),this.putFlags.putRot&&(r.rot=new ee._fP().setFromRotationMatrix(r.matrix)),this.putFlags.putScl&&(r.scl=new ee.Pa4().setFromMatrixScale(r.matrix))),t.push(r)}return t}}]),e}(),$=function e(){Y(this,e),this.index=0,this.Frame=0,this.time=0,this.matrix=null},function(){function e(t){ee.aNw.call(this,t),Y(this,e),this.debug=!1,this.texloader=new ee.dpR(this.manager),this.url="",this._putMatLength=0,this._nowMat=null,this._nowFrameName="",this.frameHierarchie=[],this.Hierarchies={},this.HieStack=[],this._currentObject={},this._currentFrame={},this._data=null,this.onLoad=null,this.IsUvYReverse=!0,this.Meshes=[],this.animations=[],this.animTicksPerSecond=30,this._currentGeo=null,this._currentAnime=null,this._currentAnimeFrames=null}return K(e,[{key:"_setArgOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e){for(let r=t;r<e.length;r++)switch(r){case 0:this.url=e[r];break;case 1:this.options=e[r]}void 0===this.options&&(this.options={})}}},{key:"load",value:function(e,t,r,n){var a=this;this._setArgOption(e);var s=new ee.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(this.url,function(e){try{a.parse(e,t)}catch(e){n?n(e):console.error(e),a.manager.itemError(a.url)}},r,n)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(-1===(r=e.indexOf("//",t))&&(r=e.indexOf("#",t)),r>-1&&r<2){var n=-1;t=(n=e.indexOf("\r\n",t))>0?n+2:(n=e.indexOf("\r",t))>0?n+1:e.indexOf("\n",t)+1}else break}return e.substr(t)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(-1===(r=e.indexOf("//",t))&&(r=e.indexOf("#",t)),r>-1&&r<2){var n=-1;t=(n=e.indexOf("\r\n",t))>0?n+2:(n=e.indexOf("\r",t))>0?n+1:e.indexOf("\n",t)+1}else break}return e.substr(t)}},{key:"_isBinary",value:function(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;var r=t.byteLength;for(let e=0;e<r;e++)if(t.getUint8(e,!1)>127)return!0;return!1}},{key:"_ensureBinary",value:function(e){if("string"!=typeof e)return e;var t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}},{key:"_ensureString",value:function(e){return"string"!=typeof e?(0,cE.r)(new Uint8Array(e)):e}},{key:"parse",value:function(e,t){var r=this._ensureBinary(e);return this._data=this._ensureString(e),this.onLoad=t,this._isBinary(r)?this._parseBinary(r):this._parseASCII()}},{key:"_parseBinary",value:function(e){return this._parseASCII((0,cE.r)(new Uint8Array(e)))}},{key:"_parseASCII",value:function(){var e;e=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ee.Zp0.extractUrlBase(this.url),this.texloader.setPath(e).setCrossOrigin(this.crossOrigin),this.Hierarchies.children=[],this._hierarchieParse(this.Hierarchies,16),this._changeRoot(),this._currentObject=this.Hierarchies.children.shift(),this._mainloop()}},{key:"_hierarchieParse",value:function(e,t){for(var r=t;;){var n=this._data.indexOf("{",r)+1,a=this._data.indexOf("}",r),s=this._data.indexOf("{",n)+1;if(n>0&&a>n){var o={};o.children=[];var l=this._readLine(this._data.substr(r,n-r-1)).trim(),h=l.split(/ /g);if(h.length>0?(o.type=h[0],h.length>=2?o.name=h[1]:o.name=h[0]+this.Hierarchies.children.length):(o.name=l,o.type=""),"Animation"===o.type){o.data=this._data.substr(s,a-s).trim();var c=this._hierarchieParse(o,a+1);r=c.end,o.children=c.parent.children}else{var u=this._data.lastIndexOf(";",s>0?Math.min(s,a):a);if(o.data=this._data.substr(n,u-n).trim(),s<=0||a<s)r=a+1;else{var d=Math.max(u+1,n),m=this._hierarchieParse(o,d);r=m.end,o.children=m.parent.children}}o.parent=e,"template"!=o.type&&e.children.push(o)}else{r=-1===n?this._data.length:a+1;break}}return{parent:e,end:r}}},{key:"_mainloop",value:function(){var e=this;this._mainProc(),this._currentObject.parent||this._currentObject.children.length>0||!this._currentObject.worked?setTimeout(function(){e._mainloop()},1):setTimeout(function(){e.onLoad({models:e.Meshes,animations:e.animations})},1)}},{key:"_mainProc",value:function(){for(var e=!1;;){if(!this._currentObject.worked){switch(this._currentObject.type){case"template":case"VertexDuplicationIndices":break;case"AnimTicksPerSecond":this.animTicksPerSecond=parseInt(this._currentObject.data);break;case"Frame":this._setFrame();break;case"FrameTransformMatrix":this._setFrameTransformMatrix();break;case"Mesh":this._changeRoot(),this._currentGeo={},this._currentGeo.name=this._currentObject.name.trim(),this._currentGeo.parentName=this._getParentName(this._currentObject).trim(),this._currentGeo.VertexSetedBoneCount=[],this._currentGeo.GeometryData={vertices:[],normals:[],uvs:[],skinIndices:[],skinWeights:[],indices:[],materialIndices:[]},this._currentGeo.Materials=[],this._currentGeo.normalVectors=[],this._currentGeo.BoneInfs=[],this._currentGeo.baseFrame=this._currentFrame,this._makeBoneFrom_CurrentFrame(),this._readVertexDatas(),e=!0;break;case"MeshNormals":this._readVertexDatas();break;case"MeshTextureCoords":this._setMeshTextureCoords();break;case"MeshMaterialList":this._setMeshMaterialList();break;case"Material":this._setMaterial();break;case"SkinWeights":this._setSkinWeights();break;case"AnimationSet":this._changeRoot(),this._currentAnime={},this._currentAnime.name=this._currentObject.name.trim(),this._currentAnime.AnimeFrames=[];break;case"Animation":this._currentAnimeFrames&&this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=new q,this._currentAnimeFrames.boneName=this._currentObject.data.trim();break;case"AnimationKey":this._readAnimationKey(),e=!0}this._currentObject.worked=!0}if(this._currentObject.children.length>0){if(this._currentObject=this._currentObject.children.shift(),this.debug&&console.log("processing "+this._currentObject.name),e)break}else if(this._currentObject.worked&&this._currentObject.parent&&!this._currentObject.parent.parent&&this._changeRoot(),this._currentObject.parent?this._currentObject=this._currentObject.parent:e=!0,e)break}}},{key:"_changeRoot",value:function(){null!=this._currentGeo&&this._currentGeo.name&&this._makeOutputGeometry(),this._currentGeo={},null!=this._currentAnime&&this._currentAnime.name&&(this._currentAnimeFrames&&(this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=null),this._makeOutputAnimation()),this._currentAnime={}}},{key:"_getParentName",value:function(e){return e.parent?e.parent.name?e.parent.name:this._getParentName(e.parent):""}},{key:"_setFrame",value:function(){this._nowFrameName=this._currentObject.name.trim(),this._currentFrame={},this._currentFrame.name=this._nowFrameName,this._currentFrame.children=[],this._currentObject.parent&&this._currentObject.parent.name&&(this._currentFrame.parentName=this._currentObject.parent.name),this.frameHierarchie.push(this._nowFrameName),this.HieStack[this._nowFrameName]=this._currentFrame}},{key:"_setFrameTransformMatrix",value:function(){this._currentFrame.FrameTransformMatrix=new ee.yGw;var e=this._currentObject.data.split(",");this._ParseMatrixData(this._currentFrame.FrameTransformMatrix,e),this._makeBoneFrom_CurrentFrame()}},{key:"_makeBoneFrom_CurrentFrame",value:function(){if(this._currentFrame.FrameTransformMatrix){var e=new ee.N$j;if(e.name=this._currentFrame.name,e.applyMatrix4(this._currentFrame.FrameTransformMatrix),e.matrixWorld=e.matrix,e.FrameTransformMatrix=this._currentFrame.FrameTransformMatrix,this._currentFrame.putBone=e,this._currentFrame.parentName)for(let e in this.HieStack)this.HieStack[e].name===this._currentFrame.parentName&&this.HieStack[e].putBone.add(this._currentFrame.putBone)}}},{key:"_readVertexDatas",value:function(){for(var e=0,t=0,r=0,n=0;;){var a=!1;if(0===r)e=this._readInt1(e).endRead,r=1,(n=this._currentObject.data.indexOf(";;",e)+1)<=0&&(n=this._currentObject.data.length);else{var s=0;switch(t){case 0:s=this._currentObject.data.indexOf(",",e)+1;break;case 1:s=this._currentObject.data.indexOf(";,",e)+1}switch((0===s||s>n)&&(s=n,r=0,a=!0),this._currentObject.type){case"Mesh":switch(t){case 0:this._readVertex1(this._currentObject.data.substr(e,s-e));break;case 1:this._readFace1(this._currentObject.data.substr(e,s-e))}break;case"MeshNormals":0===t&&this._readNormalVector1(this._currentObject.data.substr(e,s-e))}e=s+1,a&&t++}if(e>=this._currentObject.data.length)break}}},{key:"_readInt1",value:function(e){var t=this._currentObject.data.indexOf(";",e);return{refI:parseInt(this._currentObject.data.substr(e,t-e)),endRead:t+1}}},{key:"_readVertex1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.GeometryData.vertices.push(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])),this._currentGeo.GeometryData.skinIndices.push(0,0,0,0),this._currentGeo.GeometryData.skinWeights.push(1,0,0,0),this._currentGeo.VertexSetedBoneCount.push(0)}},{key:"_readFace1",value:function(e){var t=this._readLine(e.trim()).substr(2,e.length-4).split(",");this._currentGeo.GeometryData.indices.push(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}},{key:"_readNormalVector1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.GeometryData.normals.push(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}},{key:"_buildGeometry",value:function(){var e=new ee.u9r,t=[],r=[],n=[],a=[],s=[],o=this._currentGeo.GeometryData;for(let e=0,u=o.indices.length;e<u;e++){var l=2*o.indices[e],h=3*o.indices[e],c=4*o.indices[e];t.push(o.vertices[h],o.vertices[h+1],o.vertices[h+2]),r.push(o.normals[h],o.normals[h+1],o.normals[h+2]),a.push(o.skinIndices[c],o.skinIndices[c+1],o.skinIndices[c+2],o.skinIndices[c+3]),s.push(o.skinWeights[c],o.skinWeights[c+1],o.skinWeights[c+2],o.skinWeights[c+3]),n.push(o.uvs[l],o.uvs[l+1])}return e.setAttribute("position",new ee.a$l(t,3)),e.setAttribute("normal",new ee.a$l(r,3)),e.setAttribute("uv",new ee.a$l(n,2)),e.setAttribute("skinIndex",new ee.qlB(a,4)),e.setAttribute("skinWeight",new ee.a$l(s,4)),this._computeGroups(e,o.materialIndices),e}},{key:"_computeGroups",value:function(e,t){var r,n=[],a=void 0;for(let e=0;e<t.length;e++){var s=t[e];s!==a&&(a=s,void 0!==r&&(r.count=3*e-r.start,n.push(r)),r={start:3*e,materialIndex:a})}void 0!==r&&(r.count=3*i-r.start,n.push(r)),e.groups=n}},{key:"_setMeshTextureCoords",value:function(){for(var e=0,t=0,r=0;;){if(0===t){if(0===r)e=this._readInt1(0).endRead,r=1;else{var n=this._currentObject.data.indexOf(",",e)+1;0===n&&(n=this._currentObject.data.length,t=2,r=0);var a=this._currentObject.data.substr(e,n-e),s=this._readLine(a.trim()).split(";");this.IsUvYReverse?this._currentGeo.GeometryData.uvs.push(parseFloat(s[0]),1-parseFloat(s[1])):this._currentGeo.GeometryData.uvs.push(parseFloat(s[0]),parseFloat(s[1])),e=n+1}}if(e>=this._currentObject.data.length)break}}},{key:"_setMeshMaterialList",value:function(){for(var e=0,t=0,r=0;;){if(r<2)e=this._readInt1(e).endRead,r++;else{var n=this._currentObject.data.indexOf(";",e);-1===n&&(n=this._currentObject.data.length,t=3,r=0);var a=this._currentObject.data.substr(e,n-e),s=this._readLine(a.trim()).split(",");for(let e=0;e<s.length;e++)this._currentGeo.GeometryData.materialIndices[e]=parseInt(s[e]);e=this._currentObject.data.length}if(e>=this._currentObject.data.length||t>=3)break}}},{key:"_setMaterial",value:function(){var e=new ee.xoR({color:16777215*Math.random()});e.side=ee.Wl3,e.name=this._currentObject.name;var t=0,r=this._currentObject.data.indexOf(";;",t),n=this._currentObject.data.substr(t,r-t),a=this._readLine(n.trim()).split(";");e.color.r=parseFloat(a[0]),e.color.g=parseFloat(a[1]),e.color.b=parseFloat(a[2]),t=r+2,r=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,r-t),e.shininess=parseFloat(this._readLine(n)),t=r+1,r=this._currentObject.data.indexOf(";;",t),n=this._currentObject.data.substr(t,r-t);var s=this._readLine(n.trim()).split(";");e.specular.r=parseFloat(s[0]),e.specular.g=parseFloat(s[1]),e.specular.b=parseFloat(s[2]),t=r+2,-1===(r=this._currentObject.data.indexOf(";;",t))&&(r=this._currentObject.data.length),n=this._currentObject.data.substr(t,r-t);var o=this._readLine(n.trim()).split(";");e.emissive.r=parseFloat(o[0]),e.emissive.g=parseFloat(o[1]),e.emissive.b=parseFloat(o[2]);for(var l=null;;)if(this._currentObject.children.length>0){l=this._currentObject.children.shift(),this.debug&&console.log("processing "+l.name);var h=l.data.substr(1,l.data.length-2);switch(l.type){case"TextureFilename":e.map=this.texloader.load(h);break;case"BumpMapFilename":e.bumpMap=this.texloader.load(h),e.bumpScale=.05;break;case"NormalMapFilename":e.normalMap=this.texloader.load(h),e.normalScale=new ee.FM8(2,2);break;case"EmissiveMapFilename":e.emissiveMap=this.texloader.load(h);break;case"LightMapFilename":e.lightMap=this.texloader.load(h)}}else break;this._currentGeo.Materials.push(e)}},{key:"_setSkinWeights",value:function(){var e=new J,t=0,r=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,r-t);t=r+1,e.boneName=n.substr(1,n.length-2),e.BoneIndex=this._currentGeo.BoneInfs.length,t=(r=this._currentObject.data.indexOf(";",t))+1,r=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,r-t);var a=this._readLine(n.trim()).split(",");for(let t=0;t<a.length;t++)e.Indeces.push(parseInt(a[t]));t=r+1,r=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,r-t);var s=this._readLine(n.trim()).split(",");for(let t=0;t<s.length;t++)e.Weights.push(parseFloat(s[t]));t=r+1,(r=this._currentObject.data.indexOf(";",t))<=0&&(r=this._currentObject.data.length),n=this._currentObject.data.substr(t,r-t);var o=this._readLine(n.trim()).split(",");e.OffsetMatrix=new ee.yGw,this._ParseMatrixData(e.OffsetMatrix,o),this._currentGeo.BoneInfs.push(e)}},{key:"_makePutBoneList",value:function(e,t){var r=!1;for(let a in this.HieStack)if(this.HieStack[a].name===e||r){r=!0;var n=new ee.N$j;if(n.name=this.HieStack[a].name,n.applyMatrix4(this.HieStack[a].FrameTransformMatrix),n.matrixWorld=n.matrix,n.FrameTransformMatrix=this.HieStack[a].FrameTransformMatrix,n.pos=new ee.Pa4().setFromMatrixPosition(n.FrameTransformMatrix).toArray(),n.rotq=new ee._fP().setFromRotationMatrix(n.FrameTransformMatrix).toArray(),n.scl=new ee.Pa4().setFromMatrixScale(n.FrameTransformMatrix).toArray(),this.HieStack[a].parentName&&this.HieStack[a].parentName.length>0){for(let e=0;e<t.length;e++)if(this.HieStack[a].parentName===t[e].name){t[e].add(n),n.parent=e;break}}t.push(n)}}},{key:"_makeOutputGeometry",value:function(){var e=null;if(this._currentGeo.BoneInfs.length>0){var t=[];this._makePutBoneList(this._currentGeo.baseFrame.parentName,t);for(let e=0;e<this._currentGeo.BoneInfs.length;e++){var r=0;for(let n=0;n<t.length;n++)if(t[n].name===this._currentGeo.BoneInfs[e].boneName){r=n,t[n].OffsetMatrix=new ee.yGw,t[n].OffsetMatrix.copy(this._currentGeo.BoneInfs[e].OffsetMatrix);break}for(let t=0;t<this._currentGeo.BoneInfs[e].Indeces.length;t++){var n=this._currentGeo.BoneInfs[e].Indeces[t],a=this._currentGeo.BoneInfs[e].Weights[t],s=4*n;switch(this._currentGeo.VertexSetedBoneCount[n]){case 0:this._currentGeo.GeometryData.skinIndices[s]=r,this._currentGeo.GeometryData.skinWeights[s]=a;break;case 1:this._currentGeo.GeometryData.skinIndices[s+1]=r,this._currentGeo.GeometryData.skinWeights[s+1]=a;break;case 2:this._currentGeo.GeometryData.skinIndices[s+2]=r,this._currentGeo.GeometryData.skinWeights[s+2]=a;break;case 3:this._currentGeo.GeometryData.skinIndices[s+3]=r,this._currentGeo.GeometryData.skinWeights[s+3]=a}this._currentGeo.VertexSetedBoneCount[n]++,this._currentGeo.VertexSetedBoneCount[n]>4&&console.log("warn! over 4 bone weight! :"+n)}}for(let e=0;e<this._currentGeo.Materials.length;e++)this._currentGeo.Materials[e].skinning=!0;var o=[];for(let e=0;e<t.length;e++)t[e].OffsetMatrix?o.push(t[e].OffsetMatrix):o.push(new ee.yGw);var l=this._buildGeometry();e=new ee.TUv(l,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials),this._initSkeleton(e,t,o)}else{var h=this._buildGeometry();e=new ee.Kj0(h,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials)}e.name=this._currentGeo.name;var c=new ee.yGw,u=this._currentGeo.baseFrame.putBone;if(u&&u.parent){for(;;)if(u=u.parent)c.multiply(u.FrameTransformMatrix);else break;e.applyMatrix4(c)}this.Meshes.push(e)}},{key:"_initSkeleton",value:function(e,t,r){var n,a,s,o,l=[];for(n=0,a=t.length;n<a;n++)o=t[n],s=new ee.N$j,l.push(s),s.name=o.name,s.position.fromArray(o.pos),s.quaternion.fromArray(o.rotq),void 0!==o.scl&&s.scale.fromArray(o.scl);for(n=0,a=t.length;n<a;n++)-1!==(o=t[n]).parent&&null!==o.parent&&void 0!==l[o.parent]?l[o.parent].add(l[n]):e.add(l[n]);e.updateMatrixWorld(!0);var h=new ee.OdW(l,r);e.bind(h,e.matrixWorld)}},{key:"_readAnimationKey",value:function(){var e=0,t=this._currentObject.data.indexOf(";",e),r=this._currentObject.data.substr(e,t-e);e=t+1;var n=parseInt(this._readLine(r));e=(t=this._currentObject.data.indexOf(";",e))+1,r=this._currentObject.data.substr(e);var a=this._readLine(r.trim()).split(";;,");for(let e=0;e<a.length;e++){var s=a[e].split(";"),o=new $;if(o.type=n,o.Frame=parseInt(s[0]),o.index=this._currentAnimeFrames.keyFrames.length,o.time=o.Frame,4!=n){var l=!1;for(let e=0;e<this._currentAnimeFrames.keyFrames.length;e++)if(this._currentAnimeFrames.keyFrames[e].Frame===o.Frame){o=this._currentAnimeFrames.keyFrames[e],l=!0;break}var h=s[2].split(",");switch(n){case 0:o.rot=new ee._fP(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),-1*parseFloat(h[0]));break;case 1:o.scl=new ee.Pa4(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]));break;case 2:o.pos=new ee.Pa4(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))}l||this._currentAnimeFrames.keyFrames.push(o)}else o.matrix=new ee.yGw,this._ParseMatrixData(o.matrix,s[2].split(",")),this._currentAnimeFrames.keyFrames.push(o)}}},{key:"_makeOutputAnimation",value:function(){var e=new Z(this.options);e.fps=this.animTicksPerSecond,e.name=this._currentAnime.name,e.make(this._currentAnime.AnimeFrames),this.animations.push(e)}},{key:"assignAnimation",value:function(e,t){var r=e,n=t;if(r||(r=this.Meshes[0]),n||(n=this.animations[0]),!r||!n)return null;var a={};a.fps=n.fps,a.name=n.name,a.length=n.length,a.hierarchy=[];for(let e=0;e<r.skeleton.bones.length;e++){var s=!1;for(let t=0;t<n.hierarchy.length;t++)if(r.skeleton.bones[e].name===n.hierarchy[t].name){s=!0;var o=n.hierarchy[t].copy();if(o.parent=-1,r.skeleton.bones[e].parent&&"Bone"===r.skeleton.bones[e].parent.type)for(let t=0;t<a.hierarchy.length;t++)a.hierarchy[t].name===r.skeleton.bones[e].parent.name&&(o.parent=t,o.parentName=r.skeleton.bones[e].parent.name);a.hierarchy.push(o);break}if(!s){var l=n.hierarchy[0].copy();l.name=r.skeleton.bones[e].name,l.parent=-1;for(let e=0;e<l.keys.length;e++)l.keys[e].pos&&l.keys[e].pos.set(0,0,0),l.keys[e].scl&&l.keys[e].scl.set(1,1,1),l.keys[e].rot&&l.keys[e].rot.set(0,0,0,1);a.hierarchy.push(l)}}return r.geometry.animations||(r.geometry.animations=[]),r.geometry.animations.push(ee.m7l.parseAnimation(a,r.skeleton.bones)),r.animationMixer||(r.animationMixer=new ee.Xcj(r)),a}},{key:"_ParseMatrixData",value:function(e,t){e.set(parseFloat(t[0]),parseFloat(t[4]),parseFloat(t[8]),parseFloat(t[12]),parseFloat(t[1]),parseFloat(t[5]),parseFloat(t[9]),parseFloat(t[13]),parseFloat(t[2]),parseFloat(t[6]),parseFloat(t[10]),parseFloat(t[14]),parseFloat(t[3]),parseFloat(t[7]),parseFloat(t[11]),parseFloat(t[15]))}}]),e}());class c4 extends ee.aNw{constructor(e){super(e),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){function t(e){let t;for(;0===(t=e.shift().trim()).length;);return t}let r=this,n=function(e){"HIERARCHY"!==t(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");let r=[],n=function e(r,n,a){let s={name:"",type:"",frames:[]};a.push(s);let o=n.split(/[\s]+/);"END"===o[0].toUpperCase()&&"SITE"===o[1].toUpperCase()?(s.type="ENDSITE",s.name="ENDSITE"):(s.name=o[1],s.type=o[0].toUpperCase()),"{"!==t(r)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),"OFFSET"!==(o=t(r).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+o[0]),4!==o.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");let l=new ee.Pa4(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));if((isNaN(l.x)||isNaN(l.y)||isNaN(l.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),s.offset=l,"ENDSITE"!==s.type){"CHANNELS"!==(o=t(r).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");let e=parseInt(o[1]);s.channels=o.splice(2,e),s.children=[]}for(;;){let n=t(r);if("}"===n)return s;s.children.push(e(r,n,a))}}(e,t(e),r);"MOTION"!==t(e)&&console.error("THREE.BVHLoader: MOTION expected.");let a=t(e).split(/[\s]+/),s=parseInt(a[1]);isNaN(s)&&console.error("THREE.BVHLoader: Failed to read number of frames.");let o=parseFloat((a=t(e).split(/[\s]+/))[2]);isNaN(o)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let r=0;r<s;r++)!function e(t,r,n){if("ENDSITE"===n.type)return;let a={time:r,position:new ee.Pa4,rotation:new ee._fP};n.frames.push(a);let s=new ee._fP,o=new ee.Pa4(1,0,0),l=new ee.Pa4(0,1,0),h=new ee.Pa4(0,0,1);for(let e=0;e<n.channels.length;e++)switch(n.channels[e]){case"Xposition":a.position.x=parseFloat(t.shift().trim());break;case"Yposition":a.position.y=parseFloat(t.shift().trim());break;case"Zposition":a.position.z=parseFloat(t.shift().trim());break;case"Xrotation":s.setFromAxisAngle(o,parseFloat(t.shift().trim())*Math.PI/180),a.rotation.multiply(s);break;case"Yrotation":s.setFromAxisAngle(l,parseFloat(t.shift().trim())*Math.PI/180),a.rotation.multiply(s);break;case"Zrotation":s.setFromAxisAngle(h,parseFloat(t.shift().trim())*Math.PI/180),a.rotation.multiply(s);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let a=0;a<n.children.length;a++)e(t,r,n.children[a])}(a=t(e).split(/[\s]+/),r*o,n);return r}(e.split(/[\r\n]+/g)),a=[];!function e(t,r){let n=new ee.N$j;if(r.push(n),n.position.add(t.offset),n.name=t.name,"ENDSITE"!==t.type)for(let a=0;a<t.children.length;a++)n.add(e(t.children[a],r));return n}(n[0],a);let s=function(e){let t=[];for(let n=0;n<e.length;n++){let a=e[n];if("ENDSITE"===a.type)continue;let s=[],o=[],l=[];for(let e=0;e<a.frames.length;e++){let t=a.frames[e];s.push(t.time),o.push(t.position.x+a.offset.x),o.push(t.position.y+a.offset.y),o.push(t.position.z+a.offset.z),l.push(t.rotation.x),l.push(t.rotation.y),l.push(t.rotation.z),l.push(t.rotation.w)}r.animateBonePositions&&t.push(new ee.yC1(".bones["+a.name+"].position",s,o)),r.animateBoneRotations&&t.push(new ee.iLg(".bones["+a.name+"].quaternion",s,l))}return new ee.m7l("animation",-1,t)}(n);return{skeleton:new ee.OdW(a),clip:s}}}class c5 extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=""===a.path?ee.Zp0.extractUrlBase(e):a.path,o=new ee.hH6(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(r){try{t(a.parse(r,s))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){var r,n,a,s;let o;function l(e,t){let r=[],n=e.childNodes;for(let e=0,a=n.length;e<a;e++){let a=n[e];a.nodeName===t&&r.push(a)}return r}function h(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=parseFloat(t[e]);return r}function c(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=parseInt(t[e]);return r}function u(e){return e.substring(1)}function d(e){return 0===Object.keys(e).length}function m(e,t,r,n){let a=l(e,t)[0];if(void 0!==a){let e=l(a,r);for(let t=0;t<e.length;t++)n(e[t])}}function p(e,t){for(let r in e)e[r].build=t(e[r])}function A(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){let t=[],r=e.channels,n=e.samplers,a=e.sources;for(let e in r)if(r.hasOwnProperty(e)){let s=r[e],o=n[s.sampler],l=o.inputs.INPUT,h=o.inputs.OUTPUT;!function(e,t){let r=e.keyframes,n=e.name,a=[],s=[],o=[],l=[];for(let e=0,t=r.length;e<t;e++){let t=r[e],n=t.time,h=t.value;O.fromArray(h).transpose(),O.decompose(v,x,y),a.push(n),s.push(v.x,v.y,v.z),o.push(x.x,x.y,x.z,x.w),l.push(y.x,y.y,y.z)}s.length>0&&t.push(new ee.yC1(n+".position",a,s)),o.length>0&&t.push(new ee.iLg(n+".quaternion",a,o)),l.length>0&&t.push(new ee.yC1(n+".scale",a,l))}(function(e,t,r){let n,a,s,o,l,h;let c=eo.nodes[e.id],u=K(c.id),d=c.transforms[e.sid],m=c.matrix.clone().transpose(),p={};switch(d){case"matrix":for(s=0,o=t.array.length;s<o;s++)if(n=t.array[s],a=s*r.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){let t=r.array[a],s=e.indices[0]+4*e.indices[1];p[n][s]=t}else for(l=0,h=r.stride;l<h;l++)p[n][l]=r.array[a+l];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',d)}let A=function(e,t){let r=[];for(let t in e)r.push({time:parseFloat(t),value:e[t]});r.sort(function(e,t){return e.time-t.time});for(let e=0;e<16;e++)!function(e,t,r){let n,a,s;let o=!0;for(a=0,s=e.length;a<s;a++)void 0===(n=e[a]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(a=0,s=e.length;a<s;a++)(n=e[a]).value[t]=r;else!function(e,t){let r,n;for(let a=0,s=e.length;a<s;a++){let s=e[a];if(null===s.value[t]){if(r=function(e,t,r){for(;t>=0;){let n=e[t];if(null!==n.value[r])return n;t--}return null}(e,a,t),n=function(e,t,r){for(;t<e.length;){let n=e[t];if(null!==n.value[r])return n;t++}return null}(e,a,t),null===r){s.value[t]=n.value[t];continue}if(null===n){s.value[t]=r.value[t];continue}!function(e,t,r,n){if(r.time-t.time==0){e.value[n]=t.value[n];return}e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]}(s,r,n,t)}}}(e,t)}(r,e,t.elements[e]);return r}(p,m);return{name:u.uuid,keyframes:A}}(s,a[l],a[h]),t)}return t}function g(e){return A(eo.animations[e],f)}let v=new ee.Pa4,y=new ee.Pa4,x=new ee._fP;function b(e){let t=[],r=e.name,n=e.end-e.start||-1,a=e.animations;for(let e=0,r=a.length;e<r;e++){let r=g(a[e]);for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return new ee.m7l(r,n,t)}function w(e){let t={id:e.id},r=eo.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){let t,r,n;let a={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},s=e.sources,o=e.vertexWeights,l=o.vcount,h=o.v,c=o.inputs.JOINT.offset,u=o.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],m=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=s[o.inputs.WEIGHT.id].array,A=0;for(t=0,n=l.length;t<n;t++){let e=l[t],n=[];for(r=0;r<e;r++){let e=h[A+c],t=p[h[A+u]];n.push({index:e,weight:t}),A+=2}for(n.sort(f),r=0;r<4;r++){let e=n[r];void 0!==e?(a.indices.array.push(e.index),a.weights.array.push(e.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}for(e.bindShapeMatrix?a.bindMatrix=new ee.yGw().fromArray(e.bindShapeMatrix).transpose():a.bindMatrix=new ee.yGw().identity(),t=0,n=d.array.length;t<n;t++){let e=d.array[t],r=new ee.yGw().fromArray(m.array,t*m.stride).transpose();a.joints.push({name:e,boneInverse:r})}return a;function f(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function C(e){return void 0!==e.build?e.build:e.init_from}function E(e){let t=eo.images[e];return void 0!==t?A(t,C):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function I(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=h(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:M(n)}}}return t}function M(e){let t={technique:{}};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"extra"===n.nodeName&&function(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"technique"===n.nodeName&&function(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent);break;case"bump":t[n.nodeName]=S(n)}}}(n,t)}}(n,t)}return t}function B(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"technique"===n.nodeName&&(t.technique=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent);break;case"bump":t[n.nodeName]=S(n)}}return t}(n))}return t}function S(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"texture"===a.nodeName&&(t[a.nodeName]={id:a.getAttribute("texture"),texcoord:a.getAttribute("texcoord"),extra:M(a)})}return t}function T(e){return e}function F(e){var t;let r;let n=(t=e.url,A(eo.effects[t],T)),a=n.profile.technique;switch(a.type){case"phong":case"blinn":r=new ee.xoR;break;case"lambert":r=new ee.YBo;break;default:r=new ee.vBJ}function s(e){let t=n.profile.samplers[e.id],r=null;if(void 0!==t?r=E(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=E(e.id)),null===r)return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null;{var a;let t,n;let s="tga"===(a=r).slice((a.lastIndexOf(".")-1>>>0)+2).toLowerCase()?o:er;if(void 0===s)return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null;{let t=s.load(r),n=e.extra;if(void 0!==n&&void 0!==n.technique&&!1===d(n.technique)){let e=n.technique;t.wrapS=e.wrapU?ee.rpg:ee.uWy,t.wrapT=e.wrapV?ee.rpg:ee.uWy,t.offset.set(e.offsetU||0,e.offsetV||0),t.repeat.set(e.repeatU||1,e.repeatV||1)}else t.wrapS=ee.rpg,t.wrapT=ee.rpg;return t}}}r.name=e.name||"";let l=a.parameters;for(let e in l){let t=l[e];switch(e){case"diffuse":t.color&&r.color.fromArray(t.color),t.texture&&(r.map=s(t.texture));break;case"specular":t.color&&r.specular&&r.specular.fromArray(t.color),t.texture&&(r.specularMap=s(t.texture));break;case"bump":t.texture&&(r.normalMap=s(t.texture));break;case"ambient":t.texture&&(r.lightMap=s(t.texture));break;case"shininess":t.float&&r.shininess&&(r.shininess=t.float);break;case"emission":t.color&&r.emissive&&r.emissive.fromArray(t.color),t.texture&&(r.emissiveMap=s(t.texture))}}let h=l.transparent,c=l.transparency;if(void 0===c&&h&&(c={float:1}),void 0===h&&c&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&c){if(h.data.texture)r.transparent=!0;else{let e=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=e[3]*c.float;break;case"RGB_ZERO":r.opacity=1-e[0]*c.float;break;case"A_ZERO":r.opacity=1-e[3]*c.float;break;case"RGB_ONE":r.opacity=e[0]*c.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}}if(void 0!==a.extra&&void 0!==a.extra.technique){let e=a.extra.technique;for(let t in e){let n=e[t];switch(t){case"double_sided":r.side=1===n?ee.ehD:ee.Wl3;break;case"bump":r.normalMap=s(n.texture),r.normalScale=new ee.FM8(1,1)}}}return r}function P(e){let t;switch(e.optics.technique){case"perspective":t=new ee.cPb(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,a=e.optics.parameters.aspect_ratio;n=void 0===n?r*a:n,r=void 0===r?n/a:r,n*=.5,r*=.5,t=new ee.iKG(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new ee.cPb}return t.name=e.name||"",t}function _(e){let t;switch(e.technique){case"directional":t=new ee.Ox3;break;case"point":t=new ee.cek;break;case"spot":t=new ee.PMe;break;case"ambient":t=new ee.Mig}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function D(e){let t={array:[],stride:3};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"float_array":t.array=h(n.textContent);break;case"Name_array":t.array=function(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=t[e];return r}(n.textContent);break;case"technique_common":let a=l(n,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function R(e){let t={},r=e.sources,n=e.vertices,a=e.primitives;if(0===a.length)return{};let s=function(e){let t={};for(let r=0;r<e.length;r++){let n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(a);for(let e in s){let a=s[e];!function(e){let t=0;for(let r=0,n=e.length;r<n;r++)!0===e[r].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}(a),t[e]=function(e,t,r){let n={},a={array:[],stride:0},s={array:[],stride:0},o={array:[],stride:0},l={array:[],stride:0},h={array:[],stride:0},c={array:[],stride:4},u={array:[],stride:4},d=new ee.u9r,m=[],p=0;for(let n=0;n<e.length;n++){let A=e[n],f=A.inputs,g=0;switch(A.type){case"lines":case"linestrips":g=2*A.count;break;case"triangles":g=3*A.count;break;case"polylist":for(let e=0;e<A.count;e++){let t=A.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=(t-2)*3}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",A.type)}for(let v in d.addGroup(p,g,n),p+=g,A.material&&m.push(A.material),f){let n=f[v];switch(v){case"VERTEX":for(let d in r){let m=r[d];switch(d){case"POSITION":let p=a.array.length;if(L(A,t[m],n.offset,a.array),a.stride=t[m].stride,t.skinWeights&&t.skinIndices&&(L(A,t.skinIndices,n.offset,c.array),L(A,t.skinWeights,n.offset,u.array)),!1===A.hasUV&&!0===e.uvsNeedsFix){let e=(a.array.length-p)/a.stride;for(let t=0;t<e;t++)o.array.push(0,0)}break;case"NORMAL":L(A,t[m],n.offset,s.array),s.stride=t[m].stride;break;case"COLOR":L(A,t[m],n.offset,h.array),h.stride=t[m].stride;break;case"TEXCOORD":L(A,t[m],n.offset,o.array),o.stride=t[m].stride;break;case"TEXCOORD1":L(A,t[m],n.offset,l.array),o.stride=t[m].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',d)}}break;case"NORMAL":L(A,t[n.id],n.offset,s.array),s.stride=t[n.id].stride;break;case"COLOR":L(A,t[n.id],n.offset,h.array),h.stride=t[n.id].stride;break;case"TEXCOORD":L(A,t[n.id],n.offset,o.array),o.stride=t[n.id].stride;break;case"TEXCOORD1":L(A,t[n.id],n.offset,l.array),l.stride=t[n.id].stride}}}return a.array.length>0&&d.setAttribute("position",new ee.a$l(a.array,a.stride)),s.array.length>0&&d.setAttribute("normal",new ee.a$l(s.array,s.stride)),h.array.length>0&&d.setAttribute("color",new ee.a$l(h.array,h.stride)),o.array.length>0&&d.setAttribute("uv",new ee.a$l(o.array,o.stride)),l.array.length>0&&d.setAttribute(eW.i,new ee.a$l(l.array,l.stride)),c.array.length>0&&d.setAttribute("skinIndex",new ee.a$l(c.array,c.stride)),u.array.length>0&&d.setAttribute("skinWeight",new ee.a$l(u.array,u.stride)),n.data=d,n.type=e[0].type,n.materialKeys=m,n}(a,r,n)}return t}function L(e,t,r,n){let a=e.p,s=e.stride,o=e.vcount;function l(e){let t=a[e+r]*c,s=t+c;for(;t<s;t++)n.push(h[t])}let h=t.array,c=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=o.length;t<r;t++){let r=o[t];if(4===r){let t=e+0*s,r=e+1*s,n=e+2*s,a=e+3*s;l(t),l(r),l(a),l(r),l(n),l(a)}else if(3===r){let t=e+0*s,r=e+1*s,n=e+2*s;l(t),l(r),l(n)}else if(r>4)for(let t=1,n=r-2;t<=n;t++){let r=e+0*s,n=e+s*t,a=e+s*(t+1);l(r),l(n),l(a)}e+=s*r}}else for(let e=0,t=a.length;e<t;e+=s)l(e)}function N(e){return A(eo.geometries[e],R)}function k(e){return void 0!==e.build?e.build:e}function U(e){let t={type:e.nodeName},r=h(e.textContent);switch(t.type){case"matrix":t.obj=new ee.yGw,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new ee.Pa4,t.obj.fromArray(r);break;case"rotate":t.obj=new ee.Pa4,t.obj.fromArray(r),t.angle=ee.M8C.degToRad(r[3])}return t}function Q(e){return void 0!==e.build?e.build:e}let O=new ee.yGw,G=new ee.Pa4;function H(e){let t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new ee.yGw,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let r=0;r<e.childNodes.length;r++){let n;let a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"node":t.nodes.push(a.getAttribute("id")),H(a);break;case"instance_camera":t.instanceCameras.push(u(a.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(z(a));break;case"instance_light":t.instanceLights.push(u(a.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(z(a));break;case"instance_node":t.instanceNodes.push(u(a.getAttribute("url")));break;case"matrix":n=h(a.textContent),t.matrix.multiply(O.fromArray(n).transpose()),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":n=h(a.textContent),G.fromArray(n),t.matrix.multiply(O.makeTranslation(G.x,G.y,G.z)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":n=h(a.textContent);let s=ee.M8C.degToRad(n[3]);t.matrix.multiply(O.makeRotationAxis(G.fromArray(n),s)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":n=h(a.textContent),t.matrix.scale(G.fromArray(n)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return Y(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):eo.nodes[t.id]=t,t}function z(e){let t={id:u(e.getAttribute("url")),materials:{},skeletons:[]};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];switch(n.nodeName){case"bind_material":let a=n.getElementsByTagName("instance_material");for(let e=0;e<a.length;e++){let r=a[e],n=r.getAttribute("symbol"),s=r.getAttribute("target");t.materials[n]=u(s)}break;case"skeleton":t.skeletons.push(u(n.textContent))}}return t}function V(e,t,r){e.traverse(function(e){if(!0===e.isBone){let n;for(let r=0;r<t.length;r++){let a=t[r];if(a.name===e.name){n=a.boneInverse;break}}void 0===n&&(n=new ee.yGw),r.push({bone:e,boneInverse:n,processed:!1})}})}function j(e){let t;let r=[],n=e.matrix,a=e.nodes,s=e.type,o=e.instanceCameras,l=e.instanceControllers,h=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes;for(let e=0,t=a.length;e<t;e++)r.push(K(a[e]));for(let e=0,t=o.length;e<t;e++){let t=function(e){let t=eo.cameras[e];return void 0!==t?A(t,P):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}(o[e]);null!==t&&r.push(t.clone())}for(let e=0,t=l.length;e<t;e++){var d;let t=l[e],n=(d=t.id,A(eo.controllers[d],w)),a=X(N(n.id),t.materials),s=function(e,t){let r,n,a;let s=[],o=[];for(r=0;r<e.length;r++){let n=e[r];if(Y(n))V(K(n),t,s);else if(void 0!==eo.visualScenes[n]){let e=eo.visualScenes[n].children;for(let r=0;r<e.length;r++){let n=e[r];"JOINT"===n.type&&V(K(n.id),t,s)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",n)}for(r=0;r<t.length;r++)for(n=0;n<s.length;n++)if((a=s[n]).bone.name===t[r].name){o[r]=a,a.processed=!0;break}for(r=0;r<s.length;r++)!1===(a=s[r]).processed&&(o.push(a),a.processed=!0);let l=[],h=[];for(r=0;r<o.length;r++)a=o[r],l.push(a.bone),h.push(a.boneInverse);return new ee.OdW(l,h)}(t.skeletons,n.skin.joints);for(let e=0,t=a.length;e<t;e++){let t=a[e];t.isSkinnedMesh&&(t.bind(s,n.skin.bindMatrix),t.normalizeSkinWeights()),r.push(t)}}for(let e=0,t=h.length;e<t;e++){let t=function(e){let t=eo.lights[e];return void 0!==t?A(t,_):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}(h[e]);null!==t&&r.push(t.clone())}for(let e=0,t=c.length;e<t;e++){let t=c[e],n=X(N(t.id),t.materials);for(let e=0,t=n.length;e<t;e++)r.push(n[e])}for(let e=0,t=u.length;e<t;e++)r.push(K(u[e]).clone());if(0===a.length&&1===r.length)t=r[0];else{t="JOINT"===s?new ee.N$j:new ee.ZAu;for(let e=0;e<r.length;e++)t.add(r[e])}return t.name="JOINT"===s?e.sid:e.name,t.matrix.copy(n),t.matrix.decompose(t.position,t.quaternion,t.scale),t}let W=new ee.vBJ({color:16711935});function X(e,t){let r=[];for(let n in e){let a;let s=e[n],o=function(e,t){let r=[];for(let n=0,a=e.length;n<a;n++){let a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(W)):r.push(A(eo.materials[a],F))}return r}(s.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new ee.nls):o.push(new ee.xoR));let l=void 0!==s.data.attributes.skinIndex,h=1===o.length?o[0]:o;switch(n){case"lines":a=new ee.ejS(s.data,h);break;case"linestrips":a=new ee.x12(s.data,h);break;case"triangles":case"polylist":a=l?new ee.TUv(s.data,h):new ee.Kj0(s.data,h)}r.push(a)}return r}function Y(e){return void 0!==eo.nodes[e]}function K(e){return A(eo.nodes[e],j)}function J(e){let t=new ee.ZAu;t.name=e.name;let r=e.children;for(let e=0;e<r.length;e++){let n=r[e];t.add(K(n.id))}return t}function q(e){return A(eo.visualScenes[e],J)}if(0===e.length)return{scene:new ee.xsS};let Z=new DOMParser().parseFromString(e,"application/xml"),$=l(Z,"COLLADA")[0],et=Z.getElementsByTagName("parsererror")[0];if(void 0!==et){let e=l(et,"div")[0];return console.error("THREE.ColladaLoader: Failed to parse collada file.\n",e?e.textContent:function(e){let t="",r=[e];for(;r.length;){let e=r.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",r.push.apply(r,e.childNodes))}return t.trim()}(et)),null}console.log("THREE.ColladaLoader: File version",$.getAttribute("version"));let ei=(r=l($,"asset")[0],{unit:void 0!==(a=l(r,"unit")[0])&&!0===a.hasAttribute("meter")?parseFloat(a.getAttribute("meter")):1,upAxis:void 0!==(s=l(r,"up_axis")[0])?s.textContent:"Y_UP"}),er=new ee.dpR(this.manager);er.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),cK&&(o=new cK(this.manager)).setPath(this.resourcePath||t);let en=[],ea={},es=0,eo={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};m($,"library_animations","animation",function e(t){let r={sources:{},samplers:{},channels:{}},n=!1;for(let a=0,s=t.childNodes.length;a<s;a++){let s;let o=t.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"source":s=o.getAttribute("id"),r.sources[s]=D(o);break;case"sampler":s=o.getAttribute("id"),r.samplers[s]=function(e){let t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType&&"input"===n.nodeName){let e=u(n.getAttribute("source")),r=n.getAttribute("semantic");t.inputs[r]=e}}return t}(o);break;case"channel":s=o.getAttribute("target"),r.channels[s]=function(e){let t={},r=e.getAttribute("target").split("/"),n=r.shift(),a=r.shift(),s=-1!==a.indexOf("("),o=-1!==a.indexOf(".");if(o)a=(r=a.split(".")).shift(),t.member=r.shift();else if(s){let e=a.split("(");a=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=n,t.sid=a,t.arraySyntax=s,t.memberSyntax=o,t.sampler=u(e.getAttribute("source")),t}(o);break;case"animation":e(o),n=!0;break;default:console.log(o)}}!1===n&&(eo.animations[t.getAttribute("id")||ee.M8C.generateUUID()]=r)}),m($,"library_animation_clips","animation_clip",function(e){let t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"instance_animation"===n.nodeName&&t.animations.push(u(n.getAttribute("url")))}eo.clips[e.getAttribute("id")]=t}),m($,"library_controllers","controller",function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=u(n.getAttribute("source")),t.skin=function(e){let t={sources:{}};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=h(n.textContent);break;case"source":let a=n.getAttribute("id");t.sources[a]=D(n);break;case"joints":t.joints=function(e){let t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType&&"input"===n.nodeName){let e=n.getAttribute("semantic"),r=u(n.getAttribute("source"));t.inputs[e]=r}}return t}(n);break;case"vertex_weights":t.vertexWeights=function(e){let t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":let a=n.getAttribute("semantic"),s=u(n.getAttribute("source")),o=parseInt(n.getAttribute("offset"));t.inputs[a]={id:s,offset:o};break;case"vcount":t.vcount=c(n.textContent);break;case"v":t.v=c(n.textContent)}}return t}(n)}}return t}(n);break;case"morph":t.id=u(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}eo.controllers[e.getAttribute("id")]=t}),m($,"library_images","image",function(e){let t={init_from:l(e,"init_from")[0].textContent};eo.images[e.getAttribute("id")]=t}),m($,"library_effects","effect",function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"profile_COMMON"===n.nodeName&&(t.profile=function(e){let t={surfaces:{},samplers:{}};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":(function(e,t){let r=e.getAttribute("sid");for(let n=0,a=e.childNodes.length;n<a;n++){let a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"init_from"===n.nodeName&&(t.init_from=n.textContent)}return t}(a);break;case"sampler2D":t.samplers[r]=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"source"===n.nodeName&&(t.source=n.textContent)}return t}(a)}}})(n,t);break;case"technique":t.technique=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=I(n);break;case"transparent":t[n.nodeName]={opaque:n.hasAttribute("opaque")?n.getAttribute("opaque"):"A_ONE",data:I(n)}}}return t}(n);break;case"extra":t.extra=B(n)}}return t}(n);break;case"extra":t.extra=B(n)}}return t}(n))}eo.effects[e.getAttribute("id")]=t}),m($,"library_materials","material",function(e){let t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"instance_effect"===n.nodeName&&(t.url=u(n.getAttribute("url")))}eo.materials[e.getAttribute("id")]=t}),m($,"library_cameras","camera",function(e){let t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"optics"===n.nodeName&&(t.optics=function(e){for(let t=0;t<e.childNodes.length;t++){let r=e.childNodes[t];if("technique_common"===r.nodeName)return function(e){let t={};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=function(e){let t={};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}(n)}}return t}(r)}return{}}(n))}eo.cameras[e.getAttribute("id")]=t}),m($,"library_lights","light",function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];1===n.nodeType&&"technique_common"===n.nodeName&&(t=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":let a=h(n.textContent);t.color=new ee.Ilk().fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(n.textContent);break;case"quadratic_attenuation":let s=parseFloat(n.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}(n)}}return t}(n))}eo.lights[e.getAttribute("id")]=t}),m($,"library_geometries","geometry",function(e){let t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=l(e,"mesh")[0];if(void 0!==r){for(let e=0;e<r.childNodes.length;e++){let n=r.childNodes[e];if(1!==n.nodeType)continue;let a=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[a]=D(n);break;case"vertices":t.vertices=function(e){let t={};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=u(n.getAttribute("source")))}return t}(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(function(e){let t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let r=0,n=e.childNodes.length;r<n;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":let a=u(n.getAttribute("source")),s=n.getAttribute("semantic"),o=parseInt(n.getAttribute("offset")),l=parseInt(n.getAttribute("set")),h=l>0?s+l:s;t.inputs[h]={id:a,offset:o},t.stride=Math.max(t.stride,o+1),"TEXCOORD"===s&&(t.hasUV=!0);break;case"vcount":t.vcount=c(n.textContent);break;case"p":t.p=c(n.textContent)}}return t}(n));break;default:console.log(n)}}eo.geometries[e.getAttribute("id")]=t}}),m($,"library_nodes","node",H),m($,"library_visual_scenes","visual_scene",function(e){let t={name:e.getAttribute("name"),children:[]};!function(e){let t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){let r=t[e];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+es++)}}(e);let r=l(e,"node");for(let e=0;e<r.length;e++)t.children.push(H(r[e]));eo.visualScenes[e.getAttribute("id")]=t}),m($,"library_kinematics_models","kinematics_model",function(e){let t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];1===n.nodeType&&"technique_common"===n.nodeName&&function(e,t){for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=function(e){let t;for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=function(e){let t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new ee.Pa4,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":let a=h(n.textContent);t.axis.fromArray(a);break;case"limits":let s=n.getElementsByTagName("max")[0],o=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(o.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}(n)}}return t}(n);break;case"link":t.links.push(function e(t){let r={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<t.childNodes.length;n++){let a=t.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"attachment_full":r.attachments.push(function(t){let r={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<t.childNodes.length;n++){let a=t.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"link":r.links.push(e(a));break;case"matrix":case"translate":case"rotate":r.transforms.push(U(a))}}return r}(a));break;case"matrix":case"translate":case"rotate":r.transforms.push(U(a))}}return r}(n))}}}(n,t)}eo.kinematicsModels[e.getAttribute("id")]=t}),m($,"library_physics_models","physics_model",function(e){let t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];1===n.nodeType&&"rigid_body"===n.nodeName&&(t.rigidBodies[n.getAttribute("name")]={},function(e,t){for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];1===n.nodeType&&"technique_common"===n.nodeName&&function(e,t){for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=h(n.textContent);break;case"mass":t.mass=h(n.textContent)[0]}}}(n,t)}}(n,t.rigidBodies[n.getAttribute("name")]))}eo.physicsModels[e.getAttribute("id")]=t}),m($,"scene","instance_kinematics_scene",function(e){let t={bindJointAxis:[]};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];1===n.nodeType&&"bind_joint_axis"===n.nodeName&&t.bindJointAxis.push(function(e){let t={target:e.getAttribute("target").split("/").pop()};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];if(1===n.nodeType&&"axis"===n.nodeName){let e=n.getElementsByTagName("param")[0];t.axis=e.textContent;let r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substr(0,r.length-1)}}return t}(n))}eo.kinematicsScenes[u(e.getAttribute("url"))]=t}),p(eo.animations,f),p(eo.clips,b),p(eo.controllers,w),p(eo.images,C),p(eo.effects,T),p(eo.materials,F),p(eo.cameras,P),p(eo.lights,_),p(eo.geometries,R),p(eo.visualScenes,J),function(){let e=eo.clips;if(!0===d(e)){if(!1===d(eo.animations)){let e=[];for(let t in eo.animations){let r=g(t);for(let t=0,n=r.length;t<n;t++)e.push(r[t])}en.push(new ee.m7l("default",-1,e))}}else for(let t in e)en.push(A(eo.clips[t],b))}(),function(){let e=Object.keys(eo.kinematicsModels)[0],t=Object.keys(eo.kinematicsScenes)[0],r=Object.keys(eo.visualScenes)[0];if(void 0===e||void 0===t)return;let n=A(eo.kinematicsModels[e],k),a=A(eo.kinematicsScenes[t],Q),s=q(r),o=a.bindJointAxis,l={};for(let e=0,t=o.length;e<t;e++){let t=o[e],r=$.querySelector('[sid="'+t.target+'"]');if(r){let e=r.parentElement;(function(e,t){let r=t.getAttribute("name"),a=n.joints[e];s.traverse(function(n){n.name===r&&(l[e]={object:n,transforms:function(e){let t=[],r=$.querySelector('[id="'+e.id+'"]');for(let e=0;e<r.childNodes.length;e++){let n,a;let s=r.childNodes[e];if(1===s.nodeType)switch(s.nodeName){case"matrix":n=h(s.textContent);let o=new ee.yGw().fromArray(n).transpose();t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:o});break;case"translate":case"scale":n=h(s.textContent),a=new ee.Pa4().fromArray(n),t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a});break;case"rotate":n=h(s.textContent),a=new ee.Pa4().fromArray(n);let l=ee.M8C.degToRad(n[3]);t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a,angle:l})}}return t}(t),joint:a,position:a.zeroPosition})})})(t.jointIndex,e)}}let c=new ee.yGw;ea={joints:n&&n.joints,getJointValue:function(e){let t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){let r=l[e];if(r){let n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{let a=r.object,s=n.axis,o=r.transforms;O.identity();for(let r=0;r<o.length;r++){let a=o[r];if(a.sid&&-1!==a.sid.indexOf(e))switch(n.type){case"revolute":O.multiply(c.makeRotationAxis(s,ee.M8C.degToRad(t)));break;case"prismatic":O.multiply(c.makeTranslation(s.x*t,s.y*t,s.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(a.type){case"matrix":O.multiply(a.obj);break;case"translate":O.multiply(c.makeTranslation(a.obj.x,a.obj.y,a.obj.z));break;case"scale":O.scale(a.obj);break;case"rotate":O.multiply(c.makeRotationAxis(a.obj,a.angle))}}a.matrix.copy(O),a.matrix.decompose(a.position,a.quaternion,a.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();let el=(n=l($,"scene")[0],q(u(l(n,"instance_visual_scene")[0].getAttribute("url"))));return el.animations=en,"Z_UP"===ei.upAxis&&el.quaternion.setFromEuler(new ee.USm(-Math.PI/2,0,0)),el.scale.multiplyScalar(ei.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),en},kinematics:ea,library:eo,scene:el}}}class c8 extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=new ee.lLk;t.setURLModifier(function(e){let t=function(e){for(let t in r)if(t.substr(-e.length)===e)return r[t]}(e);if(t){console.log("Loading",e);let r=new Blob([t.buffer],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e});let r=ri(new Uint8Array(e));if(r["doc.kml"]){let e=new DOMParser().parseFromString(fflate.strFromU8(r["doc.kml"]),"application/xml").querySelector("Placemark Model Link href");if(e)return new c5(t).parse(fflate.strFromU8(r[e.textContent]))}else for(let e in console.warn("KMZLoader: Missing doc.kml file."),r)if("dae"===e.split(".").pop().toLowerCase())return new c5(t).parse(fflate.strFromU8(r[e]));return console.error("KMZLoader: Couldn't find .dae file."),{scene:new ee.ZAu}}}class c6 extends ee.aNw{constructor(e){super(e),this.gltfLoader=new ln.E(e)}load(e,t,r,n){let a=this;this.gltfLoader.load(e,function(r){try{a.parse(r,t)}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}setDRACOLoader(e){return this.gltfLoader.setDRACOLoader(e),this}parse(e,t){t(e)}}var c9=r(33803);class c7 extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=""===a.path?ee.Zp0.extractUrlBase(e):a.path,o=new ee.hH6(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(r){try{t(a.parse(r,s))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){let r={};function n(e,t){let r=[],n=0;for(let a=0,s=e.length;a<s;a++){let o=e[n],l=e[a+(t?1:2)],h=e[a+(t?2:1)];r.push(o,l,h),(-1===e[a+3]||a+3>=s)&&(a+=3,n=a+1)}return r}function a(e,t){let r=[],n=0;for(let a=0,s=t.length;a<s;a++){let o=3*n,l=e[o],h=e[o+1],c=e[o+2];r.push(l,h,c),(-1===t[a+3]||a+3>=s)&&(a+=3,n++)}return r}function s(e,t){let r=[];for(let n=0,a=t.length;n<a;n++){let a=3*t[n],s=e[a],o=e[a+1],l=e[a+2];r.push(s,o,l)}return r}function o(e){let t=[];for(let r=0,n=e.length;r<n;r++){let a=e[r],s=e[r+1];t.push(a,s),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function l(e,t){let r=[],n=0;for(let a=0,s=t.length;a<s;a++){let o=3*n,l=e[o],h=e[o+1],c=e[o+2];r.push(l,h,c),(-1===t[a+2]||a+2>=s)&&(a+=2,n++)}return r}let h=new ee.Pa4,c=new ee.Pa4,u=new ee.Pa4,d=new ee.FM8,m=new ee.FM8,p=new ee.FM8;function A(e,t,r,n){let a=[];for(let s=0,o=e.length;s<o;s+=3){let e=t[s],o=t[s+1],l=t[s+2];2===n?(d.fromArray(r,e*n),m.fromArray(r,o*n),p.fromArray(r,l*n),a.push(d.x,d.y),a.push(m.x,m.y),a.push(p.x,p.y)):(h.fromArray(r,e*n),c.fromArray(r,o*n),u.fromArray(r,l*n),a.push(h.x,h.y,h.z),a.push(c.x,c.y,c.z),a.push(u.x,u.y,u.z))}return new ee.a$l(a,n)}function f(e,t){let r=[];for(let n=0,a=0,s=e.length;n<s;n+=3,a++)h.fromArray(t,3*a),r.push(h.x,h.y,h.z),r.push(h.x,h.y,h.z),r.push(h.x,h.y,h.z);return new ee.a$l(r,3)}function g(e,t){let r=[];for(let n=0,a=0,s=e.length;n<s;n+=2,a++)h.fromArray(t,3*a),r.push(h.x,h.y,h.z),r.push(h.x,h.y,h.z);return new ee.a$l(r,3)}function v(e,t){let r=t.array,n=t.itemSize,a=new r.constructor(e.length*n),s=0,o=0;for(let t=0,l=e.length;t<l;t++){s=e[t]*n;for(let e=0;e<n;e++)a[o++]=r[s++]}return new ee.a$l(a,n)}let y=new ee.Pa4,x=new ee.Pa4;function b(e,t,r){let n=[],a={};for(let r=0,s=e.length;r<s;r+=3){let s=e[r],o=e[r+1],l=e[r+2],d=new ui(s,o,l);h.fromArray(t,3*s),c.fromArray(t,3*o),u.fromArray(t,3*l),x.subVectors(u,c),y.subVectors(h,c),x.cross(y),x.normalize(),d.normal.copy(x),void 0===a[s]&&(a[s]=[]),void 0===a[o]&&(a[o]=[]),void 0===a[l]&&(a[l]=[]),a[s].push(d.normal),a[o].push(d.normal),a[l].push(d.normal),n.push(d)}let s=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],l=w(a[o.a],o.normal,r),d=w(a[o.b],o.normal,r),m=w(a[o.c],o.normal,r);h.fromArray(t,3*o.a),c.fromArray(t,3*o.b),u.fromArray(t,3*o.c),s.push(l.x,l.y,l.z),s.push(d.x,d.y,d.z),s.push(m.x,m.y,m.z)}return new ee.a$l(s,3)}function w(e,t,r){let n=new ee.Pa4;if(0===r)n.copy(t);else for(let a=0,s=e.length;a<s;a++)e[a].angleTo(t)<r&&n.add(e[a]);return n.normalize()}function C(e){let t=[];for(let r=0,n=e.length;r<n;r+=3)t.push(new ee.Ilk(e[r],e[r+1],e[r+2]));return t}function E(e,t,r,n,a){let s=[],o=!0===a?0:Math.PI;for(let e=0,l=n.length;e<l;e++){let n=0===e?0:r[e-1];n=!0===a?n:o-n;let l=new ee.Pa4;l.setFromSphericalCoords(t,n,0),s.push(l)}let l=e.index,h=e.attributes.position,c=new ee.TlE(new Float32Array(3*e.attributes.position.count),3),u=new ee.Pa4,d=new ee.Ilk;for(let e=0;e<l.count;e++){let t,r;let o=l.getX(e);u.fromBufferAttribute(h,o);let m=1;for(let e=1;e<s.length;e++){t=e-1,r=e;let n=s[t],o=s[r];if(!0===a){if(u.y<=n.y&&u.y>o.y){m=Math.abs(n.y-u.y)/Math.abs(n.y-o.y);break}}else if(u.y>=n.y&&u.y<o.y){m=Math.abs(n.y-u.y)/Math.abs(n.y-o.y);break}}let p=n[t],A=n[r];d.copy(p).lerp(A,m),c.setXYZ(o,d.r,d.g,d.b)}e.setAttribute("color",c)}let I=new ee.dpR(this.manager);if(I.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),-1===e.indexOf("#VRML V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){let t=e.nodes,h=new ee.xsS;for(let e=0,n=t.length;e<n;e++)!function e(t){t.DEF&&(r[t.DEF]=t);let n=t.fields;for(let t=0,r=n.length;t<r;t++){let r=n[t];if("node"===r.type){let t=r.values;for(let r=0,n=t.length;r<n;r++)e(t[r])}}}(t[e]);for(let e=0,c=t.length;e<c;e++){let c=t[e],u=function e(t){return t.USE?function(t){let n=e(r[t]);return n.isObject3D||n.isMaterial?n.clone():n}(t.USE):(void 0!==t.build||(t.build=function(t){let r;let h=t.name;switch(h){case"Group":case"Transform":case"Collision":r=function(t){let r=new ee.ZAu,n=t.fields;for(let t=0,a=n.length;t<a;t++){let a=n[t],s=a.name,o=a.values;switch(s){case"bboxCenter":case"bboxSize":case"center":case"collide":case"scaleOrientation":case"proxy":break;case"children":(function(t,r){for(let n=0,a=t.length;n<a;n++){let a=e(t[n]);a instanceof ee.Tme&&r.add(a)}})(o,r);break;case"rotation":let l=new ee.Pa4(o[0],o[1],o[2]).normalize(),h=o[3];r.quaternion.setFromAxisAngle(l,h);break;case"scale":r.scale.set(o[0],o[1],o[2]);break;case"translation":r.position.set(o[0],o[1],o[2]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return r}(t);break;case"Background":r=function(e){let t,r,n,a;let s=new ee.ZAu,o=e.fields;for(let e=0,s=o.length;e<s;e++){let s=o[e],l=s.name,h=s.values;switch(l){case"groundAngle":t=h;break;case"groundColor":r=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":n=h;break;case"skyColor":a=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(a){let e=new ee.xo$(1e4,32,16),t=new ee.vBJ({fog:!1,side:ee._Li,depthWrite:!1,depthTest:!1});a.length>3?(E(e,1e4,n,C(a),!0),t.vertexColors=!0):t.color.setRGB(a[0],a[1],a[2]);let r=new ee.Kj0(e,t);s.add(r)}if(r&&r.length>0){let e=new ee.xo$(1e4,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),n=new ee.vBJ({fog:!1,side:ee._Li,vertexColors:!0,depthWrite:!1,depthTest:!1});E(e,1e4,t,C(r),!1);let a=new ee.Kj0(e,n);s.add(a)}return s.renderOrder=-1/0,s}(t);break;case"Shape":r=function(t){let r,n;let a=t.fields,s=new ee.vBJ({color:0});for(let t=0,n=a.length;t<n;t++){let n=a[t],o=n.name,l=n.values;switch(o){case"appearance":null!==l[0]&&(s=e(l[0]));break;case"geometry":null!==l[0]&&(r=e(l[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}if(r&&r.attributes.position){let e=r._type;if("points"===e){let e=new ee.UY4({color:16777215});void 0!==r.attributes.color?e.vertexColors=!0:s.isMeshPhongMaterial&&e.color.copy(s.emissive),n=new ee.woe(r,e)}else if("line"===e){let e=new ee.nls({color:16777215});void 0!==r.attributes.color?e.vertexColors=!0:s.isMeshPhongMaterial&&e.color.copy(s.emissive),n=new ee.ejS(r,e)}else void 0!==r._solid&&(s.side=r._solid?ee.Wl3:ee.ehD),void 0!==r.attributes.color&&(s.vertexColors=!0),n=new ee.Kj0(r,s)}else(n=new ee.Tme).visible=!1;return n}(t);break;case"Appearance":r=function(t){let r,n=new ee.xoR,a=t.fields;for(let t=0,s=a.length;t<s;t++){let s=a[t],o=s.name,l=s.values;switch(o){case"material":if(null!==l[0]){let t=e(l[0]);t.diffuseColor&&n.color.copy(t.diffuseColor),t.emissiveColor&&n.emissive.copy(t.emissiveColor),t.shininess&&(n.shininess=t.shininess),t.specularColor&&n.specular.copy(t.specularColor),t.transparency&&(n.opacity=1-t.transparency),t.transparency>0&&(n.transparent=!0)}else n=new ee.vBJ({color:0});break;case"texture":let h=l[0];null!==h&&("ImageTexture"===h.name||"PixelTexture"===h.name)&&(n.map=e(h));break;case"textureTransform":null!==l[0]&&(r=e(l[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}if(n.map){if(n.map.__type){switch(n.map.__type){case ur.INTENSITY_ALPHA:n.opacity=1;break;case ur.RGB:n.color.set(16777215);break;case ur.RGBA:n.color.set(16777215),n.opacity=1}delete n.map.__type}r&&(n.map.center.copy(r.center),n.map.rotation=r.rotation,n.map.repeat.copy(r.scale),n.map.offset.copy(r.translation))}return n}(t);break;case"Material":r=function(e){let t={},r=e.fields;for(let e=0,n=r.length;e<n;e++){let n=r[e],a=n.name,s=n.values;switch(a){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new ee.Ilk(s[0],s[1],s[2]);break;case"emissiveColor":case"specularColor":t.emissiveColor=new ee.Ilk(s[0],s[1],s[2]);break;case"shininess":t.shininess=s[0];break;case"transparency":t.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}return t}(t);break;case"ImageTexture":r=function(e){let t;let r=ee.rpg,n=ee.rpg,a=e.fields;for(let e=0,s=a.length;e<s;e++){let s=a[e],o=s.name,l=s.values;switch(o){case"url":let h=l[0];h&&(t=I.load(h));break;case"repeatS":!1===l[0]&&(r=ee.uWy);break;case"repeatT":!1===l[0]&&(n=ee.uWy);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t&&(t.wrapS=r,t.wrapT=n),t}(t);break;case"PixelTexture":r=function(e){let t;let r=ee.rpg,n=ee.rpg,a=e.fields;for(let e=0,s=a.length;e<s;e++){let s=a[e],o=s.name,l=s.values;switch(o){case"image":let h=l[0],c=l[1],u=function(e){let t;switch(e){case 1:t=ur.INTENSITY;break;case 2:t=ur.INTENSITY_ALPHA;break;case 3:t=ur.RGB;break;case 4:t=ur.RGBA}return t}(l[2]),d=new Uint8Array(4*h*c),m={r:0,g:0,b:0,a:0};for(let e=3,t=0,r=l.length;e<r;e++,t++){!function(e,t,r){let n;switch(t){case ur.INTENSITY:n=parseInt(e),r.r=n,r.g=n,r.b=n,r.a=1;break;case ur.INTENSITY_ALPHA:n=parseInt("0x"+e.substring(2,4)),r.r=n,r.g=n,r.b=n,r.a=parseInt("0x"+e.substring(4,6));break;case ur.RGB:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=1;break;case ur.RGBA:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=parseInt("0x"+e.substring(8,10))}}(l[e],u,m);let r=4*t;d[r+0]=m.r,d[r+1]=m.g,d[r+2]=m.b,d[r+3]=m.a}(t=new ee.IEO(d,h,c)).needsUpdate=!0,t.__type=u;break;case"repeatS":!1===l[0]&&(r=ee.uWy);break;case"repeatT":!1===l[0]&&(n=ee.uWy);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t&&(t.wrapS=r,t.wrapT=n),t}(t);break;case"TextureTransform":r=function(e){let t={center:new ee.FM8,rotation:new ee.FM8,scale:new ee.FM8,translation:new ee.FM8},r=e.fields;for(let e=0,n=r.length;e<n;e++){let n=r[e],a=n.name,s=n.values;switch(a){case"center":t.center.set(s[0],s[1]);break;case"rotation":t.rotation=s[0];break;case"scale":t.scale.set(s[0],s[1]);break;case"translation":t.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}return t}(t);break;case"IndexedFaceSet":r=function(t){let r,o,l,h,c,u,d,m,p,g,y;let x=!0,w=!0,C=0,E=!0,I=!0,M=t.fields;for(let t=0,n=M.length;t<n;t++){let n=M[t],a=n.name,s=n.values;switch(a){case"color":let p=s[0];null!==p&&(r=e(p));break;case"coord":let A=s[0];null!==A&&(o=e(A));break;case"normal":let f=s[0];null!==f&&(l=e(f));break;case"texCoord":let g=s[0];null!==g&&(h=e(g));break;case"ccw":x=s[0];break;case"colorIndex":c=s;break;case"colorPerVertex":E=s[0];break;case"convex":break;case"coordIndex":u=s;break;case"creaseAngle":C=s[0];break;case"normalIndex":d=s;break;case"normalPerVertex":I=s[0];break;case"solid":w=s[0];break;case"texCoordIndex":m=s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}if(void 0===u)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new ee.u9r;let B=n(u,x);r&&(p=!0===E?c&&c.length>0?A(B,n(c,x),r,3):v(B,new ee.a$l(r,3)):c&&c.length>0?f(B,a(s(r,c),u)):f(B,a(r,u))),g=l?!0===I?d&&d.length>0?A(B,n(d,x),l,3):v(B,new ee.a$l(l,3)):d&&d.length>0?f(B,a(s(l,d),u)):f(B,a(l,u)):b(B,o,C),h&&(y=m&&m.length>0?A(B,n(m,x),h,2):v(B,new ee.a$l(h,2)));let S=new ee.u9r,T=v(B,new ee.a$l(o,3));return S.setAttribute("position",T),S.setAttribute("normal",g),p&&S.setAttribute("color",p),y&&S.setAttribute("uv",y),S._solid=w,S._type="mesh",S}(t);break;case"IndexedLineSet":r=function(t){let r,n,a,h,c;let u=!0,d=t.fields;for(let t=0,s=d.length;t<s;t++){let s=d[t],o=s.name,l=s.values;switch(o){case"color":let c=l[0];null!==c&&(r=e(c));break;case"coord":let m=l[0];null!==m&&(n=e(m));break;case"colorIndex":a=l;break;case"colorPerVertex":u=l[0];break;case"coordIndex":h=l;break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}let m=o(h);r&&(c=!0===u?a.length>0?A(m,o(a),r,3):v(m,new ee.a$l(r,3)):a.length>0?g(m,l(s(r,a),h)):g(m,l(r,h)));let p=new ee.u9r,f=v(m,new ee.a$l(n,3));return p.setAttribute("position",f),c&&p.setAttribute("color",c),p._type="line",p}(t);break;case"PointSet":r=function(t){let r,n;let a=t.fields;for(let t=0,s=a.length;t<s;t++){let s=a[t],o=s.name,l=s.values;switch(o){case"color":let h=l[0];null!==h&&(r=e(h));break;case"coord":let c=l[0];null!==c&&(n=e(c));break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}let s=new ee.u9r;return s.setAttribute("position",new ee.a$l(n,3)),r&&s.setAttribute("color",new ee.a$l(r,3)),s._type="points",s}(t);break;case"Box":r=function(e){let t=new ee.Pa4(2,2,2),r=e.fields;for(let e=0,n=r.length;e<n;e++){let n=r[e],a=n.name,s=n.values;"size"===a?(t.x=s[0],t.y=s[1],t.z=s[2]):console.warn("THREE.VRMLLoader: Unknown field:",a)}return new ee.DvJ(t.x,t.y,t.z)}(t);break;case"Cone":r=function(e){let t=1,r=2,n=!1,a=e.fields;for(let e=0,s=a.length;e<s;e++){let s=a[e],o=s.name,l=s.values;switch(o){case"bottom":n=!l[0];break;case"bottomRadius":t=l[0];break;case"height":r=l[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new ee.b_z(t,r,16,1,n)}(t);break;case"Cylinder":r=function(e){let t=1,r=2,n=e.fields;for(let e=0,a=n.length;e<a;e++){let a=n[e],s=a.name,o=a.values;switch(s){case"bottom":case"side":case"top":break;case"radius":t=o[0];break;case"height":r=o[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new ee.fHI(t,t,r,16,1)}(t);break;case"Sphere":r=function(e){let t=1,r=e.fields;for(let e=0,n=r.length;e<n;e++){let n=r[e],a=n.name,s=n.values;"radius"===a?t=s[0]:console.warn("THREE.VRMLLoader: Unknown field:",a)}return new ee.xo$(t,16,16)}(t);break;case"ElevationGrid":r=function(t){let r,n,a,s,o,l;let h=!0,c=!0,u=!0,d=!0,m=0,p=2,A=2,f=1,g=1,y=t.fields;for(let t=0,o=y.length;t<o;t++){let o=y[t],l=o.name,v=o.values;switch(l){case"color":let x=v[0];null!==x&&(r=e(x));break;case"normal":let b=v[0];null!==b&&(n=e(b));break;case"texCoord":let w=v[0];null!==w&&(a=e(w));break;case"height":s=v;break;case"ccw":d=v[0];break;case"colorPerVertex":h=v[0];break;case"creaseAngle":m=v[0];break;case"normalPerVertex":c=v[0];break;case"solid":u=v[0];break;case"xDimension":p=v[0];break;case"xSpacing":f=v[0];break;case"zDimension":A=v[0];break;case"zSpacing":g=v[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}let x=[],w=[],C=[],E=[];for(let e=0;e<A;e++)for(let t=0;t<p;t++){let o=e*p+t,l=f*e,u=s[o],d=g*t;if(x.push(l,u,d),r&&!0===h){let e=r[3*o+0],t=r[3*o+1],n=r[3*o+2];C.push(e,t,n)}if(n&&!0===c){let e=n[3*o+0],t=n[3*o+1],r=n[3*o+2];w.push(e,t,r)}if(a){let e=a[2*o+0],t=a[2*o+1];E.push(e,t)}else E.push(e/(p-1),t/(A-1))}let I=[];for(let e=0;e<p-1;e++)for(let t=0;t<A-1;t++){let r=e+t*p,n=e+(t+1)*p,a=e+1+(t+1)*p,s=e+1+t*p;!0===d?(I.push(r,a,n),I.push(a,r,s)):(I.push(r,n,a),I.push(a,s,r))}let M=v(I,new ee.a$l(x,3)),B=v(I,new ee.a$l(E,2));if(r){if(!1===h){for(let e=0;e<p-1;e++)for(let t=0;t<A-1;t++){let n=e+t*(p-1),a=r[3*n+0],s=r[3*n+1],o=r[3*n+2];C.push(a,s,o),C.push(a,s,o),C.push(a,s,o),C.push(a,s,o),C.push(a,s,o),C.push(a,s,o)}o=new ee.a$l(C,3)}else o=v(I,new ee.a$l(C,3))}if(n){if(!1===c){for(let e=0;e<p-1;e++)for(let t=0;t<A-1;t++){let r=e+t*(p-1),a=n[3*r+0],s=n[3*r+1],o=n[3*r+2];w.push(a,s,o),w.push(a,s,o),w.push(a,s,o),w.push(a,s,o),w.push(a,s,o),w.push(a,s,o)}l=new ee.a$l(w,3)}else l=v(I,new ee.a$l(w,3))}else l=b(I,x,m);let S=new ee.u9r;return S.setAttribute("position",M),S.setAttribute("normal",l),S.setAttribute("uv",B),o&&S.setAttribute("color",o),S._solid=u,S._type="mesh",S}(t);break;case"Extrusion":r=function(e){let t,r,n=[1,1,1,-1,-1,-1,-1,1,1,1],a=[0,0,0,0,1,0],s=!0,o=!0,l=0,h=!0,c=!0,u=e.fields;for(let e=0,d=u.length;e<d;e++){let d=u[e],m=d.name,p=d.values;switch(m){case"beginCap":s=p[0];break;case"ccw":o=p[0];break;case"convex":break;case"creaseAngle":l=p[0];break;case"crossSection":n=p;break;case"endCap":h=p[0];break;case"orientation":r=p;break;case"scale":t=p;break;case"solid":c=p[0];break;case"spine":a=p;break;default:console.warn("THREE.VRMLLoader: Unknown field:",m)}}let d=n[0]===n[n.length-2]&&n[1]===n[n.length-1],m=[],p=new ee.Pa4,A=new ee.Pa4,f=new ee.Pa4,g=new ee.Pa4,y=new ee._fP;for(let e=0,s=0,o=0,l=a.length;e<l;e+=3,s+=2,o+=4){p.fromArray(a,e),A.x=t?t[s+0]:1,A.y=1,A.z=t?t[s+1]:1,f.x=r?r[o+0]:0,f.y=r?r[o+1]:0,f.z=r?r[o+2]:1;let l=r?r[o+3]:0;for(let e=0,t=n.length;e<t;e+=2)g.x=n[e+0],g.y=0,g.z=n[e+1],g.multiply(A),y.setFromAxisAngle(f,l),g.applyQuaternion(y),g.add(p),m.push(g.x,g.y,g.z)}let x=[],w=a.length/3,C=n.length/2;for(let e=0;e<w-1;e++)for(let t=0;t<C-1;t++){let r=t+e*C,n=t+1+e*C,a=t+(e+1)*C,s=t+1+(e+1)*C;t===C-2&&!0===d&&(n=e*C,s=(e+1)*C),!0===o?(x.push(r,n,a),x.push(a,n,s)):(x.push(r,a,n),x.push(a,s,n))}if(!0===s||!0===h){let e=[];for(let t=0,r=n.length;t<r;t+=2)e.push(new ee.FM8(n[t],n[t+1]));let t=ee.iDF.triangulateShape(e,[]),r=[];for(let e=0,n=t.length;e<n;e++){let n=t[e];r.push(n[0],n[1],n[2])}if(!0===s)for(let e=0,t=r.length;e<t;e+=3)!0===o?x.push(r[e+0],r[e+1],r[e+2]):x.push(r[e+0],r[e+2],r[e+1]);if(!0===h){let e=C*(w-1);for(let t=0,n=r.length;t<n;t+=3)!0===o?x.push(e+r[t+0],e+r[t+2],e+r[t+1]):x.push(e+r[t+0],e+r[t+1],e+r[t+2])}}let E=v(x,new ee.a$l(m,3)),I=b(x,m,l),M=new ee.u9r;return M.setAttribute("position",E),M.setAttribute("normal",I),M._solid=c,M._type="mesh",M}(t);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":r=t.fields[0].values;break;case"WorldInfo":r=function(e){let t={},r=e.fields;for(let e=0,n=r.length;e<n;e++){let n=r[e],a=n.name,s=n.values;switch(a){case"title":t.title=s[0];break;case"info":t.info=s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",a)}}return t}(t);break;case"Anchor":case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",h)}return void 0!==r&&void 0!==t.DEF&&!0===r.hasOwnProperty("name")&&(r.name=t.DEF),r}(t)),t.build)}(c);u instanceof ee.Tme&&h.add(u),"WorldInfo"===c.name&&(h.userData.worldInfo=u)}return h}(function(e){let t=function(){let e=(0,c9.V3)({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),t=(0,c9.V3)({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:e}),r=(0,c9.V3)({name:"Version",pattern:/#VRML.*/,longer_alt:t}),n=(0,c9.V3)({name:"NodeName",pattern:RegExp("Anchor|Billboard|Collision|Group|Transform|Inline|LOD|Switch|AudioClip|DirectionalLight|PointLight|Script|Shape|Sound|SpotLight|WorldInfo|CylinderSensor|PlaneSensor|ProximitySensor|SphereSensor|TimeSensor|TouchSensor|VisibilitySensor|Box|Cone|Cylinder|ElevationGrid|Extrusion|IndexedFaceSet|IndexedLineSet|PointSet|Sphere|Color|Coordinate|Normal|TextureCoordinate|Appearance|FontStyle|ImageTexture|Material|MovieTexture|PixelTexture|TextureTransform|ColorInterpolator|CoordinateInterpolator|NormalInterpolator|OrientationInterpolator|PositionInterpolator|ScalarInterpolator|Background|Fog|NavigationInfo|Viewpoint|Text"),longer_alt:t}),a=(0,c9.V3)({name:"DEF",pattern:/DEF/,longer_alt:t}),s=(0,c9.V3)({name:"USE",pattern:/USE/,longer_alt:t}),o=(0,c9.V3)({name:"ROUTE",pattern:/ROUTE/,longer_alt:t}),l=(0,c9.V3)({name:"TO",pattern:/TO/,longer_alt:t}),h=(0,c9.V3)({name:"StringLiteral",pattern:/"(?:[^\\"\n\r]|\\[bfnrtv"\\/]|\\u[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F])*"/}),c=(0,c9.V3)({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),u=(0,c9.V3)({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),d=(0,c9.V3)({name:"TrueLiteral",pattern:/TRUE/}),m=(0,c9.V3)({name:"FalseLiteral",pattern:/FALSE/}),p=(0,c9.V3)({name:"NullLiteral",pattern:/NULL/}),A=(0,c9.V3)({name:"LSquare",pattern:/\[/}),f=(0,c9.V3)({name:"RSquare",pattern:/]/}),g=(0,c9.V3)({name:"LCurly",pattern:/{/}),v=(0,c9.V3)({name:"RCurly",pattern:/}/}),y=(0,c9.V3)({name:"Comment",pattern:/#.*/,group:c9.hW.SKIPPED}),x=[(0,c9.V3)({name:"WhiteSpace",pattern:/[ ,\s]/,group:c9.hW.SKIPPED}),n,a,s,o,l,d,m,p,r,t,e,h,c,u,A,f,g,v,y],b={};for(let e=0,t=x.length;e<t;e++){let t=x[e];b[t.name]=t}return{tokens:x,tokenVocabulary:b}}(),r=new ue(t.tokens),n=new ut(t.tokenVocabulary),a=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){let r={type:null,values:[]};if(t.node){r.type="node";for(let n=0,a=t.node.length;n<a;n++){let a=t.node[n];r.values.push(e.visit(a))}}if(t.use){r.type="use";for(let n=0,a=t.use.length;n<a;n++){let a=t.use[n];r.values.push(e.visit(a))}}if(t.StringLiteral){r.type="string";for(let e=0,n=t.StringLiteral.length;e<n;e++){let n=t.StringLiteral[e];r.values.push(n.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(let e=0,n=t.NumberLiteral.length;e<n;e++){let n=t.NumberLiteral[e];r.values.push(parseFloat(n.image))}}if(t.HexLiteral){r.type="hex";for(let e=0,n=t.HexLiteral.length;e<n;e++){let n=t.HexLiteral[e];r.values.push(n.image)}}if(t.TrueLiteral){r.type="boolean";for(let e=0,n=t.TrueLiteral.length;e<n;e++)"TRUE"===t.TrueLiteral[e].image&&r.values.push(!0)}if(t.FalseLiteral){r.type="boolean";for(let e=0,n=t.FalseLiteral.length;e<n;e++)"FALSE"===t.FalseLiteral[e].image&&r.values.push(!1)}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach(function(){r.values.push(null)})),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){let t={version:this.visit(e.version),nodes:[],routes:[]};for(let r=0,n=e.node.length;r<n;r++){let n=e.node[r];t.nodes.push(this.visit(n))}if(e.route)for(let r=0,n=e.route.length;r<n;r++){let n=e.route[r];t.routes.push(this.visit(n))}return t},version:function(e){return e.Version[0].image},node:function(e){let t={name:e.NodeName[0].image,fields:[]};if(e.field)for(let r=0,n=e.field.length;r<n;r++){let n=e.field[r];t.fields.push(this.visit(n))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){let t;let r={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),r.type=t.type,r.values=t.values,r},def:function(e){return(e.Identifier||e.NodeName)[0].image},use:function(e){return{USE:(e.Identifier||e.NodeName)[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(n.getBaseCstVisitorConstructor()),s=r.lex(e);n.input=s.tokens;let o=n.vrml();if(n.errors.length>0)throw console.error(n.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return a.visit(o)}(e))}}class ue{constructor(e){this.lexer=new c9.hW(e)}lex(e){let t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}}class ut extends c9.wd{constructor(e){super(e);let t=this,r=e.Version,n=e.LCurly,a=e.RCurly,s=e.LSquare,o=e.RSquare,l=e.Identifier,h=e.RouteIdentifier,c=e.StringLiteral,u=e.HexLiteral,d=e.NumberLiteral,m=e.TrueLiteral,p=e.FalseLiteral,A=e.NullLiteral,f=e.DEF,g=e.USE,v=e.ROUTE,y=e.TO,x=e.NodeName;t.RULE("vrml",function(){t.SUBRULE(t.version),t.AT_LEAST_ONE(function(){t.SUBRULE(t.node)}),t.MANY(function(){t.SUBRULE(t.route)})}),t.RULE("version",function(){t.CONSUME(r)}),t.RULE("node",function(){t.OPTION(function(){t.SUBRULE(t.def)}),t.CONSUME(x),t.CONSUME(n),t.MANY(function(){t.SUBRULE(t.field)}),t.CONSUME(a)}),t.RULE("field",function(){t.CONSUME(l),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])}),t.RULE("def",function(){t.CONSUME(f),t.OR([{ALT:function(){t.CONSUME(l)}},{ALT:function(){t.CONSUME(x)}}])}),t.RULE("use",function(){t.CONSUME(g),t.OR([{ALT:function(){t.CONSUME(l)}},{ALT:function(){t.CONSUME(x)}}])}),t.RULE("singleFieldValue",function(){t.AT_LEAST_ONE(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(m)}},{ALT:function(){t.CONSUME(p)}},{ALT:function(){t.CONSUME(A)}}])})}),t.RULE("multiFieldValue",function(){t.CONSUME(s),t.MANY(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(c)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(A)}}])}),t.CONSUME(o)}),t.RULE("route",function(){t.CONSUME(v),t.CONSUME(h),t.CONSUME(y),t.CONSUME2(h)}),this.performSelfAnalysis()}}class ui{constructor(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new ee.Pa4}}let ur={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};class un{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return -1}_onMessage(e,t){let r=this.workersResolve[e];if(r&&r(t),this.queue.length){let{resolve:t,msg:r,transfer:n}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,n)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(r=>{let n=this._getIdleWorker();-1!==n?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=r,this.workers[n].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}var ua=r(10536).lW;class us{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class uo{constructor(e,t,r,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e+4294967296*t}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);let r=this._offset,n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}let ul=[171,75,84,88,32,50,48,187,13,10,26,10];function uh(e){return"undefined"!=typeof TextDecoder?new TextDecoder().decode(e):ua.from(e).toString("utf8")}var uc=r(10536).lW;let uu={env:{emscripten_notify_memory_growth:function(e){f=new Uint8Array(A.exports.memory.buffer)}}};class ud{init(){return p||("undefined"!=typeof fetch?p=fetch("data:application/wasm;base64,"+um).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,uu)).then(this._init):p=WebAssembly.instantiate(uc.from(um,"base64"),uu).then(this._init)),p}_init(e){A=e.instance,uu.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!A)throw Error("ZSTDDecoder: Await .init() before decoding.");let r=e.byteLength,n=A.exports.malloc(r);f.set(e,n),t=t||Number(A.exports.ZSTD_findDecompressedSize(n,r));let a=A.exports.malloc(t),s=A.exports.ZSTD_decompress(a,t,n,r),o=f.slice(a,a+s);return A.exports.free(n),A.exports.free(a),o}}let um="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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";class up extends ee.EB7{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,ee.fY$),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class uA extends ee.EB7{constructor(e,t,r,n,a,s){super(e,t,r,a,s),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ee.uWy}}var uf=Object.defineProperty,ug=(e,t,r)=>t in e?uf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uv=(e,t,r)=>(ug(e,"symbol"!=typeof t?t+"":t,r),r);let uy="srgb",ux=new WeakMap,ub=0,uw=class extends ee.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new un,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){let e=new ee.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=e.loadAsync("basis_transcoder.js"),r=new ee.hH6(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);let n=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([e,t])=>{let r=uw.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(uw.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(uw.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(uw.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{let e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),ub>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),ub++}return this.transcoderPending}load(e,t,r,n){if(null===this.workerConfig)throw Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let a=new ee.hH6(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(e,e=>{if(ux.has(e))return ux.get(e).promise.then(t).catch(n);this._createTexture(e).then(e=>t?t(e):null).catch(n)},r,n)}_createTextureFrom(e,t){let r;let{faces:n,width:a,height:s,format:o,type:l,error:h,dfdFlags:c}=e;if("error"===l)return Promise.reject(h);if(6===t.faceCount)r=new up(n,o,ee.ywz);else{let e=n[0].mipmaps;r=t.layerCount>1?new uA(e,a,s,t.layerCount,o,ee.ywz):new ee.EB7(e,a,s,o,ee.ywz)}r.minFilter=1===n[0].mipmaps.length?ee.wem:ee.D1R,r.magFilter=ee.wem,r.generateMipmaps=!1,r.needsUpdate=!0;let u=uS(t);return"colorSpace"in r?r.colorSpace=u:r.encoding=u===uy?3001:3e3,r.premultiplyAlpha=!!(1&c),r}async _createTexture(e,t={}){let r=function(e){let t=new Uint8Array(e.buffer,e.byteOffset,ul.length);if(t[0]!==ul[0]||t[1]!==ul[1]||t[2]!==ul[2]||t[3]!==ul[3]||t[4]!==ul[4]||t[5]!==ul[5]||t[6]!==ul[6]||t[7]!==ul[7]||t[8]!==ul[8]||t[9]!==ul[9]||t[10]!==ul[10]||t[11]!==ul[11])throw Error("Missing KTX 2.0 identifier.");let r=new us,n=17*Uint32Array.BYTES_PER_ELEMENT,a=new uo(e,ul.length,n,!0);r.vkFormat=a._nextUint32(),r.typeSize=a._nextUint32(),r.pixelWidth=a._nextUint32(),r.pixelHeight=a._nextUint32(),r.pixelDepth=a._nextUint32(),r.layerCount=a._nextUint32(),r.faceCount=a._nextUint32();let s=a._nextUint32();r.supercompressionScheme=a._nextUint32();let o=a._nextUint32(),l=a._nextUint32(),h=a._nextUint32(),c=a._nextUint32(),u=a._nextUint64(),d=a._nextUint64(),m=new uo(e,ul.length+n,24*s,!0);for(let t=0;t<s;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});let p=new uo(e,o,l,!0),A={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},f=(A.descriptorBlockSize/4-6)/4;for(let e=0;e<f;e++){let t={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=p._nextInt32(),t.sampleUpper=p._nextInt32()):(t.sampleLower=p._nextUint32(),t.sampleUpper=p._nextUint32()),A.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(A);let g=new uo(e,h,c,!0);for(;g._offset<c;){let e=g._nextUint32(),t=g._scan(e),n=uh(t);if(r.keyValue[n]=g._nextUint8Array(e-t.byteLength-1),n.match(/^ktx/i)){let e=uh(r.keyValue[n]);r.keyValue[n]=e.substring(0,e.lastIndexOf("\0"))}let a=e%4?4-e%4:0;g._skip(a)}if(d<=0)return r;let v=new uo(e,u,d,!0),y=v._nextUint16(),x=v._nextUint16(),b=v._nextUint32(),w=v._nextUint32(),C=v._nextUint32(),E=v._nextUint32(),I=[];for(let e=0;e<s;e++)I.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});let M=u+v._offset,B=M+b,S=B+w,T=S+C,F=new Uint8Array(e.buffer,e.byteOffset+M,b),P=new Uint8Array(e.buffer,e.byteOffset+B,w),_=new Uint8Array(e.buffer,e.byteOffset+S,C),D=new Uint8Array(e.buffer,e.byteOffset+T,E);return r.globalData={endpointCount:y,selectorCount:x,imageDescs:I,endpointsData:F,selectorsData:P,tablesData:_,extendedData:D},r}(new Uint8Array(e));if(0!==r.vkFormat)return uB(r);let n=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:t},[e])).then(e=>this._createTextureFrom(e.data,r));return ux.set(e,{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),ub--,this}},uC=uw;uv(uC,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),uv(uC,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),uv(uC,"EngineFormat",{RGBAFormat:ee.wk1,RGBA_ASTC_4x4_Format:ee.ptH,RGBA_BPTC_Format:ee.bsb,RGBA_ETC2_EAC_Format:ee.ekQ,RGBA_PVRTC_4BPPV1_Format:ee.eaV,RGBA_S3TC_DXT5_Format:ee.ILR,RGB_ETC1_Format:ee.fto,RGB_ETC2_Format:ee.l0P,RGB_PVRTC_4BPPV1_Format:ee._AM,RGB_S3TC_DXT1_Format:ee.wuA}),uv(uC,"BasisWorker",function(){let e,t,r;let n=_EngineFormat,a=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(o){let u=o.data;switch(u.type){case"init":var d;e=u.config,d=u.transcoderBinary,t=new Promise(e=>{BASIS(r={wasmBinary:d,onRuntimeInitialized:e})}).then(()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{let{faces:t,buffers:o,width:d,height:m,hasAlpha:p,format:A,dfdFlags:f}=function(t){let o=new r.KTX2File(new Uint8Array(t));function u(){o.close(),o.delete()}if(!o.isValid())throw u(),Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let d=o.isUASTC()?s.UASTC_4x4:s.ETC1S,m=o.getWidth(),p=o.getHeight(),A=o.getLayers()||1,f=o.getLevels(),g=o.getFaces(),v=o.getHasAlpha(),y=o.getDFDFlags(),{transcoderFormat:x,engineFormat:b}=function(t,r,o,u){let d;let m=t===s.ETC1S?l:h;for(let n=0;n<m.length;n++){let a=m[n];if(e[a.if]&&a.basisFormat.includes(t)&&(!u||!(a.transcoderFormat.length<2))&&(!a.needsPowerOfTwo||c(r)&&c(o)))return{transcoderFormat:a.transcoderFormat[u?1:0],engineFormat:a.engineFormat[u?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:a.RGBA32,engineFormat:n.RGBAFormat}}(d,m,p,v);if(!m||!p||!f)throw u(),Error("THREE.KTX2Loader:	Invalid texture");if(!o.startTranscoding())throw u(),Error("THREE.KTX2Loader: .startTranscoding failed");let w=[],C=[];for(let e=0;e<g;e++){let t=[];for(let r=0;r<f;r++){let n,a;let s=[];for(let t=0;t<A;t++){let l=o.getImageLevelInfo(r,t,e);0===e&&0===r&&0===t&&(l.origWidth%4!=0||l.origHeight%4!=0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),f>1?(n=l.origWidth,a=l.origHeight):(n=l.width,a=l.height);let h=new Uint8Array(o.getImageTranscodedSizeInBytes(r,t,0,x));if(!o.transcodeImage(h,r,t,e,x,0,-1,-1))throw u(),Error("THREE.KTX2Loader: .transcodeImage failed.");s.push(h)}let l=function(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let r=new Uint8Array(t),n=0;for(let t=0;t<e.length;t++){let a=e[t];r.set(a,n),n+=a.byteLength}return r}(s);t.push({data:l,width:n,height:a}),C.push(l.buffer)}w.push({mipmaps:t,width:m,height:p,format:b})}return u(),{faces:w,buffers:C,width:m,height:p,hasAlpha:v,format:b,dfdFlags:y}}(u.buffer);self.postMessage({type:"transcode",id:u.id,faces:t,width:d,height:m,hasAlpha:p,format:A,dfdFlags:f},o)}catch(e){console.error(e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});let o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),h=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||(e&e-1)==0&&0!==e}});let uE=new Set([ee.wk1,ee.av9,ee.hEm]),uI={109:ee.wk1,97:ee.wk1,37:ee.wk1,43:ee.wk1,103:ee.av9,83:ee.av9,16:ee.av9,22:ee.av9,100:ee.hEm,76:ee.hEm,15:ee.hEm,9:ee.hEm,166:ee.Djp,165:ee.Djp},uM={109:ee.VzW,97:ee.cLu,37:ee.ywz,43:ee.ywz,103:ee.VzW,83:ee.cLu,16:ee.ywz,22:ee.ywz,100:ee.VzW,76:ee.cLu,15:ee.ywz,9:ee.ywz,166:ee.ywz,165:ee.ywz};async function uB(e){let t,r;let{vkFormat:n}=e;if(void 0===uI[n])throw Error("THREE.KTX2Loader: Unsupported vkFormat.");2===e.supercompressionScheme&&(g||(g=new Promise(async e=>{let t=new ud;await t.init(),e(t)})),t=await g);let a=[];for(let r=0;r<e.levels.length;r++){let s,o;let l=Math.max(1,e.pixelWidth>>r),h=Math.max(1,e.pixelHeight>>r),c=e.pixelDepth?Math.max(1,e.pixelDepth>>r):0,u=e.levels[r];if(0===e.supercompressionScheme)s=u.levelData;else if(2===e.supercompressionScheme)s=t.decode(u.levelData,u.uncompressedByteLength);else throw Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");o=uM[n]===ee.VzW?new Float32Array(s.buffer,s.byteOffset,s.byteLength/Float32Array.BYTES_PER_ELEMENT):uM[n]===ee.cLu?new Uint16Array(s.buffer,s.byteOffset,s.byteLength/Uint16Array.BYTES_PER_ELEMENT):s,a.push({data:o,width:l,height:h,depth:c})}if(uE.has(uI[n]))r=0===e.pixelDepth?new ee.IEO(a[0].data,e.pixelWidth,e.pixelHeight):new cJ(a[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new ee.EB7(a,e.pixelWidth,e.pixelHeight)}r.mipmaps=a,r.type=uM[n],r.format=uI[n],r.needsUpdate=!0;let s=uS(e);return"colorSpace"in r?r.colorSpace=s:r.encoding=s===uy?3001:3e3,Promise.resolve(r)}function uS(e){let t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?uy:"srgb-linear":10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),"")}var uT=r(3530);class uF extends ee.aNw{setQuality(e){this._quality=e}load(e,t,r,n){let a=this._quality||1,s=new ee.ROQ;s.minFilter=ee.TyD;let o=new ee.hH6(this.manager);return o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,function(e){let r=JSON.parse(e),n=document.createElement("div");n.style.width=r.w+"px",n.style.height=r.h+"px",document.body.appendChild(n);let o=uT.Z.loadAnimation({container:n,animType:"canvas",loop:!0,autoplay:!0,animationData:r,rendererSettings:{dpr:a}});s.animation=o,s.image=o.container,o.addEventListener("enterFrame",function(){s.needsUpdate=!0}),n.style.display="none",void 0!==t&&t(s)},r,n),s}}var uP=r(72991);class u_ extends ee.aNw{constructor(e){super(e),this.reversed=!1}load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t((0,uP.Q)(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){return function(e,t){let r=Math.round,n={},a=1e5/(72*(e.unitsPerEm||2048)),s=e.encoding.cmap.glyphIndexMap,o=Object.keys(s);for(let l=0;l<o.length;l++){let h=o[l],c=e.glyphs.glyphs[s[h]];if(void 0!==h){let e={ha:r(c.advanceWidth*a),x_min:r(c.xMin*a),x_max:r(c.xMax*a),o:""};t&&(c.path.commands=function(e){let t;let r=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});let n=[];return r.forEach(function(e){let t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(let t=e.length-1;t>0;t--){let r=e[t],a={type:r.type};void 0!==r.x2&&void 0!==r.y2?(a.x1=r.x2,a.y1=r.y2,a.x2=r.x1,a.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(a.x1=r.x1,a.y1=r.y1),a.x=e[t-1].x,a.y=e[t-1].y,n.push(a)}}),n}(c.path.commands)),c.path.commands.forEach(function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=r(t.x*a)+" "+r(t.y*a)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=r(t.x1*a)+" "+r(t.y1*a)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=r(t.x2*a)+" "+r(t.y2*a)+" ")}),n[String.fromCodePoint(c.unicode)]=e}}return{glyphs:n,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*a),descender:r(e.descender*a),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}((0,uP.Q)(e),this.reversed)}}class uD extends ee.yxD{constructor(e){super(e),this.type=ee.cLu}parse(e){let t,r,n;let a=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,r){t=t||1024;let n=e.pos,a=-1,s=0,o="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=l.indexOf("\n"))&&s<t&&n<e.byteLength;)o+=l,s+=l.length,n+=128,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return -1<a&&(!1!==r&&(e.pos+=s+a+1),o+l.slice(0,a))},o=new Uint8Array(e);o.pos=0;let l=function(e){let t,r;let n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,h=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=s(e))||a(1,"no header found"),(r=t.match(/^#\?(\S+)/))||a(3,"bad initial token"),c.valid|=1,c.programtype=r[1],c.string+=t+"\n";!1!==(t=s(e));){if(c.string+=t+"\n","#"===t.charAt(0)){c.comments+=t+"\n";continue}if((r=t.match(n))&&(c.gamma=parseFloat(r[1])),(r=t.match(o))&&(c.exposure=parseFloat(r[1])),(r=t.match(l))&&(c.valid|=2,c.format=r[1]),(r=t.match(h))&&(c.valid|=4,c.height=parseInt(r[1],10),c.width=parseInt(r[2],10)),2&c.valid&&4&c.valid)break}return 2&c.valid||a(3,"missing format specifier"),4&c.valid||a(3,"missing image size specifier"),c}(o),h=l.width,c=l.height,u=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&a(3,"wrong scanline width");let n=new Uint8Array(4*t*r);n.length||a(4,"unable to allocate buffer space");let s=0,o=0,l=4*t,h=new Uint8Array(4),c=new Uint8Array(l),u=r;for(;u>0&&o<e.byteLength;){o+4>e.byteLength&&a(1),h[0]=e[o++],h[1]=e[o++],h[2]=e[o++],h[3]=e[o++],(2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=t)&&a(3,"bad rgbe scanline format");let r=0,d;for(;r<l&&o<e.byteLength;){let t=(d=e[o++])>128;if(t&&(d-=128),(0===d||r+d>l)&&a(3,"bad scanline data"),t){let t=e[o++];for(let e=0;e<d;e++)c[r++]=t}else c.set(e.subarray(o,o+d),r),r+=d,o+=d}for(let e=0;e<t;e++){let r=0;n[s]=c[e+r],r+=t,n[s+1]=c[e+r],r+=t,n[s+2]=c[e+r],r+=t,n[s+3]=c[e+r],s+=4}u--}return n}(o.subarray(o.pos),h,c);switch(this.type){case ee.VzW:let d=new Float32Array(4*(n=u.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let a=Math.pow(2,e[t+3]-128)/255;r[n+0]=e[t+0]*a,r[n+1]=e[t+1]*a,r[n+2]=e[t+2]*a,r[n+3]=1}(u,4*e,d,4*e);t=d,r=ee.VzW;break;case ee.cLu:let m=new Uint16Array(4*(n=u.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let a=Math.pow(2,e[t+3]-128)/255;r[n+0]=ee.A5E.toHalfFloat(Math.min(e[t+0]*a,65504)),r[n+1]=ee.A5E.toHalfFloat(Math.min(e[t+1]*a,65504)),r[n+2]=ee.A5E.toHalfFloat(Math.min(e[t+2]*a,65504)),r[n+3]=ee.A5E.toHalfFloat(1)}(u,4*e,m,4*e);t=m,r=ee.cLu;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:h,height:c,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case ee.VzW:case ee.cLu:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=ee.wem,e.magFilter=ee.wem,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}class uR extends ee.aNw{load(e,t,r,n){var a=this,s=""===a.path?ee.Zp0.extractUrlBase(e):a.path,o=new ee.hH6(a.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(r){try{t(a.parse(r,s))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){var r,n,a=new ee.dpR(this.manager);a.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);var s={};function o(e,t){var r=new ee.N$j;for(let a in r.matrix.copy(e.matrix),r.matrixWorld.copy(e.matrixWorld),r.position.copy(e.position),r.quaternion.copy(e.quaternion),r.scale.copy(e.scale),t.nodeCount++,r.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(r),e.children){var n=o(e.children[a],t);r.add(n)}return r}function l(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(let n in e.children){var r=l(e.children[n],t);if(r)return r}}s.KeyFrame=class{constructor(e,t){this.time=e,this.matrix=t.clone(),this.position=new ee.Pa4,this.quaternion=new ee._fP,this.scale=new ee.Pa4(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new s.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){var r=(t-=this.time)/(e.time-this.time),n=1-r,a=this.position,o=this.quaternion,l=e.position,h=e.quaternion;return s.KeyFrame.tempAniPos.x=a.x*n+l.x*r,s.KeyFrame.tempAniPos.y=a.y*n+l.y*r,s.KeyFrame.tempAniPos.z=a.z*n+l.z*r,s.KeyFrame.tempAniQuat.set(o.x,o.y,o.z,o.w),s.KeyFrame.tempAniQuat.slerp(h,r),s.KeyFrame.tempAniMatrix.compose(s.KeyFrame.tempAniPos,s.KeyFrame.tempAniQuat,s.KeyFrame.tempAniScale)}}},s.KeyFrame.tempAniPos=new ee.Pa4,s.KeyFrame.tempAniQuat=new ee._fP,s.KeyFrame.tempAniScale=new ee.Pa4(1,1,1),s.KeyFrame.tempAniMatrix=new ee.yGw,s.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps){for(let e=0;e<this.length*this.fps;e++)for(let t=0;t<this.keys.length;t++)if(this.keys[t].time==e||this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;var r=e.hierarchy[0].keys;for(let e=0;e<r.length;e++)this.addKey(new s.KeyFrame(e/t||r[e].time,r[e].targets[0].data));this.init()},this.parseFromCollada=function(e){var t=e.keys,r=this.fps;for(let e=0;e<t.length;e++)this.addKey(new s.KeyFrame(e/r||t[e].time,t[e].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new s.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(let t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=s.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);var t=null,r=null;for(let n=this.keySearchAccel(e);n<this.keys.length;n++){if(this.keys[n].time==e){t=this.keys[n],r=this.keys[n];break}if(this.keys[n].time<e&&this.keys[n+1]&&this.keys[n+1].time>e){t=this.keys[n],r=this.keys[n+1];break}if(this.keys[n].time<e&&n==this.keys.length-1){t=this.keys[n],r=this.keys[0].clone(),r.time+=this.length+.05;break}}if(t&&r&&t!==r){this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(r,e)),this.target.matrixWorldNeedsUpdate=!0;return}if(t&&r&&t==r){this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),this.target.matrixWorldNeedsUpdate=!0;return}}},s.TrackTargetNodeNameCompare=function(e,t){return function e(t,r){if(t.name==r)return t;for(let a=0;a<t.children.length;a++){var n=e(t.children[a],r);if(n)return n}return null}(e,t.name)},s.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(let t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=s.TrackTargetNodeNameCompare);var r=new s.Animation;r.target=e;for(let a=0;a<this.tracks.length;a++){var n=this.tracks[a].clone();n.reTarget(e,t),r.addTrack(n)}return r}};class h{constructor(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e){if(0!=this.mBones.length){for(var t=[],r=[],n=e.findNode(this.mBones[0].mName);n.mParent&&n.mParent.isBone;)n=n.mParent;var a=n.toTHREE(e),s=o(a,e);this.threeNode.add(s);for(let u=0;u<this.mBones.length;u++){var h=l(s,this.mBones[u].mName);if(h){var c=h;t.push(c),r.push(this.mBones[u].mOffsetMatrix.toTHREE())}else{var n=e.findNode(this.mBones[u].mName);if(!n)return;var a=n.toTHREE(e),s=o(a,e);this.threeNode.add(s);var h=l(s,this.mBones[u].mName),c=h;t.push(c),r.push(this.mBones[u].mOffsetMatrix.toTHREE())}}var u=new ee.OdW(t,r);this.threeNode.bind(u,new ee.yGw),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,r,n=new ee.u9r;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new ee.YBo,n.setIndex(new ee.TlE(new Uint32Array(this.mIndexArray),1)),n.setAttribute("position",new ee.TlE(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&n.setAttribute("normal",new ee.TlE(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&n.setAttribute("color",new ee.TlE(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&n.setAttribute("uv",new ee.TlE(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&n.setAttribute("uv1",new ee.TlE(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&n.setAttribute("tangents",new ee.TlE(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&n.setAttribute("bitangents",new ee.TlE(this.mBitangentBuffer,3)),this.mBones.length>0){var a=[],s=[];for(let e=0;e<this.mBones.length;e++)for(let t=0;t<this.mBones[e].mWeights.length;t++){var o=this.mBones[e].mWeights[t];o&&(a[o.mVertexId]||(a[o.mVertexId]=[]),s[o.mVertexId]||(s[o.mVertexId]=[]),a[o.mVertexId].push(o.mWeight),s[o.mVertexId].push(parseInt(e)))}for(let e in s)!function(e,t){var r=[];for(let n=0;n<e.length;n++)r.push({i:e[n],w:t[n]});for(r.sort(function(e,t){return t.w-e.w});r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);var n=0;for(let e=0;e<4;e++)n+=r[e].w*r[e].w;n=Math.sqrt(n);for(let a=0;a<4;a++)r[a].w=r[a].w/n,e[a]=r[a].i,t[a]=r[a].w}(s[e],a[e]);var l=[],h=[];for(let e=0;e<a.length;e++)for(let t=0;t<4;t++)a[e]&&s[e]?(l.push(a[e][t]),h.push(s[e][t])):(l.push(0),h.push(0));n.setAttribute("skinWeight",new ee.TlE(new Float32Array(l),4)),n.setAttribute("skinIndex",new ee.TlE(new Float32Array(h),4))}return 0==this.mBones.length&&(r=new ee.Kj0(n,t)),this.mBones.length>0&&(r=new ee.TUv(n,t)).normalizeSkinWeights(),this.threeNode=r,r}}}class c{constructor(){this.mNumIndices=0,this.mIndices=[]}}class u{constructor(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new ee.Pa4(this.x,this.y,this.z)}}}class d{constructor(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new ee.Ilk(this.r,this.g,this.b)}}}class m{constructor(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new ee._fP(this.x,this.y,this.z,this.w)}}}class p{constructor(){this.mVertexId=0,this.mWeight=0}}class A{constructor(){this.data=[],this.toString=function(){var e="";return this.data.forEach(function(t){e+=String.fromCharCode(t)}),e.replace(/[^\x20-\x7E]+/g,"")}}}class f{constructor(){this.mTime=0,this.mValue=null}}class g{constructor(){this.mTime=0,this.mValue=null}}class v{constructor(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new ee.Tme;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(let r=0;r<this.mChildren.length;r++)t.add(this.mChildren[r].toTHREE(e));for(let r=0;r<this.mMeshes.length;r++)t.add(e.mMeshes[this.mMeshes[r]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}}class y{constructor(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}}class x{constructor(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new DataView(new Uint8Array(this.mData).buffer),t=e.getFloat32(0,!0),r=e.getFloat32(4,!0),n=e.getFloat32(8,!0);return new ee.Ilk(t,r,n)},this.dataAsFloat=function(){return new DataView(new Uint8Array(this.mData).buffer).getFloat32(0,!0)},this.dataAsBool=function(){return!!new DataView(new Uint8Array(this.mData).buffer).getFloat32(0,!0)},this.dataAsString=function(){var e=new A;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new A;e.data=this.mData;var t=e.toString();return -1!=(t=t.replace(/\\/g,"/")).indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),a.load(t)}}}var b={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},w={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};class C{constructor(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(){var e=new ee.xoR;for(let r=0;r<this.mProperties.length;r++)if("float"==w[this.mProperties[r].mKey]&&(e[b[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==w[this.mProperties[r].mKey]&&(e[b[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==w[this.mProperties[r].mKey]&&(e[b[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==w[this.mProperties[r].mKey]&&(e[b[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==w[this.mProperties[r].mKey]){var t=this.mProperties[r];1==t.mSemantic&&(e.map=this.mProperties[r].dataAsMap()),6==t.mSemantic&&(e.normalMap=this.mProperties[r].dataAsMap()),10==t.mSemantic&&(e.lightMap=this.mProperties[r].dataAsMap()),8==t.mSemantic&&(e.alphaMap=this.mProperties[r].dataAsMap())}return e.ambient.r=.53,e.ambient.g=.53,e.ambient.b=.53,e.color.r=1,e.color.g=1,e.color.b=1,e}}}function E(e,t,r){var n=new ee.Pa4,a=1-r;return n.x=e.x*r+t.x*a,n.y=e.y*r+t.y*a,n.z=e.z*r+t.z*a,n}function I(e,t,r){return e.clone().slerp(t,1-r)}function M(e,t,r,n){if(1==e.length)return e[0].mValue.toTHREE();var a=1/0,s=null,o=null;for(let r=0;r<e.length;r++){var l=Math.abs(e[r].mTime-t);l<a&&e[r].mTime<=t&&(a=l,s=e[r],o=e[r+1])}if(!s)return null;if(o){var h=o.mTime-s.mTime,c=s.mTime-t,u=c/h;return n(s.mValue.toTHREE(),o.mValue.toTHREE(),u)}o=e[0].clone(),o.mTime+=r;var h=o.mTime-s.mTime,c=s.mTime-t,u=c/h;return n(s.mValue.toTHREE(),o.mValue.toTHREE(),u)}class B{constructor(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(e){return e.mTime})))},this.toTHREE=function(e){this.sortKeys();var t=this.getLength(),r=new s.KeyFrameTrack;for(let e=0;e<t;e+=.05){var n=new ee.yGw,a=e,o=M(this.mPositionKeys,a,t,E),l=M(this.mScalingKeys,a,t,E),h=M(this.mRotationKeys,a,t,I);n.compose(o,h,l);var c=new s.KeyFrame(a,n);r.addKey(c)}r.target=e.findNode(this.mNodeName).toTHREE();var u=[r];if(e.nodeToBoneMap[this.mNodeName])for(let t=0;t<e.nodeToBoneMap[this.mNodeName].length;t++){var d=r.clone();d.target=e.nodeToBoneMap[this.mNodeName][t],u.push(d)}return u}}}class S{constructor(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new s.Animation;for(let n in this.mChannels){this.mChannels[n].init(this.mTicksPerSecond);var r=this.mChannels[n].toTHREE(e);for(let e in r)r[e].init(),t.addTrack(r[e])}return t.length=Math.max.apply(null,t.tracks.map(function(e){return e.length})),t}}}class T{constructor(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}}class F{constructor(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}}class P{constructor(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}}class _{constructor(){this.versionMajor=0,this.versionMinor=0,this.versionRevision=0,this.compileFlags=0,this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(let n=0;n<t.mChildren.length;n++){var r=this.findNode(e,t.mChildren[n]);if(r)return r}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(let n in e.mMeshes){var t=e.mMeshes[n];for(let n in t.mBones){var r=e.findNode(t.mBones[n].mName);r&&(r.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(let e in this.mMeshes)this.mMeshes[e].hookupSkeletons(this);if(this.mAnimations.length>0)var t=this.mAnimations[0].toTHREE(this);return{object:e,animation:t}}}}class D{constructor(){this.elements=[[],[],[],[]],this.toTHREE=function(){var e=new ee.yGw;for(let t=0;t<4;++t)for(let r=0;r<4;++r)e.elements[4*t+r]=this.elements[r][t];return e}}}function R(e){var t=e.getFloat32(e.readOffset,!0);return e.readOffset+=4,t}function L(e){var t=e.getFloat64(e.readOffset,!0);return e.readOffset+=8,t}function N(e){var t=e.getUint16(e.readOffset,!0);return e.readOffset+=2,t}function k(e){var t=e.getUint32(e.readOffset,!0);return e.readOffset+=4,t}function U(e){var t=e.getUint32(e.readOffset,!0);return e.readOffset+=4,t}function Q(e){var t=new u;return t.x=R(e),t.y=R(e),t.z=R(e),t}function O(e){var t=new d;return t.r=R(e),t.g=R(e),t.b=R(e),t}function G(e){var t=new A,r=k(e);return e.ReadBytes(t.data,1,r),t.toString()}function H(e){var t=new D;for(let r=0;r<4;++r)for(let n=0;n<4;++n)t.elements[r][n]=R(e);return t}function z(e,t,r){for(let n=0;n<r;n++)t[n]=function(e){var t=new f;return t.mTime=L(e),t.mValue=Q(e),t}(e)}function V(e,t,r){return e.Seek(sizeof(t)*r,X)}function j(e){if(!e)throw"asset failed"}function W(e,t){var n,a,s;if(j(4665==U(e)),U(e),t.mFlags=k(e),t.mNumMeshes=k(e),t.mNumMaterials=k(e),t.mNumAnimations=k(e),t.mNumTextures=k(e),t.mNumLights=k(e),t.mNumCameras=k(e),t.mRootNode=new v,t.mRootNode=function e(t,r,n){j(4668==U(t)),U(t);var a=new v;if(a.mParent=r,a.mDepth=n,a.mName=G(t),a.mTransformation=H(t),a.mNumChildren=k(t),a.mNumMeshes=k(t),a.mNumMeshes){a.mMeshes=[];for(let e=0;e<a.mNumMeshes;++e)a.mMeshes[e]=k(t)}if(a.mNumChildren){a.mChildren=[];for(let r=0;r<a.mNumChildren;++r){var s=e(t,a,n++);a.mChildren[r]=s}}return a}(e,null,0),t.mNumMeshes){t.mMeshes=[];for(let n=0;n<t.mNumMeshes;++n)t.mMeshes[n]=new h,function(e,t){j(4663==U(e)),U(e),t.mPrimitiveTypes=k(e),t.mNumVertices=k(e),t.mNumFaces=k(e),t.mNumBones=k(e),t.mMaterialIndex=k(e),t.mNumUVComponents=[];var n,a=k(e);1&a&&(r?V(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+12*t.mNumVertices),e.Seek(12*t.mNumVertices,X))),2&a&&(r?V(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+12*t.mNumVertices),e.Seek(12*t.mNumVertices,X))),4&a&&(r?(V(e,t.mTangents,t.mNumVertices),V(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+12*t.mNumVertices),e.Seek(12*t.mNumVertices,X),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+12*t.mNumVertices),e.Seek(12*t.mNumVertices,X)));for(let n=0;n<1&&a&65536<<n;++n)r?V(e,t.mColors[n],t.mNumVertices):(t.mColors[n]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+16*t.mNumVertices),e.Seek(16*t.mNumVertices,X));t.mTexCoordsBuffers=[];for(let n=0;n<4&&a&256<<n;++n)if(t.mNumUVComponents[n]=k(e),r)V(e,t.mTextureCoords[n],t.mNumVertices);else{t.mTextureCoords[n]=[],t.mTexCoordsBuffers[n]=[];for(let r=0;r<t.mNumVertices;r++)t.mTexCoordsBuffers[n].push(R(e)),t.mTexCoordsBuffers[n].push(R(e)),R(e)}if(r)k(e);else{t.mFaces=[],t.mIndexArray=[];for(let r=0;r<t.mNumFaces;++r){var s=t.mFaces[r]=new c;s.mNumIndices=N(e),s.mIndices=[];for(let r=0;r<s.mNumIndices;++r)t.mNumVertices<65536?s.mIndices[r]=N(e):s.mIndices[r]=k(e);if(3===s.mNumIndices)t.mIndexArray.push(s.mIndices[0]),t.mIndexArray.push(s.mIndices[1]),t.mIndexArray.push(s.mIndices[2]);else if(4===s.mNumIndices)t.mIndexArray.push(s.mIndices[0]),t.mIndexArray.push(s.mIndices[1]),t.mIndexArray.push(s.mIndices[2]),t.mIndexArray.push(s.mIndices[2]),t.mIndexArray.push(s.mIndices[3]),t.mIndexArray.push(s.mIndices[0]);else throw Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.")}}if(t.mNumBones){t.mBones=[];for(let a=0;a<t.mNumBones;++a)t.mBones[a]=new y,n=t.mBones[a],j(4666==U(e)),U(e),n.mName=G(e),n.mNumWeights=k(e),n.mOffsetMatrix=H(e),r?V(e,n.mWeights,n.mNumWeights):(n.mWeights=[],function(e,t,r){for(let n=0;n<r;n++)t[n]=function(e){var t=new p;return t.mVertexId=k(e),t.mWeight=R(e),t}(e)}(e,n.mWeights,n.mNumWeights))}}(e,t.mMeshes[n])}if(t.mNumMaterials){t.mMaterials=[];for(let r=0;r<t.mNumMaterials;++r)t.mMaterials[r]=new C,function(e,t){if(j(4669==U(e)),U(e),t.mNumAllocated=t.mNumProperties=k(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(let n=0;n<t.mNumProperties;++n){var r;t.mProperties[n]=new x,r=t.mProperties[n],j(4670==U(e)),U(e),r.mKey=G(e),r.mSemantic=k(e),r.mIndex=k(e),r.mDataLength=k(e),r.mType=k(e),r.mData=[],e.ReadBytes(r.mData,1,r.mDataLength)}}}(e,t.mMaterials[r])}if(t.mNumAnimations){t.mAnimations=[];for(let n=0;n<t.mNumAnimations;++n)t.mAnimations[n]=new S,function(e,t){if(j(4667==U(e)),U(e),t.mName=G(e),t.mDuration=L(e),t.mTicksPerSecond=L(e),t.mNumChannels=k(e),t.mNumChannels){t.mChannels=[];for(let a=0;a<t.mNumChannels;++a){var n;t.mChannels[a]=new B,n=t.mChannels[a],j(4664==U(e)),U(e),n.mNodeName=G(e),n.mNumPositionKeys=k(e),n.mNumRotationKeys=k(e),n.mNumScalingKeys=k(e),n.mPreState=k(e),n.mPostState=k(e),n.mNumPositionKeys&&(r?V(e,n.mPositionKeys,n.mNumPositionKeys):(n.mPositionKeys=[],z(e,n.mPositionKeys,n.mNumPositionKeys))),n.mNumRotationKeys&&(r?V(e,n.mRotationKeys,n.mNumRotationKeys):(n.mRotationKeys=[],function(e,t,r){for(let n=0;n<r;n++)t[n]=function(e){var t,r=new g;return r.mTime=L(e),r.mValue=((t=new m).w=R(e),t.x=R(e),t.y=R(e),t.z=R(e),t),r}(e)}(e,n.mRotationKeys,n.mNumRotationKeys))),n.mNumScalingKeys&&(r?V(e,n.mScalingKeys,n.mNumScalingKeys):(n.mScalingKeys=[],z(e,n.mScalingKeys,n.mNumScalingKeys)))}}}(e,t.mAnimations[n])}if(t.mNumTextures){t.mTextures=[];for(let a=0;a<t.mNumTextures;++a)t.mTextures[a]=new T,n=t.mTextures[a],j(4662==U(e)),U(e),n.mWidth=k(e),n.mHeight=k(e),e.ReadBytes(n.achFormatHint,1,4),r||(n.mHeight?(n.pcData=[],e.ReadBytes(n.pcData,1,n.mWidth*n.mHeight*4)):(n.pcData=[],e.ReadBytes(n.pcData,1,n.mWidth)))}if(t.mNumLights){t.mLights=[];for(let r=0;r<t.mNumLights;++r)t.mLights[r]=new F,a=t.mLights[r],j(4661==U(e)),U(e),a.mName=G(e),a.mType=k(e),1!=a.mType&&(a.mAttenuationConstant=R(e),a.mAttenuationLinear=R(e),a.mAttenuationQuadratic=R(e)),a.mColorDiffuse=O(e),a.mColorSpecular=O(e),a.mColorAmbient=O(e),3==a.mType&&(a.mAngleInnerCone=R(e),a.mAngleOuterCone=R(e))}if(t.mNumCameras){t.mCameras=[];for(let r=0;r<t.mNumCameras;++r)t.mCameras[r]=new P,s=t.mCameras[r],j(4660==U(e)),U(e),s.mName=G(e),s.mPosition=Q(e),s.mLookAt=Q(e),s.mUp=Q(e),s.mHorizontalFOV=R(e),s.mClipPlaneNear=R(e),s.mClipPlaneFar=R(e),s.mAspect=R(e)}}var X=0;return function(e){var t=new _,a=new DataView(e);if(a.readOffset=0,a.Seek=function(e,t){t==X&&(a.readOffset+=e),1==t&&(a.readOffset=e)},a.ReadBytes=function(e,t,r){var n=t*r;for(let t=0;t<n;t++)e[t]=function(e){var t=e.getUint8(e.readOffset);return e.readOffset+=1,t}(this)},a.subArray32=function(e,t){return new Float32Array(this.buffer.slice(e,t))},a.subArrayUint16=function(e,t){return new Uint16Array(this.buffer.slice(e,t))},a.subArrayUint8=function(e,t){return new Uint8Array(this.buffer.slice(e,t))},a.subArrayUint32=function(e,t){return new Uint32Array(this.buffer.slice(e,t))},a.Seek(44,X),t.versionMajor=k(a),t.versionMinor=k(a),t.versionRevision=k(a),t.compileFlags=k(a),r=N(a)>0,n=N(a)>0,r)throw"Shortened binaries are not supported!";if(a.Seek(256,X),a.Seek(128,X),a.Seek(64,X),n){var s=U(a),o=a.FileSize()-a.Tell(),l=[];a.Read(l,1,o);var h=[];uncompress(h,s,l,o),W(new ArrayBuffer(h),t)}else W(a,t);return t.toTHREE()}(e)}}class uL extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(e){t(a.parse(e))},r,n)}parse(e){let t=new DataView(e),r=t.getUint32(0),n=t.getUint32(4),a=8,s=new Float32Array(r),o=new Float32Array(r*r).fill(0);for(let e=0;e<r;e++)s[e]=t.getFloat32(a),a+=4,o[r*e+e]=1;let l=new ee.dUE(".morphTargetInfluences",s,o),h=new ee.m7l("default",s[s.length-1],[l]),c=[];for(let e=0;e<r;e++){let r=new Float32Array(3*n);for(let e=0;e<n;e++){let n=3*e;r[n+0]=t.getFloat32(a),a+=4,r[n+1]=t.getFloat32(a),a+=4,r[n+2]=t.getFloat32(a),a+=4}let s=new ee.TlE(r,3);s.name="morph_"+e,c.push(s)}return{morphTargets:c,clip:h}}}let uN="colorSpace"in new ee.xEZ;class uk extends ee.yxD{constructor(e){super(e),this.type=ee.cLu}parse(e){let t={l:0,c:0,lc:0};function r(e,r,n,a,s){for(;n<e;)r=r<<8|M(a,s),n+=8;n-=e,t.l=r>>n&(1<<e)-1,t.c=r,t.lc=n}let n=Array(59),a={c:0,lc:0};function s(e,t,r,n){e=e<<8|M(r,n),t+=8,a.c=e,a.lc=t}let o={c:0,lc:0};function l(e,t,r,n,l,h,c,u,d,m){if(e==t){n<8&&(s(r,n,l,c),r=a.c,n=a.lc);var p=r>>(n-=8),p=new Uint8Array([p])[0];if(d.value+p>m)return!1;for(var A=u[d.value-1];p-- >0;)u[d.value++]=A}else{if(!(d.value<m))return!1;u[d.value++]=e}o.c=r,o.lc=n}function h(e){var t=65535&e;return t>32767?t-65536:t}let c={a:0,b:0};function u(e,t){var r=h(e),n=h(t),a=r+(1&n)+(n>>1),s=a-n;c.a=a,c.b=s}function d(e,t){var r=65535&t,n=(65535&e)-(r>>1)&65535;c.a=r+n-32768&65535,c.b=n}function m(e,h,c,u,d,m){var p=c.value,A=I(h,c),f=I(h,c);c.value+=4;var g=I(h,c);if(c.value+=4,A<0||A>=65537||f<0||f>=65537)throw"Something wrong with HUF_ENCSIZE";var v=Array(65537),y=Array(16384);!function(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y);var x=u-(c.value-p);if(!function(e,a,s,o,l,h,c){for(var u=0,d=0;l<=h;l++){if(s.value-s.value>o)return!1;r(6,u,d,e,s);var m=t.l;if(u=t.c,d=t.lc,c[l]=m,63==m){if(s.value-s.value>o)throw"Something wrong with hufUnpackEncTable";r(8,u,d,e,s);var p=t.l+6;if(u=t.c,d=t.lc,l+p>h+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)c[l++]=0;l--}else if(m>=59){var p=m-59+2;if(l+p>h+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)c[l++]=0;l--}}!function(e){for(var t=0;t<=58;++t)n[t]=0;for(var t=0;t<65537;++t)n[e[t]]+=1;for(var r=0,t=58;t>0;--t){var a=r+n[t]>>1;n[t]=r,r=a}for(var t=0;t<65537;++t){var s=e[t];s>0&&(e[t]=s|n[s]++<<6)}}(c)}(e,0,c,x,A,f,v),g>8*(u-(c.value-p)))throw"Something wrong with hufUncompress";!function(e,t,r,n){for(;t<=r;t++){var a=e[t]>>6,s=63&e[t];if(a>>s)throw"Invalid table entry";if(s>14){var o=n[a>>s-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var l=o.p;o.p=Array(o.lit);for(var h=0;h<o.lit-1;++h)o.p[h]=l[h]}else o.p=[,];o.p[o.lit-1]=t}else if(s)for(var c=0,h=1<<14-s;h>0;h--){var o=n[(a<<14-s)+c];if(o.len||o.p)throw"Invalid table entry";o.len=s,o.lit=t,c++}}}(v,A,f,y),function(e,t,r,n,h,c,u,d,m,p){for(var A=0,f=0,g=Math.trunc(h.value+(c+7)/8);h.value<g;)for(s(A,f,r,h),A=a.c,f=a.lc;f>=14;){var v=t[A>>f-14&16383];if(v.len)f-=v.len,l(v.lit,u,A,f,r,n,h,m,p,d),A=o.c,f=o.lc;else{if(!v.p)throw"hufDecode issues";for(y=0;y<v.lit;y++){for(var y,x=63&e[v.p[y]];f<x&&h.value<g;)s(A,f,r,h),A=a.c,f=a.lc;if(f>=x&&e[v.p[y]]>>6==(A>>f-x&(1<<x)-1)){f-=x,l(v.p[y],u,A,f,r,n,h,m,p,d),A=o.c,f=o.lc;break}}if(y==v.lit)throw"hufDecode issues"}}var b=8-c&7;for(A>>=b,f-=b;f>0;){var v=t[A<<14-f&16383];if(v.len)f-=v.len,l(v.lit,u,A,f,r,n,h,m,p,d),A=o.c,f=o.lc;else throw"hufDecode issues"}}(v,y,e,h,c,g,f,m,d,{value:0})}function p(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function A(e,t){for(var r=0,n=Math.floor((e.length+1)/2),a=0,s=e.length-1;!(a>s)&&(t[a++]=e[r++],!(a>s));)t[a++]=e[n++]}function f(e){for(var t=e.byteLength,r=[],n=0,a=new DataView(e);t>0;){var s=a.getInt8(n++);if(s<0){var o=-s;t-=o+1;for(var l=0;l<o;l++)r.push(a.getUint8(n++))}else{var o=s;t-=2;for(var h=a.getUint8(n++),l=0;l<o+1;l++)r.push(h)}}return r}function g(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function v(e){var t=new Uint8Array(f(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),r=new Uint8Array(t.length);return p(t),A(t,r),new DataView(r.buffer)}function y(e){var t=i0(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return p(t),A(t,r),new DataView(r.buffer)}function x(e){for(var t=e.viewer,r={value:e.offset.value},n=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),a=new Uint8Array(8192),s=0,o=Array(e.channels),l=0;l<e.channels;l++)o[l]={},o[l].start=s,o[l].end=o[l].start,o[l].nx=e.width,o[l].ny=e.lines,o[l].size=e.type,s+=o[l].nx*o[l].ny*o[l].size;var h=_(t,r),p=_(t,r);if(p>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(h<=p)for(var l=0;l<p-h+1;l++)a[l+h]=B(t,r);var A=new Uint16Array(65536),f=function(e,t){for(var r=0,n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[r++]=n);for(var a=r-1;r<65536;)t[r++]=0;return a}(a,A),g=I(t,r);m(e.array,t,r,g,n,s);for(var l=0;l<e.channels;++l)for(var v=o[l],y=0;y<o[l].size;++y)!function(e,t,r,n,a,s,o){for(var l=o<16384,h=r>a?a:r,m=1;m<=h;)m<<=1;for(m>>=1,p=m,m>>=1;m>=1;){for(var p,A,f,g,v,y=0,x=0+s*(a-p),b=s*m,w=s*p,C=n*m,E=n*p;y<=x;y+=w){for(var I=y,M=y+n*(r-p);I<=M;I+=E){var B=I+C,S=I+b,T=S+C;l?(u(e[I+t],e[S+t]),A=c.a,g=c.b,u(e[B+t],e[T+t]),f=c.a,v=c.b,u(A,f),e[I+t]=c.a,e[B+t]=c.b,u(g,v)):(d(e[I+t],e[S+t]),A=c.a,g=c.b,d(e[B+t],e[T+t]),f=c.a,v=c.b,d(A,f),e[I+t]=c.a,e[B+t]=c.b,d(g,v)),e[S+t]=c.a,e[T+t]=c.b}if(r&m){var S=I+b;l?u(e[I+t],e[S+t]):d(e[I+t],e[S+t]),A=c.a,e[S+t]=c.b,e[I+t]=A}}if(a&m)for(var I=y,M=y+n*(r-p);I<=M;I+=E){var B=I+C;l?u(e[I+t],e[B+t]):d(e[I+t],e[B+t]),A=c.a,e[B+t]=c.b,e[I+t]=A}p=m,m>>=1}}(n,v.start+y,v.nx,v.size,v.ny,v.nx*v.size,f);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(A,n,s);for(var x=0,b=new Uint8Array(n.buffer.byteLength),w=0;w<e.lines;w++)for(var C=0;C<e.channels;C++){var v=o[C],E=v.nx*v.size,M=new Uint8Array(n.buffer,2*v.end,2*E);b.set(M,x),x+=2*E,v.end+=E}return new DataView(b.buffer)}function b(e){var t=i0(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(r):new Uint32Array(r),a=0,s=0,o=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=a,o[1]=o[0]+e.width,a=o[1]+e.width;for(let a=0;a<e.width;++a)r+=t[o[0]++]<<8|t[o[1]++],n[s]=r,s++;break;case 2:o[0]=a,o[1]=o[0]+e.width,o[2]=o[1]+e.width,a=o[2]+e.width;for(let a=0;a<e.width;++a)r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,n[s]=r,s++}}return new DataView(n.buffer)}function w(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),a={version:S(t,r),unknownUncompressedSize:S(t,r),unknownCompressedSize:S(t,r),acCompressedSize:S(t,r),dcCompressedSize:S(t,r),rleCompressedSize:S(t,r),rleUncompressedSize:S(t,r),rleRawSize:S(t,r),totalAcUncompressedCount:S(t,r),totalDcUncompressedCount:S(t,r),acCompression:S(t,r)};if(a.version<2)throw"EXRLoader.parse: "+k.compression+" version "+a.version+" is unsupported";for(var s=[],o=_(t,r)-2;o>0;){var l=C(t.buffer,r),h=B(t,r),c=h>>2&3,u=new Int8Array([(h>>4)-1])[0],d=B(t,r);s.push({name:l,index:u,type:d,compression:c}),o-=l.length+3}for(var p=k.channels,A=Array(e.channels),g=0;g<e.channels;++g){var v=A[g]={},x=p[g];v.name=x.name,v.compression=0,v.decoded=!1,v.type=x.pixelType,v.pLinear=x.pLinear,v.width=e.width,v.height=e.lines}for(var b={idx:[,,,]},w=0;w<e.channels;++w)for(var v=A[w],g=0;g<s.length;++g){var E=s[g];v.name==E.name&&(v.compression=E.compression,E.index>=0&&(b.idx[E.index]=w),v.offset=w)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var I=new Uint16Array(a.totalAcUncompressedCount);m(e.array,t,r,a.acCompressedSize,I,a.totalAcUncompressedCount);break;case 1:var M=e.array.slice(r.value,r.value+a.totalAcUncompressedCount),T=i0(M),I=new Uint16Array(T.buffer);r.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var F=new Uint16Array(y({array:e.array,offset:r,size:a.dcCompressedSize}).buffer);r.value+=a.dcCompressedSize}if(a.rleRawSize>0){var M=e.array.slice(r.value,r.value+a.rleCompressedSize),T=i0(M),D=f(T.buffer);r.value+=a.rleCompressedSize}for(var R=0,L=Array(A.length),g=0;g<L.length;++g)L[g]=[];for(var N=0;N<e.lines;++N)for(var U=0;U<A.length;++U)L[U].push(R),R+=A[U].width*e.type*2;!function(e,t,r,n,a,s){var o=new DataView(s.buffer),l=r[e.idx[0]].width,h=r[e.idx[0]].height,c=Math.floor(l/8),u=Math.ceil(l/8),d=Math.ceil(h/8),m=l-(u-1)*8,p=h-(d-1)*8,A={value:0},f=[,,,],g=[,,,],v=[,,,],y=[,,,],x=[,,,];for(let r=0;r<3;++r)x[r]=t[e.idx[r]],f[r]=r<1?0:f[r-1]+u*d,g[r]=new Float32Array(64),v[r]=new Uint16Array(64),y[r]=new Uint16Array(64*u);for(let t=0;t<d;++t){var b,w,C=8;t==d-1&&(C=p);var E=8;for(let e=0;e<u;++e){e==u-1&&(E=m);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=a[f[e]++],function(e,t,r){for(var n,a=1;a<64;)65280==(n=t[e.value])?a=64:n>>8==255?a+=255&n:(r[a]=n,a++),e.value++}(A,n,v[e]),b=v[e],(w=g[e])[0]=P(b[0]),w[1]=P(b[1]),w[2]=P(b[5]),w[3]=P(b[6]),w[4]=P(b[14]),w[5]=P(b[15]),w[6]=P(b[27]),w[7]=P(b[28]),w[8]=P(b[2]),w[9]=P(b[4]),w[10]=P(b[7]),w[11]=P(b[13]),w[12]=P(b[16]),w[13]=P(b[26]),w[14]=P(b[29]),w[15]=P(b[42]),w[16]=P(b[3]),w[17]=P(b[8]),w[18]=P(b[12]),w[19]=P(b[17]),w[20]=P(b[25]),w[21]=P(b[30]),w[22]=P(b[41]),w[23]=P(b[43]),w[24]=P(b[9]),w[25]=P(b[11]),w[26]=P(b[18]),w[27]=P(b[24]),w[28]=P(b[31]),w[29]=P(b[40]),w[30]=P(b[44]),w[31]=P(b[53]),w[32]=P(b[10]),w[33]=P(b[19]),w[34]=P(b[23]),w[35]=P(b[32]),w[36]=P(b[39]),w[37]=P(b[45]),w[38]=P(b[52]),w[39]=P(b[54]),w[40]=P(b[20]),w[41]=P(b[22]),w[42]=P(b[33]),w[43]=P(b[38]),w[44]=P(b[46]),w[45]=P(b[51]),w[46]=P(b[55]),w[47]=P(b[60]),w[48]=P(b[21]),w[49]=P(b[34]),w[50]=P(b[37]),w[51]=P(b[47]),w[52]=P(b[50]),w[53]=P(b[56]),w[54]=P(b[59]),w[55]=P(b[61]),w[56]=P(b[35]),w[57]=P(b[36]),w[58]=P(b[48]),w[59]=P(b[49]),w[60]=P(b[57]),w[61]=P(b[58]),w[62]=P(b[62]),w[63]=P(b[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(3*3.14159/8);for(var s=[,,,,],o=[,,,,],l=[,,,,],h=[,,,,],c=0;c<8;++c){var u=8*c;s[0]=r*e[u+2],s[1]=a*e[u+2],s[2]=r*e[u+6],s[3]=a*e[u+6],o[0]=t*e[u+1]+n*e[u+3]+.2777854612564676*e[u+5]+.09754573032714427*e[u+7],o[1]=n*e[u+1]-.09754573032714427*e[u+3]-t*e[u+5]-.2777854612564676*e[u+7],o[2]=.2777854612564676*e[u+1]-t*e[u+3]+.09754573032714427*e[u+5]+n*e[u+7],o[3]=.09754573032714427*e[u+1]-.2777854612564676*e[u+3]+n*e[u+5]-t*e[u+7],l[0]=.35355362513961314*(e[u+0]+e[u+4]),l[3]=.35355362513961314*(e[u+0]-e[u+4]),l[1]=s[0]+s[3],l[2]=s[1]-s[2],h[0]=l[0]+l[1],h[1]=l[3]+l[2],h[2]=l[3]-l[2],h[3]=l[0]-l[1],e[u+0]=h[0]+o[0],e[u+1]=h[1]+o[1],e[u+2]=h[2]+o[2],e[u+3]=h[3]+o[3],e[u+4]=h[3]-o[3],e[u+5]=h[2]-o[2],e[u+6]=h[1]-o[1],e[u+7]=h[0]-o[0]}for(var d=0;d<8;++d)s[0]=r*e[16+d],s[1]=a*e[16+d],s[2]=r*e[48+d],s[3]=a*e[48+d],o[0]=t*e[8+d]+n*e[24+d]+.2777854612564676*e[40+d]+.09754573032714427*e[56+d],o[1]=n*e[8+d]-.09754573032714427*e[24+d]-t*e[40+d]-.2777854612564676*e[56+d],o[2]=.2777854612564676*e[8+d]-t*e[24+d]+.09754573032714427*e[40+d]+n*e[56+d],o[3]=.09754573032714427*e[8+d]-.2777854612564676*e[24+d]+n*e[40+d]-t*e[56+d],l[0]=.35355362513961314*(e[d]+e[32+d]),l[3]=.35355362513961314*(e[d]-e[32+d]),l[1]=s[0]+s[3],l[2]=s[1]-s[2],h[0]=l[0]+l[1],h[1]=l[3]+l[2],h[2]=l[3]-l[2],h[3]=l[0]-l[1],e[0+d]=h[0]+o[0],e[8+d]=h[1]+o[1],e[16+d]=h[2]+o[2],e[24+d]=h[3]+o[3],e[32+d]=h[3]-o[3],e[40+d]=h[2]-o[2],e[48+d]=h[1]-o[1],e[56+d]=h[0]-o[0]}(g[e]);!function(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],a=e[2][t];e[0][t]=r+1.5747*a,e[1][t]=r-.1873*n-.4682*a,e[2][t]=r+1.8556*n}}(g);for(let t=0;t<3;++t)!function(e,t,r){for(var n,a=0;a<64;++a)t[r+a]=ee.A5E.toHalfFloat((n=e[a])<=1?Math.sign(n)*Math.pow(Math.abs(n),2.2):Math.sign(n)*Math.pow(9.025013291561939,Math.abs(n)-1))}(g[t],y[t],64*e)}let s=0;for(let n=0;n<3;++n){let a=r[e.idx[n]].type;for(let e=8*t;e<8*t+C;++e){s=x[n][e];for(let t=0;t<c;++t){let r=64*t+(7&e)*8;o.setUint16(s+0*a,y[n][r+0],!0),o.setUint16(s+2*a,y[n][r+1],!0),o.setUint16(s+4*a,y[n][r+2],!0),o.setUint16(s+6*a,y[n][r+3],!0),o.setUint16(s+8*a,y[n][r+4],!0),o.setUint16(s+10*a,y[n][r+5],!0),o.setUint16(s+12*a,y[n][r+6],!0),o.setUint16(s+14*a,y[n][r+7],!0),s+=16*a}}if(c!=u)for(let e=8*t;e<8*t+C;++e){let t=x[n][e]+8*c*2*a,r=64*c+(7&e)*8;for(let e=0;e<E;++e)o.setUint16(t+2*e*a,y[n][r+e],!0)}}}for(var I=new Uint16Array(l),o=new DataView(s.buffer),M=0;M<3;++M){r[e.idx[M]].decoded=!0;var B=r[e.idx[M]].type;if(2==r[M].type)for(var S=0;S<h;++S){let e=x[M][S];for(var T=0;T<l;++T)I[T]=o.getUint16(e+2*T*B,!0);for(var T=0;T<l;++T)o.setFloat32(e+2*T*B,P(I[T]),!0)}}}(b,L,A,I,F,n);for(var g=0;g<A.length;++g){var v=A[g];if(!v.decoded){if(2===v.compression)for(var Q=0,O=0,N=0;N<e.lines;++N){for(var G=L[g][Q],H=0;H<v.width;++H){for(var z=0;z<2*v.type;++z)n[G++]=D[O+z*v.width*v.height];O++}Q++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(n.buffer)}function C(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var a=new TextDecoder().decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,a}function E(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function I(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function M(e,t){var r=e[t.value];return t.value=t.value+1,r}function B(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let S=function(e,t){let r;return"getBigInt64"in DataView.prototype?r=Number(e.getBigInt64(t.value,!0)):r=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function T(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function F(e,t){return ee.A5E.toHalfFloat(T(e,t))}function P(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function _(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function D(e,t){return P(_(e,t))}let R=new DataView(e),L=new Uint8Array(e),N={value:0},k=function(e,t,r){let n={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);let a=e.getUint8(5);n.spec={singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},r.value=8;for(var s=!0;s;){var o=C(t,r);if(0==o)s=!1;else{var l=C(t,r),h=I(e,r),c=function(e,t,r,n,a){var s,o,l,h,c;if("string"===n||"stringvector"===n||"iccProfile"===n)return s=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+a)),r.value=r.value+a,s;if("chlist"===n)return function(e,t,r,n){for(var a=r.value,s=[];r.value<a+n-1;){var o=C(t,r),l=E(e,r),h=B(e,r);r.value+=3;var c=E(e,r),u=E(e,r);s.push({name:o,pixelType:l,pLinear:h,xSampling:c,ySampling:u})}return r.value+=1,s}(e,t,r,a);if("chromaticities"===n)return o=T(e,r),l=T(e,r),h=T(e,r),c=T(e,r),{redX:o,redY:l,greenX:h,greenY:c,blueX:T(e,r),blueY:T(e,r),whiteX:T(e,r),whiteY:T(e,r)};if("compression"===n)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][B(e,r)];if("box2i"===n)return{xMin:I(e,r),yMin:I(e,r),xMax:I(e,r),yMax:I(e,r)};if("lineOrder"===n)return["INCREASING_Y"][B(e,r)];if("float"===n)return T(e,r);else if("v2f"===n)return[T(e,r),T(e,r)];else if("v3f"===n)return[T(e,r),T(e,r),T(e,r)];else if("int"===n)return E(e,r);else if("rational"===n)return[E(e,r),I(e,r)];else if("timecode"===n)return[I(e,r),I(e,r)];else return"preview"===n?(r.value+=a,"skipped"):void(r.value+=a)}(e,t,r,l,h);void 0===c?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):n[o]=c}}if((-5&a)!=0)throw console.error("EXRHeader:",n),"THREE.EXRLoader: provided file is currently unsupported.";return n}(R,e,N),U=function(e,t,r,n,a){let s={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[uN?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=g;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=v;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=y;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=y;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=x;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=b;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=w;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=w;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(s.scanlineBlockSize=s.lines,1==s.type)switch(a){case ee.VzW:s.getter=D,s.inputSize=2;break;case ee.cLu:s.getter=_,s.inputSize=2}else if(2==s.type)switch(a){case ee.VzW:s.getter=T,s.inputSize=4;break;case ee.cLu:s.getter=F,s.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".";s.blockCount=(e.dataWindow.yMax+1)/s.scanlineBlockSize;for(var o=0;o<s.blockCount;o++)S(t,n);s.outputChannels=3==s.channels?4:s.channels;let l=s.width*s.height*s.outputChannels;switch(a){case ee.VzW:s.byteArray=new Float32Array(l),s.channels<s.outputChannels&&s.byteArray.fill(1,0,l);break;case ee.cLu:s.byteArray=new Uint16Array(l),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",a)}return s.bytesPerLine=s.width*s.inputSize*s.channels,4==s.outputChannels?s.format=ee.wk1:s.format=ee.hEm,uN?s.colorSpace="srgb-linear":s.encoding=3e3,s}(k,R,L,N,this.type),Q={value:0},O={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<U.height/U.scanlineBlockSize;e++){let t=I(R,N);U.size=I(R,N),U.lines=t+U.scanlineBlockSize>U.height?U.height-t:U.scanlineBlockSize;let r=U.size<U.lines*U.bytesPerLine?U.uncompress(U):g(U);N.value+=U.size;for(let t=0;t<U.scanlineBlockSize;t++){let n=t+e*U.scanlineBlockSize;if(n>=U.height)break;for(let e=0;e<U.channels;e++){let a=O[k.channels[e].name];for(let s=0;s<U.width;s++){Q.value=(U.channels*U.width*t+e*U.width+s)*U.inputSize;let o=(U.height-1-n)*(U.width*U.outputChannels)+s*U.outputChannels+a;U.byteArray[o]=U.getter(r,Q)}}}}return{header:k,width:U.width,height:U.height,data:U.byteArray,format:U.format,[uN?"colorSpace":"encoding"]:U[uN?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){uN?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=ee.wem,e.magFilter=ee.wem,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,n)}}class uU extends ee.aNw{constructor(e){super(e),this.availableExtensions=[]}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=this,r=new ee.dpR(this.manager);function n(e){let t=[],r=new DOMParser().parseFromString(e,"application/xml").querySelectorAll("Relationship");for(let e=0;e<r.length;e++){let n=r[e],a={target:n.getAttribute("Target"),id:n.getAttribute("Id"),type:n.getAttribute("Type")};t.push(a)}return t}function a(e){let t=[];e.split(" ").forEach(function(e){t.push(parseFloat(e))});let r=new ee.yGw;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function s(e,t,n,a){let s=e.texid,o=n.resources.texture2d[s];if(!o)return null;{let e=new Blob([a[o.path]],{type:o.contenttype}),t=URL.createObjectURL(e),n=r.load(t,function(){URL.revokeObjectURL(t)});switch("colorSpace"in n?n.colorSpace="srgb":n.encoding=3001,o.tilestyleu){case"wrap":default:n.wrapS=ee.rpg;break;case"mirror":n.wrapS=ee.OoA;break;case"none":case"clamp":n.wrapS=ee.uWy}switch(o.tilestylev){case"wrap":default:n.wrapT=ee.rpg;break;case"mirror":n.wrapT=ee.OoA;break;case"none":case"clamp":n.wrapT=ee.uWy}switch(o.filter){case"auto":default:n.magFilter=ee.wem,n.minFilter=ee.D1R;break;case"linear":n.magFilter=ee.wem,n.minFilter=ee.wem;break;case"nearest":n.magFilter=ee.TyD,n.minFilter=ee.TyD}return n}}function o(e,t,r,n,a){let o=new ee.ZAu,c=function(e,t,r,n,a,o){let c=Object.keys(e),u=[];for(let d=0,m=c.length;d<m;d++){let m=c[d],p=e[m];switch(void 0!==n.resources.texture2dgroup[m]?"texture":void 0!==n.resources.basematerials[m]?"material":void 0!==n.resources.colorgroup[m]?"vertexColors":"default"===m?"default":void 0){case"material":let A=function(e,t,r,n,a,s,o){let c=o.pindex,u={};for(let e=0,r=t.length;e<r;e++){let r=t[e],n=void 0!==r.p1?r.p1:c;void 0===u[n]&&(u[n]=[]),u[n].push(r)}let d=Object.keys(u),m=[];for(let t=0,c=d.length;t<c;t++){let c=d[t],p=u[c],A=l(e.basematerials[c],n,a,s,o,h),f=new ee.u9r,g=[],v=r.vertices;for(let e=0,t=p.length;e<t;e++){let t=p[e];g.push(v[3*t.v1+0]),g.push(v[3*t.v1+1]),g.push(v[3*t.v1+2]),g.push(v[3*t.v2+0]),g.push(v[3*t.v2+1]),g.push(v[3*t.v2+2]),g.push(v[3*t.v3+0]),g.push(v[3*t.v3+1]),g.push(v[3*t.v3+2])}f.setAttribute("position",new ee.a$l(g,3));let y=new ee.Kj0(f,A);m.push(y)}return m}(n.resources.basematerials[m],p,t,r,n,a,o);for(let e=0,t=A.length;e<t;e++)u.push(A[e]);break;case"texture":let f=n.resources.texture2dgroup[m];u.push(function(e,t,r,n,a,o,h){let c=new ee.u9r,u=[],d=[],m=r.vertices,p=e.uvs;for(let e=0,r=t.length;e<r;e++){let r=t[e];u.push(m[3*r.v1+0]),u.push(m[3*r.v1+1]),u.push(m[3*r.v1+2]),u.push(m[3*r.v2+0]),u.push(m[3*r.v2+1]),u.push(m[3*r.v2+2]),u.push(m[3*r.v3+0]),u.push(m[3*r.v3+1]),u.push(m[3*r.v3+2]),d.push(p[2*r.p1+0]),d.push(p[2*r.p1+1]),d.push(p[2*r.p2+0]),d.push(p[2*r.p2+1]),d.push(p[2*r.p3+0]),d.push(p[2*r.p3+1])}c.setAttribute("position",new ee.a$l(u,3)),c.setAttribute("uv",new ee.a$l(d,2));let A=l(e,n,a,o,h,s),f=new ee.xoR({map:A,flatShading:!0});return new ee.Kj0(c,f)}(f,p,t,r,n,a,o));break;case"vertexColors":let g=n.resources.colorgroup[m];u.push(function(e,t,r,n,a,s){let o=new ee.u9r,l=[],h=[],c=r.vertices,u=e.colors;for(let e=0,r=t.length;e<r;e++){let r=t[e],n=r.v1,a=r.v2,o=r.v3;l.push(c[3*n+0]),l.push(c[3*n+1]),l.push(c[3*n+2]),l.push(c[3*a+0]),l.push(c[3*a+1]),l.push(c[3*a+2]),l.push(c[3*o+0]),l.push(c[3*o+1]),l.push(c[3*o+2]);let d=void 0!==r.p1?r.p1:s.pindex,m=void 0!==r.p2?r.p2:d,p=void 0!==r.p3?r.p3:d;h.push(u[3*d+0]),h.push(u[3*d+1]),h.push(u[3*d+2]),h.push(u[3*m+0]),h.push(u[3*m+1]),h.push(u[3*m+2]),h.push(u[3*p+0]),h.push(u[3*p+1]),h.push(u[3*p+2])}o.setAttribute("position",new ee.a$l(l,3)),o.setAttribute("color",new ee.a$l(h,3));let d=new ee.xoR({vertexColors:!0,flatShading:!0});return new ee.Kj0(o,d)}(g,p,t,0,0,o));break;case"default":u.push(function(e){let t=new ee.u9r;t.setIndex(new ee.TlE(e.triangles,1)),t.setAttribute("position",new ee.TlE(e.vertices,3));let r=new ee.xoR({color:11184895,flatShading:!0});return new ee.Kj0(t,r)}(t));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}return u}(function(e,t,r){let n={},a=t.triangleProperties,s=r.pid;for(let e=0,t=a.length;e<t;e++){let t=a[e],r=void 0!==t.pid?t.pid:s;void 0===r&&(r="default"),void 0===n[r]&&(n[r]=[]),n[r].push(t)}return n}(0,e,a),e,t,r,n,a);for(let e=0,t=c.length;e<t;e++)o.add(c[e]);return o}function l(e,t,r,n,a,s){return void 0!==e.build||(e.build=s(e,t,r,n,a)),e.build}function h(e,t,r){let n;let a=e.displaypropertiesid,s=r.resources.pbmetallicdisplayproperties;if(null!==a&&void 0!==s[a]){let t=s[a].data[e.index];n=new ee.Wid({flatShading:!0,roughness:t.roughness,metalness:t.metallicness})}else n=new ee.xoR({flatShading:!0});n.name=e.name;let o=e.displaycolor,l=o.substring(0,7);return n.color.setStyle(l),n.color.convertSRGBToLinear(),9===o.length&&(n.opacity=parseInt(o.charAt(7)+o.charAt(8),16)/255),n}function c(e,t,r,n){let a=new ee.ZAu;for(let s=0;s<e.length;s++){let o=e[s],l=t[o.objectId];void 0===l&&(u(o.objectId,t,r,n),l=t[o.objectId]);let h=l.clone(),c=o.transform;c&&h.applyMatrix4(c),a.add(h)}return a}function u(e,r,n,a){let s=n.resources.object[e];if(s.mesh){let e=s.mesh;!function(e,r,n){if(!e)return;let a=[],s=Object.keys(e);for(let e=0;e<s.length;e++){let r=s[e];for(let e=0;e<t.availableExtensions.length;e++){let n=t.availableExtensions[e];n.ns===r&&a.push(n)}}for(let t=0;t<a.length;t++){let s=a[t];s.apply(n,e[s.ns],r)}}(n.extensions,e,n.xml),r[s.id]=l(e,r,n,a,s,o)}else{let e=s.components;r[s.id]=l(e,r,n,a,s,c)}}let d=function(e){let t,r,s,o=null,l=null,h=[],c=[],u={},d={};try{o=ri(new Uint8Array(e))}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(l in o)l.match(/\_rels\/.rels$/)?t=l:l.match(/3D\/_rels\/.*\.model\.rels$/)?r=l:l.match(/^3D\/.*\.model$/)?h.push(l):l.match(/^3D\/Metadata\/.*\.xml$/)||(l.match(/^3D\/Textures?\/.*/)?c.push(l):l.match(/^3D\/Other\/.*/));let m=o[t],p=n((0,cE.r)(m));if(r){let e=o[r];s=n((0,cE.r)(e))}for(let e=0;e<h.length;e++){let t=h[e],r=o[t],n=(0,cE.r)(r),s=new DOMParser().parseFromString(n,"application/xml");"model"!==s.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",t);let l=s.querySelector("model"),c={};for(let e=0;e<l.attributes.length;e++){let t=l.attributes[e];t.name.match(/^xmlns:(.+)$/)&&(c[t.value]=RegExp.$1)}let d=function(e){let t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){let t={};for(let r=0;r<e.length;r++){let n=e[r],a=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(a)&&(t[a]=n.textContent)}return t}(r));let n=e.querySelector("resources");n&&(t.resources=function(e){let t={};t.basematerials={};let r=e.querySelectorAll("basematerials");for(let e=0;e<r.length;e++){let n=function(e){let t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base");for(let e=0;e<r.length;e++){let n=function(e){let t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}(r[e]);n.index=e,t.basematerials.push(n)}return t}(r[e]);t.basematerials[n.id]=n}t.texture2d={};let n=e.querySelectorAll("texture2d");for(let e=0;e<n.length;e++){var s;let r={id:(s=n[e]).getAttribute("id"),path:s.getAttribute("path"),contenttype:s.getAttribute("contenttype"),tilestyleu:s.getAttribute("tilestyleu"),tilestylev:s.getAttribute("tilestylev"),filter:s.getAttribute("filter")};t.texture2d[r.id]=r}t.colorgroup={};let o=e.querySelectorAll("colorgroup");for(let e=0;e<o.length;e++){let r=function(e){let t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),n=[],a=new ee.Ilk;for(let e=0;e<r.length;e++){let t=r[e].getAttribute("color");a.setStyle(t.substring(0,7)),a.convertSRGBToLinear(),n.push(a.r,a.g,a.b)}return t.colors=new Float32Array(n),t}(o[e]);t.colorgroup[r.id]=r}t.pbmetallicdisplayproperties={};let l=e.querySelectorAll("pbmetallicdisplayproperties");for(let e=0;e<l.length;e++){let r=function(e){let t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),n=[];for(let e=0;e<r.length;e++){let t=r[e];n.push({name:t.getAttribute("name"),metallicness:parseFloat(t.getAttribute("metallicness")),roughness:parseFloat(t.getAttribute("roughness"))})}return t.data=n,t}(l[e]);t.pbmetallicdisplayproperties[r.id]=r}t.texture2dgroup={};let h=e.querySelectorAll("texture2dgroup");for(let e=0;e<h.length;e++){let r=function(e){let t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),n=[];for(let e=0;e<r.length;e++){let t=r[e],a=t.getAttribute("u"),s=t.getAttribute("v");n.push(parseFloat(a),parseFloat(s))}return t.uvs=new Float32Array(n),t}(h[e]);t.texture2dgroup[r.id]=r}t.object={};let c=e.querySelectorAll("object");for(let e=0;e<c.length;e++){let r=function(e){let t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);let n=e.getAttribute("pid");n&&(t.pid=n);let s=e.getAttribute("pindex");s&&(t.pindex=s);let o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);let l=e.getAttribute("partnumber");l&&(t.partnumber=l);let h=e.getAttribute("name");h&&(t.name=h);let c=e.querySelector("mesh");c&&(t.mesh=function(e){let t={},r=[],n=e.querySelectorAll("vertices vertex");for(let e=0;e<n.length;e++){let t=n[e],a=t.getAttribute("x"),s=t.getAttribute("y"),o=t.getAttribute("z");r.push(parseFloat(a),parseFloat(s),parseFloat(o))}t.vertices=new Float32Array(r);let a=[],s=[],o=e.querySelectorAll("triangles triangle");for(let e=0;e<o.length;e++){let t=o[e],r=t.getAttribute("v1"),n=t.getAttribute("v2"),l=t.getAttribute("v3"),h=t.getAttribute("p1"),c=t.getAttribute("p2"),u=t.getAttribute("p3"),d=t.getAttribute("pid"),m={};m.v1=parseInt(r,10),m.v2=parseInt(n,10),m.v3=parseInt(l,10),s.push(m.v1,m.v2,m.v3),h&&(m.p1=parseInt(h,10)),c&&(m.p2=parseInt(c,10)),u&&(m.p3=parseInt(u,10)),d&&(m.pid=d),0<Object.keys(m).length&&a.push(m)}return t.triangleProperties=a,t.triangles=new Uint32Array(s),t}(c));let u=e.querySelector("components");return u&&(t.components=function(e){let t=[],r=e.querySelectorAll("component");for(let e=0;e<r.length;e++){let n=function(e){let t={};t.objectId=e.getAttribute("objectid");let r=e.getAttribute("transform");return r&&(t.transform=a(r)),t}(r[e]);t.push(n)}return t}(u)),t}(c[e]);t.object[r.id]=r}return t}(n));let s=e.querySelector("build");return s&&(t.build=function(e){let t=[],r=e.querySelectorAll("item");for(let e=0;e<r.length;e++){let n=r[e],s={objectId:n.getAttribute("objectid")},o=n.getAttribute("transform");o&&(s.transform=a(o)),t.push(s)}return t}(s)),t}(l);d.xml=l,0<Object.keys(c).length&&(d.extensions=c),u[t]=d}for(let e=0;e<c.length;e++){let t=c[e];d[t]=o[t].buffer}return{rels:p,modelRels:s,model:u,printTicket:{},texture:d,other:{}}}(e);return function(e,t){let r=new ee.ZAu,n=function(e){for(let t=0;t<e.length;t++){let r=e[t];if("model"===r.target.split(".").pop().toLowerCase())return r}}(t.rels),a=t.model[n.target.substring(1)].build;for(let t=0;t<a.length;t++){let n=a[t],s=e[n.objectId],o=n.transform;o&&s.applyMatrix4(o),r.add(s)}return r}(function(e){let t=e.model,r=e.modelRels,n={},a=Object.keys(t),s={};if(r)for(let t=0,n=r.length;t<n;t++){let n=r[t],a=n.target.substring(1);e.texture[a]&&(s[n.target]=e.texture[a])}for(let e=0;e<a.length;e++){let r=t[a[e]],o=Object.keys(r.resources.object);for(let e=0;e<o.length;e++)u(o[e],n,r,s)}return n}(d),d)}addExtension(e){this.availableExtensions.push(e)}}class uQ extends ee.aNw{load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=e.split("\n"),r=[],n=[];for(let e of t){if("#"===(e=e.trim()).charAt(0))continue;let t=e.split(/\s+/);3===t.length&&(r.push(parseFloat(t[0])),r.push(parseFloat(t[1])),r.push(parseFloat(t[2]))),6===t.length&&(r.push(parseFloat(t[0])),r.push(parseFloat(t[1])),r.push(parseFloat(t[2])),n.push(parseFloat(t[3])/255),n.push(parseFloat(t[4])/255),n.push(parseFloat(t[5])/255))}let a=new ee.u9r;return a.setAttribute("position",new ee.a$l(r,3)),n.length>0&&a.setAttribute("color",new ee.a$l(n,3)),a}}class uO extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){var t=(0,cE.r)(new Uint8Array(e,0,250)).split("\n");return -1!==t[0].indexOf("xml")?function(e){function t(e){var t,r,n,a,s,o,l="undefined"!=typeof Uint8Array?Uint8Array:Array,h=[],c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=c.length;for(t=0;t<u;t++);for(t=0;t<u;++t)h[c.charCodeAt(t)]=t;h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63;var u=e.length;if(u%4>0)throw Error("Invalid string. Length must be a multiple of 4");s="="===e[u-2]?2:"="===e[u-1]?1:0,o=new l(3*u/4-s),n=s>0?u-4:u;var d=0;for(t=0,r=0;t<n;t+=4,r+=3)a=h[e.charCodeAt(t)]<<18|h[e.charCodeAt(t+1)]<<12|h[e.charCodeAt(t+2)]<<6|h[e.charCodeAt(t+3)],o[d++]=(16711680&a)>>16,o[d++]=(65280&a)>>8,o[d++]=255&a;return 2===s?(a=h[e.charCodeAt(t)]<<2|h[e.charCodeAt(t+1)]>>4,o[d++]=255&a):1===s&&(a=h[e.charCodeAt(t)]<<10|h[e.charCodeAt(t+1)]<<4|h[e.charCodeAt(t+2)]>>2,o[d++]=a>>8&255,o[d++]=255&a),o}var r=null;if(window.DOMParser)try{r=new DOMParser().parseFromString(e,"text/xml")}catch(e){r=null}else if(window.ActiveXObject)try{if((r=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!r.loadXML())throw Error(r.parseError.reason+r.parseError.srcText)}catch(e){r=null}else throw Error("Cannot parse xml string!");var n=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var a=t.attributes.item(n);r.attributes[a.nodeName]=a.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var o=t.childNodes.item(s),l=o.nodeName;if(void 0===r[l]){var h=e(o);""!==h&&(r[l]=h)}else{if(void 0===r[l].push){var c=r[l];r[l]=[c]}var h=e(o);""!==h&&r[l].push(h)}}return r}(r.documentElement),a=[],s=[],o=[];if(n.PolyData){for(var l=n.PolyData.Piece,h=n.attributes.hasOwnProperty("compressor"),c=["PointData","Points","Strips","Polys"],u=0,d=c.length;u<d;){var m=l[c[u]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var p=m.DataArray;else var p=[m.DataArray];for(var A=0,f=p.length;A<f;)"#text"in p[A]&&p[A]["#text"].length>0&&(p[A].text=function(e,r){var a,s,o,l,h,c,u,d,m=0;if("UInt64"===n.attributes.header_type?m=8:"UInt32"===n.attributes.header_type&&(m=4),"binary"===e.attributes.format&&r){if("Float32"===e.attributes.type)var p=new Float32Array;else if("Int64"===e.attributes.type)var p=new Int32Array;o=(s=t(e["#text"]))[0];for(var A=1;A<m-1;A++)o|=s[A]<<A*m;c=(h=(o+3)*m)%3>0?3-h%3:0,h+=c,u=[],d=h,u.push(d),l=3*m;for(var A=0;A<o;A++){for(var f=s[A*m+l],g=1;g<m-1;g++)f|=s[A*m+l+g]<<8*g;d+=f,u.push(d)}for(var A=0;A<u.length-1;A++)a=i0(s.slice(u[A],u[A+1])).buffer,"Float32"===e.attributes.type?p=function(e,t){let r=e.length,n=new Float32Array(r+t.length);return n.set(e),n.set(t,r),n}(p,a=new Float32Array(a)):"Int64"===e.attributes.type&&(p=function(e,t){var r=e.length,n=new Int32Array(r+t.length);return n.set(e),n.set(t,r),n}(p,a=new Int32Array(a)));delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(p=p.filter(function(e,t){if(t%2!=1)return!0}))}else{if("binary"!==e.attributes.format||r){if(e["#text"])var a=e["#text"].split(/\s+/).filter(function(e){if(""!==e)return e});else var a=new Int32Array(0).buffer}else{var a=t(e["#text"]);a=a.slice(m).buffer}if(delete e["#text"],"Float32"===e.attributes.type)var p=new Float32Array(a);else if("Int32"===e.attributes.type)var p=new Int32Array(a);else if("Int64"===e.attributes.type){var p=new Int32Array(a);"binary"===e.attributes.format&&(p=p.filter(function(e,t){if(t%2!=1)return!0}))}}return p}(p[A],h)),A++;switch(c[u]){case"PointData":var g=parseInt(l.attributes.NumberOfPoints),v=m.attributes.Normals;if(g>0){for(var y=0,x=p.length;y<x;y++)if(v===p[y].attributes.Name){var b=p[y].attributes.NumberOfComponents;(s=new Float32Array(g*b)).set(p[y].text,0)}}break;case"Points":var g=parseInt(l.attributes.NumberOfPoints);if(g>0){var b=m.DataArray.attributes.NumberOfComponents;(a=new Float32Array(g*b)).set(m.DataArray.text,0)}break;case"Strips":var w=parseInt(l.attributes.NumberOfStrips);if(w>0){var C=new Int32Array(m.DataArray[0].text.length),E=new Int32Array(m.DataArray[1].text.length);C.set(m.DataArray[0].text,0),E.set(m.DataArray[1].text,0);var I=w+C.length;o=new Uint32Array(3*I-9*w);for(var M=0,y=0,x=w;y<x;y++){for(var B=[],S=0,T=E[y],F=0;S<T-F;S++)B.push(C[S]),y>0&&(F=E[y-1]);for(var P=0,T=E[y],F=0;P<T-F-2;P++)P%2?(o[M++]=B[P],o[M++]=B[P+2],o[M++]=B[P+1]):(o[M++]=B[P],o[M++]=B[P+1],o[M++]=B[P+2]),y>0&&(F=E[y-1])}}break;case"Polys":var _=parseInt(l.attributes.NumberOfPolys);if(_>0){var C=new Int32Array(m.DataArray[0].text.length),E=new Int32Array(m.DataArray[1].text.length);C.set(m.DataArray[0].text,0),E.set(m.DataArray[1].text,0);var I=_+C.length;o=new Uint32Array(3*I-9*_);for(var M=0,D=0,y=0,x=_,F=0;y<x;){for(var R=[],S=0,T=E[y];S<T-F;)R.push(C[D++]),S++;for(var P=1;P<T-F-1;)o[M++]=R[0],o[M++]=R[P],o[M++]=R[P+1],P++;F=E[++y-1]}}}}u++}var L=new ee.u9r;return L.setIndex(new ee.TlE(o,1)),L.setAttribute("position",new ee.TlE(a,3)),s.length===a.length&&L.setAttribute("normal",new ee.TlE(s,3)),L}throw Error("Unsupported DATASET type")}((0,cE.r)(e)):t[2].includes("ASCII")?function(e){var t=[],r=[],n=[],a=[],s=/^[^\d.\s-]+/,o=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,h=/^POINTS /,c=/^POLYGONS /,u=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,m=/^CELL_DATA[ ]+(\d+)/,p=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,A=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,f=!1,g=!1,v=!1,y=!1,x=!1,b=!1,w=!1,C=e.split("\n");for(var E in C){var I=C[E].trim();if(0===I.indexOf("DATASET")){var M=I.split(" ")[1];if("POLYDATA"!==M)throw Error("Unsupported DATASET type: "+M)}else if(f)for(;null!==(_=o.exec(I))&&null===s.exec(I);){var B=parseFloat(_[1]),S=parseFloat(_[2]),T=parseFloat(_[3]);r.push(B,S,T)}else if(g){if(null!==(_=l.exec(I))){var F=parseInt(_[1]),P=_[2].split(/\s+/);if(F>=3)for(var _,D,R,L=parseInt(P[0]),N=1,k=0;k<F-2;++k)D=parseInt(P[N]),R=parseInt(P[N+1]),t.push(L,D,R),N++}}else if(v){if(null!==(_=l.exec(I))){var L,D,R,F=parseInt(_[1]),P=_[2].split(/\s+/);if(F>=3)for(var k=0;k<F-2;k++)k%2==1?(L=parseInt(P[k]),D=parseInt(P[k+2]),R=parseInt(P[k+1])):(L=parseInt(P[k]),D=parseInt(P[k+1]),R=parseInt(P[k+2])),t.push(L,D,R)}}else if(y||x){if(b)for(;null!==(_=o.exec(I))&&null===s.exec(I);){var U=parseFloat(_[1]),Q=parseFloat(_[2]),O=parseFloat(_[3]);n.push(U,Q,O)}else if(w)for(;null!==(_=o.exec(I))&&null===s.exec(I);){var G=parseFloat(_[1]),H=parseFloat(_[2]),z=parseFloat(_[3]);a.push(G,H,z)}}null!==c.exec(I)?(g=!0,f=!1,v=!1):null!==h.exec(I)?(g=!1,f=!0,v=!1):null!==u.exec(I)?(g=!1,f=!1,v=!0):null!==d.exec(I)?(y=!0,f=!1,g=!1,v=!1):null!==m.exec(I)?(x=!0,f=!1,g=!1,v=!1):null!==p.exec(I)?(b=!0,w=!1,f=!1,g=!1,v=!1):null!==A.exec(I)&&(w=!0,b=!1,f=!1,g=!1,v=!1)}var V=new ee.u9r;if(V.setIndex(t),V.setAttribute("position",new ee.a$l(r,3)),a.length===r.length&&V.setAttribute("normal",new ee.a$l(a,3)),n.length!==t.length)n.length===r.length&&V.setAttribute("color",new ee.a$l(n,3));else{var j=(V=V.toNonIndexed()).attributes.position.count/3;if(n.length===3*j){for(var W=[],E=0;E<j;E++){var U=n[3*E+0],Q=n[3*E+1],O=n[3*E+2];W.push(U,Q,O),W.push(U,Q,O),W.push(U,Q,O)}V.setAttribute("color",new ee.a$l(W,3))}}return V}((0,cE.r)(e)):function(e){var t,r,n,a,s,o,l,h=new Uint8Array(e),c=new DataView(e),u=[],d=[],m=[],p=0;function A(e,t){for(var r=t,n=e[r],a=[];10!==n;)a.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:a.join("")}}for(;;){if(0===(l=(o=A(h,p)).parsedString).indexOf("DATASET")){var f=l.split(" ")[1];if("POLYDATA"!==f)throw Error("Unsupported DATASET type: "+f)}else if(0===l.indexOf("POINTS")){for(n=0,t=12*(a=parseInt(l.split(" ")[1],10)),u=new Float32Array(3*a),r=o.next;n<a;n++)u[3*n]=c.getFloat32(r,!1),u[3*n+1]=c.getFloat32(r+4,!1),u[3*n+2]=c.getFloat32(r+8,!1),r+=12;o.next=o.next+t+1}else if(0===l.indexOf("TRIANGLE_STRIPS")){var g=parseInt(l.split(" ")[1],10),v=parseInt(l.split(" ")[2],10);t=4*v,m=new Uint32Array(3*v-9*g);var y=0;for(n=0,r=o.next;n<g;n++){var x=c.getInt32(r,!1),b=[];for(r+=4,s=0;s<x;s++)b.push(c.getInt32(r,!1)),r+=4;for(var w=0;w<x-2;w++)w%2?(m[y++]=b[w],m[y++]=b[w+2],m[y++]=b[w+1]):(m[y++]=b[w],m[y++]=b[w+1],m[y++]=b[w+2])}o.next=o.next+t+1}else if(0===l.indexOf("POLYGONS")){var g=parseInt(l.split(" ")[1],10),v=parseInt(l.split(" ")[2],10);t=4*v,m=new Uint32Array(3*v-9*g);var y=0;for(n=0,r=o.next;n<g;n++){var x=c.getInt32(r,!1),b=[];for(r+=4,s=0;s<x;s++)b.push(c.getInt32(r,!1)),r+=4;for(var w=1;w<x-1;w++)m[y++]=b[0],m[y++]=b[w],m[y++]=b[w+1]}o.next=o.next+t+1}else if(0===l.indexOf("POINT_DATA")){for(n=0,a=parseInt(l.split(" ")[1],10),o=A(h,o.next),t=12*a,d=new Float32Array(3*a),r=o.next;n<a;n++)d[3*n]=c.getFloat32(r,!1),d[3*n+1]=c.getFloat32(r+4,!1),d[3*n+2]=c.getFloat32(r+8,!1),r+=12;o.next=o.next+t}if((p=o.next)>=h.byteLength)break}var C=new ee.u9r;return C.setIndex(new ee.TlE(m,1)),C.setAttribute("position",new ee.TlE(u,3)),d.length===u.length&&C.setAttribute("normal",new ee.TlE(d,3)),C}(e)}}class uG extends ee.aNw{load(e,t,r,n){let a=new ee.hH6(this.manager);a.setPath(this.path),a.setResponseType("text"),a.load(e,r=>{try{t(this.parse(r))}catch(t){n?n(t):console.error(t),this.manager.itemError(e)}},r,n)}parse(e){let t=(e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim()).split(/[\n\r]+/g),r=t[0].trim().split(/\s+/g).map(e=>parseFloat(e)),n=r[1]-r[0],a=r.length;for(let e=1,t=r.length;e<t;e++)if(n!==r[e]-r[e-1])throw Error("LUT3dlLoader: Inconsistent grid size not supported.");let s=Array(a*a*a*4),o=0,l=0;for(let e=1,r=t.length;e<r;e++){let r=t[e].trim().split(/\s/g),n=parseFloat(r[0]),h=parseFloat(r[1]),c=parseFloat(r[2]);l=Math.max(l,n,h,c);let u=o%a,d=Math.floor(o/a)%a,m=Math.floor(o/(a*a))%a,p=u*a*a+d*a+m;s[4*p+0]=n,s[4*p+1]=h,s[4*p+2]=c,s[4*p+3]=1,o+=1}let h=Math.pow(2,Math.ceil(Math.log2(l)));for(let e=0,t=s.length;e<t;e+=4){let t=s[e+0],r=s[e+1],n=s[e+2];s[e+0]=255*t/h,s[e+1]=255*r/h,s[e+2]=255*n/h}let c=new Uint8Array(s),u=new ee.IEO;u.image.data=c,u.image.width=a,u.image.height=a*a,u.format=ee.wk1,u.type=ee.ywz,u.magFilter=ee.wem,u.minFilter=ee.wem,u.wrapS=ee.uWy,u.wrapT=ee.uWy,u.generateMipmaps=!1,u.needsUpdate=!0;let d=new cJ;return d.image.data=c,d.image.width=a,d.image.height=a,d.image.depth=a,d.format=ee.wk1,d.type=ee.ywz,d.magFilter=ee.wem,d.minFilter=ee.wem,d.wrapS=ee.uWy,d.wrapT=ee.uWy,d.wrapR=ee.uWy,d.generateMipmaps=!1,d.needsUpdate=!0,{size:a,texture:u,texture3D:d}}}class uH extends ee.DqL{constructor(e){super(e)}parse(e,t){let r;let n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function a(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}let s=a("DXT1"),o=a("DXT3"),l=a("DXT5"),h=a("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;let u=c[21],d=!1;switch(u){case s:r=8,n.format=ee.wuA;break;case o:r=16,n.format=ee.v3W;break;case l:r=16,n.format=ee.ILR;break;case h:r=8,n.format=ee.fto;break;default:if(32!==c[22]||!(16711680&c[23])||!(65280&c[24])||!(255&c[25])||!(4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255)),n;d=!0,r=64,n.format=ee.wk1}n.mipmapCount=1,131072&c[2]&&!1!==t&&(n.mipmapCount=Math.max(1,c[7]));let m=c[28];if(n.isCubemap=!!(512&m),n.isCubemap&&(!(1024&m)||!(2048&m)||!(4096&m)||!(8192&m)||!(16384&m)||!(32768&m)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=c[4],n.height=c[3];let p=c[1]+4,A=n.isCubemap?6:1;for(let t=0;t<A;t++){let t=n.width,a=n.height;for(let s=0;s<n.mipmapCount;s++){let s,o;d?o=(s=function(e,t,r,n){let a=r*n*4,s=new Uint8Array(e,t,a),o=new Uint8Array(a),l=0,h=0;for(let e=0;e<n;e++)for(let e=0;e<r;e++){let e=s[h],t=s[++h],r=s[++h],n=s[++h];h++,o[l]=r,o[++l]=t,o[++l]=e,o[++l]=n,l++}return o}(e,p,t,a)).length:s=new Uint8Array(e,p,o=Math.max(4,t)/4*Math.max(4,a)/4*r);let l={data:s,width:t,height:a};n.mipmaps.push(l),p+=o,t=Math.max(t>>1,1),a=Math.max(a>>1,1)}}return n}}class uz extends ee.DqL{constructor(e){super(e)}parse(e,t){let r=new Uint32Array(e,0,13),n={buffer:e,header:r,loadMipmaps:t};return 55727696===r[0]?function(e){let t,r;let n=e.header,a=n[12],s=n[2],o=n[6],l=n[7],h=n[10],c=n[11];switch(s){case 0:t=2,r=ee.vCx;break;case 1:t=2,r=ee.CaW;break;case 2:t=4,r=ee._AM;break;case 3:t=4,r=ee.eaV;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",s)}return e.dataPtr=52+a,e.bpp=t,e.format=r,e.width=l,e.height=o,e.numSurfaces=h,e.numMipmaps=c,e.isCubemap=6===h,uV(e)}(n):559044176===r[11]?function(e){let t,r;let n=e.header,a=n[0],s=n[1],o=n[2],l=n[3],h=n[4],c=n[10],u=n[12],d=255&h,m=c>0;return 25===d?(r=m?ee.eaV:ee._AM,t=4):24===d?(r=m?ee.CaW:ee.vCx,t=2):console.error("THREE.PVRLoader: Unknown PVR format:",d),e.dataPtr=a,e.bpp=t,e.format=r,e.width=o,e.height=s,e.numSurfaces=u,e.numMipmaps=l+1,e.isCubemap=6===u,uV(e)}(n):void console.error("THREE.PVRLoader: Unknown PVR format.")}}function uV(e){let t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer,n=e.dataPtr,a=0,s=0,o=0,l=0,h=0,c=0,u=e.bpp,d=e.numSurfaces;s=(o=2===u?8:4)*(l=4)*u/8,t.mipmaps.length=e.numMipmaps*d;let m=0;for(;m<e.numMipmaps;){let u=e.width>>m,p=e.height>>m;(h=u/o)<2&&(h=2),(c=p/l)<2&&(c=2),a=h*c*s;for(let s=0;s<d;s++){let o={data:new Uint8Array(r,n,a),width:u,height:p};t.mipmaps[s*e.numMipmaps+m]=o,n+=a}m++}return t}class uj extends ee.aNw{constructor(e){super(e),this.splitLayer=!1}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t,r={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},n=[],a=new ee.nls({color:16711680});a.name="path";let s=new ee.nls({color:65280});function o(e){t={vertex:[],pathVertex:[],z:e.z},n.push(t)}function l(e,t){return r.relative?t:t-e}function h(e,t){return r.relative?e+t:t}s.name="extruded";let c=e.replace(/;.+/g,"").split("\n");for(let e=0;e<c.length;e++){let n=c[e].split(" "),a=n[0].toUpperCase(),s={};if(n.splice(1).forEach(function(e){if(void 0!==e[0]){let t=e[0].toLowerCase(),r=parseFloat(e.substring(1));s[t]=r}}),"G0"===a||"G1"===a){var u;let e={x:void 0!==s.x?h(r.x,s.x):r.x,y:void 0!==s.y?h(r.y,s.y):r.y,z:void 0!==s.z?h(r.z,s.z):r.z,e:void 0!==s.e?h(r.e,s.e):r.e,f:void 0!==s.f?h(r.f,s.f):r.f};l(r.e,e.e)>0&&(e.extruding=l(r.e,e.e)>0,(void 0==t||e.z!=t.z)&&o(e)),u=r,void 0===t&&o(u),r.extruding?(t.vertex.push(u.x,u.y,u.z),t.vertex.push(e.x,e.y,e.z)):(t.pathVertex.push(u.x,u.y,u.z),t.pathVertex.push(e.x,e.y,e.z)),r=e}else if("G2"===a||"G3"===a);else if("G90"===a)r.relative=!1;else if("G91"===a)r.relative=!0;else if("G92"===a){let e=r;e.x=void 0!==s.x?s.x:e.x,e.y=void 0!==s.y?s.y:e.y,e.z=void 0!==s.z?s.z:e.z,e.e=void 0!==s.e?s.e:e.e,r=e}}function d(e,t,r){let n=new ee.u9r;n.setAttribute("position",new ee.a$l(e,3));let o=new ee.ejS(n,t?s:a);o.name="layer"+r,m.add(o)}let m=new ee.ZAu;if(m.name="gcode",this.splitLayer)for(let e=0;e<n.length;e++){let t=n[e];d(t.vertex,!0,e),d(t.pathVertex,!1,e)}else{let e=[],t=[];for(let r=0;r<n.length;r++){let a=n[r],s=a.vertex,o=a.pathVertex;for(let t=0;t<s.length;t++)e.push(s[t]);for(let e=0;e<o.length;e++)t.push(o[e])}d(e,!0,n.length),d(t,!1,n.length)}return m.quaternion.setFromEuler(new ee.USm(-Math.PI/2,0,0)),m}}var uW=Object.defineProperty,uX=(e,t,r)=>t in e?uW(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uY=(e,t,r)=>(uX(e,"symbol"!=typeof t?t+"":t,r),r);let uK=new WeakMap,uJ=class extends ee.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}load(e,t,r,n){let a=new ee.hH6(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);let s=new ee.EB7;return a.load(e,e=>{if(uK.has(e))return uK.get(e).promise.then(t).catch(n);this._createTexture([e]).then(function(e){s.copy(e),s.needsUpdate=!0,t&&t(s)}).catch(n)},r,n),s}parseInternalAsync(e){let{levels:t}=e,r=new Set;for(let e=0;e<t.length;e++)r.add(t[e].data.buffer);return this._createTexture(Array.from(r),{...e,lowLevel:!0})}_createTexture(e,t={}){let r,n;let a=0;for(let t=0;t<e.length;t++)a+=e[t].byteLength;let s=this._allocateWorker(a).then(a=>(r=a,n=this.workerNextTaskID++,new Promise((a,s)=>{r._callbacks[n]={resolve:a,reject:s},r.postMessage({type:"transcode",id:n,buffers:e,taskConfig:t},e)}))).then(e=>{let{mipmaps:t,width:r,height:n,format:a}=e,s=new ee.EB7(t,r,n,a,ee.ywz);return s.minFilter=1===t.length?ee.wem:ee.D1R,s.magFilter=ee.wem,s.generateMipmaps=!1,s.needsUpdate=!0,s});return s.catch(()=>!0).then(()=>{r&&n&&(r._taskLoad-=a,delete r._callbacks[n])}),uK.set(e[0],{promise:s}),s}_initTranscoder(){if(!this.transcoderPending){let e=new ee.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=new Promise((t,r)=>{e.load("basis_transcoder.js",t,void 0,r)}),r=new ee.hH6(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);let n=new Promise((e,t)=>{r.load("basis_transcoder.wasm",e,void 0,t)});this.transcoderPending=Promise.all([t,n]).then(([e,t])=>{let r=uJ.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(uJ.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(uJ.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(uJ.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=t})}return this.transcoderPending}_allocateWorker(e){return this._initTranscoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskLoad=0,e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),e.onmessage=function(t){let r=t.data;switch(r.type){case"transcode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}dispose(){for(let e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}},uq=uJ;uY(uq,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),uY(uq,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),uY(uq,"EngineFormat",{RGBAFormat:ee.wk1,RGBA_ASTC_4x4_Format:ee.ptH,RGBA_BPTC_Format:ee.bsb,RGBA_ETC2_EAC_Format:ee.ekQ,RGBA_PVRTC_4BPPV1_Format:ee.eaV,RGBA_S3TC_DXT5_Format:ee.ILR,RGB_ETC1_Format:ee.fto,RGB_ETC2_Format:ee.l0P,RGB_PVRTC_4BPPV1_Format:ee._AM,RGB_S3TC_DXT1_Format:ee.wuA}),uY(uq,"BasisWorker",function(){let e,t,r;let n=_EngineFormat,a=_TranscoderFormat,s=_BasisFormat;onmessage=function(n){let a=n.data;switch(a.type){case"init":var o;e=a.config,o=a.transcoderBinary,t=new Promise(e=>{BASIS(r={wasmBinary:o,onRuntimeInitialized:e})}).then(()=>{r.initializeBasis()});break;case"transcode":t.then(()=>{try{let{width:e,height:t,hasAlpha:n,mipmaps:o,format:l}=a.taskConfig.lowLevel?function(e){let{basisFormat:t,width:n,height:a,hasAlpha:o}=e,{transcoderFormat:l,engineFormat:h}=c(t,n,a,o),A=r.getBytesPerBlockOrPixel(l);u(r.isFormatSupported(l),"THREE.BasisTextureLoader: Unsupported format.");let f=[];if(t===s.ETC1S){let t=new r.LowLevelETC1SImageTranscoder,{endpointCount:n,endpointsData:a,selectorCount:s,selectorsData:h,tablesData:c}=e.globalData;try{let r;r=t.decodePalettes(n,a,s,h),u(r,"THREE.BasisTextureLoader: decodePalettes() failed."),r=t.decodeTables(c),u(r,"THREE.BasisTextureLoader: decodeTables() failed.");for(let n=0;n<e.levels.length;n++){let a=e.levels[n],s=e.globalData.imageDescs[n],h=p(l,a.width,a.height),c=new Uint8Array(h);r=t.transcodeImage(l,c,h/A,a.data,d(l,a.width),m(l,a.height),a.width,a.height,a.index,s.rgbSliceByteOffset,s.rgbSliceByteLength,s.alphaSliceByteOffset,s.alphaSliceByteLength,s.imageFlags,o,!1,0,0),u(r,"THREE.BasisTextureLoader: transcodeImage() failed for level "+a.index+"."),f.push({data:c,width:a.width,height:a.height})}}finally{t.delete()}}else for(let t=0;t<e.levels.length;t++){let n=e.levels[t],a=p(l,n.width,n.height),s=new Uint8Array(a);u(r.transcodeUASTCImage(l,s,a/A,n.data,d(l,n.width),m(l,n.height),n.width,n.height,n.index,0,n.data.byteLength,0,o,!1,0,0,-1,-1),"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+n.index+"."),f.push({data:s,width:n.width,height:n.height})}return{width:n,height:a,hasAlpha:o,mipmaps:f,format:h}}(a.taskConfig):function(e){let t=new r.BasisFile(new Uint8Array(e)),n=t.isUASTC()?s.UASTC_4x4:s.ETC1S,a=t.getImageWidth(0,0),o=t.getImageHeight(0,0),l=t.getNumLevels(0),h=t.getHasAlpha();function u(){t.close(),t.delete()}let{transcoderFormat:d,engineFormat:m}=c(n,a,o,h);if(!a||!o||!l)throw u(),Error("THREE.BasisTextureLoader:	Invalid texture");if(!t.startTranscoding())throw u(),Error("THREE.BasisTextureLoader: .startTranscoding failed");let p=[];for(let e=0;e<l;e++){let r=t.getImageWidth(0,e),n=t.getImageHeight(0,e),a=new Uint8Array(t.getImageTranscodedSizeInBytes(0,e,d));if(!t.transcodeImage(a,0,e,d,0,h))throw u(),Error("THREE.BasisTextureLoader: .transcodeImage failed.");p.push({data:a,width:r,height:n})}return u(),{width:a,height:o,hasAlpha:h,mipmaps:p,format:m}}(a.buffers[0]),h=[];for(let e=0;e<o.length;++e)h.push(o[e].data.buffer);self.postMessage({type:"transcode",id:a.id,width:e,height:t,hasAlpha:n,mipmaps:o,format:l},h)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}})}};let o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC1],engineFormat:[n.RGB_ETC1_Format,n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),h=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(t,r,o,c){let u;let d=t===s.ETC1S?l:h;for(let n=0;n<d.length;n++){let a=d[n];if(e[a.if]&&a.basisFormat.includes(t)&&(!a.needsPowerOfTwo||A(r)&&A(o)))return{transcoderFormat:a.transcoderFormat[c?1:0],engineFormat:a.engineFormat[c?1:0]}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:a.RGBA32,engineFormat:n.RGBAFormat}}function u(e,t){if(!e)throw Error(t)}function d(e,t){return Math.ceil(t/r.getFormatBlockWidth(e))}function m(e,t){return Math.ceil(t/r.getFormatBlockHeight(e))}function p(e,t,n){let s=r.getBytesPerBlockOrPixel(e);return r.formatIsUncompressed(e)?t*n*s:e===a.PVRTC1_4_RGB||e===a.PVRTC1_4_RGBA?(Math.max(8,t+3&-4)*Math.max(8,n+3&-4)*4+7)/8:d(e,t)*m(e,n)*s}function A(e){return e<=2||(e&e-1)==0&&0!==e}});class uZ extends ee.aNw{constructor(e){super(e),this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]}load(e,t,r,n){let a=this,s=""===this.path?ee.Zp0.extractUrlBase(e):this.path,o=new ee.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{t(a.parse(r,s))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){this.group=new ee.ZAu,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(let e=0;e<this.meshes.length;e++)this.group.add(this.meshes[e]);return this.group}readFile(e,t){let r=new DataView(e),n=this.readChunk(r);if(n.id===u0||n.id===u1||n.id===u$){let e=this.nextChunk(r,n);for(;0!==e;){if(e===u2){let e=this.readDWord(r);this.debugMessage("3DS file version: "+e)}else e===u7?(this.resetPosition(r),this.readMeshData(r,t)):this.debugMessage("Unknown main chunk: "+e.toString(16));e=this.nextChunk(r,n)}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,t){let r=this.readChunk(e),n=this.nextChunk(e,r);for(;0!==n;){if(n===de){let t=+this.readDWord(e);this.debugMessage("Mesh Version: "+t)}else if(n===dt){let t=this.readFloat(e);this.debugMessage("Master scale: "+t),this.group.scale.set(t,t,t)}else n===dC?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):n===di?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(e,r)}}readNamedObject(e){let t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;let n=this.nextChunk(e,t);for(;0!==n;){if(n===dE){this.resetPosition(e);let t=this.readMesh(e);t.name=r,this.meshes.push(t)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(e,t)}this.endChunk(t)}readMaterialEntry(e,t){let r=this.readChunk(e),n=this.nextChunk(e,r),a=new ee.xoR;for(;0!==n;){if(n===dr)a.name=this.readString(e,64),this.debugMessage("   Name: "+a.name);else if(n===dd)this.debugMessage("   Wireframe"),a.wireframe=!0;else if(n===dm){let t=this.readByte(e);a.wireframeLinewidth=t,this.debugMessage("   Wireframe Thickness: "+t)}else if(n===dc)a.side=ee.ehD,this.debugMessage("   DoubleSided");else if(n===du)this.debugMessage("   Additive Blending"),a.blending=ee.WMw;else if(n===da)this.debugMessage("   Diffuse Color"),a.color=this.readColor(e);else if(n===ds)this.debugMessage("   Specular Color"),a.specular=this.readColor(e);else if(n===dn)this.debugMessage("   Ambient color"),a.color=this.readColor(e);else if(n===dl){let t=this.readPercentage(e);a.shininess=100*t,this.debugMessage("   Shininess : "+t)}else if(n===dh){let t=this.readPercentage(e);a.opacity=1-t,this.debugMessage("  Transparency : "+t),a.transparent=a.opacity<1}else n===dp?(this.debugMessage("   ColorMap"),this.resetPosition(e),a.map=this.readMap(e,t)):n===df?(this.debugMessage("   BumpMap"),this.resetPosition(e),a.bumpMap=this.readMap(e,t)):n===dA?(this.debugMessage("   OpacityMap"),this.resetPosition(e),a.alphaMap=this.readMap(e,t)):n===dg?(this.debugMessage("   SpecularMap"),this.resetPosition(e),a.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(e,r)}this.endChunk(r),this.materials[a.name]=a}readMesh(e){let t=this.readChunk(e),r=this.nextChunk(e,t),n=new ee.u9r,a=new ee.xoR,s=new ee.Kj0(n,a);for(s.name="mesh";0!==r;){if(r===dI){let t=this.readWord(e);this.debugMessage("   Vertex: "+t);let r=[];for(let n=0;n<t;n++)r.push(this.readFloat(e)),r.push(this.readFloat(e)),r.push(this.readFloat(e));n.setAttribute("position",new ee.a$l(r,3))}else if(r===dM)this.resetPosition(e),this.readFaceArray(e,s);else if(r===dS){let t=this.readWord(e);this.debugMessage("   UV: "+t);let r=[];for(let n=0;n<t;n++)r.push(this.readFloat(e)),r.push(this.readFloat(e));n.setAttribute("uv",new ee.a$l(r,2))}else if(r===dT){this.debugMessage("   Tranformation Matrix (TODO)");let t=[];for(let r=0;r<12;r++)t[r]=this.readFloat(e);let r=new ee.yGw;r.elements[0]=t[0],r.elements[1]=t[6],r.elements[2]=t[3],r.elements[3]=t[9],r.elements[4]=t[2],r.elements[5]=t[8],r.elements[6]=t[5],r.elements[7]=t[11],r.elements[8]=t[1],r.elements[9]=t[7],r.elements[10]=t[4],r.elements[11]=t[10],r.elements[12]=0,r.elements[13]=0,r.elements[14]=0,r.elements[15]=1,r.transpose();let a=new ee.yGw;a.copy(r).invert(),n.applyMatrix4(a),r.decompose(s.position,s.quaternion,s.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}return this.endChunk(t),n.computeVertexNormals(),s}readFaceArray(e,t){let r=this.readChunk(e),n=this.readWord(e);this.debugMessage("   Faces: "+n);let a=[];for(let t=0;t<n;++t)a.push(this.readWord(e),this.readWord(e),this.readWord(e)),this.readWord(e);t.geometry.setIndex(a);let s=0,o=0;for(;this.position<r.end;){let r=this.readChunk(e);if(r.id===dB){this.debugMessage("      Material Group"),this.resetPosition(e);let r=this.readMaterialGroup(e),n=3*r.index.length;t.geometry.addGroup(o,n,s),o+=n,s++;let a=this.materials[r.name];!1===Array.isArray(t.material)&&(t.material=[]),void 0!==a&&t.material.push(a)}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}1===t.material.length&&(t.material=t.material[0]),this.endChunk(r)}readMap(e,t){let r=this.readChunk(e),n=this.nextChunk(e,r),a={},s=new ee.dpR(this.manager);for(s.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==n;){if(n===dv){let r=this.readString(e,128);a=s.load(r),this.debugMessage("      File: "+t+r)}else n===db?(a.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+a.offset.x)):n===dw?(a.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+a.offset.y)):n===dy?(a.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+a.repeat.x)):n===dx?(a.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+a.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(e,r)}return this.endChunk(r),a}readMaterialGroup(e){this.readChunk(e);let t=this.readString(e,64),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);let n=[];for(let t=0;t<r;++t)n.push(this.readWord(e));return{name:t,index:n}}readColor(e){let t=this.readChunk(e),r=new ee.Ilk;if(t.id===u4||t.id===u5){let t=this.readByte(e),n=this.readByte(e),a=this.readByte(e);r.setRGB(t/255,n/255,a/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===u3||t.id===u8){let t=this.readFloat(e),n=this.readFloat(e),a=this.readFloat(e);r.setRGB(t,n,a),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r}readChunk(e){let t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t}endChunk(e){this.position=e.end}nextChunk(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{let r=this.readChunk(e);return t.cur+=r.size,r.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}}resetPosition(){this.position-=6}readByte(e){let t=e.getUint8(this.position,!0);return this.position+=1,t}readFloat(e){try{let t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}}readInt(e){let t=e.getInt32(this.position,!0);return this.position+=4,t}readShort(e){let t=e.getInt16(this.position,!0);return this.position+=2,t}readDWord(e){let t=e.getUint32(this.position,!0);return this.position+=4,t}readWord(e){let t=e.getUint16(this.position,!0);return this.position+=2,t}readString(e,t){let r="";for(let n=0;n<t;n++){let t=this.readByte(e);if(!t)break;r+=String.fromCharCode(t)}return r}readPercentage(e){let t;let r=this.readChunk(e);switch(r.id){case u6:t=this.readShort(e)/100;break;case u9:t=this.readFloat(e);break;default:this.debugMessage("      Unknown percentage chunk: "+r.toString(16))}return this.endChunk(r),t}debugMessage(e){this.debug&&console.log(e)}}let u$=19789,u0=15786,u1=49725,u2=2,u3=16,u4=17,u5=18,u8=19,u6=48,u9=49,u7=15677,de=15678,dt=256,di=45055,dr=40960,dn=40976,da=40992,ds=41008,dl=41024,dh=41040,dc=41089,du=41091,dd=41093,dm=41095,dp=41472,dA=41488,df=41520,dg=41476,dv=41728,dy=41812,dx=41814,db=41816,dw=41818,dC=16384,dE=16640,dI=16656,dM=16672,dB=16688,dS=16704,dT=16736,dF=new ee.Pa4,dP=new ee.Pa4;class d_ extends ee.jyz{constructor(e){super({uniforms:ee.rDY.merge([ee.rBU.fog,{diffuse:{value:new ee.Ilk},opacity:{value:1}}]),vertexShader:`
        attribute vec3 control0;
        attribute vec3 control1;
        attribute vec3 direction;
        varying float discardFlag;

        #include <common>
        #include <color_pars_vertex>
        #include <fog_pars_vertex>
        #include <logdepthbuf_pars_vertex>
        #include <clipping_planes_pars_vertex>

        void main() {
          #include <color_vertex>

          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
          gl_Position = projectionMatrix * mvPosition;

          // Transform the line segment ends and control points into camera clip space
          vec4 c0 = projectionMatrix * modelViewMatrix * vec4(control0, 1.0);
          vec4 c1 = projectionMatrix * modelViewMatrix * vec4(control1, 1.0);
          vec4 p0 = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          vec4 p1 = projectionMatrix * modelViewMatrix * vec4(position + direction, 1.0);

          c0.xy /= c0.w;
          c1.xy /= c1.w;
          p0.xy /= p0.w;
          p1.xy /= p1.w;

          // Get the direction of the segment and an orthogonal vector
          vec2 dir = p1.xy - p0.xy;
          vec2 norm = vec2(-dir.y, dir.x);

          // Get control point directions from the line
          vec2 c0dir = c0.xy - p1.xy;
          vec2 c1dir = c1.xy - p1.xy;

          // If the vectors to the controls points are pointed in different directions away
          // from the line segment then the line should not be drawn.
          float d0 = dot(normalize(norm), normalize(c0dir));
          float d1 = dot(normalize(norm), normalize(c1dir));
          discardFlag = float(sign(d0) != sign(d1));

          #include <logdepthbuf_vertex>
          #include <clipping_planes_vertex>
          #include <fog_vertex>
        }
      `,fragmentShader:`
        uniform vec3 diffuse;
        uniform float opacity;
        varying float discardFlag;

        #include <common>
        #include <color_pars_fragment>
        #include <fog_pars_fragment>
        #include <logdepthbuf_pars_fragment>
        #include <clipping_planes_pars_fragment>

        void main() {
          if (discardFlag > 0.5) discard;

          #include <clipping_planes_fragment>
          vec3 outgoingLight = vec3(0.0);
          vec4 diffuseColor = vec4(diffuse, opacity);
          #include <logdepthbuf_fragment>
          #include <color_fragment>
          outgoingLight = diffuseColor.rgb; // simple shader
          gl_FragColor = vec4(outgoingLight, diffuseColor.a);
          #include <tonemapping_fragment>
          #include <${parseInt(ee.UZH.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
          #include <fog_fragment>
          #include <premultiplied_alpha_fragment>
        }
      `}),Object.defineProperties(this,{opacity:{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},color:{get:function(){return this.uniforms.diffuse.value}}}),this.setValues(e),this.isLDrawConditionalLineMaterial=!0}}class dD extends ee.ejS{constructor(e,t){super(e,t),this.isConditionalLine=!0}}let dR=new ee.zHn;function dL(e){return"Part"===e||"Unofficial_Part"===e}class dN{constructor(e,t){this.line=e,this.lineLength=e.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=t}seekNonSpace(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"	"!==this.currentChar)return;this.currentCharIndex++}}getToken(){let e=this.currentCharIndex++;for(;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"	"!==this.currentChar);)this.currentCharIndex++;let t=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(e,t)}getVector(){return new ee.Pa4(parseFloat(this.getToken()),parseFloat(this.getToken()),parseFloat(this.getToken()))}getRemainingString(){return this.line.substring(this.currentCharIndex,this.lineLength)}isAtTheEnd(){return this.currentCharIndex>=this.lineLength}setToEnd(){this.currentCharIndex=this.lineLength}getLineNumberString(){return this.lineNumber>=0?" at line "+this.lineNumber:""}}class dk{constructor(e){this.loader=e,this._cache={}}cloneResult(e){let t={};return t.faces=e.faces.map(e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map(e=>e.clone()),normals:e.normals.map(()=>null),faceNormal:null})),t.conditionalSegments=e.conditionalSegments.map(e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map(e=>e.clone()),controlPoints:e.controlPoints.map(e=>e.clone())})),t.lineSegments=e.lineSegments.map(e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map(e=>e.clone())})),t.type=e.type,t.category=e.category,t.keywords=e.keywords,t.subobjects=e.subobjects,t.totalFaces=e.totalFaces,t.startingConstructionStep=e.startingConstructionStep,t.materials=e.materials,t.group=null,t}async fetchData(e){let t=!1,r=0;for(;6!==r;){let n=e;switch(r){case 0:r+=1;break;case 1:n="parts/"+n,r+=1;break;case 2:n="p/"+n,r+=1;break;case 3:n="models/"+n,r+=1;break;case 4:n=e.substring(0,e.lastIndexOf("/")+1)+n,r+=1;break;case 5:t?r=6:(n=e=e.toLowerCase(),t=!0,r=0)}let a=this.loader,s=new ee.hH6(a.manager);s.setPath(a.partsLibraryPath),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials);try{return await s.loadAsync(n)}catch(e){continue}}throw Error('LDrawLoader: Subobject "'+e+'" could not be loaded.')}parse(e,t=null){let r=this.loader,n=[],a=[],s=[],o=[],l={},h=e=>l[e]||null,c="Model",u=null,d=null,m=0;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n"));let p=e.split("\n"),A=p.length,f=!1,g=null,v=null,y=!1,x=!0,b=!1,w=!0,C=!1;for(let e=0;e<A;e++){let t,A,E,I,M,B,S,T,F;let P=p[e];if(0===P.length)continue;if(f){P.startsWith("0 FILE ")?(this.setData(g,v),g=P.substring(7),v=""):v+=P+"\n";continue}let _=new dN(P,e+1);if(_.seekNonSpace(),_.isAtTheEnd())continue;let D=_.getToken();switch(D){case"0":let R=_.getToken();if(R)switch(R){case"!LDRAW_ORG":c=_.getToken();break;case"!COLOUR":(t=r.parseColorMetaDirective(_))?l[t.userData.code]=t:console.warn("LDrawLoader: Error parsing material"+_.getLineNumberString());break;case"!CATEGORY":u=_.getToken();break;case"!KEYWORDS":let L=_.getRemainingString().split(",");L.length>0&&(d||(d=[]),L.forEach(function(e){d.push(e.trim())}));break;case"FILE":e>0&&(f=!0,g=_.getRemainingString(),v="",y=!1,x=!0);break;case"BFC":for(;!_.isAtTheEnd();){let e=_.getToken();switch(e){case"CERTIFY":case"NOCERTIFY":y="CERTIFY"===e,x=!0;break;case"CW":case"CCW":x="CCW"===e;break;case"INVERTNEXT":b=!0;break;case"CLIP":case"NOCLIP":w="CLIP"===e;break;default:console.warn('THREE.LDrawLoader: BFC directive "'+e+'" is unknown.')}}break;case"STEP":C=!0}break;case"1":t=h(A=_.getToken());let N=parseFloat(_.getToken()),k=parseFloat(_.getToken()),U=parseFloat(_.getToken()),Q=parseFloat(_.getToken()),O=parseFloat(_.getToken()),G=parseFloat(_.getToken()),H=parseFloat(_.getToken()),z=parseFloat(_.getToken()),V=parseFloat(_.getToken()),j=parseFloat(_.getToken()),W=parseFloat(_.getToken()),X=parseFloat(_.getToken()),Y=new ee.yGw().set(Q,O,G,N,H,z,V,k,j,W,X,U,0,0,0,1),K=_.getRemainingString().trim().replace(/\\/g,"/");r.fileMap[K]?K=r.fileMap[K]:K.startsWith("s/")?K="parts/"+K:K.startsWith("48/")&&(K="p/"+K),o.push({material:t,colorCode:A,matrix:Y,fileName:K,inverted:b,startingConstructionStep:C}),b=!1;break;case"2":E={material:t=h(A=_.getToken()),colorCode:A,vertices:[B=_.getVector(),S=_.getVector()]},a.push(E);break;case"5":t=h(A=_.getToken()),B=_.getVector(),E={material:t,colorCode:A,vertices:[B,S=_.getVector()],controlPoints:[_.getVector(),_.getVector()]},s.push(E);break;case"3":t=h(A=_.getToken()),I=x,M=!y||!w,!0===I?(B=_.getVector(),S=_.getVector(),T=_.getVector()):(T=_.getVector(),S=_.getVector(),B=_.getVector()),n.push({material:t,colorCode:A,faceNormal:null,vertices:[B,S,T],normals:[null,null,null]}),m++,!0===M&&(n.push({material:t,colorCode:A,faceNormal:null,vertices:[T,S,B],normals:[null,null,null]}),m++);break;case"4":t=h(A=_.getToken()),I=x,M=!y||!w,!0===I?(B=_.getVector(),S=_.getVector(),T=_.getVector(),F=_.getVector()):(F=_.getVector(),T=_.getVector(),S=_.getVector(),B=_.getVector()),n.push({material:t,colorCode:A,faceNormal:null,vertices:[B,S,T,F],normals:[null,null,null,null]}),m+=2,!0===M&&(n.push({material:t,colorCode:A,faceNormal:null,vertices:[F,T,S,B],normals:[null,null,null,null]}),m+=2);break;default:throw Error('LDrawLoader: Unknown line type "'+D+'"'+_.getLineNumberString()+".")}}return f&&this.setData(g,v),{faces:n,conditionalSegments:s,lineSegments:a,type:c,category:u,keywords:d,subobjects:o,totalFaces:m,startingConstructionStep:C,materials:l,fileName:t,group:null}}getData(e,t=!0){let r=e.toLowerCase(),n=this._cache[r];return null===n||n instanceof Promise?null:t?this.cloneResult(n):n}async ensureDataLoaded(e){let t=e.toLowerCase();t in this._cache||(this._cache[t]=this.fetchData(e).then(r=>{let n=this.parse(r,e);return this._cache[t]=n,n})),await this._cache[t]}setData(e,t){let r=e.toLowerCase();this._cache[r]=this.parse(t,e)}}function dU(e,t,r,n){return(!n&&"16"===e||n&&"24"===e)&&(e=t),r[e]||null}class dQ{constructor(e){this.loader=e,this.parseCache=new dk(e),this._cache={}}async processIntoMesh(e){let t=this.loader,r=this.parseCache,n=new Set,a=async(e,s=null)=>{let o=e.subobjects,l=[];for(let e=0,t=o.length;e<t;e++){let t=o[e],n=r.ensureDataLoaded(t.fileName).then(()=>{var e;return(e=r.getData(t.fileName,!1).type,/primitive/i.test(e)||"Subpart"===e)?a(r.getData(t.fileName),t):this.loadModel(t.fileName).catch(e=>(console.warn(e),null))});l.push(n)}let h=new ee.ZAu;h.userData.category=e.category,h.userData.keywords=e.keywords,e.group=h;let c=await Promise.all(l);for(let r=0,a=c.length;r<a;r++){let a=e.subobjects[r],s=c[r];if(null===s)continue;if(s.isGroup){a.matrix.decompose(s.position,s.quaternion,s.scale),s.userData.startingConstructionStep=a.startingConstructionStep,s.name=a.fileName,t.applyMaterialsToMesh(s,a.colorCode,e.materials),h.add(s);continue}s.group.children.length&&h.add(s.group);let o=e.lineSegments,l=e.conditionalSegments,u=e.faces,d=s.lineSegments,m=s.conditionalSegments,p=s.faces,A=a.matrix,f=a.inverted,g=0>A.determinant(),v=a.colorCode,y="16"===v?"24":v;for(let t=0,r=d.length;t<r;t++){let r=d[t],n=r.vertices;n[0].applyMatrix4(A),n[1].applyMatrix4(A),r.colorCode="24"===r.colorCode?y:r.colorCode,r.material=r.material||dU(r.colorCode,r.colorCode,e.materials,!0),o.push(r)}for(let t=0,r=m.length;t<r;t++){let r=m[t],n=r.vertices,a=r.controlPoints;n[0].applyMatrix4(A),n[1].applyMatrix4(A),a[0].applyMatrix4(A),a[1].applyMatrix4(A),r.colorCode="24"===r.colorCode?y:r.colorCode,r.material=r.material||dU(r.colorCode,r.colorCode,e.materials,!0),l.push(r)}for(let t=0,r=p.length;t<r;t++){let r=p[t],a=r.vertices;for(let e=0,t=a.length;e<t;e++)a[e].applyMatrix4(A);r.colorCode="16"===r.colorCode?v:r.colorCode,r.material=r.material||dU(r.colorCode,v,e.materials,!1),n.add(r.colorCode),g!==f&&a.reverse(),u.push(r)}e.totalFaces+=s.totalFaces}return s&&t.applyMaterialsToMesh(h,s.colorCode,e.materials),e};for(let t=0,r=e.faces;t<r;t++)n.add(e.faces[t].colorCode);if(await a(e),t.smoothNormals){let t=n.size>1;!function(e){for(let t=0,r=e.length;t<r;t++){let r=e[t],n=r.vertices,a=n[0],s=n[1],o=n[2];dF.subVectors(s,a),dP.subVectors(o,s),r.faceNormal=new ee.Pa4().crossVectors(dF,dP).normalize()}}(e.faces),function(e,t,r=!1){let n=(1+1e-10)*100;function a(e){let t=~~(e.x*n),r=~~(e.y*n),a=~~(e.z*n);return`${t},${r},${a}`}function s(e,t){return`${a(e)}_${a(t)}`}function o(e,t,r){r.direction.subVectors(t,e).normalize();let n=e.dot(r.direction);return r.origin.copy(e).addScaledVector(r.direction,-n),r}function l(e){return s(e.origin,e.direction)}let h=new Set,c=new Map,u={},d=[];for(let e=0,n=t.length;e<n;e++){let n=t[e].vertices,a=n[0],u=n[1];if(h.add(s(a,u)),h.add(s(u,a)),r){let e=o(a,u,new ee.zHn),t=l(e);if(!c.has(t)){o(u,a,e);let r=l(e),n={ray:e,distances:[]};c.set(t,n),c.set(r,n)}let r=c.get(t),n=r.ray.direction.dot(a),s=r.ray.direction.dot(u);n>s&&([n,s]=[s,n]),r.distances.push(n,s)}}for(let t=0,n=e.length;t<n;t++){let n=e[t],a=n.vertices,d=a.length;for(let e=0;e<d;e++){let t=e,m=(e+1)%d,p=a[t],A=a[m],f=s(p,A);if(h.has(f))continue;if(r){o(p,A,dR);let e=l(dR);if(c.has(e)){let{ray:t,distances:r}=c.get(e),n=t.direction.dot(p),a=t.direction.dot(A);n>a&&([n,a]=[a,n]);let s=!1;for(let e=0,t=r.length;e<t;e+=2)if(n>=r[e]&&a<=r[e+1]){s=!0;break}if(s)continue}}let g={index:t,tri:n};u[f]=g}}for(;;){let e=null;for(let t in u){e=u[t];break}if(null===e)break;let t=[e];for(;t.length>0;){let e=t.pop().tri,r=e.vertices,n=e.normals,a=e.faceNormal,o=r.length;for(let l=0;l<o;l++){let h=l,c=(l+1)%o,m=r[h],p=r[c],A=s(m,p);delete u[A];let f=s(p,m),g=u[f];if(g){let r=g.tri,s=g.index,o=r.normals,l=o.length,m=r.faceNormal;if(.25>Math.abs(r.faceNormal.dot(e.faceNormal)))continue;f in u&&(t.push(g),delete u[f]);let p=(s+1)%l;n[h]&&o[p]&&n[h]!==o[p]&&(o[p].norm.add(n[h].norm),n[h].norm=o[p].norm);let A=n[h]||o[p];null===A&&(A={norm:new ee.Pa4},d.push(A.norm)),null===n[h]&&(n[h]=A,A.norm.add(a)),null===o[p]&&(o[p]=A,A.norm.add(m)),n[c]&&o[s]&&n[c]!==o[s]&&(o[s].norm.add(n[c].norm),n[c].norm=o[s].norm);let v=n[c]||o[s];null===v&&(v={norm:new ee.Pa4},d.push(v.norm)),null===n[c]&&(n[c]=v,v.norm.add(a)),null===o[s]&&(o[s]=v,v.norm.add(m))}}}}for(let e=0,t=d.length;e<t;e++)d[e].normalize()}(e.faces,e.lineSegments,t)}let s=e.group;return e.faces.length>0&&s.add(dG(e.faces,3,!1,e.totalFaces)),e.lineSegments.length>0&&s.add(dG(e.lineSegments,2)),e.conditionalSegments.length>0&&s.add(dG(e.conditionalSegments,2,!0)),s}hasCachedModel(e){return null!==e&&e.toLowerCase() in this._cache}async getCachedModel(e){if(!(null!==e&&this.hasCachedModel(e)))return null;{let t=e.toLowerCase();return(await this._cache[t]).clone()}}async loadModel(e){let t=this.parseCache,r=e.toLowerCase();if(this.hasCachedModel(e))return this.getCachedModel(e);{await t.ensureDataLoaded(e);let n=t.getData(e),a=this.processIntoMesh(n);return this.hasCachedModel(e)?this.getCachedModel(e):(dL(n.type)&&(this._cache[r]=a),(await a).clone())}}async parseModel(e){let t=this.parseCache.parse(e);return dL(t.type)&&this.hasCachedModel(t.fileName)?this.getCachedModel(t.fileName):this.processIntoMesh(t)}}function dO(e,t){return e.colorCode===t.colorCode?0:e.colorCode<t.colorCode?-1:1}function dG(e,t,r=!1,n=null){e.sort(dO),null===n&&(n=e.length);let a=new Float32Array(t*n*3),s=3===t?new Float32Array(t*n*3):null,o=[],l=Array(6),h=new ee.u9r,c=null,u=0,d=0,m=0;for(let n=0,p=e.length;n<p;n++){let p=e[n],A=p.vertices;4===A.length&&(l[0]=A[0],l[1]=A[1],l[2]=A[2],l[3]=A[0],l[4]=A[2],l[5]=A[3],A=l);for(let e=0,t=A.length;e<t;e++){let t=A[e],r=m+3*e;a[r+0]=t.x,a[r+1]=t.y,a[r+2]=t.z}if(3===t){if(!p.faceNormal){let e=A[0],t=A[1],r=A[2];dF.subVectors(t,e),dP.subVectors(r,t),p.faceNormal=new ee.Pa4().crossVectors(dF,dP).normalize()}let e=p.normals;4===e.length&&(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[0],l[4]=e[2],l[5]=e[3],e=l);for(let t=0,r=e.length;t<r;t++){let r=p.faceNormal;e[t]&&(r=e[t].norm);let n=m+3*t;s[n+0]=r.x,s[n+1]=r.y,s[n+2]=r.z}}if(c!==p.colorCode){null!==c&&h.addGroup(u,d,o.length-1);let e=p.material;null!==e?3===t?o.push(e):2===t&&(null!==e?r?o.push(e.userData.edgeMaterial.userData.conditionalEdgeMaterial):o.push(e.userData.edgeMaterial):o.push(null)):o.push(p.colorCode),c=p.colorCode,u=m/3,d=A.length}else d+=A.length;m+=3*A.length}d>0&&h.addGroup(u,1/0,o.length-1),h.setAttribute("position",new ee.TlE(a,3)),null!==s&&h.setAttribute("normal",new ee.TlE(s,3));let p=null;if(2===t?p=r?new dD(h,1===o.length?o[0]:o):new ee.ejS(h,1===o.length?o[0]:o):3===t&&(p=new ee.Kj0(h,1===o.length?o[0]:o)),r){p.isConditionalLine=!0;let t=new Float32Array(6*e.length),r=new Float32Array(6*e.length),n=new Float32Array(6*e.length);for(let a=0,s=e.length;a<s;a++){let s=e[a],o=s.vertices,l=s.controlPoints,h=l[0],c=l[1],u=o[0],d=o[1],m=6*a;t[m+0]=h.x,t[m+1]=h.y,t[m+2]=h.z,t[m+3]=h.x,t[m+4]=h.y,t[m+5]=h.z,r[m+0]=c.x,r[m+1]=c.y,r[m+2]=c.z,r[m+3]=c.x,r[m+4]=c.y,r[m+5]=c.z,n[m+0]=d.x-u.x,n[m+1]=d.y-u.y,n[m+2]=d.z-u.z,n[m+3]=d.x-u.x,n[m+4]=d.y-u.y,n[m+5]=d.z-u.z}h.setAttribute("control0",new ee.TlE(t,3,!1)),h.setAttribute("control1",new ee.TlE(r,3,!1)),h.setAttribute("direction",new ee.TlE(n,3,!1))}return p}class dH extends ee.aNw{constructor(e){super(e),this.materials=[],this.materialLibrary={},this.partsCache=new dQ(this),this.fileMap={},this.setMaterials([]),this.smoothNormals=!0,this.partsLibraryPath=""}setPartsLibraryPath(e){return this.partsLibraryPath=e,this}async preloadMaterials(e){let t=new ee.hH6(this.manager);t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials);let r=await t.loadAsync(e),n=/^0 !COLOUR/,a=r.split(/[\n\r]/g),s=[];for(let e=0,t=a.length;e<t;e++){let t=a[e];if(n.test(t)){let e=t.replace(n,""),r=this.parseColorMetaDirective(new dN(e));s.push(r)}}this.setMaterials(s)}load(e,t,r,n){let a=new ee.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,e=>{this.partsCache.parseModel(e,this.materialLibrary).then(e=>{this.applyMaterialsToMesh(e,"16",this.materialLibrary,!0),this.computeConstructionSteps(e),t(e)}).catch(n)},r,n)}parse(e,t){this.partsCache.parseModel(e,this.materialLibrary).then(e=>{this.computeConstructionSteps(e),t(e)})}setMaterials(e){this.materialLibrary={},this.materials=[];for(let t=0,r=e.length;t<r;t++)this.addMaterial(e[t]);return this.addMaterial(this.parseColorMetaDirective(new dN("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333"))),this.addMaterial(this.parseColorMetaDirective(new dN("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))),this}setFileMap(e){return this.fileMap=e,this}addMaterial(e){let t=this.materialLibrary;return t[e.userData.code]||(this.materials.push(e),t[e.userData.code]=e),this}getMaterial(e){if(e.startsWith("0x2")){let t=e.substring(3);return this.parseColorMetaDirective(new dN("Direct_Color_"+t+" CODE -1 VALUE #"+t+" EDGE #"+t))}return this.materialLibrary[e]||null}applyMaterialsToMesh(e,t,r,n=!1){let a=this,s="16"===t;function o(e,o){if(s&&!(o in r)&&!n)return o;let l=e.isLineSegments||e.isConditionalLine;(!l&&"16"===o||l&&"24"===o)&&(o=t);let h=null;if(o in r)h=r[o];else if(!n)return o;else if(null===(h=a.getMaterial(o)))throw Error(`LDrawLoader: Material properties for code ${o} not available.`);return e.isLineSegments&&(h=h.userData.edgeMaterial,e.isConditionalLine&&(h=h.userData.conditionalEdgeMaterial)),h}e.traverse(e=>{if(e.isMesh||e.isLineSegments){if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t].isMaterial||(e.material[t]=o(e,e.material[t]));else e.material.isMaterial||(e.material=o(e,e.material))}})}getMainMaterial(){return this.getMaterial("16")}getMainEdgeMaterial(){return this.getMaterial("24")}parseColorMetaDirective(e){let t=null,r=16711935,n=16711935,a=1,s=!1,o=0,l=0,h=null,c=e.getToken();if(!c)throw Error('LDrawLoader: Material name was expected after "!COLOUR tag'+e.getLineNumberString()+".");let u=null;for(;u=e.getToken();)switch(u.toUpperCase()){case"CODE":t=e.getToken();break;case"VALUE":if((r=e.getToken()).startsWith("0x"))r="#"+r.substring(2);else if(!r.startsWith("#"))throw Error("LDrawLoader: Invalid color while parsing material"+e.getLineNumberString()+".");break;case"EDGE":if((n=e.getToken()).startsWith("0x"))n="#"+n.substring(2);else if(!n.startsWith("#")){if(!(h=this.getMaterial(n)))throw Error("LDrawLoader: Invalid edge color while parsing material"+e.getLineNumberString()+".");h=h.userData.edgeMaterial}break;case"ALPHA":if(isNaN(a=parseInt(e.getToken())))throw Error("LDrawLoader: Invalid alpha value in material definition"+e.getLineNumberString()+".");(a=Math.max(0,Math.min(1,a/255)))<1&&(s=!0);break;case"LUMINANCE":if(isNaN(o=parseInt(e.getToken())))throw Error("LDrawLoader: Invalid luminance value in material definition"+dN.getLineNumberString()+".");o=Math.max(0,Math.min(1,o/255));break;case"CHROME":l=1;break;case"PEARLESCENT":l=2;break;case"RUBBER":l=3;break;case"MATTE_METALLIC":l=4;break;case"METAL":l=5;break;case"MATERIAL":e.setToEnd();break;default:throw Error('LDrawLoader: Unknown token "'+u+'" while parsing material'+e.getLineNumberString()+".")}let d=null;switch(l){case 0:d=new ee.Wid({color:r,roughness:.3,metalness:0});break;case 2:d=new ee.Wid({color:r,roughness:.3,metalness:.25});break;case 1:d=new ee.Wid({color:r,roughness:0,metalness:1});break;case 3:d=new ee.Wid({color:r,roughness:.9,metalness:0});break;case 4:d=new ee.Wid({color:r,roughness:.8,metalness:.4});break;case 5:d=new ee.Wid({color:r,roughness:.2,metalness:.85})}return d.transparent=s,d.premultipliedAlpha=!0,d.opacity=a,d.depthWrite=!s,d.polygonOffset=!0,d.polygonOffsetFactor=1,0!==o&&d.emissive.set(d.color).multiplyScalar(o),h||((h=new ee.nls({color:n,transparent:s,opacity:a,depthWrite:!s})).userData.code=t,h.name=c+" - Edge",h.userData.conditionalEdgeMaterial=new d_({fog:!0,transparent:s,depthWrite:!s,color:n,opacity:a})),d.userData.code=t,d.name=c,d.userData.edgeMaterial=h,this.addMaterial(d),d}computeConstructionSteps(e){let t=0;e.traverse(e=>{e.isGroup&&(e.userData.startingConstructionStep&&t++,e.userData.constructionStep=t)}),e.userData.numConstructionSteps=t+1}}class dz extends ee.aNw{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=this;function r(e,t,r,a,s,o,l,h){if(0==t||0==r){e.lineTo(h.x,h.y);return}a=a*Math.PI/180,t=Math.abs(t),r=Math.abs(r);let c=(l.x-h.x)/2,u=(l.y-h.y)/2,d=Math.cos(a)*c+Math.sin(a)*u,m=-Math.sin(a)*c+Math.cos(a)*u,p=t*t,A=r*r,f=d*d,g=m*m,v=f/p+g/A;if(v>1){let e=Math.sqrt(v);t*=e,r*=e,p=t*t,A=r*r}let y=p*g+A*f,x=Math.sqrt(Math.max(0,(p*A-y)/y));s===o&&(x=-x);let b=x*t*m/r,w=-x*r*d/t,C=Math.cos(a)*b-Math.sin(a)*w+(l.x+h.x)/2,E=Math.sin(a)*b+Math.cos(a)*w+(l.y+h.y)/2,I=n(1,0,(d-b)/t,(m-w)/r),M=n((d-b)/t,(m-w)/r,(-d-b)/t,(-m-w)/r)%(2*Math.PI);e.currentPath.absellipse(C,E,t,r,I,I+M,0===o,a)}function n(e,t,r,n){let a=Math.acos(Math.max(-1,Math.min(1,(e*r+t*n)/(Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n)))));return e*n-t*r<0&&(a=-a),a}function a(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){let t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)r=Object.assign(r,p["."+t[e]])}function n(n,a,s){void 0===s&&(s=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[a]=s(e.getAttribute(n))),r[n]&&(t[a]=s(r[n])),e.style&&""!==e.style[n]&&(t[a]=s(e.style[n]))}function a(e){return Math.max(0,Math.min(1,h(e)))}function s(e){return Math.max(0,h(e))}return e.hasAttribute("id")&&(r=Object.assign(r,p["#"+e.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",a),n("fill-rule","fillRule"),n("opacity","opacity",a),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",a),n("stroke-width","strokeWidth",s),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",s),n("visibility","visibility"),t}function s(e,t,r){let n;if("string"!=typeof e)throw TypeError("Invalid input: "+typeof e);let a={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},s=0,o=!0,l="",h="",c=[];function u(e,t,r){let n=SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function d(){""!==l&&(""===h?c.push(Number(l)):c.push(Number(l)*Math.pow(10,Number(h)))),l="",h=""}let m=e.length;for(let p=0;p<m;p++){if(n=e[p],Array.isArray(t)&&t.includes(c.length%r)&&a.FLAGS.test(n)){s=1,l=n,d();continue}if(0===s){if(a.WHITESPACE.test(n))continue;if(a.DIGIT.test(n)||a.SIGN.test(n)){s=1,l=n;continue}if(a.POINT.test(n)){s=2,l=n;continue}a.COMMA.test(n)&&(o&&u(n,p,c),o=!0)}if(1===s){if(a.DIGIT.test(n)){l+=n;continue}if(a.POINT.test(n)){l+=n,s=2;continue}if(a.EXP.test(n)){s=3;continue}a.SIGN.test(n)&&1===l.length&&a.SIGN.test(l[0])&&u(n,p,c)}if(2===s){if(a.DIGIT.test(n)){l+=n;continue}if(a.EXP.test(n)){s=3;continue}a.POINT.test(n)&&"."===l[l.length-1]&&u(n,p,c)}if(3===s){if(a.DIGIT.test(n)){h+=n;continue}if(a.SIGN.test(n)){if(""===h){h+=n;continue}1===h.length&&a.SIGN.test(h)&&u(n,p,c)}}a.WHITESPACE.test(n)?(d(),s=0,o=!1):a.COMMA.test(n)?(d(),s=0,o=!0):a.SIGN.test(n)?(d(),s=1,l=n):a.POINT.test(n)?(d(),s=2,l=n):u(n,p,c)}return d(),c}let o=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function h(e){let r,n="px";if("string"==typeof e||e instanceof String)for(let t=0,r=o.length;t<r;t++){let r=o[t];if(e.endsWith(r)){n=r,e=e.substring(0,e.length-r.length);break}}return"px"===n&&"px"!==t.defaultUnit?r=l.in[t.defaultUnit]/t.defaultDPI:(r=l[n][t.defaultUnit])<0&&(r=l[n].in*t.defaultDPI),r*parseFloat(e)}function c(e){let t=e.elements;return t[0]*t[4]-t[1]*t[3]<0}function u(e){let t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function d(e){let t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}let m=[],p={},A=[],f=new ee.Vkp,g=new ee.Vkp,v=new ee.Vkp,y=new ee.Vkp,x=new ee.FM8,b=new ee.Pa4,w=new ee.Vkp,C=new DOMParser().parseFromString(e,"image/svg+xml");return!function e(t,n){if(1!==t.nodeType)return;let o=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;let t=function(e){let t=new ee.Vkp;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){let r=h(e.getAttribute("x")),n=h(e.getAttribute("y"));t.translate(r,n)}if(e.hasAttribute("transform")){let r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){let n=r[e].trim();if(""===n)continue;let a=n.indexOf("("),o=n.length;if(a>0&&a<o){let e=n.slice(0,a),t=s(n.slice(a+1));switch(f.identity(),e){case"translate":if(t.length>=1){let e=t[0],r=0;t.length>=2&&(r=t[1]),f.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,n=0;e=t[0]*Math.PI/180,t.length>=3&&(r=t[1],n=t[2]),g.makeTranslation(-r,-n),v.makeRotation(e),y.multiplyMatrices(v,g),g.makeTranslation(r,n),f.multiplyMatrices(g,y)}break;case"scale":if(t.length>=1){let e=t[0],r=e;t.length>=2&&(r=t[1]),f.scale(e,r)}break;case"skewX":1===t.length&&f.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&f.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&f.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(f)}}return t}(e);return A.length>0&&t.premultiply(A[A.length-1]),w.copy(t),A.push(t),t}(t),l=!1,C=null;switch(t.nodeName){case"svg":case"g":n=a(t,n);break;case"style":(function(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){let r=e.sheet.cssRules[t];if(1!==r.type)continue;let n=r.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<n.length;e++){let t=Object.fromEntries(Object.entries(r.style).filter(([,e])=>""!==e));p[n[e]]=Object.assign(p[n[e]]||{},t)}}})(t);break;case"path":n=a(t,n),t.hasAttribute("d")&&(C=function(e){let t=new ee.T_1,n=new ee.FM8,a=new ee.FM8,o=new ee.FM8,l=!0,h=!1,c=e.getAttribute("d");if(""===c||"none"===c)return null;let u=c.match(/[a-df-z][^a-df-z]*/gi);for(let e=0,c=u.length;e<c;e++){var d,m,p,A,f,g,v,y;let c;let x=u[e],b=x.charAt(0),w=x.slice(1).trim();switch(!0===l&&(h=!0,l=!1),b){case"M":c=s(w);for(let e=0,r=c.length;e<r;e+=2)n.x=c[e+0],n.y=c[e+1],a.x=n.x,a.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&o.copy(n);break;case"H":c=s(w);for(let e=0,r=c.length;e<r;e++)n.x=c[e],a.x=n.x,a.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===h&&o.copy(n);break;case"V":c=s(w);for(let e=0,r=c.length;e<r;e++)n.y=c[e],a.x=n.x,a.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===h&&o.copy(n);break;case"L":c=s(w);for(let e=0,r=c.length;e<r;e+=2)n.x=c[e+0],n.y=c[e+1],a.x=n.x,a.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===h&&o.copy(n);break;case"C":c=s(w);for(let e=0,r=c.length;e<r;e+=6)t.bezierCurveTo(c[e+0],c[e+1],c[e+2],c[e+3],c[e+4],c[e+5]),a.x=c[e+2],a.y=c[e+3],n.x=c[e+4],n.y=c[e+5],0===e&&!0===h&&o.copy(n);break;case"S":c=s(w);for(let e=0,r=c.length;e<r;e+=4)t.bezierCurveTo((d=n.x)-(a.x-d),(m=n.y)-(a.y-m),c[e+0],c[e+1],c[e+2],c[e+3]),a.x=c[e+0],a.y=c[e+1],n.x=c[e+2],n.y=c[e+3],0===e&&!0===h&&o.copy(n);break;case"Q":c=s(w);for(let e=0,r=c.length;e<r;e+=4)t.quadraticCurveTo(c[e+0],c[e+1],c[e+2],c[e+3]),a.x=c[e+0],a.y=c[e+1],n.x=c[e+2],n.y=c[e+3],0===e&&!0===h&&o.copy(n);break;case"T":c=s(w);for(let e=0,r=c.length;e<r;e+=2){let r=(p=n.x)-(a.x-p),s=(A=n.y)-(a.y-A);t.quadraticCurveTo(r,s,c[e+0],c[e+1]),a.x=r,a.y=s,n.x=c[e+0],n.y=c[e+1],0===e&&!0===h&&o.copy(n)}break;case"A":c=s(w,[3,4],7);for(let e=0,s=c.length;e<s;e+=7){if(c[e+5]==n.x&&c[e+6]==n.y)continue;let s=n.clone();n.x=c[e+5],n.y=c[e+6],a.x=n.x,a.y=n.y,r(t,c[e],c[e+1],c[e+2],c[e+3],c[e+4],s,n),0===e&&!0===h&&o.copy(n)}break;case"m":c=s(w);for(let e=0,r=c.length;e<r;e+=2)n.x+=c[e+0],n.y+=c[e+1],a.x=n.x,a.y=n.y,0===e?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===e&&o.copy(n);break;case"h":c=s(w);for(let e=0,r=c.length;e<r;e++)n.x+=c[e],a.x=n.x,a.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===h&&o.copy(n);break;case"v":c=s(w);for(let e=0,r=c.length;e<r;e++)n.y+=c[e],a.x=n.x,a.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===h&&o.copy(n);break;case"l":c=s(w);for(let e=0,r=c.length;e<r;e+=2)n.x+=c[e+0],n.y+=c[e+1],a.x=n.x,a.y=n.y,t.lineTo(n.x,n.y),0===e&&!0===h&&o.copy(n);break;case"c":c=s(w);for(let e=0,r=c.length;e<r;e+=6)t.bezierCurveTo(n.x+c[e+0],n.y+c[e+1],n.x+c[e+2],n.y+c[e+3],n.x+c[e+4],n.y+c[e+5]),a.x=n.x+c[e+2],a.y=n.y+c[e+3],n.x+=c[e+4],n.y+=c[e+5],0===e&&!0===h&&o.copy(n);break;case"s":c=s(w);for(let e=0,r=c.length;e<r;e+=4)t.bezierCurveTo((f=n.x)-(a.x-f),(g=n.y)-(a.y-g),n.x+c[e+0],n.y+c[e+1],n.x+c[e+2],n.y+c[e+3]),a.x=n.x+c[e+0],a.y=n.y+c[e+1],n.x+=c[e+2],n.y+=c[e+3],0===e&&!0===h&&o.copy(n);break;case"q":c=s(w);for(let e=0,r=c.length;e<r;e+=4)t.quadraticCurveTo(n.x+c[e+0],n.y+c[e+1],n.x+c[e+2],n.y+c[e+3]),a.x=n.x+c[e+0],a.y=n.y+c[e+1],n.x+=c[e+2],n.y+=c[e+3],0===e&&!0===h&&o.copy(n);break;case"t":c=s(w);for(let e=0,r=c.length;e<r;e+=2){let r=(v=n.x)-(a.x-v),s=(y=n.y)-(a.y-y);t.quadraticCurveTo(r,s,n.x+c[e+0],n.y+c[e+1]),a.x=r,a.y=s,n.x=n.x+c[e+0],n.y=n.y+c[e+1],0===e&&!0===h&&o.copy(n)}break;case"a":c=s(w,[3,4],7);for(let e=0,s=c.length;e<s;e+=7){if(0==c[e+5]&&0==c[e+6])continue;let s=n.clone();n.x+=c[e+5],n.y+=c[e+6],a.x=n.x,a.y=n.y,r(t,c[e],c[e+1],c[e+2],c[e+3],c[e+4],s,n),0===e&&!0===h&&o.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(o),t.currentPath.currentPoint.copy(n),l=!0);break;default:console.warn(x)}h=!1}return t}(t));break;case"rect":n=a(t,n),C=function(e){let t=h(e.getAttribute("x")||0),r=h(e.getAttribute("y")||0),n=h(e.getAttribute("rx")||e.getAttribute("ry")||0),a=h(e.getAttribute("ry")||e.getAttribute("rx")||0),s=h(e.getAttribute("width")),o=h(e.getAttribute("height")),l=new ee.T_1;return l.moveTo(t+n,r),l.lineTo(t+s-n,r),(0!==n||0!==a)&&l.bezierCurveTo(t+s-.448084975506*n,r,t+s,r+.448084975506*a,t+s,r+a),l.lineTo(t+s,r+o-a),(0!==n||0!==a)&&l.bezierCurveTo(t+s,r+o-.448084975506*a,t+s-.448084975506*n,r+o,t+s-n,r+o),l.lineTo(t+n,r+o),(0!==n||0!==a)&&l.bezierCurveTo(t+.448084975506*n,r+o,t,r+o-.448084975506*a,t,r+o-a),l.lineTo(t,r+a),(0!==n||0!==a)&&l.bezierCurveTo(t,r+.448084975506*a,t+.448084975506*n,r,t+n,r),l}(t);break;case"polygon":n=a(t,n),C=function(e){let t=new ee.T_1,r=0;return e.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,n,a){let s=h(n),o=h(a);0===r?t.moveTo(s,o):t.lineTo(s,o),r++}),t.currentPath.autoClose=!0,t}(t);break;case"polyline":n=a(t,n),C=function(e){let t=new ee.T_1,r=0;return e.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,n,a){let s=h(n),o=h(a);0===r?t.moveTo(s,o):t.lineTo(s,o),r++}),t.currentPath.autoClose=!1,t}(t);break;case"circle":n=a(t,n),C=function(e){let t=h(e.getAttribute("cx")||0),r=h(e.getAttribute("cy")||0),n=h(e.getAttribute("r")||0),a=new ee.y$t;a.absarc(t,r,n,0,2*Math.PI);let s=new ee.T_1;return s.subPaths.push(a),s}(t);break;case"ellipse":n=a(t,n),C=function(e){let t=h(e.getAttribute("cx")||0),r=h(e.getAttribute("cy")||0),n=h(e.getAttribute("rx")||0),a=h(e.getAttribute("ry")||0),s=new ee.y$t;s.absellipse(t,r,n,a,0,2*Math.PI);let o=new ee.T_1;return o.subPaths.push(s),o}(t);break;case"line":n=a(t,n),C=function(e){let t=h(e.getAttribute("x1")||0),r=h(e.getAttribute("y1")||0),n=h(e.getAttribute("x2")||0),a=h(e.getAttribute("y2")||0),s=new ee.T_1;return s.moveTo(t,r),s.lineTo(n,a),s.currentPath.autoClose=!1,s}(t);break;case"defs":l=!0;break;case"use":n=a(t,n);let E=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),I=t.viewportElement.getElementById(E);I?e(I,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+E)}C&&(void 0!==n.fill&&"none"!==n.fill&&C.color.setStyle(n.fill,"srgb"),function(e,t){function r(e){b.set(e.x,e.y,1).applyMatrix3(t),e.set(b.x,b.y)}let n=e.subPaths;for(let e=0,a=n.length;e<a;e++){let a=n[e].curves;for(let e=0;e<a.length;e++){let n=a[e];n.isLineCurve?(r(n.v1),r(n.v2)):n.isCubicBezierCurve?(r(n.v0),r(n.v1),r(n.v2),r(n.v3)):n.isQuadraticBezierCurve?(r(n.v0),r(n.v1),r(n.v2)):n.isEllipseCurve&&(x.set(n.aX,n.aY),r(x),n.aX=x.x,n.aY=x.y,function(e){let t=e.elements,r=t[0]*t[3]+t[1]*t[4];return 0!==r&&Math.abs(r/(u(e)*d(e)))>Number.EPSILON}(t)?function(e){let r=e.xRadius,n=e.yRadius,a=Math.cos(e.aRotation),s=Math.sin(e.aRotation),o=new ee.Pa4(r*a,r*s,0),l=new ee.Pa4(-n*s,n*a,0),h=o.applyMatrix3(t),u=l.applyMatrix3(t),d=f.set(h.x,u.x,0,h.y,u.y,0,0,0,1),m=g.copy(d).invert(),p=v.copy(m).transpose().multiply(m).elements,A=function(e,t,r){let n,a,s,o,l;let h=e+r,c=e-r,u=Math.sqrt(c*c+4*t*t);return h>0?a=e*(l=1/(n=.5*(h+u)))*r-t*l*t:h<0?a=.5*(h-u):(n=.5*u,a=-.5*u),Math.abs(s=c>0?c+u:c-u)>2*Math.abs(t)?(o=1/Math.sqrt(1+(l=-2*t/s)*l),s=l*o):0===Math.abs(t)?(s=1,o=0):(s=1/Math.sqrt(1+(l=-.5*s/t)*l),o=l*s),c>0&&(l=s,s=-o,o=l),{rt1:n,rt2:a,cs:s,sn:o}}(p[0],p[1],p[4]),y=Math.sqrt(A.rt1),x=Math.sqrt(A.rt2);if(e.xRadius=1/y,e.yRadius=1/x,e.aRotation=Math.atan2(A.sn,A.cs),!((e.aEndAngle-e.aStartAngle)%(2*Math.PI)<Number.EPSILON)){let r=g.set(y,0,0,0,x,0,0,0,1),n=v.set(A.cs,A.sn,0,-A.sn,A.cs,0,0,0,1),a=r.multiply(n).multiply(d),s=e=>{let{x:t,y:r}=new ee.Pa4(Math.cos(e),Math.sin(e),0).applyMatrix3(a);return Math.atan2(r,t)};e.aStartAngle=s(e.aStartAngle),e.aEndAngle=s(e.aEndAngle),c(t)&&(e.aClockwise=!e.aClockwise)}}(n):function(e){let r=u(t),n=d(t);e.xRadius*=r,e.yRadius*=n;let a=r>Number.EPSILON?Math.atan2(t.elements[1],t.elements[0]):Math.atan2(-t.elements[3],t.elements[4]);e.aRotation+=a,c(t)&&(e.aStartAngle*=-1,e.aEndAngle*=-1,e.aClockwise=!e.aClockwise)}(n))}}}(C,w),m.push(C),C.userData={node:t,style:n});let M=t.childNodes;for(let t=0;t<M.length;t++){let r=M[t];l&&"style"!==r.nodeName&&"defs"!==r.nodeName||e(r,n)}o&&(A.pop(),A.length>0?w.copy(A[A.length-1]):w.identity())}(C.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:m,xml:C.documentElement}}static createShapes(e){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:t.ORIGIN,t:0};function n(e,n,a){let s;let o=a.x-n.x,l=a.y-n.y,h=e.x-n.x,c=e.y-n.y,u=o*c-h*l;if(e.x===n.x&&e.y===n.y){r.loc=t.ORIGIN,r.t=0;return}if(e.x===a.x&&e.y===a.y){r.loc=t.DESTINATION,r.t=1;return}if(u<-Number.EPSILON){r.loc=t.LEFT;return}if(u>Number.EPSILON){r.loc=t.RIGHT;return}if(o*h<0||l*c<0){r.loc=t.BEHIND;return}if(Math.sqrt(o*o+l*l)<Math.sqrt(h*h+c*c)){r.loc=t.BEYOND;return}s=0!==o?h/o:c/l,r.loc=t.BETWEEN,r.t=s}let a=999999999,s=-999999999,o=e.subPaths.map(e=>{let t=e.getPoints(),r=-999999999,n=999999999,o=-999999999,l=999999999;for(let e=0;e<t.length;e++){let a=t[e];a.y>r&&(r=a.y),a.y<n&&(n=a.y),a.x>o&&(o=a.x),a.x<l&&(l=a.x)}return s<=o&&(s=o+1),a>=l&&(a=l-1),{curves:e.curves,points:t,isCW:ee.iDF.isClockWise(t),identifier:-1,boundingBox:new ee.TUj(new ee.FM8(l,n),new ee.FM8(o,r))}});o=o.filter(e=>e.points.length>1);for(let e=0;e<o.length;e++)o[e].identifier=e;let l=o.map(l=>(function(e,a,s,o,l){(null==l||""===l)&&(l="nonzero");let h=new ee.FM8;e.boundingBox.getCenter(h);let c=function(e,a,s){let o=new ee.FM8;a.getCenter(o);let l=[];return s.forEach(a=>{a.boundingBox.containsPoint(o)&&(function(e,a){let s=[],o=[];for(let l=1;l<e.length;l++){let h=e[l-1],c=e[l];for(let e=1;e<a.length;e++){let l=function(e,a,s,o){let l=e.x,h=a.x,c=s.x,u=o.x,d=e.y,m=a.y,p=s.y,A=o.y,f=(u-c)*(d-p)-(A-p)*(l-c),g=(A-p)*(h-l)-(u-c)*(m-d),v=f/g,y=((h-l)*(d-p)-(m-d)*(l-c))/g;if(0===g&&0!==f||v<=0||v>=1||y<0||y>1)return null;if(0===f&&0===g){for(let c=0;c<2;c++){if(n(0===c?s:o,e,a),r.loc==t.ORIGIN){let e=0===c?s:o;return{x:e.x,y:e.y,t:r.t}}if(r.loc==t.BETWEEN)return{x:+(l+r.t*(h-l)).toPrecision(10),y:+(d+r.t*(m-d)).toPrecision(10),t:r.t}}return null}for(let l=0;l<2;l++)if(n(0===l?s:o,e,a),r.loc==t.ORIGIN){let e=0===l?s:o;return{x:e.x,y:e.y,t:r.t}}return{x:+(l+v*(h-l)).toPrecision(10),y:+(d+v*(m-d)).toPrecision(10),t:v}}(h,c,a[e-1],a[e]);null!==l&&void 0===s.find(e=>e.t<=l.t+Number.EPSILON&&e.t>=l.t-Number.EPSILON)&&(s.push(l),o.push(new ee.FM8(l.x,l.y)))}}return o})(e,a.points).forEach(e=>{l.push({identifier:a.identifier,isCW:a.isCW,point:e})})}),l.sort((e,t)=>e.point.x-t.point.x),l}([new ee.FM8(s,h.y),new ee.FM8(o,h.y)],e.boundingBox,a);c.sort((e,t)=>e.point.x-t.point.x);let u=[],d=[];c.forEach(t=>{t.identifier===e.identifier?u.push(t):d.push(t)});let m=u[0].point.x,p=[],A=0;for(;A<d.length&&d[A].point.x<m;)p.length>0&&p[p.length-1]===d[A].identifier?p.pop():p.push(d[A].identifier),A++;if(p.push(e.identifier),"evenodd"===l){let t=p.length%2==0,r=p[p.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===l){let t=!0,r=null,n=null;for(let e=0;e<p.length;e++){let s=p[e];t?(n=a[s].isCW,t=!1,r=s):n!==a[s].isCW&&(n=a[s].isCW,t=!0)}return{identifier:e.identifier,isHole:t,for:r}}console.warn('fill-rule: "'+l+'" is currently not implemented.')})(l,o,a,s,e.userData?e.userData.style.fillRule:void 0)),h=[];return o.forEach(e=>{if(!l[e.identifier].isHole){let t=new ee.bnF;t.curves=e.curves,l.filter(t=>t.isHole&&t.for===e.identifier).forEach(e=>{let r=o[e.identifier],n=new ee.y$t;n.curves=r.curves,t.holes.push(n)}),h.push(t)}}),h}static getStrokeStyle(e,t,r,n,a){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:a=void 0!==a?a:4}}static pointsToStroke(e,t,r,n){let a=[],s=[],o=[];if(0===dz.pointsToStrokeWithBuffers(e,t,r,n,a,s,o))return null;let l=new ee.u9r;return l.setAttribute("position",new ee.a$l(a,3)),l.setAttribute("normal",new ee.a$l(s,3)),l.setAttribute("uv",new ee.a$l(o,2)),l}static pointsToStrokeWithBuffers(e,t,r,n,a,s,o,l){let h,c,u,d,m;let p=new ee.FM8,A=new ee.FM8,f=new ee.FM8,g=new ee.FM8,v=new ee.FM8,y=new ee.FM8,x=new ee.FM8,b=new ee.FM8,w=new ee.FM8,C=new ee.FM8,E=new ee.FM8,I=new ee.FM8,M=new ee.FM8,B=new ee.FM8,S=new ee.FM8,T=new ee.FM8,F=new ee.FM8;r=void 0!==r?r:12,n=void 0!==n?n:.001,l=void 0!==l?l:0;let P=(e=function(e){let t=!1;for(let r=1,a=e.length-1;r<a;r++)if(e[r].distanceTo(e[r+1])<n){t=!0;break}if(!t)return e;let r=[];r.push(e[0]);for(let t=1,a=e.length-1;t<a;t++)e[t].distanceTo(e[t+1])>=n&&r.push(e[t]);return r.push(e[e.length-1]),r}(e)).length;if(P<2)return 0;let _=e[0].equals(e[P-1]),D=e[0],R=t.strokeWidth/2,L=1/(P-1),N=0,k,U=!1,Q=0,O=3*l,G=2*l;H(e[0],e[1],p).multiplyScalar(R),b.copy(e[0]).sub(p),w.copy(e[0]).add(p),C.copy(b),E.copy(w);for(let r=1;r<P;r++){if(h=e[r],c=r===P-1?_?e[1]:void 0:e[r+1],H(D,h,p),f.copy(p).multiplyScalar(R),I.copy(h).sub(f),M.copy(h).add(f),k=N+L,u=!1,void 0!==c){H(h,c,A),f.copy(A).multiplyScalar(R),B.copy(h).sub(f),S.copy(h).add(f),d=!0,f.subVectors(c,D),0>p.dot(f)&&(d=!1),1===r&&(U=d),f.subVectors(c,h),f.normalize();let e=Math.abs(p.dot(f));if(e>Number.EPSILON){let r=R/e;f.multiplyScalar(-r),g.subVectors(h,D),v.copy(g).setLength(r).add(f),T.copy(v).negate();let n=v.length(),a=g.length();g.divideScalar(a),y.subVectors(c,h);let s=y.length();switch(y.divideScalar(s),g.dot(T)<a&&y.dot(T)<s&&(u=!0),F.copy(v).add(h),T.add(h),m=!1,u?d?(S.copy(T),M.copy(T)):(B.copy(T),I.copy(T)):j(),t.strokeLineJoin){case"bevel":W(d,u,k);break;case"round":X(d,u),d?V(h,I,B,k,0):V(h,S,M,k,1);break;default:let o=R*t.strokeMiterLimit/n;o<1?"miter-clip"!==t.strokeLineJoin?W(d,u,k):(X(d,u),d?(y.subVectors(F,I).multiplyScalar(o).add(I),x.subVectors(F,B).multiplyScalar(o).add(B),z(I,k,0),z(y,k,0),z(h,k,.5),z(h,k,.5),z(y,k,0),z(x,k,0),z(h,k,.5),z(x,k,0),z(B,k,0)):(y.subVectors(F,M).multiplyScalar(o).add(M),x.subVectors(F,S).multiplyScalar(o).add(S),z(M,k,1),z(y,k,1),z(h,k,.5),z(h,k,.5),z(y,k,1),z(x,k,1),z(h,k,.5),z(x,k,1),z(S,k,1))):(u?(d?(z(w,N,1),z(b,N,0),z(F,k,0),z(w,N,1),z(F,k,0),z(T,k,1)):(z(w,N,1),z(b,N,0),z(F,k,1),z(b,N,0),z(T,k,0),z(F,k,1)),d?B.copy(F):S.copy(F)):d?(z(I,k,0),z(F,k,0),z(h,k,.5),z(h,k,.5),z(F,k,0),z(B,k,0)):(z(M,k,1),z(F,k,1),z(h,k,.5),z(h,k,.5),z(F,k,1),z(S,k,1)),m=!0)}}else j()}else j();_||r!==P-1||Y(e[0],C,E,d,!0,N),N=k,D=h,b.copy(B),w.copy(S)}if(_){if(u&&a){let e=F,t=T;U!==d&&(e=T,t=F),d?(m||U)&&(t.toArray(a,0),t.toArray(a,9),m&&e.toArray(a,3)):(m||!U)&&(t.toArray(a,3),t.toArray(a,9),m&&e.toArray(a,0))}}else Y(h,I,M,d,!1,k);return Q;function H(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function z(e,t,r){a&&(a[O]=e.x,a[O+1]=e.y,a[O+2]=0,s&&(s[O]=0,s[O+1]=0,s[O+2]=1),O+=3,o&&(o[G]=t,o[G+1]=r,G+=2)),Q+=3}function V(e,t,n,a,s){p.copy(t).sub(e).normalize(),A.copy(n).sub(e).normalize();let o=Math.PI,l=p.dot(A);1>Math.abs(l)&&(o=Math.abs(Math.acos(l))),o/=r,f.copy(t);for(let t=0,n=r-1;t<n;t++)g.copy(f).rotateAround(e,o),z(f,a,s),z(g,a,s),z(e,a,.5),f.copy(g);z(g,a,s),z(n,a,s),z(e,a,.5)}function j(){z(w,N,1),z(b,N,0),z(I,k,0),z(w,N,1),z(I,k,0),z(M,k,1)}function W(e,t,r){t?e?(z(w,N,1),z(b,N,0),z(I,k,0),z(w,N,1),z(I,k,0),z(T,k,1),z(I,r,0),z(B,r,0),z(T,r,.5)):(z(w,N,1),z(b,N,0),z(M,k,1),z(b,N,0),z(T,k,0),z(M,k,1),z(M,r,1),z(T,r,0),z(S,r,1)):(e?(z(I,r,0),z(B,r,0)):(z(M,r,1),z(S,r,0)),z(h,r,.5))}function X(e,t){t&&(e?(z(w,N,1),z(b,N,0),z(I,k,0),z(w,N,1),z(I,k,0),z(T,k,1),z(I,N,0),z(h,k,.5),z(T,k,1),z(h,k,.5),z(B,N,0),z(T,k,1)):(z(w,N,1),z(b,N,0),z(M,k,1),z(b,N,0),z(T,k,0),z(M,k,1),z(M,N,1),z(T,k,0),z(h,k,.5),z(h,k,.5),z(T,k,0),z(S,N,1)))}function Y(e,r,n,s,l,h){switch(t.strokeLineCap){case"round":l?V(e,n,r,h,.5):V(e,r,n,h,.5);break;case"square":if(l)p.subVectors(r,e),A.set(p.y,-p.x),f.addVectors(p,A).add(e),g.subVectors(A,p).add(e),s?(f.toArray(a,3),g.toArray(a,0),g.toArray(a,9)):(f.toArray(a,3),1===o[7]?g.toArray(a,9):f.toArray(a,9),g.toArray(a,0));else{p.subVectors(n,e),A.set(p.y,-p.x),f.addVectors(p,A).add(e),g.subVectors(A,p).add(e);let t=a.length;s?(f.toArray(a,t-3),g.toArray(a,t-6)):(g.toArray(a,t-6),f.toArray(a,t-3)),g.toArray(a,t-12)}}}}}let dV=new WeakMap;class dj extends ee.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){let a=new ee.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),this.url=e,a.load(e,r=>{if(dV.has(r))return dV.get(r).promise.then(t).catch(n);this.decodeObjects(r,e).then(t).catch(n)},r,n)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let r,n;let a=e.byteLength,s=this._getWorker(a).then(t=>(r=t,n=this.workerNextTaskID++,new Promise((t,a)=>{r._callbacks[n]={resolve:t,reject:a},r.postMessage({type:"decode",id:n,buffer:e},[e])}))).then(e=>this._createGeometry(e.data));return s.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),dV.set(e,{url:t,promise:s}),s}parse(e,t,r){this.decodeObjects(e,"").then(t).catch(r)}_compareMaterials(e){let t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(let e=0;e<this.materials.length;e++){let r=this.materials[e],n={};if(n.name=r.name,n.color={},n.color.r=r.color.r,n.color.g=r.color.g,n.color.b=r.color.b,n.type=r.type,JSON.stringify(t)===JSON.stringify(n))return r}return this.materials.push(e),e}_createMaterial(e){if(void 0===e)return new ee.Wid({color:new ee.Ilk(1,1,1),metalness:.8,name:"default",side:2});let t=e.diffuseColor,r=new ee.Ilk(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(r.r=1,r.g=1,r.b=1);let n=new ee.Wid({color:r,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),a=new ee.dpR;for(let t=0;t<e.textures.length;t++){let r=e.textures[t];if(null!==r.image){let e=a.load(r.image);switch(r.type){case"Diffuse":n.map=e;break;case"Bump":n.bumpMap=e;break;case"Transparency":n.alphaMap=e,n.transparent=!0;break;case"Emap":n.envMap=e}}}return n}_createGeometry(e){let t=new ee.Tme,r=[],n=[],a=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let s=e.objects,o=e.materials;for(let l=0;l<s.length;l++){let h=s[l],c=h.attributes;switch(h.objectType){case"InstanceDefinition":n.push(h);break;case"InstanceReference":a.push(h);break;default:let u;if(c.materialIndex>=0){let e=o[c.materialIndex],t=this._createMaterial(e);t=this._compareMaterials(t),u=this._createObject(h,t)}else{let e=this._createMaterial();u=this._createObject(h,e)}if(void 0===u)continue;let d=e.layers[c.layerIndex];u.visible=!d||e.layers[c.layerIndex].visible,c.isInstanceDefinitionObject?r.push(u):t.add(u)}}for(let e=0;e<n.length;e++){let o=n[e];s=[];for(let e=0;e<o.attributes.objectIds.length;e++){let t=o.attributes.objectIds[e];for(let e=0;e<r.length;e++)t===r[e].userData.attributes.id&&s.push(r[e])}for(let e=0;e<a.length;e++){let r=a[e];if(r.geometry.parentIdefId===o.attributes.id){let e=new ee.Tme,n=r.geometry.xform.array,a=new ee.yGw;a.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]),e.applyMatrix4(a);for(let t=0;t<s.length;t++)e.add(s[t].clone(!0));t.add(e)}}}return t.userData.materials=this.materials,t}_createObject(e,t){let r,n,a,s,o;let l=new ee.s4_,h=e.attributes;switch(e.objectType){case"Point":case"PointSet":(r=l.parse(e.geometry)).attributes.hasOwnProperty("color")?n=new ee.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(a=h.drawColor,s=new ee.Ilk(a.r/255,a.g/255,a.b/255),n=new ee.UY4({color:s,sizeAttenuation:!1,size:2})),n=this._compareMaterials(n);let c=new ee.woe(r,n);return c.userData.attributes=h,c.userData.objectType=e.objectType,h.name&&(c.name=h.name),c;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(null===e.geometry)return;(r=l.parse(e.geometry)).attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t));let u=new ee.Kj0(r,t);return u.castShadow=h.castsShadows,u.receiveShadow=h.receivesShadows,u.userData.attributes=h,u.userData.objectType=e.objectType,h.name&&(u.name=h.name),u;case"Curve":r=l.parse(e.geometry),a=h.drawColor,s=new ee.Ilk(a.r/255,a.g/255,a.b/255),n=new ee.nls({color:s}),n=this._compareMaterials(n);let d=new ee.x12(r,n);return d.userData.attributes=h,d.userData.objectType=e.objectType,h.name&&(d.name=h.name),d;case"TextDot":r=e.geometry;let m=document.createElement("canvas").getContext("2d"),p=`${r.fontHeight}px ${r.fontFace}`;m.font=p;let A=m.measureText(r.text).width+10,f=r.fontHeight+10,g=window.devicePixelRatio;m.canvas.width=A*g,m.canvas.height=f*g,m.canvas.style.width=A+"px",m.canvas.style.height=f+"px",m.setTransform(g,0,0,g,0,0),m.font=p,m.textBaseline="middle",m.textAlign="center",s=h.drawColor,m.fillStyle=`rgba(${s.r},${s.g},${s.b},${s.a})`,m.fillRect(0,0,A,f),m.fillStyle="white",m.fillText(r.text,A/2,f/2);let v=new ee.ROQ(m.canvas);v.minFilter=ee.wem,v.wrapS=ee.uWy,v.wrapT=ee.uWy,n=new ee.xeV({map:v,depthTest:!1});let y=new ee.jyi(n);return y.position.set(r.point[0],r.point[1],r.point[2]),y.scale.set(A/10,f/10,1),y.userData.attributes=h,y.userData.objectType=e.objectType,h.name&&(y.name=h.name),y;case"Light":if((r=e.geometry).isDirectionalLight)(o=new ee.Ox3).castShadow=h.castsShadows,o.position.set(r.location[0],r.location[1],r.location[2]),o.target.position.set(r.direction[0],r.direction[1],r.direction[2]),o.shadow.normalBias=.1;else if(r.isPointLight)(o=new ee.cek).castShadow=h.castsShadows,o.position.set(r.location[0],r.location[1],r.location[2]),o.shadow.normalBias=.1;else if(r.isRectangularLight){o=new ee.T_f;let e=Math.abs(r.width[2]),t=Math.abs(r.length[0]);o.position.set(r.location[0]-t/2,r.location[1],r.location[2]-e/2),o.height=t,o.width=e,o.lookAt(new ee.Pa4(r.direction[0],r.direction[1],r.direction[2]))}else if(r.isSpotLight)(o=new ee.PMe).castShadow=h.castsShadows,o.position.set(r.location[0],r.location[1],r.location[2]),o.target.position.set(r.direction[0],r.direction[1],r.direction[2]),o.angle=r.spotAngleRadians,o.shadow.normalBias=.1;else if(r.isLinearLight){console.warn("THREE.3DMLoader:  No conversion exists for linear lights.");return}return o&&(o.intensity=r.intensity,a=r.diffuse,s=new ee.Ilk(a.r/255,a.g/255,a.b/255),o.color=s,o.userData.attributes=h,o.userData.objectType=e.objectType),o}}_initLibrary(){if(!this.libraryPending){let e=new ee.hH6(this.manager);e.setPath(this.libraryPath);let t=new Promise((t,r)=>{e.load("rhino3dm.js",t,void 0,r)}),r=new ee.hH6(this.manager);r.setPath(this.libraryPath),r.setResponseType("arraybuffer");let n=new Promise((e,t)=>{r.load("rhino3dm.wasm",e,void 0,t)});this.libraryPending=Promise.all([t,n]).then(([e,t])=>{this.libraryConfig.wasmBinary=t;let r=dW.toString(),n=["/* rhino3dm.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",libraryConfig:this.libraryConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function dW(){let e,t;function r(e){let t={};for(let r in e){let n=e[r];"function"!=typeof n&&("object"==typeof n&&null!==n&&n.hasOwnProperty("constructor")?t[r]={name:n.constructor.name,value:n.value}:t[r]=n)}return t}onmessage=function(n){let a=n.data;switch(a.type){case"init":let s;let o=a.libraryConfig.wasmBinary;e=new Promise(function(e){rhino3dm(s={wasmBinary:o,onRuntimeInitialized:e})}).then(()=>{t=s});break;case"decode":let l=a.buffer;e.then(()=>{let e=function(e,n){let a=new Uint8Array(n),s=e.File3dm.fromByteArray(a),o=[],l=[],h=[],c=[],u=[],d=[],m=s.objects(),p=m.count;for(let e=0;e<p;e++){let n=m.get(e),a=function(e,n){let a,s,o,l,h;let c=e.geometry(),u=e.attributes(),d=c.objectType;switch(d){case t.ObjectType.Curve:let m=function e(r,n){let a=n,s=[],o=[];if(r instanceof t.LineCurve)return[r.pointAtStart,r.pointAtEnd];if(r instanceof t.PolylineCurve){a=r.pointCount;for(let e=0;e<a;e++)s.push(r.point(e));return s}if(r instanceof t.PolyCurve){let t=r.segmentCount;for(let n=0;n<t;n++){let t=r.segmentCurve(n),o=e(t,a);s=s.concat(o),t.delete()}return s}if(r instanceof t.ArcCurve&&(a=(a=Math.floor(r.angleDegrees/5))<2?2:a),r instanceof t.NurbsCurve&&1===r.degree){let e=r.tryGetPolyline();for(let t=0;t<e.count;t++)s.push(e.get(t));return e.delete(),s}let l=r.domain,h=a-1;for(let e=0;e<a;e++){let t=l[0]+e/h*(l[1]-l[0]);if(t===l[0]||t===l[1]){o.push(t);continue}let n=r.tangentAt(t),a=r.tangentAt(o.slice(-1)[0]),s=Math.sqrt((n[0]*n[0]+n[1]*n[1]+n[2]*n[2])*(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]));(0===s?Math.PI/2:Math.acos(Math.max(-1,Math.min(1,(n.x*a.x+n.y*a.y+n.z*a.z)/s))))<.1||o.push(t)}return o.map(e=>r.pointAt(e))}(c,100);s={},l={},(o={}).itemSize=3,o.type="Float32Array",o.array=[];for(let e=0;e<m.length;e++)o.array.push(m[e][0]),o.array.push(m[e][1]),o.array.push(m[e][2]);s.position=o,l.attributes=s,a={data:l};break;case t.ObjectType.Point:let p=c.location,A={};s={},l={},(o={}).itemSize=3,o.type="Float32Array",o.array=[p[0],p[1],p[2]];let f=u.drawColor(n);A.itemSize=3,A.type="Float32Array",A.array=[f.r/255,f.g/255,f.b/255],s.position=o,s.color=A,l.attributes=s,a={data:l};break;case t.ObjectType.PointSet:case t.ObjectType.Mesh:a=c.toThreejsJSON();break;case t.ObjectType.Brep:let g=c.faces();h=new t.Mesh;for(let e=0;e<g.count;e++){let r=g.get(e),n=r.getMesh(t.MeshType.Any);n&&(h.append(n),n.delete()),r.delete()}h.faces().count>0&&(h.compact(),a=h.toThreejsJSON(),g.delete()),h.delete();break;case t.ObjectType.Extrusion:(h=c.getMesh(t.MeshType.Any))&&(a=h.toThreejsJSON(),h.delete());break;case t.ObjectType.TextDot:case t.ObjectType.Light:a=r(c);break;case t.ObjectType.InstanceReference:(a=r(c)).xform=r(c.xform),a.xform.array=c.xform.toFloatArray(!0);break;case t.ObjectType.SubD:c.subdivide(3),(h=t.Mesh.createFromSubDControlNet(c))&&(a=h.toThreejsJSON(),h.delete());break;default:console.warn(`THREE.3DMLoader: TODO: Implement ${d.constructor.name}`)}if(a)return(s=r(u)).geometry=r(c),u.groupCount>0&&(s.groupIds=u.getGroupList()),u.userStringCount>0&&(s.userStrings=u.getUserStrings()),c.userStringCount>0&&(s.geometry.userStrings=c.getUserStrings()),s.drawColor=u.drawColor(n),{geometry:a,attributes:s,objectType:d=(d=d.constructor.name).substring(11,d.length)};console.warn(`THREE.3DMLoader: ${d.constructor.name} has no associated mesh geometry.`)}(n,s);n.delete(),a&&o.push(a)}for(let e=0;e<s.instanceDefinitions().count();e++){let t=s.instanceDefinitions().get(e),n=r(t);n.objectIds=t.getObjectIds(),o.push({geometry:null,attributes:n,objectType:"InstanceDefinition"})}let A=[e.TextureType.Diffuse,e.TextureType.Bump,e.TextureType.Transparency,e.TextureType.Opacity,e.TextureType.Emap],f=[e.TextureType.PBR_BaseColor,e.TextureType.PBR_Subsurface,e.TextureType.PBR_SubsurfaceScattering,e.TextureType.PBR_SubsurfaceScatteringRadius,e.TextureType.PBR_Metallic,e.TextureType.PBR_Specular,e.TextureType.PBR_SpecularTint,e.TextureType.PBR_Roughness,e.TextureType.PBR_Anisotropic,e.TextureType.PBR_Anisotropic_Rotation,e.TextureType.PBR_Sheen,e.TextureType.PBR_SheenTint,e.TextureType.PBR_Clearcoat,e.TextureType.PBR_ClearcoatBump,e.TextureType.PBR_ClearcoatRoughness,e.TextureType.PBR_OpacityIor,e.TextureType.PBR_OpacityRoughness,e.TextureType.PBR_Emission,e.TextureType.PBR_AmbientOcclusion,e.TextureType.PBR_Displacement];for(let e=0;e<s.materials().count();e++){let t=s.materials().get(e),n=t.physicallyBased(),a=r(t),o=[];for(let e=0;e<A.length;e++){let r=t.getTexture(A[e]);if(r){let t=A[e].constructor.name,n={type:t=t.substring(12,t.length)},a=s.getEmbeddedFileAsBase64(r.fileName);a?n.image="data:image/png;base64,"+a:(console.warn(`THREE.3DMLoader: Image for ${t} texture not embedded in file.`),n.image=null),o.push(n),r.delete()}}if(a.textures=o,n.supported){console.log("pbr true");for(let e=0;e<f.length;e++){let r=t.getTexture(A[e]);if(r){let t=s.getEmbeddedFileAsBase64(r.fileName),n=A[e].constructor.name,a={type:n=n.substring(12,n.length),image:"data:image/png;base64,"+t};o.push(a),r.delete()}}a=Object.assign(r(t.physicallyBased()),a)}l.push(a),t.delete(),n.delete()}for(let e=0;e<s.layers().count();e++){let t=s.layers().get(e),n=r(t);h.push(n),t.delete()}for(let e=0;e<s.views().count();e++){let t=s.views().get(e),n=r(t);c.push(n),t.delete()}for(let e=0;e<s.namedViews().count();e++){let t=s.namedViews().get(e),n=r(t);u.push(n),t.delete()}for(let e=0;e<s.groups().count();e++){let t=s.groups().get(e),n=r(t);d.push(n),t.delete()}let g=r(s.settings());return s.delete(),{objects:o,materials:l,layers:h,views:c,namedViews:u,groups:d,settings:g}}(t,l);self.postMessage({type:"decode",id:a.id,data:e})})}}}let dX=/^[og]\s*(.+)?/,dY=/^mtllib /,dK=/^usemtl /,dJ=/^usemap /,dq=new ee.Pa4,dZ=new ee.Pa4,d$=new ee.Pa4,d0=new ee.Pa4,d1=new ee.Pa4;function d2(){let e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration){this.object.name=e,this.object.fromDeclaration=!1!==t;return}let r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){let r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);let n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){let t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){let t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){let e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){let r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseNormalIndex:function(e,t){let r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseUVIndex:function(e,t){let r=parseInt(e,10);return(r>=0?r-1:r+t/2)*2},addVertex:function(e,t,r){let n=this.vertices,a=this.object.geometry.vertices;a.push(n[e+0],n[e+1],n[e+2]),a.push(n[t+0],n[t+1],n[t+2]),a.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){let t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){let t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){let n=this.normals,a=this.object.geometry.normals;a.push(n[e+0],n[e+1],n[e+2]),a.push(n[t+0],n[t+1],n[t+2]),a.push(n[r+0],n[r+1],n[r+2])},addFaceNormal:function(e,t,r){let n=this.vertices,a=this.object.geometry.normals;dq.fromArray(n,e),dZ.fromArray(n,t),d$.fromArray(n,r),d1.subVectors(d$,dZ),d0.subVectors(dq,dZ),d1.cross(d0),d1.normalize(),a.push(d1.x,d1.y,d1.z),a.push(d1.x,d1.y,d1.z),a.push(d1.x,d1.y,d1.z)},addColor:function(e,t,r){let n=this.colors,a=this.object.geometry.colors;void 0!==n[e]&&a.push(n[e+0],n[e+1],n[e+2]),void 0!==n[t]&&a.push(n[t+0],n[t+1],n[t+2]),void 0!==n[r]&&a.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){let n=this.uvs,a=this.object.geometry.uvs;a.push(n[e+0],n[e+1]),a.push(n[t+0],n[t+1]),a.push(n[r+0],n[r+1])},addDefaultUV:function(){let e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){let t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,a,s,o,l,h){let c=this.vertices.length,u=this.parseVertexIndex(e,c),d=this.parseVertexIndex(t,c),m=this.parseVertexIndex(r,c);if(this.addVertex(u,d,m),this.addColor(u,d,m),void 0!==o&&""!==o){let e=this.normals.length;u=this.parseNormalIndex(o,e),d=this.parseNormalIndex(l,e),m=this.parseNormalIndex(h,e),this.addNormal(u,d,m)}else this.addFaceNormal(u,d,m);if(void 0!==n&&""!==n){let e=this.uvs.length;u=this.parseUVIndex(n,e),d=this.parseUVIndex(a,e),m=this.parseUVIndex(s,e),this.addUV(u,d,m),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";let t=this.vertices.length;for(let r=0,n=e.length;r<n;r++){let n=this.parseVertexIndex(e[r],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";let r=this.vertices.length,n=this.uvs.length;for(let t=0,n=e.length;t<n;t++)this.addVertexLine(this.parseVertexIndex(e[t],r));for(let e=0,r=t.length;e<r;e++)this.addUVLine(this.parseUVIndex(t[e],n))}};return e.startObject("",!1),e}class d3 extends ee.aNw{constructor(e){super(e),this.materials=null}load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}setMaterials(e){return this.materials=e,this}parse(e){let t=new d2;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));let r=e.split("\n"),n="",a="",s=[],o="function"==typeof"".trimLeft;for(let e=0,l=r.length;e<l;e++)if(n=r[e],0!==(n=o?n.trimLeft():n.trim()).length&&"#"!==(a=n.charAt(0))){if("v"===a){let e=n.split(/\s+/);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?t.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===a){let e=n.substr(1).trim().split(/\s+/),r=[];for(let t=0,n=e.length;t<n;t++){let n=e[t];if(n.length>0){let e=n.split("/");r.push(e)}}let a=r[0];for(let e=1,n=r.length-1;e<n;e++){let n=r[e],s=r[e+1];t.addFace(a[0],n[0],s[0],a[1],n[1],s[1],a[2],n[2],s[2])}}else if("l"===a){let e=n.substring(1).trim().split(" "),r=[],a=[];if(-1===n.indexOf("/"))r=e;else for(let t=0,n=e.length;t<n;t++){let n=e[t].split("/");""!==n[0]&&r.push(n[0]),""!==n[1]&&a.push(n[1])}t.addLineGeometry(r,a)}else if("p"===a){let e=n.substr(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(s=dX.exec(n))){let e=(" "+s[0].substr(1).trim()).substr(1);t.startObject(e)}else if(dK.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(dY.test(n))t.materialLibraries.push(n.substring(7).trim());else if(dJ.test(n))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===a){if((s=n.split(" ")).length>1){let e=s[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;let e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===n)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}}t.finalize();let l=new ee.ZAu;if(l.materialLibraries=[].concat(t.materialLibraries),!0==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let e=0,r=t.objects.length;e<r;e++){let r;let n=t.objects[e],a=n.geometry,s=n.materials,o="Line"===a.type,h="Points"===a.type,c=!1;if(0===a.vertices.length)continue;let u=new ee.u9r;u.setAttribute("position",new ee.a$l(a.vertices,3)),a.normals.length>0&&u.setAttribute("normal",new ee.a$l(a.normals,3)),a.colors.length>0&&(c=!0,u.setAttribute("color",new ee.a$l(a.colors,3))),!0===a.hasUVIndices&&u.setAttribute("uv",new ee.a$l(a.uvs,2));let d=[];for(let e=0,r=s.length;e<r;e++){let r=s[e],n=r.name+"_"+r.smooth+"_"+c,a=t.materials[n];if(null!==this.materials){if(a=this.materials.create(r.name),!o||!a||a instanceof ee.nls){if(h&&a&&!(a instanceof ee.UY4)){let e=new ee.UY4({size:10,sizeAttenuation:!1});ee.F5T.prototype.copy.call(e,a),e.color.copy(a.color),e.map=a.map,a=e}}else{let e=new ee.nls;ee.F5T.prototype.copy.call(e,a),e.color.copy(a.color),a=e}}void 0===a&&((a=o?new ee.nls:h?new ee.UY4({size:1,sizeAttenuation:!1}):new ee.xoR).name=r.name,a.flatShading=!r.smooth,a.vertexColors=c,t.materials[n]=a),d.push(a)}if(d.length>1){for(let e=0,t=s.length;e<t;e++){let t=s[e];u.addGroup(t.groupStart,t.groupCount,e)}r=o?new ee.ejS(u,d):h?new ee.woe(u,d):new ee.Kj0(u,d)}else r=o?new ee.ejS(u,d[0]):h?new ee.woe(u,d[0]):new ee.Kj0(u,d[0]);r.name=n.name,l.add(r)}else if(t.vertices.length>0){let e=new ee.UY4({size:1,sizeAttenuation:!1}),r=new ee.u9r;r.setAttribute("position",new ee.a$l(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(r.setAttribute("color",new ee.a$l(t.colors,3)),e.vertexColors=!0);let n=new ee.woe(r,e);l.add(n)}return l}}class d4 extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t,r;function n(e){let t={r:1,g:1,b:1,a:1};for(let r=0;r<e.childNodes.length;r++){let n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}let a=function(e){let t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){let r=null,n=null;console.log("THREE.AMFLoader: Loading Zip");try{r=ri(new Uint8Array(e))}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(n in r)if(".amf"===n.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+n),t=new DataView(r[n].buffer)}let r=(0,cE.r)(t),n=new DOMParser().parseFromString(r,"application/xml");return"amf"!==n.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):n}(e),s="",o="",l=function(e){let t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());let n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(a),h={},c={},u=a.documentElement.childNodes;for(t=0;t<u.length;t++){let e=u[t];if("metadata"===e.nodeName)void 0!==e.attributes.type&&("name"===e.attributes.type.value?s=e.textContent:"author"===e.attributes.type.value&&(o=e.textContent));else if("material"===e.nodeName){let t=function(e){let t="AMF Material",r=e.attributes.id.textContent,a={r:1,g:1,b:1,a:1},s=null;for(let r=0;r<e.childNodes.length;r++){let s=e.childNodes[r];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(a=n(s))}return s=new ee.xoR({flatShading:!0,color:new ee.Ilk(a.r,a.g,a.b),name:t}),1!==a.a&&(s.transparent=!0,s.opacity=a.a),{id:r,material:s}}(e);h[t.id]=t.material}else if("object"===e.nodeName){let t=function(e){let t=e.attributes.id.textContent,r={name:"amfobject",meshes:[]},a=null,s=e.firstElementChild;for(;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(r.name=s.textContent);else if("color"===s.nodeName)a=n(s);else if("mesh"===s.nodeName){let e=s.firstElementChild,t={vertices:[],normals:[],volumes:[],color:a};for(;e;){if("vertices"===e.nodeName){let r=function(e){let t=[],r=[],n=e.firstElementChild;for(;n;){if("vertex"===n.nodeName){let e=n.firstElementChild;for(;e;){if("coordinates"===e.nodeName){let r=e.getElementsByTagName("x")[0].textContent,n=e.getElementsByTagName("y")[0].textContent,a=e.getElementsByTagName("z")[0].textContent;t.push(r,n,a)}else if("normal"===e.nodeName){let t=e.getElementsByTagName("nx")[0].textContent,n=e.getElementsByTagName("ny")[0].textContent,a=e.getElementsByTagName("nz")[0].textContent;r.push(t,n,a)}e=e.nextElementSibling}}n=n.nextElementSibling}return{vertices:t,normals:r}}(e);t.normals=t.normals.concat(r.normals),t.vertices=t.vertices.concat(r.vertices)}else"volume"===e.nodeName&&t.volumes.push(function(e){let t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){let e=r.getElementsByTagName("v1")[0].textContent,n=r.getElementsByTagName("v2")[0].textContent,a=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(e,n,a)}r=r.nextElementSibling}return t}(e));e=e.nextElementSibling}r.meshes.push(t)}s=s.nextElementSibling}return{id:t,obj:r}}(e);c[t.id]=t.obj}}let d=new ee.ZAu,m=new ee.xoR({color:11184895,flatShading:!0});for(let e in d.name=s,d.userData.author=o,d.userData.loader="AMF",c){let n=c[e],a=n.meshes,s=new ee.ZAu;for(t=0,s.name=n.name||"";t<a.length;t++){let e=m,n=a[t],o=new ee.a$l(n.vertices,3),c=null;if(n.normals.length&&(c=new ee.a$l(n.normals,3)),n.color){let t=n.color;(e=m.clone()).color=new ee.Ilk(t.r,t.g,t.b),1!==t.a&&(e.transparent=!0,e.opacity=t.a)}let u=n.volumes;for(r=0;r<u.length;r++){let t=u[r],n=new ee.u9r,a=e;n.setIndex(t.triangles),n.setAttribute("position",o.clone()),c&&n.setAttribute("normal",c.clone()),void 0!==h[t.materialId]&&(a=h[t.materialId]),n.scale(l,l,l),s.add(new ee.Kj0(n,a.clone()))}}d.add(s)}return d}}class d5 extends ee.aNw{constructor(e){super(e),this.loader=new ee.hH6(this.manager),this.parser=null,this.meshBuilder=new d6(this.manager),this.animationBuilder=new me}setAnimationPath(e){return this.animationPath=e,this}load(e,t,r,n){let a;let s=this.meshBuilder.setCrossOrigin(this.crossOrigin);a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ee.Zp0.extractUrlBase(e);let o=this._extractExtension(e).toLowerCase();if("pmd"!==o&&"pmx"!==o){n&&n(Error("THREE.MMDLoader: Unknown model file extension ."+o+"."));return}this["pmd"===o?"loadPMD":"loadPMX"](e,function(e){t(s.build(e,a,r,n))},r,n)}loadAnimation(e,t,r,n,a){let s=this.animationBuilder;this.loadVMD(e,function(e){r(t.isCamera?s.buildCameraAnimation(e):s.build(e,t))},n,a)}loadWithAnimation(e,t,r,n,a){let s=this;this.load(e,function(e){s.loadAnimation(t,e,function(t){r({mesh:e,animation:t})},n,a)},n,a)}loadPMD(e,t,r,n){let a=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,function(e){t(a.parsePmd(e,!0))},r,n)}loadPMX(e,t,r,n){let a=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,function(e){t(a.parsePmx(e,!0))},r,n)}loadVMD(e,t,r,n){let a=Array.isArray(e)?e:[e],s=[],o=a.length,l=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);for(let e=0,h=a.length;e<h;e++)this.loader.load(a[e],function(e){s.push(l.parseVmd(e,!0)),s.length===o&&t(l.mergeVmds(s))},r,n)}loadVPD(e,t,r,n,a){let s=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,function(e){r(s.parseVpd(e,!0))},n,a)}_extractExtension(e){let t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)}_getParser(){return null===this.parser&&(this.parser=new rg._),this.parser}}let d8=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];class d6{constructor(e){this.crossOrigin="anonymous",this.geometryBuilder=new d9,this.materialBuilder=new d7(e)}setCrossOrigin(e){return this.crossOrigin=e,this}build(e,t,r,n){let a=this.geometryBuilder.build(e),s=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(t).build(e,a,r,n),o=new ee.TUv(a,s),l=new ee.OdW(function(e){let t=e.geometry,r=[];if(t&&void 0!==t.bones){for(let e=0,n=t.bones.length;e<n;e++){let n=t.bones[e],a=new ee.N$j;r.push(a),a.name=n.name,a.position.fromArray(n.pos),a.quaternion.fromArray(n.rotq),void 0!==n.scl&&a.scale.fromArray(n.scl)}for(let n=0,a=t.bones.length;n<a;n++){let a=t.bones[n];-1!==a.parent&&null!==a.parent&&void 0!==r[a.parent]?r[a.parent].add(r[n]):e.add(r[n])}}return e.updateMatrixWorld(!0),r}(o));return o.bind(l),o}}class d9{build(e){let t=[],r=[],n=[],a=[],s=[],o=[],l=[],h=[],c=[],u=[],d=[],m=[],p=[],A=[],f=0,g={};for(let a=0;a<e.metadata.vertexCount;a++){let s=e.vertices[a];for(let e=0,r=s.position.length;e<r;e++)t.push(s.position[e]);for(let e=0,t=s.normal.length;e<t;e++)n.push(s.normal[e]);for(let e=0,t=s.uv.length;e<t;e++)r.push(s.uv[e]);for(let e=0;e<4;e++)l.push(s.skinIndices.length-1>=e?s.skinIndices[e]:0);for(let e=0;e<4;e++)h.push(s.skinWeights.length-1>=e?s.skinWeights[e]:0)}for(let t=0;t<e.metadata.faceCount;t++){let r=e.faces[t];for(let e=0,t=r.indices.length;e<t;e++)a.push(r.indices[e])}for(let t=0;t<e.metadata.materialCount;t++){let r=e.materials[t];s.push({offset:3*f,count:3*r.faceCount}),f+=r.faceCount}for(let t=0;t<e.metadata.rigidBodyCount;t++){let r=e.rigidBodies[t],n=g[r.boneIndex];n=void 0===n?r.type:Math.max(r.type,n),g[r.boneIndex]=n}for(let t=0;t<e.metadata.boneCount;t++){let r=e.bones[t],n={index:t,transformationClass:r.transformationClass,parent:r.parentIndex,name:r.name,pos:r.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==g[t]?g[t]:-1};-1!==n.parent&&(n.pos[0]-=e.bones[n.parent].position[0],n.pos[1]-=e.bones[n.parent].position[1],n.pos[2]-=e.bones[n.parent].position[2]),o.push(n)}if("pmd"===e.metadata.format)for(let t=0;t<e.metadata.ikCount;t++){let r=e.iks[t],n={target:r.target,effector:r.effector,iteration:r.iteration,maxAngle:4*r.maxAngle,links:[]};for(let t=0,a=r.links.length;t<a;t++){let a={};a.index=r.links[t].index,a.enabled=!0,e.bones[a.index].name.indexOf("ひざ")>=0&&(a.limitation=new ee.Pa4(1,0,0)),n.links.push(a)}d.push(n)}else for(let t=0;t<e.metadata.boneCount;t++){let r=e.bones[t].ik;if(void 0===r)continue;let n={target:t,effector:r.effector,iteration:r.iteration,maxAngle:r.maxAngle,links:[]};for(let e=0,t=r.links.length;e<t;e++){let t={};if(t.index=r.links[e].index,t.enabled=!0,1===r.links[e].angleLimitation){let n=r.links[e].lowerLimitationAngle,a=r.links[e].upperLimitationAngle,s=-a[0],o=-a[1];a[0]=-n[0],a[1]=-n[1],n[0]=s,n[1]=o,t.rotationMin=new ee.Pa4().fromArray(n),t.rotationMax=new ee.Pa4().fromArray(a)}n.links.push(t)}d.push(n),o[t].ik=n}if("pmx"===e.metadata.format){let t=function(e){e.param&&(m.push(e.param),o[e.param.index].grant=e.param),e.visited=!0;for(let r=0,n=e.children.length;r<n;r++){let n=e.children[r];n.visited||t(n)}},r={};for(let t=0;t<e.metadata.boneCount;t++){let n=e.bones[t],a=n.grant;if(void 0===a)continue;let s={index:t,parentIndex:a.parentIndex,ratio:a.ratio,isLocal:a.isLocal,affectRotation:a.affectRotation,affectPosition:a.affectPosition,transformationClass:n.transformationClass};r[t]={parent:null,children:[],param:s,visited:!1}}let n={parent:null,children:[],param:null,visited:!1};for(let e in r){let t=r[e],a=r[t.parentIndex]||n;t.parent=a,a.children.push(t)}t(n)}function v(t,r,n){for(let a=0;a<r.elementCount;a++){let s;let o=r.elements[a];s="pmd"===e.metadata.format?e.morphs[0].elements[o.index].index:o.index,t.array[3*s+0]+=o.position[0]*n,t.array[3*s+1]+=o.position[1]*n,t.array[3*s+2]+=o.position[2]*n}}for(let r=0;r<e.metadata.morphCount;r++){let n=e.morphs[r],a={name:n.name},s=new ee.a$l(3*e.metadata.vertexCount,3);s.name=n.name;for(let r=0;r<3*e.metadata.vertexCount;r++)s.array[r]=t[r];if("pmd"===e.metadata.format)0!==r&&v(s,n,1);else if(0===n.type)for(let t=0;t<n.elementCount;t++){let r=e.morphs[n.elements[t].index],a=n.elements[t].ratio;1===r.type&&v(s,r,a)}else 1===n.type?v(s,n,1):2===n.type||3===n.type||4===n.type||5===n.type||6===n.type||7===n.type||n.type;c.push(a),u.push(s)}for(let t=0;t<e.metadata.rigidBodyCount;t++){let r=e.rigidBodies[t],n={};for(let e in r)n[e]=r[e];if("pmx"===e.metadata.format&&-1!==n.boneIndex){let t=e.bones[n.boneIndex];n.position[0]-=t.position[0],n.position[1]-=t.position[1],n.position[2]-=t.position[2]}p.push(n)}for(let t=0;t<e.metadata.constraintCount;t++){let r=e.constraints[t],n={};for(let e in r)n[e]=r[e];let a=p[n.rigidBodyIndex1],s=p[n.rigidBodyIndex2];0!==a.type&&2===s.type&&-1!==a.boneIndex&&-1!==s.boneIndex&&e.bones[s.boneIndex].parentIndex===a.boneIndex&&(s.type=1),A.push(n)}let y=new ee.u9r;y.setAttribute("position",new ee.a$l(t,3)),y.setAttribute("normal",new ee.a$l(n,3)),y.setAttribute("uv",new ee.a$l(r,2)),y.setAttribute("skinIndex",new ee.qlB(l,4)),y.setAttribute("skinWeight",new ee.a$l(h,4)),y.setIndex(a);for(let e=0,t=s.length;e<t;e++)y.addGroup(s[e].offset,s[e].count,e);return y.bones=o,y.morphTargets=c,y.morphAttributes.position=u,y.morphTargetsRelative=!1,y.userData.MMD={bones:o,iks:d,grants:m,rigidBodies:p,constraints:A,format:e.metadata.format},y.computeBoundingSphere(),y}}class d7{constructor(e){this.manager=e,this.textureLoader=new ee.dpR(this.manager),this.tgaLoader=null,this.crossOrigin="anonymous",this.resourcePath=void 0}setCrossOrigin(e){return this.crossOrigin=e,this}setResourcePath(e){return this.resourcePath=e,this}build(e,t){let r=[],n={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(let a=0;a<e.metadata.materialCount;a++){let s=e.materials[a],o={userData:{}};if(void 0!==s.name&&(o.name=s.name),o.color=new ee.Ilk().fromArray(s.diffuse),o.opacity=s.diffuse[3],o.emissive=new ee.Ilk().fromArray(s.ambient),o.transparent=1!==o.opacity,o.skinning=t.bones.length>0,o.morphTargets=t.morphTargets.length>0,o.fog=!0,o.blending=ee.Xaj,o.blendSrc=ee.k74,o.blendDst=ee.LgZ,o.blendSrcAlpha=ee.k74,o.blendDstAlpha=ee.fSK,"pmx"===e.metadata.format&&(1&s.flag)==1?o.side=ee.ehD:o.side=1===o.opacity?ee.Wl3:ee.ehD,"pmd"===e.metadata.format){if(s.fileName){let e=s.fileName.split("*");if(o.map=this._loadTexture(e[0],n),e.length>1){let t=e[1].slice(-4).toLowerCase();o.envMap=this._loadTexture(e[1],n),o.combine=".sph"===t?ee.Ns1:ee.NDo}}let t=-1===s.toonIndex?"toon00.bmp":e.toonTextures[s.toonIndex].fileName;o.gradientMap=this._loadTexture(t,n,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(t)}),o.userData.outlineParameters={thickness:1===s.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===s.edgeFlag}}else{let t,r;-1!==s.textureIndex&&(o.map=this._loadTexture(e.textures[s.textureIndex],n)),-1!==s.envTextureIndex&&(1===s.envFlag||2==s.envFlag)&&(o.envMap=this._loadTexture(e.textures[s.envTextureIndex],n),o.combine=1===s.envFlag?ee.Ns1:ee.NDo),-1===s.toonIndex||0!==s.toonFlag?(t="toon"+("0"+(s.toonIndex+1)).slice(-2)+".bmp",r=!0):(t=e.textures[s.toonIndex],r=!1),o.gradientMap=this._loadTexture(t,n,{isToonTexture:!0,isDefaultToonTexture:r}),o.userData.outlineParameters={thickness:s.edgeSize/300,color:s.edgeColor.slice(0,3),alpha:s.edgeColor[3],visible:(16&s.flag)!=0&&s.edgeSize>0}}void 0!==o.map&&(o.transparent||this._checkImageTransparency(o.map,t,a),o.emissive.multiplyScalar(.2)),r.push(new ee.IKL(o))}if("pmx"===e.metadata.format){let t=function(e,t){for(let r=0,n=e.length;r<n;r++){let n=e[r];if(-1===n.index)continue;let a=t[n.index];a.opacity!==n.diffuse[3]&&(a.transparent=!0)}};for(let n=0,a=e.morphs.length;n<a;n++){let a=e.morphs[n],s=a.elements;if(0===a.type)for(let n=0,a=s.length;n<a;n++){let a=e.morphs[s[n].index];8===a.type&&t(a.elements,r)}else 8===a.type&&t(s,r)}}return r}_getTGALoader(){if(null===this.tgaLoader){if(void 0===cK)throw Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new cK(this.manager)}return this.tgaLoader}_isDefaultToonTexture(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)}_loadTexture(e,t,r,n,a){let s;let o=this;if(!0===(r=r||{}).isDefaultToonTexture){let t;try{t=parseInt(e.match(/toon([0-9]{2})\.bmp$/)[1])}catch(r){console.warn("THREE.MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),t=0}s=d8[t]}else s=this.resourcePath+e;if(void 0!==t[s])return t[s];let l=this.manager.getHandler(s);null===l&&(l=".tga"===e.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);let h=l.load(s,function(e){!0===r.isToonTexture&&(e.image=o._getRotatedImage(e.image),e.magFilter=ee.TyD,e.minFilter=ee.TyD),e.flipY=!1,e.wrapS=ee.rpg,e.wrapT=ee.rpg;for(let e=0;e<h.readyCallbacks.length;e++)h.readyCallbacks[e](h);delete h.readyCallbacks},n,a);return h.readyCallbacks=[],t[s]=h,h}_getRotatedImage(e){let t=document.createElement("canvas"),r=t.getContext("2d"),n=e.width,a=e.height;return t.width=n,t.height=a,r.clearRect(0,0,n,a),r.translate(n/2,a/2),r.rotate(.5*Math.PI),r.translate(-n/2,-a/2),r.drawImage(e,0,0),r.getImageData(0,0,n,a)}_checkImageTransparency(e,t,r){e.readyCallbacks.push(function(n){function a(e,t){let r=e.width,n=e.height,a=Math.round(t.x*r)%r,s=Math.round(t.y*n)%n;a<0&&(a+=r),s<0&&(s+=n);let o=s*r+a;return e.data[4*o+3]}let s=void 0!==n.image.data?n.image:function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,t.width,t.height)}(n.image),o=t.groups[r];(function(e,t,r){let n=e.width,s=e.height;if(e.data.length/(n*s)!=4)return!1;for(let n=0;n<r.length;n+=3){let s={x:0,y:0};for(let o=0;o<3;o++){let l=r[3*n+o],h={x:t[2*l+0],y:t[2*l+1]};if(253>a(e,h))return!0;s.x+=h.x,s.y+=h.y}if(s.x/=3,s.y/=3,253>a(e,s))return!0}return!1})(s,t.attributes.uv.array,t.index.array.slice(o.start,o.start+o.count))&&(e.transparent=!0)})}}class me{build(e,t){let r=this.buildSkeletalAnimation(e,t).tracks,n=this.buildMorphAnimation(e,t).tracks;for(let e=0,t=n.length;e<t;e++)r.push(n[e]);return new ee.m7l("",-1,r)}buildSkeletalAnimation(e,t){function r(e,t,r){e.push(t[r+0]/127),e.push(t[r+8]/127),e.push(t[r+4]/127),e.push(t[r+12]/127)}let n=[],a={},s=t.skeleton.bones,o={};for(let e=0,t=s.length;e<t;e++)o[s[e].name]=!0;for(let t=0;t<e.metadata.motionCount;t++){let r=e.motions[t],n=r.boneName;void 0!==o[n]&&(a[n]=a[n]||[],a[n].push(r))}for(let e in a){let s=a[e];s.sort(function(e,t){return e.frameNum-t.frameNum});let o=[],l=[],h=[],c=[],u=[],d=t.skeleton.getBoneByName(e).position.toArray();for(let e=0,t=s.length;e<t;e++){let t=s[e].frameNum/30,n=s[e].position,a=s[e].rotation,m=s[e].interpolation;o.push(t);for(let e=0;e<3;e++)l.push(d[e]+n[e]);for(let e=0;e<4;e++)h.push(a[e]);for(let e=0;e<3;e++)r(c,m,e);r(u,m,3)}let m=".bones["+e+"]";n.push(this._createTrack(m+".position",ee.yC1,o,l,c)),n.push(this._createTrack(m+".quaternion",ee.iLg,o,h,u))}return new ee.m7l("",-1,n)}buildMorphAnimation(e,t){let r=[],n={},a=t.morphTargetDictionary;for(let t=0;t<e.metadata.morphCount;t++){let r=e.morphs[t],s=r.morphName;void 0!==a[s]&&(n[s]=n[s]||[],n[s].push(r))}for(let e in n){let t=n[e];t.sort(function(e,t){return e.frameNum-t.frameNum});let s=[],o=[];for(let e=0,r=t.length;e<r;e++)s.push(t[e].frameNum/30),o.push(t[e].weight);r.push(new ee.dUE(".morphTargetInfluences["+a[e]+"]",s,o))}return new ee.m7l("",-1,r)}buildCameraAnimation(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function r(e,t,r){e.push(t[4*r+0]/127),e.push(t[4*r+1]/127),e.push(t[4*r+2]/127),e.push(t[4*r+3]/127)}let n=void 0===e.cameras?[]:e.cameras.slice();n.sort(function(e,t){return e.frameNum-t.frameNum});let a=[],s=[],o=[],l=[],h=[],c=[],u=[],d=[],m=[],p=new ee._fP,A=new ee.USm,f=new ee.Pa4,g=new ee.Pa4;for(let e=0,v=n.length;e<v;e++){let v=n[e],y=v.frameNum/30,x=v.position,b=v.rotation,w=v.distance,C=v.fov,E=v.interpolation;a.push(y),f.set(0,0,-w),g.set(x[0],x[1],x[2]),A.set(-b[0],-b[1],-b[2]),p.setFromEuler(A),f.add(g),f.applyQuaternion(p),t(s,g),o.push(p.x),o.push(p.y),o.push(p.z),o.push(p.w),t(l,f),h.push(C);for(let e=0;e<3;e++)r(c,E,e);r(u,E,3);for(let e=0;e<3;e++)r(d,E,4);r(m,E,5)}let v=[];return v.push(this._createTrack("target.position",ee.yC1,a,s,c)),v.push(this._createTrack(".quaternion",ee.iLg,a,o,u)),v.push(this._createTrack(".position",ee.yC1,a,l,d)),v.push(this._createTrack(".fov",ee.dUE,a,h,m)),new ee.m7l("",-1,v)}_createTrack(e,t,r,n,a){if(r.length>2){r=r.slice(),n=n.slice(),a=a.slice();let e=n.length/r.length,t=a.length/r.length,s=1;for(let o=2,l=r.length;o<l;o++){for(let t=0;t<e;t++)if(n[s*e+t]!==n[(s-1)*e+t]||n[s*e+t]!==n[o*e+t]){s++;break}if(o>s){r[s]=r[o];for(let t=0;t<e;t++)n[s*e+t]=n[o*e+t];for(let e=0;e<t;e++)a[s*t+e]=a[o*t+e]}}r.length=s+1,n.length=(s+1)*e,a.length=(s+1)*t}let s=new t(e,r,n);return s.createInterpolant=function(e){return new mt(this.times,this.values,this.getValueSize(),e,new Float32Array(a))},s}}class mt extends ee._C8{constructor(e,t,r,n,a){super(e,t,r,n),this.interpolationParams=a}interpolate_(e,t,r,n){let a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=this.interpolationParams,h=e*o,c=h-o,u=n-t<1/30*1.5?0:(r-t)/(n-t);if(4===o){let t=l[4*e+0],r=l[4*e+1],n=l[4*e+2],o=l[4*e+3],d=this._calculate(t,r,n,o,u);ee._fP.slerpFlat(a,0,s,c,s,h,d)}else if(3===o)for(let t=0;t!==o;++t){let r=l[12*e+4*t+0],n=l[12*e+4*t+1],o=l[12*e+4*t+2],d=l[12*e+4*t+3],m=this._calculate(r,n,o,d,u);a[t]=s[c+t]*(1-m)+s[h+t]*m}else{let t=l[4*e+0],r=l[4*e+1],n=l[4*e+2],o=l[4*e+3],d=this._calculate(t,r,n,o,u);a[0]=s[c]*(1-d)+s[h]*d}return a}_calculate(e,t,r,n,a){let s,o,l,h=.5,c=.5,u=.5,d=Math;for(let r=0;r<15;r++){let r=(s=3*u*u*c)*e+(o=3*u*c*c)*t+(l=c*c*c)-a;if(1e-5>d.abs(r))break;h/=2,c+=r<0?h:-h,u=1-c}return s*r+o*n+l}}class mi extends ee.DqL{constructor(e){super(e)}parse(e,t){let r=new mr(e,1);return{mipmaps:r.mipmaps(t),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}}}class mr{constructor(e,t){this.arrayBuffer=e;let r=new Uint8Array(this.arrayBuffer,0,12);if(171!==r[0]||75!==r[1]||84!==r[2]||88!==r[3]||32!==r[4]||49!==r[5]||49!==r[6]||187!==r[7]||13!==r[8]||10!==r[9]||26!==r[10]||10!==r[11]){console.error("texture missing KTX identifier");return}let n=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(this.arrayBuffer,12,13*n),s=67305985===a.getUint32(0,!0);if(this.glType=a.getUint32(1*n,s),this.glTypeSize=a.getUint32(2*n,s),this.glFormat=a.getUint32(3*n,s),this.glInternalFormat=a.getUint32(4*n,s),this.glBaseInternalFormat=a.getUint32(5*n,s),this.pixelWidth=a.getUint32(6*n,s),this.pixelHeight=a.getUint32(7*n,s),this.pixelDepth=a.getUint32(8*n,s),this.numberOfArrayElements=a.getUint32(9*n,s),this.numberOfFaces=a.getUint32(10*n,s),this.numberOfMipmapLevels=a.getUint32(11*n,s),this.bytesOfKeyValueData=a.getUint32(12*n,s),0!==this.glType){console.warn("only compressed formats currently supported");return}if(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth){console.warn("only 2D textures currently supported");return}if(0!==this.numberOfArrayElements){console.warn("texture arrays not currently supported");return}if(this.numberOfFaces!==t){console.warn("number of faces expected"+t+", but found "+this.numberOfFaces);return}this.loadType=0}mipmaps(e){let t=[],r=64+this.bytesOfKeyValueData,n=this.pixelWidth,a=this.pixelHeight,s=e?this.numberOfMipmapLevels:1;for(let e=0;e<s;e++){let e=new Int32Array(this.arrayBuffer,r,1)[0];r+=4;for(let s=0;s<this.numberOfFaces;s++){let s=new Uint8Array(this.arrayBuffer,r,e);t.push({data:s,width:n,height:a}),r+=e+(3-(e+3)%4)}n=Math.max(1,.5*n),a=Math.max(1,.5*a)}return t}}class mn extends ee.aNw{load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=new ee.ZAu,r=ri(new Uint8Array(e.slice(16))),n=JSON.parse(i8(r["metadata.json"])),a=new DataView(r["data.sketch"].buffer),s=a.getInt32(16,!0),o={},l=20;for(let e=0;e<s;e++){let e=a.getInt32(l,!0),t=[a.getFloat32(l+4,!0),a.getFloat32(l+8,!0),a.getFloat32(l+12,!0),a.getFloat32(l+16,!0)],r=a.getFloat32(l+20,!0),n=a.getUint32(l+24,!0),s=a.getUint32(l+28,!0),h=0,c=0;for(let e=0;e<4;e++){let t=1<<e;(n&t)>0&&(h+=4),(s&t)>0&&(c+=4)}l=l+28+h+4;let u=a.getInt32(l,!0),d=new Float32Array(3*u),m=new Float32Array(4*u);l+=4;for(let e=0,t=0;e<d.length;e+=3,t+=4)d[e+0]=a.getFloat32(l+0,!0),d[e+1]=a.getFloat32(l+4,!0),d[e+2]=a.getFloat32(l+8,!0),m[t+0]=a.getFloat32(l+12,!0),m[t+1]=a.getFloat32(l+16,!0),m[t+2]=a.getFloat32(l+20,!0),m[t+3]=a.getFloat32(l+24,!0),l=l+28+c;e in o==!1&&(o[e]=[]),o[e].push([d,m,r,t])}for(let e in o){let r=new ma(o[e]),a="Light"===ms[n.BrushIndex[e]]?new ee.FIo(ml().Light):new ee.vBJ({vertexColors:!0,side:ee.ehD});t.add(new ee.Kj0(r,a))}return t}}class ma extends ee.u9r{constructor(e){super();let t=[],r=[],n=[],a=new ee.Pa4,s=new ee.Pa4,o=new ee._fP,l=new ee._fP,h=new ee.Pa4,c=new ee.Pa4,u=new ee.Pa4,d=new ee.Pa4;for(let m in e){let p=e[m],A=p[0],f=p[1],g=p[2],v=p[3];s.fromArray(A,0),l.fromArray(f,0);for(let e=3,m=4,p=A.length;e<p;e+=3,m+=4){a.fromArray(A,e),o.fromArray(f,m),h.set(-g,0,0),h.applyQuaternion(o),h.add(a),c.set(g,0,0),c.applyQuaternion(o),c.add(a),u.set(g,0,0),u.applyQuaternion(l),u.add(s),d.set(-g,0,0),d.applyQuaternion(l),d.add(s),t.push(h.x,h.y,-h.z),t.push(c.x,c.y,-c.z),t.push(d.x,d.y,-d.z),t.push(c.x,c.y,-c.z),t.push(u.x,u.y,-u.z),t.push(d.x,d.y,-d.z),s.copy(a),l.copy(o),r.push(...v),r.push(...v),r.push(...v),r.push(...v),r.push(...v),r.push(...v);let y=e/p,x=(e-3)/p;n.push(y,0),n.push(y,1),n.push(x,0),n.push(y,1),n.push(x,1),n.push(x,0)}}this.setAttribute("position",new ee.TlE(new Float32Array(t),3)),this.setAttribute("color",new ee.TlE(new Float32Array(r),4)),this.setAttribute("uv",new ee.TlE(new Float32Array(n),2))}}let ms={"89d104cd-d012-426b-b5b3-bbaee63ac43c":"Bubbles","700f3aa8-9a7c-2384-8b8a-ea028905dd8c":"CelVinyl","0f0ff7b2-a677-45eb-a7d6-0cd7206f4816":"ChromaticWave","1161af82-50cf-47db-9706-0c3576d43c43":"CoarseBristles","79168f10-6961-464a-8be1-57ed364c5600":"CoarseBristlesSingleSided","1caa6d7d-f015-3f54-3a4b-8b5354d39f81":"Comet","c8313697-2563-47fc-832e-290f4c04b901":"DiamondHull","4391aaaa-df73-4396-9e33-31e4e4930b27":"Disco","d1d991f2-e7a0-4cf1-b328-f57e915e6260":"DotMarker","6a1cf9f9-032c-45ec-9b1d-a6680bee30f7":"Dots","0d3889f3-3ede-470c-8af4-f44813306126":"DoubleTaperedFlat","0d3889f3-3ede-470c-8af4-de4813306126":"DoubleTaperedMarker","d0262945-853c-4481-9cbd-88586bed93cb":"DuctTape","3ca16e2f-bdcd-4da2-8631-dcef342f40f1":"DuctTapeSingleSided","f6e85de3-6dcc-4e7f-87fd-cee8c3d25d51":"Electricity","02ffb866-7fb2-4d15-b761-1012cefb1360":"Embers","cb92b597-94ca-4255-b017-0e3f42f12f9e":"Fire","2d35bcf0-e4d8-452c-97b1-3311be063130":"Flat","55303bc4-c749-4a72-98d9-d23e68e76e18":"FlatDeprecated","280c0a7a-aad8-416c-a7d2-df63d129ca70":"FlatSingleSided","cf019139-d41c-4eb0-a1d0-5cf54b0a42f3":"Highlighter","6a1cf9f9-032c-45ec-9b6e-a6680bee32e9":"HyperGrid","dce872c2-7b49-4684-b59b-c45387949c5c":"Hypercolor","e8ef32b1-baa8-460a-9c2c-9cf8506794f5":"HypercolorSingleSided","2f212815-f4d3-c1a4-681a-feeaf9c6dc37":"Icing","f5c336cf-5108-4b40-ade9-c687504385ab":"Ink","c0012095-3ffd-4040-8ee1-fc180d346eaa":"InkSingleSided","4a76a27a-44d8-4bfe-9a8c-713749a499b0":"Leaves","ea19de07-d0c0-4484-9198-18489a3c1487":"LeavesSingleSided","2241cd32-8ba2-48a5-9ee7-2caef7e9ed62":"Light","4391aaaa-df81-4396-9e33-31e4e4930b27":"LightWire","d381e0f5-3def-4a0d-8853-31e9200bcbda":"Lofted","429ed64a-4e97-4466-84d3-145a861ef684":"Marker","79348357-432d-4746-8e29-0e25c112e3aa":"MatteHull","b2ffef01-eaaa-4ab5-aa64-95a2c4f5dbc6":"NeonPulse","f72ec0e7-a844-4e38-82e3-140c44772699":"OilPaint","c515dad7-4393-4681-81ad-162ef052241b":"OilPaintSingleSided","f1114e2e-eb8d-4fde-915a-6e653b54e9f5":"Paper","759f1ebd-20cd-4720-8d41-234e0da63716":"PaperSingleSided","e0abbc80-0f80-e854-4970-8924a0863dcc":"Petal","c33714d1-b2f9-412e-bd50-1884c9d46336":"Plasma","ad1ad437-76e2-450d-a23a-e17f8310b960":"Rainbow","faaa4d44-fcfb-4177-96be-753ac0421ba3":"ShinyHull","70d79cca-b159-4f35-990c-f02193947fe8":"Smoke","d902ed8b-d0d1-476c-a8de-878a79e3a34c":"Snow","accb32f5-4509-454f-93f8-1df3fd31df1b":"SoftHighlighter","cf7f0059-7aeb-53a4-2b67-c83d863a9ffa":"Spikes","8dc4a70c-d558-4efd-a5ed-d4e860f40dc3":"Splatter","7a1c8107-50c5-4b70-9a39-421576d6617e":"SplatterSingleSided","0eb4db27-3f82-408d-b5a1-19ebd7d5b711":"Stars","44bb800a-fbc3-4592-8426-94ecb05ddec3":"Streamers","0077f88c-d93a-42f3-b59b-b31c50cdb414":"Taffy","b468c1fb-f254-41ed-8ec9-57030bc5660c":"TaperedFlat","c8ccb53d-ae13-45ef-8afb-b730d81394eb":"TaperedFlatSingleSided","d90c6ad8-af0f-4b54-b422-e0f92abe1b3c":"TaperedMarker","1a26b8c0-8a07-4f8a-9fac-d2ef36e0cad0":"TaperedMarker_Flat","75b32cf0-fdd6-4d89-a64b-e2a00b247b0f":"ThickPaint","fdf0326a-c0d1-4fed-b101-9db0ff6d071f":"ThickPaintSingleSided","4391385a-df73-4396-9e33-31e4e4930b27":"Toon","a8fea537-da7c-4d4b-817f-24f074725d6d":"UnlitHull","d229d335-c334-495a-a801-660ac8a87360":"VelvetInk","10201aa3-ebc2-42d8-84b7-2e63f6eeb8ab":"Waveform","b67c0e81-ce6d-40a8-aeb0-ef036b081aa3":"WetPaint","dea67637-cd1a-27e4-c9b1-52f4bbcb84e5":"WetPaintSingleSided","5347acf0-a8e2-47b6-8346-30c70719d763":"WigglyGraphite","e814fef1-97fd-7194-4a2f-50c2bb918be2":"WigglyGraphiteSingleSided","4391385a-cf83-4396-9e33-31e4e4930b27":"Wire"},mo={colors:{BloomColor:`
			vec3 BloomColor(vec3 color, float gain) {
				// Guarantee that there's at least a little bit of all 3 channels.
				// This makes fully-saturated strokes (which only have 2 non-zero
				// color channels) eventually clip to white rather than to a secondary.
				float cmin = length(color.rgb) * .05;
				color.rgb = max(color.rgb, vec3(cmin, cmin, cmin));
				// If we try to remove this pow() from .a, it brightens up
				// pressure-sensitive strokes; looks better as-is.
				color = pow(color, vec3(2.2));
				color.rgb *= 2. * exp(gain * 10.);
				return color;
			}
		`,LinearToSrgb:`
			vec3 LinearToSrgb(vec3 color) {
				// Approximation http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html
				vec3 linearColor = color.rgb;
				vec3 S1 = sqrt(linearColor);
				vec3 S2 = sqrt(S1);
				vec3 S3 = sqrt(S2);
				color.rgb = 0.662002687 * S1 + 0.684122060 * S2 - 0.323583601 * S3 - 0.0225411470 * linearColor;
				return color;
			}
		`,hsv:`
			// uniform sampler2D lookupTex;
			vec4 lookup(vec4 textureColor) {
				return textureColor;
			}

			vec3 lookup(vec3 textureColor) {
				return textureColor;
			}

			vec3 hsv2rgb( vec3 hsv ) {
				vec3 rgb = clamp( abs(mod(hsv.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );
				return hsv.z * mix( vec3(1.0), rgb, hsv.y);
			}

			vec3 rgb2hsv( vec3 rgb ) {
				vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
				vec4 p = mix(vec4(rgb.bg, K.wz), vec4(rgb.gb, K.xy), step(rgb.b, rgb.g));
				vec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));

				float d = q.x - min(q.w, q.y);
				float e = 1.0e-10;

				return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
			}
		`,SrgbToLinear:`
			vec3 SrgbToLinear(vec3 color) {
				// Approximation http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html
				vec3 sRGB = color.rgb;
				color.rgb = sRGB * (sRGB * (sRGB * 0.305306011 + 0.682171111) + 0.012522878);
				return color;
			}
		`}},ml=()=>({Light:{uniforms:{mainTex:{value:new ee.dpR().setPath("./textures/tiltbrush/").loader.load("Light.webp")},alphaTest:{value:.067},emission_gain:{value:.45},alpha:{value:1}},vertexShader:`
			precision highp float;
			precision highp int;

			attribute vec2 uv;
			attribute vec4 color;
			attribute vec3 position;

			uniform mat4 modelMatrix;
			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;
			uniform mat4 viewMatrix;
			uniform mat3 normalMatrix;
			uniform vec3 cameraPosition;

			varying vec2 vUv;
			varying vec3 vColor;

			${mo.colors.LinearToSrgb}
			${mo.colors.hsv}

			void main() {

				vUv = uv;

				vColor = lookup(color.rgb);

				vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

				gl_Position = projectionMatrix * mvPosition;

			}
		`,fragmentShader:`
			precision highp float;
			precision highp int;

			uniform float emission_gain;

			uniform sampler2D mainTex;
			uniform float alphaTest;

			varying vec2 vUv;
			varying vec3 vColor;

			${mo.colors.BloomColor}
			${mo.colors.SrgbToLinear}

			void main(){
				vec4 col = texture2D(mainTex, vUv);
				vec3 color = vColor;
				color = BloomColor(color, emission_gain);
				color = color * col.rgb;
				color = color * col.a;
				color = SrgbToLinear(color);
				gl_FragColor = vec4(color, 1.0);
			}
		`,side:2,transparent:!0,depthFunc:2,depthWrite:!0,depthTest:!1,blending:5,blendDst:201,blendDstAlpha:201,blendEquation:100,blendEquationAlpha:100,blendSrc:201,blendSrcAlpha:201}}),mh=new WeakMap;class mc extends ee.aNw{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){let a=new ee.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,e=>{let r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(n)},r,n)}decodeDracoFile(e,t,r,n){let a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,a).then(t)}decodeGeometry(e,t){let r;for(let e in t.attributeTypes){let r=t.attributeTypes[e];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=r.name)}let n=JSON.stringify(t);if(mh.has(e)){let t=mh.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a=this.workerNextTaskID++,s=e.byteLength,o=this._getWorker(a,s).then(n=>(r=n,new Promise((n,s)=>{r._callbacks[a]={resolve:n,reject:s},r.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return o.catch(()=>!0).then(()=>{r&&a&&this._releaseTask(r,a)}),mh.set(e,{key:n,promise:o}),o}_createGeometry(e){let t=new ee.u9r;e.index&&t.setIndex(new ee.TlE(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let n=e.attributes[r],a=n.name,s=n.array,o=n.itemSize;t.setAttribute(a,new ee.TlE(s,o))}return t}_loadLibrary(e,t){let r=new ee.hH6(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,n)=>{r.load(e,t,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let n=mu.toString(),a=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function mu(){let e,t;onmessage=function(r){let n=r.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":let a=n.buffer,s=n.taskConfig;t.then(e=>{let t=e.draco,r=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(a),a.byteLength);try{let e=function(e,t,r,n){let a,s;let o=n.attributeIDs,l=n.attributeTypes,h=t.GetEncodedGeometryType(r);if(h===e.TRIANGULAR_MESH)a=new e.Mesh,s=t.DecodeBufferToMesh(r,a);else if(h===e.POINT_CLOUD)a=new e.PointCloud,s=t.DecodeBufferToPointCloud(r,a);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!s.ok()||0===a.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());let c={index:null,attributes:[]};for(let r in o){let s,h;let u=self[l[r]];if(n.useUniqueIDs)h=o[r],s=t.GetAttributeByUniqueId(a,h);else{if(-1===(h=t.GetAttributeId(a,e[o[r]])))continue;s=t.GetAttribute(a,h)}c.attributes.push(function(e,t,r,n,a,s){let o=s.num_components(),l=r.num_points()*o,h=l*a.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,a),u=e._malloc(h);t.GetAttributeDataArrayForAllPoints(r,s,c,h,u);let d=new a(e.HEAPF32.buffer,u,l).slice();return e._free(u),{name:n,array:d,itemSize:o}}(e,t,a,r,u,s))}return h===e.TRIANGULAR_MESH&&(c.index=function(e,t,r){let n=3*r.num_faces(),a=4*n,s=e._malloc(a);t.GetTrianglesUInt32Array(r,a,s);let o=new Uint32Array(e.HEAPF32.buffer,s,n).slice();return e._free(s),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),c}(t,r,o,s),a=e.attributes.map(e=>e.array.buffer);e.index&&a.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},a)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(o),t.destroy(r)}})}}}class md extends ee.aNw{constructor(e){super(e),this.hdrLoader=new uD,this.type=ee.cLu}load(e,t,r,n){"string"==typeof e?e=[e]:Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=r,r=n,n=arguments[4]);let a=new ee.BtG;switch(a.type=this.type,a.type){case ee.VzW:case ee.cLu:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=ee.wem,a.magFilter=ee.wem,a.generateMipmaps=!1}let s=this,o=0;for(let l=0;l<e.length;l++)!function(t,r,n,l){new ee.hH6(s.manager).setPath(s.path).setResponseType("arraybuffer").setWithCredentials(s.withCredentials).load(e[t],function(e){o++;let n=s.hdrLoader.parse(e);if(n){if(void 0!==n.data){let e=new ee.IEO(n.data,n.width,n.height);e.type=a.type,"colorSpace"in e?e.colorSpace=a.SRGBColorSpace:e.encoding=a.encoding,e.format=a.format,e.minFilter=a.minFilter,e.magFilter=a.magFilter,e.generateMipmaps=a.generateMipmaps,a.images[t]=e}6===o&&(a.needsUpdate=!0,r&&r(a))}},n,l)}(l,t,r,n);return a}setDataType(e){return this.type=e,this.hdrLoader.setDataType(e),this}}class mm extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e,t,r,n){let a=parseInt(h[n].substr(e,t));if(a){let e="s"+Math.min(r,a)+"e"+Math.max(r,a);void 0===o[e]&&(s.push([r-1,a-1,1]),o[e]=s.length-1)}}let n={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},a=[],s=[],o={},l={},h=e.split("\n");for(let e=0,s=h.length;e<s;e++)if("ATOM"===h[e].substr(0,4)||"HETATM"===h[e].substr(0,6)){var c;let r=parseFloat(h[e].substr(30,7)),s=parseFloat(h[e].substr(38,7)),o=parseFloat(h[e].substr(46,7)),u=parseInt(h[e].substr(6,5))-1,d=t(h[e].substr(76,2)).toLowerCase();""===d&&(d=t(h[e].substr(12,2)).toLowerCase());let m=[r,s,o,n[d],(c=d).charAt(0).toUpperCase()+c.substr(1).toLowerCase()];a.push(m),l[u]=m}else if("CONECT"===h[e].substr(0,6)){let t=parseInt(h[e].substr(6,5));r(11,5,t,e),r(16,5,t,e),r(21,5,t,e),r(26,5,t,e)}return function(){let e={geometryAtoms:new ee.u9r,geometryBonds:new ee.u9r,json:{atoms:a}},t=e.geometryAtoms,r=e.geometryBonds,n=[],o=[],h=[];for(let e=0,t=a.length;e<t;e++){let t=a[e],r=t[0],s=t[1],l=t[2];n.push(r,s,l);let h=t[3][0]/255,c=t[3][1]/255,u=t[3][2]/255;o.push(h,c,u)}for(let e=0,t=s.length;e<t;e++){let t=s[e],r=t[0],n=t[1],a=l[r],o=l[n],c=a[0],u=a[1],d=a[2];h.push(c,u,d),c=o[0],u=o[1],d=o[2],h.push(c,u,d)}return t.setAttribute("position",new ee.a$l(n,3)),t.setAttribute("color",new ee.a$l(o,3)),r.setAttribute("position",new ee.a$l(h,3)),e}()}}let mp=null;function mA(){if(null===mp){let e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);t[0]=170,t[1]=187,mp=43707===r[0]}return mp}let mf=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],mg={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function mv(e,t,r,n,a){let s;let o=t.BYTES_PER_ELEMENT;if(a===mA()||1===o)s=new t(e,r,n);else{let l=new DataView(e,r,n*o),h=mg[t.name],c=!a;s=new t(n);for(let e=0;e<n;e++)s[e]=l[h](e*o,c)}return s}class my extends ee.aNw{constructor(e){super(e)}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),e=e.replace(/\*/g,mA()?"be":"le"),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t=function(e){let t=new Uint8Array(e),r=t[0],n=t[1],a=!!(n>>7&1),s=n>>6&1,o=(n>>5&1)==1,l=31&n,h=0,c=0;if(o?(h=(t[2]<<16)+(t[3]<<8)+t[4],c=(t[5]<<16)+(t[6]<<8)+t[7]):(h=t[2]+(t[3]<<8)+(t[4]<<16),c=t[5]+(t[6]<<8)+(t[7]<<16)),0===r)throw Error("PRWM decoder: Invalid format version: 0");if(1!==r)throw Error("PRWM decoder: Unsupported format version: "+r);if(!a){if(0!==s)throw Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==c)throw Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}let u=8,d={};for(let r=0;r<l;r++){let r="";for(;u<t.length;){let e=t[u];if(u++,0===e)break;r+=String.fromCharCode(e)}let a=(n=t[u])>>7&1,s=(n>>4&3)+1,l=mf[15&n],c=mv(e,l,u=4*Math.ceil(++u/4),s*h,o);u+=l.BYTES_PER_ELEMENT*s*h,d[r]={type:a,cardinality:s,values:c}}u=4*Math.ceil(u/4);let m=null;return a&&(m=mv(e,1===s?Uint32Array:Uint16Array,u,c,o)),{version:r,attributes:d,indices:m}}(e),r=Object.keys(t.attributes),n=new ee.u9r;for(let e=0;e<r.length;e++){let a=t.attributes[r[e]];n.setAttribute(r[e],new ee.TlE(a.values,a.cardinality,a.normalized))}return null!==t.indices&&n.setIndex(new ee.TlE(t.indices,1)),n}static isBigEndianPlatform(){return mA()}}class mx extends ee.yxD{constructor(e){super(e),this.type=ee.cLu,this.maxRange=7}setDataType(e){return this.type=e,this}setMaxRange(e){return this.maxRange=e,this}loadCubemap(e,t,r,n){let a=new ee.BtG,s=0,o=this;for(let r=0;r<e.length;++r)!function(r){o.load(e[r],function(e){a.images[r]=e,6==++s&&(a.needsUpdate=!0,t&&t(a))},void 0,n)}(r);return a.type=this.type,a.format=ee.wk1,a.minFilter=ee.wem,a.generateMipmaps=!1,a}parse(e){var t,r,n;v||((v={}).toRGBA8=function(e){var t=e.width,r=e.height;if(null==e.tabs.acTL)return[v.toRGBA8.decodeImage(e.data,t,r,e).buffer];var n=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var a=t*r*4,s=new Uint8Array(a),o=new Uint8Array(a),l=new Uint8Array(a),h=0;h<e.frames.length;h++){var c=e.frames[h],u=c.rect.x,d=c.rect.y,m=c.rect.width,p=c.rect.height,A=v.toRGBA8.decodeImage(c.data,m,p,e);if(0!=h)for(var f=0;f<a;f++)l[f]=s[f];if(0==c.blend?v._copyTile(A,m,p,s,t,r,u,d,0):1==c.blend&&v._copyTile(A,m,p,s,t,r,u,d,1),n.push(s.buffer.slice(0)),1==c.dispose)v._copyTile(o,m,p,s,t,r,u,d,0);else if(2==c.dispose)for(var f=0;f<a;f++)s[f]=l[f]}return n},v.toRGBA8.decodeImage=function(e,t,r,n){var a=t*r,s=Math.ceil(t*v.decode._getBPP(n)/8),o=new Uint8Array(4*a),l=new Uint32Array(o.buffer),h=n.ctype,c=n.depth,u=v._bin.readUshort;if(6==h){var d=a<<2;if(8==c)for(var m=0;m<d;m+=4)o[m]=e[m],o[m+1]=e[m+1],o[m+2]=e[m+2],o[m+3]=e[m+3];if(16==c)for(var m=0;m<d;m++)o[m]=e[m<<1]}else if(2==h){var p=n.tabs.tRNS;if(null==p){if(8==c)for(var m=0;m<a;m++){var A=3*m;l[m]=-16777216|e[A+2]<<16|e[A+1]<<8|e[A]}if(16==c)for(var m=0;m<a;m++){var A=6*m;l[m]=-16777216|e[A+4]<<16|e[A+2]<<8|e[A]}}else{var f=p[0],g=p[1],y=p[2];if(8==c)for(var m=0;m<a;m++){var x=m<<2,A=3*m;l[m]=-16777216|e[A+2]<<16|e[A+1]<<8|e[A],e[A]==f&&e[A+1]==g&&e[A+2]==y&&(o[x+3]=0)}if(16==c)for(var m=0;m<a;m++){var x=m<<2,A=6*m;l[m]=-16777216|e[A+4]<<16|e[A+2]<<8|e[A],u(e,A)==f&&u(e,A+2)==g&&u(e,A+4)==y&&(o[x+3]=0)}}}else if(3==h){var b=n.tabs.PLTE,w=n.tabs.tRNS,C=w?w.length:0;if(1==c)for(var E=0;E<r;E++)for(var I=E*s,M=E*t,m=0;m<t;m++){var x=M+m<<2,B=e[I+(m>>3)]>>7-((7&m)<<0)&1,S=3*B;o[x]=b[S],o[x+1]=b[S+1],o[x+2]=b[S+2],o[x+3]=B<C?w[B]:255}if(2==c)for(var E=0;E<r;E++)for(var I=E*s,M=E*t,m=0;m<t;m++){var x=M+m<<2,B=e[I+(m>>2)]>>6-((3&m)<<1)&3,S=3*B;o[x]=b[S],o[x+1]=b[S+1],o[x+2]=b[S+2],o[x+3]=B<C?w[B]:255}if(4==c)for(var E=0;E<r;E++)for(var I=E*s,M=E*t,m=0;m<t;m++){var x=M+m<<2,B=e[I+(m>>1)]>>4-((1&m)<<2)&15,S=3*B;o[x]=b[S],o[x+1]=b[S+1],o[x+2]=b[S+2],o[x+3]=B<C?w[B]:255}if(8==c)for(var m=0;m<a;m++){var x=m<<2,B=e[m],S=3*B;o[x]=b[S],o[x+1]=b[S+1],o[x+2]=b[S+2],o[x+3]=B<C?w[B]:255}}else if(4==h){if(8==c)for(var m=0;m<a;m++){var x=m<<2,T=m<<1,F=e[T];o[x]=F,o[x+1]=F,o[x+2]=F,o[x+3]=e[T+1]}if(16==c)for(var m=0;m<a;m++){var x=m<<2,T=m<<2,F=e[T];o[x]=F,o[x+1]=F,o[x+2]=F,o[x+3]=e[T+2]}}else if(0==h)for(var f=n.tabs.tRNS?n.tabs.tRNS:-1,E=0;E<r;E++){var P=E*s,_=E*t;if(1==c)for(var D=0;D<t;D++){var F=255*(e[P+(D>>>3)]>>>7-(7&D)&1),R=F==255*f?0:255;l[_+D]=R<<24|F<<16|F<<8|F}else if(2==c)for(var D=0;D<t;D++){var F=85*(e[P+(D>>>2)]>>>6-((3&D)<<1)&3),R=F==85*f?0:255;l[_+D]=R<<24|F<<16|F<<8|F}else if(4==c)for(var D=0;D<t;D++){var F=17*(e[P+(D>>>1)]>>>4-((1&D)<<2)&15),R=F==17*f?0:255;l[_+D]=R<<24|F<<16|F<<8|F}else if(8==c)for(var D=0;D<t;D++){var F=e[P+D],R=F==f?0:255;l[_+D]=R<<24|F<<16|F<<8|F}else if(16==c)for(var D=0;D<t;D++){var F=e[P+(D<<1)],R=u(e,P+(D<<1))==f?0:255;l[_+D]=R<<24|F<<16|F<<8|F}}return o},v.decode=function(e){for(var t,r,n,a,s=new Uint8Array(e),o=8,l=v._bin,h=l.readUshort,c=l.readUint,u={tabs:{},frames:[]},d=new Uint8Array(s.length),m=0,p=0,A=[137,80,78,71,13,10,26,10],f=0;f<8;f++)if(s[f]!=A[f])throw Error("The input is not a PNG file!");for(;o<s.length;){var g=l.readUint(s,o);o+=4;var y=l.readASCII(s,o,4);if(o+=4,"IHDR"==y)v.decode._IHDR(s,o,u);else if("CgBI"==y)u.tabs[y]=s.slice(o,o+4);else if("IDAT"==y){for(var f=0;f<g;f++)d[m+f]=s[o+f];m+=g}else if("acTL"==y)u.tabs[y]={num_frames:c(s,o),num_plays:c(s,o+4)},a=new Uint8Array(s.length);else if("fcTL"==y){if(0!=p){var x=u.frames[u.frames.length-1];x.data=v.decode._decompress(u,a.slice(0,p),x.rect.width,x.rect.height),p=0}var b={x:c(s,o+12),y:c(s,o+16),width:c(s,o+4),height:c(s,o+8)},w=h(s,o+22),C={rect:b,delay:Math.round(1e3*(w=h(s,o+20)/(0==w?100:w))),dispose:s[o+24],blend:s[o+25]};u.frames.push(C)}else if("fdAT"==y){for(var f=0;f<g-4;f++)a[p+f]=s[o+f+4];p+=g-4}else if("pHYs"==y)u.tabs[y]=[l.readUint(s,o),l.readUint(s,o+4),s[o+8]];else if("cHRM"==y){u.tabs[y]=[];for(var f=0;f<8;f++)u.tabs[y].push(l.readUint(s,o+4*f))}else if("tEXt"==y||"zTXt"==y){null==u.tabs[y]&&(u.tabs[y]={});var E=l.nextZero(s,o);r=l.readASCII(s,o,E-o);var I=o+g-E-1;"tEXt"==y?t=l.readASCII(s,E+1,I):(n=v.decode._inflate(s.slice(E+2,E+2+I)),t=l.readUTF8(n,0,n.length)),u.tabs[y][r]=t}else if("iTXt"==y){null==u.tabs[y]&&(u.tabs[y]={});var E=0,M=o;E=l.nextZero(s,M),r=l.readASCII(s,M,E-M);var B=s[M=E+1];M+=2,E=l.nextZero(s,M),l.readASCII(s,M,E-M),M=E+1,E=l.nextZero(s,M),l.readUTF8(s,M,E-M);var I=g-((M=E+1)-o);0==B?t=l.readUTF8(s,M,I):(n=v.decode._inflate(s.slice(M,M+I)),t=l.readUTF8(n,0,n.length)),u.tabs[y][r]=t}else if("PLTE"==y)u.tabs[y]=l.readBytes(s,o,g);else if("hIST"==y){var S=u.tabs.PLTE.length/3;u.tabs[y]=[];for(var f=0;f<S;f++)u.tabs[y].push(h(s,o+2*f))}else if("tRNS"==y)3==u.ctype?u.tabs[y]=l.readBytes(s,o,g):0==u.ctype?u.tabs[y]=h(s,o):2==u.ctype&&(u.tabs[y]=[h(s,o),h(s,o+2),h(s,o+4)]);else if("gAMA"==y)u.tabs[y]=l.readUint(s,o)/1e5;else if("sRGB"==y)u.tabs[y]=s[o];else if("bKGD"==y)0==u.ctype||4==u.ctype?u.tabs[y]=[h(s,o)]:2==u.ctype||6==u.ctype?u.tabs[y]=[h(s,o),h(s,o+2),h(s,o+4)]:3==u.ctype&&(u.tabs[y]=s[o]);else if("IEND"==y)break;o+=g,l.readUint(s,o),o+=4}if(0!=p){var x=u.frames[u.frames.length-1];x.data=v.decode._decompress(u,a.slice(0,p),x.rect.width,x.rect.height)}return u.data=v.decode._decompress(u,d,u.width,u.height),delete u.compress,delete u.interlace,delete u.filter,u},v.decode._decompress=function(e,t,r,n){var a=new Uint8Array((Math.ceil(r*v.decode._getBPP(e)/8)+1+e.interlace)*n);return t=e.tabs.CgBI?v.inflateRaw(t,a):v.decode._inflate(t,a),0==e.interlace?t=v.decode._filterZero(t,e,0,r,n):1==e.interlace&&(t=v.decode._readInterlace(t,e)),t},v.decode._inflate=function(e,t){return v.inflateRaw(new Uint8Array(e.buffer,2,e.length-6),t)},v.inflateRaw=((t={}).H={},t.H.N=function(e,r){var n,a,s=Uint8Array,o=0,l=0,h=0,c=0,u=0,d=0,m=0,p=0,A=0;if(3==e[0]&&0==e[1])return r||new s(0);var f=t.H,g=f.b,v=f.e,y=f.R,x=f.n,b=f.A,w=f.Z,C=f.m,E=null==r;for(E&&(r=new s(e.length>>>2<<5));0==o;){if(o=g(e,A,1),l=g(e,A+1,2),A+=3,0==l){(7&A)!=0&&(A+=8-(7&A));var I=(A>>>3)+4,M=e[I-4]|e[I-3]<<8;E&&(r=t.H.W(r,p+M)),r.set(new s(e.buffer,e.byteOffset+I,M),p),A=I+M<<3,p+=M;continue}if(E&&(r=t.H.W(r,p+131072)),1==l&&(n=C.J,a=C.h,d=511,m=31),2==l){h=v(e,A,5)+257,c=v(e,A+5,5)+1,u=v(e,A+10,4)+4,A+=14;for(var B=1,S=0;S<38;S+=2)C.Q[S]=0,C.Q[S+1]=0;for(var S=0;S<u;S++){var T=v(e,A+3*S,3);C.Q[(C.X[S]<<1)+1]=T,T>B&&(B=T)}A+=3*u,x(C.Q,B),b(C.Q,B,C.u),n=C.w,a=C.d,A=y(C.u,(1<<B)-1,h+c,e,A,C.v);var F=f.V(C.v,0,h,C.C);d=(1<<F)-1;var P=f.V(C.v,h,c,C.D);m=(1<<P)-1,x(C.C,F),b(C.C,F,n),x(C.D,P),b(C.D,P,a)}for(;;){var _=n[w(e,A)&d];A+=15&_;var D=_>>>4;if(D>>>8==0)r[p++]=D;else if(256==D)break;else{var R=p+D-254;if(D>264){var L=C.q[D-257];R=p+(L>>>3)+v(e,A,7&L),A+=7&L}var N=a[w(e,A)&m];A+=15&N;var k=N>>>4,U=C.c[k],Q=(U>>>4)+g(e,A,15&U);for(A+=15&U;p<R;)r[p]=r[p++-Q],r[p]=r[p++-Q],r[p]=r[p++-Q],r[p]=r[p++-Q];p=R}}}return r.length==p?r:r.slice(0,p)},t.H.W=function(e,t){var r=e.length;if(t<=r)return e;var n=new Uint8Array(r<<1);return n.set(e,0),n},t.H.R=function(e,r,n,a,s,o){for(var l=t.H.e,h=t.H.Z,c=0;c<n;){var u=e[h(a,s)&r];s+=15&u;var d=u>>>4;if(d<=15)o[c]=d,c++;else{var m=0,p=0;16==d?(p=3+l(a,s,2),s+=2,m=o[c-1]):17==d?(p=3+l(a,s,3),s+=3):18==d&&(p=11+l(a,s,7),s+=7);for(var A=c+p;c<A;)o[c]=m,c++}}return s},t.H.V=function(e,t,r,n){for(var a=0,s=0,o=n.length>>>1;s<r;){var l=e[s+t];n[s<<1]=0,n[(s<<1)+1]=l,l>a&&(a=l),s++}for(;s<o;)n[s<<1]=0,n[(s<<1)+1]=0,s++;return a},t.H.n=function(e,r){for(var n,a,s,o,l,h=t.H.m,c=e.length,u=h.j,o=0;o<=r;o++)u[o]=0;for(o=1;o<c;o+=2)u[e[o]]++;var d=h.K;for(a=1,n=0,u[0]=0;a<=r;a++)n=n+u[a-1]<<1,d[a]=n;for(s=0;s<c;s+=2)0!=(l=e[s+1])&&(e[s]=d[l],d[l]++)},t.H.A=function(e,r,n){for(var a=e.length,s=t.H.m.r,o=0;o<a;o+=2)if(0!=e[o+1])for(var l=o>>1,h=e[o+1],c=l<<4|h,u=r-h,d=e[o]<<u,m=d+(1<<u);d!=m;)n[s[d]>>>15-r]=c,d++},t.H.l=function(e,r){for(var n=t.H.m.r,a=15-r,s=0;s<e.length;s+=2){var o=e[s]<<r-e[s+1];e[s]=n[o]>>>a}},t.H.M=function(e,t,r){r<<=7&t;var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8},t.H.I=function(e,t,r){r<<=7&t;var n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},t.H.e=function(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(7&t)&(1<<r)-1},t.H.b=function(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(7&t)&(1<<r)-1},t.H.Z=function(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(7&t)},t.H.i=function(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16|e[(t>>>3)+3]<<24)>>>(7&t)},t.H.m=(r=Uint16Array,n=Uint32Array,{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new n(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new n(286),Y:new n(30),a:new n(19),t:new n(15e3),k:new r(65536),g:new r(32768)}),function(){for(var e=t.H.m,r=0;r<32768;r++){var n=r;n=(4278255360&(n=(4042322160&(n=(3435973836&(n=(2863311530&n)>>>1|(1431655765&n)<<1))>>>2|(858993459&n)<<2))>>>4|(252645135&n)<<4))>>>8|(16711935&n)<<8,e.r[r]=(n>>>16|n<<16)>>>17}function a(e,t,r){for(;0!=t--;)e.push(0,r)}for(var r=0;r<32;r++)e.q[r]=e.S[r]<<3|e.T[r],e.c[r]=e.p[r]<<4|e.z[r];a(e._,144,8),a(e._,112,9),a(e._,24,7),a(e._,8,8),t.H.n(e._,9),t.H.A(e._,9,e.J),t.H.l(e._,9),a(e.$,32,5),t.H.n(e.$,5),t.H.A(e.$,5,e.h),t.H.l(e.$,5),a(e.Q,19,0),a(e.C,286,0),a(e.D,30,0),a(e.v,320,0)}(),t.H.N),v.decode._readInterlace=function(e,t){for(var r=t.width,n=t.height,a=v.decode._getBPP(t),s=a>>3,o=Math.ceil(r*a/8),l=new Uint8Array(n*o),h=0,c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],m=[8,8,4,4,2,2,1],p=0;p<7;){for(var A,f=d[p],g=m[p],y=0,x=0,b=c[p];b<n;)b+=f,x++;for(var w=u[p];w<r;)w+=g,y++;var C=Math.ceil(y*a/8);v.decode._filterZero(e,t,h,y,x);for(var E=0,I=c[p];I<n;){for(var M=u[p],B=h+E*C<<3;M<r;){if(1==a&&(A=(A=e[B>>3])>>7-(7&B)&1,l[I*o+(M>>3)]|=A<<7-((7&M)<<0)),2==a&&(A=(A=e[B>>3])>>6-(7&B)&3,l[I*o+(M>>2)]|=A<<6-((3&M)<<1)),4==a&&(A=(A=e[B>>3])>>4-(7&B)&15,l[I*o+(M>>1)]|=A<<4-((1&M)<<2)),a>=8)for(var S=I*o+M*s,T=0;T<s;T++)l[S+T]=e[(B>>3)+T];B+=a,M+=g}E++,I+=f}y*x!=0&&(h+=x*(1+C)),p+=1}return l},v.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},v.decode._filterZero=function(e,t,r,n,a){var s=v.decode._getBPP(t),o=Math.ceil(n*s/8),l=v.decode._paeth;s=Math.ceil(s/8);var h,c,u=e[r],d=0;if(u>1&&(e[r]=[0,0,1][u-2]),3==u)for(d=s;d<o;d++)e[d+1]=e[d+1]+(e[d+1-s]>>>1)&255;for(var m=0;m<a;m++)if(u=e[(c=(h=r+m*o)+m+1)-1],d=0,0==u)for(;d<o;d++)e[h+d]=e[c+d];else if(1==u){for(;d<s;d++)e[h+d]=e[c+d];for(;d<o;d++)e[h+d]=e[c+d]+e[h+d-s]}else if(2==u)for(;d<o;d++)e[h+d]=e[c+d]+e[h+d-o];else if(3==u){for(;d<s;d++)e[h+d]=e[c+d]+(e[h+d-o]>>>1);for(;d<o;d++)e[h+d]=e[c+d]+(e[h+d-o]+e[h+d-s]>>>1)}else{for(;d<s;d++)e[h+d]=e[c+d]+l(0,e[h+d-o],0);for(;d<o;d++)e[h+d]=e[c+d]+l(e[h+d-s],e[h+d-o],e[h+d-s-o])}return e},v.decode._paeth=function(e,t,r){var n=e+t-r,a=n-e,s=n-t,o=n-r;return a*a<=s*s&&a*a<=o*o?e:s*s<=o*o?t:r},v.decode._IHDR=function(e,t,r){var n=v._bin;r.width=n.readUint(e,t),t+=4,r.height=n.readUint(e,t),t+=4,r.depth=e[t],t++,r.ctype=e[t],t++,r.compress=e[t],t++,r.filter=e[t],t++,r.interlace=e[t],t++},v._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII:function(e,t,r){for(var n="",a=0;a<r;a++)n+=String.fromCharCode(e[t+a]);return n},writeASCII:function(e,t,r){for(var n=0;n<r.length;n++)e[t+n]=r.charCodeAt(n)},readBytes:function(e,t,r){for(var n=[],a=0;a<r;a++)n.push(e[t+a]);return n},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,r){for(var n,a="",s=0;s<r;s++)a+="%"+v._bin.pad(e[t+s].toString(16));try{n=decodeURIComponent(a)}catch(n){return v._bin.readASCII(e,t,r)}return n}},v._copyTile=function(e,t,r,n,a,s,o,l,h){for(var c=Math.min(t,a),u=Math.min(r,s),d=0,m=0,p=0;p<u;p++)for(var A=0;A<c;A++)if(o>=0&&l>=0?(d=p*t+A<<2,m=(l+p)*a+o+A<<2):(d=(-l+p)*t-o+A<<2,m=p*a+A<<2),0==h)n[m]=e[d],n[m+1]=e[d+1],n[m+2]=e[d+2],n[m+3]=e[d+3];else if(1==h){var f=e[d+3]*(1/255),g=e[d]*f,v=e[d+1]*f,y=e[d+2]*f,x=n[m+3]*(1/255),b=n[m]*x,w=n[m+1]*x,C=n[m+2]*x,E=1-f,I=f+x*E,M=0==I?0:1/I;n[m+3]=255*I,n[m+0]=(g+b*E)*M,n[m+1]=(v+w*E)*M,n[m+2]=(y+C*E)*M}else if(2==h){var f=e[d+3],g=e[d],v=e[d+1],y=e[d+2],x=n[m+3],b=n[m],w=n[m+1],C=n[m+2];f==x&&g==b&&v==w&&y==C?(n[m]=0,n[m+1]=0,n[m+2]=0,n[m+3]=0):(n[m]=g,n[m+1]=v,n[m+2]=y,n[m+3]=f)}else if(3==h){var f=e[d+3],g=e[d],v=e[d+1],y=e[d+2],x=n[m+3],b=n[m],w=n[m+1],C=n[m+2];if(f==x&&g==b&&v==w&&y==C)continue;if(f<220&&x>20)return!1}return!0});let a=v.decode(e),s=new Uint8Array(v.toRGBA8(a)[0]),o=a.width*a.height*4,l=this.type===ee.cLu?new Uint16Array(o):new Float32Array(o);for(let e=0;e<s.length;e+=4){let t=s[e+0]/255,r=s[e+1]/255,n=s[e+2]/255,a=s[e+3]/255;this.type===ee.cLu?(l[e+0]=ee.A5E.toHalfFloat(Math.min(t*a*this.maxRange,65504)),l[e+1]=ee.A5E.toHalfFloat(Math.min(r*a*this.maxRange,65504)),l[e+2]=ee.A5E.toHalfFloat(Math.min(n*a*this.maxRange,65504)),l[e+3]=ee.A5E.toHalfFloat(1)):(l[e+0]=t*a*this.maxRange,l[e+1]=r*a*this.maxRange,l[e+2]=n*a*this.maxRange,l[e+3]=1)}return{width:a.width,height:a.height,data:l,format:ee.wk1,type:this.type,flipY:!0}}}class mb extends ee.aNw{load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e){let t;let r=new DataView(e),n=r.getUint32(0,!0),a=r.getUint32(4,!0);if(542658390!==n||150!==a){console.error("Not a valid VOX file");return}let s=[0,4294967295,4291624959,4288282623,4284940287,4281597951,4278255615,4294954239,4291611903,4288269567,4284927231,4281584895,4278242559,4294941183,4291598847,4288256511,4284914175,4281571839,4278229503,4294928127,4291585791,4288243455,4284901119,4281558783,4278216447,4294915071,4291572735,4288230399,4284888063,4281545727,4278203391,4294902015,4291559679,4288217343,4284875007,4281532671,4278190335,4294967244,4291624908,4288282572,4284940236,4281597900,4278255564,4294954188,4291611852,4288269516,4284927180,4281584844,4278242508,4294941132,4291598796,4288256460,4284914124,4281571788,4278229452,4294928076,4291585740,4288243404,4284901068,4281558732,4278216396,4294915020,4291572684,4288230348,4284888012,4281545676,4278203340,4294901964,4291559628,4288217292,4284874956,4281532620,4278190284,4294967193,4291624857,4288282521,4284940185,4281597849,4278255513,4294954137,4291611801,4288269465,4284927129,4281584793,4278242457,4294941081,4291598745,4288256409,4284914073,4281571737,4278229401,4294928025,4291585689,4288243353,4284901017,4281558681,4278216345,4294914969,4291572633,4288230297,4284887961,4281545625,4278203289,4294901913,4291559577,4288217241,4284874905,4281532569,4278190233,4294967142,4291624806,4288282470,4284940134,4281597798,4278255462,4294954086,4291611750,4288269414,4284927078,4281584742,4278242406,4294941030,4291598694,4288256358,4284914022,4281571686,4278229350,4294927974,4291585638,4288243302,4284900966,4281558630,4278216294,4294914918,4291572582,4288230246,4284887910,4281545574,4278203238,4294901862,4291559526,4288217190,4284874854,4281532518,4278190182,4294967091,4291624755,4288282419,4284940083,4281597747,4278255411,4294954035,4291611699,4288269363,4284927027,4281584691,4278242355,4294940979,4291598643,4288256307,4284913971,4281571635,4278229299,4294927923,4291585587,4288243251,4284900915,4281558579,4278216243,4294914867,4291572531,4288230195,4284887859,4281545523,4278203187,4294901811,4291559475,4288217139,4284874803,4281532467,4278190131,4294967040,4291624704,4288282368,4284940032,4281597696,4278255360,4294953984,4291611648,4288269312,4284926976,4281584640,4278242304,4294940928,4291598592,4288256256,4284913920,4281571584,4278229248,4294927872,4291585536,4288243200,4284900864,4281558528,4278216192,4294914816,4291572480,4288230144,4284887808,4281545472,4278203136,4294901760,4291559424,4288217088,4284874752,4281532416,4278190318,4278190301,4278190267,4278190250,4278190216,4278190199,4278190165,4278190148,4278190114,4278190097,4278251008,4278246656,4278237952,4278233600,4278224896,4278220544,4278211840,4278207488,4278198784,4278194432,4293787648,4292673536,4290445312,4289331200,4287102976,4285988864,4283760640,4282646528,4280418304,4279304192,4293848814,4292730333,4290493371,4289374890,4287137928,4286019447,4283782485,4282664004,4280427042,4279308561],o=8,l=[];for(;o<r.byteLength;){let n="";for(let e=0;e<4;e++)n+=String.fromCharCode(r.getUint8(o++));let a=r.getUint32(o,!0);if(o+=8,"SIZE"===n){let e=r.getUint32(o,!0);o+=4;let n=r.getUint32(o,!0);o+=4;let h=r.getUint32(o,!0);o+=4,t={palette:s,size:{x:e,y:n,z:h}},l.push(t),o+=a-12}else if("XYZI"===n){let n=r.getUint32(o,!0);o+=4,t.data=new Uint8Array(e,o,4*n),o+=4*n}else if("RGBA"===n){let e=[0];for(let t=0;t<256;t++)e[t+1]=r.getUint32(o,!0),o+=4;t.palette=e}else o+=a}return l}}class mw extends ee.Kj0{constructor(e){let t=e.data,r=e.size,n=e.palette,a=[],s=[],o=[0,0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1],l=[1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0],h=[0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1],c=[0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0],u=[0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,0,0],d=[0,1,1,1,1,1,0,1,0,1,1,0,0,1,0,1,1,1];function m(e,t,n,o,l,h,c){t-=r.x/2,n-=r.z/2,o+=r.y/2;for(let r=0;r<18;r+=3)a.push(e[r+0]+t,e[r+1]+n,e[r+2]+o),s.push(l,h,c)}let p=r.x,A=r.x*r.y,f=new Uint8Array(r.x*r.y*r.z);for(let e=0;e<t.length;e+=4)f[t[e+0]+t[e+1]*p+t[e+2]*A]=255;let g=!1;for(let e=0;e<t.length;e+=4){let a=t[e+0],s=t[e+1],v=t[e+2],y=n[t[e+3]],x=(y>>0&255)/255,b=(y>>8&255)/255,w=(y>>16&255)/255;(x>0||b>0||w>0)&&(g=!0);let C=a+s*p+v*A;(0===f[C+1]||a===r.x-1)&&m(l,a,v,-s,x,b,w),(0===f[C-1]||0===a)&&m(o,a,v,-s,x,b,w),(0===f[C+p]||s===r.y-1)&&m(c,a,v,-s,x,b,w),(0===f[C-p]||0===s)&&m(h,a,v,-s,x,b,w),(0===f[C+A]||v===r.z-1)&&m(d,a,v,-s,x,b,w),(0===f[C-A]||0===v)&&m(u,a,v,-s,x,b,w)}let v=new ee.u9r;v.setAttribute("position",new ee.a$l(a,3)),v.computeVertexNormals();let y=new ee.Wid;g&&(v.setAttribute("color",new ee.a$l(s,3)),y.vertexColors=!0),super(v,y)}}class mC extends cJ{constructor(e){let t=e.data,r=e.size,n=r.x,a=r.x*r.y,s=new Uint8Array(r.x*r.y*r.z);for(let e=0;e<t.length;e+=4)s[t[e+0]+t[e+1]*n+t[e+2]*a]=255;super(s,r.x,r.y,r.z),this.format=ee.hEm,this.minFilter=ee.TyD,this.magFilter=ee.wem,this.unpackAlignment=1,this.needsUpdate=!0}}class mE extends ee.aNw{constructor(e){super(e),this.littleEndian=!0}load(e,t,r,n){let a=this,s=new ee.hH6(a.manager);s.setPath(a.path),s.setResponseType("arraybuffer"),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(r){try{t(a.parse(r,e))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t){let r=(0,cE.r)(new Uint8Array(e)),n=function(e){let t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=n[1],t.headerLen=n[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map(function(e){return parseInt(e,10)})),null!==t.count)t.count=t.count[1].split(" ").map(function(e){return parseInt(e,10)});else{t.count=[];for(let e=0,r=t.fields.length;e<r;e++)t.count.push(1)}t.offset={};let a=0;for(let e=0,r=t.fields.length;e<r;e++)"ascii"===t.data?t.offset[t.fields[e]]=e:(t.offset[t.fields[e]]=a,a+=t.size[e]*t.count[e]);return t.rowSize=a,t}(r),a=[],s=[],o=[];if("ascii"===n.data){let e=n.offset,t=r.substr(n.headerLen).split("\n");for(let r=0,n=t.length;r<n;r++){if(""===t[r])continue;let n=t[r].split(" ");if(void 0!==e.x&&(a.push(parseFloat(n[e.x])),a.push(parseFloat(n[e.y])),a.push(parseFloat(n[e.z]))),void 0!==e.rgb){let t=parseFloat(n[e.rgb]),r=t>>16&255,a=t>>8&255,s=t>>0&255;o.push(r/255,a/255,s/255)}void 0!==e.normal_x&&(s.push(parseFloat(n[e.normal_x])),s.push(parseFloat(n[e.normal_y])),s.push(parseFloat(n[e.normal_z])))}}if("binary_compressed"===n.data){let t=new Uint32Array(e.slice(n.headerLen,n.headerLen+8)),r=t[0],l=t[1],h=new DataView(function(e,t){let r,n,a;let s=e.length,o=new Uint8Array(t),l=0,h=0;do if((r=e[l++])<32){if(h+ ++r>t)throw Error("Output buffer is not large enough");if(l+r>s)throw Error("Invalid compressed data");do o[h++]=e[l++];while(--r)}else{if(n=r>>5,a=h-((31&r)<<8)-1,l>=s||7===n&&(n+=e[l++],l>=s))throw Error("Invalid compressed data");if(a-=e[l++],h+n+2>t)throw Error("Output buffer is not large enough");if(a<0||a>=h)throw Error("Invalid compressed data");do o[h++]=o[a++];while(--n+2)}while(l<s);return o}(new Uint8Array(e,n.headerLen+8,r),l).buffer),c=n.offset;for(let e=0;e<n.points;e++)void 0!==c.x&&(a.push(h.getFloat32(n.points*c.x+n.size[0]*e,this.littleEndian)),a.push(h.getFloat32(n.points*c.y+n.size[1]*e,this.littleEndian)),a.push(h.getFloat32(n.points*c.z+n.size[2]*e,this.littleEndian))),void 0!==c.rgb&&(o.push(h.getUint8(n.points*c.rgb+n.size[3]*e+2)/255),o.push(h.getUint8(n.points*c.rgb+n.size[3]*e+1)/255),o.push(h.getUint8(n.points*c.rgb+n.size[3]*e+0)/255)),void 0!==c.normal_x&&(s.push(h.getFloat32(n.points*c.normal_x+n.size[4]*e,this.littleEndian)),s.push(h.getFloat32(n.points*c.normal_y+n.size[5]*e,this.littleEndian)),s.push(h.getFloat32(n.points*c.normal_z+n.size[6]*e,this.littleEndian)))}if("binary"===n.data){let t=new DataView(e,n.headerLen),r=n.offset;for(let e=0,l=0;e<n.points;e++,l+=n.rowSize)void 0!==r.x&&(a.push(t.getFloat32(l+r.x,this.littleEndian)),a.push(t.getFloat32(l+r.y,this.littleEndian)),a.push(t.getFloat32(l+r.z,this.littleEndian))),void 0!==r.rgb&&(o.push(t.getUint8(l+r.rgb+2)/255),o.push(t.getUint8(l+r.rgb+1)/255),o.push(t.getUint8(l+r.rgb+0)/255)),void 0!==r.normal_x&&(s.push(t.getFloat32(l+r.normal_x,this.littleEndian)),s.push(t.getFloat32(l+r.normal_y,this.littleEndian)),s.push(t.getFloat32(l+r.normal_z,this.littleEndian)))}let l=new ee.u9r;a.length>0&&l.setAttribute("position",new ee.a$l(a,3)),s.length>0&&l.setAttribute("normal",new ee.a$l(s,3)),o.length>0&&l.setAttribute("color",new ee.a$l(o,3)),l.computeBoundingSphere();let h=new ee.UY4({size:.005});o.length>0?h.vertexColors=!0:h.color.setHex(16777215*Math.random());let c=new ee.woe(l,h),u=t.split("").reverse().join("");return u=(u=/([^\/]*)/.exec(u))[1].split("").reverse().join(""),c.name=u,c}}class mI{constructor(e){this.IFF=e}parseBlock(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();let e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":let r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":let n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}}class mM{constructor(e){this.IFF=e}parseBlock(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();let e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":let r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":let n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}}class mB{constructor(){this.debugger=new mT}parse(e){if(this.reader=new mS(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new mI(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new mM(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}}parseTopForm(){if(this.debugger.offset=this.reader.offset,"FORM"!==this.reader.getIDTag()){console.warn("LWOLoader: Top-level FORM missing.");return}var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();"LWO2"===t?this.tree.format=t:"LWO3"===t&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}parseForm(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}setupForm(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm):this.currentForm[e]={},this.currentForm=this.currentForm[e]}skipForm(e){this.reader.skip(e-4)}parseUnknownForm(e,t){var r,n,a;console.warn("LWOLoader: unknown FORM encountered: "+e,t),r=this.reader.dv.buffer,n=this.reader.offset,a=t-4,console.log(new TextDecoder().decode(new Uint8Array(r,n,a))),this.reader.skip(t-4)}parseSurfaceForm(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e}parseSurfaceLwo2(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e}parseSubNode(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e}parseConnections(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections}parseEntryForm(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)}parseValueForm(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))}parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()}parseImageMap(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var t={};this.currentForm.maps.push(t),this.currentForm=t,this.reader.skip(10)}parseTextureNodeAttribute(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)}parseEnvelope(e){this.reader.skip(e-4)}parseClip(e){if("FORM"===this.reader.getIDTag()){this.reader.skip(16),this.currentNode.fileName=this.reader.getString();return}this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t}parseClipLwo2(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),n=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(n>=e)break}this.tree.textures.push(t),this.currentForm=t}parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()}parseXVAL(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)}parseXVAL3(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)}parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}}parseLayer(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+mF(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1}parsePoints(e){this.currentPoints=[];for(var t=0;t<e/4;t+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())}parseVertexMapping(e,t){var r=this.reader.offset+e,n=this.reader.getString();if(this.reader.offset===r){this.currentForm.UVChannel=n;return}this.reader.setOffset(this.reader.offset-mF(n));var a=this.reader.getIDTag();this.reader.getUint16();var s=this.reader.getString(),o=e-6-mF(s);switch(a){case"TXUV":this.parseUVMapping(s,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(s,r,a);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(o);break;default:console.warn("LWOLoader: unknown vertex map type: "+a),this.reader.skip(o)}}parseUVMapping(e,t,r){for(var n=[],a=[],s=[];this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),r&&a.push(this.reader.getVariableLengthIndex()),s.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:n,polyIndices:a,uvs:s}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:n,uvs:s})}parseMorphTargets(e,t,r){var n=[],a=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),a.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:n,points:a,type:r}}parsePolygonList(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),n=[],a=[];this.reader.offset<t;){var s=this.reader.getUint16();s&=1023,a.push(s);for(var o=0;o<s;o++)n.push(this.reader.getVariableLengthIndex())}var l={type:r,vertexIndices:n,polygonDimensions:a,points:this.currentPoints};1===a[0]?l.type="points":2===a[0]&&(l.type="lines"),this.currentLayer.geometry=l}parseTagStrings(e){this.tree.tags=this.reader.getStringArray(e)}parsePolygonTagMapping(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)}parseMaterialIndices(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}}parseUnknownCHUNK(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var r=this.reader.getString(t);this.currentForm[e]=r}}class mS{constructor(e){this.dv=new DataView(e),this.offset=0,this._textDecoder=new TextDecoder,this._bytes=new Uint8Array(e)}size(){return this.dv.buffer.byteLength}setOffset(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")}endOfFile(){return this.offset>=this.size()}skip(e){this.offset+=e}getUint8(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}getUint16(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e}getInt32(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e}getUint32(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e}getUint64(){return 4294967296*this.getUint32()+this.getUint32()}getFloat32(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e}getFloat32Array(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t}getVariableLengthIndex(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()}getIDTag(){return this.getString(4)}getString(e){let t,r;if(0===e)return;let n=this.offset;return e?(r=e,t=this._textDecoder.decode(new Uint8Array(this.dv.buffer,n,e))):(r=this._bytes.indexOf(0,n)-n,t=this._textDecoder.decode(new Uint8Array(this.dv.buffer,n,r)),r++,r+=r%2),this.skip(r),t}getStringArray(e){var t=this.getString(e);return(t=t.split("\0")).filter(Boolean)}}class mT{constructor(){this.active=!1,this.depth=0,this.formList=[]}enable(){this.active=!0}log(){var e;if(this.active){switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}}closeForms(){if(this.active)for(var e=this.formList.length-1;e>=0;e--)this.offset>=this.formList[e]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}}function mF(e){return e.length+1+((e.length+1)%2?1:0)}class mP extends ee.aNw{constructor(e,t={}){super(e),this.resourcePath=void 0!==t.resourcePath?t.resourcePath:""}load(e,t,r,n){let a=this,s=""===a.path?function(e,t){let r=e.indexOf(t);return -1===r?"./":e.substr(0,r)}(e,"Objects"):a.path,o=e.split(s).pop().split(".")[0],l=new ee.hH6(this.manager);l.setPath(a.path),l.setResponseType("arraybuffer"),l.load(e,function(r){try{t(a.parse(r,s,o))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}parse(e,t,r){return y=new mB().parse(e),new m_(new ee.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin)).parse(r)}}class m_{constructor(e){this.textureLoader=e}parse(e){return this.materials=new mD(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}}parseLayers(){let e=[],t=[],r=new mR,n=this;return y.layers.forEach(function(a){let s=r.parse(a.geometry,a),o=n.parseMesh(s,a);e[a.number]=o,-1===a.parent?t.push(o):e[a.parent].add(o)}),this.applyPivots(t),t}parseMesh(e,t){let r;let n=this.getMaterials(e.userData.matNames,t.geometry.type);return"uv2"===eW.i&&this.duplicateUVs(e,n),r="points"===t.geometry.type?new ee.woe(e,n):"lines"===t.geometry.type?new ee.ejS(e,n):new ee.Kj0(e,n),t.name?r.name=t.name:r.name=this.defaultLayerName+"_layer_"+t.number,r.userData.pivot=t.pivot,r}applyPivots(e){e.forEach(function(e){e.traverse(function(e){let t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){let t=e.parent.userData.pivot;e.position.x-=t[0],e.position.y-=t[1],e.position.z-=t[2]}})})}getMaterials(e,t){let r=[],n=this;e.forEach(function(e,t){r[t]=n.getMaterialByName(e)}),("points"===t||"lines"===t)&&r.forEach(function(e,n){let a={color:e.color};"points"===t?(a.size=.1,a.map=e.map,a.morphTargets=e.morphTargets,r[n]=new ee.UY4(a)):"lines"===t&&(r[n]=new ee.nls(a))});let a=r.filter(Boolean);return 1===a.length?a[0]:r}getMaterialByName(e){return this.materials.filter(function(t){return t.name===e})[0]}duplicateUVs(e,t){let r=!1;Array.isArray(t)?t.forEach(function(e){e.aoMap&&(r=!0)}):t.aoMap&&(r=!0),r&&e.setAttribute("uv2",new ee.TlE(e.attributes.uv.array,2))}}class mD{constructor(e){this.textureLoader=e}parse(){let e=[];for(let t in this.textures={},y.materials)"LWO3"===y.format?e.push(this.parseMaterial(y.materials[t],t,y.textures)):"LWO2"===y.format&&e.push(this.parseMaterialLwo2(y.materials[t],t,y.textures));return e}parseMaterial(e,t,r){let n={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)},a=this.parseConnections(e.connections,e.nodes),s=this.parseTextureNodes(a.maps);this.parseAttributeImageMaps(a.attributes,r,s,e.maps);let o=this.parseAttributes(a.attributes,s);return this.parseEnvMap(a,s,o),n=Object.assign(n=Object.assign(s,n),o),new(this.getMaterialType(a.attributes))(n)}parseMaterialLwo2(e,t){let r={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)};return r=Object.assign(r,this.parseAttributes(e.attributes,{})),new ee.xoR(r)}getSide(e){if(!e.side)return ee._Li;switch(e.side){case 0:case 1:return ee._Li;case 2:return ee.Wl3;case 3:return ee.ehD}}getSmooth(e){return!e.smooth||!e.smooth}parseConnections(e,t){let r={maps:{}},n=e.inputName,a=e.inputNodeName,s=e.nodeName,o=this;return n.forEach(function(e,n){if("Material"===e){let e=o.getNodeByRefName(a[n],t);r.attributes=e.attributes,r.envMap=e.fileName,r.name=a[n]}}),s.forEach(function(e,s){e===r.name&&(r.maps[n[s]]=o.getNodeByRefName(a[s],t))}),r}getNodeByRefName(e,t){for(let r in t)if(t[r].refName===e)return t[r]}parseTextureNodes(e){let t={};for(let r in e){let n=e[r],a=n.fileName;if(!a)return;let s=this.loadTexture(a);switch(void 0!==n.widthWrappingMode&&(s.wrapS=this.getWrappingType(n.widthWrappingMode)),void 0!==n.heightWrappingMode&&(s.wrapT=this.getWrappingType(n.heightWrappingMode)),r){case"Color":t.map=s;break;case"Roughness":t.roughnessMap=s,t.roughness=.5;break;case"Specular":t.specularMap=s,t.specular=16777215;break;case"Luminous":t.emissiveMap=s,t.emissive=8421504;break;case"Luminous Color":t.emissive=8421504;break;case"Metallic":t.metalnessMap=s,t.metalness=.5;break;case"Transparency":case"Alpha":t.alphaMap=s,t.transparent=!0;break;case"Normal":t.normalMap=s,void 0!==n.amplitude&&(t.normalScale=new ee.FM8(n.amplitude,n.amplitude));break;case"Bump":t.bumpMap=s}}return t.roughnessMap&&t.specularMap&&delete t.specularMap,t}parseAttributeImageMaps(e,t,r){for(let n in e){let a=e[n];if(a.maps){let e=a.maps[0],s=this.getTexturePathByIndex(e.imageIndex,t);if(!s)return;let o=this.loadTexture(s);switch(void 0!==e.wrap&&(o.wrapS=this.getWrappingType(e.wrap.w)),void 0!==e.wrap&&(o.wrapT=this.getWrappingType(e.wrap.h)),n){case"Color":r.map=o;break;case"Diffuse":r.aoMap=o;break;case"Roughness":r.roughnessMap=o,r.roughness=1;break;case"Specular":r.specularMap=o,r.specular=16777215;break;case"Luminosity":r.emissiveMap=o,r.emissive=8421504;break;case"Metallic":r.metalnessMap=o,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=o,r.transparent=!0;break;case"Normal":r.normalMap=o;break;case"Bump":r.bumpMap=o}}}}parseAttributes(e,t){let r={};return e.Color&&!t.map?r.color=new ee.Ilk().fromArray(e.Color.value):r.color=new ee.Ilk,e.Transparency&&0!==e.Transparency.value&&(r.opacity=1-e.Transparency.value,r.transparent=!0),e["Bump Height"]&&(r.bumpScale=.1*e["Bump Height"].value),e["Refraction Index"]&&(r.refractionRatio=1/e["Refraction Index"].value),this.parsePhysicalAttributes(r,e,t),this.parseStandardAttributes(r,e,t),this.parsePhongAttributes(r,e,t),r}parsePhysicalAttributes(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))}parseStandardAttributes(e,t,r){t.Luminous&&(e.emissiveIntensity=t.Luminous.value,t["Luminous Color"]&&!r.emissive?e.emissive=new ee.Ilk().fromArray(t["Luminous Color"].value):e.emissive=new ee.Ilk(8421504)),t.Roughness&&!r.roughnessMap&&(e.roughness=t.Roughness.value),t.Metallic&&!r.metalnessMap&&(e.metalness=t.Metallic.value)}parsePhongAttributes(e,t,r){t.Diffuse&&e.color.multiplyScalar(t.Diffuse.value),t.Reflection&&(e.reflectivity=t.Reflection.value,e.combine=ee.NDo),t.Luminosity&&(e.emissiveIntensity=t.Luminosity.value,r.emissiveMap||r.map?e.emissive=new ee.Ilk(8421504):e.emissive=e.color),t.Roughness||!t.Specular||r.specularMap||(t["Color Highlight"]?e.specular=new ee.Ilk().setScalar(t.Specular.value).lerp(e.color.clone().multiplyScalar(t.Specular.value),t["Color Highlight"].value):e.specular=new ee.Ilk().setScalar(t.Specular.value)),e.specular&&t.Glossiness&&(e.shininess=7+Math.pow(2,12*t.Glossiness.value+2))}parseEnvMap(e,t,r){if(e.envMap){let n=this.loadTexture(e.envMap);r.transparent&&r.opacity<.999?(n.mapping=ee.Bf4,void 0!==r.reflectivity&&(delete r.reflectivity,delete r.combine),void 0!==r.metalness&&delete r.metalness):n.mapping=ee.dSO,t.envMap=n}}getTexturePathByIndex(e){let t="";return y.textures&&y.textures.forEach(function(r){r.index===e&&(t=r.fileName)}),t}loadTexture(e){return e?this.textureLoader.load(e,void 0,void 0,function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}):null}getWrappingType(e){switch(e){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),ee.uWy;case 1:return ee.rpg;case 2:return ee.OoA;case 3:return ee.uWy}}getMaterialType(e){return e.Clearcoat&&e.Clearcoat.value>0?ee.EJi:e.Roughness?ee.Wid:ee.xoR}}class mR{parse(e,t){let r=new ee.u9r;r.setAttribute("position",new ee.a$l(e.points,3));let n=this.splitIndices(e.vertexIndices,e.polygonDimensions);return r.setIndex(n),this.parseGroups(r,e),r.computeVertexNormals(),this.parseUVs(r,t,n),this.parseMorphTargets(r,t,n),r.translate(-t.pivot[0],-t.pivot[1],-t.pivot[2]),r}splitIndices(e,t){let r=[],n=0;return t.forEach(function(t){if(t<4)for(let a=0;a<t;a++)r.push(e[n+a]);else if(4===t)r.push(e[n],e[n+1],e[n+2],e[n],e[n+2],e[n+3]);else if(t>4){for(let a=1;a<t-1;a++)r.push(e[n],e[n+a],e[n+a+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}n+=t}),r}parseGroups(e,t){let r,n;let a=y.tags,s=[],o=3;"lines"===t.type&&(o=2),"points"===t.type&&(o=1);let l=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices),h=0,c={},u=0,d=0;for(let t=0;t<l.length;t+=2){if(n=l[t+1],0===t&&(s[h]=a[n]),void 0===r&&(r=n),n!==r){let t;c[a[r]]?t=c[a[r]]:(t=h,c[a[r]]=h,s[h]=a[r],h++),e.addGroup(u,d,t),u+=d,r=n,d=0}d+=o}if(e.groups.length>0){let t;c[a[n]]?t=c[a[n]]:(t=h,c[a[n]]=h,s[h]=a[n]),e.addGroup(u,d,t)}e.userData.matNames=s}splitMaterialIndices(e,t){let r=[];return e.forEach(function(e,n){if(e<=3)r.push(t[2*n],t[2*n+1]);else if(4===e)r.push(t[2*n],t[2*n+1],t[2*n],t[2*n+1]);else for(let a=0;a<e-2;a++)r.push(t[2*n],t[2*n+1])}),r}parseUVs(e,t){let r=Array.from(Array(2*e.attributes.position.count),function(){return 0});for(let e in t.uvs){let n=t.uvs[e].uvs;t.uvs[e].uvIndices.forEach(function(e,t){r[2*e]=n[2*t],r[2*e+1]=n[2*t+1]})}e.setAttribute("uv",new ee.a$l(r,2))}parseMorphTargets(e,t){let r=0;for(let n in t.morphTargets){let a=e.attributes.position.array.slice();e.morphAttributes.position||(e.morphAttributes.position=[]);let s=t.morphTargets[n].points,o=t.morphTargets[n].indices,l=t.morphTargets[n].type;o.forEach(function(e,t){"relative"===l?(a[3*e]+=s[3*t],a[3*e+1]+=s[3*t+1],a[3*e+2]+=s[3*t+2]):(a[3*e]=s[3*t],a[3*e+1]=s[3*t+1],a[3*e+2]=s[3*t+2])}),e.morphAttributes.position[r]=new ee.a$l(a,3),e.morphAttributes.position[r].name=n,r++}e.morphTargetsRelative=!1}}class mL extends ee.aNw{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,r,n){let a=this,s=new ee.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t(a.parse(r))}catch(t){n?n(t):console.error(t),a.manager.itemError(e)}},r,n)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){let t;function r(e){let t;let r="",n=0,a=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==a&&(r=a[1],n=new Blob([a[0]]).size);let s={comments:[],elements:[],headerLength:n,objInfo:""},o=r.split("\n");for(let e=0;e<o.length;e++){let r=o[e];if(""===(r=r.trim()))continue;let n=r.split(/\s+/),a=n.shift();switch(r=n.join(" "),a){case"format":s.format=n[0],s.version=n[1];break;case"comment":s.comments.push(r);break;case"element":void 0!==t&&s.elements.push(t),(t={}).name=n[0],t.count=parseInt(n[1]),t.properties=[];break;case"property":t.properties.push(function(e,t){let r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}(n,h.propertyNameMapping));break;case"obj_info":s.objInfo=r;break;default:console.log("unhandled",a,n)}}return void 0!==t&&s.elements.push(t),s}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function a(e,t){let r;let a={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},l="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(l=r[1]);let h=l.split("\n"),c=0,u=0;for(let e=0;e<h.length;e++){let r=h[e];if(""===(r=r.trim()))continue;u>=t.elements[c].count&&(c++,u=0);let s=function(e,t){let r=t.split(/\s+/),a={};for(let t=0;t<e.length;t++)if("list"===e[t].type){let s=[],o=n(r.shift(),e[t].countType);for(let a=0;a<o;a++)s.push(n(r.shift(),e[t].itemType));a[e[t].name]=s}else a[e[t].name]=n(r.shift(),e[t].type);return a}(t.elements[c].properties,r);o(a,t.elements[c].name,s),u++}return s(a)}function s(e){let t=new ee.u9r;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new ee.a$l(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new ee.a$l(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new ee.a$l(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new ee.a$l(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new ee.a$l(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){let t=r.vertex_indices||r.vertex_index,n=r.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),n&&6===n.length&&(e.faceVertexUvs.push(n[0],n[1]),e.faceVertexUvs.push(n[2],n[3]),e.faceVertexUvs.push(n[4],n[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function l(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}let h=this;if(e instanceof ArrayBuffer){let n=(0,cE.r)(new Uint8Array(e)),h=r(n);t="ascii"===h.format?a(n,h):function(e,t){let r={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},n="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),h,c=0;for(let e=0;e<t.elements.length;e++)for(let s=0;s<t.elements[e].count;s++){h=function(e,t,r,n){let a={},s,o=0;for(let h=0;h<r.length;h++)if("list"===r[h].type){let c=[],u=(s=l(e,t+o,r[h].countType,n))[0];o+=s[1];for(let a=0;a<u;a++)s=l(e,t+o,r[h].itemType,n),c.push(s[0]),o+=s[1];a[r[h].name]=c}else s=l(e,t+o,r[h].type,n),a[r[h].name]=s[0],o+=s[1];return[a,o]}(a,c,t.elements[e].properties,n),c+=h[1];let s=h[0];o(r,t.elements[e].name,s)}return s(r)}(e,h)}else t=a(e,r(e));return t}}var mN=r(35888);class mk extends mN.z{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){let t=e.length-3,r=new Float32Array(2*t);for(let n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return super.setPositions(r),this}setColors(e,t=3){let r=e.length-t,n=new Float32Array(2*r);if(3===t)for(let a=0;a<r;a+=t)n[2*a]=e[a],n[2*a+1]=e[a+1],n[2*a+2]=e[a+2],n[2*a+3]=e[a+3],n[2*a+4]=e[a+4],n[2*a+5]=e[a+5];else for(let a=0;a<r;a+=t)n[2*a]=e[a],n[2*a+1]=e[a+1],n[2*a+2]=e[a+2],n[2*a+3]=e[a+3],n[2*a+4]=e[a+4],n[2*a+5]=e[a+5],n[2*a+6]=e[a+6],n[2*a+7]=e[a+7];return super.setColors(n,t),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}}var mU=r(59638);let mQ=new ee.Pa4,mO=new ee.Pa4,mG=new ee.Ltg;class mH extends ee.Kj0{constructor(e=new mN.z,t=new mU.Y({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let e=0,a=0,s=t.count;e<s;e++,a+=2)mQ.fromBufferAttribute(t,e),mO.fromBufferAttribute(r,e),n[a]=0===a?0:n[a-1],n[a+1]=n[a]+mQ.distanceTo(mO);let a=new ee.$TI(n,2,1);return e.setAttribute("instanceDistanceStart",new ee.kB5(a,1,0)),e.setAttribute("instanceDistanceEnd",new ee.kB5(a,1,1)),this}onBeforeRender(e){let t=this.material.uniforms;t&&t.resolution&&(e.getViewport(mG),this.material.uniforms.resolution.value.set(mG.z,mG.w))}}class mz extends mN.z{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new ee.Uk6(e))}}var mV=r(944);class mj extends mV.w{constructor(e=new mk,t=new mU.Y({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class mW extends ee.Kj0{constructor(e,t){super(new ee.xo$(1,32,16),new ee.jyz({type:"LightProbeHelperMaterial",uniforms:{sh:{value:e.sh.coefficients},intensity:{value:e.intensity}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n	vNormal = normalize( normalMatrix * normal );\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define RECIPROCAL_PI 0.318309886\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n	// matrix is assumed to be orthogonal\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	// normal is assumed to have unit length\n	float x = normal.x, y = normal.y, z = normal.z;\n	// band 0\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	// band 1\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	// band 2\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nuniform vec3 sh[ 9 ]; // sh coefficients\nuniform float intensity; // light probe intensity\nvarying vec3 vNormal;\nvoid main() {\n	vec3 normal = normalize( vNormal );\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, sh );\n	vec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;\n	gl_FragColor = linearToOutputTexel( vec4( outgoingLight, 1.0 ) );\n}"})),this.lightProbe=e,this.size=t,this.type="LightProbeHelper",this.onBeforeRender()}dispose(){this.geometry.dispose(),this.material.dispose()}onBeforeRender(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity}}let mX=new ee.Pa4,mY=new ee.Pa4;class mK extends ee.ejS{constructor(e,t=1,r=65535){let n=new ee.u9r,a=e.geometry.attributes.tangent.count,s=new ee.a$l(6*a,3);n.setAttribute("position",s),super(n,new ee.nls({color:r,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexTangentsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0);let e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,n=r.attributes.position,a=r.attributes.tangent,s=0;for(let r=0,o=n.count;r<o;r++)mX.fromBufferAttribute(n,r).applyMatrix4(e),mY.fromBufferAttribute(a,r),mY.transformDirection(e).multiplyScalar(this.size).add(mX),t.setXYZ(s,mX.x,mX.y,mX.z),s+=1,t.setXYZ(s,mY.x,mY.y,mY.z),s+=1;t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}class mJ extends ee.x12{constructor(e,t=1,r=16,n=2){let a=new ee.u9r,s=new Float32Array((3*(r+2*n)+3)*3);a.setAttribute("position",new ee.TlE(s,3)),super(a,[new ee.nls({color:16776960}),new ee.nls({color:65280})]),this.type="PositionalAudioHelper",this.audio=e,this.range=t,this.divisionsInnerAngle=r,this.divisionsOuterAngle=n,this.update()}update(){let e,t;let r=this.audio,n=this.range,a=this.divisionsInnerAngle,s=this.divisionsOuterAngle,o=ee.M8C.degToRad(r.panner.coneInnerAngle),l=ee.M8C.degToRad(r.panner.coneOuterAngle),h=o/2,c=l/2,u=0,d=0,m=this.geometry,p=m.attributes.position;function A(r,a,s,o){let l=(a-r)/s;for(p.setXYZ(u,0,0,0),d++,e=r;e<a;e+=l)t=u+d,p.setXYZ(t,Math.sin(e)*n,0,Math.cos(e)*n),p.setXYZ(t+1,Math.sin(Math.min(e+l,a))*n,0,Math.cos(Math.min(e+l,a))*n),p.setXYZ(t+2,0,0,0),d+=3;m.addGroup(u,d,o),u+=d,d=0}m.clearGroups(),A(-c,-h,s,0),A(-h,h,a,1),A(h,c,s,0),p.needsUpdate=!0,o===l&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}let mq=new ee.Pa4,mZ=new ee.Pa4,m$=new ee.Vkp;class m0 extends ee.ejS{constructor(e,t=1,r=16711680){let n=new ee.u9r,a=e.geometry.attributes.normal.count,s=new ee.a$l(6*a,3);n.setAttribute("position",s),super(n,new ee.nls({color:r,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),m$.getNormalMatrix(this.object.matrixWorld);let e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry;if(r){let n=r.attributes.position,a=r.attributes.normal,s=0;for(let r=0,o=n.count;r<o;r++)mq.fromBufferAttribute(n,r).applyMatrix4(e),mZ.fromBufferAttribute(a,r),mZ.applyMatrix3(m$).normalize().multiplyScalar(this.size).add(mq),t.setXYZ(s,mq.x,mq.y,mq.z),s+=1,t.setXYZ(s,mZ.x,mZ.y,mZ.z),s+=1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}class m1 extends ee.x12{constructor(e,t){let r=new ee.u9r;r.setAttribute("position",new ee.a$l([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new ee.nls({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";let n=new ee.u9r;n.setAttribute("position",new ee.a$l([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new ee.Kj0(n,new ee.vBJ({side:ee._Li,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);let e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}var m2=r(71201);class m3{static fromCubeTexture(e){let t=0,r=new ee.Pa4,n=new ee.Pa4,a=new ee.Ilk,s=[0,0,0,0,0,0,0,0,0],o=new ee.lDi,l=o.coefficients;for(let o=0;o<6;o++){let h=e.image[o],c=h.width,u=h.height,d=document.createElement("canvas");d.width=c,d.height=u;let m=d.getContext("2d");m.drawImage(h,0,0,c,u);let p=m.getImageData(0,0,c,u),A=p.data,f=p.width,g=2/f;for(let h=0,c=A.length;h<c;h+=4){a.setRGB(A[h]/255,A[h+1]/255,A[h+2]/255),"colorSpace"in e?"srgb"===e.colorSpace&&a.convertSRGBToLinear():3001===e.encoding&&a.convertSRGBToLinear();let c=h/4,u=-1+(c%f+.5)*g,d=1-(Math.floor(c/f)+.5)*g;switch(o){case 0:r.set(-1,d,-u);break;case 1:r.set(1,d,u);break;case 2:r.set(-u,1,-d);break;case 3:r.set(-u,-1,d);break;case 4:r.set(-u,d,1);break;case 5:r.set(u,d,-1)}let m=r.lengthSq(),p=4/(Math.sqrt(m)*m);t+=p,n.copy(r).normalize(),ee.lDi.getBasisAt(n,s);for(let e=0;e<9;e++)l[e].x+=s[e]*a.r*p,l[e].y+=s[e]*a.g*p,l[e].z+=s[e]*a.b*p}}let h=4*Math.PI/t;for(let e=0;e<9;e++)l[e].x*=h,l[e].y*=h,l[e].z*=h;return new ee.lk7(o)}static fromCubeRenderTarget(e,t){let r=0,n=new ee.Pa4,a=new ee.Pa4,s=new ee.Ilk,o=[0,0,0,0,0,0,0,0,0],l=new ee.lDi,h=l.coefficients;for(let l=0;l<6;l++){let c=t.width,u=new Uint8Array(c*c*4);e.readRenderTargetPixels(t,0,0,c,c,u,l);let d=2/c;for(let e=0,m=u.length;e<m;e+=4){s.setRGB(u[e]/255,u[e+1]/255,u[e+2]/255),"colorSpace"in t.texture?"srgb"===t.texture.colorSpace&&s.convertSRGBToLinear():3001===t.texture.encoding&&s.convertSRGBToLinear();let m=e/4,p=-1+(m%c+.5)*d,A=1-(Math.floor(m/c)+.5)*d;switch(l){case 0:n.set(1,A,-p);break;case 1:n.set(-1,A,p);break;case 2:n.set(p,1,-A);break;case 3:n.set(p,-1,A);break;case 4:n.set(p,A,1);break;case 5:n.set(-p,A,-1)}let f=n.lengthSq(),g=4/(Math.sqrt(f)*f);r+=g,a.copy(n).normalize(),ee.lDi.getBasisAt(a,o);for(let e=0;e<9;e++)h[e].x+=o[e]*s.r*g,h[e].y+=o[e]*s.g*g,h[e].z+=o[e]*s.b*g}}let c=4*Math.PI/r;for(let e=0;e<9;e++)h[e].x*=c,h[e].y*=c,h[e].z*=c;return new ee.lk7(l)}}class m4{constructor(e,t,r,n,a){this.degree1=e,this.degree2=t,this.knots1=r,this.knots2=n,this.controlPoints=[];let s=r.length-e-1,o=n.length-t-1;for(let e=0;e<s;++e){this.controlPoints[e]=[];for(let t=0;t<o;++t){let r=a[e][t];this.controlPoints[e][t]=new ee.Ltg(r.x,r.y,r.z,r.w)}}}getPoint(e,t,r){let n=this.knots1[0]+e*(this.knots1[this.knots1.length-1]-this.knots1[0]),a=this.knots2[0]+t*(this.knots2[this.knots2.length-1]-this.knots2[0]);cw(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,n,a,r)}}class m5 extends ee.Hyl{getPoint(e,t=new ee.Pa4){let r=-.22*Math.cos(e=2*Math.PI*e)-1.28*Math.sin(e)-.44*Math.cos(3*e)-.78*Math.sin(3*e),n=-.1*Math.cos(2*e)-.27*Math.sin(2*e)+.38*Math.cos(4*e)+.46*Math.sin(4*e),a=.7*Math.cos(3*e)-.4*Math.sin(3*e);return t.set(r,n,a).multiplyScalar(20)}}class m8 extends ee.Hyl{constructor(e=5){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=16*Math.pow(Math.sin(e*=2*Math.PI),3),n=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e);return t.set(r,n,0).multiplyScalar(this.scale)}}class m6 extends ee.Hyl{constructor(e=70){super(),this.scale=e}getPoint(e,t=new ee.Pa4){e=4*e*Math.PI;let r=this.scale/2,n=r*(1+Math.cos(e)),a=r*Math.sin(e),s=2*r*Math.sin(e/2);return t.set(n,a,s)}}class m9 extends ee.Hyl{getPoint(e,t=new ee.Pa4){let r=50*Math.sin(e*=2*Math.PI),n=Math.cos(e)*(10+50*Math.cos(e)),a=Math.sin(e)*(10+50*Math.cos(e));return t.set(r,n,a)}}class m7 extends ee.Hyl{getPoint(e,t=new ee.Pa4){let r=2*Math.PI*e*150/30,n=30*Math.cos(r),a=30*Math.sin(r);return t.set(n,a,150*e)}}class pe extends ee.Hyl{constructor(e=10){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=(2+Math.cos(3*(e*=2*Math.PI)))*Math.cos(2*e),n=(2+Math.cos(3*e))*Math.sin(2*e),a=Math.sin(3*e);return t.set(r,n,a).multiplyScalar(this.scale)}}class pt extends ee.Hyl{constructor(e=10){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=(2+Math.cos(4*(e*=2*Math.PI)))*Math.cos(3*e),n=(2+Math.cos(4*e))*Math.sin(3*e),a=Math.sin(4*e);return t.set(r,n,a).multiplyScalar(this.scale)}}class pi extends ee.Hyl{constructor(e=10){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=(2+Math.cos(5*(e*=2*Math.PI)))*Math.cos(2*e),n=(2+Math.cos(5*e))*Math.sin(2*e),a=Math.sin(5*e);return t.set(r,n,a).multiplyScalar(this.scale)}}class pr extends ee.Hyl{constructor(e=10){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=Math.pow(e=4*e-2,3)-3*e,n=Math.pow(e,4)-4*e*e,a=.2*Math.pow(e,5)-2*e;return t.set(r,n,a).multiplyScalar(this.scale)}}class pn extends ee.Hyl{constructor(e=1){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=.4*(e=8*e+-4)*(e*e-7)*(e*e-10),n=Math.pow(e,4)-13*e*e,a=.1*e*(e*e-4)*(e*e-9)*(e*e-12);return t.set(r,n,a).multiplyScalar(this.scale)}}class pa extends ee.Hyl{constructor(e=40){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=Math.cos(2*(e*=2*Math.PI))*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),n=Math.sin(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),a=.35*Math.sin(5*e);return t.set(r,n,a).multiplyScalar(this.scale)}}class ps extends ee.Hyl{constructor(e=40){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=e*Math.PI*2;return t.set(Math.cos(2*r)*(1+.45*Math.cos(3*r)+.4*Math.cos(9*r)),Math.sin(2*r)*(1+.45*Math.cos(3*r)+.4*Math.cos(9*r)),.2*Math.sin(9*r)).multiplyScalar(this.scale)}}class po extends ee.Hyl{constructor(e=40){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=e*Math.PI*2;return t.set(Math.cos(3*r)*(1+.3*Math.cos(5*r)+.5*Math.cos(10*r)),Math.sin(3*r)*(1+.3*Math.cos(5*r)+.5*Math.cos(10*r)),.2*Math.sin(20*r)).multiplyScalar(this.scale)}}class pl extends ee.Hyl{constructor(e=40){super(),this.scale=e}getPoint(e,t=new ee.Pa4){let r=e*Math.PI*2;return t.set(Math.cos(4*r)*(1+.5*(Math.cos(5*r)+.4*Math.cos(20*r))),Math.sin(4*r)*(1+.5*(Math.cos(5*r)+.4*Math.cos(20*r))),.35*Math.sin(15*r)).multiplyScalar(this.scale)}}let ph=new ee.yGw,pc=new ee.Tme,pu=new ee.Pa4;class pd extends ee.pBf{static createBufferGeometryFromObject(e){let t=new ee.u9r,r=e.geometry;if(e.isPoints||e.isLine){let e=new ee.a$l(3*r.vertices.length,3),n=new ee.a$l(3*r.colors.length,3);if(t.setAttribute("position",e.copyVector3sArray(r.vertices)),t.setAttribute("color",n.copyColorsArray(r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){let e=new ee.a$l(r.lineDistances.length,1);t.setAttribute("lineDistance",e.copyArray(r.lineDistances))}null!==r.boundingSphere&&(t.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(t.boundingBox=r.boundingBox.clone())}else e.isMesh&&(t=r.toBufferGeometry());return t}constructor(){super(),this.isGeometry=!0,this.uuid=ee.M8C.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new ee.Vkp().getNormalMatrix(e);for(let t=0,r=this.vertices.length;t<r;t++)this.vertices[t].applyMatrix4(e);for(let e=0,r=this.faces.length;e<r;e++){let r=this.faces[e];r.normal.applyMatrix3(t).normalize();for(let e=0,n=r.vertexNormals.length;e<n;e++)r.vertexNormals[e].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return ph.makeRotationX(e),this.applyMatrix4(ph),this}rotateY(e){return ph.makeRotationY(e),this.applyMatrix4(ph),this}rotateZ(e){return ph.makeRotationZ(e),this.applyMatrix4(ph),this}translate(e,t,r){return ph.makeTranslation(e,t,r),this.applyMatrix4(ph),this}scale(e,t,r){return ph.makeScale(e,t,r),this.applyMatrix4(ph),this}lookAt(e){return pc.lookAt(e),pc.updateMatrix(),this.applyMatrix4(pc.matrix),this}fromBufferGeometry(e){let t=this,r=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let a=n.position,s=n.normal,o=n.color,l=n.uv,h=n.uv2;void 0!==h&&(this.faceVertexUvs[1]=[]);for(let e=0;e<a.count;e++)t.vertices.push(new ee.Pa4().fromBufferAttribute(a,e)),void 0!==o&&t.colors.push(new ee.Ilk().fromBufferAttribute(o,e));function c(e,r,n,a){let c=void 0===o?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],u=void 0===s?[]:[new ee.Pa4().fromBufferAttribute(s,e),new ee.Pa4().fromBufferAttribute(s,r),new ee.Pa4().fromBufferAttribute(s,n)],d=new pp(e,r,n,u,c,a);t.faces.push(d),void 0!==l&&t.faceVertexUvs[0].push([new ee.FM8().fromBufferAttribute(l,e),new ee.FM8().fromBufferAttribute(l,r),new ee.FM8().fromBufferAttribute(l,n)]),void 0!==h&&t.faceVertexUvs[1].push([new ee.FM8().fromBufferAttribute(h,e),new ee.FM8().fromBufferAttribute(h,r),new ee.FM8().fromBufferAttribute(h,n)])}let u=e.groups;if(u.length>0)for(let e=0;e<u.length;e++){let t=u[e],n=t.start,a=t.count;for(let e=n,s=n+a;e<s;e+=3)void 0!==r?c(r.getX(e),r.getX(e+1),r.getX(e+2),t.materialIndex):c(e,e+1,e+2,t.materialIndex)}else if(void 0!==r)for(let e=0;e<r.count;e+=3)c(r.getX(e),r.getX(e+1),r.getX(e+2));else for(let e=0;e<a.count;e+=3)c(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pu).negate(),this.translate(pu.x,pu.y,pu.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new ee.yGw;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let e=new ee.Pa4,t=new ee.Pa4;for(let r=0,n=this.faces.length;r<n;r++){let n=this.faces[r],a=this.vertices[n.a],s=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,s),t.subVectors(a,s),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=Array(this.vertices.length);for(let e=0,r=this.vertices.length;e<r;e++)t[e]=new ee.Pa4;if(e){let e=new ee.Pa4,r=new ee.Pa4;for(let n=0,a=this.faces.length;n<a;n++){let a=this.faces[n],s=this.vertices[a.a],o=this.vertices[a.b],l=this.vertices[a.c];e.subVectors(l,o),r.subVectors(s,o),e.cross(r),t[a.a].add(e),t[a.b].add(e),t[a.c].add(e)}}else{this.computeFaceNormals();for(let e=0,r=this.faces.length;e<r;e++){let r=this.faces[e];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let e=0,r=this.vertices.length;e<r;e++)t[e].normalize();for(let e=0,r=this.faces.length;e<r;e++){let r=this.faces[e],n=r.vertexNormals;3===n.length?(n[0].copy(t[r.a]),n[1].copy(t[r.b]),n[2].copy(t[r.c])):(n[0]=t[r.a].clone(),n[1]=t[r.b].clone(),n[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],r=t.vertexNormals;3===r.length?(r[0].copy(t.normal),r[1].copy(t.normal),r[2].copy(t.normal)):(r[0]=t.normal.clone(),r[1]=t.normal.clone(),r[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,r=t.vertexNormals.length;e<r;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}let e=new pd;e.faces=this.faces;for(let t=0,r=this.morphTargets.length;t<r;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let e=this.morphNormals[t].faceNormals,r=this.morphNormals[t].vertexNormals;for(let t=0,n=this.faces.length;t<n;t++){let t=new ee.Pa4,n={a:new ee.Pa4,b:new ee.Pa4,c:new ee.Pa4};e.push(t),r.push(n)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],n=r.faceNormals[e],a=r.vertexNormals[e];n.copy(t.normal),a.a.copy(t.vertexNormals[0]),a.b.copy(t.vertexNormals[1]),a.c.copy(t.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ee.ZzF),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ee.aLr),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,r=0){let n;if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let a=this.vertices.length,s=this.vertices,o=e.vertices,l=this.faces,h=e.faces,c=this.colors,u=e.colors;void 0!==t&&(n=new ee.Vkp().getNormalMatrix(t));for(let e=0,r=o.length;e<r;e++){let r=o[e].clone();void 0!==t&&r.applyMatrix4(t),s.push(r)}for(let e=0,t=u.length;e<t;e++)c.push(u[e].clone());for(let e=0,t=h.length;e<t;e++){let t,s;let o=h[e],c=o.vertexNormals,u=o.vertexColors,d=new pp(o.a+a,o.b+a,o.c+a);d.normal.copy(o.normal),void 0!==n&&d.normal.applyMatrix3(n).normalize();for(let e=0,r=c.length;e<r;e++)t=c[e].clone(),void 0!==n&&t.applyMatrix3(n).normalize(),d.vertexNormals.push(t);d.color.copy(o.color);for(let e=0,t=u.length;e<t;e++)s=u[e],d.vertexColors.push(s.clone());d.materialIndex=o.materialIndex+r,l.push(d)}for(let t=0,r=e.faceVertexUvs.length;t<r;t++){let r=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,n=r.length;e<n;e++){let n=r[e],a=[];for(let e=0,t=n.length;e<t;e++)a.push(n[e].clone());this.faceVertexUvs[t].push(a)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},r=[],n=[],a=Math.pow(10,e);for(let e=0,s=this.vertices.length;e<s;e++){let s=this.vertices[e],o=`${Math.round(s.x*a)}_${Math.round(s.y*a)}_${Math.round(s.z*a)}`;void 0===t[o]?(t[o]=e,r.push(this.vertices[e]),n[e]=r.length-1):n[e]=n[t[o]]}let s=[];for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e];t.a=n[t.a],t.b=n[t.b],t.c=n[t.c];let r=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(r[t]===r[(t+1)%3]){s.push(e);break}}for(let e=s.length-1;e>=0;e--){let t=s[e];this.faces.splice(t,1);for(let e=0,r=this.faceVertexUvs.length;e<r;e++)this.faceVertexUvs[e].splice(t,1)}let o=this.vertices.length-r.length;return this.vertices=r,o}setFromPoints(e){this.vertices=[];for(let t=0,r=e.length;t<r;t++){let r=e[t];this.vertices.push(new ee.Pa4(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e,t;let r=this.faces,n=r.length;for(let e=0;e<n;e++)r[e]._id=e;r.sort(function(e,t){return e.materialIndex-t.materialIndex});let a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===n&&(e=[]),s&&s.length===n&&(t=[]);for(let o=0;o<n;o++){let n=r[o]._id;e&&e.push(a[n]),t&&t.push(s[n])}e&&(this.faceVertexUvs[0]=e),t&&(this.faceVertexUvs[1]=t)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let t=this.parameters;for(let r in t)void 0!==t[r]&&(e[r]=t[r]);return e}let t=[];for(let e=0;e<this.vertices.length;e++){let r=this.vertices[e];t.push(r.x,r.y,r.z)}let r=[],n=[],a={},s=[],o={},l=[],h={};for(let e=0;e<this.faces.length;e++){let t=this.faces[e],n=void 0!==this.faceVertexUvs[0][e],a=t.normal.length()>0,s=t.vertexNormals.length>0,o=1!==t.color.r||1!==t.color.g||1!==t.color.b,l=t.vertexColors.length>0,h=0;if(h=c(0,0,0),h=c(h,1,!0),h=c(h,2,!1),h=c(h,3,n),h=c(h,4,a),h=c(h,5,s),h=c(h,6,o),h=c(h,7,l),r.push(h),r.push(t.a,t.b,t.c),r.push(t.materialIndex),n){let t=this.faceVertexUvs[0][e];r.push(m(t[0]),m(t[1]),m(t[2]))}if(a&&r.push(u(t.normal)),s){let e=t.vertexNormals;r.push(u(e[0]),u(e[1]),u(e[2]))}if(o&&r.push(d(t.color)),l){let e=t.vertexColors;r.push(d(e[0]),d(e[1]),d(e[2]))}}function c(e,t,r){return r?e|1<<t:e&~(1<<t)}function u(e){let t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==a[t]||(a[t]=n.length/3,n.push(e.x,e.y,e.z)),a[t]}function d(e){let t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==o[t]||(o[t]=s.length,s.push(e.getHex())),o[t]}function m(e){let t=e.x.toString()+e.y.toString();return void 0!==h[t]||(h[t]=l.length/2,l.push(e.x,e.y)),h[t]}return e.data={},e.data.vertices=t,e.data.normals=n,s.length>0&&(e.data.colors=s),l.length>0&&(e.data.uvs=[l]),e.data.faces=r,e}clone(){return new pd().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let e=0,r=t.length;e<r;e++)this.vertices.push(t[e].clone());let r=e.colors;for(let e=0,t=r.length;e<t;e++)this.colors.push(r[e].clone());let n=e.faces;for(let e=0,t=n.length;e<t;e++)this.faces.push(n[e].clone());for(let t=0,r=e.faceVertexUvs.length;t<r;t++){let r=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,n=r.length;e<n;e++){let n=r[e],a=[];for(let e=0,t=n.length;e<t;e++){let t=n[e];a.push(t.clone())}this.faceVertexUvs[t].push(a)}}let a=e.morphTargets;for(let e=0,t=a.length;e<t;e++){let t={};if(t.name=a[e].name,void 0!==a[e].vertices){t.vertices=[];for(let r=0,n=a[e].vertices.length;r<n;r++)t.vertices.push(a[e].vertices[r].clone())}if(void 0!==a[e].normals){t.normals=[];for(let r=0,n=a[e].normals.length;r<n;r++)t.normals.push(a[e].normals[r].clone())}this.morphTargets.push(t)}let s=e.morphNormals;for(let e=0,t=s.length;e<t;e++){let t={};if(void 0!==s[e].vertexNormals){t.vertexNormals=[];for(let r=0,n=s[e].vertexNormals.length;r<n;r++){let n=s[e].vertexNormals[r],a={};a.a=n.a.clone(),a.b=n.b.clone(),a.c=n.c.clone(),t.vertexNormals.push(a)}}if(void 0!==s[e].faceNormals){t.faceNormals=[];for(let r=0,n=s[e].faceNormals.length;r<n;r++)t.faceNormals.push(s[e].faceNormals[r].clone())}this.morphNormals.push(t)}let o=e.skinWeights;for(let e=0,t=o.length;e<t;e++)this.skinWeights.push(o[e].clone());let l=e.skinIndices;for(let e=0,t=l.length;e<t;e++)this.skinIndices.push(l[e].clone());let h=e.lineDistances;for(let e=0,t=h.length;e<t;e++)this.lineDistances.push(h[e]);let c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());let u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new pm().fromGeometry(this),t=new ee.u9r,r=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new ee.TlE(r,3).copyVector3sArray(e.vertices)),e.normals.length>0){let r=new Float32Array(3*e.normals.length);t.setAttribute("normal",new ee.TlE(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){let r=new Float32Array(3*e.colors.length);t.setAttribute("color",new ee.TlE(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){let r=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new ee.TlE(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new ee.TlE(r,2).copyVector2sArray(e.uvs2))}for(let r in t.groups=e.groups,e.morphTargets){let n=[],a=e.morphTargets[r];for(let e=0,t=a.length;e<t;e++){let t=a[e],r=new ee.a$l(3*t.data.length,3);r.name=t.name,n.push(r.copyVector3sArray(t.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new ee.a$l(4*e.skinIndices.length,4);t.setAttribute("skinIndex",r.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){let r=new ee.a$l(4*e.skinWeights.length,4);t.setAttribute("skinWeight",r.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}}class pm{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t,r,n;let a=[],s=e.faces;for(r=0;r<s.length;r++){let e=s[r];e.materialIndex!==n&&(n=e.materialIndex,void 0!==t&&(t.count=3*r-t.start,a.push(t)),t={start:3*r,materialIndex:n})}void 0!==t&&(t.count=3*r-t.start,a.push(t)),this.groups=a}fromGeometry(e){let t,r;let n=e.faces,a=e.vertices,s=e.faceVertexUvs,o=s[0]&&s[0].length>0,l=s[1]&&s[1].length>0,h=e.morphTargets,c=h.length;if(c>0){t=[];for(let e=0;e<c;e++)t[e]={name:h[e].name,data:[]};this.morphTargets.position=t}let u=e.morphNormals,d=u.length;if(d>0){r=[];for(let e=0;e<d;e++)r[e]={name:u[e].name,data:[]};this.morphTargets.normal=r}let m=e.skinIndices,p=e.skinWeights,A=m.length===a.length,f=p.length===a.length;a.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let e=0;e<n.length;e++){let g=n[e];this.vertices.push(a[g.a],a[g.b],a[g.c]);let v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let e=g.normal;this.normals.push(e,e,e)}let y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{let e=g.color;this.colors.push(e,e,e)}if(!0===o){let t=s[0][e];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",e),this.uvs.push(new ee.FM8,new ee.FM8,new ee.FM8))}if(!0===l){let t=s[1][e];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",e),this.uvs2.push(new ee.FM8,new ee.FM8,new ee.FM8))}for(let e=0;e<c;e++){let r=h[e].vertices;t[e].data.push(r[g.a],r[g.b],r[g.c])}for(let t=0;t<d;t++){let n=u[t].vertexNormals[e];r[t].data.push(n.a,n.b,n.c)}A&&this.skinIndices.push(m[g.a],m[g.b],m[g.c]),f&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}class pp{constructor(e,t,r,n,a,s=0){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new ee.Pa4,this.vertexNormals=Array.isArray(n)?n:[],this.color=a&&a.isColor?a:new ee.Ilk,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let pA=()=>{let e;if(x)return x;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let n="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";WebAssembly.validate(t)&&(n="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");let a=WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){let n=e.charCodeAt(r);t[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let n=0;for(let a=0;a<e.length;++a)t[n++]=t[a]<60?r[t[a]]:(t[a]-60)*64+t[++a];return t.buffer.slice(0,n)}(n),{}).then(t=>{(e=t.instance).exports.__wasm_call_ctors()});function s(t,r,n,a,s,o){let l=e.exports.sbrk,h=n+3&-4,c=l(h*a),u=l(s.length),d=new Uint8Array(e.exports.memory.buffer);d.set(s,u);let m=t(c,n,a,u,s.length);if(0===m&&o&&o(c,h,a),r.set(d.subarray(c,c+n*a)),l(c-l(0)),0!==m)throw Error(`Malformed buffer data: ${m}`)}let o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return x={ready:a,supported:!0,decodeVertexBuffer(t,r,n,a,l){s(e.exports.meshopt_decodeVertexBuffer,t,r,n,a,e.exports[o[l]])},decodeIndexBuffer(t,r,n,a){s(e.exports.meshopt_decodeIndexBuffer,t,r,n,a)},decodeIndexSequence(t,r,n,a){s(e.exports.meshopt_decodeIndexSequence,t,r,n,a)},decodeGltfBuffer(t,r,n,a,h,c){s(e.exports[l[h]],t,r,n,a,e.exports[o[c]])}}}},77606:function(e,t,r){r.d(t,{E:function(){return c}});var n=r(79290),a=r(43224),s=r(93683),o=r(9609);let l="srgb",h="srgb-linear";class c extends n.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new f(e)}),this.register(function(e){return new g(e)}),this.register(function(e){return new M(e)}),this.register(function(e){return new B(e)}),this.register(function(e){return new S(e)}),this.register(function(e){return new y(e)}),this.register(function(e){return new x(e)}),this.register(function(e){return new b(e)}),this.register(function(e){return new w(e)}),this.register(function(e){return new A(e)}),this.register(function(e){return new C(e)}),this.register(function(e){return new v(e)}),this.register(function(e){return new I(e)}),this.register(function(e){return new E(e)}),this.register(function(e){return new m(e)}),this.register(function(e){return new T(e)}),this.register(function(e){return new F(e)})}load(e,t,r,a){let s;let o=this;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){let t=n.Zp0.extractUrlBase(e);s=n.Zp0.resolveURL(t,this.path)}else s=n.Zp0.extractUrlBase(e);this.manager.itemStart(e);let l=function(t){a?a(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},h=new n.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(r){try{o.parse(r,s,function(r){t(r),o.manager.itemEnd(e)},l)}catch(e){l(e)}},r,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let a;let s={},l={};if("string"==typeof e)a=JSON.parse(e);else if(e instanceof ArrayBuffer){if((0,o.r)(new Uint8Array(e.slice(0,4)))===P){try{s[d.KHR_BINARY_GLTF]=new D(e)}catch(e){n&&n(e);return}a=JSON.parse(s[d.KHR_BINARY_GLTF].content)}else a=JSON.parse((0,o.r)(new Uint8Array(e)))}else a=e;if(void 0===a.asset||a.asset.version[0]<2){n&&n(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let h=new ee(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](h);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[t.name]=t,s[t.name]=!0}if(a.extensionsUsed)for(let e=0;e<a.extensionsUsed.length;++e){let t=a.extensionsUsed[e],r=a.extensionsRequired||[];switch(t){case d.KHR_MATERIALS_UNLIT:s[t]=new p;break;case d.KHR_DRACO_MESH_COMPRESSION:s[t]=new R(a,this.dracoLoader);break;case d.KHR_TEXTURE_TRANSFORM:s[t]=new L;break;case d.KHR_MESH_QUANTIZATION:s[t]=new N;break;default:r.indexOf(t)>=0&&void 0===l[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}h.setExtensions(s),h.setPlugins(l),h.parse(r,n)}parseAsync(e,t){let r=this;return new Promise(function(n,a){r.parse(e,t,n,a)})}}function u(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let d={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class m{constructor(e){this.parser=e,this.name=d.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){let n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,a="light:"+e,s=r.cache.get(a);if(s)return s;let o=r.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],c=new n.Ilk(16777215);void 0!==l.color&&c.setRGB(l.color[0],l.color[1],l.color[2],h);let u=void 0!==l.range?l.range:0;switch(l.type){case"directional":(t=new n.Ox3(c)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new n.cek(c)).distance=u;break;case"spot":(t=new n.PMe(c)).distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,t.angle=l.spot.outerConeAngle,t.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return t.position.set(0,0,0),t.decay=2,J(t,l),void 0!==l.intensity&&(t.intensity=l.intensity),t.name=r.createUniqueName(l.name||"light_"+e),s=Promise.resolve(t),r.cache.add(a,s),s}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,r=this.parser,n=r.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(e){return r._getNodeRef(t.cache,a,e)})}}class p{constructor(){this.name=d.KHR_MATERIALS_UNLIT}getMaterialType(){return n.vBJ}extendParams(e,t,r){let a=[];e.color=new n.Ilk(1,1,1),e.opacity=1;let s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){let t=s.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],h),e.opacity=t[3]}void 0!==s.baseColorTexture&&a.push(r.assignTexture(e,"map",s.baseColorTexture,l))}return Promise.all(a)}}class A{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,a=r.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();let s=[],o=a.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){let e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.FM8(e,e)}return Promise.all(s)}}class g{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_DISPERSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let a=[],s=n.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&a.push(r.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&a.push(r.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(a)}}class y{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,a=r.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();let s=[];t.sheenColor=new n.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;let o=a.extensions[this.name];if(void 0!==o.sheenColorFactor){let e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],h)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(r.assignTexture(t,"sheenColorMap",o.sheenColorTexture,l)),void 0!==o.sheenRoughnessTexture&&s.push(r.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class x{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let a=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&a.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(a)}}class b{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,a=r.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();let s=[],o=a.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(r.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;let l=o.attenuationColor||[1,1,1];return t.attenuationColor=new n.Ilk().setRGB(l[0],l[1],l[2],h),Promise.all(s)}}class w{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class C{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,a=r.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();let s=[],o=a.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(r.assignTexture(t,"specularIntensityMap",o.specularTexture));let c=o.specularColorFactor||[1,1,1];return t.specularColor=new n.Ilk().setRGB(c[0],c[1],c[2],h),void 0!==o.specularColorTexture&&s.push(r.assignTexture(t,"specularColorMap",o.specularColorTexture,l)),Promise.all(s)}}class E{constructor(e){this.parser=e,this.name=d.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let a=[],s=n.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&a.push(r.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(a)}}class I{constructor(e){this.parser=e,this.name=d.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let a=[],s=n.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&a.push(r.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(a)}}class M{constructor(e){this.parser=e,this.name=d.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;let a=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(!(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,a.source,s)}}class B{constructor(e){this.parser=e,this.name=d.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,n=r.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;let s=a.extensions[t],o=n.images[s.source],l=r.textureLoader;if(o.uri){let e=r.options.manager.getHandler(o.uri);null!==e&&(l=e)}return this.detectSupport().then(function(a){if(a)return r.loadTextureImage(e,s.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class S{constructor(e){this.parser=e,this.name=d.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,n=r.json,a=n.textures[e];if(!a.extensions||!a.extensions[t])return null;let s=a.extensions[t],o=n.images[s.source],l=r.textureLoader;if(o.uri){let e=r.options.manager.getHandler(o.uri);null!==e&&(l=e)}return this.detectSupport().then(function(a){if(a)return r.loadTextureImage(e,s.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class T{constructor(e){this.name=d.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(!r.extensions||!r.extensions[this.name])return null;{let e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return n.then(function(t){let r=e.byteOffset||0,n=e.byteLength||0,s=e.count,o=e.byteStride,l=new Uint8Array(t,r,n);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(s,o,l,e.mode,e.filter).then(function(e){return e.buffer}):a.ready.then(function(){let t=new ArrayBuffer(s*o);return a.decodeGltfBuffer(new Uint8Array(t),s,o,l,e.mode,e.filter),t})})}}}class F{constructor(e){this.name=d.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;for(let e of t.meshes[r.mesh].primitives)if(e.mode!==O.TRIANGLES&&e.mode!==O.TRIANGLE_STRIP&&e.mode!==O.TRIANGLE_FAN&&void 0!==e.mode)return null;let a=r.extensions[this.name].attributes,s=[],o={};for(let e in a)s.push(this.parser.getDependency("accessor",a[e]).then(t=>(o[e]=t,o[e])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{let t=e.pop(),r=t.isGroup?t.children:[t],a=e[0].count,s=[];for(let e of r){let t=new n.yGw,r=new n.Pa4,l=new n._fP,h=new n.Pa4(1,1,1),c=new n.SPe(e.geometry,e.material,a);for(let e=0;e<a;e++)o.TRANSLATION&&r.fromBufferAttribute(o.TRANSLATION,e),o.ROTATION&&l.fromBufferAttribute(o.ROTATION,e),o.SCALE&&h.fromBufferAttribute(o.SCALE,e),c.setMatrixAt(e,t.compose(r,l,h));for(let t in o)if("_COLOR_0"===t){let e=o[t];c.instanceColor=new n.lb7(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,o[t]);n.Tme.prototype.copy.call(c,e),this.parser.assignFinalMaterial(c),s.push(c)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]}))}}let P="glTF",_={JSON:1313821514,BIN:5130562};class D{constructor(e){this.name=d.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12);if(this.header={magic:(0,o.r)(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==P)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,n=new DataView(e,12),a=0;for(;a<r;){let t=n.getUint32(a,!0);a+=4;let r=n.getUint32(a,!0);if(a+=4,r===_.JSON){let r=new Uint8Array(e,12+a,t);this.content=(0,o.r)(r)}else if(r===_.BIN){let r=12+a;this.body=e.slice(r,r+t)}a+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class R{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=d.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let r=this.json,n=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},l={},c={};for(let e in s)o[j[e]||e.toLowerCase()]=s[e];for(let t in e.attributes){let n=j[t]||t.toLowerCase();if(void 0!==s[t]){let a=r.accessors[e.attributes[t]],s=G[a.componentType];c[n]=s.name,l[n]=!0===a.normalized}}return t.getDependency("bufferView",a).then(function(e){return new Promise(function(t,r){n.decodeDracoFile(e,function(e){for(let t in e.attributes){let r=e.attributes[t],n=l[t];void 0!==n&&(r.normalized=n)}t(e)},o,c,h,r)})})}}class L{constructor(){this.name=d.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class N{constructor(){this.name=d.KHR_MESH_QUANTIZATION}}class k extends n._C8{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[a+e];return t}interpolate_(e,t,r,n){let a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=2*o,h=3*o,c=n-t,u=(r-t)/c,d=u*u,m=d*u,p=e*h,A=p-h,f=-2*m+3*d,g=m-d,v=1-f,y=g-d+u;for(let e=0;e!==o;e++){let t=s[A+e+o],r=s[A+e+l]*c,n=s[p+e+o],h=s[p+e]*c;a[e]=v*t+y*r+f*n+g*h}return a}}let U=new n._fP;class Q extends k{interpolate_(e,t,r,n){let a=super.interpolate_(e,t,r,n);return U.fromArray(a).normalize().toArray(a),a}}let O={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},G={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},H={9728:n.TyD,9729:n.wem,9984:n.YLQ,9985:n.qyh,9986:n.aH4,9987:n.D1R},z={33071:n.uWy,33648:n.OoA,10497:n.rpg},V={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...s.i>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},W={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},X={CUBICSPLINE:void 0,LINEAR:n.NMF,STEP:n.Syv},Y={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function K(e,t,r){for(let n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function J(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function q(e){let t="",r=Object.keys(e).sort();for(let n=0,a=r.length;n<a;n++)t+=r[n]+":"+e[r[n]]+";";return t}function Z(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let $=new n.yGw;class ee{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new u,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,a=!1,s=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=(a=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||a&&s<98?this.textureLoader=new n.dpR(this.options.manager):this.textureLoader=new n.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,n=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){let s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};return K(a,s,n),J(s,n),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){for(let e of s.scenes)e.updateMatrixWorld();e(s)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){let n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){let n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let n=r.clone(),a=(e,t)=>{let r=this.associations.get(e);for(let[n,s]of(null!=r&&this.associations.set(t,r),e.children.entries()))a(s,t.children[n])};return a(r,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let n=e(t[r]);if(n)return n}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let n=0;n<t.length;n++){let a=e(t[n]);a&&r.push(a)}return r}getDependency(e,t){let r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(!(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[d.KHR_BINARY_GLTF].body);let a=this.options;return new Promise(function(e,s){r.load(n.Zp0.resolveURL(t.uri,a.path),e,void 0,function(){s(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})}loadAccessor(e){let t=this,r=this.json,a=this.json.accessors[e];if(void 0===a.bufferView&&void 0===a.sparse){let e=V[a.type],t=G[a.componentType],r=!0===a.normalized,s=new t(a.count*e);return Promise.resolve(new n.TlE(s,e,r))}let s=[];return void 0!==a.bufferView?s.push(this.getDependency("bufferView",a.bufferView)):s.push(null),void 0!==a.sparse&&(s.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(s).then(function(e){let s,o;let l=e[0],h=V[a.type],c=G[a.componentType],u=c.BYTES_PER_ELEMENT,d=u*h,m=a.byteOffset||0,p=void 0!==a.bufferView?r.bufferViews[a.bufferView].byteStride:void 0,A=!0===a.normalized;if(p&&p!==d){let e=Math.floor(m/p),r="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+e+":"+a.count,d=t.cache.get(r);d||(s=new c(l,e*p,a.count*p/u),d=new n.vpT(s,p/u),t.cache.add(r,d)),o=new n.kB5(d,h,m%p/u,A)}else s=null===l?new c(a.count*h):new c(l,m,a.count*h),o=new n.TlE(s,h,A);if(void 0!==a.sparse){let t=V.SCALAR,r=G[a.sparse.indices.componentType],s=a.sparse.indices.byteOffset||0,u=a.sparse.values.byteOffset||0,d=new r(e[1],s,a.sparse.count*t),m=new c(e[2],u,a.sparse.count*h);null!==l&&(o=new n.TlE(o.array.slice(),o.itemSize,o.normalized));for(let e=0,t=d.length;e<t;e++){let t=d[e];if(o.setX(t,m[e*h]),h>=2&&o.setY(t,m[e*h+1]),h>=3&&o.setZ(t,m[e*h+2]),h>=4&&o.setW(t,m[e*h+3]),h>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})}loadTexture(e){let t=this.json,r=this.options,n=t.textures[e].source,a=t.images[n],s=this.textureLoader;if(a.uri){let e=r.manager.getHandler(a.uri);null!==e&&(s=e)}return this.loadTextureImage(e,n,s)}loadTextureImage(e,t,r){let a=this,s=this.json,o=s.textures[e],l=s.images[t],h=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[h])return this.textureCache[h];let c=this.loadImageSource(t,r).then(function(t){t.flipY=!1,t.name=o.name||l.name||"",""===t.name&&"string"==typeof l.uri&&!1===l.uri.startsWith("data:image/")&&(t.name=l.uri);let r=(s.samplers||{})[o.sampler]||{};return t.magFilter=H[r.magFilter]||n.wem,t.minFilter=H[r.minFilter]||n.D1R,t.wrapS=z[r.wrapS]||n.rpg,t.wrapT=z[r.wrapT]||n.rpg,a.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[h]=c,c}loadImageSource(e,t){let r=this.json,a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let s=r.images[e],o=self.URL||self.webkitURL,l=s.uri||"",h=!1;if(void 0!==s.bufferView)l=this.getDependency("bufferView",s.bufferView).then(function(e){h=!0;let t=new Blob([e],{type:s.mimeType});return l=o.createObjectURL(t)});else if(void 0===s.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let c=Promise.resolve(l).then(function(e){return new Promise(function(r,s){let o=r;!0===t.isImageBitmapLoader&&(o=function(e){let t=new n.xEZ(e);t.needsUpdate=!0,r(t)}),t.load(n.Zp0.resolveURL(e,a.path),o,void 0,s)})}).then(function(e){var t;return!0===h&&o.revokeObjectURL(l),J(e,s),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=c,c}assignTexture(e,t,r,n){let a=this;return this.getDependency("texture",r.index).then(function(s){if(!s)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((s=s.clone()).channel=r.texCoord),a.extensions[d.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[d.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=a.associations.get(s);s=a.extensions[d.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),a.associations.set(s,t)}}return void 0!==n&&("number"==typeof n&&(n=3001===n?l:h),"colorSpace"in s?s.colorSpace=n:s.encoding=n===l?3001:3e3),e[t]=s,s})}assignFinalMaterial(e){let t=e.geometry,r=e.material,a=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new n.UY4,n.F5T.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new n.nls,n.F5T.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(a||s||o){let e="ClonedMaterial:"+r.uuid+":";a&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),a&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return n.Wid}loadMaterial(e){let t;let r=this,a=this.json,s=this.extensions,o=a.materials[e],c={},u=o.extensions||{},m=[];if(u[d.KHR_MATERIALS_UNLIT]){let e=s[d.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),m.push(e.extendParams(c,o,r))}else{let a=o.pbrMetallicRoughness||{};if(c.color=new n.Ilk(1,1,1),c.opacity=1,Array.isArray(a.baseColorFactor)){let e=a.baseColorFactor;c.color.setRGB(e[0],e[1],e[2],h),c.opacity=e[3]}void 0!==a.baseColorTexture&&m.push(r.assignTexture(c,"map",a.baseColorTexture,l)),c.metalness=void 0!==a.metallicFactor?a.metallicFactor:1,c.roughness=void 0!==a.roughnessFactor?a.roughnessFactor:1,void 0!==a.metallicRoughnessTexture&&(m.push(r.assignTexture(c,"metalnessMap",a.metallicRoughnessTexture)),m.push(r.assignTexture(c,"roughnessMap",a.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),m.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,c)})))}!0===o.doubleSided&&(c.side=n.ehD);let p=o.alphaMode||Y.OPAQUE;if(p===Y.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,p===Y.MASK&&(c.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==n.vBJ&&(m.push(r.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new n.FM8(1,1),void 0!==o.normalTexture.scale)){let e=o.normalTexture.scale;c.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&t!==n.vBJ&&(m.push(r.assignTexture(c,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(c.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==n.vBJ){let e=o.emissiveFactor;c.emissive=new n.Ilk().setRGB(e[0],e[1],e[2],h)}return void 0!==o.emissiveTexture&&t!==n.vBJ&&m.push(r.assignTexture(c,"emissiveMap",o.emissiveTexture,l)),Promise.all(m).then(function(){let n=new t(c);return o.name&&(n.name=o.name),J(n,o),r.associations.set(n,{materials:e}),o.extensions&&K(s,n,o),n})}createUniqueName(e){let t=n.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,r=this.extensions,a=this.primitiveCache,s=[];for(let o=0,l=e.length;o<l;o++){let l=e[o],h=function(e){let t;let r=e.extensions&&e.extensions[d.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+q(r.attributes):e.indices+":"+q(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,n=e.targets.length;r<n;r++)t+=":"+q(e.targets[r]);return t}(l),c=a[h];if(c)s.push(c.promise);else{let e;e=l.extensions&&l.extensions[d.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[d.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return et(r,e,t)})}(l):et(new n.u9r,l,t),a[h]={primitive:l,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){let t=this,r=this.json,s=this.extensions,o=r.meshes[e],l=o.primitives,h=[];for(let e=0,t=l.length;e<t;e++){var c;let t=void 0===l[e].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new n.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.Wl3})),c.DefaultMaterial):this.getDependency("material",l[e].material);h.push(t)}return h.push(t.loadGeometries(l)),Promise.all(h).then(function(r){let h=r.slice(0,r.length-1),c=r[r.length-1],u=[];for(let r=0,d=c.length;r<d;r++){let d;let m=c[r],p=l[r],A=h[r];if(p.mode===O.TRIANGLES||p.mode===O.TRIANGLE_STRIP||p.mode===O.TRIANGLE_FAN||void 0===p.mode)!0===(d=!0===o.isSkinnedMesh?new n.TUv(m,A):new n.Kj0(m,A)).isSkinnedMesh&&d.normalizeSkinWeights(),p.mode===O.TRIANGLE_STRIP?d.geometry=(0,a.toTrianglesDrawMode)(d.geometry,n.UlW):p.mode===O.TRIANGLE_FAN&&(d.geometry=(0,a.toTrianglesDrawMode)(d.geometry,n.z$h));else if(p.mode===O.LINES)d=new n.ejS(m,A);else if(p.mode===O.LINE_STRIP)d=new n.x12(m,A);else if(p.mode===O.LINE_LOOP)d=new n.blk(m,A);else if(p.mode===O.POINTS)d=new n.woe(m,A);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(d.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(d,o),d.name=t.createUniqueName(o.name||"mesh_"+e),J(d,o),p.extensions&&K(s,d,p),t.assignFinalMaterial(d),u.push(d)}for(let r=0,n=u.length;r<n;r++)t.associations.set(u[r],{meshes:e,primitives:r});if(1===u.length)return o.extensions&&K(s,u[0],o),u[0];let d=new n.ZAu;o.extensions&&K(s,d,o),t.associations.set(d,{meshes:e});for(let e=0,t=u.length;e<t;e++)d.add(u[e]);return d})}loadCamera(e){let t;let r=this.json.cameras[e],a=r[r.type];if(!a){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new n.cPb(n.M8C.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===r.type&&(t=new n.iKG(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),J(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],r=[];for(let e=0,n=t.joints.length;e<n;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){let r=e.pop(),a=[],s=[];for(let o=0,l=e.length;o<l;o++){let l=e[o];if(l){a.push(l);let e=new n.yGw;null!==r&&e.fromArray(r.array,16*o),s.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new n.OdW(a,s)})}loadAnimation(e){let t=this.json,r=this,a=t.animations[e],s=a.name?a.name:"animation_"+e,o=[],l=[],h=[],c=[],u=[];for(let e=0,t=a.channels.length;e<t;e++){let t=a.channels[e],r=a.samplers[t.sampler],n=t.target,s=n.node,d=void 0!==a.parameters?a.parameters[r.input]:r.input,m=void 0!==a.parameters?a.parameters[r.output]:r.output;void 0!==n.node&&(o.push(this.getDependency("node",s)),l.push(this.getDependency("accessor",d)),h.push(this.getDependency("accessor",m)),c.push(r),u.push(n))}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(c),Promise.all(u)]).then(function(e){let t=e[0],a=e[1],o=e[2],l=e[3],h=e[4],c=[];for(let e=0,n=t.length;e<n;e++){let n=t[e],s=a[e],u=o[e],d=l[e],m=h[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();let p=r._createAnimationTracks(n,s,u,d,m);if(p)for(let e=0;e<p.length;e++)c.push(p[e])}return new n.m7l(s,void 0,c)})}createNodeMesh(e){let t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then(function(e){let t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],r=this._loadNodeShallow(e),n=[],a=t.children||[];for(let e=0,t=a.length;e<t;e++)n.push(this.getDependency("node",a[e]));let s=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([r,Promise.all(n),s]).then(function(e){let t=e[0],r=e[1],n=e[2];null!==n&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(n,$)});for(let e=0,n=r.length;e<n;e++)t.add(r[e]);return t})}_loadNodeShallow(e){let t=this.json,r=this.extensions,a=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let s=t.nodes[e],o=s.name?a.createUniqueName(s.name):"",l=[],h=a._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return h&&l.push(h),void 0!==s.camera&&l.push(a.getDependency("camera",s.camera).then(function(e){return a._getNodeRef(a.cameraCache,s.camera,e)})),a._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){l.push(e)}),this.nodeCache[e]=Promise.all(l).then(function(t){let l;if((l=!0===s.isBone?new n.N$j:t.length>1?new n.ZAu:1===t.length?t[0]:new n.Tme)!==t[0])for(let e=0,r=t.length;e<r;e++)l.add(t[e]);if(s.name&&(l.userData.name=s.name,l.name=o),J(l,s),s.extensions&&K(r,l,s),void 0!==s.matrix){let e=new n.yGw;e.fromArray(s.matrix),l.applyMatrix4(e)}else void 0!==s.translation&&l.position.fromArray(s.translation),void 0!==s.rotation&&l.quaternion.fromArray(s.rotation),void 0!==s.scale&&l.scale.fromArray(s.scale);return a.associations.has(l)||a.associations.set(l,{}),a.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){let t=this.extensions,r=this.json.scenes[e],a=this,s=new n.ZAu;r.name&&(s.name=a.createUniqueName(r.name)),J(s,r),r.extensions&&K(t,s,r);let o=r.nodes||[],l=[];for(let e=0,t=o.length;e<t;e++)l.push(a.getDependency("node",o[e]));return Promise.all(l).then(function(e){for(let t=0,r=e.length;t<r;t++)s.add(e[t]);return a.associations=(e=>{let t=new Map;for(let[e,r]of a.associations)(e instanceof n.F5T||e instanceof n.xEZ)&&t.set(e,r);return e.traverse(e=>{let r=a.associations.get(e);null!=r&&t.set(e,r)}),t})(s),s})}_createAnimationTracks(e,t,r,a,s){let o;let l=[],h=e.name?e.name:e.uuid,c=[];switch(W[s.path]===W.weights?e.traverse(function(e){e.morphTargetInfluences&&c.push(e.name?e.name:e.uuid)}):c.push(h),W[s.path]){case W.weights:o=n.dUE;break;case W.rotation:o=n.iLg;break;case W.position:case W.scale:o=n.yC1;break;default:o=1===r.itemSize?n.dUE:n.yC1}let u=void 0!==a.interpolation?X[a.interpolation]:n.NMF,d=this._getArrayFromAccessor(r);for(let e=0,r=c.length;e<r;e++){let r=new o(c[e]+"."+W[s.path],t.array,d,u);"CUBICSPLINE"===a.interpolation&&this._createCubicSplineTrackInterpolant(r),l.push(r)}return l}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=Z(t.constructor),r=new Float32Array(t.length);for(let n=0,a=t.length;n<a;n++)r[n]=t[n]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof n.iLg?Q:k)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function et(e,t,r){let a=t.attributes,s=[];for(let t in a){let n=j[t]||t.toLowerCase();n in e.attributes||s.push(function(t,n){return r.getDependency("accessor",t).then(function(t){e.setAttribute(n,t)})}(a[t],n))}if(void 0!==t.indices&&!e.index){let n=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});s.push(n)}return J(e,t),!function(e,t,r){let a=t.attributes,s=new n.ZzF;if(void 0===a.POSITION)return;{let e=r.json.accessors[a.POSITION],t=e.min,o=e.max;if(void 0!==t&&void 0!==o){if(s.set(new n.Pa4(t[0],t[1],t[2]),new n.Pa4(o[0],o[1],o[2])),e.normalized){let t=Z(G[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let o=t.targets;if(void 0!==o){let e=new n.Pa4,t=new n.Pa4;for(let n=0,a=o.length;n<a;n++){let a=o[n];if(void 0!==a.POSITION){let n=r.json.accessors[a.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){let e=Z(G[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;let l=new n.aLr;s.getCenter(l.center),l.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=l}(e,t,r),Promise.all(s).then(function(){return void 0!==t.targets?function(e,t,r){let n=!1,a=!1,s=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(a=!0),void 0!==r.COLOR_0&&(s=!0),n&&a&&s)break}if(!n&&!a&&!s)return Promise.resolve(e);let o=[],l=[],h=[];for(let c=0,u=t.length;c<u;c++){let u=t[c];if(n){let t=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(a){let t=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal;l.push(t)}if(s){let t=void 0!==u.COLOR_0?r.getDependency("accessor",u.COLOR_0):e.attributes.color;h.push(t)}}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(t){let r=t[0],o=t[1],l=t[2];return n&&(e.morphAttributes.position=r),a&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=l),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}},80130:function(e,t,r){r.d(t,{B:function(){return a}});var n=r(79290);class a extends n.Kj0{constructor(e,t={}){super(e),this.isWater=!0;let r=this,a=void 0!==t.textureWidth?t.textureWidth:512,s=void 0!==t.textureHeight?t.textureHeight:512,o=void 0!==t.clipBias?t.clipBias:0,l=void 0!==t.alpha?t.alpha:1,h=void 0!==t.time?t.time:0,c=void 0!==t.waterNormals?t.waterNormals:null,u=void 0!==t.sunDirection?t.sunDirection:new n.Pa4(.70707,.70707,0),d=new n.Ilk(void 0!==t.sunColor?t.sunColor:16777215),m=new n.Ilk(void 0!==t.waterColor?t.waterColor:8355711),p=void 0!==t.eye?t.eye:new n.Pa4(0,0,0),A=void 0!==t.distortionScale?t.distortionScale:20,f=void 0!==t.side?t.side:n.Wl3,g=void 0!==t.fog&&t.fog,v=new n.JOQ,y=new n.Pa4,x=new n.Pa4,b=new n.Pa4,w=new n.yGw,C=new n.Pa4(0,0,-1),E=new n.Ltg,I=new n.Pa4,M=new n.Pa4,B=new n.Ltg,S=new n.yGw,T=new n.cPb,F=new n.dd2(a,s),P={uniforms:n.rDY.merge([n.rBU.fog,n.rBU.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new n.yGw},sunColor:{value:new n.Ilk(8355711)},sunDirection:{value:new n.Pa4(.70707,.70707,0)},eye:{value:new n.Pa4},waterColor:{value:new n.Ilk(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <${parseInt(n.UZH.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>	
				}`},_=new n.jyz({fragmentShader:P.fragmentShader,vertexShader:P.vertexShader,uniforms:n.rDY.clone(P.uniforms),lights:!0,side:f,fog:g});_.uniforms.mirrorSampler.value=F.texture,_.uniforms.textureMatrix.value=S,_.uniforms.alpha.value=l,_.uniforms.time.value=h,_.uniforms.normalSampler.value=c,_.uniforms.sunColor.value=d,_.uniforms.waterColor.value=m,_.uniforms.sunDirection.value=u,_.uniforms.distortionScale.value=A,_.uniforms.eye.value=p,r.material=_,r.onBeforeRender=function(e,t,n){if(x.setFromMatrixPosition(r.matrixWorld),b.setFromMatrixPosition(n.matrixWorld),w.extractRotation(r.matrixWorld),y.set(0,0,1),y.applyMatrix4(w),I.subVectors(x,b),I.dot(y)>0)return;I.reflect(y).negate(),I.add(x),w.extractRotation(n.matrixWorld),C.set(0,0,-1),C.applyMatrix4(w),C.add(b),M.subVectors(x,C),M.reflect(y).negate(),M.add(x),T.position.copy(I),T.up.set(0,1,0),T.up.applyMatrix4(w),T.up.reflect(y),T.lookAt(M),T.far=n.far,T.updateMatrixWorld(),T.projectionMatrix.copy(n.projectionMatrix),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(T.projectionMatrix),S.multiply(T.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(y,x),v.applyMatrix4(T.matrixWorldInverse),E.set(v.normal.x,v.normal.y,v.normal.z,v.constant);let a=T.projectionMatrix;B.x=(Math.sign(E.x)+a.elements[8])/a.elements[0],B.y=(Math.sign(E.y)+a.elements[9])/a.elements[5],B.z=-1,B.w=(1+a.elements[10])/a.elements[14],E.multiplyScalar(2/E.dot(B)),a.elements[2]=E.x,a.elements[6]=E.y,a.elements[10]=E.z+1-o,a.elements[14]=E.w,p.setFromMatrixPosition(n.matrixWorld);let s=e.getRenderTarget(),l=e.xr.enabled,h=e.shadowMap.autoUpdate;r.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(F),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,T),r.visible=!0,e.xr.enabled=l,e.shadowMap.autoUpdate=h,e.setRenderTarget(s);let c=n.viewport;void 0!==c&&e.state.viewport(c)}}}},33748:function(e,t,r){r.d(t,{A:function(){return c}});var n=r(592),a=r(79290),s=r(81563),o=Object.defineProperty,l=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t,r)=>(l(e,"symbol"!=typeof t?t+"":t,r),r);class c extends n.w{constructor(e,t,r){super(),h(this,"scene"),h(this,"camera"),h(this,"renderTargetDepth"),h(this,"materialDepth"),h(this,"materialBokeh"),h(this,"fsQuad"),h(this,"_oldClearColor"),h(this,"uniforms"),this.scene=e,this.camera=t;let o=void 0!==r.focus?r.focus:1,l=void 0!==r.aspect?r.aspect:t.aspect,c=void 0!==r.aperture?r.aperture:.025,u=void 0!==r.maxblur?r.maxblur:1,d=r.width||window.innerWidth||1,m=r.height||window.innerHeight||1;this.renderTargetDepth=new a.dd2(d,m,{minFilter:a.TyD,magFilter:a.TyD}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new a.lRF,this.materialDepth.depthPacking=a.mSO,this.materialDepth.blending=a.jFi,void 0===s.v&&console.error("BokehPass relies on BokehShader");let p=s.v,A=a.rDY.clone(p.uniforms);A.tDepth.value=this.renderTargetDepth.texture,A.focus.value=o,A.aspect.value=l,A.aperture.value=c,A.maxblur.value=u,A.nearClip.value=t.near,A.farClip.value=t.far,this.materialBokeh=new a.jyz({defines:Object.assign({},p.defines),uniforms:A,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}),this.uniforms=A,this.needsSwap=!1,this.fsQuad=new n.T(this.materialBokeh),this._oldClearColor=new a.Ilk}render(e,t,r){this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this._oldClearColor);let n=e.getClearAlpha(),a=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),e.clear()),this.fsQuad.render(e),this.scene.overrideMaterial=null,e.setClearColor(this._oldClearColor),e.setClearAlpha(n),e.autoClear=a}}},86:function(e,t,r){r.d(t,{x:function(){return u}});var n=r(79290),a=r(46470),s=r(60371),o=r(92607),l=Object.defineProperty,h=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t,r)=>(h(e,"symbol"!=typeof t?t+"":t,r),r);class u{constructor(e,t){if(c(this,"renderer"),c(this,"_pixelRatio"),c(this,"_width"),c(this,"_height"),c(this,"renderTarget1"),c(this,"renderTarget2"),c(this,"writeBuffer"),c(this,"readBuffer"),c(this,"renderToScreen"),c(this,"passes",[]),c(this,"copyPass"),c(this,"clock"),this.renderer=e,void 0===t){let r={minFilter:n.wem,magFilter:n.wem,format:n.wk1},a=e.getSize(new n.FM8);this._pixelRatio=e.getPixelRatio(),this._width=a.width,this._height=a.height,(t=new n.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===a.C&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===s.T&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new s.T(a.C),this.copyPass.material.blending=n.jFi,this.clock=new n.SUY}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),r=!1,n=this.passes.length;for(let t=0;t<n;t++){let n=this.passes[t];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),n.needsSwap){if(r){let t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==o.F&&(n instanceof o.F?r=!0:n instanceof o.M&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){let t=this.renderer.getSize(new n.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(r,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}},55281:function(e,t,r){r.d(t,{t:function(){return c}});var n=r(592),a=r(79290),s=r(84493),o=Object.defineProperty,l=(e,t,r)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t,r)=>(l(e,"symbol"!=typeof t?t+"":t,r),r);class c extends n.w{constructor(e,t,r,o){super(),h(this,"material"),h(this,"fsQuad"),h(this,"uniforms"),void 0===s.e&&console.error("THREE.FilmPass relies on FilmShader");let l=s.e;this.uniforms=a.rDY.clone(l.uniforms),this.material=new a.jyz({uniforms:this.uniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}),void 0!==o&&(this.uniforms.grayscale.value=o),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==r&&(this.uniforms.sCount.value=r),this.fsQuad=new n.T(this.material)}render(e,t,r,n){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=n,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}}},92607:function(e,t,r){r.d(t,{F:function(){return l},M:function(){return h}});var n=r(592),a=Object.defineProperty,s=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>(s(e,"symbol"!=typeof t?t+"":t,r),r);class l extends n.w{constructor(e,t){super(),o(this,"scene"),o(this,"camera"),o(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){let n,a;let s=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(n=0,a=1):(n=1,a=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.buffers.stencil.setFunc(s.ALWAYS,n,4294967295),o.buffers.stencil.setClear(a),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(s.EQUAL,1,4294967295),o.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.buffers.stencil.setLocked(!0)}}class h extends n.w{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}},592:function(e,t,r){r.d(t,{T:function(){return h},w:function(){return l}});var n=r(79290),a=Object.defineProperty,s=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>(s(e,"symbol"!=typeof t?t+"":t,r),r);class l{constructor(){o(this,"enabled",!0),o(this,"needsSwap",!0),o(this,"clear",!1),o(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,r,n,a){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class h{constructor(e){o(this,"camera",new n.iKG(-1,1,1,-1,0,1)),o(this,"geometry",new n._12(2,2)),o(this,"mesh"),this.mesh=new n.Kj0(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}},55754:function(e,t,r){r.d(t,{C:function(){return h}});var n=r(79290),a=r(592),s=Object.defineProperty,o=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>(o(e,"symbol"!=typeof t?t+"":t,r),r);class h extends a.w{constructor(e,t,r,a,s=0){super(),l(this,"scene"),l(this,"camera"),l(this,"overrideMaterial"),l(this,"clearColor"),l(this,"clearAlpha"),l(this,"clearDepth",!1),l(this,"_oldClearColor",new n.Ilk),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=a,this.clearAlpha=s,this.clear=!0,this.needsSwap=!1}render(e,t,r){let n,a=e.autoClear;e.autoClear=!1;let s=null;void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=a}}},60371:function(e,t,r){r.d(t,{T:function(){return h}});var n=r(79290),a=r(592),s=Object.defineProperty,o=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>(o(e,"symbol"!=typeof t?t+"":t,r),r);class h extends a.w{constructor(e,t="tDiffuse"){super(),l(this,"textureID"),l(this,"uniforms"),l(this,"material"),l(this,"fsQuad"),this.textureID=t,e instanceof n.jyz?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=n.rDY.clone(e.uniforms),this.material=new n.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new a.T(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.fsQuad.dispose(),this.material.dispose()}}},83542:function(e,t,r){r.d(t,{m:function(){return d}});var n=r(79290),a=r(592),s=r(46470),o=r(45165),l=Object.defineProperty,h=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t,r)=>(h(e,"symbol"!=typeof t?t+"":t,r),r);let u=class extends a.w{constructor(e,t,r,l){super(),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=l,this.resolution=void 0!==e?new n.FM8(e.x,e.y):new n.FM8(256,256),this.clearColor=new n.Ilk(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let h=Math.round(this.resolution.x/2),c=Math.round(this.resolution.y/2);this.renderTargetBright=new n.dd2(h,c,{type:n.cLu}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){let t=new n.dd2(h,c,{type:n.cLu});t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);let r=new n.dd2(h,c,{type:n.cLu});r.texture.name="UnrealBloomPass.v"+e,r.texture.generateMipmaps=!1,this.renderTargetsVertical.push(r),h=Math.round(h/2),c=Math.round(c/2)}let u=o.Y;this.highPassUniforms=n.rDY.clone(u.uniforms),this.highPassUniforms.luminosityThreshold.value=l,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new n.jyz({uniforms:this.highPassUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{}}),this.separableBlurMaterials=[];let d=[3,5,7,9,11];h=Math.round(this.resolution.x/2),c=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(d[e])),this.separableBlurMaterials[e].uniforms.texSize.value=new n.FM8(h,c),h=Math.round(h/2),c=Math.round(c/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new n.Pa4(1,1,1),new n.Pa4(1,1,1),new n.Pa4(1,1,1),new n.Pa4(1,1,1),new n.Pa4(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;let m=s.C;this.copyUniforms=n.rDY.clone(m.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new n.jyz({uniforms:this.copyUniforms,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,blending:n.WMw,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new n.Ilk,this.oldClearAlpha=1,this.basic=new n.vBJ,this.fsQuad=new a.T(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),a=Math.round(t/2);this.renderTargetBright.setSize(r,a);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(r,a),this.renderTargetsVertical[e].setSize(r,a),this.separableBlurMaterials[e].uniforms.texSize.value=new n.FM8(r,a),r=Math.round(r/2),a=Math.round(a/2)}render(e,t,r,n,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let s=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let o=this.renderTargetBright;for(let t=0;t<this.nMips;t++)this.fsQuad.material=this.separableBlurMaterials[t],this.separableBlurMaterials[t].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[t].uniforms.direction.value=u.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[t]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[t].uniforms.colorTexture.value=this.renderTargetsHorizontal[t].texture,this.separableBlurMaterials[t].uniforms.direction.value=u.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[t]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[t];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=s}getSeperableBlurMaterial(e){return new n.jyz({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new n.FM8(.5,.5)},direction:{value:new n.FM8(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new n.jyz({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}},d=u;c(d,"BlurDirectionX",new n.FM8(1,0)),c(d,"BlurDirectionY",new n.FM8(0,1))},81563:function(e,t,r){r.d(t,{v:function(){return n}});let n={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float nearClip;\nuniform float farClip;\nuniform float focus;\nuniform float aspect;\n#include <packing>\nfloat getDepth( const in vec2 screenPosition ) {\n	#if DEPTH_PACKING == 1\n	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n	#else\n	return texture2D( tDepth, screenPosition ).x;\n	#endif\n}\nfloat getViewZ( const in float depth ) {\n	#if PERSPECTIVE_CAMERA == 1\n	return perspectiveDepthToViewZ( depth, nearClip, farClip );\n	#else\n	return orthographicDepthToViewZ( depth, nearClip, farClip );\n	#endif\n}\nvoid main() {\n	vec2 aspectcorrect = vec2( 1.0, aspect );\n	float viewZ = getViewZ( getDepth( vUv ) );\n	float factor = ( focus + viewZ );\n	vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\n	vec2 dofblur9 = dofblur * 0.9;\n	vec2 dofblur7 = dofblur * 0.7;\n	vec2 dofblur4 = dofblur * 0.4;\n	vec4 col = vec4( 0.0 );\n	col += texture2D( tColor, vUv.xy );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n	col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\n	gl_FragColor = col / 41.0;\n	gl_FragColor.a = 1.0;\n}"}},46470:function(e,t,r){r.d(t,{C:function(){return n}});let n={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	gl_FragColor = opacity * texel;\n}"}},84493:function(e,t,r){r.d(t,{e:function(){return n}});let n={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#include <common>\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n	vec4 cTextureScreen = texture2D( tDiffuse, vUv );\n	float dx = rand( vUv + time );\n	vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );\n	vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\n	cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n	cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n	if( grayscale ) {\n		cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n	}\n	gl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"}},45165:function(e,t,r){r.d(t,{Y:function(){return n}});let n={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new(r(79290)).Ilk(0)},defaultOpacity:{value:0}},vertexShader:"varying vec2 vUv;\nvoid main() {\n	vUv = uv;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec3 defaultColor;\nuniform float defaultOpacity;\nuniform float luminosityThreshold;\nuniform float smoothWidth;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texel = texture2D( tDiffuse, vUv );\n	vec3 luma = vec3( 0.299, 0.587, 0.114 );\n	float v = dot( texel.xyz, luma );\n	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n	gl_FragColor = mix( outputColor, texel, alpha );\n}"}},43224:function(e,t,r){r.r(t),r.d(t,{computeMorphedAttributes:function(){return d},estimateBytesUsed:function(){return h},interleaveAttributes:function(){return l},mergeBufferAttributes:function(){return o},mergeBufferGeometries:function(){return s},mergeVertices:function(){return c},toCreasedNormals:function(){return m},toTrianglesDrawMode:function(){return u}});var n=r(79290);let a=(e,t)=>e[t],s=(e,t)=>{let r=null!==e[0].index,a=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),l={},h={},c=e[0].morphTargetsRelative,u=new n.u9r,d=0;if(e.forEach((e,n)=>{let o=0;if(r!==(null!==e.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let t in e.attributes){if(!a.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===l[t]&&(l[t]=[]),l[t].push(e.attributes[t]),o++}if(o!==a.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(c!==e.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let t in e.morphAttributes){if(!s.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===h[t]&&(h[t]=[]),h[t].push(e.morphAttributes[t])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(e.userData),t){let t;if(e.index)t=e.index.count;else{if(void 0===e.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;t=e.attributes.position.count}u.addGroup(d,t,n),d+=t}}),r){let t=0,r=[];e.forEach(e=>{let n=e.index;for(let e=0;e<n.count;++e)r.push(n.getX(e)+t);t+=e.attributes.position.count}),u.setIndex(r)}for(let e in l){let t=o(l[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;u.setAttribute(e,t)}for(let e in h){let t=h[e][0].length;if(0===t)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[e]=[];for(let r=0;r<t;++r){let t=[];for(let n=0;n<h[e].length;++n)t.push(h[e][n][r]);let n=o(t);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;u.morphAttributes[e].push(n)}}return u},o=e=>{let t,r,a;let s=0;if(e.forEach(e=>(void 0===t&&(t=e.array.constructor),t!==e.array.constructor)?(console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null):(void 0===r&&(r=e.itemSize),r!==e.itemSize)?(console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null):(void 0===a&&(a=e.normalized),a!==e.normalized)?(console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null):void(s+=e.array.length)),t&&r){let o=new t(s),l=0;return e.forEach(e=>{o.set(e.array,l),l+=e.array.length}),new n.TlE(o,r,a)}},l=e=>{let t;let r=0,s=0;for(let n=0,a=e.length;n<a;++n){let a=e[n];if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;r+=a.array.length,s+=a.itemSize}let o=new n.vpT(new t(r),s),l=0,h=[],c=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let t=0,r=e.length;t<r;t++){let r=e[t],s=r.itemSize,d=r.count,m=new n.kB5(o,s,l,r.normalized);h.push(m),l+=s;for(let e=0;e<d;e++)for(let t=0;t<s;t++)a(m,u[t])(e,a(r,c[t])(e))}return h};function h(e){let t=0;for(let r in e.attributes){let n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}let r=e.getIndex();return t+(r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0)}function c(e,t=1e-4){t=Math.max(t,Number.EPSILON);let r={},a=e.getIndex(),s=e.getAttribute("position"),o=a?a.count:s.count,l=0,h=Object.keys(e.attributes),c={},u={},d=[],m=["getX","getY","getZ","getW"];for(let t=0,r=h.length;t<r;t++){let r=h[t];c[r]=[];let n=e.morphAttributes[r];n&&(u[r]=Array(n.length).fill(0).map(()=>[]))}let p=Math.pow(10,Math.log10(1/t));for(let t=0;t<o;t++){let n=a?a.getX(t):t,s="";for(let t=0,r=h.length;t<r;t++){let r=h[t],a=e.getAttribute(r),o=a.itemSize;for(let e=0;e<o;e++)s+=`${~~(a[m[e]](n)*p)},`}if(s in r)d.push(r[s]);else{for(let t=0,r=h.length;t<r;t++){let r=h[t],a=e.getAttribute(r),s=e.morphAttributes[r],o=a.itemSize,l=c[r],d=u[r];for(let e=0;e<o;e++){let t=m[e];if(l.push(a[t](n)),s)for(let e=0,r=s.length;e<r;e++)d[e].push(s[e][t](n))}}r[s]=l,d.push(l),l++}}let A=e.clone();for(let t=0,r=h.length;t<r;t++){let r=h[t],a=e.getAttribute(r),s=new a.array.constructor(c[r]),o=new n.TlE(s,a.itemSize,a.normalized);if(A.setAttribute(r,o),r in u)for(let t=0;t<u[r].length;t++){let a=e.morphAttributes[r][t],s=new a.array.constructor(u[r][t]),o=new n.TlE(s,a.itemSize,a.normalized);A.morphAttributes[r][t]=o}}return A.setIndex(d),A}function u(e,t){if(t===n.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==n.z$h&&t!==n.UlW)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let r=e.getIndex();if(null===r){let t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let a=r.count-2,s=[];if(r){if(t===n.z$h)for(let e=1;e<=a;e++)s.push(r.getX(0)),s.push(r.getX(e)),s.push(r.getX(e+1));else for(let e=0;e<a;e++)e%2==0?(s.push(r.getX(e)),s.push(r.getX(e+1)),s.push(r.getX(e+2))):(s.push(r.getX(e+2)),s.push(r.getX(e+1)),s.push(r.getX(e)))}s.length/3!==a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let o=e.clone();return o.setIndex(s),o.clearGroups(),o}}function d(e){let t,r,a,s,o,l,h,c,u,d,m;if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;let p=new n.Pa4,A=new n.Pa4,f=new n.Pa4,g=new n.Pa4,v=new n.Pa4,y=new n.Pa4,x=new n.Pa4,b=new n.Pa4,w=new n.Pa4;function C(e,t,r,n,a,s,o,l,h){p.fromBufferAttribute(r,s),A.fromBufferAttribute(r,o),f.fromBufferAttribute(r,l);let c=e.morphTargetInfluences;if(t.morphTargets&&n&&c){x.set(0,0,0),b.set(0,0,0),w.set(0,0,0);for(let e=0,t=n.length;e<t;e++){let t=c[e],r=n[e];0!==t&&(g.fromBufferAttribute(r,s),v.fromBufferAttribute(r,o),y.fromBufferAttribute(r,l),a?(x.addScaledVector(g,t),b.addScaledVector(v,t),w.addScaledVector(y,t)):(x.addScaledVector(g.sub(p),t),b.addScaledVector(v.sub(A),t),w.addScaledVector(y.sub(f),t)))}p.add(x),A.add(b),f.add(w)}e.isSkinnedMesh&&(e.boneTransform(s,p),e.boneTransform(o,A),e.boneTransform(l,f)),h[3*s+0]=p.x,h[3*s+1]=p.y,h[3*s+2]=p.z,h[3*o+0]=A.x,h[3*o+1]=A.y,h[3*o+2]=A.z,h[3*l+0]=f.x,h[3*l+1]=f.y,h[3*l+2]=f.z}let E=e.geometry,I=e.material,M=E.index,B=E.attributes.position,S=E.morphAttributes.position,T=E.morphTargetsRelative,F=E.attributes.normal,P=E.morphAttributes.position,_=E.groups,D=E.drawRange,R=new Float32Array(B.count*B.itemSize),L=new Float32Array(F.count*F.itemSize);if(null!==M){if(Array.isArray(I))for(s=0,l=_.length;s<l;s++)for(u=I[(c=_[s]).materialIndex],d=Math.max(c.start,D.start),m=Math.min(c.start+c.count,D.start+D.count),o=d,h=m;o<h;o+=3)C(e,u,B,S,T,t=M.getX(o),r=M.getX(o+1),a=M.getX(o+2),R),C(e,u,F,P,T,t,r,a,L);else for(d=Math.max(0,D.start),m=Math.min(M.count,D.start+D.count),s=d,l=m;s<l;s+=3)C(e,I,B,S,T,t=M.getX(s),r=M.getX(s+1),a=M.getX(s+2),R),C(e,I,F,P,T,t,r,a,L)}else if(void 0!==B){if(Array.isArray(I))for(s=0,l=_.length;s<l;s++)for(u=I[(c=_[s]).materialIndex],d=Math.max(c.start,D.start),m=Math.min(c.start+c.count,D.start+D.count),o=d,h=m;o<h;o+=3)C(e,u,B,S,T,t=o,r=o+1,a=o+2,R),C(e,u,F,P,T,t,r,a,L);else for(d=Math.max(0,D.start),m=Math.min(B.count,D.start+D.count),s=d,l=m;s<l;s+=3)C(e,I,B,S,T,t=s,r=s+1,a=s+2,R),C(e,I,F,P,T,t,r,a,L)}return{positionAttribute:B,normalAttribute:F,morphedPositionAttribute:new n.a$l(R,3),morphedNormalAttribute:new n.a$l(L,3)}}function m(e,t=Math.PI/3){let r=Math.cos(t),a=(1+1e-10)*100,s=[new n.Pa4,new n.Pa4,new n.Pa4],o=new n.Pa4,l=new n.Pa4,h=new n.Pa4,c=new n.Pa4;function u(e){let t=~~(e.x*a),r=~~(e.y*a),n=~~(e.z*a);return`${t},${r},${n}`}let d=e.index?e.toNonIndexed():e,m=d.attributes.position,p={};for(let e=0,t=m.count/3;e<t;e++){let t=3*e,r=s[0].fromBufferAttribute(m,t+0),a=s[1].fromBufferAttribute(m,t+1),h=s[2].fromBufferAttribute(m,t+2);o.subVectors(h,a),l.subVectors(r,a);let c=new n.Pa4().crossVectors(o,l).normalize();for(let e=0;e<3;e++){let t=u(s[e]);t in p||(p[t]=[]),p[t].push(c)}}let A=new Float32Array(3*m.count),f=new n.TlE(A,3,!1);for(let e=0,t=m.count/3;e<t;e++){let t=3*e,n=s[0].fromBufferAttribute(m,t+0),a=s[1].fromBufferAttribute(m,t+1),d=s[2].fromBufferAttribute(m,t+2);o.subVectors(d,a),l.subVectors(n,a),h.crossVectors(o,l).normalize();for(let e=0;e<3;e++){let n=p[u(s[e])];c.set(0,0,0);for(let e=0,t=n.length;e<t;e++){let t=n[e];h.dot(t)>r&&c.add(t)}c.normalize(),f.setXYZ(t+e,c.x,c.y,c.z)}}return d.setAttribute("normal",f),d}}}]);